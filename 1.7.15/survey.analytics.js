/*!
 * surveyjs - SurveyJS Analytics library v1.7.15
 * Copyright (c) 2015-2019 Devsoft Baltic OÃœ  - http://surveyjs.io/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("survey-core"), require("plotly.js-dist"), require("wordcloud"), require("jquery"));
	else if(typeof define === 'function' && define.amd)
		define("SurveyAnalytics", ["survey-core", "plotly.js-dist", "wordcloud", "jquery"], factory);
	else if(typeof exports === 'object')
		exports["SurveyAnalytics"] = factory(require("survey-core"), require("plotly.js-dist"), require("wordcloud"), require("jquery"));
	else
		root["SurveyAnalytics"] = factory(root["Survey"], root["Plotly"], root["WordCloud"], root["jQuery"]);
})(this, function(__WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_14__, __WEBPACK_EXTERNAL_MODULE_37__, __WEBPACK_EXTERNAL_MODULE_38__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 15);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export __assign */
/* harmony export (immutable) */ __webpack_exports__["a"] = __extends;
/* unused harmony export __rest */
/* unused harmony export __decorate */
var __assign = Object["assign"] ||
    function (target) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
                if (Object.prototype.hasOwnProperty.call(s, p))
                    target[p] = s[p];
        }
        return target;
    };
function __extends(thisClass, baseClass) {
    for (var p in baseClass)
        if (baseClass.hasOwnProperty(p))
            thisClass[p] = baseClass[p];
    function __() {
        this.constructor = thisClass;
    }
    thisClass.prototype =
        baseClass === null
            ? Object.create(baseClass)
            : ((__.prototype = baseClass.prototype), new __());
}
var __rest = function (source, e) {
    var result = {};
    for (var propertyName in source)
        if (Object.prototype.hasOwnProperty.call(source, propertyName) &&
            e.indexOf(propertyName) < 0)
            result[propertyName] = source[propertyName];
    if (source != null &&
        typeof Object["getOwnPropertySymbols"] === "function")
        for (var i = 0, propertySymbols = Object["getOwnPropertySymbols"](source); i < propertySymbols.length; i++)
            if (e.indexOf(propertySymbols[i]) < 0)
                result[propertySymbols[i]] = source[propertySymbols[i]];
    return result;
};
var __decorate = function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3
        ? target
        : desc === null
            ? (desc = Object.getOwnPropertyDescriptor(target, key))
            : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
        r = Reflect.decorate(decorators, target, key, desc);
    else
        for (var i = decorators.length - 1; i >= 0; i--)
            if ((d = decorators[i]))
                r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__visualizerBase__ = __webpack_require__(2);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VisualizationManager; });

var VisualizationManager = /** @class */ (function () {
    function VisualizationManager() {
    }
    VisualizationManager.registerVisualizer = function (typeName, constructor) {
        var vizualizers = VisualizationManager.vizualizers[typeName];
        if (!vizualizers) {
            vizualizers = [];
            VisualizationManager.vizualizers[typeName] = vizualizers;
        }
        vizualizers.push(constructor);
    };
    VisualizationManager.getVisualizers = function (typeName) {
        var vizualizers = VisualizationManager.vizualizers[typeName];
        if (!vizualizers) {
            return [__WEBPACK_IMPORTED_MODULE_0__visualizerBase__["a" /* VisualizerBase */]];
        }
        return vizualizers;
    };
    VisualizationManager.vizualizers = {};
    return VisualizationManager;
}());



/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__visualizerBase_scss__ = __webpack_require__(26);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__visualizerBase_scss___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__visualizerBase_scss__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VisualizerBase; });

var VisualizerBase = /** @class */ (function () {
    function VisualizerBase(targetElement, question, data, options) {
        this.targetElement = targetElement;
        this.question = question;
        this.data = data;
        this.options = options;
        this.toolbarItemCreators = {};
        this.backgroundColor = "#f7f7f7";
    }
    VisualizerBase.prototype.registerToolbarItem = function (name, creator) {
        this.toolbarItemCreators[name] = creator;
    };
    Object.defineProperty(VisualizerBase.prototype, "name", {
        get: function () {
            return "visualizer";
        },
        enumerable: true,
        configurable: true
    });
    VisualizerBase.prototype.update = function (data) {
        this.data = data;
    };
    VisualizerBase.prototype.destroy = function () {
        this.targetElement.innerHTML = "";
    };
    VisualizerBase.prototype.renderContent = function (container) {
        container.innerHTML = "This question type is not visualized yet";
    };
    VisualizerBase.prototype.render = function (targetElement) {
        this.targetElement = targetElement || this.targetElement;
        var toolbarNodeContainer = document.createElement("div");
        var contentContainer = document.createElement("div");
        contentContainer.className = "sa-visualizer__content";
        this.createToolbar(toolbarNodeContainer);
        this.renderContent(contentContainer);
        this.targetElement.appendChild(toolbarNodeContainer);
        this.targetElement.appendChild(contentContainer);
    };
    VisualizerBase.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        Object.keys(this.toolbarItemCreators || {}).forEach(function (toolbarItemName) { return _this.toolbarItemCreators[toolbarItemName](toolbar); });
    };
    VisualizerBase.prototype.createToolbar = function (container) {
        var toolbar = document.createElement("div");
        toolbar.className = "sva-toolbar";
        this.createToolbarItems(toolbar);
        container.appendChild(toolbar);
    };
    VisualizerBase.prototype.invokeOnUpdate = function () {
        this.onUpdate && this.onUpdate();
    };
    VisualizerBase.prototype.getRandomColor = function () {
        var colors = this.getColors();
        return colors[Math.floor(Math.random() * colors.length)];
    };
    VisualizerBase.prototype.getColors = function (count) {
        if (count === void 0) { count = 10; }
        var colors = Array.isArray(VisualizerBase.customColors) &&
            VisualizerBase.customColors.length > 0
            ? VisualizerBase.customColors
            : VisualizerBase.colors;
        var manyColors = [];
        for (var index = 0; index < count; index++) {
            manyColors = manyColors.concat(colors);
        }
        return manyColors;
    };
    VisualizerBase.customColors = [];
    VisualizerBase.colors = [
        "#86e1fb",
        "#3999fb",
        "#ff6771",
        "#1eb496",
        "#ffc152",
        "#aba1ff",
        "#7d8da5",
        "#4ec46c",
        "#cf37a6",
        "#4e6198"
    ];
    return VisualizerBase;
}());



/***/ }),
/* 3 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__localization_english__ = __webpack_require__(31);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return localization; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return surveyStrings; });

var localization = {
    currentLocaleValue: "",
    defaultLocaleValue: "en",
    locales: {},
    localeNames: {},
    supportedLocales: [],
    get currentLocale() {
        return this.currentLocaleValue === this.defaultLocaleValue
            ? ""
            : this.currentLocaleValue;
    },
    set currentLocale(val) {
        this.currentLocaleValue = val;
    },
    get defaultLocale() {
        return this.defaultLocaleValue;
    },
    set defaultLocale(val) {
        this.defaultLocaleValue = val;
    },
    getString: function (strName) {
        var loc = this.currentLocale
            ? this.locales[this.currentLocale]
            : this.locales[this.defaultLocale];
        if (!loc || !loc[strName])
            loc = this.locales[this.defaultLocale];
        var result = loc[strName];
        if (result === undefined) {
            result = this.locales["en"][strName] || strName;
        }
        return result;
    },
    getLocales: function () {
        var res = [];
        res.push("");
        if (this.supportedLocales && this.supportedLocales.length > 0) {
            for (var i = 0; i < this.supportedLocales.length; i++) {
                res.push(this.supportedLocales[i]);
            }
        }
        else {
            for (var key in this.locales) {
                res.push(key);
            }
        }
        res.sort();
        return res;
    }
};
var surveyStrings = __WEBPACK_IMPORTED_MODULE_0__localization_english__["a" /* englishStrings */];
localization.locales["en"] = __WEBPACK_IMPORTED_MODULE_0__localization_english__["a" /* englishStrings */];
localization.localeNames["en"] = "english";


/***/ }),
/* 4 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ToolbarHelper; });
var ToolbarHelper = /** @class */ (function () {
    function ToolbarHelper() {
    }
    ToolbarHelper.createSelector = function (toolbar, options, isSelected, hander) {
        var selectWrapper = document.createElement("div");
        selectWrapper.className = "sva-question__select-wrapper";
        var select = document.createElement("select");
        select.className = "sva-question__select";
        options.forEach(function (option) {
            var optionElement = document.createElement("option");
            optionElement.value = option.value;
            optionElement.text = option.text;
            optionElement.selected = isSelected(option);
            select.appendChild(optionElement);
        });
        select.onchange = hander;
        selectWrapper.appendChild(select);
        return selectWrapper;
    };
    ToolbarHelper.createButton = function (toolbar, hander, text, cssClass) {
        if (text === void 0) { text = ""; }
        if (cssClass === void 0) { cssClass = ""; }
        var button = document.createElement("span");
        button.className = "sva-toolbar__button " + cssClass;
        button.innerText = text;
        button.onclick = hander;
        toolbar.appendChild(button);
        return button;
    };
    return ToolbarHelper;
}());



/***/ }),
/* 5 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_5__;

/***/ }),
/* 6 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__selectBase__ = __webpack_require__(12);
/* harmony export (immutable) */ __webpack_exports__["a"] = canLoadPlotly;
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return SelectBasePlotly; });


function canLoadPlotly() {
    return !!window.URL.createObjectURL;
}
var Plotly;
if (canLoadPlotly()) {
    Plotly = __webpack_require__(14);
}
var SelectBasePlotly = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SelectBasePlotly, _super);
    function SelectBasePlotly(targetElement, question, data, options) {
        var _this = _super.call(this, targetElement, question, data, options) || this;
        _this.targetElement = targetElement;
        _this.filterText = undefined;
        _this.filter = undefined;
        _this.chartTypes = SelectBasePlotly.types;
        _this.chartType = _this.chartTypes[0];
        return _this;
    }
    SelectBasePlotly.prototype.update = function (data) {
        _super.prototype.update.call(this, data);
        this.destroy();
        this.chart = this.getPlotlyChart(this.chartNode, this.chartType);
        this.invokeOnUpdate();
    };
    SelectBasePlotly.prototype.destroy = function () {
        Plotly.purge(this.chartNode);
    };
    SelectBasePlotly.prototype.createChart = function () {
        this.chart = this.getPlotlyChart(this.chartNode, this.chartType);
    };
    SelectBasePlotly.prototype.getSelectedItemByText = function (itemText) {
        return this.question.choices.filter(function (choice) { return choice.text === itemText; })[0];
    };
    SelectBasePlotly.prototype.patchConfigParameters = function (chartNode, traces, layout, config) { };
    SelectBasePlotly.prototype.getPlotlyChart = function (chartNode, chartType) {
        var _this = this;
        var question = this.question;
        var datasets = this.getData();
        var labels = this.getLabels();
        var colors = this.getColors();
        var traces = [];
        if (this.orderByAnsweres == "asc" || this.orderByAnsweres == "desc") {
            var dict = this.sortDictionary(this.zipArrays(labels, colors), datasets[0], this.orderByAnsweres == "desc");
            var labelsAndColors = this.unzipArrays(dict.keys);
            labels = labelsAndColors.first;
            colors = labelsAndColors.second;
            datasets[0] = dict.values;
        }
        var traceConfig = {
            type: chartType,
            y: labels.map(function (l) {
                if (l.length > 30) {
                    return l.substring(0, 27) + "...";
                }
                return l;
            }),
            text: labels,
            hoverinfo: "x+y",
            orientation: "h",
            mode: "markers",
            width: 0.5,
            marker: {}
        };
        if (this.chartType === "pie" || this.chartType === "doughnut") {
            traceConfig.hoverinfo = "text+value+percent";
            traceConfig.marker.colors = colors;
            traceConfig.textposition = "inside";
        }
        else if (this.chartType === "bar") {
            traceConfig.marker.color = colors;
        }
        if (this.chartType === "doughnut") {
            traceConfig.type = "pie";
            traceConfig.hole = 0.4;
        }
        if (datasets.length === 1) {
            traceConfig.marker.symbol = "circle";
            traceConfig.marker.size = 16;
        }
        datasets.forEach(function (dataset) {
            if (_this.chartType === "pie" || _this.chartType === "doughnut") {
                traces.push(Object.assign({}, traceConfig, {
                    values: dataset,
                    labels: labels
                }));
            }
            else {
                traces.push(Object.assign({}, traceConfig, { x: dataset }));
            }
        });
        var height = chartType === "pie" || this.chartType === "doughnut"
            ? labels.length < 10
                ? labels.length * 50 + 100
                : 550
            : (labels.length + (labels.length + 1) * 0.5) * 20;
        var layout = {
            font: {
                family: "Segoe UI, sans-serif",
                size: 14,
                weight: "normal",
                color: "#404040"
            },
            height: height,
            margin: {
                t: 0,
                b: 0,
                r: 10
            },
            colorway: colors,
            hovermode: "closest",
            yaxis: {
                automargin: true,
                type: "category",
                ticklen: 5,
                tickcolor: "transparent"
            },
            xaxis: {
                rangemode: "nonnegative",
                automargin: true
            },
            plot_bgcolor: this.backgroundColor,
            paper_bgcolor: this.backgroundColor,
            showlegend: false
        };
        var config = {
            displaylogo: false,
            responsive: true
        };
        if (SelectBasePlotly.displayModeBar !== undefined) {
            config.displayModeBar = SelectBasePlotly.displayModeBar;
        }
        this.patchConfigParameters(chartNode, traces, layout, config);
        var plot = Plotly.newPlot(chartNode, traces, layout, config);
        chartNode["on"]("plotly_click", function (data) {
            if (data.points.length > 0 && _this.onDataItemSelected) {
                var itemText = data.points[0].text;
                var item = _this.getSelectedItemByText(itemText);
                _this.setSelection(item);
            }
        });
        var getDragLayer = function () {
            return chartNode.getElementsByClassName("nsewdrag")[0];
        };
        chartNode["on"]("plotly_hover", function () {
            var dragLayer = getDragLayer();
            dragLayer && (dragLayer.style.cursor = "pointer");
        });
        chartNode["on"]("plotly_unhover", function () {
            var dragLayer = getDragLayer();
            dragLayer && (dragLayer.style.cursor = "");
        });
        return plot;
    };
    SelectBasePlotly.displayModeBar = undefined;
    SelectBasePlotly.types = ["bar", "pie", "doughnut", "scatter"];
    return SelectBasePlotly;
}(__WEBPACK_IMPORTED_MODULE_1__selectBase__["a" /* SelectBase */]));



/***/ }),
/* 7 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ColumnVisibility; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return QuestionLocation; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return ColumnDataType; });
var ColumnVisibility;
(function (ColumnVisibility) {
    ColumnVisibility[ColumnVisibility["Visible"] = 0] = "Visible";
    ColumnVisibility[ColumnVisibility["Invisible"] = 1] = "Invisible";
    ColumnVisibility[ColumnVisibility["PublicInvisible"] = 2] = "PublicInvisible";
})(ColumnVisibility || (ColumnVisibility = {}));
var QuestionLocation;
(function (QuestionLocation) {
    QuestionLocation[QuestionLocation["Column"] = 0] = "Column";
    QuestionLocation[QuestionLocation["Row"] = 1] = "Row";
})(QuestionLocation || (QuestionLocation = {}));
var ColumnDataType;
(function (ColumnDataType) {
    ColumnDataType[ColumnDataType["Text"] = 0] = "Text";
    ColumnDataType[ColumnDataType["FileLink"] = 1] = "FileLink";
    ColumnDataType[ColumnDataType["Image"] = 2] = "Image";
})(ColumnDataType || (ColumnDataType = {}));


/***/ }),
/* 8 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__alternativeVizualizersWrapper__ = __webpack_require__(29);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_survey_core__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_survey_core___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_survey_core__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__visualizationPanel_scss__ = __webpack_require__(25);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__visualizationPanel_scss___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3__visualizationPanel_scss__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__selectBase__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__utils_index__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__config__ = __webpack_require__(30);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VisualizationPanel; });



var Muuri = __webpack_require__(27);





var questionElementClassName = "sva-question";
var questionLayoutedElementClassName = "sva-question-layouted";
/**
 * VisualizationPanel is responsible for displaying an array of survey questions
 */
var VisualizationPanel = /** @class */ (function () {
    function VisualizationPanel(targetElement, questions, data, options, _elements, isTrustedAccess) {
        if (options === void 0) { options = {}; }
        if (_elements === void 0) { _elements = []; }
        if (isTrustedAccess === void 0) { isTrustedAccess = false; }
        this.targetElement = targetElement;
        this.questions = questions;
        this.data = data;
        this.options = options;
        this._elements = _elements;
        this.isTrustedAccess = isTrustedAccess;
        this._showHeader = false;
        this.panelContent = undefined;
        this.filterValues = {};
        this.visualizers = [];
        /**
         * Fires when element visibility has been changed.
         */
        this.onVisibleElementsChanged = new __WEBPACK_IMPORTED_MODULE_2_survey_core__["Event"]();
        this.filteredData = data;
        if (_elements.length === 0) {
            this._elements = this.buildElements(questions);
        }
    }
    Object.defineProperty(VisualizationPanel.prototype, "allowDynamicLayout", {
        get: function () {
            return (this.options.allowDynamicLayout === undefined ||
                this.options.allowDynamicLayout === true);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(VisualizationPanel.prototype, "layoutEngine", {
        get: function () {
            return !!this.getLayoutEngine && this.getLayoutEngine();
        },
        enumerable: true,
        configurable: true
    });
    VisualizationPanel.prototype.buildElements = function (questions) {
        return (questions || []).map(function (question) {
            return {
                name: question.name,
                displayName: question.title,
                visibility: __WEBPACK_IMPORTED_MODULE_7__config__["a" /* ElementVisibility */].Visible,
                type: undefined,
            };
        });
    };
    VisualizationPanel.prototype.getElements = function () {
        return (this._elements || []).map(function (element) {
            return {
                name: element.name,
                displayName: element.displayName,
                visibility: element.visibility,
                type: element.type,
            };
        });
    };
    /**
     * Checks whether certain element is visible.
     */
    VisualizationPanel.prototype.isVisible = function (visibility) {
        return ((this.isTrustedAccess && visibility !== __WEBPACK_IMPORTED_MODULE_7__config__["a" /* ElementVisibility */].Invisible) ||
            (!this.isTrustedAccess && visibility === __WEBPACK_IMPORTED_MODULE_7__config__["a" /* ElementVisibility */].Visible));
    };
    Object.defineProperty(VisualizationPanel.prototype, "visibleElements", {
        get: function () {
            var _this = this;
            return this._elements.filter(function (el) { return _this.isVisible(el.visibility); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(VisualizationPanel.prototype, "hiddenElements", {
        get: function () {
            var _this = this;
            return this._elements.filter(function (el) { return !_this.isVisible(el.visibility); });
        },
        enumerable: true,
        configurable: true
    });
    VisualizationPanel.prototype.getElement = function (name) {
        return this._elements.filter(function (el) { return el.name === name; })[0];
    };
    VisualizationPanel.prototype.visibleElementsChanged = function (element) {
        if (!this.onVisibleElementsChanged.isEmpty) {
            this.onVisibleElementsChanged.fire(this, {
                elements: this._elements,
                changed: element,
            });
        }
        this.layout();
    };
    /**
     * Destroys given visualizer.
     */
    VisualizationPanel.prototype.destroyVisualizer = function (visualizer) {
        if (visualizer instanceof __WEBPACK_IMPORTED_MODULE_4__selectBase__["a" /* SelectBase */]) {
            visualizer.setSelection(undefined);
            visualizer.onDataItemSelected = undefined;
        }
        visualizer.onUpdate = undefined;
        visualizer.destroy();
        this.visualizers.splice(this.visualizers.indexOf(visualizer), 1);
    };
    /**
     * Renders given element.
     */
    VisualizationPanel.prototype.renderVisualizer = function (element) {
        var _this = this;
        var question = this.questions.filter(function (q) { return q.name === element.name; })[0];
        var questionElement = document.createElement("div");
        var questionContent = document.createElement("div");
        var titleElement = document.createElement("h3");
        var vizualizerElement = document.createElement("div");
        titleElement.innerText = element.displayName;
        questionElement.className = this.allowDynamicLayout
            ? questionElementClassName + " " + questionLayoutedElementClassName
            : questionElementClassName;
        questionContent.className = questionElementClassName + "__content";
        titleElement.className = questionElementClassName + "__title";
        questionContent.appendChild(titleElement);
        questionContent.appendChild(vizualizerElement);
        questionElement.appendChild(questionContent);
        var visualizer = this.createVizualizer(vizualizerElement, question, this.filteredData);
        visualizer.registerToolbarItem("removeQuestion", function (toolbar) {
            return __WEBPACK_IMPORTED_MODULE_5__utils_index__["a" /* ToolbarHelper */].createButton(toolbar, function () {
                setTimeout(function () {
                    element.visibility = __WEBPACK_IMPORTED_MODULE_7__config__["a" /* ElementVisibility */].Invisible;
                    _this.destroyVisualizer(visualizer);
                    !!_this.layoutEngine &&
                        _this.layoutEngine.remove([questionElement]);
                    _this.panelContent.removeChild(questionElement);
                    _this.visibleElementsChanged(element);
                }, 0);
            }, __WEBPACK_IMPORTED_MODULE_6__localizationManager__["a" /* localization */].getString("hideButton"));
        });
        if (visualizer instanceof __WEBPACK_IMPORTED_MODULE_4__selectBase__["a" /* SelectBase */]) {
            var filterInfo = {
                text: undefined,
                element: undefined,
                update: function (selection) {
                    if (!!selection && !!selection.value) {
                        this.element.style.display = "inline-block";
                        this.text.innerHTML = "Filter: [" + selection.text + "]";
                    }
                    else {
                        this.element.style.display = "none";
                        this.text.innerHTML = "";
                    }
                },
            };
            visualizer.registerToolbarItem("questionFilterInfo", function (toolbar) {
                filterInfo.element = document.createElement("div");
                filterInfo.element.className = "sva-question__filter";
                filterInfo.text = document.createElement("span");
                filterInfo.text.className = "sva-question__filter-text";
                filterInfo.element.appendChild(filterInfo.text);
                var filterClear = document.createElement("span");
                filterClear.className = "sva-toolbar__button";
                filterClear.innerHTML = __WEBPACK_IMPORTED_MODULE_6__localizationManager__["a" /* localization */].getString("clearButton");
                filterClear.onclick = function () {
                    visualizer.setSelection(undefined);
                };
                filterInfo.element.appendChild(filterClear);
                toolbar.appendChild(filterInfo.element);
                filterInfo.update(visualizer.selection);
                return filterInfo.element;
            });
            visualizer.onDataItemSelected = function (selectedValue, selectedText) {
                filterInfo.update({ value: selectedValue, text: selectedText });
                _this.applyFilter(question.name, selectedValue);
            };
        }
        visualizer.render();
        visualizer.onUpdate = function () { return _this.layout(); };
        this.visualizers.push(visualizer);
        return questionElement;
    };
    /**
     * Renders all questions into given HTML container element.
     */
    VisualizationPanel.prototype.render = function () {
        var _this = this;
        var layoutEngine = undefined;
        this.getLayoutEngine = function () { return layoutEngine; };
        this.panelContent = document.createElement("div");
        this.panelContent.className = "sva-grid";
        this.visibleElements.forEach(function (element) {
            var questionElement = _this.renderVisualizer(element);
            _this.panelContent.appendChild(questionElement);
        });
        if (this.showHeader) {
            var panelHeader = document.createElement("div");
            panelHeader.className = "sva-panel__header";
            var toolobar = document.createElement("div");
            toolobar.className = "sva-toolbar";
            this.createToolbarItems(toolobar);
            panelHeader.appendChild(toolobar);
            this.targetElement.appendChild(panelHeader);
        }
        this.targetElement.appendChild(this.panelContent);
        var moveHandler = function (data) {
            var elements = _this._elements.splice(data.fromIndex, 1);
            _this._elements.splice(data.toIndex, 0, elements[0]);
        };
        if (this.allowDynamicLayout) {
            layoutEngine = new Muuri(this.panelContent, {
                items: "." + questionLayoutedElementClassName,
                dragEnabled: true,
            });
            layoutEngine.on("move", moveHandler);
        }
        !!window && window.dispatchEvent(new UIEvent("resize"));
    };
    VisualizationPanel.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        var resetFilterButton = __WEBPACK_IMPORTED_MODULE_5__utils_index__["a" /* ToolbarHelper */].createButton(toolbar, function () {
            _this.visualizers.forEach(function (visualizer) {
                if (visualizer instanceof __WEBPACK_IMPORTED_MODULE_4__selectBase__["a" /* SelectBase */]) {
                    visualizer.setSelection(undefined);
                }
            });
        }, __WEBPACK_IMPORTED_MODULE_6__localizationManager__["a" /* localization */].getString("resetFilter"));
        toolbar.appendChild(resetFilterButton);
        var addElementSelector = undefined;
        var addElementSelectorUpdater = function (panel, _) {
            var hiddenElements = _this.hiddenElements;
            if (hiddenElements.length > 0) {
                var selectWrapper = __WEBPACK_IMPORTED_MODULE_5__utils_index__["a" /* ToolbarHelper */].createSelector(toolbar, [
                    {
                        name: undefined,
                        displayName: __WEBPACK_IMPORTED_MODULE_6__localizationManager__["a" /* localization */].getString("addElement"),
                    },
                ]
                    .concat(hiddenElements)
                    .map(function (element) {
                    return {
                        value: element.name,
                        text: element.displayName,
                    };
                }), function (option) { return false; }, function (e) {
                    var element = _this.getElement(e.target.value);
                    element.visibility = __WEBPACK_IMPORTED_MODULE_7__config__["a" /* ElementVisibility */].Visible;
                    var questionElement = _this.renderVisualizer(element);
                    _this.panelContent.appendChild(questionElement);
                    !!_this.layoutEngine && _this.layoutEngine.add([questionElement]);
                    _this.visibleElementsChanged(element);
                });
                (addElementSelector &&
                    toolbar.replaceChild(selectWrapper, addElementSelector)) ||
                    toolbar.appendChild(selectWrapper);
                addElementSelector = selectWrapper;
            }
            else {
                addElementSelector && toolbar.removeChild(addElementSelector);
                addElementSelector = undefined;
            }
        };
        addElementSelectorUpdater(this, {});
        this.onVisibleElementsChanged.add(addElementSelectorUpdater);
    };
    /**
     * Destroys visualizer and all inner content.
     */
    VisualizationPanel.prototype.destroy = function () {
        var layoutEngine = this.layoutEngine;
        if (!!layoutEngine) {
            layoutEngine.off("move");
            layoutEngine.destroy();
            this.getLayoutEngine = undefined;
        }
        this.targetElement.innerHTML = "";
        this.panelContent = undefined;
        this.visualizers.forEach(function (visualizer) {
            visualizer.onUpdate = undefined;
            if (visualizer instanceof __WEBPACK_IMPORTED_MODULE_4__selectBase__["a" /* SelectBase */]) {
                visualizer.onDataItemSelected = undefined;
            }
            visualizer.destroy();
        });
        this.visualizers = [];
    };
    /**
     * Updates visualizer and all inner content.
     */
    VisualizationPanel.prototype.update = function (hard) {
        var _this = this;
        if (hard === void 0) { hard = false; }
        if (hard && this.visualizers.length > 0) {
            this.destroy();
            this.render();
        }
        else {
            this.visualizers.forEach(function (visualizer) {
                return setTimeout(function () { return visualizer.update(_this.filteredData); }, 10);
            });
        }
    };
    /**
     * Updates layout of visualizer inner content.
     */
    VisualizationPanel.prototype.layout = function () {
        var layoutEngine = this.layoutEngine;
        if (!!layoutEngine) {
            layoutEngine.refreshItems();
            layoutEngine.layout();
        }
    };
    /**
     * Applies filter by question name and value.
     */
    VisualizationPanel.prototype.applyFilter = function (questionName, selectedValue) {
        var _this = this;
        var filterChanged = true;
        if (selectedValue !== undefined) {
            filterChanged = this.filterValues[questionName] !== selectedValue;
            this.filterValues[questionName] = selectedValue;
        }
        else {
            filterChanged = this.filterValues[questionName] !== undefined;
            delete this.filterValues[questionName];
        }
        if (filterChanged) {
            this.filteredData = this.data.filter(function (item) {
                return !Object.keys(_this.filterValues).some(function (key) { return item[key] !== _this.filterValues[key]; });
            });
            this.update();
        }
    };
    /**
     * Creates visuzlizer by question.
     */
    VisualizationPanel.prototype.createVizualizer = function (vizualizerElement, question, data) {
        var creators = __WEBPACK_IMPORTED_MODULE_0__visualizationManager__["a" /* VisualizationManager */].getVisualizers(question.getType());
        var visualizers = creators.map(function (creator) { return new creator(vizualizerElement, question, data); });
        if (visualizers.length > 1) {
            var visualizer = new __WEBPACK_IMPORTED_MODULE_1__alternativeVizualizersWrapper__["a" /* AlternativeVisualizersWrapper */](visualizers, vizualizerElement, question, data);
            return visualizer;
        }
        return visualizers[0];
    };
    Object.defineProperty(VisualizationPanel.prototype, "showHeader", {
        get: function () {
            return this._showHeader;
        },
        set: function (newValue) {
            if (newValue != this._showHeader) {
                this._showHeader = newValue;
                this.update(true);
            }
        },
        enumerable: true,
        configurable: true
    });
    return VisualizationPanel;
}());



/***/ }),
/* 9 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__visualizationPanel__ = __webpack_require__(8);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VisualizationPanelDynamic; });




var VisualizationPanelDynamic = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](VisualizationPanelDynamic, _super);
    function VisualizationPanelDynamic(targetNode, question, data, options) {
        var _this = _super.call(this, targetNode, question, data, options) || this;
        _this.targetNode = targetNode;
        _this.data = [];
        data.forEach(function (dataItem) {
            return !!dataItem[question.name] &&
                (_this.data = _this.data.concat(dataItem[question.name]));
        });
        return _this;
    }
    VisualizationPanelDynamic.prototype.getQuestions = function () {
        var paneldynamic = this.question;
        return paneldynamic.template.questions;
    };
    VisualizationPanelDynamic.prototype.render = function () {
        var visPanel = new __WEBPACK_IMPORTED_MODULE_3__visualizationPanel__["a" /* VisualizationPanel */](this.targetNode, this.getQuestions(), this.data, { allowDynamicLayout: false });
        visPanel.render();
    };
    return VisualizationPanelDynamic;
}(__WEBPACK_IMPORTED_MODULE_1__visualizerBase__["a" /* VisualizerBase */]));

__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("paneldynamic", VisualizationPanelDynamic);


/***/ }),
/* 10 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__english__ = __webpack_require__(36);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return textHelper; });

var stopWordsDictionary = {};
stopWordsDictionary["en"] = __WEBPACK_IMPORTED_MODULE_0__english__["a" /* stopWords */];
var textHelper = {
    getStopWords: function (locale) {
        if (locale === void 0) { locale = ""; }
        return stopWordsDictionary[locale || "en"] || [];
    }
};


/***/ }),
/* 11 */
/***/ (function(module, exports) {

module.exports = "<svg style=\"display:none;\"><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-detail\"><circle class=\"st0\" cx=\"1.5\" cy=\"8.5\" r=\"1.5\"></circle><circle class=\"st0\" cx=\"7.5\" cy=\"8.5\" r=\"1.5\"></circle><circle class=\"st0\" cx=\"13.5\" cy=\"8.5\" r=\"1.5\"></circle></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-drag\"><path class=\"st0\" d=\"M13 5l-1 1 1 1H9V3l1 1 1-1-3-3-3 3 1 1 1-1v4H3l1-1-1-1-3 3 3 3 1-1-1-1h4v4l-1-1-1 1 3 3 3-3-1-1-1 1V9h4l-1 1 1 1 3-3z\"></path></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-hide\"><path class=\"st1\" d=\"M12.79 4.2L16 1l-1-1-3.32 3.32C10.57 2.55 9.32 2 8 2 3.63 2 0 7.97 0 7.97s1.27 2.1 3.21 3.82l-3.23 3.23.98.98 3.35-3.34C5.41 13.44 6.67 14 8 14c4.37 0 8-6 8-6s-1.27-2.09-3.21-3.8zM2 7.97c1.07-1.47 3.61-4 6-4 .8 0 1.6.27 2.35.68l-.78.78c-.46-.29-.99-.46-1.57-.46-1.66 0-3 1.34-3 3 0 .58.17 1.11.46 1.57l-.97.97A13.38 13.38 0 0 1 2 7.97zm6 4c-.8 0-1.59-.27-2.33-.67l.78-.77c.45.27.98.44 1.55.44 1.66 0 3-1.34 3-3 0-.57-.17-1.09-.44-1.55l.98-.98c1.11.87 2.01 1.91 2.46 2.52-1.07 1.48-3.61 4.01-6 4.01z\"></path></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-makeprivate\"><circle class=\"st0\" cx=\"8\" cy=\"4\" r=\"3\"></circle><path class=\"st0\" d=\"M8 8c-3.31 0-6 2.73-6 4.67S5.27 15 8 15s6-.4 6-2.33S11.31 8 8 8z\"></path></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-makepublic\"><circle class=\"st0\" cx=\"6\" cy=\"5\" r=\"3\"></circle><path class=\"st0\" d=\"M10 5c0 .34-.06.67-.14.99.05 0 .09.01.14.01 1.66 0 3-1.34 3-3s-1.34-3-3-3C8.97 0 8.07.52 7.53 1.3 8.98 1.91 10 3.33 10 5zM6 9c-3.31 0-6 2.73-6 4.67S3.27 16 6 16s6-.4 6-2.33S9.31 9 6 9zM10 7c-.19 0-.38.01-.57.03a4.14 4.14 0 0 1-1.37 1.39c3 .83 5.23 3.31 5.42 5.28 1.44-.31 2.52-.92 2.52-2.03C16 9.74 13.31 7 10 7z\"></path></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-movetodetails\"><circle class=\"st0\" cx=\"1.5\" cy=\"14.5\" r=\"1.5\"></circle><circle class=\"st0\" cx=\"7.5\" cy=\"14.5\" r=\"1.5\"></circle><circle class=\"st0\" cx=\"13.5\" cy=\"14.5\" r=\"1.5\"></circle><path class=\"st0\" d=\"M12 1h3v9h-3zM2.02 7.02L1 6 0 7l3 3 3-3-1-1-.94.94C4.33 4.73 6.21 3 8.5 3c.17 0 .33.03.5.05V1.03C8.83 1.01 8.67 1 8.5 1 5.08 1 2.27 3.66 2.02 7.02z\"></path></symbol><symbol viewBox=\"0 0 16 16\" id=\"sa-svg-sorting\"><path class=\"st0\" d=\"M8 3l2 2 1-1-3-3-3 3 1 1zM8 13l-2-2-1 1 3 3 3-3-1-1z\"></path></symbol></svg>";

/***/ }),
/* 12 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_survey_core__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__utils_index__ = __webpack_require__(4);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return SelectBase; });





var SelectBase = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SelectBase, _super);
    function SelectBase(targetElement, question, data, options) {
        var _this = _super.call(this, targetElement, question, data, options) || this;
        _this.targetElement = targetElement;
        _this.selectedItem = undefined;
        _this.orderByAnsweres = "default";
        _this.chartNode = document.createElement("div");
        return _this;
    }
    SelectBase.prototype.onChartTypeChanged = function () { };
    SelectBase.prototype.setChartType = function (chartType) {
        if (this.chartTypes.indexOf(chartType) !== -1 &&
            this.chartType !== chartType) {
            this.chartType = chartType;
            this.createChart();
            this.invokeOnUpdate();
        }
    };
    SelectBase.prototype.createChart = function () { };
    SelectBase.prototype.setSelection = function (item) {
        this.selectedItem = item;
        this.onDataItemSelected((item && item.value) || undefined, (item && item.text) || "");
    };
    Object.defineProperty(SelectBase.prototype, "selection", {
        get: function () {
            return this.selectedItem;
        },
        enumerable: true,
        configurable: true
    });
    SelectBase.prototype.setLabelsOrder = function (value) {
        this.orderByAnsweres = value;
    };
    SelectBase.prototype.renderContent = function (container) {
        this.createChart();
        container.appendChild(this.chartNode);
    };
    SelectBase.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        if (this.chartTypes.length > 1) {
            var selectWrapper = __WEBPACK_IMPORTED_MODULE_4__utils_index__["a" /* ToolbarHelper */].createSelector(toolbar, this.chartTypes.map(function (chartType) {
                return {
                    value: chartType,
                    text: __WEBPACK_IMPORTED_MODULE_3__localizationManager__["a" /* localization */].getString("chartType_" + chartType)
                };
            }), function (option) { return _this.chartType === option.value; }, function (e) {
                _this.setChartType(e.target.value);
                _this.onChartTypeChanged();
            });
            toolbar.appendChild(selectWrapper);
        }
        _super.prototype.createToolbarItems.call(this, toolbar);
    };
    SelectBase.prototype.valuesSource = function () {
        var question = this.question;
        return question["activeChoices"];
    };
    SelectBase.prototype.getValues = function () {
        var values = this.valuesSource().map(function (choice) { return choice.value; });
        if (this.question.hasOther)
            values.unshift("other");
        return values;
    };
    SelectBase.prototype.getLabels = function () {
        var _this = this;
        var labels = this.valuesSource().map(function (choice) {
            return __WEBPACK_IMPORTED_MODULE_1_survey_core__["ItemValue"].getTextOrHtmlByValue(_this.valuesSource(), choice.value);
        });
        if (this.question.hasOther)
            labels.unshift("Other");
        return labels;
    };
    SelectBase.prototype.getData = function () {
        var _this = this;
        var values = this.getValues();
        var statistics = values.map(function (v) { return 0; });
        this.data.forEach(function (row) {
            var rowValue = row[_this.question.name];
            if (!!rowValue) {
                if (Array.isArray(rowValue)) {
                    values.forEach(function (val, index) {
                        if (rowValue.indexOf(val) !== -1) {
                            statistics[index]++;
                        }
                    });
                }
                else {
                    values.forEach(function (val, index) {
                        if (rowValue == val) {
                            statistics[index]++;
                        }
                    });
                }
            }
        });
        return [statistics];
    };
    SelectBase.prototype.zipArrays = function (first, second) {
        var zipArray = [];
        for (var i = 0; i < Math.min(first.length, second.length); i++) {
            zipArray[i] = [first[i], second[i]];
        }
        return zipArray;
    };
    SelectBase.prototype.unzipArrays = function (zipArray) {
        var twoArrays = { first: [], second: [] };
        zipArray.forEach(function (value, i) {
            twoArrays.first[i] = value[0];
            twoArrays.second[i] = value[1];
        });
        return twoArrays;
    };
    SelectBase.prototype.sortDictionary = function (keys, values, desc) {
        var dictionary = this.zipArrays(keys, values);
        var comparator = function (a, b, asc) {
            if (asc === void 0) { asc = true; }
            var result = a[1] < b[1] ? 1 : a[1] == b[1] ? 0 : -1;
            return asc ? result : result * -1;
        };
        dictionary.sort(function (a, b) {
            return desc ? comparator(a, b, false) : comparator(a, b);
        });
        var keysAndValues = this.unzipArrays(dictionary);
        return { keys: keysAndValues.first, values: keysAndValues.second };
    };
    return SelectBase;
}(__WEBPACK_IMPORTED_MODULE_2__visualizerBase__["a" /* VisualizerBase */]));



/***/ }),
/* 13 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__config__ = __webpack_require__(7);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Table; });

var Table = /** @class */ (function () {
    function Table(targetNode, survey, data, options, _columns, isTrustedAccess) {
        var _this = this;
        if (_columns === void 0) { _columns = []; }
        if (isTrustedAccess === void 0) { isTrustedAccess = false; }
        this.targetNode = targetNode;
        this.survey = survey;
        this.data = data;
        this.options = options;
        this._columns = _columns;
        this.isTrustedAccess = isTrustedAccess;
        this.buildColumns = function (survey) {
            return _this.survey.getAllQuestions().map(function (question) {
                return {
                    name: question.name,
                    displayName: (question.title || "").trim() || question.name,
                    dataType: question.getType() !== "file"
                        ? __WEBPACK_IMPORTED_MODULE_0__config__["b" /* ColumnDataType */].Text
                        : __WEBPACK_IMPORTED_MODULE_0__config__["b" /* ColumnDataType */].FileLink,
                    visibility: question.getType() !== "file"
                        ? __WEBPACK_IMPORTED_MODULE_0__config__["a" /* ColumnVisibility */].Visible
                        : __WEBPACK_IMPORTED_MODULE_0__config__["a" /* ColumnVisibility */].Invisible,
                    location: __WEBPACK_IMPORTED_MODULE_0__config__["c" /* QuestionLocation */].Column,
                };
            });
        };
        this.isVisible = function (visibility) {
            return ((_this.isTrustedAccess && visibility !== __WEBPACK_IMPORTED_MODULE_0__config__["a" /* ColumnVisibility */].Invisible) ||
                (!_this.isTrustedAccess && visibility === __WEBPACK_IMPORTED_MODULE_0__config__["a" /* ColumnVisibility */].Visible));
        };
        this.getAvailableColumns = function () {
            return _this.columns.filter(function (column) {
                return column.location === __WEBPACK_IMPORTED_MODULE_0__config__["c" /* QuestionLocation */].Column &&
                    _this.isVisible(column.visibility);
            });
        };
        if (_columns.length === 0) {
            this._columns = this.buildColumns(survey);
        }
        this.initTableData(data);
    }
    Object.defineProperty(Table.prototype, "columns", {
        get: function () {
            return [].concat(this._columns);
        },
        enumerable: true,
        configurable: true
    });
    Table.prototype.initTableData = function (data) {
        var _this = this;
        this.tableData = (data || []).map(function (item) {
            var dataItem = {};
            _this.survey.data = item;
            _this._columns.forEach(function (column) {
                var displayValue = item[column.name];
                var question = _this.survey.getQuestionByName(column.name);
                if (question) {
                    displayValue = question.displayValue;
                }
                dataItem[column.name] =
                    typeof displayValue === "string"
                        ? displayValue
                        : JSON.stringify(displayValue) || "";
            });
            return dataItem;
        });
    };
    return Table;
}());



/***/ }),
/* 14 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_14__;

/***/ }),
/* 15 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__localizationManager__ = __webpack_require__(3);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "localization", function() { return __WEBPACK_IMPORTED_MODULE_0__localizationManager__["a"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "surveyStrings", function() { return __WEBPACK_IMPORTED_MODULE_0__localizationManager__["b"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizerBase__ = __webpack_require__(2);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "VisualizerBase", function() { return __WEBPACK_IMPORTED_MODULE_1__visualizerBase__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "VisualizationManager", function() { return __WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__visualizationPanel__ = __webpack_require__(8);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "VisualizationPanel", function() { return __WEBPACK_IMPORTED_MODULE_3__visualizationPanel__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__visualizationPanelDynamic__ = __webpack_require__(9);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "VisualizationPanelDynamic", function() { return __WEBPACK_IMPORTED_MODULE_4__visualizationPanelDynamic__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__visualizationMatrixDynamic__ = __webpack_require__(20);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "VisualizationMatrixDynamic", function() { return __WEBPACK_IMPORTED_MODULE_5__visualizationMatrixDynamic__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__tables_datatables__ = __webpack_require__(17);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "DataTables", function() { return __WEBPACK_IMPORTED_MODULE_6__tables_datatables__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__tables_tabulator__ = __webpack_require__(18);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "Tabulator", function() { return __WEBPACK_IMPORTED_MODULE_7__tables_tabulator__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__plotly_index__ = __webpack_require__(16);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "canLoadPlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["a"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "SelectBasePlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["b"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "GaugePlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["c"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "MatrixPlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["d"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "BooleanPlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["e"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "SelectBaseSortablePlotly", function() { return __WEBPACK_IMPORTED_MODULE_8__plotly_index__["f"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__wordcloud_wordcloud__ = __webpack_require__(21);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "WordCloud", function() { return __WEBPACK_IMPORTED_MODULE_9__wordcloud_wordcloud__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__wordcloud_stopwords_index__ = __webpack_require__(10);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "textHelper", function() { return __WEBPACK_IMPORTED_MODULE_10__wordcloud_stopwords_index__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__text__ = __webpack_require__(19);
/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, "Text", function() { return __WEBPACK_IMPORTED_MODULE_11__text__["a"]; });














/***/ }),
/* 16 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__selectBase__ = __webpack_require__(6);
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_0__selectBase__["a"]; });
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "b", function() { return __WEBPACK_IMPORTED_MODULE_0__selectBase__["b"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__rating__ = __webpack_require__(34);
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "c", function() { return __WEBPACK_IMPORTED_MODULE_1__rating__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__matrix__ = __webpack_require__(33);
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "d", function() { return __WEBPACK_IMPORTED_MODULE_2__matrix__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__boolean__ = __webpack_require__(32);
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "e", function() { return __WEBPACK_IMPORTED_MODULE_3__boolean__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__selectBaseSortable__ = __webpack_require__(35);
/* harmony namespace reexport (by used) */ __webpack_require__.d(__webpack_exports__, "f", function() { return __WEBPACK_IMPORTED_MODULE_4__selectBaseSortable__["a"]; });







/***/ }),
/* 17 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_jquery__ = __webpack_require__(38);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_jquery___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_jquery__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__table__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_survey_core__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_survey_core___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_survey_core__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__config__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__datatables_scss__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__datatables_scss___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6__datatables_scss__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DataTables; });







if (!!document) {
    var svgTemplate = __webpack_require__(11);
    var templateHolder = document.createElement("div");
    templateHolder.style.display = "none";
    templateHolder.innerHTML = svgTemplate;
    document.head.appendChild(templateHolder);
}
var DataTables = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](DataTables, _super);
    function DataTables(targetNode, survey, data, options, _columns, isTrustedAccess) {
        if (_columns === void 0) { _columns = []; }
        if (isTrustedAccess === void 0) { isTrustedAccess = false; }
        var _this = _super.call(this, targetNode, survey, data, options, _columns, isTrustedAccess) || this;
        _this.currentPageNumber = 0;
        /**
         * The event is fired columns configuration has been changed.
         * <br/> sender the datatables adapter
         * <br/> options.survey current survey
         * @see getColumns
         */
        _this.columnsChanged = new __WEBPACK_IMPORTED_MODULE_3_survey_core__["Event"]();
        _this.groupBy = [];
        _this.headerButtonCreators = [];
        _this.detailButtonCreators = [];
        _this.createSelectButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            button.innerHTML = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("selectButton");
            button.onclick = function (e) {
                e.stopPropagation();
                datatableApi.columns().deselect();
                datatableApi.column(colIdx).select();
                !!_this.onColumnSelected && _this.onColumnSelected(columnName);
            };
            return button;
        };
        _this.createGroupingButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            button.innerHTML = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("groupButton");
            button.onclick = function (e) {
                e.stopPropagation();
                var index = _this.groupBy.indexOf(columnName);
                if (index === -1) {
                    _this.groupBy.push(columnName);
                    button.innerHTML = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("ungroupButton");
                }
                else {
                    button.innerHTML = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("groupButton");
                    _this.groupBy.splice(index, 1);
                }
                datatableApi.rowGroup().enable(_this.groupBy.length > 0);
                if (_this.groupBy.length > 0) {
                    datatableApi.rowGroup().dataSrc(_this.groupBy);
                }
                datatableApi.draw(false);
            };
            return button;
        };
        _this.createSvgElement = function (path) {
            var svgElem = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var useElem = document.createElementNS("http://www.w3.org/2000/svg", "use");
            useElem.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#sa-svg-" + path);
            svgElem.appendChild(useElem);
            return svgElem;
        };
        _this.createHideButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            button.title = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("hideColumn");
            button.className = "sa-datatables__svg-button";
            button.appendChild(_this.createSvgElement("hide"));
            button.onclick = function (e) {
                e.stopPropagation();
                _this._columns.filter(function (column) { return column.name === columnName; })[0].visibility = __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].Invisible;
                datatableApi.columns([colIdx]).visible(false);
                // TODO: Use datatables to update headers (show columns options)
                _this.update();
                _this.onColumnsChanged();
            };
            return button;
        };
        _this.createColumnPrivateButton = function (datatableApi, colIdx, columnName) {
            var column = _this._columns.filter(function (column) { return column.name === columnName; })[0];
            var button = document.createElement("button");
            var makePrivateSvg = _this.createSvgElement("makeprivate");
            var makePublicSvg = _this.createSvgElement("makepublic");
            updateState(column.visibility);
            button.appendChild(makePrivateSvg);
            button.appendChild(makePublicSvg);
            button.onclick = function (e) {
                e.stopPropagation();
                if (column.visibility === __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].PublicInvisible) {
                    column.visibility = __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].Visible;
                }
                else {
                    column.visibility = __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].PublicInvisible;
                }
                updateState(column.visibility);
            };
            function updateState(visibility) {
                var isPrivate = visibility === __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].PublicInvisible;
                if (isPrivate) {
                    button.className =
                        "sa-datatables__svg-button sa-datatables__svg-button--active";
                    button.title = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("makePublicColumn");
                    makePrivateSvg.style.display = "block";
                    makePublicSvg.style.display = "none";
                }
                else {
                    button.className = "sa-datatables__svg-button";
                    button.title = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("makePrivateColumn");
                    makePrivateSvg.style.display = "none";
                    makePublicSvg.style.display = "block";
                }
            }
            return button;
        };
        _this.createAddColumnButton = function (datatableApi) {
            var selector = document.createElement("select");
            selector.className = "sa-datatables__add-column";
            selector.onclick = function (e) {
                e.stopPropagation();
            };
            var hiddenColumns = _this.columns.filter(function (column) { return column.visibility === __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].Invisible; });
            if (hiddenColumns.length === 0) {
                return;
            }
            var option = document.createElement("option");
            option.text = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("showColumn");
            option.disabled = true;
            option.selected = true;
            selector.appendChild(option);
            hiddenColumns.forEach(function (column) {
                var option = document.createElement("option");
                var text = column.displayName;
                if (text.length > 20) {
                    text = text.substring(0, 20) + "...";
                }
                option.text = text;
                option.title = column.displayName;
                option.value = column.name;
                selector.appendChild(option);
            });
            var self = _this;
            selector.onchange = function (e) {
                var _this = this;
                e.stopPropagation();
                if (!__WEBPACK_IMPORTED_MODULE_1_jquery__(this).val())
                    return;
                var column = self._columns.filter(function (column) { return column.name === __WEBPACK_IMPORTED_MODULE_1_jquery__(_this).val(); })[0];
                column.visibility = __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].Visible;
                datatableApi.column(column.name + ":name").visible(true);
                // TODO: Use datatables to update headers (show columns options)
                self.update();
                self.onColumnsChanged();
            };
            return selector;
        };
        _this.createDragButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            button.className = "sa-datatables__svg-button sa-datatables__drag-button";
            button.appendChild(_this.createSvgElement("drag"));
            button.onclick = function (e) {
                e.stopPropagation();
            };
            return button;
        };
        _this.createSortButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            var descTitle = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("descOrder");
            var ascTitle = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("ascOrder");
            button.className = "sa-datatables__svg-button";
            button.title = ascTitle;
            button.appendChild(_this.createSvgElement("sorting"));
            button.onclick = function (e) {
                button.title = button.title == ascTitle ? descTitle : ascTitle;
            };
            button.ondrag = function (e) {
                e.stopPropagation;
            };
            return button;
        };
        _this.createMoveToDetailButton = function (datatableApi, colIdx, columnName) {
            var button = document.createElement("button");
            button.title = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("moveToDetail");
            button.className = "sa-datatables__svg-button";
            button.appendChild(_this.createSvgElement("movetodetails"));
            button.onclick = function (e) {
                e.stopPropagation();
                _this._columns.filter(function (column) { return column.name === columnName; })[0].location =
                    __WEBPACK_IMPORTED_MODULE_4__config__["c" /* QuestionLocation */].Row;
                _this.update();
                _this.onColumnsChanged();
            };
            return button;
        };
        _this.createShowAsColumnButton = function (columnName) {
            var button = document.createElement("button");
            button.innerHTML = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("showAsColumn");
            button.className = "sa-datatables__button sa-datatables__button--gray";
            button.onclick = function (e) {
                e.stopPropagation();
                _this._columns.filter(function (column) { return column.name === columnName; })[0].location =
                    __WEBPACK_IMPORTED_MODULE_4__config__["c" /* QuestionLocation */].Column;
                _this.update();
                _this.onColumnsChanged();
            };
            return button;
        };
        targetNode.className += "sa-datatables";
        _this.headerButtonCreators = [
            // this.createGroupingButton,
            _this.createSortButton,
            _this.createHideButton,
            _this.createMoveToDetailButton,
            _this.createDragButton,
        ];
        if (_this.isTrustedAccess) {
            _this.headerButtonCreators.splice(2, 0, _this.createColumnPrivateButton);
        }
        _this.detailButtonCreators = [_this.createShowAsColumnButton];
        if (_columns.length === 0) {
            _this._columns = _this.buildColumns(survey);
        }
        return _this;
    }
    DataTables.prototype.onColumnsChanged = function () {
        this.columnsChanged.fire(this, { survey: this.survey });
    };
    Object.defineProperty(DataTables.prototype, "columns", {
        get: function () {
            return [].concat(this._columns);
        },
        set: function (columns) {
            this._columns = columns;
            this.update(true);
        },
        enumerable: true,
        configurable: true
    });
    DataTables.prototype.update = function (hard) {
        if (hard === void 0) { hard = false; }
        if (this.isRendered) {
            if (hard) {
                this.initTableData(this.data);
            }
            this.currentPageNumber = this.datatableApi.page.info().page;
            this.destroy();
            this.render();
        }
    };
    Object.defineProperty(DataTables.prototype, "isRendered", {
        get: function () {
            return this.targetNode.children.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    DataTables.prototype.destroy = function () {
        //if(!this.targetNode) return;
        var tableNode = this.targetNode.children[0];
        if (__WEBPACK_IMPORTED_MODULE_1_jquery__["fn"].DataTable.isDataTable(tableNode)) {
            __WEBPACK_IMPORTED_MODULE_1_jquery__(tableNode).DataTable().destroy();
        }
        this.datatableApi = undefined;
        this.targetNode.innerHTML = "";
    };
    DataTables.prototype.createActionContainer = function () {
        var container = document.createElement("div");
        container.className = "sa-datatables__action-container";
        return container;
    };
    DataTables.prototype.createMinorColumnsButton = function () {
        var button = document.createElement("button");
        button.title = __WEBPACK_IMPORTED_MODULE_5__localizationManager__["a" /* localization */].getString("showMinorColumns");
        button.className = "sa-datatables__svg-button";
        button.appendChild(this.createSvgElement("detail"));
        return button;
    };
    DataTables.prototype.setMinorColumnsButtonCallback = function (datatableApiRef) {
        var self = this;
        __WEBPACK_IMPORTED_MODULE_1_jquery__(datatableApiRef.table().body()).on("click", "td.sa-datatables__action-column button.sa-datatables__svg-button", function () {
            var detailTr = __WEBPACK_IMPORTED_MODULE_1_jquery__(this).closest("tr");
            var row = datatableApiRef.row(detailTr);
            if (detailTr.hasClass("sa-datatables__detail-row")) {
                detailTr.nextAll("tr.sa-datatables__detail").remove();
                detailTr.removeClass("sa-datatables__detail-row");
            }
            else {
                var data = self.data[row.index()];
                __WEBPACK_IMPORTED_MODULE_1_jquery__(self.createDetailMarkup(data, row)).insertAfter(detailTr);
                detailTr.addClass("sa-datatables__detail-row");
            }
        });
    };
    DataTables.prototype.render = function () {
        var _this = this;
        var self = this;
        var tableNode = document.createElement("table");
        var columns = this.getColumns();
        var columnsData = columns.map(function (c) { return c.data; });
        var dtButtonClass = "sa-datatables__button sa-datatables__button--small sa-datatables__button--gray";
        var options = __WEBPACK_IMPORTED_MODULE_1_jquery__["extend"](true, {
            buttons: [
                { extend: "copy", className: dtButtonClass },
                { extend: "csv", className: dtButtonClass },
                { extend: "print", className: dtButtonClass },
            ],
            dom: "Bfplrtip",
            data: this.tableData,
            pageLength: 5,
            lengthMenu: [1, 5, 10, 25, 50, 75, 100],
            responsive: false,
            scrollX: true,
            columns: columns,
            colReorder: {
                fixedColumnsLeft: 1,
                realtime: false,
            },
            // orderFixed: [[1, "asc"]],
            rowGroup: {
                dataSrc: columnsData[0],
                endRender: function (rows, group) {
                    return "Count: " + rows.data().count();
                },
            },
            language: {
                sSearch: " ",
                searchPlaceholder: "Search...",
                sLengthMenu: "Show _MENU_ entries",
                paginate: {
                    previous: " ",
                    next: " ",
                },
            },
            select: "api",
            headerCallback: function (thead, data, start, end, display) {
                var datatableApi = __WEBPACK_IMPORTED_MODULE_1_jquery__(tableNode).dataTable().api();
                var self = _this;
                __WEBPACK_IMPORTED_MODULE_1_jquery__(thead)
                    .children("th")
                    .each(function (index) {
                    var $thNode = __WEBPACK_IMPORTED_MODULE_1_jquery__(this);
                    if (!!columnsData[index] && $thNode.has("button").length === 0) {
                        var container = self.createActionContainer();
                        self.headerButtonCreators.forEach(function (creator) {
                            var element = creator(datatableApi, index, columnsData[index]);
                            if (!!element) {
                                container.appendChild(element);
                            }
                        });
                        var filterContainer = document.createElement("div");
                        filterContainer.className = "sa-datatables__filter-container";
                        filterContainer.innerHTML =
                            "<input type='text' placeholder='Search...' />";
                        var column = datatableApi.column(index);
                        __WEBPACK_IMPORTED_MODULE_1_jquery__("input", __WEBPACK_IMPORTED_MODULE_1_jquery__(filterContainer)).on("click", function (e) {
                            return e.stopPropagation();
                        });
                        __WEBPACK_IMPORTED_MODULE_1_jquery__("input", __WEBPACK_IMPORTED_MODULE_1_jquery__(filterContainer)).on("keyup change", function () {
                            var value = this.value;
                            if (column.search() !== value) {
                                column.search(value).draw(false);
                            }
                        });
                        $thNode.prepend(filterContainer);
                        $thNode.prepend(container);
                    }
                });
            },
        }, this.options);
        this.targetNode.appendChild(tableNode);
        tableNode.width = "100%";
        tableNode.className = "sa-datatables__table display responsive dataTable";
        var datatableApiRef = (this.datatableApi = __WEBPACK_IMPORTED_MODULE_1_jquery__(tableNode).DataTable(options));
        datatableApiRef.page(self.currentPageNumber);
        this.datatableApi.rowGroup().enable(false).draw(false);
        // this.datatableApi.on("rowgroup-datasrc", (e, dt, val) => {
        //   this.datatableApi.order.fixed({ pre: [[columnsData.indexOf(val), "asc"]] }).draw();
        // });
        var target = __WEBPACK_IMPORTED_MODULE_1_jquery__(this.targetNode).find(".dataTables_filter");
        var button = this.createAddColumnButton(this.datatableApi);
        __WEBPACK_IMPORTED_MODULE_1_jquery__(button).insertAfter(target[0]);
        datatableApiRef.on("column-reorder", function (e, settings, details) {
            var deletedColumns = _this._columns.splice(details.from - 1, 1);
            _this._columns.splice(details.to - 1, 0, deletedColumns[0]);
            var headerCell = __WEBPACK_IMPORTED_MODULE_1_jquery__(datatableApiRef.column(details.to).header());
            _this.setMinorColumnsButtonCallback(datatableApiRef);
            _this.onColumnsChanged();
        });
        this.setMinorColumnsButtonCallback(datatableApiRef);
    };
    DataTables.prototype.createDetailMarkup = function (data, datatablesRow) {
        var _this = this;
        // var table = document.createElement("table");
        // table.cellPadding = "5";
        // table.cellSpacing = "0";
        // table.border = "0";
        // table.className = "sa-datatables__detail";
        var rows = [];
        var self = this;
        var visibleColCount = self.columns.filter(function (column) {
            return column.location === __WEBPACK_IMPORTED_MODULE_4__config__["c" /* QuestionLocation */].Column &&
                _this.isVisible(column.visibility);
        }).length;
        this.columns
            .filter(function (column) {
            return column.location === __WEBPACK_IMPORTED_MODULE_4__config__["c" /* QuestionLocation */].Row &&
                _this.isVisible(column.visibility);
        })
            .forEach(function (column) {
            var row = document.createElement("tr");
            row.className = "sa-datatables__detail";
            var td1 = document.createElement("td");
            td1.textContent = column.displayName;
            td1.colSpan = 2;
            var td2 = document.createElement("td");
            td2.textContent = data[column.name];
            var td3 = document.createElement("td");
            td3.colSpan = Math.max(visibleColCount - 2, 1);
            self.detailButtonCreators.forEach(function (creator) {
                return td3.appendChild(creator(column.name));
            });
            row.appendChild(td1);
            row.appendChild(td2);
            row.appendChild(td3);
            rows.push(row);
        });
        // if (!!this.datatableApi && this.datatableApi.responsive.hasHidden()) {
        //   var columnsVisibility = this.datatableApi.columns().responsiveHidden();
        //   var columns = this.datatableApi.settings().init().columns;
        //   for (var index = 0; index < columnsVisibility.length; index++) {
        //     if (!columnsVisibility[index]) {
        //       var column = columns[index];
        //       var row = document.createElement("tr");
        //       row.className = "sa-datatables__detail";
        //       var td1 = document.createElement("td");
        //       td1.textContent = column.sTitle;
        //       var td2 = document.createElement("td");
        //       td2.textContent = data[column.mData];
        //       var td3 = document.createElement("td");
        //       //this.detailButtonCreators.forEach(creator => td3.appendChild(creator(column.mData)));
        //       row.appendChild(td1);
        //       row.appendChild(td2);
        //       row.appendChild(td3);
        //       rows.push(row);
        //     }
        //   }
        // }
        if (!!this.renderDetailActions) {
            var row = document.createElement("tr");
            row.className = "sa-datatables__detail";
            var td = document.createElement("td");
            td.colSpan = visibleColCount + 1;
            row.appendChild(td);
            // var td1 = document.createElement("td");
            // row.appendChild(td1);
            // var td2 = document.createElement("td");
            // row.appendChild(td2);
            rows.push(row);
            this.renderDetailActions(td, data, datatablesRow);
        }
        return rows;
    };
    DataTables.prototype.doStateSave = function () {
        this.datatableApi.state.save();
    };
    DataTables.prototype.stateSaveCallback = function (settings, data) { };
    DataTables.prototype.getColumns = function () {
        var _this = this;
        var availableColumns = this.getAvailableColumns();
        var columns = availableColumns.map(function (column, index) {
            var question = _this.survey.getQuestionByName(column.name);
            return {
                data: column.name,
                sTitle: (question && question.title) || column.displayName,
                visible: column.visibility !== __WEBPACK_IMPORTED_MODULE_4__config__["a" /* ColumnVisibility */].Invisible,
                mRender: function (data, type, row) {
                    var value = row[column.name];
                    return typeof value === "string"
                        ? __WEBPACK_IMPORTED_MODULE_1_jquery__("<div>").text(value).html()
                        : JSON.stringify(value);
                },
            };
        });
        return [
            {
                className: "sa-datatables__action-column",
                orderable: false,
                data: null,
                defaultContent: this.createMinorColumnsButton().outerHTML,
            },
        ].concat(columns);
    };
    DataTables.prototype.layout = function () {
        !!this.datatableApi && this.datatableApi.columns.adjust();
    };
    return DataTables;
}(__WEBPACK_IMPORTED_MODULE_2__table__["a" /* Table */]));



/***/ }),
/* 18 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__table__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__config__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__tabulator_scss__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__tabulator_scss___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4__tabulator_scss__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Tabulator; });





var TabulatorTables = __webpack_require__(28);
if (!!document) {
    var svgTemplate = __webpack_require__(11);
    var templateHolder = document.createElement("div");
    templateHolder.style.display = "none";
    templateHolder.innerHTML = svgTemplate;
    document.head.appendChild(templateHolder);
}
var Tabulator = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](Tabulator, _super);
    function Tabulator(targetNode, survey, data, options, _columns, isTrustedAccess) {
        if (_columns === void 0) { _columns = []; }
        if (isTrustedAccess === void 0) { isTrustedAccess = false; }
        var _this = _super.call(this, targetNode, survey, data, options, _columns, isTrustedAccess) || this;
        _this.tabulatorTables = null;
        _this.toolsContainer = null;
        _this.tableContainer = null;
        _this.render = function () {
            var columns = _this.getColumns();
            var data = _this.tableData;
            _this.toolsContainer = document.createElement("div");
            _this.tableContainer = document.createElement("div");
            _this.targetNode.innerHTML = "";
            _this.targetNode.appendChild(_this.toolsContainer);
            _this.targetNode.appendChild(_this.tableContainer);
            _this.tabulatorTables = new TabulatorTables(_this.tableContainer, {
                data: data,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 5,
                movableColumns: true,
                columns: columns,
                rowFormatter: _this.rowFormatter,
            });
            _this.renderTools();
        };
        _this.renderTools = function () {
            var toolsContainer = _this.toolsContainer;
            var showColumnDropdown = _this.getShowColumnDropdown();
            toolsContainer.innerHTML = "";
            toolsContainer.appendChild(showColumnDropdown);
        };
        _this.getShowColumnDropdown = function () {
            var dropdown = document.createElement("select");
            var hiddenColumns = _this.columns.filter(function (column) { return column.visibility === __WEBPACK_IMPORTED_MODULE_2__config__["a" /* ColumnVisibility */].Invisible; });
            var option = document.createElement("option");
            option.text = __WEBPACK_IMPORTED_MODULE_3__localizationManager__["a" /* localization */].getString("showColumn");
            option.disabled = true;
            option.selected = true;
            dropdown.appendChild(option);
            hiddenColumns.forEach(function (column) {
                var option = document.createElement("option");
                var text = column.displayName;
                if (text.length > 20) {
                    text = text.substring(0, 20) + "...";
                }
                option.text = text;
                option.title = column.displayName;
                option.value = column.name;
                dropdown.appendChild(option);
            });
            var self = _this;
            dropdown.onchange = function (e) {
                var val = e.target.value;
                e.stopPropagation();
                if (!val)
                    return;
                var column = self._columns.filter(function (column) { return column.name === val; })[0];
                column.visibility = __WEBPACK_IMPORTED_MODULE_2__config__["a" /* ColumnVisibility */].Visible;
                self.tabulatorTables.toggleColumn(column.name);
                self.update();
            };
            return dropdown;
        };
        _this.destroy = function () {
            _this.tabulatorTables.destroy();
            _this.targetNode.innerHTML = "";
        };
        _this.getTitleFormatter = function (cell, formatterParams, onRendered, columnName) {
            //build dropdown
            var hideColumnBtn = document.createElement("button");
            hideColumnBtn.style.display = "block";
            hideColumnBtn.innerHTML = "<span> hide </span>";
            hideColumnBtn.onclick = function () {
                _this._columns.filter(function (column) { return column.name === columnName; })[0].visibility = __WEBPACK_IMPORTED_MODULE_2__config__["a" /* ColumnVisibility */].Invisible;
                _this.tabulatorTables.toggleColumn(columnName);
                _this.update();
            };
            //set header title
            var title = document.createElement("div");
            title.style.height = "50px";
            title.innerHTML = cell.getValue();
            //add menu to title
            title.appendChild(hideColumnBtn);
            return title;
        };
        _this.getColumns = function () {
            var availableColumns = _this.getAvailableColumns();
            var columns = availableColumns.map(function (column, index) {
                var question = _this.survey.getQuestionByName(column.name);
                return {
                    field: column.name,
                    title: (question && question.title) || column.displayName,
                    visible: column.visibility !== __WEBPACK_IMPORTED_MODULE_2__config__["a" /* ColumnVisibility */].Invisible,
                    headerFilter: true,
                    titleFormatter: function (cell, formatterParams, onRendered) {
                        return _this.getTitleFormatter(cell, formatterParams, onRendered, column.name);
                    },
                };
            });
            // add special column (collapse/expand)
            columns.unshift({
                field: "",
                title: "",
            });
            return columns;
        };
        var self = _this;
        targetNode.className += "sa-tabulator";
        if (_columns.length === 0) {
            self._columns = self.buildColumns(survey);
        }
        return _this;
    }
    Tabulator.prototype.update = function () {
        this.renderTools();
    };
    Tabulator.prototype.rowFormatter = function (row) {
        var specialColumnElement = row.getCells()[0].getElement();
        var hidden = document.createElement("div");
        hidden.innerHTML = "<p>hidden info</p>";
        hidden.style.display = "none";
        specialColumnElement.onclick = function () {
            if (hidden.style.display === "none") {
                hidden.style.display = "block";
            }
            else {
                hidden.style.display = "none";
            }
            row.normalizeHeight(); //recalculate the row height
        };
        row.getElement().appendChild(hidden);
    };
    return Tabulator;
}(__WEBPACK_IMPORTED_MODULE_1__table__["a" /* Table */]));



/***/ }),
/* 19 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__text_scss__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__text_scss___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3__text_scss__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Text; });




var Text = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](Text, _super);
    function Text(targetElement, question, data, options) {
        return _super.call(this, targetElement, question, data, options) || this;
    }
    Object.defineProperty(Text.prototype, "name", {
        get: function () {
            return "text";
        },
        enumerable: true,
        configurable: true
    });
    Text.prototype.getData = function () {
        var _this = this;
        var result = [];
        var columnsCount = 0;
        this.data.forEach(function (row) {
            var rowValue = row[_this.question.name];
            var dataStrings = [];
            if (!!rowValue) {
                if (Array.isArray(rowValue)) {
                    dataStrings.concat(rowValue);
                }
                else {
                    if (typeof rowValue === "object") {
                        Object.keys(rowValue).forEach(function (key) { return dataStrings.push(rowValue[key]); });
                    }
                    else {
                        dataStrings.push(rowValue);
                    }
                }
                result.push(dataStrings);
                if (dataStrings.length > columnsCount) {
                    columnsCount = dataStrings.length;
                }
            }
        });
        return { columnsCount: columnsCount, data: result };
    };
    Text.prototype.renderContent = function (container) {
        var _a = this.getData(), columnsCount = _a.columnsCount, data = _a.data;
        var emptyTextNode = document.createElement("p");
        emptyTextNode.innerHTML = "There are no results yet";
        if (data.length === 0) {
            container.appendChild(emptyTextNode);
            return;
        }
        var tableNode = document.createElement("table");
        tableNode.className = "sa-text-table";
        tableNode.style.backgroundColor = this.backgroundColor;
        container.appendChild(tableNode);
        data.forEach(function (rowData) {
            var row = document.createElement("tr");
            for (var i = 0; i < columnsCount; i++) {
                var td = document.createElement("td");
                td.className = "sa-text-table__cell";
                td.textContent = rowData[i];
                row.appendChild(td);
            }
            tableNode.appendChild(row);
        });
        container.className = "sa-text-table__container";
        container.appendChild(tableNode);
    };
    Text.prototype.destroy = function () {
        _super.prototype.destroy.call(this);
        this.targetElement.className = "";
    };
    return Text;
}(__WEBPACK_IMPORTED_MODULE_1__visualizerBase__["a" /* VisualizerBase */]));

__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("text", Text);
__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("comment", Text);
__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("multipletext", Text);


/***/ }),
/* 20 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationPanelDynamic__ = __webpack_require__(9);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VisualizationMatrixDynamic; });



var VisualizationMatrixDynamic = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](VisualizationMatrixDynamic, _super);
    function VisualizationMatrixDynamic(targetElement, question, data, options) {
        return _super.call(this, targetElement, question, data, options) || this;
    }
    VisualizationMatrixDynamic.prototype.getQuestions = function () {
        var matrixdynamic = this.question;
        var visibleRows = matrixdynamic.visibleRows;
        if (visibleRows.length === 0)
            return [];
        return visibleRows[0].cells.map(function (c) { return c.question; });
    };
    return VisualizationMatrixDynamic;
}(__WEBPACK_IMPORTED_MODULE_2__visualizationPanelDynamic__["a" /* VisualizationPanelDynamic */]));

__WEBPACK_IMPORTED_MODULE_1__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("matrixdynamic", VisualizationMatrixDynamic);
__WEBPACK_IMPORTED_MODULE_1__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("matrixdropdown", VisualizationMatrixDynamic);


/***/ }),
/* 21 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_wordcloud__ = __webpack_require__(37);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_wordcloud___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_wordcloud__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__stopwords_index__ = __webpack_require__(10);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return WordCloud; });





var WordCloud = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](WordCloud, _super);
    function WordCloud(targetElement, question, data, options) {
        return _super.call(this, targetElement, question, data, options) || this;
    }
    Object.defineProperty(WordCloud.prototype, "name", {
        get: function () {
            return "wordcloud";
        },
        enumerable: true,
        configurable: true
    });
    WordCloud.prototype.getData = function () {
        var _this = this;
        var result = {};
        var stopWords = __WEBPACK_IMPORTED_MODULE_4__stopwords_index__["a" /* textHelper */].getStopWords();
        var stopTheWord = function (word) {
            if (stopWords.indexOf(word) !== -1) {
                return "";
            }
            return word;
        };
        var processString = function (row) {
            row = "" + row;
            if (!!row) {
                row.split(" ").forEach(function (word) {
                    word = stopTheWord(word.toLowerCase() || "");
                    if (!!word) {
                        if (!result[word]) {
                            result[word] = 1;
                        }
                        else {
                            result[word]++;
                        }
                    }
                });
            }
        };
        this.data.forEach(function (row) {
            var rowValue = row[_this.question.name];
            if (!!rowValue) {
                if (Array.isArray(rowValue)) {
                    rowValue.forEach(processString);
                }
                else {
                    if (typeof rowValue === "object") {
                        Object.keys(rowValue).forEach(function (key) { return processString(rowValue[key]); });
                    }
                    else {
                        processString(rowValue);
                    }
                }
            }
        });
        return Object.keys(result).map(function (key) {
            return [key, result[key]];
        });
    };
    WordCloud.prototype.renderContent = function (container) {
        var _this = this;
        var data = this.getData();
        var colors = this.getColors();
        var canvasNode = document.createElement("canvas");
        var emptyTextNode = document.createElement("p");
        emptyTextNode.innerHTML = "There are no results yet";
        if (data.length === 0) {
            container.appendChild(emptyTextNode);
            return;
        }
        container.appendChild(canvasNode);
        var config = {
            list: data,
            weightFactor: 20,
            fontFamily: "Segoe UI Bold, sans-serif",
            color: function (word, weight) {
                return _this.getRandomColor();
            },
            rotateRatio: 0.5,
            rotationSteps: 2,
            backgroundColor: this.backgroundColor,
            click: function (item) {
                console.log(item[0] + ": " + item[1]);
            }
        };
        this.cloud = __WEBPACK_IMPORTED_MODULE_1_wordcloud___default()(canvasNode, config);
    };
    WordCloud.prototype.destroy = function () {
        _super.prototype.destroy.call(this);
        if (!!this.cloud) {
            this.cloud = undefined;
        }
    };
    return WordCloud;
}(__WEBPACK_IMPORTED_MODULE_2__visualizerBase__["a" /* VisualizerBase */]));

__WEBPACK_IMPORTED_MODULE_3__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("text", WordCloud);
__WEBPACK_IMPORTED_MODULE_3__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("comment", WordCloud);
__WEBPACK_IMPORTED_MODULE_3__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("multipletext", WordCloud);


/***/ }),
/* 22 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 23 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 24 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 25 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 26 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

/**
* Muuri v0.8.0
* https://github.com/haltu/muuri
* Copyright (c) 2015-present, Haltu Oy
* Released under the MIT license
* https://github.com/haltu/muuri/blob/master/LICENSE.md
* @license MIT
*
* Muuri Packer
* Copyright (c) 2016-present, Niklas RÃ¤mÃ¶ <inramo@gmail.com>
* @license MIT
*
* Muuri Ticker / Muuri Emitter / Muuri Queue
* Copyright (c) 2018-present, Niklas RÃ¤mÃ¶ <inramo@gmail.com>
* @license MIT
*/

(function (global, factory) {
   true ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.Muuri = factory());
}(this, function () { 'use strict';

  var namespace = 'Muuri';
  var gridInstances = {};

  var actionSwap = 'swap';
  var actionMove = 'move';

  var eventSynchronize = 'synchronize';
  var eventLayoutStart = 'layoutStart';
  var eventLayoutEnd = 'layoutEnd';
  var eventAdd = 'add';
  var eventRemove = 'remove';
  var eventShowStart = 'showStart';
  var eventShowEnd = 'showEnd';
  var eventHideStart = 'hideStart';
  var eventHideEnd = 'hideEnd';
  var eventFilter = 'filter';
  var eventSort = 'sort';
  var eventMove = 'move';
  var eventSend = 'send';
  var eventBeforeSend = 'beforeSend';
  var eventReceive = 'receive';
  var eventBeforeReceive = 'beforeReceive';
  var eventDragInit = 'dragInit';
  var eventDragStart = 'dragStart';
  var eventDragMove = 'dragMove';
  var eventDragScroll = 'dragScroll';
  var eventDragEnd = 'dragEnd';
  var eventDragReleaseStart = 'dragReleaseStart';
  var eventDragReleaseEnd = 'dragReleaseEnd';
  var eventDestroy = 'destroy';

  /**
   * Event emitter constructor.
   *
   * @class
   */
  function Emitter() {
    this._events = {};
    this._queue = [];
    this._counter = 0;
    this._isDestroyed = false;
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Bind an event listener.
   *
   * @public
   * @memberof Emitter.prototype
   * @param {String} event
   * @param {Function} listener
   * @returns {Emitter}
   */
  Emitter.prototype.on = function(event, listener) {
    if (this._isDestroyed) return this;

    // Get listeners queue and create it if it does not exist.
    var listeners = this._events[event];
    if (!listeners) listeners = this._events[event] = [];

    // Add the listener to the queue.
    listeners.push(listener);

    return this;
  };

  /**
   * Unbind all event listeners that match the provided listener function.
   *
   * @public
   * @memberof Emitter.prototype
   * @param {String} event
   * @param {Function} [listener]
   * @returns {Emitter}
   */
  Emitter.prototype.off = function(event, listener) {
    if (this._isDestroyed) return this;

    // Get listeners and return immediately if none is found.
    var listeners = this._events[event];
    if (!listeners || !listeners.length) return this;

    // If no specific listener is provided remove all listeners.
    if (!listener) {
      listeners.length = 0;
      return this;
    }

    // Remove all matching listeners.
    var i = listeners.length;
    while (i--) {
      if (listener === listeners[i]) listeners.splice(i, 1);
    }

    return this;
  };

  /**
   * Emit all listeners in a specified event with the provided arguments.
   *
   * @public
   * @memberof Emitter.prototype
   * @param {String} event
   * @param {*} [arg1]
   * @param {*} [arg2]
   * @param {*} [arg3]
   * @returns {Emitter}
   */
  Emitter.prototype.emit = function(event, arg1, arg2, arg3) {
    if (this._isDestroyed) return this;

    // Get event listeners and quit early if there's no listeners.
    var listeners = this._events[event];
    if (!listeners || !listeners.length) return this;

    var queue = this._queue;
    var qLength = queue.length;
    var aLength = arguments.length - 1;
    var i;

    // Add the current listeners to the callback queue before we process them.
    // This is necessary to guarantee that all of the listeners are called in
    // correct order even if new event listeners are removed/added during
    // processing and/or events are emitted during processing.
    for (i = 0; i < listeners.length; i++) {
      queue.push(listeners[i]);
    }

    // Increment queue counter. This is needed for the scenarios where emit is
    // triggered while the queue is already processing. We need to keep track of
    // how many "queue processors" there are active so that we can safely reset
    // the queue in the end when the last queue processor is finished.
    ++this._counter;

    // Process the queue (the specific part of it for this emit).
    for (i = qLength, qLength = queue.length; i < qLength; i++) {
      // prettier-ignore
      aLength === 0 ? queue[i]() :
      aLength === 1 ? queue[i](arg1) :
      aLength === 2 ? queue[i](arg1, arg2) :
                      queue[i](arg1, arg2, arg3);

      // Stop processing if the emitter is destroyed.
      if (this._isDestroyed) return this;
    }

    // Decrement queue process counter.
    --this._counter;

    // Reset the queue if there are no more queue processes running.
    if (!this._counter) queue.length = 0;

    return this;
  };

  /**
   * Destroy emitter instance. Basically just removes all bound listeners.
   *
   * @public
   * @memberof Emitter.prototype
   * @returns {Emitter}
   */
  Emitter.prototype.destroy = function() {
    if (this._isDestroyed) return this;

    var events = this._events;
    var event;

    // Flag as destroyed.
    this._isDestroyed = true;

    // Reset queue (if queue is currently processing this will also stop that).
    this._queue.length = this._counter = 0;

    // Remove all listeners.
    for (event in events) {
      if (events[event]) {
        events[event].length = 0;
        events[event] = undefined;
      }
    }

    return this;
  };

  // Set up the default export values.
  var transformStyle = 'transform';
  var transformProp = 'transform';

  // Find the supported transform prop and style names.
  var docElemStyle = window.document.documentElement.style;
  var style = 'transform';
  var styleCap = 'Transform';
  var found = false;
  ['', 'Webkit', 'Moz', 'O', 'ms'].forEach(function(prefix) {
    if (found) return;
    var propName = prefix ? prefix + styleCap : style;
    if (docElemStyle[propName] !== undefined) {
      prefix = prefix.toLowerCase();
      transformStyle = prefix ? '-' + prefix + '-' + style : style;
      transformProp = propName;
      found = true;
    }
  });

  var stylesCache = typeof WeakMap === 'function' ? new WeakMap() : null;

  /**
   * Returns the computed value of an element's style property as a string.
   *
   * @param {HTMLElement} element
   * @param {String} style
   * @returns {String}
   */
  function getStyle(element, style) {
    var styles = stylesCache && stylesCache.get(element);
    if (!styles) {
      styles = window.getComputedStyle(element, null);
      if (stylesCache) stylesCache.set(element, styles);
    }
    return styles.getPropertyValue(style === 'transform' ? transformStyle : style);
  }

  var styleNameRegEx = /([A-Z])/g;

  /**
   * Transforms a camel case style property to kebab case style property.
   *
   * @param {String} string
   * @returns {String}
   */
  function getStyleName(string) {
    return string.replace(styleNameRegEx, '-$1').toLowerCase();
  }

  var strFunction = 'function';

  /**
   * Check if a value is a function.
   *
   * @param {*} val
   * @returns {Boolean}
   */
  function isFunction(val) {
    return typeof val === strFunction;
  }

  var transformStyle$1 = 'transform';

  /**
   * Set inline styles to an element.
   *
   * @param {HTMLElement} element
   * @param {Object} styles
   */
  function setStyles(element, styles) {
    for (var prop in styles) {
      element.style[prop === transformStyle$1 ? transformProp : prop] = styles[prop];
    }
  }

  /**
   * Item animation handler powered by Web Animations API.
   *
   * @class
   * @param {HTMLElement} element
   */
  function ItemAnimate(element) {
    this._element = element;
    this._animation = null;
    this._callback = null;
    this._props = [];
    this._values = [];
    this._keyframes = [];
    this._options = {};
    this._isDestroyed = false;
    this._onFinish = this._onFinish.bind(this);
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Start instance's animation. Automatically stops current animation if it is
   * running.
   *
   * @public
   * @memberof ItemAnimate.prototype
   * @param {Object} propsFrom
   * @param {Object} propsTo
   * @param {Object} [options]
   * @param {Number} [options.duration=300]
   * @param {String} [options.easing='ease']
   * @param {Function} [options.onFinish]
   */
  ItemAnimate.prototype.start = function(propsFrom, propsTo, options) {
    if (this._isDestroyed) return;

    var animation = this._animation;
    var currentProps = this._props;
    var currentValues = this._values;
    var opts = options || 0;
    var cancelAnimation = false;

    // If we have an existing animation running, let's check if it needs to be
    // cancelled or if it can continue running.
    if (animation) {
      var propCount = 0;
      var propIndex;

      // Check if the requested animation target props and values match with the
      // current props and values.
      for (var propName in propsTo) {
        ++propCount;
        propIndex = currentProps.indexOf(propName);
        if (propIndex === -1 || propsTo[propName] !== currentValues[propIndex]) {
          cancelAnimation = true;
          break;
        }
      }

      // Check if the target props count matches current props count. This is
      // needed for the edge case scenario where target props contain the same
      // styles as current props, but the current props have some additional
      // props.
      if (!cancelAnimation && propCount !== currentProps.length) {
        cancelAnimation = true;
      }
    }

    // Cancel animation (if required).
    if (cancelAnimation) animation.cancel();

    // Store animation callback.
    this._callback = isFunction(opts.onFinish) ? opts.onFinish : null;

    // If we have a running animation that does not need to be cancelled, let's
    // call it a day here and let it run.
    if (animation && !cancelAnimation) return;

    // Store target props and values to instance.
    currentProps.length = currentValues.length = 0;
    for (propName in propsTo) {
      currentProps.push(propName);
      currentValues.push(propsTo[propName]);
    }

    // Set up keyframes.
    var animKeyframes = this._keyframes;
    animKeyframes[0] = propsFrom;
    animKeyframes[1] = propsTo;

    // Set up options.
    var animOptions = this._options;
    animOptions.duration = opts.duration || 300;
    animOptions.easing = opts.easing || 'ease';

    // Start the animation
    var element = this._element;
    animation = element.animate(animKeyframes, animOptions);
    animation.onfinish = this._onFinish;
    this._animation = animation;

    // Set the end styles. This makes sure that the element stays at the end
    // values after animation is finished.
    setStyles(element, propsTo);
  };

  /**
   * Stop instance's current animation if running.
   *
   * @public
   * @memberof ItemAnimate.prototype
   * @param {Object} [styles]
   */
  ItemAnimate.prototype.stop = function(styles) {
    if (this._isDestroyed || !this._animation) return;

    var element = this._element;
    var currentProps = this._props;
    var currentValues = this._values;
    var propName;
    var propValue;
    var i;

    // Calculate (if not provided) and set styles.
    if (!styles) {
      for (i = 0; i < currentProps.length; i++) {
        propName = currentProps[i];
        propValue = getStyle(element, getStyleName(propName));
        element.style[propName === 'transform' ? transformProp : propName] = propValue;
      }
    } else {
      setStyles(element, styles);
    }

    //  Cancel animation.
    this._animation.cancel();
    this._animation = this._callback = null;

    // Reset current props and values.
    currentProps.length = currentValues.length = 0;
  };

  /**
   * Check if the item is being animated currently.
   *
   * @public
   * @memberof ItemAnimate.prototype
   * @return {Boolean}
   */
  ItemAnimate.prototype.isAnimating = function() {
    return !!this._animation;
  };

  /**
   * Destroy the instance and stop current animation if it is running.
   *
   * @public
   * @memberof ItemAnimate.prototype
   */
  ItemAnimate.prototype.destroy = function() {
    if (this._isDestroyed) return;
    this.stop();
    this._element = this._options = this._keyframes = null;
    this._isDestroyed = true;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Animation end handler.
   *
   * @private
   * @memberof ItemAnimate.prototype
   */
  ItemAnimate.prototype._onFinish = function() {
    var callback = this._callback;
    this._animation = this._callback = null;
    this._props.length = this._values.length = 0;
    callback && callback();
  };

  var vendorPrefixes = ['', 'webkit', 'moz', 'ms', 'o', 'Webkit', 'Moz', 'MS', 'O'];

  /**
   * Get prefixed CSS property name when given a non-prefixed CSS property name.
   * @param {Object} elemStyle
   * @param {String} propName
   * @returns {!String}
   */
  function getPrefixedPropName(elemStyle, propName) {
    var camelPropName = propName[0].toUpperCase() + propName.slice(1);
    var i = 0;
    var prefix;
    var prefixedPropName;

    while (i < vendorPrefixes.length) {
      prefix = vendorPrefixes[i];
      prefixedPropName = prefix ? prefix + camelPropName : propName;
      if (prefixedPropName in elemStyle) return prefixedPropName;
      ++i;
    }

    return null;
  }

  var dt = 1000 / 60;

  var raf = (
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function(callback) {
      return this.setTimeout(function() {
        callback(dt);
      }, dt);
    }
  ).bind(window);

  // Detect support for passive events:
  // https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md#feature-detection
  var isPassiveEventsSupported = false;
  try {
    var passiveOpts = Object.defineProperty({}, 'passive', {
      get: function() {
        isPassiveEventsSupported = true;
      }
    });
    window.addEventListener('testPassive', null, passiveOpts);
    window.removeEventListener('testPassive', null, passiveOpts);
  } catch (e) {}

  // Dragger events.
  var events = {
    start: 'start',
    move: 'move',
    end: 'end',
    cancel: 'cancel'
  };

  var hasTouchEvents = !!('ontouchstart' in window || window.TouchEvent);
  var hasPointerEvents = !!window.PointerEvent;
  var hasMsPointerEvents = !!window.navigator.msPointerEnabled;
  var isAndroid = /(android)/i.test(window.navigator.userAgent);
  var listenerOptions = isPassiveEventsSupported ? { passive: true } : false;

  var taProp = 'touchAction';
  var taPropPrefixed = getPrefixedPropName(window.document.documentElement.style, taProp);
  var taDefaultValue = 'auto';

  /**
   * Creates a new Dragger instance for an element.
   *
   * @public
   * @class
   * @param {HTMLElement} element
   * @param {Object} [cssProps]
   */
  function Dragger(element, cssProps) {
    this._element = element;
    this._emitter = new Emitter();
    this._isDestroyed = false;
    this._cssProps = {};
    this._touchAction = '';
    this._startEvent = null;

    this._pointerId = null;
    this._startTime = 0;
    this._startX = 0;
    this._startY = 0;
    this._currentX = 0;
    this._currentY = 0;

    this._preStartCheck = this._preStartCheck.bind(this);
    this._abortNonCancelable = this._abortNonCancelable.bind(this);
    this._onStart = this._onStart.bind(this);
    this._onMove = this._onMove.bind(this);
    this._onCancel = this._onCancel.bind(this);
    this._onEnd = this._onEnd.bind(this);

    // Apply initial css props.
    this.setCssProps(cssProps);

    // If touch action was not provided with initial css props let's assume it's
    // auto.
    if (!this._touchAction) {
      this.setTouchAction(taDefaultValue);
    }

    // Prevent native link/image dragging for the item and it's ancestors.
    element.addEventListener('dragstart', Dragger._preventDefault, false);

    // Listen to start event.
    element.addEventListener(Dragger._events.start, this._preStartCheck, listenerOptions);

    // If we have touch events, but no pointer events we need to also listen for
    // mouse events in addition to touch events for devices which support both
    // mouse and touch interaction.
    if (hasTouchEvents && !hasPointerEvents && !hasMsPointerEvents) {
      element.addEventListener(Dragger._mouseEvents.start, this._preStartCheck, listenerOptions);
    }
  }

  /**
   * Protected properties
   * ********************
   */

  Dragger._pointerEvents = {
    start: 'pointerdown',
    move: 'pointermove',
    cancel: 'pointercancel',
    end: 'pointerup'
  };

  Dragger._msPointerEvents = {
    start: 'MSPointerDown',
    move: 'MSPointerMove',
    cancel: 'MSPointerCancel',
    end: 'MSPointerUp'
  };

  Dragger._touchEvents = {
    start: 'touchstart',
    move: 'touchmove',
    cancel: 'touchcancel',
    end: 'touchend'
  };

  Dragger._mouseEvents = {
    start: 'mousedown',
    move: 'mousemove',
    cancel: '',
    end: 'mouseup'
  };

  Dragger._events = (function() {
    if (hasPointerEvents) return Dragger._pointerEvents;
    if (hasMsPointerEvents) return Dragger._msPointerEvents;
    if (hasTouchEvents) return Dragger._touchEvents;
    return Dragger._mouseEvents;
  })();

  Dragger._emitter = new Emitter();

  Dragger._activeInstances = [];

  /**
   * Protected static methods
   * ************************
   */

  Dragger._preventDefault = function(e) {
    if (e.preventDefault && e.cancelable !== false) e.preventDefault();
  };

  Dragger._activateInstance = function(instance) {
    var index = Dragger._activeInstances.indexOf(instance);
    if (index > -1) return;

    Dragger._activeInstances.push(instance);
    Dragger._emitter.on(events.move, instance._onMove);
    Dragger._emitter.on(events.cancel, instance._onCancel);
    Dragger._emitter.on(events.end, instance._onEnd);

    if (Dragger._activeInstances.length === 1) {
      Dragger._bindListeners();
    }
  };

  Dragger._deactivateInstance = function(instance) {
    var index = Dragger._activeInstances.indexOf(instance);
    if (index === -1) return;

    Dragger._activeInstances.splice(index, 1);
    Dragger._emitter.off(events.move, instance._onMove);
    Dragger._emitter.off(events.cancel, instance._onCancel);
    Dragger._emitter.off(events.end, instance._onEnd);

    if (!Dragger._activeInstances.length) {
      Dragger._unbindListeners();
    }
  };

  Dragger._bindListeners = function() {
    var events = Dragger._events;
    window.addEventListener(events.move, Dragger._onMove, listenerOptions);
    window.addEventListener(events.end, Dragger._onEnd, listenerOptions);
    events.cancel && window.addEventListener(events.cancel, Dragger._onCancel, listenerOptions);
  };

  Dragger._unbindListeners = function() {
    var events = Dragger._events;
    window.removeEventListener(events.move, Dragger._onMove, listenerOptions);
    window.removeEventListener(events.end, Dragger._onEnd, listenerOptions);
    events.cancel && window.removeEventListener(events.cancel, Dragger._onCancel, listenerOptions);
  };

  Dragger._getEventPointerId = function(event) {
    // If we have pointer id available let's use it.
    if (typeof event.pointerId === 'number') {
      return event.pointerId;
    }

    // For touch events let's get the first changed touch's identifier.
    if (event.changedTouches) {
      return event.changedTouches[0] ? event.changedTouches[0].identifier : null;
    }

    // For mouse/other events let's provide a static id.
    return 1;
  };

  Dragger._getTouchById = function(event, id) {
    // If we have a pointer event return the whole event if there's a match, and
    // null otherwise.
    if (typeof event.pointerId === 'number') {
      return event.pointerId === id ? event : null;
    }

    // For touch events let's check if there's a changed touch object that matches
    // the pointerId in which case return the touch object.
    if (event.changedTouches) {
      for (var i = 0; i < event.changedTouches.length; i++) {
        if (event.changedTouches[i].identifier === id) {
          return event.changedTouches[i];
        }
      }
      return null;
    }

    // For mouse/other events let's assume there's only one pointer and just
    // return the event.
    return event;
  };

  Dragger._onMove = function(e) {
    Dragger._emitter.emit(events.move, e);
  };

  Dragger._onCancel = function(e) {
    Dragger._emitter.emit(events.cancel, e);
  };

  Dragger._onEnd = function(e) {
    Dragger._emitter.emit(events.end, e);
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Reset current drag operation (if any).
   *
   * @private
   * @memberof Dragger.prototype
   */
  Dragger.prototype._reset = function() {
    if (this._isDestroyed) return;

    this._pointerId = null;
    this._startTime = 0;
    this._startX = 0;
    this._startY = 0;
    this._currentX = 0;
    this._currentY = 0;
    this._startEvent = null;

    this._element.removeEventListener(
      Dragger._touchEvents.start,
      this._abortNonCancelable,
      listenerOptions
    );

    Dragger._deactivateInstance(this);
  };

  /**
   * Create a custom dragger event from a raw event.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {String} type
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   * @returns {DraggerEvent}
   */
  Dragger.prototype._createEvent = function(type, e) {
    var touch = this._getTrackedTouch(e);
    return {
      // Hammer.js compatibility interface.
      type: type,
      srcEvent: e,
      distance: this.getDistance(),
      deltaX: this.getDeltaX(),
      deltaY: this.getDeltaY(),
      deltaTime: type === events.start ? 0 : this.getDeltaTime(),
      isFirst: type === events.start,
      isFinal: type === events.end || type === events.cancel,
      // Partial Touch API interface.
      identifier: this._pointerId,
      screenX: touch.screenX,
      screenY: touch.screenY,
      clientX: touch.clientX,
      clientY: touch.clientY,
      pageX: touch.pageX,
      pageY: touch.pageY,
      target: touch.target
    };
  };

  /**
   * Emit a raw event as dragger event internally.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {String} type
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._emit = function(type, e) {
    this._emitter.emit(type, this._createEvent(type, e));
  };

  /**
   * If the provided event is a PointerEvent this method will return it if it has
   * the same pointerId as the instance. If the provided event is a TouchEvent
   * this method will try to look for a Touch instance in the changedTouches that
   * has an identifier matching this instance's pointerId. If the provided event
   * is a MouseEvent (or just any other event than PointerEvent or TouchEvent)
   * it will be returned immediately.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)}
   * @returns {?(Touch|PointerEvent|MouseEvent)}
   */
  Dragger.prototype._getTrackedTouch = function(e) {
    if (this._pointerId === null) {
      return null;
    } else {
      return Dragger._getTouchById(e, this._pointerId);
    }
  };

  /**
   * A pre-handler for start event that checks if we can start dragging.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._preStartCheck = function(e) {
    if (this._isDestroyed) return;

    // Make sure the element is not being dragged currently.
    if (this.isDragging()) return;

    // Special cancelable check for Android to prevent drag procedure from
    // starting if native scrolling is in progress. Part 1.
    if (isAndroid && e.cancelable === false) return;

    // Make sure left button is pressed on mouse.
    if (e.button) return;

    // Get (and set) pointer id.
    this._pointerId = Dragger._getEventPointerId(e);
    if (this._pointerId === null) return;

    // Store the start event and trigger start (async or sync). Pointer events
    // are emitted before touch events if the browser supports both of them. And
    // if you try to move an element before `touchstart` is emitted the pointer
    // events for that element will be canceled. The fix is to delay the emitted
    // pointer events in such a scenario by one frame so that `touchstart` has
    // time to be emitted before the element is (potentially) moved.
    this._startEvent = e;
    if (hasTouchEvents && (hasPointerEvents || hasMsPointerEvents)) {
      // Special cancelable check for Android to prevent drag procedure from
      // starting if native scrolling is in progress. Part 2.
      if (isAndroid) {
        this._element.addEventListener(
          Dragger._touchEvents.start,
          this._abortNonCancelable,
          listenerOptions
        );
      }
      raf(this._onStart);
    } else {
      this._onStart();
    }
  };

  /**
   * Abort start event if it turns out to be non-cancelable.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._abortNonCancelable = function(e) {
    this._element.removeEventListener(
      Dragger._touchEvents.start,
      this._abortNonCancelable,
      listenerOptions
    );

    if (this._startEvent && e.cancelable === false) {
      this._pointerId = null;
      this._startEvent = null;
    }
  };

  /**
   * Start the drag procedure if possible.
   *
   * @private
   * @memberof Dragger.prototype
   */
  Dragger.prototype._onStart = function() {
    var e = this._startEvent;
    if (!e) return;

    this._startEvent = null;

    var touch = this._getTrackedTouch(e);
    if (!touch) return;

    // Set up init data and emit start event.
    this._startX = this._currentX = touch.clientX;
    this._startY = this._currentY = touch.clientY;
    this._startTime = Date.now();
    this._emit(events.start, e);
    Dragger._activateInstance(this);
  };

  /**
   * Handler for move event.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._onMove = function(e) {
    var touch = this._getTrackedTouch(e);
    if (!touch) return;

    this._currentX = touch.clientX;
    this._currentY = touch.clientY;
    this._emit(events.move, e);
  };

  /**
   * Handler for move cancel event.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._onCancel = function(e) {
    if (!this._getTrackedTouch(e)) return;

    this._emit(events.cancel, e);
    this._reset();
  };

  /**
   * Handler for end event.
   *
   * @private
   * @memberof Dragger.prototype
   * @param {(PointerEvent|TouchEvent|MouseEvent)} e
   */
  Dragger.prototype._onEnd = function(e) {
    if (!this._getTrackedTouch(e)) return;

    this._emit(events.end, e);
    this._reset();
  };

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Check if the element is being dragged at the moment.
   *
   * @public
   * @memberof Dragger.prototype
   * @returns {Boolean}
   */
  Dragger.prototype.isDragging = function() {
    return this._pointerId !== null;
  };

  /**
   * Set element's touch-action CSS property.
   *
   * @public
   * @memberof Dragger.prototype
   * @param {String} value
   */
  Dragger.prototype.setTouchAction = function(value) {
    // Store unmodified touch action value (we trust user input here).
    this._touchAction = value;

    // Set touch-action style.
    if (taPropPrefixed) {
      this._cssProps[taPropPrefixed] = '';
      this._element.style[taPropPrefixed] = value;
    }

    // If we have an unsupported touch-action value let's add a special listener
    // that prevents default action on touch start event. A dirty hack, but best
    // we can do for now. The other options would be to somehow polyfill the
    // unsupported touch action behavior with custom heuristics which sounds like
    // a can of worms.
    if (hasTouchEvents) {
      this._element.removeEventListener(Dragger._touchEvents.start, Dragger._preventDefault, false);
      if (this._element.style[taPropPrefixed] !== value) {
        this._element.addEventListener(Dragger._touchEvents.start, Dragger._preventDefault, false);
      }
    }
  };

  /**
   * Update element's CSS properties. Accepts an object with camel cased style
   * props with value pairs as it's first argument.
   *
   * @public
   * @memberof Dragger.prototype
   * @param {Object} [newProps]
   */
  Dragger.prototype.setCssProps = function(newProps) {
    if (!newProps) return;

    var currentProps = this._cssProps;
    var element = this._element;
    var prop;
    var prefixedProp;

    // Reset current props.
    for (prop in currentProps) {
      element.style[prop] = currentProps[prop];
      delete currentProps[prop];
    }

    // Set new props.
    for (prop in newProps) {
      // Make sure we have a value for the prop.
      if (!newProps[prop]) continue;

      // Special handling for touch-action.
      if (prop === taProp) {
        this.setTouchAction(newProps[prop]);
        continue;
      }

      // Get prefixed prop and skip if it does not exist.
      prefixedProp = getPrefixedPropName(element.style, prop);
      if (!prefixedProp) continue;

      // Store the prop and add the style.
      currentProps[prefixedProp] = '';
      element.style[prefixedProp] = newProps[prop];
    }
  };

  /**
   * How much the pointer has moved on x-axis from start position, in pixels.
   * Positive value indicates movement from left to right.
   *
   * @public
   * @memberof Dragger.prototype
   * @returns {Number}
   */
  Dragger.prototype.getDeltaX = function() {
    return this._currentX - this._startX;
  };

  /**
   * How much the pointer has moved on y-axis from start position, in pixels.
   * Positive value indicates movement from top to bottom.
   *
   * @public
   * @memberof Dragger.prototype
   * @returns {Number}
   */
  Dragger.prototype.getDeltaY = function() {
    return this._currentY - this._startY;
  };

  /**
   * How far (in pixels) has pointer moved from start position.
   *
   * @public
   * @memberof Dragger.prototype
   * @returns {Number}
   */
  Dragger.prototype.getDistance = function() {
    var x = this.getDeltaX();
    var y = this.getDeltaY();
    return Math.sqrt(x * x + y * y);
  };

  /**
   * How long has pointer been dragged.
   *
   * @public
   * @memberof Dragger.prototype
   * @returns {Number}
   */
  Dragger.prototype.getDeltaTime = function() {
    return this._startTime ? Date.now() - this._startTime : 0;
  };

  /**
   * Bind drag event listeners.
   *
   * @public
   * @memberof Dragger.prototype
   * @param {String} eventName
   *   - 'start', 'move', 'cancel' or 'end'.
   * @param {Function} listener
   */
  Dragger.prototype.on = function(eventName, listener) {
    this._emitter.on(eventName, listener);
  };

  /**
   * Unbind drag event listeners.
   *
   * @public
   * @memberof Dragger.prototype
   * @param {String} eventName
   *   - 'start', 'move', 'cancel' or 'end'.
   * @param {Function} listener
   */
  Dragger.prototype.off = function(events, listener) {
    this._emitter.off(eventName, listener);
  };

  /**
   * Destroy the instance and unbind all drag event listeners.
   *
   * @public
   * @memberof Dragger.prototype
   */
  Dragger.prototype.destroy = function() {
    if (this._isDestroyed) return;

    var element = this._element;
    var events = Dragger._events;

    // Reset data and deactivate the instance.
    this._reset();

    // Destroy emitter.
    this._emitter.destroy();

    // Unbind event handlers.
    element.removeEventListener(events.start, this._preStartCheck, listenerOptions);
    element.removeEventListener(Dragger._mouseEvents.start, this._preStartCheck, listenerOptions);
    element.removeEventListener('dragstart', Dragger._preventDefault, false);
    element.removeEventListener(Dragger._touchEvents.start, Dragger._preventDefault, false);

    // Reset styles.
    for (var prop in this._cssProps) {
      element.style[prop] = this._cssProps[prop];
      delete this._cssProps[prop];
    }

    // Reset data.
    this._element = null;

    // Mark as destroyed.
    this._isDestroyed = true;
  };

  /**
   * A ticker system for handling DOM reads and writes in an efficient way.
   * Contains a read queue and a write queue that are processed on the next
   * animation frame when needed.
   *
   * @class
   */
  function Ticker() {
    this._nextStep = null;

    this._queue = [];
    this._reads = {};
    this._writes = {};

    this._batch = [];
    this._batchReads = {};
    this._batchWrites = {};

    this._step = this._step.bind(this);
  }

  Ticker.prototype.add = function(id, readOperation, writeOperation, isPrioritized) {
    // First, let's check if an item has been added to the queues with the same id
    // and if so -> remove it.
    var currentIndex = this._queue.indexOf(id);
    if (currentIndex > -1) this._queue[currentIndex] = undefined;

    // Add entry.
    isPrioritized ? this._queue.unshift(id) : this._queue.push(id);
    this._reads[id] = readOperation;
    this._writes[id] = writeOperation;

    // Finally, let's kick-start the next tick if it is not running yet.
    if (!this._nextStep) this._nextStep = raf(this._step);
  };

  Ticker.prototype.cancel = function(id) {
    var currentIndex = this._queue.indexOf(id);
    if (currentIndex > -1) {
      this._queue[currentIndex] = undefined;
      delete this._reads[id];
      delete this._writes[id];
    }
  };

  Ticker.prototype._step = function() {
    var queue = this._queue;
    var reads = this._reads;
    var writes = this._writes;
    var batch = this._batch;
    var batchReads = this._batchReads;
    var batchWrites = this._batchWrites;
    var length = queue.length;
    var id;
    var i;

    // Reset ticker.
    this._nextStep = null;

    // Setup queues and callback placeholders.
    for (i = 0; i < length; i++) {
      id = queue[i];
      if (!id) continue;

      batch.push(id);

      batchReads[id] = reads[id];
      delete reads[id];

      batchWrites[id] = writes[id];
      delete writes[id];
    }

    // Reset queue.
    queue.length = 0;

    // Process read callbacks.
    for (i = 0; i < length; i++) {
      id = batch[i];
      if (batchReads[id]) {
        batchReads[id]();
        delete batchReads[id];
      }
    }

    // Process write callbacks.
    for (i = 0; i < length; i++) {
      id = batch[i];
      if (batchWrites[id]) {
        batchWrites[id]();
        delete batchWrites[id];
      }
    }

    // Reset batch.
    batch.length = 0;

    // Restart the ticker if needed.
    if (!this._nextStep && queue.length) {
      this._nextStep = raf(this._step);
    }
  };

  var ticker = new Ticker();

  var layoutTick = 'layout';
  var visibilityTick = 'visibility';
  var moveTick = 'move';
  var scrollTick = 'scroll';
  var placeholderTick = 'placeholder';

  function addLayoutTick(itemId, readCallback, writeCallback) {
    return ticker.add(itemId + layoutTick, readCallback, writeCallback);
  }

  function cancelLayoutTick(itemId) {
    return ticker.cancel(itemId + layoutTick);
  }

  function addVisibilityTick(itemId, readCallback, writeCallback) {
    return ticker.add(itemId + visibilityTick, readCallback, writeCallback);
  }

  function cancelVisibilityTick(itemId) {
    return ticker.cancel(itemId + visibilityTick);
  }

  function addMoveTick(itemId, readCallback, writeCallback) {
    return ticker.add(itemId + moveTick, readCallback, writeCallback, true);
  }

  function cancelMoveTick(itemId) {
    return ticker.cancel(itemId + moveTick);
  }

  function addScrollTick(itemId, readCallback, writeCallback) {
    return ticker.add(itemId + scrollTick, readCallback, writeCallback, true);
  }

  function cancelScrollTick(itemId) {
    return ticker.cancel(itemId + scrollTick);
  }

  function addPlaceholderTick(itemId, readCallback, writeCallback) {
    return ticker.add(itemId + placeholderTick, readCallback, writeCallback);
  }

  function cancelPlaceholderTick(itemId) {
    return ticker.cancel(itemId + placeholderTick);
  }

  var ElProto = window.Element.prototype;
  var matchesFn =
    ElProto.matches ||
    ElProto.matchesSelector ||
    ElProto.webkitMatchesSelector ||
    ElProto.mozMatchesSelector ||
    ElProto.msMatchesSelector ||
    ElProto.oMatchesSelector ||
    function() {
      return false;
    };

  /**
   * Check if element matches a CSS selector.
   *
   * @param {Element} el
   * @param {String} selector
   * @returns {Boolean}
   */
  function elementMatches(el, selector) {
    return matchesFn.call(el, selector);
  }

  /**
   * Add class to an element.
   *
   * @param {HTMLElement} element
   * @param {String} className
   */
  function addClass(element, className) {
    if (element.classList) {
      element.classList.add(className);
    } else {
      if (!elementMatches(element, '.' + className)) {
        element.className += ' ' + className;
      }
    }
  }

  var tempArray = [];
  var numberType = 'number';

  /**
   * Insert an item or an array of items to array to a specified index. Mutates
   * the array. The index can be negative in which case the items will be added
   * to the end of the array.
   *
   * @param {Array} array
   * @param {*} items
   * @param {Number} [index=-1]
   */
  function arrayInsert(array, items, index) {
    var startIndex = typeof index === numberType ? index : -1;
    if (startIndex < 0) startIndex = array.length - startIndex + 1;

    array.splice.apply(array, tempArray.concat(startIndex, 0, items));
    tempArray.length = 0;
  }

  /**
   * Normalize array index. Basically this function makes sure that the provided
   * array index is within the bounds of the provided array and also transforms
   * negative index to the matching positive index.
   *
   * @param {Array} array
   * @param {Number} index
   * @param {Boolean} isMigration
   */
  function normalizeArrayIndex(array, index, isMigration) {
    var length = array.length;
    var maxIndex = Math.max(0, isMigration ? length : length - 1);
    return index > maxIndex ? maxIndex : index < 0 ? Math.max(maxIndex + index + 1, 0) : index;
  }

  /**
   * Move array item to another index.
   *
   * @param {Array} array
   * @param {Number} fromIndex
   *   - Index (positive or negative) of the item that will be moved.
   * @param {Number} toIndex
   *   - Index (positive or negative) where the item should be moved to.
   */
  function arrayMove(array, fromIndex, toIndex) {
    // Make sure the array has two or more items.
    if (array.length < 2) return;

    // Normalize the indices.
    var from = normalizeArrayIndex(array, fromIndex);
    var to = normalizeArrayIndex(array, toIndex);

    // Add target item to the new position.
    if (from !== to) {
      array.splice(to, 0, array.splice(from, 1)[0]);
    }
  }

  /**
   * Swap array items.
   *
   * @param {Array} array
   * @param {Number} index
   *   - Index (positive or negative) of the item that will be swapped.
   * @param {Number} withIndex
   *   - Index (positive or negative) of the other item that will be swapped.
   */
  function arraySwap(array, index, withIndex) {
    // Make sure the array has two or more items.
    if (array.length < 2) return;

    // Normalize the indices.
    var indexA = normalizeArrayIndex(array, index);
    var indexB = normalizeArrayIndex(array, withIndex);
    var temp;

    // Swap the items.
    if (indexA !== indexB) {
      temp = array[indexA];
      array[indexA] = array[indexB];
      array[indexB] = temp;
    }
  }

  var actionCancel = 'cancel';
  var actionFinish = 'finish';
  var debounceTick = 'debounce';
  var debounceId = 0;

  /**
   * Returns a function, that, as long as it continues to be invoked, will not
   * be triggered. The function will be called after it stops being called for
   * N milliseconds. The returned function accepts one argument which, when
   * being "finish", calls the debounce function immediately if it is currently
   * waiting to be called, and when being "cancel" cancels the currently queued
   * function call.
   *
   * @param {Function} fn
   * @param {Number} wait
   * @returns {Function}
   */
  function debounce(fn, wait) {
    var timeout;
    var tickerId = ++debounceId + debounceTick;

    if (wait > 0) {
      return function(action) {
        if (timeout !== undefined) {
          timeout = window.clearTimeout(timeout);
          ticker.cancel(tickerId);
          if (action === actionFinish) fn();
        }

        if (action !== actionCancel && action !== actionFinish) {
          timeout = window.setTimeout(function() {
            timeout = undefined;
            ticker.add(tickerId, fn, null, true);
          }, wait);
        }
      };
    }

    return function(action) {
      if (action !== actionCancel) fn();
    };
  }

  /**
   * Returns true if element is transformed, false if not. In practice the
   * element's display value must be anything else than "none" or "inline" as
   * well as have a valid transform value applied in order to be counted as a
   * transformed element.
   *
   * Borrowed from Mezr (v0.6.1):
   * https://github.com/niklasramo/mezr/blob/0.6.1/mezr.js#L661
   *
   * @param {HTMLElement} element
   * @returns {Boolean}
   */
  function isTransformed(element) {
    var transform = getStyle(element, 'transform');
    if (!transform || transform === 'none') return false;

    var display = getStyle(element, 'display');
    if (display === 'inline' || display === 'none') return false;

    return true;
  }

  /**
   * Returns an absolute positioned element's containing block, which is
   * considered to be the closest ancestor element that the target element's
   * positioning is relative to. Disclaimer: this only works as intended for
   * absolute positioned elements.
   *
   * @param {HTMLElement} element
   * @param {Boolean} [includeSelf=false]
   *   - When this is set to true the containing block checking is started from
   *     the provided element. Otherwise the checking is started from the
   *     provided element's parent element.
   * @returns {(Document|Element)}
   */
  function getContainingBlock(element, includeSelf) {
    // As long as the containing block is an element, static and not
    // transformed, try to get the element's parent element and fallback to
    // document. https://github.com/niklasramo/mezr/blob/0.6.1/mezr.js#L339
    var document = window.document;
    var ret = (includeSelf ? element : element.parentElement) || document;
    while (ret && ret !== document && getStyle(ret, 'position') === 'static' && !isTransformed(ret)) {
      ret = ret.parentElement || document;
    }
    return ret;
  }

  /**
   * Returns the computed value of an element's style property transformed into
   * a float value.
   *
   * @param {HTMLElement} el
   * @param {String} style
   * @returns {Number}
   */
  function getStyleAsFloat(el, style) {
    return parseFloat(getStyle(el, style)) || 0;
  }

  var offsetA = {};
  var offsetB = {};
  var offsetDiff = {};

  /**
   * Returns the element's document offset, which in practice means the vertical
   * and horizontal distance between the element's northwest corner and the
   * document's northwest corner. Note that this function always returns the same
   * object so be sure to read the data from it instead using it as a reference.
   *
   * @param {(Document|Element|Window)} element
   * @param {Object} [offsetData]
   *   - Optional data object where the offset data will be inserted to. If not
   *     provided a new object will be created for the return data.
   * @returns {Object}
   */
  function getOffset(element, offsetData) {
    var ret = offsetData || {};
    var rect;

    // Set up return data.
    ret.left = 0;
    ret.top = 0;

    // Document's offsets are always 0.
    if (element === document) return ret;

    // Add viewport scroll left/top to the respective offsets.
    ret.left = window.pageXOffset || 0;
    ret.top = window.pageYOffset || 0;

    // Window's offsets are the viewport scroll left/top values.
    if (element.self === window.self) return ret;

    // Add element's client rects to the offsets.
    rect = element.getBoundingClientRect();
    ret.left += rect.left;
    ret.top += rect.top;

    // Exclude element's borders from the offset.
    ret.left += getStyleAsFloat(element, 'border-left-width');
    ret.top += getStyleAsFloat(element, 'border-top-width');

    return ret;
  }

  /**
   * Calculate the offset difference two elements.
   *
   * @param {HTMLElement} elemA
   * @param {HTMLElement} elemB
   * @param {Boolean} [compareContainingBlocks=false]
   *   - When this is set to true the containing blocks of the provided elements
   *     will be used for calculating the difference. Otherwise the provided
   *     elements will be compared directly.
   * @returns {Object}
   */
  function getOffsetDiff(elemA, elemB, compareContainingBlocks) {
    offsetDiff.left = 0;
    offsetDiff.top = 0;

    // If elements are same let's return early.
    if (elemA === elemB) return offsetDiff;

    // Compare containing blocks if necessary.
    if (compareContainingBlocks) {
      elemA = getContainingBlock(elemA, true);
      elemB = getContainingBlock(elemB, true);

      // If containing blocks are identical, let's return early.
      if (elemA === elemB) return offsetDiff;
    }

    // Finally, let's calculate the offset diff.
    getOffset(elemA, offsetA);
    getOffset(elemB, offsetB);
    offsetDiff.left = offsetB.left - offsetA.left;
    offsetDiff.top = offsetB.top - offsetA.top;

    return offsetDiff;
  }

  var styleOverflow = 'overflow';
  var styleOverflowX = 'overflow-x';
  var styleOverflowY = 'overflow-y';
  var overflowAuto = 'auto';
  var overflowScroll = 'scroll';

  /**
   * Check if an element is scrollable.
   *
   * @param {HTMLElement} element
   * @returns {Boolean}
   */
  function isScrollable(element) {
    var overflow = getStyle(element, styleOverflow);
    if (overflow === overflowAuto || overflow === overflowScroll) return true;

    overflow = getStyle(element, styleOverflowX);
    if (overflow === overflowAuto || overflow === overflowScroll) return true;

    overflow = getStyle(element, styleOverflowY);
    if (overflow === overflowAuto || overflow === overflowScroll) return true;

    return false;
  }

  /**
   * Collect element's ancestors that are potentially scrollable elements.
   *
   * @param {HTMLElement} element
   * @param {Boolean} [includeSelf=false]
   * @param {Array} [data]
   * @returns {Array}
   */
  function getScrollableAncestors(element, includeSelf, data) {
    var ret = data || [];
    var parent = includeSelf ? element : element.parentNode;

    // Find scroll parents.
    while (parent && parent !== document) {
      // If element is inside ShadowDOM let's get it's host node from the real
      // DOM and continue looping.
      if (parent.getRootNode && parent instanceof DocumentFragment) {
        parent = parent.getRootNode().host;
        continue;
      }

      // If element is scrollable let's add it to the scrollable list.
      if (isScrollable(parent)) {
        ret.push(parent);
      }

      parent = parent.parentNode;
    }

    // Always add window to the results.
    ret.push(window);

    return ret;
  }

  var translateValue = {};
  var transformStyle$2 = 'transform';
  var transformNone = 'none';
  var rxMat3d = /^matrix3d/;
  var rxMatTx = /([^,]*,){4}/;
  var rxMat3dTx = /([^,]*,){12}/;
  var rxNextItem = /[^,]*,/;

  /**
   * Returns the element's computed translateX and translateY values as a floats.
   * The returned object is always the same object and updated every time this
   * function is called.
   *
   * @param {HTMLElement} element
   * @returns {Object}
   */
  function getTranslate(element) {
    translateValue.x = 0;
    translateValue.y = 0;

    var transform = getStyle(element, transformStyle$2);
    if (!transform || transform === transformNone) {
      return translateValue;
    }

    // Transform style can be in either matrix3d(...) or matrix(...).
    var isMat3d = rxMat3d.test(transform);
    var tX = transform.replace(isMat3d ? rxMat3dTx : rxMatTx, '');
    var tY = tX.replace(rxNextItem, '');

    translateValue.x = parseFloat(tX) || 0;
    translateValue.y = parseFloat(tY) || 0;

    return translateValue;
  }

  /**
   * Transform translateX and translateY value into CSS transform style
   * property's value.
   *
   * @param {Number} x
   * @param {Number} y
   * @returns {String}
   */
  function getTranslateString(x, y) {
    return 'translateX(' + x + 'px) translateY(' + y + 'px)';
  }

  /**
   * Remove class from an element.
   *
   * @param {HTMLElement} element
   * @param {String} className
   */
  function removeClass(element, className) {
    if (element.classList) {
      element.classList.remove(className);
    } else {
      if (elementMatches(element, '.' + className)) {
        element.className = (' ' + element.className + ' ')
          .replace(' ' + className + ' ', ' ')
          .trim();
      }
    }
  }

  // Drag start predicate states.
  var startPredicateInactive = 0;
  var startPredicatePending = 1;
  var startPredicateResolved = 2;
  var startPredicateRejected = 3;

  /**
   * Bind touch interaction to an item.
   *
   * @class
   * @param {Item} item
   */
  function ItemDrag(item) {
    var element = item._element;
    var grid = item.getGrid();
    var settings = grid._settings;

    this._item = item;
    this._gridId = grid._id;
    this._isDestroyed = false;
    this._isMigrating = false;

    // Start predicate data.
    this._startPredicate = isFunction(settings.dragStartPredicate)
      ? settings.dragStartPredicate
      : ItemDrag.defaultStartPredicate;
    this._startPredicateState = startPredicateInactive;
    this._startPredicateResult = undefined;

    // Data for drag sort predicate heuristics.
    this._hBlockedIndex = null;
    this._hX1 = 0;
    this._hX2 = 0;
    this._hY1 = 0;
    this._hY2 = 0;

    // Setup item's initial drag data.
    this._reset();

    // Bind the methods that needs binding.
    this._preStartCheck = this._preStartCheck.bind(this);
    this._preEndCheck = this._preEndCheck.bind(this);
    this._onScroll = this._onScroll.bind(this);
    this._prepareMove = this._prepareMove.bind(this);
    this._applyMove = this._applyMove.bind(this);
    this._prepareScroll = this._prepareScroll.bind(this);
    this._applyScroll = this._applyScroll.bind(this);
    this._checkOverlap = this._checkOverlap.bind(this);

    // Create debounce overlap checker function.
    var sortInterval = settings.dragSortHeuristics.sortInterval;
    this._checkOverlapDebounce = debounce(this._checkOverlap, sortInterval);

    // Init dragger.
    this._dragger = new Dragger(element, settings.dragCssProps);
    this._dragger.on('start', this._preStartCheck);
    this._dragger.on('move', this._preStartCheck);
    this._dragger.on('cancel', this._preEndCheck);
    this._dragger.on('end', this._preEndCheck);
  }

  /**
   * Public static methods
   * *********************
   */

  /**
   * Default drag start predicate handler that handles anchor elements
   * gracefully. The return value of this function defines if the drag is
   * started, rejected or pending. When true is returned the dragging is started
   * and when false is returned the dragging is rejected. If nothing is returned
   * the predicate will be called again on the next drag movement.
   *
   * @public
   * @memberof ItemDrag
   * @param {Item} item
   * @param {DraggerEvent} event
   * @param {Object} [options]
   *   - An optional options object which can be used to pass the predicate
   *     it's options manually. By default the predicate retrieves the options
   *     from the grid's settings.
   * @returns {Boolean}
   */
  ItemDrag.defaultStartPredicate = function(item, event, options) {
    var drag = item._drag;
    var predicate = drag._startPredicateData || drag._setupStartPredicate(options);

    // Final event logic. At this stage return value does not matter anymore,
    // the predicate is either resolved or it's not and there's nothing to do
    // about it. Here we just reset data and if the item element is a link
    // we follow it (if there has only been slight movement).
    if (event.isFinal) {
      drag._finishStartPredicate(event);
      return;
    }

    // Find and store the handle element so we can check later on if the
    // cursor is within the handle. If we have a handle selector let's find
    // the corresponding element. Otherwise let's use the item element as the
    // handle.
    if (!predicate.handleElement) {
      predicate.handleElement = drag._getStartPredicateHandle(event);
      if (!predicate.handleElement) return false;
    }

    // If delay is defined let's keep track of the latest event and initiate
    // delay if it has not been done yet.
    if (predicate.delay) {
      predicate.event = event;
      if (!predicate.delayTimer) {
        predicate.delayTimer = window.setTimeout(function() {
          predicate.delay = 0;
          if (drag._resolveStartPredicate(predicate.event)) {
            drag._forceResolveStartPredicate(predicate.event);
            drag._resetStartPredicate();
          }
        }, predicate.delay);
      }
    }

    return drag._resolveStartPredicate(event);
  };

  /**
   * Default drag sort predicate.
   *
   * @public
   * @memberof ItemDrag
   * @param {Item} item
   * @param {Object} [options]
   * @param {Number} [options.threshold=50]
   * @param {String} [options.action='move']
   * @returns {(Boolean|DragSortCommand)}
   *   - Returns false if no valid index was found. Otherwise returns drag sort
   *     command.
   */
  ItemDrag.defaultSortPredicate = (function() {
    var itemRect = {};
    var targetRect = {};
    var returnData = {};
    var rootGridArray = [];

    function getTargetGrid(item, rootGrid, threshold) {
      var target = null;
      var dragSort = rootGrid._settings.dragSort;
      var bestScore = -1;
      var gridScore;
      var grids;
      var grid;
      var i;

      // Get potential target grids.
      if (dragSort === true) {
        rootGridArray[0] = rootGrid;
        grids = rootGridArray;
      } else {
        grids = dragSort.call(rootGrid, item);
      }

      // Return immediately if there are no grids.
      if (!Array.isArray(grids)) return target;

      // Loop through the grids and get the best match.
      for (i = 0; i < grids.length; i++) {
        grid = grids[i];

        // Filter out all destroyed grids.
        if (grid._isDestroyed) continue;

        // We need to update the grid's offsets and dimensions since they might
        // have changed (e.g during scrolling).
        grid._updateBoundingRect();

        // Check how much dragged element overlaps the container element.
        targetRect.width = grid._width;
        targetRect.height = grid._height;
        targetRect.left = grid._left;
        targetRect.top = grid._top;
        gridScore = getRectOverlapScore(itemRect, targetRect);

        // Check if this grid is the best match so far.
        if (gridScore > threshold && gridScore > bestScore) {
          bestScore = gridScore;
          target = grid;
        }
      }

      // Always reset root grid array.
      rootGridArray.length = 0;

      return target;
    }

    return function(item, options) {
      var drag = item._drag;
      var rootGrid = drag._getGrid();

      // Get drag sort predicate settings.
      var sortThreshold = options && typeof options.threshold === 'number' ? options.threshold : 50;
      var sortAction = options && options.action === actionSwap ? actionSwap : actionMove;

      // Populate item rect data.
      itemRect.width = item._width;
      itemRect.height = item._height;
      itemRect.left = drag._elementClientX;
      itemRect.top = drag._elementClientY;

      // Calculate the target grid.
      var grid = getTargetGrid(item, rootGrid, sortThreshold);

      // Return early if we found no grid container element that overlaps the
      // dragged item enough.
      if (!grid) return false;

      var gridOffsetLeft = 0;
      var gridOffsetTop = 0;
      var matchScore = -1;
      var matchIndex;
      var hasValidTargets;
      var target;
      var score;
      var i;

      // If item is moved within it's originating grid adjust item's left and
      // top props. Otherwise if item is moved to/within another grid get the
      // container element's offset (from the element's content edge).
      if (grid === rootGrid) {
        itemRect.left = drag._gridX + item._marginLeft;
        itemRect.top = drag._gridY + item._marginTop;
      } else {
        grid._updateBorders(1, 0, 1, 0);
        gridOffsetLeft = grid._left + grid._borderLeft;
        gridOffsetTop = grid._top + grid._borderTop;
      }

      // Loop through the target grid items and try to find the best match.
      for (i = 0; i < grid._items.length; i++) {
        target = grid._items[i];

        // If the target item is not active or the target item is the dragged
        // item let's skip to the next item.
        if (!target._isActive || target === item) {
          continue;
        }

        // Mark the grid as having valid target items.
        hasValidTargets = true;

        // Calculate the target's overlap score with the dragged item.
        targetRect.width = target._width;
        targetRect.height = target._height;
        targetRect.left = target._left + target._marginLeft + gridOffsetLeft;
        targetRect.top = target._top + target._marginTop + gridOffsetTop;
        score = getRectOverlapScore(itemRect, targetRect);

        // Update best match index and score if the target's overlap score with
        // the dragged item is higher than the current best match score.
        if (score > matchScore) {
          matchIndex = i;
          matchScore = score;
        }
      }

      // If there is no valid match and the item is being moved into another
      // grid.
      if (matchScore < sortThreshold && item.getGrid() !== grid) {
        matchIndex = hasValidTargets ? -1 : 0;
        matchScore = Infinity;
      }

      // Check if the best match overlaps enough to justify a placement switch.
      if (matchScore >= sortThreshold) {
        returnData.grid = grid;
        returnData.index = matchIndex;
        returnData.action = sortAction;
        return returnData;
      }

      return false;
    };
  })();

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Abort dragging and reset drag data.
   *
   * @public
   * @memberof ItemDrag.prototype
   * @returns {ItemDrag}
   */
  ItemDrag.prototype.stop = function() {
    var item = this._item;
    var element = item._element;
    var grid = this._getGrid();

    if (!this._isActive) return this;

    // If the item is being dropped into another grid, finish it up and return
    // immediately.
    if (this._isMigrating) {
      this._finishMigration();
      return this;
    }

    // Cancel queued move and scroll ticks.
    cancelMoveTick(item._id);
    cancelScrollTick(item._id);

    // Remove scroll listeners.
    this._unbindScrollListeners();

    // Cancel overlap check.
    this._checkOverlapDebounce('cancel');

    // Append item element to the container if it's not it's child. Also make
    // sure the translate values are adjusted to account for the DOM shift.
    if (element.parentNode !== grid._element) {
      grid._element.appendChild(element);
      element.style[transformProp] = getTranslateString(this._gridX, this._gridY);
    }

    // Remove dragging class.
    removeClass(element, grid._settings.itemDraggingClass);

    // Reset drag data.
    this._reset();

    return this;
  };

  /**
   * Destroy instance.
   *
   * @public
   * @memberof ItemDrag.prototype
   * @returns {ItemDrag}
   */
  ItemDrag.prototype.destroy = function() {
    if (this._isDestroyed) return this;
    this.stop();
    this._dragger.destroy();
    this._isDestroyed = true;
    return this;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Get Grid instance.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @returns {?Grid}
   */
  ItemDrag.prototype._getGrid = function() {
    return gridInstances[this._gridId] || null;
  };

  /**
   * Setup/reset drag data.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._reset = function() {
    // Is item being dragged?
    this._isActive = false;

    // The dragged item's container element.
    this._container = null;

    // The dragged item's containing block.
    this._containingBlock = null;

    // Drag/scroll event data.
    this._dragEvent = null;
    this._scrollEvent = null;

    // All the elements which need to be listened for scroll events during
    // dragging.
    this._scrollers = [];

    // The current translateX/translateY position.
    this._left = 0;
    this._top = 0;

    // Dragged element's current position within the grid.
    this._gridX = 0;
    this._gridY = 0;

    // Dragged element's current offset from window's northwest corner. Does
    // not account for element's margins.
    this._elementClientX = 0;
    this._elementClientY = 0;

    // Offset difference between the dragged element's temporary drag
    // container and it's original container.
    this._containerDiffX = 0;
    this._containerDiffY = 0;
  };

  /**
   * Bind drag scroll handlers to all scrollable ancestor elements of the
   * dragged element and the drag container element.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._bindScrollListeners = function() {
    var gridContainer = this._getGrid()._element;
    var dragContainer = this._container;
    var scrollers = this._scrollers;
    var gridScrollers;
    var i;

    // Get dragged element's scrolling parents.
    scrollers.length = 0;
    getScrollableAncestors(this._item._element, false, scrollers);

    // If drag container is defined and it's not the same element as grid
    // container then we need to add the grid container and it's scroll parents
    // to the elements which are going to be listener for scroll events.
    if (dragContainer !== gridContainer) {
      gridScrollers = [];
      getScrollableAncestors(gridContainer, true, gridScrollers);
      for (i = 0; i < gridScrollers.length; i++) {
        if (scrollers.indexOf(gridScrollers[i]) < 0) {
          scrollers.push(gridScrollers[i]);
        }
      }
    }

    // Bind scroll listeners.
    for (i = 0; i < scrollers.length; i++) {
      scrollers[i].addEventListener('scroll', this._onScroll);
    }
  };

  /**
   * Unbind currently bound drag scroll handlers from all scrollable ancestor
   * elements of the dragged element and the drag container element.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._unbindScrollListeners = function() {
    var scrollers = this._scrollers;
    var i;

    for (i = 0; i < scrollers.length; i++) {
      scrollers[i].removeEventListener('scroll', this._onScroll);
    }

    scrollers.length = 0;
  };

  /**
   * Setup default start predicate.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {Object} [options]
   * @returns {Object}
   */
  ItemDrag.prototype._setupStartPredicate = function(options) {
    var config = options || this._getGrid()._settings.dragStartPredicate || 0;
    return (this._startPredicateData = {
      distance: Math.abs(config.distance) || 0,
      delay: Math.max(config.delay, 0) || 0,
      handle: typeof config.handle === 'string' ? config.handle : false
    });
  };

  /**
   * Setup default start predicate handle.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   * @returns {?HTMLElement}
   */
  ItemDrag.prototype._getStartPredicateHandle = function(event) {
    var predicate = this._startPredicateData;
    var element = this._item._element;
    var handleElement = element;

    // No handle, no hassle -> let's use the item element as the handle.
    if (!predicate.handle) return handleElement;

    // If there is a specific predicate handle defined, let's try to get it.
    handleElement = event.target;
    while (handleElement && !elementMatches(handleElement, predicate.handle)) {
      handleElement = handleElement !== element ? handleElement.parentElement : null;
    }
    return handleElement || null;
  };

  /**
   * Unbind currently bound drag scroll handlers from all scrollable ancestor
   * elements of the dragged element and the drag container element.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   * @returns {Boolean}
   */
  ItemDrag.prototype._resolveStartPredicate = function(event) {
    var predicate = this._startPredicateData;

    // If the moved distance is smaller than the threshold distance or there is
    // some delay left, ignore this predicate cycle.
    if (event.distance < predicate.distance || predicate.delay) return;

    // Get handle rect data.
    var handleRect = predicate.handleElement.getBoundingClientRect();
    var handleLeft = handleRect.left + (window.pageXOffset || 0);
    var handleTop = handleRect.top + (window.pageYOffset || 0);
    var handleWidth = handleRect.width;
    var handleHeight = handleRect.height;

    // Reset predicate data.
    this._resetStartPredicate();

    // If the cursor is still within the handle let's start the drag.
    return (
      handleWidth &&
      handleHeight &&
      event.pageX >= handleLeft &&
      event.pageX < handleLeft + handleWidth &&
      event.pageY >= handleTop &&
      event.pageY < handleTop + handleHeight
    );
  };

  /**
   * Forcefully resolve drag start predicate.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._forceResolveStartPredicate = function(event) {
    if (!this._isDestroyed && this._startPredicateState === startPredicatePending) {
      this._startPredicateState = startPredicateResolved;
      this._onStart(event);
    }
  };

  /**
   * Finalize start predicate.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._finishStartPredicate = function(event) {
    var element = this._item._element;

    // Check if this is a click (very subjective heuristics).
    var isClick = Math.abs(event.deltaX) < 2 && Math.abs(event.deltaY) < 2 && event.deltaTime < 200;

    // Reset predicate.
    this._resetStartPredicate();

    // If the gesture can be interpreted as click let's try to open the element's
    // href url (if it is an anchor element).
    if (isClick) openAnchorHref(element);
  };

  /**
   * Reset drag sort heuristics.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._resetHeuristics = function(event) {
    this._hBlockedIndex = null;
    this._hX1 = this._hX2 = event.clientX;
    this._hY1 = this._hY2 = event.clientY;
  };

  /**
   * Run heuristics and return true if overlap check can be performed, and false
   * if it can not.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   * @returns {Boolean}
   */
  ItemDrag.prototype._checkHeuristics = function(event) {
    var settings = this._getGrid()._settings.dragSortHeuristics;
    var minDist = settings.minDragDistance;

    // Skip heuristics if not needed.
    if (minDist <= 0) {
      this._hBlockedIndex = null;
      return true;
    }

    var x = event.clientX;
    var y = event.clientY;
    var diffX = x - this._hX2;
    var diffY = y - this._hY2;

    // If we can't do proper bounce back check make sure that the blocked index
    // is not set.
    var canCheckBounceBack = minDist > 3 && settings.minBounceBackAngle > 0;
    if (!canCheckBounceBack) {
      this._hBlockedIndex = null;
    }

    if (Math.abs(diffX) > minDist || Math.abs(diffY) > minDist) {
      // Reset blocked index if angle changed enough. This check requires a
      // minimum value of 3 for minDragDistance to function properly.
      if (canCheckBounceBack) {
        var angle = Math.atan2(diffX, diffY);
        var prevAngle = Math.atan2(this._hX2 - this._hX1, this._hY2 - this._hY1);
        var deltaAngle = Math.atan2(Math.sin(angle - prevAngle), Math.cos(angle - prevAngle));
        if (Math.abs(deltaAngle) > settings.minBounceBackAngle) {
          this._hBlockedIndex = null;
        }
      }

      // Update points.
      this._hX1 = this._hX2;
      this._hY1 = this._hY2;
      this._hX2 = x;
      this._hY2 = y;

      return true;
    }

    return false;
  };

  /**
   * Reset for default drag start predicate function.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._resetStartPredicate = function() {
    var predicate = this._startPredicateData;
    if (predicate) {
      if (predicate.delayTimer) {
        predicate.delayTimer = window.clearTimeout(predicate.delayTimer);
      }
      this._startPredicateData = null;
    }
  };

  /**
   * Check (during drag) if an item is overlapping other items and based on
   * the configuration layout the items.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._checkOverlap = function() {
    if (!this._isActive) return;

    var item = this._item;
    var settings = this._getGrid()._settings;
    var result;
    var currentGrid;
    var currentIndex;
    var targetGrid;
    var targetIndex;
    var sortAction;
    var isMigration;

    // Get overlap check result.
    if (isFunction(settings.dragSortPredicate)) {
      result = settings.dragSortPredicate(item, this._dragEvent);
    } else {
      result = ItemDrag.defaultSortPredicate(item, settings.dragSortPredicate);
    }

    // Let's make sure the result object has a valid index before going further.
    if (!result || typeof result.index !== 'number') return;

    currentGrid = item.getGrid();
    targetGrid = result.grid || currentGrid;
    isMigration = currentGrid !== targetGrid;
    currentIndex = currentGrid._items.indexOf(item);
    targetIndex = normalizeArrayIndex(targetGrid._items, result.index, isMigration);
    sortAction = result.action === actionSwap ? actionSwap : actionMove;

    // Prevent position bounce.
    if (!isMigration && targetIndex === this._hBlockedIndex) {
      return;
    }

    // If the item was moved within it's current grid.
    if (!isMigration) {
      // Make sure the target index is not the current index.
      if (currentIndex !== targetIndex) {
        this._hBlockedIndex = currentIndex;

        // Do the sort.
        (sortAction === actionSwap ? arraySwap : arrayMove)(
          currentGrid._items,
          currentIndex,
          targetIndex
        );

        // Emit move event.
        if (currentGrid._hasListeners(eventMove)) {
          currentGrid._emit(eventMove, {
            item: item,
            fromIndex: currentIndex,
            toIndex: targetIndex,
            action: sortAction
          });
        }

        // Layout the grid.
        currentGrid.layout();
      }
    }

    // If the item was moved to another grid.
    else {
      this._hBlockedIndex = null;

      // Emit beforeSend event.
      if (currentGrid._hasListeners(eventBeforeSend)) {
        currentGrid._emit(eventBeforeSend, {
          item: item,
          fromGrid: currentGrid,
          fromIndex: currentIndex,
          toGrid: targetGrid,
          toIndex: targetIndex
        });
      }

      // Emit beforeReceive event.
      if (targetGrid._hasListeners(eventBeforeReceive)) {
        targetGrid._emit(eventBeforeReceive, {
          item: item,
          fromGrid: currentGrid,
          fromIndex: currentIndex,
          toGrid: targetGrid,
          toIndex: targetIndex
        });
      }

      // Update item's grid id reference.
      item._gridId = targetGrid._id;

      // Update drag instance's migrating indicator.
      this._isMigrating = item._gridId !== this._gridId;

      // Move item instance from current grid to target grid.
      currentGrid._items.splice(currentIndex, 1);
      arrayInsert(targetGrid._items, item, targetIndex);

      // Set sort data as null, which is an indicator for the item comparison
      // function that the sort data of this specific item should be fetched
      // lazily.
      item._sortData = null;

      // Emit send event.
      if (currentGrid._hasListeners(eventSend)) {
        currentGrid._emit(eventSend, {
          item: item,
          fromGrid: currentGrid,
          fromIndex: currentIndex,
          toGrid: targetGrid,
          toIndex: targetIndex
        });
      }

      // Emit receive event.
      if (targetGrid._hasListeners(eventReceive)) {
        targetGrid._emit(eventReceive, {
          item: item,
          fromGrid: currentGrid,
          fromIndex: currentIndex,
          toGrid: targetGrid,
          toIndex: targetIndex
        });
      }

      // Layout both grids.
      currentGrid.layout();
      targetGrid.layout();
    }
  };

  /**
   * If item is dragged into another grid, finish the migration process
   * gracefully.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._finishMigration = function() {
    var item = this._item;
    var release = item._release;
    var element = item._element;
    var isActive = item._isActive;
    var targetGrid = item.getGrid();
    var targetGridElement = targetGrid._element;
    var targetSettings = targetGrid._settings;
    var targetContainer = targetSettings.dragContainer || targetGridElement;
    var currentSettings = this._getGrid()._settings;
    var currentContainer = element.parentNode;
    var translate;
    var offsetDiff;

    // Destroy current drag. Note that we need to set the migrating flag to
    // false first, because otherwise we create an infinite loop between this
    // and the drag.stop() method.
    this._isMigrating = false;
    this.destroy();

    // Remove current classnames.
    removeClass(element, currentSettings.itemClass);
    removeClass(element, currentSettings.itemVisibleClass);
    removeClass(element, currentSettings.itemHiddenClass);

    // Add new classnames.
    addClass(element, targetSettings.itemClass);
    addClass(element, isActive ? targetSettings.itemVisibleClass : targetSettings.itemHiddenClass);

    // Move the item inside the target container if it's different than the
    // current container.
    if (targetContainer !== currentContainer) {
      targetContainer.appendChild(element);
      offsetDiff = getOffsetDiff(currentContainer, targetContainer, true);
      translate = getTranslate(element);
      translate.x -= offsetDiff.left;
      translate.y -= offsetDiff.top;
    }

    // Update item's cached dimensions and sort data.
    item._refreshDimensions();
    item._refreshSortData();

    // Calculate the offset difference between target's drag container (if any)
    // and actual grid container element. We save it later for the release
    // process.
    offsetDiff = getOffsetDiff(targetContainer, targetGridElement, true);
    release._containerDiffX = offsetDiff.left;
    release._containerDiffY = offsetDiff.top;

    // Recreate item's drag handler.
    item._drag = targetSettings.dragEnabled ? new ItemDrag(item) : null;

    // Adjust the position of the item element if it was moved from a container
    // to another.
    if (targetContainer !== currentContainer) {
      element.style[transformProp] = getTranslateString(translate.x, translate.y);
    }

    // Update child element's styles to reflect the current visibility state.
    item._child.removeAttribute('style');
    setStyles(item._child, isActive ? targetSettings.visibleStyles : targetSettings.hiddenStyles);

    // Start the release.
    release.start();
  };

  /**
   * Drag pre-start handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._preStartCheck = function(event) {
    // Let's activate drag start predicate state.
    if (this._startPredicateState === startPredicateInactive) {
      this._startPredicateState = startPredicatePending;
    }

    // If predicate is pending try to resolve it.
    if (this._startPredicateState === startPredicatePending) {
      this._startPredicateResult = this._startPredicate(this._item, event);
      if (this._startPredicateResult === true) {
        this._startPredicateState = startPredicateResolved;
        this._onStart(event);
      } else if (this._startPredicateResult === false) {
        this._startPredicateState = startPredicateRejected;
      }
    }

    // Otherwise if predicate is resolved and drag is active, move the item.
    else if (this._startPredicateState === startPredicateResolved && this._isActive) {
      this._onMove(event);
    }
  };

  /**
   * Drag pre-end handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._preEndCheck = function(event) {
    // Check if the start predicate was resolved during drag.
    var isResolved = this._startPredicateState === startPredicateResolved;

    // Do final predicate check to allow user to unbind stuff for the current
    // drag procedure within the predicate callback. The return value of this
    // check will have no effect to the state of the predicate.
    this._startPredicate(this._item, event);

    // Reset start predicate state.
    this._startPredicateState = startPredicateInactive;

    // If predicate is resolved and dragging is active, call the end handler.
    if (isResolved && this._isActive) this._onEnd(event);
  };

  /**
   * Drag start handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._onStart = function(event) {
    var item = this._item;

    // If item is not active, don't start the drag.
    if (!item._isActive) return;

    var element = item._element;
    var grid = this._getGrid();
    var settings = grid._settings;
    var release = item._release;
    var migrate = item._migrate;
    var gridContainer = grid._element;
    var dragContainer = settings.dragContainer || gridContainer;
    var containingBlock = getContainingBlock(dragContainer, true);
    var translate = getTranslate(element);
    var currentLeft = translate.x;
    var currentTop = translate.y;
    var elementRect = element.getBoundingClientRect();
    var hasDragContainer = dragContainer !== gridContainer;
    var offsetDiff;

    // Reset heuristics data.
    this._resetHeuristics(event);

    // If grid container is not the drag container, we need to calculate the
    // offset difference between grid container and drag container's containing
    // element.
    if (hasDragContainer) {
      offsetDiff = getOffsetDiff(containingBlock, gridContainer);
    }

    // Stop current positioning animation.
    if (item.isPositioning()) {
      item._layout.stop(true, { transform: getTranslateString(currentLeft, currentTop) });
    }

    // Stop current migration animation.
    if (migrate._isActive) {
      currentLeft -= migrate._containerDiffX;
      currentTop -= migrate._containerDiffY;
      migrate.stop(true, { transform: getTranslateString(currentLeft, currentTop) });
    }

    // If item is being released reset release data.
    if (item.isReleasing()) release._reset();

    // Setup drag data.
    this._isActive = true;
    this._dragEvent = event;
    this._container = dragContainer;
    this._containingBlock = containingBlock;
    this._elementClientX = elementRect.left;
    this._elementClientY = elementRect.top;
    this._left = this._gridX = currentLeft;
    this._top = this._gridY = currentTop;

    // Create placeholder (if necessary).
    if (settings.dragPlaceholder.enabled) {
      item._dragPlaceholder.create();
    }

    // Emit dragInit event.
    grid._emit(eventDragInit, item, event);

    // If a specific drag container is set and it is different from the
    // grid's container element we need to cast some extra spells.
    if (hasDragContainer) {
      // Store the container offset diffs to drag data.
      this._containerDiffX = offsetDiff.left;
      this._containerDiffY = offsetDiff.top;

      // If the dragged element is a child of the drag container all we need to
      // do is setup the relative drag position data.
      if (element.parentNode === dragContainer) {
        this._gridX = currentLeft - this._containerDiffX;
        this._gridY = currentTop - this._containerDiffY;
      }

      // Otherwise we need to append the element inside the correct container,
      // setup the actual drag position data and adjust the element's translate
      // values to account for the DOM position shift.
      else {
        this._left = currentLeft + this._containerDiffX;
        this._top = currentTop + this._containerDiffY;
        dragContainer.appendChild(element);
        element.style[transformProp] = getTranslateString(this._left, this._top);
      }
    }

    // Set drag class and bind scrollers.
    addClass(element, settings.itemDraggingClass);
    this._bindScrollListeners();

    // Emit dragStart event.
    grid._emit(eventDragStart, item, event);
  };

  /**
   * Drag move handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._onMove = function(event) {
    var item = this._item;

    // If item is not active, reset drag.
    if (!item._isActive) {
      this.stop();
      return;
    }

    var settings = this._getGrid()._settings;
    var axis = settings.dragAxis;

    // Update horizontal position data.
    if (axis !== 'y') {
      var xDiff = event.clientX - this._dragEvent.clientX;
      this._left += xDiff;
      this._gridX += xDiff;
      this._elementClientX += xDiff;
    }

    // Update vertical position data.
    if (axis !== 'x') {
      var yDiff = event.clientY - this._dragEvent.clientY;
      this._top += yDiff;
      this._gridY += yDiff;
      this._elementClientY += yDiff;
    }

    // Update event data.
    this._dragEvent = event;

    // Do move prepare/apply handling in the next tick.
    addMoveTick(item._id, this._prepareMove, this._applyMove);
  };

  /**
   * Prepare dragged item for moving.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._prepareMove = function() {
    // Do nothing if item is not active.
    if (!this._item._isActive) return;

    // If drag sort is enabled -> check overlap.
    if (this._getGrid()._settings.dragSort) {
      if (this._checkHeuristics(this._dragEvent)) {
        this._checkOverlapDebounce();
      }
    }
  };

  /**
   * Apply movement to dragged item.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._applyMove = function() {
    var item = this._item;

    // Do nothing if item is not active.
    if (!item._isActive) return;

    // Update element's translateX/Y values.
    item._element.style[transformProp] = getTranslateString(this._left, this._top);

    // Emit dragMove event.
    this._getGrid()._emit(eventDragMove, item, this._dragEvent);
  };

  /**
   * Drag scroll handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {Event} event
   */
  ItemDrag.prototype._onScroll = function(event) {
    var item = this._item;

    // If item is not active, reset drag.
    if (!item._isActive) {
      this.stop();
      return;
    }

    // Update last scroll event.
    this._scrollEvent = event;

    // Do scroll prepare/apply handling in the next tick.
    addScrollTick(item._id, this._prepareScroll, this._applyScroll);
  };

  /**
   * Prepare dragged item for scrolling.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._prepareScroll = function() {
    var item = this._item;

    // If item is not active do nothing.
    if (!item._isActive) return;

    var element = item._element;
    var grid = this._getGrid();
    var settings = grid._settings;
    var axis = settings.dragAxis;
    var gridContainer = grid._element;
    var offsetDiff;

    // Calculate element's rect and x/y diff.
    var rect = element.getBoundingClientRect();
    var xDiff = this._elementClientX - rect.left;
    var yDiff = this._elementClientY - rect.top;

    // Update container diff.
    if (this._container !== gridContainer) {
      offsetDiff = getOffsetDiff(this._containingBlock, gridContainer);
      this._containerDiffX = offsetDiff.left;
      this._containerDiffY = offsetDiff.top;
    }

    // Update horizontal position data.
    if (axis !== 'y') {
      this._left += xDiff;
      this._gridX = this._left - this._containerDiffX;
    }

    // Update vertical position data.
    if (axis !== 'x') {
      this._top += yDiff;
      this._gridY = this._top - this._containerDiffY;
    }

    // Overlap handling.
    if (settings.dragSort) this._checkOverlapDebounce();
  };

  /**
   * Apply scroll to dragged item.
   *
   * @private
   * @memberof ItemDrag.prototype
   */
  ItemDrag.prototype._applyScroll = function() {
    var item = this._item;

    // If item is not active do nothing.
    if (!item._isActive) return;

    // Update element's translateX/Y values.
    item._element.style[transformProp] = getTranslateString(this._left, this._top);

    // Emit dragScroll event.
    this._getGrid()._emit(eventDragScroll, item, this._scrollEvent);
  };

  /**
   * Drag end handler.
   *
   * @private
   * @memberof ItemDrag.prototype
   * @param {DraggerEvent} event
   */
  ItemDrag.prototype._onEnd = function(event) {
    var item = this._item;
    var element = item._element;
    var grid = this._getGrid();
    var settings = grid._settings;
    var release = item._release;

    // If item is not active, reset drag.
    if (!item._isActive) {
      this.stop();
      return;
    }

    // Cancel queued move and scroll ticks.
    cancelMoveTick(item._id);
    cancelScrollTick(item._id);

    // Finish currently queued overlap check.
    settings.dragSort && this._checkOverlapDebounce('finish');

    // Remove scroll listeners.
    this._unbindScrollListeners();

    // Setup release data.
    release._containerDiffX = this._containerDiffX;
    release._containerDiffY = this._containerDiffY;

    // Reset drag data.
    this._reset();

    // Remove drag class name from element.
    removeClass(element, settings.itemDraggingClass);

    // Emit dragEnd event.
    grid._emit(eventDragEnd, item, event);

    // Finish up the migration process or start the release process.
    this._isMigrating ? this._finishMigration() : release.start();
  };

  /**
   * Private helpers
   * ***************
   */

  /**
   * Calculate how many percent the intersection area of two rectangles is from
   * the maximum potential intersection area between the rectangles.
   *
   * @param {Rectangle} a
   * @param {Rectangle} b
   * @returns {Number}
   *   - A number between 0-100.
   */
  function getRectOverlapScore(a, b) {
    // Return 0 immediately if the rectangles do not overlap.
    if (
      a.left + a.width <= b.left ||
      b.left + b.width <= a.left ||
      a.top + a.height <= b.top ||
      b.top + b.height <= a.top
    ) {
      return 0;
    }

    // Calculate intersection area's width, height, max height and max width.
    var width = Math.min(a.left + a.width, b.left + b.width) - Math.max(a.left, b.left);
    var height = Math.min(a.top + a.height, b.top + b.height) - Math.max(a.top, b.top);
    var maxWidth = Math.min(a.width, b.width);
    var maxHeight = Math.min(a.height, b.height);

    return ((width * height) / (maxWidth * maxHeight)) * 100;
  }

  /**
   * Check if an element is an anchor element and open the href url if possible.
   *
   * @param {HTMLElement} element
   */
  function openAnchorHref(element) {
    // Make sure the element is anchor element.
    if (element.tagName.toLowerCase() !== 'a') return;

    // Get href and make sure it exists.
    var href = element.getAttribute('href');
    if (!href) return;

    // Finally let's navigate to the link href.
    var target = element.getAttribute('target');
    if (target && target !== '_self') {
      window.open(href, target);
    } else {
      window.location.href = href;
    }
  }

  /**
   * Drag placeholder.
   *
   * @class
   * @param {Item} item
   */
  function ItemDragPlaceholder(item) {
    this._item = item;
    this._animate = new ItemAnimate();
    this._element = null;
    this._className = '';
    this._didMigrate = false;
    this._resetAfterLayout = false;
    this._currentLeft = 0;
    this._currentTop = 0;
    this._nextLeft = 0;
    this._nextTop = 0;

    // Bind animation handlers.
    this._setupAnimation = this._setupAnimation.bind(this);
    this._startAnimation = this._startAnimation.bind(this);

    // Bind event handlers.
    this._onLayoutStart = this._onLayoutStart.bind(this);
    this._onLayoutEnd = this._onLayoutEnd.bind(this);
    this._onReleaseEnd = this._onReleaseEnd.bind(this);
    this._onMigrate = this._onMigrate.bind(this);
  }

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Move placeholder to a new position.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype._onLayoutStart = function() {
    var item = this._item;
    var grid = item.getGrid();

    // Find out the item's new (unapplied) left and top position.
    var itemIndex = grid._items.indexOf(item);
    var nextLeft = grid._layout.slots[itemIndex * 2];
    var nextTop = grid._layout.slots[itemIndex * 2 + 1];

    // If item's position did not change and the item did not migrate we can
    // safely skip layout.
    if (!this._didMigrate && item._left === nextLeft && item._top === nextTop) {
      return;
    }

    // Slots data is calculated with item margins added to them so we need to add
    // item's left and top margin to the slot data to get the placeholder's
    // next position.
    nextLeft += item._marginLeft;
    nextTop += item._marginTop;

    // Just snap to new position without any animations if no animation is
    // required or if placeholder moves between grids.
    var animEnabled = grid._settings.dragPlaceholder.duration > 0;
    if (!animEnabled || this._didMigrate) {
      // Cancel potential (queued) layout tick.
      cancelPlaceholderTick(item._id);

      // Snap placeholder to correct position.
      var targetStyles = { transform: getTranslateString(nextLeft, nextTop) };
      if (this._animate.isAnimating()) {
        this._animate.stop(targetStyles);
      } else {
        setStyles(this._element, targetStyles);
      }

      // Move placeholder inside correct container after migration.
      if (this._didMigrate) {
        grid.getElement().appendChild(this._element);
        this._didMigrate = false;
      }

      return;
    }

    // Start the placeholder's layout animation in the next tick. We do this to
    // avoid layout thrashing.
    this._nextLeft = nextLeft;
    this._nextTop = nextTop;
    addPlaceholderTick(item._id, this._setupAnimation, this._startAnimation);
  };

  /**
   * Prepare placeholder for layout animation.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype._setupAnimation = function() {
    if (!this.isActive()) return;

    var translate = getTranslate(this._element);
    this._currentLeft = translate.x;
    this._currentTop = translate.y;
  };

  /**
   * Start layout animation.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype._startAnimation = function() {
    if (!this.isActive()) return;

    var animation = this._animate;
    var currentLeft = this._currentLeft;
    var currentTop = this._currentTop;
    var nextLeft = this._nextLeft;
    var nextTop = this._nextTop;
    var targetStyles = { transform: getTranslateString(nextLeft, nextTop) };

    // If placeholder is already in correct position let's just stop animation
    // and be done with it.
    if (currentLeft === nextLeft && currentTop === nextTop) {
      if (animation.isAnimating()) animation.stop(targetStyles);
      return;
    }

    // Otherwise let's start the animation.
    var settings = this._item.getGrid()._settings.dragPlaceholder;
    var currentStyles = { transform: getTranslateString(currentLeft, currentTop) };
    animation.start(currentStyles, targetStyles, {
      duration: settings.duration,
      easing: settings.easing,
      onFinish: this._onLayoutEnd
    });
  };

  /**
   * Layout end handler.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype._onLayoutEnd = function() {
    if (this._resetAfterLayout) {
      this.reset();
    }
  };

  /**
   * Drag end handler. This handler is called when dragReleaseEnd event is
   * emitted and receives the event data as it's argument.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   * @param {Item} item
   */
  ItemDragPlaceholder.prototype._onReleaseEnd = function(item) {
    if (item._id === this._item._id) {
      // If the placeholder is not animating anymore we can safely reset it.
      if (!this._animate.isAnimating()) {
        this.reset();
        return;
      }

      // If the placeholder item is still animating here, let's wait for it to
      // finish it's animation.
      this._resetAfterLayout = true;
    }
  };

  /**
   * Migration start handler. This handler is called when beforeSend event is
   * emitted and receives the event data as it's argument.
   *
   * @private
   * @memberof ItemDragPlaceholder.prototype
   * @param {Object} data
   * @param {Item} data.item
   * @param {Grid} data.fromGrid
   * @param {Number} data.fromIndex
   * @param {Grid} data.toGrid
   * @param {Number} data.toIndex
   */
  ItemDragPlaceholder.prototype._onMigrate = function(data) {
    // Make sure we have a matching item.
    if (data.item !== this._item) return;

    var grid = this._item.getGrid();
    var nextGrid = data.toGrid;

    // Unbind listeners from current grid.
    grid.off(eventDragReleaseEnd, this._onReleaseEnd);
    grid.off(eventLayoutStart, this._onLayoutStart);
    grid.off(eventBeforeSend, this._onMigrate);

    // Bind listeners to the next grid.
    nextGrid.on(eventDragReleaseEnd, this._onReleaseEnd);
    nextGrid.on(eventLayoutStart, this._onLayoutStart);
    nextGrid.on(eventBeforeSend, this._onMigrate);

    // Mark the item as migrated.
    this._didMigrate = true;
  };

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Create placeholder. Note that this method only writes to DOM and does not
   * read anything from DOM so it should not cause any additional layout
   * thrashing when it's called at the end of the drag start procedure.
   *
   * @public
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype.create = function() {
    // If we already have placeholder set up we can skip the initiation logic.
    if (this.isActive()) {
      this._resetAfterLayout = false;
      return;
    }

    var item = this._item;
    var grid = item.getGrid();
    var settings = grid._settings;
    var animation = this._animate;

    // Create placeholder element.
    var element;
    if (isFunction(settings.dragPlaceholder.createElement)) {
      element = settings.dragPlaceholder.createElement(item);
    } else {
      element = window.document.createElement('div');
    }
    this._element = element;

    // Update element to animation instance.
    animation._element = element;

    // Add placeholder class to the placeholder element.
    this._className = settings.itemPlaceholderClass || '';
    if (this._className) {
      addClass(element, this._className);
    }

    // Position the placeholder item correctly.
    var left = item._left + item._marginLeft;
    var top = item._top + item._marginTop;
    setStyles(element, {
      display: 'block',
      position: 'absolute',
      left: '0',
      top: '0',
      width: item._width + 'px',
      height: item._height + 'px',
      transform: getTranslateString(left, top)
    });

    // Bind event listeners.
    grid.on(eventLayoutStart, this._onLayoutStart);
    grid.on(eventDragReleaseEnd, this._onReleaseEnd);
    grid.on(eventBeforeSend, this._onMigrate);

    // onCreate hook.
    if (isFunction(settings.dragPlaceholder.onCreate)) {
      settings.dragPlaceholder.onCreate(item, element);
    }

    // Insert the placeholder element to the grid.
    grid.getElement().appendChild(element);
  };

  /**
   * Reset placeholder data.
   *
   * @public
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype.reset = function() {
    if (!this.isActive()) return;

    var element = this._element;
    var item = this._item;
    var grid = item.getGrid();
    var settings = grid._settings;
    var animation = this._animate;

    // Reset flag.
    this._resetAfterLayout = false;

    // Cancel potential (queued) layout tick.
    cancelPlaceholderTick(item._id);

    // Reset animation instance.
    animation.stop();
    animation._element = null;

    // Unbind event listeners.
    grid.off(eventDragReleaseEnd, this._onReleaseEnd);
    grid.off(eventLayoutStart, this._onLayoutStart);
    grid.off(eventBeforeSend, this._onMigrate);

    // Remove placeholder class from the placeholder element.
    if (this._className) {
      removeClass(element, this._className);
      this._className = '';
    }

    // Remove element.
    element.parentNode.removeChild(element);
    this._element = null;

    // onRemove hook. Note that here we use the current grid's onRemove callback
    // so if the item has migrated during drag the onRemove method will not be
    // the originating grid's method.
    if (isFunction(settings.dragPlaceholder.onRemove)) {
      settings.dragPlaceholder.onRemove(item, element);
    }
  };

  /**
   * Update placeholder's dimensions.
   *
   * @public
   * @memberof ItemDragPlaceholder.prototype
   * @param {Number} width
   * @param {height} height
   */
  ItemDragPlaceholder.prototype.updateDimensions = function(width, height) {
    if (this.isActive()) {
      setStyles(this._element, {
        width: width + 'px',
        height: height + 'px'
      });
    }
  };

  /**
   * Check if placeholder is currently active (visible).
   *
   * @public
   * @memberof ItemDragPlaceholder.prototype
   * @returns {Boolean}
   */
  ItemDragPlaceholder.prototype.isActive = function() {
    return !!this._element;
  };

  /**
   * Destroy placeholder instance.
   *
   * @public
   * @memberof ItemDragPlaceholder.prototype
   */
  ItemDragPlaceholder.prototype.destroy = function() {
    this.reset();
    this._animate.destroy();
    this._item = this._animate = null;
  };

  /**
   * Queue constructor.
   *
   * @class
   */
  function Queue() {
    this._queue = [];
    this._isDestroyed = false;
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Add callback to the queue.
   *
   * @public
   * @memberof Queue.prototype
   * @param {Function} callback
   * @returns {Queue}
   */
  Queue.prototype.add = function(callback) {
    if (this._isDestroyed) return this;
    this._queue.push(callback);
    return this;
  };

  /**
   * Process queue callbacks and reset the queue.
   *
   * @public
   * @memberof Queue.prototype
   * @param {*} arg1
   * @param {*} arg2
   * @returns {Queue}
   */
  Queue.prototype.flush = function(arg1, arg2) {
    if (this._isDestroyed) return this;

    var queue = this._queue;
    var length = queue.length;
    var i;

    // Quit early if the queue is empty.
    if (!length) return this;

    var singleCallback = length === 1;
    var snapshot = singleCallback ? queue[0] : queue.slice(0);

    // Reset queue.
    queue.length = 0;

    // If we only have a single callback let's just call it.
    if (singleCallback) {
      snapshot(arg1, arg2);
      return this;
    }

    // If we have multiple callbacks, let's process them.
    for (i = 0; i < length; i++) {
      snapshot[i](arg1, arg2);
      if (this._isDestroyed) break;
    }

    return this;
  };

  /**
   * Destroy Queue instance.
   *
   * @public
   * @memberof Queue.prototype
   * @returns {Queue}
   */
  Queue.prototype.destroy = function() {
    if (this._isDestroyed) return this;

    this._isDestroyed = true;
    this._queue.length = 0;

    return this;
  };

  /**
   * Layout manager for Item instance.
   *
   * @class
   * @param {Item} item
   */
  function ItemLayout(item) {
    this._item = item;
    this._isActive = false;
    this._isDestroyed = false;
    this._isInterrupted = false;
    this._currentStyles = {};
    this._targetStyles = {};
    this._currentLeft = 0;
    this._currentTop = 0;
    this._offsetLeft = 0;
    this._offsetTop = 0;
    this._skipNextAnimation = false;
    this._animateOptions = {
      onFinish: this._finish.bind(this)
    };
    this._queue = new Queue();

    // Bind animation handlers and finish method.
    this._setupAnimation = this._setupAnimation.bind(this);
    this._startAnimation = this._startAnimation.bind(this);
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Start item layout based on it's current data.
   *
   * @public
   * @memberof ItemLayout.prototype
   * @param {Boolean} [instant=false]
   * @param {Function} [onFinish]
   * @returns {ItemLayout}
   */
  ItemLayout.prototype.start = function(instant, onFinish) {
    if (this._isDestroyed) return;

    var item = this._item;
    var element = item._element;
    var release = item._release;
    var gridSettings = item.getGrid()._settings;
    var isPositioning = this._isActive;
    var isJustReleased = release._isActive && release._isPositioningStarted === false;
    var animDuration = isJustReleased
      ? gridSettings.dragReleaseDuration
      : gridSettings.layoutDuration;
    var animEasing = isJustReleased ? gridSettings.dragReleaseEasing : gridSettings.layoutEasing;
    var animEnabled = !instant && !this._skipNextAnimation && animDuration > 0;
    var isAnimating;

    // If the item is currently positioning process current layout callback
    // queue with interrupted flag on.
    if (isPositioning) this._queue.flush(true, item);

    // Mark release positioning as started.
    if (isJustReleased) release._isPositioningStarted = true;

    // Push the callback to the callback queue.
    if (isFunction(onFinish)) this._queue.add(onFinish);

    // If no animations are needed, easy peasy!
    if (!animEnabled) {
      this._updateOffsets();
      this._updateTargetStyles();
      isAnimating = item._animate.isAnimating();
      this.stop(false, this._targetStyles);
      !isAnimating && setStyles(element, this._targetStyles);
      this._skipNextAnimation = false;
      return this._finish();
    }

    // Set item active and store some data for the animation that is about to be
    // triggered.
    this._isActive = true;
    this._animateOptions.easing = animEasing;
    this._animateOptions.duration = animDuration;
    this._isInterrupted = isPositioning;

    // Start the item's layout animation in the next tick.
    addLayoutTick(item._id, this._setupAnimation, this._startAnimation);

    return this;
  };

  /**
   * Stop item's position animation if it is currently animating.
   *
   * @public
   * @memberof ItemLayout.prototype
   * @param {Boolean} [processCallbackQueue=false]
   * @param {Object} [targetStyles]
   * @returns {ItemLayout}
   */
  ItemLayout.prototype.stop = function(processCallbackQueue, targetStyles) {
    if (this._isDestroyed || !this._isActive) return this;

    var item = this._item;

    // Cancel animation init.
    cancelLayoutTick(item._id);

    // Stop animation.
    item._animate.stop(targetStyles);

    // Remove positioning class.
    removeClass(item._element, item.getGrid()._settings.itemPositioningClass);

    // Reset active state.
    this._isActive = false;

    // Process callback queue if needed.
    if (processCallbackQueue) this._queue.flush(true, item);

    return this;
  };

  /**
   * Destroy the instance and stop current animation if it is running.
   *
   * @public
   * @memberof ItemLayout.prototype
   * @returns {ItemLayout}
   */
  ItemLayout.prototype.destroy = function() {
    if (this._isDestroyed) return this;
    this.stop(true, {});
    this._queue.destroy();
    this._item = this._currentStyles = this._targetStyles = this._animateOptions = null;
    this._isDestroyed = true;
    return this;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Calculate and update item's current layout offset data.
   *
   * @private
   * @memberof ItemLayout.prototype
   */
  ItemLayout.prototype._updateOffsets = function() {
    if (this._isDestroyed) return;

    var item = this._item;
    var migrate = item._migrate;
    var release = item._release;

    this._offsetLeft = release._isActive
      ? release._containerDiffX
      : migrate._isActive
      ? migrate._containerDiffX
      : 0;

    this._offsetTop = release._isActive
      ? release._containerDiffY
      : migrate._isActive
      ? migrate._containerDiffY
      : 0;
  };

  /**
   * Calculate and update item's layout target styles.
   *
   * @private
   * @memberof ItemLayout.prototype
   */
  ItemLayout.prototype._updateTargetStyles = function() {
    if (this._isDestroyed) return;
    this._targetStyles.transform = getTranslateString(
      this._item._left + this._offsetLeft,
      this._item._top + this._offsetTop
    );
  };

  /**
   * Finish item layout procedure.
   *
   * @private
   * @memberof ItemLayout.prototype
   */
  ItemLayout.prototype._finish = function() {
    if (this._isDestroyed) return;

    var item = this._item;
    var migrate = item._migrate;
    var release = item._release;

    // Mark the item as inactive and remove positioning classes.
    if (this._isActive) {
      this._isActive = false;
      removeClass(item._element, item.getGrid()._settings.itemPositioningClass);
    }

    // Finish up release and migration.
    if (release._isActive) release.stop();
    if (migrate._isActive) migrate.stop();

    // Process the callback queue.
    this._queue.flush(false, item);
  };

  /**
   * Prepare item for layout animation.
   *
   * @private
   * @memberof ItemLayout.prototype
   */
  ItemLayout.prototype._setupAnimation = function() {
    var translate = getTranslate(this._item._element);
    this._currentLeft = translate.x;
    this._currentTop = translate.y;
  };

  /**
   * Start layout animation.
   *
   * @private
   * @memberof ItemLayout.prototype
   */
  ItemLayout.prototype._startAnimation = function() {
    var item = this._item;
    var settings = item.getGrid()._settings;

    // Let's update the offset data and target styles.
    this._updateOffsets();
    this._updateTargetStyles();

    // If the item is already in correct position let's quit early.
    if (
      item._left === this._currentLeft - this._offsetLeft &&
      item._top === this._currentTop - this._offsetTop
    ) {
      if (this._isInterrupted) this.stop(false, this._targetStyles);
      this._isActive = false;
      this._finish();
      return;
    }

    // Set item's positioning class if needed.
    if (!this._isInterrupted) {
      addClass(item._element, settings.itemPositioningClass);
    }

    // Get current styles for animation.
    this._currentStyles.transform = getTranslateString(this._currentLeft, this._currentTop);

    // Animate.
    item._animate.start(this._currentStyles, this._targetStyles, this._animateOptions);
  };

  var tempStyles = {};

  /**
   * The migrate process handler constructor.
   *
   * @class
   * @param {Item} item
   */
  function ItemMigrate(item) {
    // Private props.
    this._item = item;
    this._isActive = false;
    this._isDestroyed = false;
    this._container = false;
    this._containerDiffX = 0;
    this._containerDiffY = 0;
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Start the migrate process of an item.
   *
   * @public
   * @memberof ItemMigrate.prototype
   * @param {Grid} targetGrid
   * @param {GridSingleItemQuery} position
   * @param {HTMLElement} [container]
   * @returns {ItemMigrate}
   */
  ItemMigrate.prototype.start = function(targetGrid, position, container) {
    if (this._isDestroyed) return this;

    var item = this._item;
    var element = item._element;
    var isVisible = item.isVisible();
    var grid = item.getGrid();
    var settings = grid._settings;
    var targetSettings = targetGrid._settings;
    var targetElement = targetGrid._element;
    var targetItems = targetGrid._items;
    var currentIndex = grid._items.indexOf(item);
    var targetContainer = container || window.document.body;
    var targetIndex;
    var targetItem;
    var currentContainer;
    var offsetDiff;
    var containerDiff;
    var translate;
    var translateX;
    var translateY;

    // Get target index.
    if (typeof position === 'number') {
      targetIndex = normalizeArrayIndex(targetItems, position, true);
    } else {
      targetItem = targetGrid._getItem(position);
      /** @todo Consider throwing an error here instead of silently failing. */
      if (!targetItem) return this;
      targetIndex = targetItems.indexOf(targetItem);
    }

    // Get current translateX and translateY values if needed.
    if (item.isPositioning() || this._isActive || item.isReleasing()) {
      translate = getTranslate(element);
      translateX = translate.x;
      translateY = translate.y;
    }

    // Abort current positioning.
    if (item.isPositioning()) {
      item._layout.stop(true, { transform: getTranslateString(translateX, translateY) });
    }

    // Abort current migration.
    if (this._isActive) {
      translateX -= this._containerDiffX;
      translateY -= this._containerDiffY;
      this.stop(true, { transform: getTranslateString(translateX, translateY) });
    }

    // Abort current release.
    if (item.isReleasing()) {
      translateX -= item._release._containerDiffX;
      translateY -= item._release._containerDiffY;
      item._release.stop(true, { transform: getTranslateString(translateX, translateY) });
    }

    // Stop current visibility animations.
    item._visibility._stopAnimation();

    // Destroy current drag.
    if (item._drag) item._drag.destroy();

    // Process current visibility animation queue.
    item._visibility._queue.flush(true, item);

    // Emit beforeSend event.
    if (grid._hasListeners(eventBeforeSend)) {
      grid._emit(eventBeforeSend, {
        item: item,
        fromGrid: grid,
        fromIndex: currentIndex,
        toGrid: targetGrid,
        toIndex: targetIndex
      });
    }

    // Emit beforeReceive event.
    if (targetGrid._hasListeners(eventBeforeReceive)) {
      targetGrid._emit(eventBeforeReceive, {
        item: item,
        fromGrid: grid,
        fromIndex: currentIndex,
        toGrid: targetGrid,
        toIndex: targetIndex
      });
    }

    // Remove current classnames.
    removeClass(element, settings.itemClass);
    removeClass(element, settings.itemVisibleClass);
    removeClass(element, settings.itemHiddenClass);

    // Add new classnames.
    addClass(element, targetSettings.itemClass);
    addClass(element, isVisible ? targetSettings.itemVisibleClass : targetSettings.itemHiddenClass);

    // Move item instance from current grid to target grid.
    grid._items.splice(currentIndex, 1);
    arrayInsert(targetItems, item, targetIndex);

    // Update item's grid id reference.
    item._gridId = targetGrid._id;

    // Get current container.
    currentContainer = element.parentNode;

    // Move the item inside the target container if it's different than the
    // current container.
    if (targetContainer !== currentContainer) {
      targetContainer.appendChild(element);
      offsetDiff = getOffsetDiff(targetContainer, currentContainer, true);
      if (!translate) {
        translate = getTranslate(element);
        translateX = translate.x;
        translateY = translate.y;
      }
      element.style[transformProp] = getTranslateString(
        translateX + offsetDiff.left,
        translateY + offsetDiff.top
      );
    }

    // Update child element's styles to reflect the current visibility state.
    item._child.removeAttribute('style');
    setStyles(item._child, isVisible ? targetSettings.visibleStyles : targetSettings.hiddenStyles);

    // Update display style.
    element.style.display = isVisible ? 'block' : 'hidden';

    // Get offset diff for the migration data.
    containerDiff = getOffsetDiff(targetContainer, targetElement, true);

    // Update item's cached dimensions and sort data.
    item._refreshDimensions();
    item._refreshSortData();

    // Create new drag handler.
    item._drag = targetSettings.dragEnabled ? new ItemDrag(item) : null;

    // Setup migration data.
    this._isActive = true;
    this._container = targetContainer;
    this._containerDiffX = containerDiff.left;
    this._containerDiffY = containerDiff.top;

    // Emit send event.
    if (grid._hasListeners(eventSend)) {
      grid._emit(eventSend, {
        item: item,
        fromGrid: grid,
        fromIndex: currentIndex,
        toGrid: targetGrid,
        toIndex: targetIndex
      });
    }

    // Emit receive event.
    if (targetGrid._hasListeners(eventReceive)) {
      targetGrid._emit(eventReceive, {
        item: item,
        fromGrid: grid,
        fromIndex: currentIndex,
        toGrid: targetGrid,
        toIndex: targetIndex
      });
    }

    return this;
  };

  /**
   * End the migrate process of an item. This method can be used to abort an
   * ongoing migrate process (animation) or finish the migrate process.
   *
   * @public
   * @memberof ItemMigrate.prototype
   * @param {Boolean} [abort=false]
   *  - Should the migration be aborted?
   * @param {Object} [currentStyles]
   *  - Optional current translateX and translateY styles.
   * @returns {ItemMigrate}
   */
  ItemMigrate.prototype.stop = function(abort, currentStyles) {
    if (this._isDestroyed || !this._isActive) return this;

    var item = this._item;
    var element = item._element;
    var grid = item.getGrid();
    var gridElement = grid._element;
    var translate;

    if (this._container !== gridElement) {
      if (!currentStyles) {
        if (abort) {
          translate = getTranslate(element);
          tempStyles.transform = getTranslateString(
            translate.x - this._containerDiffX,
            translate.y - this._containerDiffY
          );
        } else {
          tempStyles.transform = getTranslateString(item._left, item._top);
        }
        currentStyles = tempStyles;
      }
      gridElement.appendChild(element);
      setStyles(element, currentStyles);
    }

    this._isActive = false;
    this._container = null;
    this._containerDiffX = 0;
    this._containerDiffY = 0;

    return this;
  };

  /**
   * Destroy instance.
   *
   * @public
   * @memberof ItemMigrate.prototype
   * @returns {ItemMigrate}
   */
  ItemMigrate.prototype.destroy = function() {
    if (this._isDestroyed) return this;
    this.stop(true);
    this._item = null;
    this._isDestroyed = true;
    return this;
  };

  var tempStyles$1 = {};

  /**
   * The release process handler constructor. Although this might seem as proper
   * fit for the drag process this needs to be separated into it's own logic
   * because there might be a scenario where drag is disabled, but the release
   * process still needs to be implemented (dragging from a grid to another).
   *
   * @class
   * @param {Item} item
   */
  function ItemRelease(item) {
    this._item = item;
    this._isActive = false;
    this._isDestroyed = false;
    this._isPositioningStarted = false;
    this._containerDiffX = 0;
    this._containerDiffY = 0;
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Start the release process of an item.
   *
   * @public
   * @memberof ItemRelease.prototype
   * @returns {ItemRelease}
   */
  ItemRelease.prototype.start = function() {
    if (this._isDestroyed || this._isActive) return this;

    var item = this._item;
    var grid = item.getGrid();

    // Flag release as active.
    this._isActive = true;

    // Add release class name to the released element.
    addClass(item._element, grid._settings.itemReleasingClass);

    // Emit dragReleaseStart event.
    grid._emit(eventDragReleaseStart, item);

    // Position the released item.
    item._layout.start(false);

    return this;
  };

  /**
   * End the release process of an item. This method can be used to abort an
   * ongoing release process (animation) or finish the release process.
   *
   * @public
   * @memberof ItemRelease.prototype
   * @param {Boolean} [abort=false]
   *  - Should the release be aborted? When true, the release end event won't be
   *    emitted. Set to true only when you need to abort the release process
   *    while the item is animating to it's position.
   * @param {Object} [currentStyles]
   *  - Optional current translateX and translateY styles.
   * @returns {ItemRelease}
   */
  ItemRelease.prototype.stop = function(abort, currentStyles) {
    if (this._isDestroyed || !this._isActive) return this;

    var item = this._item;
    var element = item._element;
    var grid = item.getGrid();
    var container = grid._element;
    var translate;

    // Reset data and remove releasing class name from the element.
    this._reset();

    // If the released element is outside the grid's container element put it
    // back there and adjust position accordingly.
    if (element.parentNode !== container) {
      if (!currentStyles) {
        if (abort) {
          translate = getTranslate(element);
          tempStyles$1.transform = getTranslateString(
            translate.x - this._containerDiffX,
            translate.y - this._containerDiffY
          );
        } else {
          tempStyles$1.transform = getTranslateString(item._left, item._top);
        }
        currentStyles = tempStyles$1;
      }
      container.appendChild(element);
      setStyles(element, currentStyles);
    }

    // Emit dragReleaseEnd event.
    if (!abort) grid._emit(eventDragReleaseEnd, item);

    return this;
  };

  /**
   * Destroy instance.
   *
   * @public
   * @memberof ItemRelease.prototype
   * @returns {ItemRelease}
   */
  ItemRelease.prototype.destroy = function() {
    if (this._isDestroyed) return this;
    this.stop(true);
    this._item = null;
    this._isDestroyed = true;
    return this;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Reset public data and remove releasing class.
   *
   * @private
   * @memberof ItemRelease.prototype
   */
  ItemRelease.prototype._reset = function() {
    if (this._isDestroyed) return;
    var item = this._item;
    this._isActive = false;
    this._isPositioningStarted = false;
    this._containerDiffX = 0;
    this._containerDiffY = 0;
    removeClass(item._element, item.getGrid()._settings.itemReleasingClass);
  };

  /**
   * Get current values of the provided styles definition object.
   *
   * @param {HTMLElement} element
   * @param {Object} styles
   * @return {Object}
   */
  function getCurrentStyles(element, styles) {
    var current = {};
    for (var prop in styles) {
      current[prop] = getStyle(element, getStyleName(prop));
    }
    return current;
  }

  /**
   * Visibility manager for Item instance.
   *
   * @class
   * @param {Item} item
   */
  function ItemVisibility(item) {
    var isActive = item._isActive;
    var element = item._element;
    var settings = item.getGrid()._settings;

    this._item = item;
    this._isDestroyed = false;

    // Set up visibility states.
    this._isHidden = !isActive;
    this._isHiding = false;
    this._isShowing = false;

    // Callback queue.
    this._queue = new Queue();

    // Bind show/hide finishers.
    this._finishShow = this._finishShow.bind(this);
    this._finishHide = this._finishHide.bind(this);

    // Force item to be either visible or hidden on init.
    element.style.display = isActive ? 'block' : 'none';

    // Set visible/hidden class.
    addClass(element, isActive ? settings.itemVisibleClass : settings.itemHiddenClass);

    // Set initial styles for the child element.
    setStyles(item._child, isActive ? settings.visibleStyles : settings.hiddenStyles);
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Show item.
   *
   * @public
   * @memberof ItemVisibility.prototype
   * @param {Boolean} instant
   * @param {Function} [onFinish]
   * @returns {ItemVisibility}
   */
  ItemVisibility.prototype.show = function(instant, onFinish) {
    if (this._isDestroyed) return this;

    var item = this._item;
    var element = item._element;
    var queue = this._queue;
    var callback = isFunction(onFinish) ? onFinish : null;
    var grid = item.getGrid();
    var settings = grid._settings;

    // If item is visible call the callback and be done with it.
    if (!this._isShowing && !this._isHidden) {
      callback && callback(false, item);
      return this;
    }

    // If item is showing and does not need to be shown instantly, let's just
    // push callback to the callback queue and be done with it.
    if (this._isShowing && !instant) {
      callback && queue.add(callback);
      return this;
    }

    // If the item is hiding or hidden process the current visibility callback
    // queue with the interrupted flag active, update classes and set display
    // to block if necessary.
    if (!this._isShowing) {
      queue.flush(true, item);
      removeClass(element, settings.itemHiddenClass);
      addClass(element, settings.itemVisibleClass);
      if (!this._isHiding) element.style.display = 'block';
    }

    // Push callback to the callback queue.
    callback && queue.add(callback);

    // Update visibility states.
    item._isActive = this._isShowing = true;
    this._isHiding = this._isHidden = false;

    // Finally let's start show animation.
    this._startAnimation(true, instant, this._finishShow);

    return this;
  };

  /**
   * Hide item.
   *
   * @public
   * @memberof ItemVisibility.prototype
   * @param {Boolean} instant
   * @param {Function} [onFinish]
   * @returns {ItemVisibility}
   */
  ItemVisibility.prototype.hide = function(instant, onFinish) {
    if (this._isDestroyed) return this;

    var item = this._item;
    var element = item._element;
    var queue = this._queue;
    var callback = isFunction(onFinish) ? onFinish : null;
    var grid = item.getGrid();
    var settings = grid._settings;

    // If item is already hidden call the callback and be done with it.
    if (!this._isHiding && this._isHidden) {
      callback && callback(false, item);
      return this;
    }

    // If item is hiding and does not need to be hidden instantly, let's just
    // push callback to the callback queue and be done with it.
    if (this._isHiding && !instant) {
      callback && queue.add(callback);
      return this;
    }

    // If the item is showing or visible process the current visibility callback
    // queue with the interrupted flag active, update classes and set display
    // to block if necessary.
    if (!this._isHiding) {
      queue.flush(true, item);
      addClass(element, settings.itemHiddenClass);
      removeClass(element, settings.itemVisibleClass);
    }

    // Push callback to the callback queue.
    callback && queue.add(callback);

    // Update visibility states.
    this._isHidden = this._isHiding = true;
    item._isActive = this._isShowing = false;

    // Finally let's start hide animation.
    this._startAnimation(false, instant, this._finishHide);

    return this;
  };

  /**
   * Destroy the instance and stop current animation if it is running.
   *
   * @public
   * @memberof ItemVisibility.prototype
   * @returns {ItemVisibility}
   */
  ItemVisibility.prototype.destroy = function() {
    if (this._isDestroyed) return this;

    var item = this._item;
    var element = item._element;
    var grid = item.getGrid();
    var queue = this._queue;
    var settings = grid._settings;

    // Stop visibility animation.
    this._stopAnimation({});

    // Fire all uncompleted callbacks with interrupted flag and destroy the queue.
    queue.flush(true, item).destroy();

    // Remove visible/hidden classes.
    removeClass(element, settings.itemVisibleClass);
    removeClass(element, settings.itemHiddenClass);

    // Reset state.
    this._item = null;
    this._isHiding = this._isShowing = false;
    this._isDestroyed = this._isHidden = true;

    return this;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Start visibility animation.
   *
   * @private
   * @memberof ItemVisibility.prototype
   * @param {Boolean} toVisible
   * @param {Boolean} [instant]
   * @param {Function} [onFinish]
   */
  ItemVisibility.prototype._startAnimation = function(toVisible, instant, onFinish) {
    if (this._isDestroyed) return;

    var item = this._item;
    var settings = item.getGrid()._settings;
    var targetStyles = toVisible ? settings.visibleStyles : settings.hiddenStyles;
    var duration = parseInt(toVisible ? settings.showDuration : settings.hideDuration) || 0;
    var easing = (toVisible ? settings.showEasing : settings.hideEasing) || 'ease';
    var isInstant = instant || duration <= 0;
    var currentStyles;

    // No target styles? Let's quit early.
    if (!targetStyles) {
      onFinish && onFinish();
      return;
    }

    // Cancel queued visibility tick.
    cancelVisibilityTick(item._id);

    // If we need to apply the styles instantly without animation.
    if (isInstant) {
      if (item._animateChild.isAnimating()) {
        item._animateChild.stop(targetStyles);
      } else {
        setStyles(item._child, targetStyles);
      }
      onFinish && onFinish();
      return;
    }

    // Start the animation in the next tick (to avoid layout thrashing).
    addVisibilityTick(
      item._id,
      function() {
        currentStyles = getCurrentStyles(item._child, targetStyles);
      },
      function() {
        item._animateChild.start(currentStyles, targetStyles, {
          duration: duration,
          easing: easing,
          onFinish: onFinish
        });
      }
    );
  };

  /**
   * Stop visibility animation.
   *
   * @private
   * @memberof ItemVisibility.prototype
   * @param {Object} [targetStyles]
   */
  ItemVisibility.prototype._stopAnimation = function(targetStyles) {
    if (this._isDestroyed) return;
    var item = this._item;
    cancelVisibilityTick(item._id);
    item._animateChild.stop(targetStyles);
  };

  /**
   * Finish show procedure.
   *
   * @private
   * @memberof ItemVisibility.prototype
   */
  ItemVisibility.prototype._finishShow = function() {
    if (this._isHidden) return;
    this._isShowing = false;
    this._queue.flush(false, this._item);
  };

  /**
   * Finish hide procedure.
   *
   * @private
   * @memberof ItemVisibility.prototype
   */
  var finishStyles = {};
  ItemVisibility.prototype._finishHide = function() {
    if (!this._isHidden) return;
    var item = this._item;
    this._isHiding = false;
    finishStyles.transform = getTranslateString(0, 0);
    item._layout.stop(true, finishStyles);
    item._element.style.display = 'none';
    this._queue.flush(false, item);
  };

  var id = 0;

  /**
   * Returns a unique numeric id (increments a base value on every call).
   * @returns {Number}
   */
  function createUid() {
    return ++id;
  }

  /**
   * Creates a new Item instance for a Grid instance.
   *
   * @class
   * @param {Grid} grid
   * @param {HTMLElement} element
   * @param {Boolean} [isActive]
   */
  function Item(grid, element, isActive) {
    var settings = grid._settings;

    // Create instance id.
    this._id = createUid();

    // Reference to connected Grid instance's id.
    this._gridId = grid._id;

    // Destroyed flag.
    this._isDestroyed = false;

    // Set up initial positions.
    this._left = 0;
    this._top = 0;

    // The elements.
    this._element = element;
    this._child = element.children[0];

    // If the provided item element is not a direct child of the grid container
    // element, append it to the grid container.
    if (element.parentNode !== grid._element) {
      grid._element.appendChild(element);
    }

    // Set item class.
    addClass(element, settings.itemClass);

    // If isActive is not defined, let's try to auto-detect it.
    if (typeof isActive !== 'boolean') {
      isActive = getStyle(element, 'display') !== 'none';
    }

    // Set up active state (defines if the item is considered part of the layout
    // or not).
    this._isActive = isActive;

    // Set element's initial position styles.
    element.style.left = '0';
    element.style.top = '0';
    element.style[transformProp] = getTranslateString(0, 0);

    // Initiate item's animation controllers.
    this._animate = new ItemAnimate(element);
    this._animateChild = new ItemAnimate(this._child);

    // Setup visibility handler.
    this._visibility = new ItemVisibility(this);

    // Set up layout handler.
    this._layout = new ItemLayout(this);

    // Set up migration handler data.
    this._migrate = new ItemMigrate(this);

    // Set up release handler. Note that although this is fully linked to dragging
    // this still needs to be always instantiated to handle migration scenarios
    // correctly.
    this._release = new ItemRelease(this);

    // Set up drag placeholder handler. Note that although this is fully linked to
    // dragging this still needs to be always instantiated to handle migration
    // scenarios correctly.
    this._dragPlaceholder = new ItemDragPlaceholder(this);

    // Set up drag handler.
    this._drag = settings.dragEnabled ? new ItemDrag(this) : null;

    // Set up the initial dimensions and sort data.
    this._refreshDimensions();
    this._refreshSortData();
  }

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Get the instance grid reference.
   *
   * @public
   * @memberof Item.prototype
   * @returns {Grid}
   */
  Item.prototype.getGrid = function() {
    return gridInstances[this._gridId];
  };

  /**
   * Get the instance element.
   *
   * @public
   * @memberof Item.prototype
   * @returns {HTMLElement}
   */
  Item.prototype.getElement = function() {
    return this._element;
  };

  /**
   * Get instance element's cached width.
   *
   * @public
   * @memberof Item.prototype
   * @returns {Number}
   */
  Item.prototype.getWidth = function() {
    return this._width;
  };

  /**
   * Get instance element's cached height.
   *
   * @public
   * @memberof Item.prototype
   * @returns {Number}
   */
  Item.prototype.getHeight = function() {
    return this._height;
  };

  /**
   * Get instance element's cached margins.
   *
   * @public
   * @memberof Item.prototype
   * @returns {Object}
   *   - The returned object contains left, right, top and bottom properties
   *     which indicate the item element's cached margins.
   */
  Item.prototype.getMargin = function() {
    return {
      left: this._marginLeft,
      right: this._marginRight,
      top: this._marginTop,
      bottom: this._marginBottom
    };
  };

  /**
   * Get instance element's cached position.
   *
   * @public
   * @memberof Item.prototype
   * @returns {Object}
   *   - The returned object contains left and top properties which indicate the
   *     item element's cached position in the grid.
   */
  Item.prototype.getPosition = function() {
    return {
      left: this._left,
      top: this._top
    };
  };

  /**
   * Is the item active?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isActive = function() {
    return this._isActive;
  };

  /**
   * Is the item visible?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isVisible = function() {
    return !!this._visibility && !this._visibility._isHidden;
  };

  /**
   * Is the item being animated to visible?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isShowing = function() {
    return !!(this._visibility && this._visibility._isShowing);
  };

  /**
   * Is the item being animated to hidden?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isHiding = function() {
    return !!(this._visibility && this._visibility._isHiding);
  };

  /**
   * Is the item positioning?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isPositioning = function() {
    return !!(this._layout && this._layout._isActive);
  };

  /**
   * Is the item being dragged?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isDragging = function() {
    return !!(this._drag && this._drag._isActive);
  };

  /**
   * Is the item being released?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isReleasing = function() {
    return !!(this._release && this._release._isActive);
  };

  /**
   * Is the item destroyed?
   *
   * @public
   * @memberof Item.prototype
   * @returns {Boolean}
   */
  Item.prototype.isDestroyed = function() {
    return this._isDestroyed;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Recalculate item's dimensions.
   *
   * @private
   * @memberof Item.prototype
   */
  Item.prototype._refreshDimensions = function() {
    if (this._isDestroyed || this._visibility._isHidden) return;

    var element = this._element;
    var dragPlaceholder = this._dragPlaceholder;
    var rect = element.getBoundingClientRect();

    // Calculate width and height.
    this._width = rect.width;
    this._height = rect.height;

    // Calculate margins (ignore negative margins).
    this._marginLeft = Math.max(0, getStyleAsFloat(element, 'margin-left'));
    this._marginRight = Math.max(0, getStyleAsFloat(element, 'margin-right'));
    this._marginTop = Math.max(0, getStyleAsFloat(element, 'margin-top'));
    this._marginBottom = Math.max(0, getStyleAsFloat(element, 'margin-bottom'));

    // Keep drag placeholder's dimensions synced with the item's.
    if (dragPlaceholder) {
      dragPlaceholder.updateDimensions(this._width, this._height);
    }
  };

  /**
   * Fetch and store item's sort data.
   *
   * @private
   * @memberof Item.prototype
   */
  Item.prototype._refreshSortData = function() {
    if (this._isDestroyed) return;

    var data = (this._sortData = {});
    var getters = this.getGrid()._settings.sortData;
    var prop;

    for (prop in getters) {
      data[prop] = getters[prop](this, this._element);
    }
  };

  /**
   * Destroy item instance.
   *
   * @private
   * @memberof Item.prototype
   * @param {Boolean} [removeElement=false]
   */
  Item.prototype._destroy = function(removeElement) {
    if (this._isDestroyed) return;

    var element = this._element;
    var grid = this.getGrid();
    var settings = grid._settings;
    var index = grid._items.indexOf(this);

    // Destroy handlers.
    this._release.destroy();
    this._migrate.destroy();
    this._layout.destroy();
    this._visibility.destroy();
    this._animate.destroy();
    this._animateChild.destroy();
    this._dragPlaceholder.destroy();
    this._drag && this._drag.destroy();

    // Remove all inline styles.
    element.removeAttribute('style');
    this._child.removeAttribute('style');

    // Remove item class.
    removeClass(element, settings.itemClass);

    // Remove item from Grid instance if it still exists there.
    index > -1 && grid._items.splice(index, 1);

    // Remove element from DOM.
    removeElement && element.parentNode.removeChild(element);

    // Reset state.
    this._isActive = false;
    this._isDestroyed = true;
  };

  /**
   * This is the default layout algorithm for Muuri. Based on MAXRECTS approach
   * as described by Jukka JylÃ¤nki in his survey: "A Thousand Ways to Pack the
   * Bin - A Practical Approach to Two-Dimensional Rectangle Bin Packing.".
   *
   * @class
   */
  function Packer() {
    this._slots = [];
    this._slotSizes = [];
    this._freeSlots = [];
    this._newSlots = [];
    this._rectItem = {};
    this._rectStore = [];
    this._rectId = 0;

    // The layout return data, which will be populated in getLayout.
    this._layout = {
      slots: null,
      setWidth: false,
      setHeight: false,
      width: false,
      height: false
    };

    // Bind sort handlers.
    this._sortRectsLeftTop = this._sortRectsLeftTop.bind(this);
    this._sortRectsTopLeft = this._sortRectsTopLeft.bind(this);
  }

  /**
   * @public
   * @memberof Packer.prototype
   * @param {Item[]} items
   * @param {Number} width
   * @param {Number} height
   * @param {Number[]} [slots]
   * @param {Object} [options]
   * @param {Boolean} [options.fillGaps=false]
   * @param {Boolean} [options.horizontal=false]
   * @param {Boolean} [options.alignRight=false]
   * @param {Boolean} [options.alignBottom=false]
   * @returns {LayoutData}
   */
  Packer.prototype.getLayout = function(items, width, height, slots, options) {
    var layout = this._layout;
    var fillGaps = !!(options && options.fillGaps);
    var isHorizontal = !!(options && options.horizontal);
    var alignRight = !!(options && options.alignRight);
    var alignBottom = !!(options && options.alignBottom);
    var rounding = !!(options && options.rounding);
    var slotSizes = this._slotSizes;
    var i;

    // Reset layout data.
    layout.slots = slots ? slots : this._slots;
    layout.width = isHorizontal ? 0 : rounding ? Math.round(width) : width;
    layout.height = !isHorizontal ? 0 : rounding ? Math.round(height) : height;
    layout.setWidth = isHorizontal;
    layout.setHeight = !isHorizontal;

    // Make sure slots and slot size arrays are reset.
    layout.slots.length = 0;
    slotSizes.length = 0;

    // No need to go further if items do not exist.
    if (!items.length) return layout;

    // Find slots for items.
    for (i = 0; i < items.length; i++) {
      this._addSlot(items[i], isHorizontal, fillGaps, rounding, alignRight || alignBottom);
    }

    // If the alignment is set to right we need to adjust the results.
    if (alignRight) {
      for (i = 0; i < layout.slots.length; i = i + 2) {
        layout.slots[i] = layout.width - (layout.slots[i] + slotSizes[i]);
      }
    }

    // If the alignment is set to bottom we need to adjust the results.
    if (alignBottom) {
      for (i = 1; i < layout.slots.length; i = i + 2) {
        layout.slots[i] = layout.height - (layout.slots[i] + slotSizes[i]);
      }
    }

    // Reset slots arrays and rect id.
    slotSizes.length = 0;
    this._freeSlots.length = 0;
    this._newSlots.length = 0;
    this._rectId = 0;

    return layout;
  };

  /**
   * Calculate position for the layout item. Returns the left and top position
   * of the item in pixels.
   *
   * @private
   * @memberof Packer.prototype
   * @param {Item} item
   * @param {Boolean} isHorizontal
   * @param {Boolean} fillGaps
   * @param {Boolean} rounding
   * @returns {Array}
   */
  Packer.prototype._addSlot = (function() {
    var eps = 0.001;
    var itemSlot = {};
    return function(item, isHorizontal, fillGaps, rounding, trackSize) {
      var layout = this._layout;
      var freeSlots = this._freeSlots;
      var newSlots = this._newSlots;
      var rect;
      var rectId;
      var potentialSlots;
      var ignoreCurrentSlots;
      var i;
      var ii;

      // Reset new slots.
      newSlots.length = 0;

      // Set item slot initial data.
      itemSlot.left = null;
      itemSlot.top = null;
      itemSlot.width = item._width + item._marginLeft + item._marginRight;
      itemSlot.height = item._height + item._marginTop + item._marginBottom;

      // Round item slot width and height if needed.
      if (rounding) {
        itemSlot.width = Math.round(itemSlot.width);
        itemSlot.height = Math.round(itemSlot.height);
      }

      // Try to find a slot for the item.
      for (i = 0; i < freeSlots.length; i++) {
        rectId = freeSlots[i];
        if (!rectId) continue;
        rect = this._getRect(rectId);
        if (itemSlot.width <= rect.width + eps && itemSlot.height <= rect.height + eps) {
          itemSlot.left = rect.left;
          itemSlot.top = rect.top;
          break;
        }
      }

      // If no slot was found for the item.
      if (itemSlot.left === null) {
        // Position the item in to the bottom left (vertical mode) or top right
        // (horizontal mode) of the grid.
        itemSlot.left = !isHorizontal ? 0 : layout.width;
        itemSlot.top = !isHorizontal ? layout.height : 0;

        // If gaps don't need filling do not add any current slots to the new
        // slots array.
        if (!fillGaps) {
          ignoreCurrentSlots = true;
        }
      }

      // In vertical mode, if the item's bottom overlaps the grid's bottom.
      if (!isHorizontal && itemSlot.top + itemSlot.height > layout.height) {
        // If item is not aligned to the left edge, create a new slot.
        if (itemSlot.left > 0) {
          newSlots.push(this._addRect(0, layout.height, itemSlot.left, Infinity));
        }

        // If item is not aligned to the right edge, create a new slot.
        if (itemSlot.left + itemSlot.width < layout.width) {
          newSlots.push(
            this._addRect(
              itemSlot.left + itemSlot.width,
              layout.height,
              layout.width - itemSlot.left - itemSlot.width,
              Infinity
            )
          );
        }

        // Update grid height.
        layout.height = itemSlot.top + itemSlot.height;
      }

      // In horizontal mode, if the item's right overlaps the grid's right edge.
      if (isHorizontal && itemSlot.left + itemSlot.width > layout.width) {
        // If item is not aligned to the top, create a new slot.
        if (itemSlot.top > 0) {
          newSlots.push(this._addRect(layout.width, 0, Infinity, itemSlot.top));
        }

        // If item is not aligned to the bottom, create a new slot.
        if (itemSlot.top + itemSlot.height < layout.height) {
          newSlots.push(
            this._addRect(
              layout.width,
              itemSlot.top + itemSlot.height,
              Infinity,
              layout.height - itemSlot.top - itemSlot.height
            )
          );
        }

        // Update grid width.
        layout.width = itemSlot.left + itemSlot.width;
      }

      // Clean up the current slots making sure there are no old slots that
      // overlap with the item. If an old slot overlaps with the item, split it
      // into smaller slots if necessary.
      for (i = fillGaps ? 0 : ignoreCurrentSlots ? freeSlots.length : i; i < freeSlots.length; i++) {
        rectId = freeSlots[i];
        if (!rectId) continue;
        rect = this._getRect(rectId);
        potentialSlots = this._splitRect(rect, itemSlot);
        for (ii = 0; ii < potentialSlots.length; ii++) {
          rectId = potentialSlots[ii];
          rect = this._getRect(rectId);
          // Let's make sure here that we have a big enough slot
          // (width/height > 0.49px) and also let's make sure that the slot is
          // within the boundaries of the grid.
          if (
            rect.width > 0.49 &&
            rect.height > 0.49 &&
            ((!isHorizontal && rect.top < layout.height) ||
              (isHorizontal && rect.left < layout.width))
          ) {
            newSlots.push(rectId);
          }
        }
      }

      // Sanitize new slots.
      if (newSlots.length) {
        this._purgeRects(newSlots).sort(
          isHorizontal ? this._sortRectsLeftTop : this._sortRectsTopLeft
        );
      }

      // Update layout width/height.
      if (isHorizontal) {
        layout.width = Math.max(layout.width, itemSlot.left + itemSlot.width);
      } else {
        layout.height = Math.max(layout.height, itemSlot.top + itemSlot.height);
      }

      // Add item slot data to layout slots (and store the slot size for later
      // usage too if necessary).
      layout.slots.push(itemSlot.left, itemSlot.top);
      if (trackSize) this._slotSizes.push(itemSlot.width, itemSlot.height);

      // Free/new slots switcheroo!
      this._freeSlots = newSlots;
      this._newSlots = freeSlots;
    };
  })();

  /**
   * Add a new rectangle to the rectangle store. Returns the id of the new
   * rectangle.
   *
   * @private
   * @memberof Packer.prototype
   * @param {Number} left
   * @param {Number} top
   * @param {Number} width
   * @param {Number} height
   * @returns {RectId}
   */
  Packer.prototype._addRect = function(left, top, width, height) {
    var rectId = ++this._rectId;
    var rectStore = this._rectStore;

    rectStore[rectId] = left || 0;
    rectStore[++this._rectId] = top || 0;
    rectStore[++this._rectId] = width || 0;
    rectStore[++this._rectId] = height || 0;

    return rectId;
  };

  /**
   * Get rectangle data from the rectangle store by id. Optionally you can
   * provide a target object where the rectangle data will be written in. By
   * default an internal object is reused as a target object.
   *
   * @private
   * @memberof Packer.prototype
   * @param {RectId} id
   * @param {Object} [target]
   * @returns {Object}
   */
  Packer.prototype._getRect = function(id, target) {
    var rectItem = target ? target : this._rectItem;
    var rectStore = this._rectStore;

    rectItem.left = rectStore[id] || 0;
    rectItem.top = rectStore[++id] || 0;
    rectItem.width = rectStore[++id] || 0;
    rectItem.height = rectStore[++id] || 0;

    return rectItem;
  };

  /**
   * Punch a hole into a rectangle and split the remaining area into smaller
   * rectangles (4 at max).
   *
   * @private
   * @memberof Packer.prototype
   * @param {Rectangle} rect
   * @param {Rectangle} hole
   * @returns {RectId[]}
   */
  Packer.prototype._splitRect = (function() {
    var results = [];
    return function(rect, hole) {
      // Reset old results.
      results.length = 0;

      // If the rect does not overlap with the hole add rect to the return data
      // as is.
      if (!this._doRectsOverlap(rect, hole)) {
        results.push(this._addRect(rect.left, rect.top, rect.width, rect.height));
        return results;
      }

      // Left split.
      if (rect.left < hole.left) {
        results.push(this._addRect(rect.left, rect.top, hole.left - rect.left, rect.height));
      }

      // Right split.
      if (rect.left + rect.width > hole.left + hole.width) {
        results.push(
          this._addRect(
            hole.left + hole.width,
            rect.top,
            rect.left + rect.width - (hole.left + hole.width),
            rect.height
          )
        );
      }

      // Top split.
      if (rect.top < hole.top) {
        results.push(this._addRect(rect.left, rect.top, rect.width, hole.top - rect.top));
      }

      // Bottom split.
      if (rect.top + rect.height > hole.top + hole.height) {
        results.push(
          this._addRect(
            rect.left,
            hole.top + hole.height,
            rect.width,
            rect.top + rect.height - (hole.top + hole.height)
          )
        );
      }

      return results;
    };
  })();

  /**
   * Check if two rectangles overlap.
   *
   * @private
   * @memberof Packer.prototype
   * @param {Rectangle} a
   * @param {Rectangle} b
   * @returns {Boolean}
   */
  Packer.prototype._doRectsOverlap = function(a, b) {
    return !(
      a.left + a.width <= b.left ||
      b.left + b.width <= a.left ||
      a.top + a.height <= b.top ||
      b.top + b.height <= a.top
    );
  };

  /**
   * Check if a rectangle is fully within another rectangle.
   *
   * @private
   * @memberof Packer.prototype
   * @param {Rectangle} a
   * @param {Rectangle} b
   * @returns {Boolean}
   */
  Packer.prototype._isRectWithinRect = function(a, b) {
    return (
      a.left >= b.left &&
      a.top >= b.top &&
      a.left + a.width <= b.left + b.width &&
      a.top + a.height <= b.top + b.height
    );
  };

  /**
   * Loops through an array of rectangle ids and resets all that are fully
   * within another rectangle in the array. Resetting in this case means that
   * the rectangle id value is replaced with zero.
   *
   * @private
   * @memberof Packer.prototype
   * @param {RectId[]} rectIds
   * @returns {RectId[]}
   */
  Packer.prototype._purgeRects = (function() {
    var rectA = {};
    var rectB = {};
    return function(rectIds) {
      var i = rectIds.length;
      var ii;

      while (i--) {
        ii = rectIds.length;
        if (!rectIds[i]) continue;
        this._getRect(rectIds[i], rectA);
        while (ii--) {
          if (!rectIds[ii] || i === ii) continue;
          if (this._isRectWithinRect(rectA, this._getRect(rectIds[ii], rectB))) {
            rectIds[i] = 0;
            break;
          }
        }
      }

      return rectIds;
    };
  })();

  /**
   * Sort rectangles with top-left gravity.
   *
   * @private
   * @memberof Packer.prototype
   * @param {RectId} aId
   * @param {RectId} bId
   * @returns {Number}
   */
  Packer.prototype._sortRectsTopLeft = (function() {
    var rectA = {};
    var rectB = {};
    return function(aId, bId) {
      this._getRect(aId, rectA);
      this._getRect(bId, rectB);
      // prettier-ignore
      return rectA.top < rectB.top ? -1 :
             rectA.top > rectB.top ? 1 :
             rectA.left < rectB.left ? -1 :
             rectA.left > rectB.left ? 1 : 0;
    };
  })();

  /**
   * Sort rectangles with left-top gravity.
   *
   * @private
   * @memberof Packer.prototype
   * @param {RectId} aId
   * @param {RectId} bId
   * @returns {Number}
   */
  Packer.prototype._sortRectsLeftTop = (function() {
    var rectA = {};
    var rectB = {};
    return function(aId, bId) {
      this._getRect(aId, rectA);
      this._getRect(bId, rectB);
      // prettier-ignore
      return rectA.left < rectB.left ? -1 :
             rectA.left > rectB.left ? 1 :
             rectA.top < rectB.top ? -1 :
             rectA.top > rectB.top ? 1 : 0;
    };
  })();

  var htmlCollectionType = '[object HTMLCollection]';
  var nodeListType = '[object NodeList]';

  /**
   * Check if a value is a node list
   *
   * @param {*} val
   * @returns {Boolean}
   */
  function isNodeList(val) {
    var type = Object.prototype.toString.call(val);
    return type === htmlCollectionType || type === nodeListType;
  }

  var objectType = 'object';
  var objectToStringType = '[object Object]';
  var toString = Object.prototype.toString;

  /**
   * Check if a value is a plain object.
   *
   * @param {*} val
   * @returns {Boolean}
   */
  function isPlainObject(val) {
    return typeof val === objectType && toString.call(val) === objectToStringType;
  }

  /**
   * Converts a value to an array or clones an array.
   *
   * @param {*} target
   * @returns {Array}
   */
  function toArray(target) {
    return isNodeList(target) ? Array.prototype.slice.call(target) : Array.prototype.concat(target);
  }

  var packer = new Packer();
  var noop = function() {};

  var numberType$1 = 'number';
  var stringType = 'string';
  var instantLayout = 'instant';

  /**
   * Creates a new Grid instance.
   *
   * @class
   * @param {(HTMLElement|String)} element
   * @param {Object} [options]
   * @param {?(HTMLElement[]|NodeList|String)} [options.items]
   * @param {Number} [options.showDuration=300]
   * @param {String} [options.showEasing="ease"]
   * @param {Object} [options.visibleStyles]
   * @param {Number} [options.hideDuration=300]
   * @param {String} [options.hideEasing="ease"]
   * @param {Object} [options.hiddenStyles]
   * @param {(Function|Object)} [options.layout]
   * @param {Boolean} [options.layout.fillGaps=false]
   * @param {Boolean} [options.layout.horizontal=false]
   * @param {Boolean} [options.layout.alignRight=false]
   * @param {Boolean} [options.layout.alignBottom=false]
   * @param {Boolean} [options.layout.rounding=true]
   * @param {(Boolean|Number)} [options.layoutOnResize=100]
   * @param {Boolean} [options.layoutOnInit=true]
   * @param {Number} [options.layoutDuration=300]
   * @param {String} [options.layoutEasing="ease"]
   * @param {?Object} [options.sortData=null]
   * @param {Boolean} [options.dragEnabled=false]
   * @param {?HtmlElement} [options.dragContainer=null]
   * @param {?Function} [options.dragStartPredicate]
   * @param {Number} [options.dragStartPredicate.distance=0]
   * @param {Number} [options.dragStartPredicate.delay=0]
   * @param {(Boolean|String)} [options.dragStartPredicate.handle=false]
   * @param {?String} [options.dragAxis]
   * @param {(Boolean|Function)} [options.dragSort=true]
   * @param {Object} [options.dragSortHeuristics]
   * @param {Number} [options.dragSortHeuristics.sortInterval=100]
   * @param {Number} [options.dragSortHeuristics.minDragDistance=10]
   * @param {Number} [options.dragSortHeuristics.minBounceBackAngle=1]
   * @param {(Function|Object)} [options.dragSortPredicate]
   * @param {Number} [options.dragSortPredicate.threshold=50]
   * @param {String} [options.dragSortPredicate.action="move"]
   * @param {Number} [options.dragReleaseDuration=300]
   * @param {String} [options.dragReleaseEasing="ease"]
   * @param {Object} [options.dragCssProps]
   * @param {Object} [options.dragPlaceholder]
   * @param {Boolean} [options.dragPlaceholder.enabled=false]
   * @param {Number} [options.dragPlaceholder.duration=300]
   * @param {String} [options.dragPlaceholder.easing="ease"]
   * @param {?Function} [options.dragPlaceholder.createElement=null]
   * @param {?Function} [options.dragPlaceholder.onCreate=null]
   * @param {?Function} [options.dragPlaceholder.onRemove=null]
   * @param {String} [options.containerClass="muuri"]
   * @param {String} [options.itemClass="muuri-item"]
   * @param {String} [options.itemVisibleClass="muuri-item-visible"]
   * @param {String} [options.itemHiddenClass="muuri-item-hidden"]
   * @param {String} [options.itemPositioningClass="muuri-item-positioning"]
   * @param {String} [options.itemDraggingClass="muuri-item-dragging"]
   * @param {String} [options.itemReleasingClass="muuri-item-releasing"]
   * @param {String} [options.itemPlaceholderClass="muuri-item-placeholder"]
   */

  function Grid(element, options) {
    var inst = this;
    var settings;
    var items;
    var layoutOnResize;

    // Allow passing element as selector string. Store element for instance.
    element = this._element =
      typeof element === stringType ? window.document.querySelector(element) : element;

    // Throw an error if the container element is not body element or does not
    // exist within the body element.
    var isElementInDom = element.getRootNode
      ? element.getRootNode({ composed: true }) === document
      : window.document.body.contains(element);
    if (!isElementInDom || element === window.document.documentElement) {
      throw new Error('Container element must be an existing DOM element');
    }

    // Create instance settings by merging the options with default options.
    settings = this._settings = mergeSettings(Grid.defaultOptions, options);

    // Sanitize dragSort setting.
    if (!isFunction(settings.dragSort)) {
      settings.dragSort = !!settings.dragSort;
    }

    // Create instance id and store it to the grid instances collection.
    this._id = createUid();
    gridInstances[this._id] = inst;

    // Destroyed flag.
    this._isDestroyed = false;

    // The layout object (mutated on every layout).
    this._layout = {
      id: 0,
      items: [],
      slots: [],
      setWidth: false,
      setHeight: false,
      width: 0,
      height: 0
    };

    // Create private Emitter instance.
    this._emitter = new Emitter();

    // Add container element's class name.
    addClass(element, settings.containerClass);

    // Create initial items.
    this._items = [];
    items = settings.items;
    if (typeof items === stringType) {
      toArray(element.children).forEach(function(itemElement) {
        if (items === '*' || elementMatches(itemElement, items)) {
          inst._items.push(new Item(inst, itemElement));
        }
      });
    } else if (Array.isArray(items) || isNodeList(items)) {
      this._items = toArray(items).map(function(itemElement) {
        return new Item(inst, itemElement);
      });
    }

    // If layoutOnResize option is a valid number sanitize it and bind the resize
    // handler.
    layoutOnResize = settings.layoutOnResize;
    if (typeof layoutOnResize !== numberType$1) {
      layoutOnResize = layoutOnResize === true ? 0 : -1;
    }
    if (layoutOnResize >= 0) {
      window.addEventListener(
        'resize',
        (inst._resizeHandler = debounce(function() {
          inst.refreshItems().layout();
        }, layoutOnResize))
      );
    }

    // Layout on init if necessary.
    if (settings.layoutOnInit) {
      this.layout(true);
    }
  }

  /**
   * Public properties
   * *****************
   */

  /**
   * @see Item
   */
  Grid.Item = Item;

  /**
   * @see ItemLayout
   */
  Grid.ItemLayout = ItemLayout;

  /**
   * @see ItemVisibility
   */
  Grid.ItemVisibility = ItemVisibility;

  /**
   * @see ItemMigrate
   */
  Grid.ItemMigrate = ItemMigrate;

  /**
   * @see ItemAnimate
   */
  Grid.ItemAnimate = ItemAnimate;

  /**
   * @see ItemDrag
   */
  Grid.ItemDrag = ItemDrag;

  /**
   * @see ItemRelease
   */
  Grid.ItemRelease = ItemRelease;

  /**
   * @see ItemDragPlaceholder
   */
  Grid.ItemDragPlaceholder = ItemDragPlaceholder;

  /**
   * @see Emitter
   */
  Grid.Emitter = Emitter;

  /**
   * @see Dragger
   */
  Grid.Dragger = Dragger;

  /**
   * @see Packer
   */
  Grid.Packer = Packer;

  /**
   * Default options for Grid instance.
   *
   * @public
   * @memberof Grid
   */
  Grid.defaultOptions = {
    // Item elements
    items: '*',

    // Default show animation
    showDuration: 300,
    showEasing: 'ease',

    // Default hide animation
    hideDuration: 300,
    hideEasing: 'ease',

    // Item's visible/hidden state styles
    visibleStyles: {
      opacity: '1',
      transform: 'scale(1)'
    },
    hiddenStyles: {
      opacity: '0',
      transform: 'scale(0.5)'
    },

    // Layout
    layout: {
      fillGaps: false,
      horizontal: false,
      alignRight: false,
      alignBottom: false,
      rounding: true
    },
    layoutOnResize: 100,
    layoutOnInit: true,
    layoutDuration: 300,
    layoutEasing: 'ease',

    // Sorting
    sortData: null,

    // Drag & Drop
    dragEnabled: false,
    dragContainer: null,
    dragStartPredicate: {
      distance: 0,
      delay: 0,
      handle: false
    },
    dragAxis: null,
    dragSort: true,
    dragSortHeuristics: {
      sortInterval: 100,
      minDragDistance: 10,
      minBounceBackAngle: 1
    },
    dragSortPredicate: {
      threshold: 50,
      action: actionMove
    },
    dragReleaseDuration: 300,
    dragReleaseEasing: 'ease',
    dragCssProps: {
      touchAction: 'none',
      userSelect: 'none',
      userDrag: 'none',
      tapHighlightColor: 'rgba(0, 0, 0, 0)',
      touchCallout: 'none',
      contentZooming: 'none'
    },
    dragPlaceholder: {
      enabled: false,
      duration: 300,
      easing: 'ease',
      createElement: null,
      onCreate: null,
      onRemove: null
    },

    // Classnames
    containerClass: 'muuri',
    itemClass: 'muuri-item',
    itemVisibleClass: 'muuri-item-shown',
    itemHiddenClass: 'muuri-item-hidden',
    itemPositioningClass: 'muuri-item-positioning',
    itemDraggingClass: 'muuri-item-dragging',
    itemReleasingClass: 'muuri-item-releasing',
    itemPlaceholderClass: 'muuri-item-placeholder'
  };

  /**
   * Public prototype methods
   * ************************
   */

  /**
   * Bind an event listener.
   *
   * @public
   * @memberof Grid.prototype
   * @param {String} event
   * @param {Function} listener
   * @returns {Grid}
   */
  Grid.prototype.on = function(event, listener) {
    this._emitter.on(event, listener);
    return this;
  };

  /**
   * Unbind an event listener.
   *
   * @public
   * @memberof Grid.prototype
   * @param {String} event
   * @param {Function} listener
   * @returns {Grid}
   */
  Grid.prototype.off = function(event, listener) {
    this._emitter.off(event, listener);
    return this;
  };

  /**
   * Get the container element.
   *
   * @public
   * @memberof Grid.prototype
   * @returns {HTMLElement}
   */
  Grid.prototype.getElement = function() {
    return this._element;
  };

  /**
   * Get all items. Optionally you can provide specific targets (elements and
   * indices). Note that the returned array is not the same object used by the
   * instance so modifying it will not affect instance's items. All items that
   * are not found are omitted from the returned array.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} [targets]
   * @returns {Item[]}
   */
  Grid.prototype.getItems = function(targets) {
    // Return all items immediately if no targets were provided or if the
    // instance is destroyed.
    if (this._isDestroyed || (!targets && targets !== 0)) {
      return this._items.slice(0);
    }

    var ret = [];
    var targetItems = toArray(targets);
    var item;
    var i;

    // If target items are defined return filtered results.
    for (i = 0; i < targetItems.length; i++) {
      item = this._getItem(targetItems[i]);
      item && ret.push(item);
    }

    return ret;
  };

  /**
   * Update the cached dimensions of the instance's items.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} [items]
   * @returns {Grid}
   */
  Grid.prototype.refreshItems = function(items) {
    if (this._isDestroyed) return this;

    var targets = this.getItems(items);
    var i;

    for (i = 0; i < targets.length; i++) {
      targets[i]._refreshDimensions();
    }

    return this;
  };

  /**
   * Update the sort data of the instance's items.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} [items]
   * @returns {Grid}
   */
  Grid.prototype.refreshSortData = function(items) {
    if (this._isDestroyed) return this;

    var targetItems = this.getItems(items);
    var i;

    for (i = 0; i < targetItems.length; i++) {
      targetItems[i]._refreshSortData();
    }

    return this;
  };

  /**
   * Synchronize the item elements to match the order of the items in the DOM.
   * This comes handy if you need to keep the DOM structure matched with the
   * order of the items. Note that if an item's element is not currently a child
   * of the container element (if it is dragged for example) it is ignored and
   * left untouched.
   *
   * @public
   * @memberof Grid.prototype
   * @returns {Grid}
   */
  Grid.prototype.synchronize = function() {
    if (this._isDestroyed) return this;

    var container = this._element;
    var items = this._items;
    var fragment;
    var element;
    var i;

    // Append all elements in order to the container element.
    if (items.length) {
      for (i = 0; i < items.length; i++) {
        element = items[i]._element;
        if (element.parentNode === container) {
          fragment = fragment || window.document.createDocumentFragment();
          fragment.appendChild(element);
        }
      }

      if (fragment) container.appendChild(fragment);
    }

    // Emit synchronize event.
    this._emit(eventSynchronize);

    return this;
  };

  /**
   * Calculate and apply item positions.
   *
   * @public
   * @memberof Grid.prototype
   * @param {Boolean} [instant=false]
   * @param {LayoutCallback} [onFinish]
   * @returns {Grid}
   */
  Grid.prototype.layout = function(instant, onFinish) {
    if (this._isDestroyed) return this;

    var inst = this;
    var element = this._element;
    var layout = this._updateLayout();
    var layoutId = layout.id;
    var itemsLength = layout.items.length;
    var counter = itemsLength;
    var isBorderBox;
    var item;
    var i;

    // The finish function, which will be used for checking if all the items
    // have laid out yet. After all items have finished their animations call
    // callback and emit layoutEnd event. Only emit layoutEnd event if there
    // hasn't been a new layout call during this layout.
    function tryFinish() {
      if (--counter > 0) return;

      var hasLayoutChanged = inst._layout.id !== layoutId;
      var callback = isFunction(instant) ? instant : onFinish;

      if (isFunction(callback)) {
        callback(hasLayoutChanged, layout.items.slice(0));
      }

      if (!hasLayoutChanged && inst._hasListeners(eventLayoutEnd)) {
        inst._emit(eventLayoutEnd, layout.items.slice(0));
      }
    }

    // If grid's width or height was modified, we need to update it's cached
    // dimensions. Also keep in mind that grid's cached width/height should
    // always equal to what elem.getBoundingClientRect() would return, so
    // therefore we need to add the grid element's borders to the dimensions if
    // it's box-sizing is border-box. Note that we support providing the
    // dimensions as a string here too so that one can define the unit of the
    // dimensions, in which case we don't do the border-box check.
    if (
      (layout.setHeight && typeof layout.height === numberType$1) ||
      (layout.setWidth && typeof layout.width === numberType$1)
    ) {
      isBorderBox = getStyle(element, 'box-sizing') === 'border-box';
    }
    if (layout.setHeight) {
      if (typeof layout.height === numberType$1) {
        element.style.height =
          (isBorderBox ? layout.height + this._borderTop + this._borderBottom : layout.height) + 'px';
      } else {
        element.style.height = layout.height;
      }
    }
    if (layout.setWidth) {
      if (typeof layout.width === numberType$1) {
        element.style.width =
          (isBorderBox ? layout.width + this._borderLeft + this._borderRight : layout.width) + 'px';
      } else {
        element.style.width = layout.width;
      }
    }

    // Emit layoutStart event. Note that this is intentionally emitted after the
    // container element's dimensions are set, because otherwise there would be
    // no hook for reacting to container dimension changes.
    if (this._hasListeners(eventLayoutStart)) {
      this._emit(eventLayoutStart, layout.items.slice(0));
    }

    // If there are no items let's finish quickly.
    if (!itemsLength) {
      tryFinish();
      return this;
    }

    // If there are items let's position them.
    for (i = 0; i < itemsLength; i++) {
      item = layout.items[i];
      if (!item) continue;

      // Update item's position.
      item._left = layout.slots[i * 2];
      item._top = layout.slots[i * 2 + 1];

      // Layout item if it is not dragged.
      item.isDragging() ? tryFinish() : item._layout.start(instant === true, tryFinish);
    }

    return this;
  };

  /**
   * Add new items by providing the elements you wish to add to the instance and
   * optionally provide the index where you want the items to be inserted into.
   * All elements that are not already children of the container element will be
   * automatically appended to the container element. If an element has it's CSS
   * display property set to "none" it will be marked as inactive during the
   * initiation process. As long as the item is inactive it will not be part of
   * the layout, but it will retain it's index. You can activate items at any
   * point with grid.show() method. This method will automatically call
   * grid.layout() if one or more of the added elements are visible. If only
   * hidden items are added no layout will be called. All the new visible items
   * are positioned without animation during their first layout.
   *
   * @public
   * @memberof Grid.prototype
   * @param {(HTMLElement|HTMLElement[])} elements
   * @param {Object} [options]
   * @param {Number} [options.index=-1]
   * @param {Boolean} [options.isActive]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Item[]}
   */
  Grid.prototype.add = function(elements, options) {
    if (this._isDestroyed || !elements) return [];

    var newItems = toArray(elements);
    if (!newItems.length) return newItems;

    var opts = options || 0;
    var layout = opts.layout ? opts.layout : opts.layout === undefined;
    var items = this._items;
    var needsLayout = false;
    var item;
    var i;

    // Map provided elements into new grid items.
    for (i = 0; i < newItems.length; i++) {
      item = new Item(this, newItems[i], opts.isActive);
      newItems[i] = item;

      // If the item to be added is active, we need to do a layout. Also, we
      // need to mark the item with the skipNextAnimation flag to make it
      // position instantly (without animation) during the next layout. Without
      // the hack the item would animate to it's new position from the northwest
      // corner of the grid, which feels a bit buggy (imho).
      if (item._isActive) {
        needsLayout = true;
        item._layout._skipNextAnimation = true;
      }
    }

    // Add the new items to the items collection to correct index.
    arrayInsert(items, newItems, opts.index);

    // Emit add event.
    if (this._hasListeners(eventAdd)) {
      this._emit(eventAdd, newItems.slice(0));
    }

    // If layout is needed.
    if (needsLayout && layout) {
      this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
    }

    return newItems;
  };

  /**
   * Remove items from the instance.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} items
   * @param {Object} [options]
   * @param {Boolean} [options.removeElements=false]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Item[]}
   */
  Grid.prototype.remove = function(items, options) {
    if (this._isDestroyed) return this;

    var opts = options || 0;
    var layout = opts.layout ? opts.layout : opts.layout === undefined;
    var needsLayout = false;
    var allItems = this.getItems();
    var targetItems = this.getItems(items);
    var indices = [];
    var item;
    var i;

    // Remove the individual items.
    for (i = 0; i < targetItems.length; i++) {
      item = targetItems[i];
      indices.push(allItems.indexOf(item));
      if (item._isActive) needsLayout = true;
      item._destroy(opts.removeElements);
    }

    // Emit remove event.
    if (this._hasListeners(eventRemove)) {
      this._emit(eventRemove, targetItems.slice(0), indices);
    }

    // If layout is needed.
    if (needsLayout && layout) {
      this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
    }

    return targetItems;
  };

  /**
   * Show instance items.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} items
   * @param {Object} [options]
   * @param {Boolean} [options.instant=false]
   * @param {ShowCallback} [options.onFinish]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Grid}
   */
  Grid.prototype.show = function(items, options) {
    if (this._isDestroyed) return this;
    this._setItemsVisibility(items, true, options);
    return this;
  };

  /**
   * Hide instance items.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} items
   * @param {Object} [options]
   * @param {Boolean} [options.instant=false]
   * @param {HideCallback} [options.onFinish]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Grid}
   */
  Grid.prototype.hide = function(items, options) {
    if (this._isDestroyed) return this;
    this._setItemsVisibility(items, false, options);
    return this;
  };

  /**
   * Filter items. Expects at least one argument, a predicate, which should be
   * either a function or a string. The predicate callback is executed for every
   * item in the instance. If the return value of the predicate is truthy the
   * item in question will be shown and otherwise hidden. The predicate callback
   * receives the item instance as it's argument. If the predicate is a string
   * it is considered to be a selector and it is checked against every item
   * element in the instance with the native element.matches() method. All the
   * matching items will be shown and others hidden.
   *
   * @public
   * @memberof Grid.prototype
   * @param {(Function|String)} predicate
   * @param {Object} [options]
   * @param {Boolean} [options.instant=false]
   * @param {FilterCallback} [options.onFinish]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Grid}
   */
  Grid.prototype.filter = function(predicate, options) {
    if (this._isDestroyed || !this._items.length) return this;

    var itemsToShow = [];
    var itemsToHide = [];
    var isPredicateString = typeof predicate === stringType;
    var isPredicateFn = isFunction(predicate);
    var opts = options || 0;
    var isInstant = opts.instant === true;
    var layout = opts.layout ? opts.layout : opts.layout === undefined;
    var onFinish = isFunction(opts.onFinish) ? opts.onFinish : null;
    var tryFinishCounter = -1;
    var tryFinish = noop;
    var item;
    var i;

    // If we have onFinish callback, let's create proper tryFinish callback.
    if (onFinish) {
      tryFinish = function() {
        ++tryFinishCounter && onFinish(itemsToShow.slice(0), itemsToHide.slice(0));
      };
    }

    // Check which items need to be shown and which hidden.
    if (isPredicateFn || isPredicateString) {
      for (i = 0; i < this._items.length; i++) {
        item = this._items[i];
        if (isPredicateFn ? predicate(item) : elementMatches(item._element, predicate)) {
          itemsToShow.push(item);
        } else {
          itemsToHide.push(item);
        }
      }
    }

    // Show items that need to be shown.
    if (itemsToShow.length) {
      this.show(itemsToShow, {
        instant: isInstant,
        onFinish: tryFinish,
        layout: false
      });
    } else {
      tryFinish();
    }

    // Hide items that need to be hidden.
    if (itemsToHide.length) {
      this.hide(itemsToHide, {
        instant: isInstant,
        onFinish: tryFinish,
        layout: false
      });
    } else {
      tryFinish();
    }

    // If there are any items to filter.
    if (itemsToShow.length || itemsToHide.length) {
      // Emit filter event.
      if (this._hasListeners(eventFilter)) {
        this._emit(eventFilter, itemsToShow.slice(0), itemsToHide.slice(0));
      }

      // If layout is needed.
      if (layout) {
        this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
      }
    }

    return this;
  };

  /**
   * Sort items. There are three ways to sort the items. The first is simply by
   * providing a function as the comparer which works identically to native
   * array sort. Alternatively you can sort by the sort data you have provided
   * in the instance's options. Just provide the sort data key(s) as a string
   * (separated by space) and the items will be sorted based on the provided
   * sort data keys. Lastly you have the opportunity to provide a presorted
   * array of items which will be used to sync the internal items array in the
   * same order.
   *
   * @public
   * @memberof Grid.prototype
   * @param {(Function|Item[]|String|String[])} comparer
   * @param {Object} [options]
   * @param {Boolean} [options.descending=false]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Grid}
   */
  Grid.prototype.sort = (function() {
    var sortComparer;
    var isDescending;
    var origItems;
    var indexMap;

    function parseCriteria(data) {
      return data
        .trim()
        .split(' ')
        .map(function(val) {
          return val.split(':');
        });
    }

    function getIndexMap(items) {
      var ret = {};
      for (var i = 0; i < items.length; i++) {
        ret[items[i]._id] = i;
      }
      return ret;
    }

    function compareIndices(itemA, itemB) {
      var indexA = indexMap[itemA._id];
      var indexB = indexMap[itemB._id];
      return isDescending ? indexB - indexA : indexA - indexB;
    }

    function defaultComparer(a, b) {
      var result = 0;
      var criteriaName;
      var criteriaOrder;
      var valA;
      var valB;

      // Loop through the list of sort criteria.
      for (var i = 0; i < sortComparer.length; i++) {
        // Get the criteria name, which should match an item's sort data key.
        criteriaName = sortComparer[i][0];
        criteriaOrder = sortComparer[i][1];

        // Get items' cached sort values for the criteria. If the item has no sort
        // data let's update the items sort data (this is a lazy load mechanism).
        valA = (a._sortData ? a : a._refreshSortData())._sortData[criteriaName];
        valB = (b._sortData ? b : b._refreshSortData())._sortData[criteriaName];

        // Sort the items in descending order if defined so explicitly. Otherwise
        // sort items in ascending order.
        if (criteriaOrder === 'desc' || (!criteriaOrder && isDescending)) {
          result = valB < valA ? -1 : valB > valA ? 1 : 0;
        } else {
          result = valA < valB ? -1 : valA > valB ? 1 : 0;
        }

        // If we have -1 or 1 as the return value, let's return it immediately.
        if (result) return result;
      }

      // If values are equal let's compare the item indices to make sure we
      // have a stable sort.
      if (!result) {
        if (!indexMap) indexMap = getIndexMap(origItems);
        result = compareIndices(a, b);
      }
      return result;
    }

    function customComparer(a, b) {
      var result = sortComparer(a, b);
      // If descending let's invert the result value.
      if (isDescending && result) result = -result;
      // If we have a valid result (not zero) let's return it right away.
      if (result) return result;
      // If result is zero let's compare the item indices to make sure we have a
      // stable sort.
      if (!indexMap) indexMap = getIndexMap(origItems);
      return compareIndices(a, b);
    }

    return function(comparer, options) {
      if (this._isDestroyed || this._items.length < 2) return this;

      var items = this._items;
      var opts = options || 0;
      var layout = opts.layout ? opts.layout : opts.layout === undefined;
      var i;

      // Setup parent scope data.
      sortComparer = comparer;
      isDescending = !!opts.descending;
      origItems = items.slice(0);
      indexMap = null;

      // If function is provided do a native array sort.
      if (isFunction(sortComparer)) {
        items.sort(customComparer);
      }
      // Otherwise if we got a string, let's sort by the sort data as provided in
      // the instance's options.
      else if (typeof sortComparer === stringType) {
        sortComparer = parseCriteria(comparer);
        items.sort(defaultComparer);
      }
      // Otherwise if we got an array, let's assume it's a presorted array of the
      // items and order the items based on it.
      else if (Array.isArray(sortComparer)) {
        if (sortComparer.length !== items.length) {
          throw new Error('[' + namespace + '] sort reference items do not match with grid items.');
        }
        for (i = 0; i < items.length; i++) {
          if (sortComparer.indexOf(items[i]) < 0) {
            throw new Error('[' + namespace + '] sort reference items do not match with grid items.');
          }
          items[i] = sortComparer[i];
        }
        if (isDescending) items.reverse();
      }
      // Otherwise let's just skip it, nothing we can do here.
      else {
        /** @todo Maybe throw an error here? */
        return this;
      }

      // Emit sort event.
      if (this._hasListeners(eventSort)) {
        this._emit(eventSort, items.slice(0), origItems);
      }

      // If layout is needed.
      if (layout) {
        this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
      }

      return this;
    };
  })();

  /**
   * Move item to another index or in place of another item.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridSingleItemQuery} item
   * @param {GridSingleItemQuery} position
   * @param {Object} [options]
   * @param {String} [options.action="move"]
   *   - Accepts either "move" or "swap".
   *   - "move" moves the item in place of the other item.
   *   - "swap" swaps the position of the items.
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   * @returns {Grid}
   */
  Grid.prototype.move = function(item, position, options) {
    if (this._isDestroyed || this._items.length < 2) return this;

    var items = this._items;
    var opts = options || 0;
    var layout = opts.layout ? opts.layout : opts.layout === undefined;
    var isSwap = opts.action === actionSwap;
    var action = isSwap ? actionSwap : actionMove;
    var fromItem = this._getItem(item);
    var toItem = this._getItem(position);
    var fromIndex;
    var toIndex;

    // Make sure the items exist and are not the same.
    if (fromItem && toItem && fromItem !== toItem) {
      // Get the indices of the items.
      fromIndex = items.indexOf(fromItem);
      toIndex = items.indexOf(toItem);

      // Do the move/swap.
      if (isSwap) {
        arraySwap(items, fromIndex, toIndex);
      } else {
        arrayMove(items, fromIndex, toIndex);
      }

      // Emit move event.
      if (this._hasListeners(eventMove)) {
        this._emit(eventMove, {
          item: fromItem,
          fromIndex: fromIndex,
          toIndex: toIndex,
          action: action
        });
      }

      // If layout is needed.
      if (layout) {
        this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
      }
    }

    return this;
  };

  /**
   * Send item to another Grid instance.
   *
   * @public
   * @memberof Grid.prototype
   * @param {GridSingleItemQuery} item
   * @param {Grid} grid
   * @param {GridSingleItemQuery} position
   * @param {Object} [options]
   * @param {HTMLElement} [options.appendTo=document.body]
   * @param {(Boolean|LayoutCallback|String)} [options.layoutSender=true]
   * @param {(Boolean|LayoutCallback|String)} [options.layoutReceiver=true]
   * @returns {Grid}
   */
  Grid.prototype.send = function(item, grid, position, options) {
    if (this._isDestroyed || grid._isDestroyed || this === grid) return this;

    // Make sure we have a valid target item.
    item = this._getItem(item);
    if (!item) return this;

    var opts = options || 0;
    var container = opts.appendTo || window.document.body;
    var layoutSender = opts.layoutSender ? opts.layoutSender : opts.layoutSender === undefined;
    var layoutReceiver = opts.layoutReceiver
      ? opts.layoutReceiver
      : opts.layoutReceiver === undefined;

    // Start the migration process.
    item._migrate.start(grid, position, container);

    // If migration was started successfully and the item is active, let's layout
    // the grids.
    if (item._migrate._isActive && item._isActive) {
      if (layoutSender) {
        this.layout(
          layoutSender === instantLayout,
          isFunction(layoutSender) ? layoutSender : undefined
        );
      }
      if (layoutReceiver) {
        grid.layout(
          layoutReceiver === instantLayout,
          isFunction(layoutReceiver) ? layoutReceiver : undefined
        );
      }
    }

    return this;
  };

  /**
   * Destroy the instance.
   *
   * @public
   * @memberof Grid.prototype
   * @param {Boolean} [removeElements=false]
   * @returns {Grid}
   */
  Grid.prototype.destroy = function(removeElements) {
    if (this._isDestroyed) return this;

    var container = this._element;
    var items = this._items.slice(0);
    var i;

    // Unbind window resize event listener.
    if (this._resizeHandler) {
      window.removeEventListener('resize', this._resizeHandler);
    }

    // Destroy items.
    for (i = 0; i < items.length; i++) {
      items[i]._destroy(removeElements);
    }

    // Restore container.
    removeClass(container, this._settings.containerClass);
    container.style.height = '';
    container.style.width = '';

    // Emit destroy event and unbind all events.
    this._emit(eventDestroy);
    this._emitter.destroy();

    // Remove reference from the grid instances collection.
    gridInstances[this._id] = undefined;

    // Flag instance as destroyed.
    this._isDestroyed = true;

    return this;
  };

  /**
   * Private prototype methods
   * *************************
   */

  /**
   * Get instance's item by element or by index. Target can also be an Item
   * instance in which case the function returns the item if it exists within
   * related Grid instance. If nothing is found with the provided target, null
   * is returned.
   *
   * @private
   * @memberof Grid.prototype
   * @param {GridSingleItemQuery} [target]
   * @returns {?Item}
   */
  Grid.prototype._getItem = function(target) {
    // If no target is specified or the instance is destroyed, return null.
    if (this._isDestroyed || (!target && target !== 0)) {
      return null;
    }

    // If target is number return the item in that index. If the number is lower
    // than zero look for the item starting from the end of the items array. For
    // example -1 for the last item, -2 for the second last item, etc.
    if (typeof target === numberType$1) {
      return this._items[target > -1 ? target : this._items.length + target] || null;
    }

    // If the target is an instance of Item return it if it is attached to this
    // Grid instance, otherwise return null.
    if (target instanceof Item) {
      return target._gridId === this._id ? target : null;
    }

    // In other cases let's assume that the target is an element, so let's try
    // to find an item that matches the element and return it. If item is not
    // found return null.
    /** @todo This could be made a lot faster by using Map/WeakMap of elements. */
    for (var i = 0; i < this._items.length; i++) {
      if (this._items[i]._element === target) {
        return this._items[i];
      }
    }

    return null;
  };

  /**
   * Recalculates and updates instance's layout data.
   *
   * @private
   * @memberof Grid.prototype
   * @returns {LayoutData}
   */
  Grid.prototype._updateLayout = function() {
    var layout = this._layout;
    var settings = this._settings.layout;
    var width;
    var height;
    var newLayout;
    var i;

    // Let's increment layout id.
    ++layout.id;

    // Let's update layout items
    layout.items.length = 0;
    for (i = 0; i < this._items.length; i++) {
      if (this._items[i]._isActive) layout.items.push(this._items[i]);
    }

    // Let's make sure we have the correct container dimensions.
    this._refreshDimensions();

    // Calculate container width and height (without borders).
    width = this._width - this._borderLeft - this._borderRight;
    height = this._height - this._borderTop - this._borderBottom;

    // Calculate new layout.
    if (isFunction(settings)) {
      newLayout = settings(layout.items, width, height);
    } else {
      newLayout = packer.getLayout(layout.items, width, height, layout.slots, settings);
    }

    // Let's update the grid's layout.
    layout.slots = newLayout.slots;
    layout.setWidth = Boolean(newLayout.setWidth);
    layout.setHeight = Boolean(newLayout.setHeight);
    layout.width = newLayout.width;
    layout.height = newLayout.height;

    return layout;
  };

  /**
   * Emit a grid event.
   *
   * @private
   * @memberof Grid.prototype
   * @param {String} event
   * @param {...*} [arg]
   */
  Grid.prototype._emit = function() {
    if (this._isDestroyed) return;
    this._emitter.emit.apply(this._emitter, arguments);
  };

  /**
   * Check if there are any events listeners for an event.
   *
   * @private
   * @memberof Grid.prototype
   * @param {String} event
   * @returns {Boolean}
   */
  Grid.prototype._hasListeners = function(event) {
    var listeners = this._emitter._events[event];
    return !!(listeners && listeners.length);
  };

  /**
   * Update container's width, height and offsets.
   *
   * @private
   * @memberof Grid.prototype
   */
  Grid.prototype._updateBoundingRect = function() {
    var element = this._element;
    var rect = element.getBoundingClientRect();
    this._width = rect.width;
    this._height = rect.height;
    this._left = rect.left;
    this._top = rect.top;
  };

  /**
   * Update container's border sizes.
   *
   * @private
   * @memberof Grid.prototype
   * @param {Boolean} left
   * @param {Boolean} right
   * @param {Boolean} top
   * @param {Boolean} bottom
   */
  Grid.prototype._updateBorders = function(left, right, top, bottom) {
    var element = this._element;
    if (left) this._borderLeft = getStyleAsFloat(element, 'border-left-width');
    if (right) this._borderRight = getStyleAsFloat(element, 'border-right-width');
    if (top) this._borderTop = getStyleAsFloat(element, 'border-top-width');
    if (bottom) this._borderBottom = getStyleAsFloat(element, 'border-bottom-width');
  };

  /**
   * Refresh all of container's internal dimensions and offsets.
   *
   * @private
   * @memberof Grid.prototype
   */
  Grid.prototype._refreshDimensions = function() {
    this._updateBoundingRect();
    this._updateBorders(1, 1, 1, 1);
  };

  /**
   * Show or hide Grid instance's items.
   *
   * @private
   * @memberof Grid.prototype
   * @param {GridMultiItemQuery} items
   * @param {Boolean} toVisible
   * @param {Object} [options]
   * @param {Boolean} [options.instant=false]
   * @param {(ShowCallback|HideCallback)} [options.onFinish]
   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]
   */
  Grid.prototype._setItemsVisibility = function(items, toVisible, options) {
    var grid = this;
    var targetItems = this.getItems(items);
    var opts = options || 0;
    var isInstant = opts.instant === true;
    var callback = opts.onFinish;
    var layout = opts.layout ? opts.layout : opts.layout === undefined;
    var counter = targetItems.length;
    var startEvent = toVisible ? eventShowStart : eventHideStart;
    var endEvent = toVisible ? eventShowEnd : eventHideEnd;
    var method = toVisible ? 'show' : 'hide';
    var needsLayout = false;
    var completedItems = [];
    var hiddenItems = [];
    var item;
    var i;

    // If there are no items call the callback, but don't emit any events.
    if (!counter) {
      if (isFunction(callback)) callback(targetItems);
      return;
    }

    // Emit showStart/hideStart event.
    if (this._hasListeners(startEvent)) {
      this._emit(startEvent, targetItems.slice(0));
    }

    // Show/hide items.
    for (i = 0; i < targetItems.length; i++) {
      item = targetItems[i];

      // If inactive item is shown or active item is hidden we need to do
      // layout.
      if ((toVisible && !item._isActive) || (!toVisible && item._isActive)) {
        needsLayout = true;
      }

      // If inactive item is shown we also need to do a little hack to make the
      // item not animate it's next positioning (layout).
      if (toVisible && !item._isActive) {
        item._layout._skipNextAnimation = true;
      }

      // If a hidden item is being shown we need to refresh the item's
      // dimensions.
      if (toVisible && item._visibility._isHidden) {
        hiddenItems.push(item);
      }

      // Show/hide the item.
      item._visibility[method](isInstant, function(interrupted, item) {
        // If the current item's animation was not interrupted add it to the
        // completedItems array.
        if (!interrupted) completedItems.push(item);

        // If all items have finished their animations call the callback
        // and emit showEnd/hideEnd event.
        if (--counter < 1) {
          if (isFunction(callback)) callback(completedItems.slice(0));
          if (grid._hasListeners(endEvent)) grid._emit(endEvent, completedItems.slice(0));
        }
      });
    }

    // Refresh hidden items.
    if (hiddenItems.length) this.refreshItems(hiddenItems);

    // Layout if needed.
    if (needsLayout && layout) {
      this.layout(layout === instantLayout, isFunction(layout) ? layout : undefined);
    }
  };

  /**
   * Private helpers
   * ***************
   */

  /**
   * Merge default settings with user settings. The returned object is a new
   * object with merged values. The merging is a deep merge meaning that all
   * objects and arrays within the provided settings objects will be also merged
   * so that modifying the values of the settings object will have no effect on
   * the returned object.
   *
   * @param {Object} defaultSettings
   * @param {Object} [userSettings]
   * @returns {Object} Returns a new object.
   */
  function mergeSettings(defaultSettings, userSettings) {
    // Create a fresh copy of default settings.
    var ret = mergeObjects({}, defaultSettings);

    // Merge user settings to default settings.
    if (userSettings) {
      ret = mergeObjects(ret, userSettings);
    }

    // Handle visible/hidden styles manually so that the whole object is
    // overridden instead of the props.
    ret.visibleStyles = (userSettings || 0).visibleStyles || (defaultSettings || 0).visibleStyles;
    ret.hiddenStyles = (userSettings || 0).hiddenStyles || (defaultSettings || 0).hiddenStyles;

    return ret;
  }

  /**
   * Merge two objects recursively (deep merge). The source object's properties
   * are merged to the target object.
   *
   * @param {Object} target
   *   - The target object.
   * @param {Object} source
   *   - The source object.
   * @returns {Object} Returns the target object.
   */
  function mergeObjects(target, source) {
    var sourceKeys = Object.keys(source);
    var length = sourceKeys.length;
    var isSourceObject;
    var propName;
    var i;

    for (i = 0; i < length; i++) {
      propName = sourceKeys[i];
      isSourceObject = isPlainObject(source[propName]);

      // If target and source values are both objects, merge the objects and
      // assign the merged value to the target property.
      if (isPlainObject(target[propName]) && isSourceObject) {
        target[propName] = mergeObjects(mergeObjects({}, target[propName]), source[propName]);
        continue;
      }

      // If source's value is object and target's is not let's clone the object as
      // the target's value.
      if (isSourceObject) {
        target[propName] = mergeObjects({}, source[propName]);
        continue;
      }

      // If source's value is an array let's clone the array as the target's
      // value.
      if (Array.isArray(source[propName])) {
        target[propName] = source[propName].slice(0);
        continue;
      }

      // In all other cases let's just directly assign the source's value as the
      // target's value.
      target[propName] = source[propName];
    }

    return target;
  }

  return Grid;

}));


/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/* Tabulator v4.6.1 (c) Oliver Folkerd */

;(function (global, factory) {
	if (( false ? 'undefined' : _typeof(exports)) === 'object' && typeof module !== 'undefined') {
		module.exports = factory();
	} else if (true) {
		!(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	} else {
		global.Tabulator = factory();
	}
})(this, function () {

	'use strict';

	// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex


	if (!Array.prototype.findIndex) {

		Object.defineProperty(Array.prototype, 'findIndex', {

			value: function value(predicate) {

				// 1. Let O be ? ToObject(this value).


				if (this == null) {

					throw new TypeError('"this" is null or not defined');
				}

				var o = Object(this);

				// 2. Let len be ? ToLength(? Get(O, "length")).


				var len = o.length >>> 0;

				// 3. If IsCallable(predicate) is false, throw a TypeError exception.


				if (typeof predicate !== 'function') {

					throw new TypeError('predicate must be a function');
				}

				// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.


				var thisArg = arguments[1];

				// 5. Let k be 0.


				var k = 0;

				// 6. Repeat, while k < len


				while (k < len) {

					// a. Let Pk be ! ToString(k).


					// b. Let kValue be ? Get(O, Pk).


					// c. Let testResult be ToBoolean(? Call(predicate, T, Â« kValue, k, O Â»)).


					// d. If testResult is true, return k.


					var kValue = o[k];

					if (predicate.call(thisArg, kValue, k, o)) {

						return k;
					}

					// e. Increase k by 1.


					k++;
				}

				// 7. Return -1.


				return -1;
			}

		});
	}

	// https://tc39.github.io/ecma262/#sec-array.prototype.find


	if (!Array.prototype.find) {

		Object.defineProperty(Array.prototype, 'find', {

			value: function value(predicate) {

				// 1. Let O be ? ToObject(this value).


				if (this == null) {

					throw new TypeError('"this" is null or not defined');
				}

				var o = Object(this);

				// 2. Let len be ? ToLength(? Get(O, "length")).


				var len = o.length >>> 0;

				// 3. If IsCallable(predicate) is false, throw a TypeError exception.


				if (typeof predicate !== 'function') {

					throw new TypeError('predicate must be a function');
				}

				// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.


				var thisArg = arguments[1];

				// 5. Let k be 0.


				var k = 0;

				// 6. Repeat, while k < len


				while (k < len) {

					// a. Let Pk be ! ToString(k).


					// b. Let kValue be ? Get(O, Pk).


					// c. Let testResult be ToBoolean(? Call(predicate, T, Â« kValue, k, O Â»)).


					// d. If testResult is true, return kValue.


					var kValue = o[k];

					if (predicate.call(thisArg, kValue, k, o)) {

						return kValue;
					}

					// e. Increase k by 1.


					k++;
				}

				// 7. Return undefined.


				return undefined;
			}

		});
	}

	var ColumnManager = function ColumnManager(table) {

		this.table = table; //hold parent table


		this.blockHozScrollEvent = false;

		this.headersElement = this.createHeadersElement();

		this.element = this.createHeaderElement(); //containing element


		this.rowManager = null; //hold row manager object


		this.columns = []; // column definition object


		this.columnsByIndex = []; //columns by index


		this.columnsByField = {}; //columns by field


		this.scrollLeft = 0;

		this.element.insertBefore(this.headersElement, this.element.firstChild);
	};

	////////////// Setup Functions /////////////////


	ColumnManager.prototype.createHeadersElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-headers");

		return el;
	};

	ColumnManager.prototype.createHeaderElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-header");

		if (!this.table.options.headerVisible) {

			el.classList.add("tabulator-header-hidden");
		}

		return el;
	};

	ColumnManager.prototype.initialize = function () {

		var self = this;

		//scroll body along with header


		// self.element.addEventListener("scroll", function(e){


		// 	if(!self.blockHozScrollEvent){


		// 		self.table.rowManager.scrollHorizontal(self.element.scrollLeft);


		// 	}


		// });

	};

	//link to row manager


	ColumnManager.prototype.setRowManager = function (manager) {

		this.rowManager = manager;
	};

	//return containing element


	ColumnManager.prototype.getElement = function () {

		return this.element;
	};

	//return header containing element


	ColumnManager.prototype.getHeadersElement = function () {

		return this.headersElement;
	};

	// ColumnManager.prototype.tempScrollBlock = function(){


	// 	clearTimeout(this.blockHozScrollEvent);


	// 	this.blockHozScrollEvent = setTimeout(() => {this.blockHozScrollEvent = false;}, 50);


	// }


	//scroll horizontally to match table body


	ColumnManager.prototype.scrollHorizontal = function (left) {

		var hozAdjust = 0,
		    scrollWidth = this.element.scrollWidth - this.table.element.clientWidth;

		// this.tempScrollBlock();


		this.element.scrollLeft = left;

		//adjust for vertical scrollbar moving table when present


		if (left > scrollWidth) {

			hozAdjust = left - scrollWidth;

			this.element.style.marginLeft = -hozAdjust + "px";
		} else {

			this.element.style.marginLeft = 0;
		}

		//keep frozen columns fixed in position


		//this._calcFrozenColumnsPos(hozAdjust + 3);


		this.scrollLeft = left;

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.scrollHorizontal();
		}
	};

	///////////// Column Setup Functions /////////////


	ColumnManager.prototype.generateColumnsFromRowData = function (data) {

		var cols = [],
		    row,
		    sorter;

		if (data && data.length) {

			row = data[0];

			for (var key in row) {

				var col = {

					field: key,

					title: key

				};

				var value = row[key];

				switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {

					case "undefined":

						sorter = "string";

						break;

					case "boolean":

						sorter = "boolean";

						break;

					case "object":

						if (Array.isArray(value)) {

							sorter = "array";
						} else {

							sorter = "string";
						}

						break;

					default:

						if (!isNaN(value) && value !== "") {

							sorter = "number";
						} else {

							if (value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)) {

								sorter = "alphanum";
							} else {

								sorter = "string";
							}
						}

						break;

				}

				col.sorter = sorter;

				cols.push(col);
			}

			this.table.options.columns = cols;

			this.setColumns(this.table.options.columns);
		}
	};

	ColumnManager.prototype.setColumns = function (cols, row) {

		var self = this;

		while (self.headersElement.firstChild) {
			self.headersElement.removeChild(self.headersElement.firstChild);
		}self.columns = [];

		self.columnsByIndex = [];

		self.columnsByField = {};

		//reset frozen columns


		if (self.table.modExists("frozenColumns")) {

			self.table.modules.frozenColumns.reset();
		}

		cols.forEach(function (def, i) {

			self._addColumn(def);
		});

		self._reIndexColumns();

		if (self.table.options.responsiveLayout && self.table.modExists("responsiveLayout", true)) {

			self.table.modules.responsiveLayout.initialize();
		}

		self.redraw(true);
	};

	ColumnManager.prototype._addColumn = function (definition, before, nextToColumn) {

		var column = new Column(definition, this),
		    colEl = column.getElement(),
		    index = nextToColumn ? this.findColumnIndex(nextToColumn) : nextToColumn;

		if (nextToColumn && index > -1) {

			var parentIndex = this.columns.indexOf(nextToColumn.getTopColumn());

			var nextEl = nextToColumn.getElement();

			if (before) {

				this.columns.splice(parentIndex, 0, column);

				nextEl.parentNode.insertBefore(colEl, nextEl);
			} else {

				this.columns.splice(parentIndex + 1, 0, column);

				nextEl.parentNode.insertBefore(colEl, nextEl.nextSibling);
			}
		} else {

			if (before) {

				this.columns.unshift(column);

				this.headersElement.insertBefore(column.getElement(), this.headersElement.firstChild);
			} else {

				this.columns.push(column);

				this.headersElement.appendChild(column.getElement());
			}

			column.columnRendered();
		}

		return column;
	};

	ColumnManager.prototype.registerColumnField = function (col) {

		if (col.definition.field) {

			this.columnsByField[col.definition.field] = col;
		}
	};

	ColumnManager.prototype.registerColumnPosition = function (col) {

		this.columnsByIndex.push(col);
	};

	ColumnManager.prototype._reIndexColumns = function () {

		this.columnsByIndex = [];

		this.columns.forEach(function (column) {

			column.reRegisterPosition();
		});
	};

	//ensure column headers take up the correct amount of space in column groups


	ColumnManager.prototype._verticalAlignHeaders = function () {

		var self = this,
		    minHeight = 0;

		self.columns.forEach(function (column) {

			var height;

			column.clearVerticalAlign();

			height = column.getHeight();

			if (height > minHeight) {

				minHeight = height;
			}
		});

		self.columns.forEach(function (column) {

			column.verticalAlign(self.table.options.columnHeaderVertAlign, minHeight);
		});

		self.rowManager.adjustTableSize();
	};

	//////////////// Column Details /////////////////


	ColumnManager.prototype.findColumn = function (subject) {

		var self = this;

		if ((typeof subject === 'undefined' ? 'undefined' : _typeof(subject)) == "object") {

			if (subject instanceof Column) {

				//subject is column element


				return subject;
			} else if (subject instanceof ColumnComponent) {

				//subject is public column component


				return subject._getSelf() || false;
			} else if (typeof HTMLElement !== "undefined" && subject instanceof HTMLElement) {

				//subject is a HTML element of the column header


				var match = self.columns.find(function (column) {

					return column.element === subject;
				});

				return match || false;
			}
		} else {

			//subject should be treated as the field name of the column


			return this.columnsByField[subject] || false;
		}

		//catch all for any other type of input


		return false;
	};

	ColumnManager.prototype.getColumnByField = function (field) {

		return this.columnsByField[field];
	};

	ColumnManager.prototype.getColumnsByFieldRoot = function (root) {
		var _this = this;

		var matches = [];

		Object.keys(this.columnsByField).forEach(function (field) {

			var fieldRoot = field.split(".")[0];

			if (fieldRoot === root) {

				matches.push(_this.columnsByField[field]);
			}
		});

		return matches;
	};

	ColumnManager.prototype.getColumnByIndex = function (index) {

		return this.columnsByIndex[index];
	};

	ColumnManager.prototype.getFirstVisibileColumn = function (index) {

		var index = this.columnsByIndex.findIndex(function (col) {

			return col.visible;
		});

		return index > -1 ? this.columnsByIndex[index] : false;
	};

	ColumnManager.prototype.getColumns = function () {

		return this.columns;
	};

	ColumnManager.prototype.findColumnIndex = function (column) {

		return this.columnsByIndex.findIndex(function (col) {

			return column === col;
		});
	};

	//return all columns that are not groups


	ColumnManager.prototype.getRealColumns = function () {

		return this.columnsByIndex;
	};

	//travers across columns and call action


	ColumnManager.prototype.traverse = function (callback) {

		var self = this;

		self.columnsByIndex.forEach(function (column, i) {

			callback(column, i);
		});
	};

	//get defintions of actual columns


	ColumnManager.prototype.getDefinitions = function (active) {

		var self = this,
		    output = [];

		self.columnsByIndex.forEach(function (column) {

			if (!active || active && column.visible) {

				output.push(column.getDefinition());
			}
		});

		return output;
	};

	//get full nested definition tree


	ColumnManager.prototype.getDefinitionTree = function () {

		var self = this,
		    output = [];

		self.columns.forEach(function (column) {

			output.push(column.getDefinition(true));
		});

		return output;
	};

	ColumnManager.prototype.getComponents = function (structured) {

		var self = this,
		    output = [],
		    columns = structured ? self.columns : self.columnsByIndex;

		columns.forEach(function (column) {

			output.push(column.getComponent());
		});

		return output;
	};

	ColumnManager.prototype.getWidth = function () {

		var width = 0;

		this.columnsByIndex.forEach(function (column) {

			if (column.visible) {

				width += column.getWidth();
			}
		});

		return width;
	};

	ColumnManager.prototype.moveColumn = function (from, to, after) {

		this.moveColumnActual(from, to, after);

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
		}

		to.element.parentNode.insertBefore(from.element, to.element);

		if (after) {

			to.element.parentNode.insertBefore(to.element, from.element);
		}

		this._verticalAlignHeaders();

		this.table.rowManager.reinitialize();
	};

	ColumnManager.prototype.moveColumnActual = function (from, to, after) {

		if (from.parent.isGroup) {

			this._moveColumnInArray(from.parent.columns, from, to, after);
		} else {

			this._moveColumnInArray(this.columns, from, to, after);
		}

		this._moveColumnInArray(this.columnsByIndex, from, to, after, true);

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		if (this.table.options.columnMoved) {

			this.table.options.columnMoved.call(this.table, from.getComponent(), this.table.columnManager.getComponents());
		}

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

			this.table.modules.persistence.save("columns");
		}
	};

	ColumnManager.prototype._moveColumnInArray = function (columns, from, to, after, updateRows) {

		var fromIndex = columns.indexOf(from),
		    toIndex;

		if (fromIndex > -1) {

			columns.splice(fromIndex, 1);

			toIndex = columns.indexOf(to);

			if (toIndex > -1) {

				if (after) {

					toIndex = toIndex + 1;
				}
			} else {

				toIndex = fromIndex;
			}

			columns.splice(toIndex, 0, from);

			if (updateRows) {

				this.table.rowManager.rows.forEach(function (row) {

					if (row.cells.length) {

						var cell = row.cells.splice(fromIndex, 1)[0];

						row.cells.splice(toIndex, 0, cell);
					}
				});
			}
		}
	};

	ColumnManager.prototype.scrollToColumn = function (column, position, ifVisible) {
		var _this2 = this;

		var left = 0,
		    offset = 0,
		    adjust = 0,
		    colEl = column.getElement();

		return new Promise(function (resolve, reject) {

			if (typeof position === "undefined") {

				position = _this2.table.options.scrollToColumnPosition;
			}

			if (typeof ifVisible === "undefined") {

				ifVisible = _this2.table.options.scrollToColumnIfVisible;
			}

			if (column.visible) {

				//align to correct position


				switch (position) {

					case "middle":

					case "center":

						adjust = -_this2.element.clientWidth / 2;

						break;

					case "right":

						adjust = colEl.clientWidth - _this2.headersElement.clientWidth;

						break;

				}

				//check column visibility


				if (!ifVisible) {

					offset = colEl.offsetLeft;

					if (offset > 0 && offset + colEl.offsetWidth < _this2.element.clientWidth) {

						return false;
					}
				}

				//calculate scroll position


				left = colEl.offsetLeft + _this2.element.scrollLeft + adjust;

				left = Math.max(Math.min(left, _this2.table.rowManager.element.scrollWidth - _this2.table.rowManager.element.clientWidth), 0);

				_this2.table.rowManager.scrollHorizontal(left);

				_this2.scrollHorizontal(left);

				resolve();
			} else {

				console.warn("Scroll Error - Column not visible");

				reject("Scroll Error - Column not visible");
			}
		});
	};

	//////////////// Cell Management /////////////////


	ColumnManager.prototype.generateCells = function (row) {

		var self = this;

		var cells = [];

		self.columnsByIndex.forEach(function (column) {

			cells.push(column.generateCell(row));
		});

		return cells;
	};

	//////////////// Column Management /////////////////


	ColumnManager.prototype.getFlexBaseWidth = function () {

		var self = this,
		    totalWidth = self.table.element.clientWidth,
		    //table element width


		fixedWidth = 0;

		//adjust for vertical scrollbar if present


		if (self.rowManager.element.scrollHeight > self.rowManager.element.clientHeight) {

			totalWidth -= self.rowManager.element.offsetWidth - self.rowManager.element.clientWidth;
		}

		this.columnsByIndex.forEach(function (column) {

			var width, minWidth, colWidth;

			if (column.visible) {

				width = column.definition.width || 0;

				minWidth = typeof column.minWidth == "undefined" ? self.table.options.columnMinWidth : parseInt(column.minWidth);

				if (typeof width == "string") {

					if (width.indexOf("%") > -1) {

						colWidth = totalWidth / 100 * parseInt(width);
					} else {

						colWidth = parseInt(width);
					}
				} else {

					colWidth = width;
				}

				fixedWidth += colWidth > minWidth ? colWidth : minWidth;
			}
		});

		return fixedWidth;
	};

	ColumnManager.prototype.addColumn = function (definition, before, nextToColumn) {
		var _this3 = this;

		return new Promise(function (resolve, reject) {

			var column = _this3._addColumn(definition, before, nextToColumn);

			_this3._reIndexColumns();

			if (_this3.table.options.responsiveLayout && _this3.table.modExists("responsiveLayout", true)) {

				_this3.table.modules.responsiveLayout.initialize();
			}

			if (_this3.table.modExists("columnCalcs")) {

				_this3.table.modules.columnCalcs.recalc(_this3.table.rowManager.activeRows);
			}

			_this3.redraw();

			if (_this3.table.modules.layout.getMode() != "fitColumns") {

				column.reinitializeWidth();
			}

			_this3._verticalAlignHeaders();

			_this3.table.rowManager.reinitialize();

			resolve(column);
		});
	};

	//remove column from system


	ColumnManager.prototype.deregisterColumn = function (column) {

		var field = column.getField(),
		    index;

		//remove from field list


		if (field) {

			delete this.columnsByField[field];
		}

		//remove from index list


		index = this.columnsByIndex.indexOf(column);

		if (index > -1) {

			this.columnsByIndex.splice(index, 1);
		}

		//remove from column list


		index = this.columns.indexOf(column);

		if (index > -1) {

			this.columns.splice(index, 1);
		}

		if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

			this.table.modules.responsiveLayout.initialize();
		}

		this.redraw();
	};

	//redraw columns


	ColumnManager.prototype.redraw = function (force) {

		if (force) {

			if (Tabulator.prototype.helpers.elVisible(this.element)) {

				this._verticalAlignHeaders();
			}

			this.table.rowManager.resetScroll();

			this.table.rowManager.reinitialize();
		}

		if (["fitColumns", "fitDataStretch"].indexOf(this.table.modules.layout.getMode()) > -1) {

			this.table.modules.layout.layout();
		} else {

			if (force) {

				this.table.modules.layout.layout();
			} else {

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					this.table.modules.responsiveLayout.update();
				}
			}
		}

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
		}

		if (force) {

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (this.table.modExists("columnCalcs")) {

				this.table.modules.columnCalcs.redraw();
			}
		}

		this.table.footerManager.redraw();
	};

	//public column object

	var ColumnComponent = function ColumnComponent(column) {

		this._column = column;

		this.type = "ColumnComponent";
	};

	ColumnComponent.prototype.getElement = function () {

		return this._column.getElement();
	};

	ColumnComponent.prototype.getDefinition = function () {

		return this._column.getDefinition();
	};

	ColumnComponent.prototype.getField = function () {

		return this._column.getField();
	};

	ColumnComponent.prototype.getCells = function () {

		var cells = [];

		this._column.cells.forEach(function (cell) {

			cells.push(cell.getComponent());
		});

		return cells;
	};

	ColumnComponent.prototype.getVisibility = function () {

		return this._column.visible;
	};

	ColumnComponent.prototype.show = function () {

		if (this._column.isGroup) {

			this._column.columns.forEach(function (column) {

				column.show();
			});
		} else {

			this._column.show();
		}
	};

	ColumnComponent.prototype.hide = function () {

		if (this._column.isGroup) {

			this._column.columns.forEach(function (column) {

				column.hide();
			});
		} else {

			this._column.hide();
		}
	};

	ColumnComponent.prototype.toggle = function () {

		if (this._column.visible) {

			this.hide();
		} else {

			this.show();
		}
	};

	ColumnComponent.prototype.delete = function () {

		return this._column.delete();
	};

	ColumnComponent.prototype.getSubColumns = function () {

		var output = [];

		if (this._column.columns.length) {

			this._column.columns.forEach(function (column) {

				output.push(column.getComponent());
			});
		}

		return output;
	};

	ColumnComponent.prototype.getParentColumn = function () {

		return this._column.parent instanceof Column ? this._column.parent.getComponent() : false;
	};

	ColumnComponent.prototype._getSelf = function () {

		return this._column;
	};

	ColumnComponent.prototype.scrollTo = function () {

		return this._column.table.columnManager.scrollToColumn(this._column);
	};

	ColumnComponent.prototype.getTable = function () {

		return this._column.table;
	};

	ColumnComponent.prototype.headerFilterFocus = function () {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.setHeaderFilterFocus(this._column);
		}
	};

	ColumnComponent.prototype.reloadHeaderFilter = function () {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.reloadHeaderFilter(this._column);
		}
	};

	ColumnComponent.prototype.getHeaderFilterValue = function () {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.getHeaderFilterValue(this._column);
		}
	};

	ColumnComponent.prototype.setHeaderFilterValue = function (value) {

		if (this._column.table.modExists("filter", true)) {

			this._column.table.modules.filter.setHeaderFilterValue(this._column, value);
		}
	};

	ColumnComponent.prototype.move = function (to, after) {

		var toColumn = this._column.table.columnManager.findColumn(to);

		if (toColumn) {

			this._column.table.columnManager.moveColumn(this._column, toColumn, after);
		} else {

			console.warn("Move Error - No matching column found:", toColumn);
		}
	};

	ColumnComponent.prototype.getNextColumn = function () {

		var nextCol = this._column.nextColumn();

		return nextCol ? nextCol.getComponent() : false;
	};

	ColumnComponent.prototype.getPrevColumn = function () {

		var prevCol = this._column.prevColumn();

		return prevCol ? prevCol.getComponent() : false;
	};

	ColumnComponent.prototype.updateDefinition = function (updates) {

		return this._column.updateDefinition(updates);
	};

	var Column = function Column(def, parent) {

		var self = this;

		this.table = parent.table;

		this.definition = def; //column definition

		this.parent = parent; //hold parent object

		this.type = "column"; //type of element

		this.columns = []; //child columns

		this.cells = []; //cells bound to this column

		this.element = this.createElement(); //column header element

		this.contentElement = false;

		this.titleElement = false;

		this.groupElement = this.createGroupElement(); //column group holder element

		this.isGroup = false;

		this.tooltip = false; //hold column tooltip

		this.hozAlign = ""; //horizontal text alignment

		this.vertAlign = ""; //vert text alignment


		//multi dimensional filed handling

		this.field = "";

		this.fieldStructure = "";

		this.getFieldValue = "";

		this.setFieldValue = "";

		this.titleFormatterRendered = false;

		this.setField(this.definition.field);

		if (this.table.options.invalidOptionWarnings) {

			this.checkDefinition();
		}

		this.modules = {}; //hold module variables;


		this.cellEvents = {

			cellClick: false,

			cellDblClick: false,

			cellContext: false,

			cellTap: false,

			cellDblTap: false,

			cellTapHold: false,

			cellMouseEnter: false,

			cellMouseLeave: false,

			cellMouseOver: false,

			cellMouseOut: false,

			cellMouseMove: false

		};

		this.width = null; //column width

		this.widthStyled = ""; //column width prestyled to improve render efficiency

		this.minWidth = null; //column minimum width

		this.minWidthStyled = ""; //column minimum prestyled to improve render efficiency

		this.widthFixed = false; //user has specified a width for this column


		this.visible = true; //default visible state


		this._mapDepricatedFunctionality();

		//initialize column

		if (def.columns) {

			this.isGroup = true;

			def.columns.forEach(function (def, i) {

				var newCol = new Column(def, self);

				self.attachColumn(newCol);
			});

			self.checkColumnVisibility();
		} else {

			parent.registerColumnField(this);
		}

		if (def.rowHandle && this.table.options.movableRows !== false && this.table.modExists("moveRow")) {

			this.table.modules.moveRow.setHandle(true);
		}

		this._buildHeader();

		this.bindModuleColumns();
	};

	Column.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-col");

		el.setAttribute("role", "columnheader");

		el.setAttribute("aria-sort", "none");

		return el;
	};

	Column.prototype.createGroupElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-col-group-cols");

		return el;
	};

	Column.prototype.checkDefinition = function () {
		var _this4 = this;

		Object.keys(this.definition).forEach(function (key) {

			if (_this4.defaultOptionList.indexOf(key) === -1) {

				console.warn("Invalid column definition option in '" + (_this4.field || _this4.definition.title) + "' column:", key);
			}
		});
	};

	Column.prototype.setField = function (field) {

		this.field = field;

		this.fieldStructure = field ? this.table.options.nestedFieldSeparator ? field.split(this.table.options.nestedFieldSeparator) : [field] : [];

		this.getFieldValue = this.fieldStructure.length > 1 ? this._getNestedData : this._getFlatData;

		this.setFieldValue = this.fieldStructure.length > 1 ? this._setNestedData : this._setFlatData;
	};

	//register column position with column manager

	Column.prototype.registerColumnPosition = function (column) {

		this.parent.registerColumnPosition(column);
	};

	//register column position with column manager

	Column.prototype.registerColumnField = function (column) {

		this.parent.registerColumnField(column);
	};

	//trigger position registration

	Column.prototype.reRegisterPosition = function () {

		if (this.isGroup) {

			this.columns.forEach(function (column) {

				column.reRegisterPosition();
			});
		} else {

			this.registerColumnPosition(this);
		}
	};

	Column.prototype._mapDepricatedFunctionality = function () {

		if (typeof this.definition.hideInHtml !== "undefined") {

			this.definition.htmlOutput = !this.definition.hideInHtml;

			console.warn("hideInHtml column definition property is deprecated, you should now use htmlOutput");
		}

		if (typeof this.definition.align !== "undefined") {

			this.definition.hozAlign = this.definition.align;

			console.warn("align column definition property is deprecated, you should now use hozAlign");
		}
	};

	Column.prototype.setTooltip = function () {

		var self = this,
		    def = self.definition;

		//set header tooltips

		var tooltip = def.headerTooltip || def.tooltip === false ? def.headerTooltip : self.table.options.tooltipsHeader;

		if (tooltip) {

			if (tooltip === true) {

				if (def.field) {

					self.table.modules.localize.bind("columns|" + def.field, function (value) {

						self.element.setAttribute("title", value || def.title);
					});
				} else {

					self.element.setAttribute("title", def.title);
				}
			} else {

				if (typeof tooltip == "function") {

					tooltip = tooltip(self.getComponent());

					if (tooltip === false) {

						tooltip = "";
					}
				}

				self.element.setAttribute("title", tooltip);
			}
		} else {

			self.element.setAttribute("title", "");
		}
	};

	//build header element

	Column.prototype._buildHeader = function () {

		var self = this,
		    def = self.definition;

		while (self.element.firstChild) {
			self.element.removeChild(self.element.firstChild);
		}if (def.headerVertical) {

			self.element.classList.add("tabulator-col-vertical");

			if (def.headerVertical === "flip") {

				self.element.classList.add("tabulator-col-vertical-flip");
			}
		}

		self.contentElement = self._bindEvents();

		self.contentElement = self._buildColumnHeaderContent();

		self.element.appendChild(self.contentElement);

		if (self.isGroup) {

			self._buildGroupHeader();
		} else {

			self._buildColumnHeader();
		}

		self.setTooltip();

		//set resizable handles

		if (self.table.options.resizableColumns && self.table.modExists("resizeColumns")) {

			self.table.modules.resizeColumns.initializeColumn("header", self, self.element);
		}

		//set resizable handles

		if (def.headerFilter && self.table.modExists("filter") && self.table.modExists("edit")) {

			if (typeof def.headerFilterPlaceholder !== "undefined" && def.field) {

				self.table.modules.localize.setHeaderFilterColumnPlaceholder(def.field, def.headerFilterPlaceholder);
			}

			self.table.modules.filter.initializeColumn(self);
		}

		//set resizable handles

		if (self.table.modExists("frozenColumns")) {

			self.table.modules.frozenColumns.initializeColumn(self);
		}

		//set movable column

		if (self.table.options.movableColumns && !self.isGroup && self.table.modExists("moveColumn")) {

			self.table.modules.moveColumn.initializeColumn(self);
		}

		//set calcs column

		if ((def.topCalc || def.bottomCalc) && self.table.modExists("columnCalcs")) {

			self.table.modules.columnCalcs.initializeColumn(self);
		}

		//handle persistence

		if (self.table.modExists("persistence") && self.table.modules.persistence.config.columns) {

			self.table.modules.persistence.initializeColumn(self);
		}

		//update header tooltip on mouse enter

		self.element.addEventListener("mouseenter", function (e) {

			self.setTooltip();
		});
	};

	Column.prototype._bindEvents = function () {

		var self = this,
		    def = self.definition,
		    dblTap,
		    tapHold,
		    tap;

		//setup header click event bindings

		if (typeof def.headerClick == "function") {

			self.element.addEventListener("click", function (e) {
				def.headerClick(e, self.getComponent());
			});
		}

		if (typeof def.headerDblClick == "function") {

			self.element.addEventListener("dblclick", function (e) {
				def.headerDblClick(e, self.getComponent());
			});
		}

		if (typeof def.headerContext == "function") {

			self.element.addEventListener("contextmenu", function (e) {
				def.headerContext(e, self.getComponent());
			});
		}

		//setup header tap event bindings

		if (typeof def.headerTap == "function") {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				if (tap) {

					def.headerTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (typeof def.headerDblTap == "function") {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					def.headerDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (typeof def.headerTapHold == "function") {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					def.headerTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}

		//store column cell click event bindings

		if (typeof def.cellClick == "function") {

			self.cellEvents.cellClick = def.cellClick;
		}

		if (typeof def.cellDblClick == "function") {

			self.cellEvents.cellDblClick = def.cellDblClick;
		}

		if (typeof def.cellContext == "function") {

			self.cellEvents.cellContext = def.cellContext;
		}

		//store column mouse event bindings

		if (typeof def.cellMouseEnter == "function") {

			self.cellEvents.cellMouseEnter = def.cellMouseEnter;
		}

		if (typeof def.cellMouseLeave == "function") {

			self.cellEvents.cellMouseLeave = def.cellMouseLeave;
		}

		if (typeof def.cellMouseOver == "function") {

			self.cellEvents.cellMouseOver = def.cellMouseOver;
		}

		if (typeof def.cellMouseOut == "function") {

			self.cellEvents.cellMouseOut = def.cellMouseOut;
		}

		if (typeof def.cellMouseMove == "function") {

			self.cellEvents.cellMouseMove = def.cellMouseMove;
		}

		//setup column cell tap event bindings

		if (typeof def.cellTap == "function") {

			self.cellEvents.cellTap = def.cellTap;
		}

		if (typeof def.cellDblTap == "function") {

			self.cellEvents.cellDblTap = def.cellDblTap;
		}

		if (typeof def.cellTapHold == "function") {

			self.cellEvents.cellTapHold = def.cellTapHold;
		}

		//setup column cell edit callbacks

		if (typeof def.cellEdited == "function") {

			self.cellEvents.cellEdited = def.cellEdited;
		}

		if (typeof def.cellEditing == "function") {

			self.cellEvents.cellEditing = def.cellEditing;
		}

		if (typeof def.cellEditCancelled == "function") {

			self.cellEvents.cellEditCancelled = def.cellEditCancelled;
		}
	};

	//build header element for header

	Column.prototype._buildColumnHeader = function () {

		var self = this,
		    def = self.definition,
		    table = self.table,
		    sortable;

		//set column sorter

		if (table.modExists("sort")) {

			table.modules.sort.initializeColumn(self, self.contentElement);
		}

		//set column header context menu

		if ((def.headerContextMenu || def.headerMenu) && table.modExists("menu")) {

			table.modules.menu.initializeColumnHeader(self);
		}

		//set column formatter

		if (table.modExists("format")) {

			table.modules.format.initializeColumn(self);
		}

		//set column editor

		if (typeof def.editor != "undefined" && table.modExists("edit")) {

			table.modules.edit.initializeColumn(self);
		}

		//set colum validator

		if (typeof def.validator != "undefined" && table.modExists("validate")) {

			table.modules.validate.initializeColumn(self);
		}

		//set column mutator

		if (table.modExists("mutator")) {

			table.modules.mutator.initializeColumn(self);
		}

		//set column accessor

		if (table.modExists("accessor")) {

			table.modules.accessor.initializeColumn(self);
		}

		//set respoviveLayout

		if (_typeof(table.options.responsiveLayout) && table.modExists("responsiveLayout")) {

			table.modules.responsiveLayout.initializeColumn(self);
		}

		//set column visibility

		if (typeof def.visible != "undefined") {

			if (def.visible) {

				self.show(true);
			} else {

				self.hide(true);
			}
		}

		//asign additional css classes to column header

		if (def.cssClass) {

			var classeNames = def.cssClass.split(" ");

			classeNames.forEach(function (className) {

				self.element.classList.add(className);
			});
		}

		if (def.field) {

			this.element.setAttribute("tabulator-field", def.field);
		}

		//set min width if present

		self.setMinWidth(typeof def.minWidth == "undefined" ? self.table.options.columnMinWidth : parseInt(def.minWidth));

		self.reinitializeWidth();

		//set tooltip if present

		self.tooltip = self.definition.tooltip || self.definition.tooltip === false ? self.definition.tooltip : self.table.options.tooltips;

		//set orizontal text alignment

		self.hozAlign = typeof self.definition.hozAlign == "undefined" ? self.table.options.cellHozAlign : self.definition.hozAlign;

		self.vertAlign = typeof self.definition.vertAlign == "undefined" ? self.table.options.cellVertAlign : self.definition.vertAlign;
	};

	Column.prototype._buildColumnHeaderContent = function () {

		var def = self.definition,
		    table = self.table;

		var contentElement = document.createElement("div");

		contentElement.classList.add("tabulator-col-content");

		this.titleElement = this._buildColumnHeaderTitle();

		contentElement.appendChild(this.titleElement);

		return contentElement;
	};

	//build title element of column

	Column.prototype._buildColumnHeaderTitle = function () {

		var self = this,
		    def = self.definition,
		    table = self.table,
		    title;

		var titleHolderElement = document.createElement("div");

		titleHolderElement.classList.add("tabulator-col-title");

		if (def.editableTitle) {

			var titleElement = document.createElement("input");

			titleElement.classList.add("tabulator-title-editor");

			titleElement.addEventListener("click", function (e) {

				e.stopPropagation();

				titleElement.focus();
			});

			titleElement.addEventListener("change", function () {

				def.title = titleElement.value;

				table.options.columnTitleChanged.call(self.table, self.getComponent());
			});

			titleHolderElement.appendChild(titleElement);

			if (def.field) {

				table.modules.localize.bind("columns|" + def.field, function (text) {

					titleElement.value = text || def.title || "&nbsp;";
				});
			} else {

				titleElement.value = def.title || "&nbsp;";
			}
		} else {

			if (def.field) {

				table.modules.localize.bind("columns|" + def.field, function (text) {

					self._formatColumnHeaderTitle(titleHolderElement, text || def.title || "&nbsp;");
				});
			} else {

				self._formatColumnHeaderTitle(titleHolderElement, def.title || "&nbsp;");
			}
		}

		return titleHolderElement;
	};

	Column.prototype._formatColumnHeaderTitle = function (el, title) {
		var _this5 = this;

		var formatter, contents, params, mockCell, onRendered;

		if (this.definition.titleFormatter && this.table.modExists("format")) {

			formatter = this.table.modules.format.getFormatter(this.definition.titleFormatter);

			onRendered = function onRendered(callback) {

				_this5.titleFormatterRendered = callback;
			};

			mockCell = {

				getValue: function getValue() {

					return title;
				},

				getElement: function getElement() {

					return el;
				}

			};

			params = this.definition.titleFormatterParams || {};

			params = typeof params === "function" ? params() : params;

			contents = formatter.call(this.table.modules.format, mockCell, params, onRendered);

			switch (typeof contents === 'undefined' ? 'undefined' : _typeof(contents)) {

				case "object":

					if (contents instanceof Node) {

						el.appendChild(contents);
					} else {

						el.innerHTML = "";

						console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", contents);
					}

					break;

				case "undefined":

				case "null":

					el.innerHTML = "";

					break;

				default:

					el.innerHTML = contents;

			}
		} else {

			el.innerHTML = title;
		}
	};

	//build header element for column group

	Column.prototype._buildGroupHeader = function () {
		var _this6 = this;

		this.element.classList.add("tabulator-col-group");

		this.element.setAttribute("role", "columngroup");

		this.element.setAttribute("aria-title", this.definition.title);

		//asign additional css classes to column header

		if (this.definition.cssClass) {

			var classeNames = this.definition.cssClass.split(" ");

			classeNames.forEach(function (className) {

				_this6.element.classList.add(className);
			});
		}

		this.element.appendChild(this.groupElement);
	};

	//flat field lookup

	Column.prototype._getFlatData = function (data) {

		return data[this.field];
	};

	//nested field lookup

	Column.prototype._getNestedData = function (data) {

		var dataObj = data,
		    structure = this.fieldStructure,
		    length = structure.length,
		    output;

		for (var i = 0; i < length; i++) {

			dataObj = dataObj[structure[i]];

			output = dataObj;

			if (!dataObj) {

				break;
			}
		}

		return output;
	};

	//flat field set

	Column.prototype._setFlatData = function (data, value) {

		if (this.field) {

			data[this.field] = value;
		}
	};

	//nested field set

	Column.prototype._setNestedData = function (data, value) {

		var dataObj = data,
		    structure = this.fieldStructure,
		    length = structure.length;

		for (var i = 0; i < length; i++) {

			if (i == length - 1) {

				dataObj[structure[i]] = value;
			} else {

				if (!dataObj[structure[i]]) {

					if (typeof value !== "undefined") {

						dataObj[structure[i]] = {};
					} else {

						break;
					}
				}

				dataObj = dataObj[structure[i]];
			}
		}
	};

	//attach column to this group

	Column.prototype.attachColumn = function (column) {

		var self = this;

		if (self.groupElement) {

			self.columns.push(column);

			self.groupElement.appendChild(column.getElement());
		} else {

			console.warn("Column Warning - Column being attached to another column instead of column group");
		}
	};

	//vertically align header in column

	Column.prototype.verticalAlign = function (alignment, height) {

		//calculate height of column header and group holder element

		var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : height || this.parent.getHeadersElement().clientHeight;

		// var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : this.parent.getHeadersElement().clientHeight;


		this.element.style.height = parentHeight + "px";

		if (this.isGroup) {

			this.groupElement.style.minHeight = parentHeight - this.contentElement.offsetHeight + "px";
		}

		//vertically align cell contents

		if (!this.isGroup && alignment !== "top") {

			if (alignment === "bottom") {

				this.element.style.paddingTop = this.element.clientHeight - this.contentElement.offsetHeight + "px";
			} else {

				this.element.style.paddingTop = (this.element.clientHeight - this.contentElement.offsetHeight) / 2 + "px";
			}
		}

		this.columns.forEach(function (column) {

			column.verticalAlign(alignment);
		});
	};

	//clear vertical alignmenet

	Column.prototype.clearVerticalAlign = function () {

		this.element.style.paddingTop = "";

		this.element.style.height = "";

		this.element.style.minHeight = "";

		this.groupElement.style.minHeight = "";

		this.columns.forEach(function (column) {

			column.clearVerticalAlign();
		});
	};

	Column.prototype.bindModuleColumns = function () {

		//check if rownum formatter is being used on a column

		if (this.definition.formatter == "rownum") {

			this.table.rowManager.rowNumColumn = this;
		}
	};

	//// Retreive Column Information ////


	//return column header element

	Column.prototype.getElement = function () {

		return this.element;
	};

	//return colunm group element

	Column.prototype.getGroupElement = function () {

		return this.groupElement;
	};

	//return field name

	Column.prototype.getField = function () {

		return this.field;
	};

	//return the first column in a group

	Column.prototype.getFirstColumn = function () {

		if (!this.isGroup) {

			return this;
		} else {

			if (this.columns.length) {

				return this.columns[0].getFirstColumn();
			} else {

				return false;
			}
		}
	};

	//return the last column in a group

	Column.prototype.getLastColumn = function () {

		if (!this.isGroup) {

			return this;
		} else {

			if (this.columns.length) {

				return this.columns[this.columns.length - 1].getLastColumn();
			} else {

				return false;
			}
		}
	};

	//return all columns in a group

	Column.prototype.getColumns = function () {

		return this.columns;
	};

	//return all columns in a group

	Column.prototype.getCells = function () {

		return this.cells;
	};

	//retreive the top column in a group of columns

	Column.prototype.getTopColumn = function () {

		if (this.parent.isGroup) {

			return this.parent.getTopColumn();
		} else {

			return this;
		}
	};

	//return column definition object

	Column.prototype.getDefinition = function (updateBranches) {

		var colDefs = [];

		if (this.isGroup && updateBranches) {

			this.columns.forEach(function (column) {

				colDefs.push(column.getDefinition(true));
			});

			this.definition.columns = colDefs;
		}

		return this.definition;
	};

	//////////////////// Actions ////////////////////


	Column.prototype.checkColumnVisibility = function () {

		var visible = false;

		this.columns.forEach(function (column) {

			if (column.visible) {

				visible = true;
			}
		});

		if (visible) {

			this.show();

			this.parent.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), false);
		} else {

			this.hide();
		}
	};

	//show column

	Column.prototype.show = function (silent, responsiveToggle) {

		if (!this.visible) {

			this.visible = true;

			this.element.style.display = "";

			if (this.parent.isGroup) {

				this.parent.checkColumnVisibility();
			}

			this.cells.forEach(function (cell) {

				cell.show();
			});

			if (!this.isGroup && this.width === null) {

				this.reinitializeWidth();
			}

			this.table.columnManager._verticalAlignHeaders();

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (!responsiveToggle && this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.updateColumnVisibility(this, this.visible);
			}

			if (!silent) {

				this.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), true);
			}

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	//hide column

	Column.prototype.hide = function (silent, responsiveToggle) {

		if (this.visible) {

			this.visible = false;

			this.element.style.display = "none";

			this.table.columnManager._verticalAlignHeaders();

			if (this.parent.isGroup) {

				this.parent.checkColumnVisibility();
			}

			this.cells.forEach(function (cell) {

				cell.hide();
			});

			if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.columns) {

				this.table.modules.persistence.save("columns");
			}

			if (!responsiveToggle && this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.updateColumnVisibility(this, this.visible);
			}

			if (!silent) {

				this.table.options.columnVisibilityChanged.call(this.table, this.getComponent(), false);
			}

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	Column.prototype.matchChildWidths = function () {

		var childWidth = 0;

		if (this.contentElement && this.columns.length) {

			this.columns.forEach(function (column) {

				if (column.visible) {

					childWidth += column.getWidth();
				}
			});

			this.contentElement.style.maxWidth = childWidth - 1 + "px";

			if (this.parent.isGroup) {

				this.parent.matchChildWidths();
			}
		}
	};

	Column.prototype.setWidth = function (width) {

		this.widthFixed = true;

		this.setWidthActual(width);
	};

	Column.prototype.setWidthActual = function (width) {

		if (isNaN(width)) {

			width = Math.floor(this.table.element.clientWidth / 100 * parseInt(width));
		}

		width = Math.max(this.minWidth, width);

		this.width = width;

		this.widthStyled = width ? width + "px" : "";

		this.element.style.width = this.widthStyled;

		if (!this.isGroup) {

			this.cells.forEach(function (cell) {

				cell.setWidth();
			});
		}

		if (this.parent.isGroup) {

			this.parent.matchChildWidths();
		}

		//set resizable handles

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}
	};

	Column.prototype.checkCellHeights = function () {

		var rows = [];

		this.cells.forEach(function (cell) {

			if (cell.row.heightInitialized) {

				if (cell.row.getElement().offsetParent !== null) {

					rows.push(cell.row);

					cell.row.clearCellHeight();
				} else {

					cell.row.heightInitialized = false;
				}
			}
		});

		rows.forEach(function (row) {

			row.calcHeight();
		});

		rows.forEach(function (row) {

			row.setCellHeight();
		});
	};

	Column.prototype.getWidth = function () {

		var width = 0;

		if (this.isGroup) {

			this.columns.forEach(function (column) {

				if (column.visible) {

					width += column.getWidth();
				}
			});
		} else {

			width = this.width;
		}

		return width;
	};

	Column.prototype.getHeight = function () {

		return this.element.offsetHeight;
	};

	Column.prototype.setMinWidth = function (minWidth) {

		this.minWidth = minWidth;

		this.minWidthStyled = minWidth ? minWidth + "px" : "";

		this.element.style.minWidth = this.minWidthStyled;

		this.cells.forEach(function (cell) {

			cell.setMinWidth();
		});
	};

	Column.prototype.delete = function () {
		var _this7 = this;

		return new Promise(function (resolve, reject) {

			if (_this7.isGroup) {

				_this7.columns.forEach(function (column) {

					column.delete();
				});
			}

			var cellCount = _this7.cells.length;

			for (var i = 0; i < cellCount; i++) {

				_this7.cells[0].delete();
			}

			_this7.element.parentNode.removeChild(_this7.element);

			_this7.table.columnManager.deregisterColumn(_this7);

			resolve();
		});
	};

	Column.prototype.columnRendered = function () {

		if (this.titleFormatterRendered) {

			this.titleFormatterRendered();
		}
	};

	//////////////// Cell Management /////////////////


	//generate cell for this column

	Column.prototype.generateCell = function (row) {

		var self = this;

		var cell = new Cell(self, row);

		this.cells.push(cell);

		return cell;
	};

	Column.prototype.nextColumn = function () {

		var index = this.table.columnManager.findColumnIndex(this);

		return index > -1 ? this._nextVisibleColumn(index + 1) : false;
	};

	Column.prototype._nextVisibleColumn = function (index) {

		var column = this.table.columnManager.getColumnByIndex(index);

		return !column || column.visible ? column : this._nextVisibleColumn(index + 1);
	};

	Column.prototype.prevColumn = function () {

		var index = this.table.columnManager.findColumnIndex(this);

		return index > -1 ? this._prevVisibleColumn(index - 1) : false;
	};

	Column.prototype._prevVisibleColumn = function (index) {

		var column = this.table.columnManager.getColumnByIndex(index);

		return !column || column.visible ? column : this._prevVisibleColumn(index - 1);
	};

	Column.prototype.reinitializeWidth = function (force) {

		this.widthFixed = false;

		//set width if present

		if (typeof this.definition.width !== "undefined" && !force) {

			this.setWidth(this.definition.width);
		}

		//hide header filters to prevent them altering column width

		if (this.table.modExists("filter")) {

			this.table.modules.filter.hideHeaderFilterElements();
		}

		this.fitToData();

		//show header filters again after layout is complete

		if (this.table.modExists("filter")) {

			this.table.modules.filter.showHeaderFilterElements();
		}
	};

	//set column width to maximum cell width

	Column.prototype.fitToData = function () {

		var self = this;

		if (!this.widthFixed) {

			this.element.style.width = "";

			self.cells.forEach(function (cell) {

				cell.clearWidth();
			});
		}

		var maxWidth = this.element.offsetWidth;

		if (!self.width || !this.widthFixed) {

			self.cells.forEach(function (cell) {

				var width = cell.getWidth();

				if (width > maxWidth) {

					maxWidth = width;
				}
			});

			if (maxWidth) {

				self.setWidthActual(maxWidth + 1);
			}
		}
	};

	Column.prototype.updateDefinition = function (updates) {
		var _this8 = this;

		return new Promise(function (resolve, reject) {

			var definition;

			if (!_this8.isGroup) {

				definition = Object.assign({}, _this8.getDefinition());

				definition = Object.assign(definition, updates);

				_this8.table.columnManager.addColumn(definition, false, _this8).then(function (column) {

					if (definition.field == _this8.field) {

						_this8.field = false; //cleair field name to prevent deletion of duplicate column from arrays
					}

					_this8.delete().then(function () {

						resolve(column.getComponent());
					}).catch(function (err) {

						reject(err);
					});
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Update Error - The updateDefintion function is only available on columns, not column groups");

				reject("Column Update Error - The updateDefintion function is only available on columns, not column groups");
			}
		});
	};

	Column.prototype.deleteCell = function (cell) {

		var index = this.cells.indexOf(cell);

		if (index > -1) {

			this.cells.splice(index, 1);
		}
	};

	Column.prototype.defaultOptionList = ["title", "field", "columns", "visible", "align", "hozAlign", "vertAlign", "width", "minWidth", "widthGrow", "widthShrink", "resizable", "frozen", "responsive", "tooltip", "cssClass", "rowHandle", "hideInHtml", "print", "htmlOutput", "sorter", "sorterParams", "formatter", "formatterParams", "variableHeight", "editable", "editor", "editorParams", "validator", "mutator", "mutatorParams", "mutatorData", "mutatorDataParams", "mutatorEdit", "mutatorEditParams", "mutatorClipboard", "mutatorClipboardParams", "accessor", "accessorParams", "accessorData", "accessorDataParams", "accessorDownload", "accessorDownloadParams", "accessorClipboard", "accessorClipboardParams", "accessorPrint", "accessorPrintParams", "accessorHtmlOutput", "accessorHtmlOutputParams", "clipboard", "download", "downloadTitle", "topCalc", "topCalcParams", "topCalcFormatter", "topCalcFormatterParams", "bottomCalc", "bottomCalcParams", "bottomCalcFormatter", "bottomCalcFormatterParams", "cellClick", "cellDblClick", "cellContext", "cellTap", "cellDblTap", "cellTapHold", "cellMouseEnter", "cellMouseLeave", "cellMouseOver", "cellMouseOut", "cellMouseMove", "cellEditing", "cellEdited", "cellEditCancelled", "headerSort", "headerSortStartingDir", "headerSortTristate", "headerClick", "headerDblClick", "headerContext", "headerTap", "headerDblTap", "headerTapHold", "headerTooltip", "headerVertical", "editableTitle", "titleFormatter", "titleFormatterParams", "headerFilter", "headerFilterPlaceholder", "headerFilterParams", "headerFilterEmptyCheck", "headerFilterFunc", "headerFilterFuncParams", "headerFilterLiveFilter", "print", "headerContextMenu", "headerMenu", "contextMenu", "formatterPrint", "formatterPrintParams", "formatterClipboard", "formatterClipboardParams", "formatterHtmlOutput", "formatterHtmlOutputParams"];

	//////////////// Event Bindings /////////////////


	//////////////// Object Generation /////////////////

	Column.prototype.getComponent = function () {

		return new ColumnComponent(this);
	};

	var RowManager = function RowManager(table) {

		this.table = table;

		this.element = this.createHolderElement(); //containing element

		this.tableElement = this.createTableElement(); //table element

		this.heightFixer = this.createTableElement(); //table element

		this.columnManager = null; //hold column manager object

		this.height = 0; //hold height of table element


		this.firstRender = false; //handle first render

		this.renderMode = "virtual"; //current rendering mode

		this.fixedHeight = false; //current rendering mode


		this.rows = []; //hold row data objects

		this.activeRows = []; //rows currently available to on display in the table

		this.activeRowsCount = 0; //count of active rows


		this.displayRows = []; //rows currently on display in the table

		this.displayRowsCount = 0; //count of display rows


		this.scrollTop = 0;

		this.scrollLeft = 0;

		this.vDomRowHeight = 20; //approximation of row heights for padding


		this.vDomTop = 0; //hold position for first rendered row in the virtual DOM

		this.vDomBottom = 0; //hold possition for last rendered row in the virtual DOM


		this.vDomScrollPosTop = 0; //last scroll position of the vDom top;

		this.vDomScrollPosBottom = 0; //last scroll position of the vDom bottom;


		this.vDomTopPad = 0; //hold value of padding for top of virtual DOM

		this.vDomBottomPad = 0; //hold value of padding for bottom of virtual DOM


		this.vDomMaxRenderChain = 90; //the maximum number of dom elements that can be rendered in 1 go


		this.vDomWindowBuffer = 0; //window row buffer before removing elements, to smooth scrolling


		this.vDomWindowMinTotalRows = 20; //minimum number of rows to be generated in virtual dom (prevent buffering issues on tables with tall rows)

		this.vDomWindowMinMarginRows = 5; //minimum number of rows to be generated in virtual dom margin


		this.vDomTopNewRows = []; //rows to normalize after appending to optimize render speed

		this.vDomBottomNewRows = []; //rows to normalize after appending to optimize render speed


		this.rowNumColumn = false; //hold column component for row number column


		this.redrawBlock = false; //prevent redraws to allow multiple data manipulations becore continuing

		this.redrawBlockRestoreConfig = false; //store latest redraw function calls for when redraw is needed

		this.redrawBlockRederInPosition = false; //store latest redraw function calls for when redraw is needed
	};

	//////////////// Setup Functions /////////////////


	RowManager.prototype.createHolderElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-tableHolder");

		el.setAttribute("tabindex", 0);

		return el;
	};

	RowManager.prototype.createTableElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-table");

		return el;
	};

	//return containing element

	RowManager.prototype.getElement = function () {

		return this.element;
	};

	//return table element

	RowManager.prototype.getTableElement = function () {

		return this.tableElement;
	};

	//return position of row in table

	RowManager.prototype.getRowPosition = function (row, active) {

		if (active) {

			return this.activeRows.indexOf(row);
		} else {

			return this.rows.indexOf(row);
		}
	};

	//link to column manager

	RowManager.prototype.setColumnManager = function (manager) {

		this.columnManager = manager;
	};

	RowManager.prototype.initialize = function () {

		var self = this;

		self.setRenderMode();

		//initialize manager

		self.element.appendChild(self.tableElement);

		self.firstRender = true;

		//scroll header along with table body

		self.element.addEventListener("scroll", function () {

			var left = self.element.scrollLeft;

			//handle horizontal scrolling

			if (self.scrollLeft != left) {

				self.columnManager.scrollHorizontal(left);

				if (self.table.options.groupBy) {

					self.table.modules.groupRows.scrollHeaders(left);
				}

				if (self.table.modExists("columnCalcs")) {

					self.table.modules.columnCalcs.scrollHorizontal(left);
				}

				self.table.options.scrollHorizontal(left);
			}

			self.scrollLeft = left;
		});

		//handle virtual dom scrolling

		if (this.renderMode === "virtual") {

			self.element.addEventListener("scroll", function () {

				var top = self.element.scrollTop;

				var dir = self.scrollTop > top;

				//handle verical scrolling

				if (self.scrollTop != top) {

					self.scrollTop = top;

					self.scrollVertical(dir);

					if (self.table.options.ajaxProgressiveLoad == "scroll") {

						self.table.modules.ajax.nextPage(self.element.scrollHeight - self.element.clientHeight - top);
					}

					self.table.options.scrollVertical(top);
				} else {

					self.scrollTop = top;
				}
			});
		}
	};

	////////////////// Row Manipulation //////////////////


	RowManager.prototype.findRow = function (subject) {

		var self = this;

		if ((typeof subject === 'undefined' ? 'undefined' : _typeof(subject)) == "object") {

			if (subject instanceof Row) {

				//subject is row element

				return subject;
			} else if (subject instanceof RowComponent) {

				//subject is public row component

				return subject._getSelf() || false;
			} else if (typeof HTMLElement !== "undefined" && subject instanceof HTMLElement) {

				//subject is a HTML element of the row

				var match = self.rows.find(function (row) {

					return row.element === subject;
				});

				return match || false;
			}
		} else if (typeof subject == "undefined" || subject === null) {

			return false;
		} else {

			//subject should be treated as the index of the row

			var _match = self.rows.find(function (row) {

				return row.data[self.table.options.index] == subject;
			});

			return _match || false;
		}

		//catch all for any other type of input


		return false;
	};

	RowManager.prototype.getRowFromDataObject = function (data) {

		var match = this.rows.find(function (row) {

			return row.data === data;
		});

		return match || false;
	};

	RowManager.prototype.getRowFromPosition = function (position, active) {

		if (active) {

			return this.activeRows[position];
		} else {

			return this.rows[position];
		}
	};

	RowManager.prototype.scrollToRow = function (row, position, ifVisible) {
		var _this9 = this;

		var rowIndex = this.getDisplayRows().indexOf(row),
		    rowEl = row.getElement(),
		    rowTop,
		    offset = 0;

		return new Promise(function (resolve, reject) {

			if (rowIndex > -1) {

				if (typeof position === "undefined") {

					position = _this9.table.options.scrollToRowPosition;
				}

				if (typeof ifVisible === "undefined") {

					ifVisible = _this9.table.options.scrollToRowIfVisible;
				}

				if (position === "nearest") {

					switch (_this9.renderMode) {

						case "classic":

							rowTop = Tabulator.prototype.helpers.elOffset(rowEl).top;

							position = Math.abs(_this9.element.scrollTop - rowTop) > Math.abs(_this9.element.scrollTop + _this9.element.clientHeight - rowTop) ? "bottom" : "top";

							break;

						case "virtual":

							position = Math.abs(_this9.vDomTop - rowIndex) > Math.abs(_this9.vDomBottom - rowIndex) ? "bottom" : "top";

							break;

					}
				}

				//check row visibility

				if (!ifVisible) {

					if (Tabulator.prototype.helpers.elVisible(rowEl)) {

						offset = Tabulator.prototype.helpers.elOffset(rowEl).top - Tabulator.prototype.helpers.elOffset(_this9.element).top;

						if (offset > 0 && offset < _this9.element.clientHeight - rowEl.offsetHeight) {

							return false;
						}
					}
				}

				//scroll to row

				switch (_this9.renderMode) {

					case "classic":

						_this9.element.scrollTop = Tabulator.prototype.helpers.elOffset(rowEl).top - Tabulator.prototype.helpers.elOffset(_this9.element).top + _this9.element.scrollTop;

						break;

					case "virtual":

						_this9._virtualRenderFill(rowIndex, true);

						break;

				}

				//align to correct position

				switch (position) {

					case "middle":

					case "center":

						if (_this9.element.scrollHeight - _this9.element.scrollTop == _this9.element.clientHeight) {

							_this9.element.scrollTop = _this9.element.scrollTop + (rowEl.offsetTop - _this9.element.scrollTop) - (_this9.element.scrollHeight - rowEl.offsetTop) / 2;
						} else {

							_this9.element.scrollTop = _this9.element.scrollTop - _this9.element.clientHeight / 2;
						}

						break;

					case "bottom":

						if (_this9.element.scrollHeight - _this9.element.scrollTop == _this9.element.clientHeight) {

							_this9.element.scrollTop = _this9.element.scrollTop - (_this9.element.scrollHeight - rowEl.offsetTop) + rowEl.offsetHeight;
						} else {

							_this9.element.scrollTop = _this9.element.scrollTop - _this9.element.clientHeight + rowEl.offsetHeight;
						}

						break;

				}

				resolve();
			} else {

				console.warn("Scroll Error - Row not visible");

				reject("Scroll Error - Row not visible");
			}
		});
	};

	////////////////// Data Handling //////////////////


	RowManager.prototype.setData = function (data, renderInPosition, columnsChanged) {
		var _this10 = this;

		var self = this;

		return new Promise(function (resolve, reject) {

			if (renderInPosition && _this10.getDisplayRows().length) {

				if (self.table.options.pagination) {

					self._setDataActual(data, true);
				} else {

					_this10.reRenderInPosition(function () {

						self._setDataActual(data);
					});
				}
			} else {

				if (_this10.table.options.autoColumns && columnsChanged) {

					_this10.table.columnManager.generateColumnsFromRowData(data);
				}

				_this10.resetScroll();

				_this10._setDataActual(data);
			}

			resolve();
		});
	};

	RowManager.prototype._setDataActual = function (data, renderInPosition) {

		var self = this;

		self.table.options.dataLoading.call(this.table, data);

		this._wipeElements();

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.clear();
		}

		if (Array.isArray(data)) {

			if (this.table.modExists("selectRow")) {

				this.table.modules.selectRow.clearSelectionData();
			}

			if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {

				this.table.modules.reactiveData.watchData(data);
			}

			data.forEach(function (def, i) {

				if (def && (typeof def === 'undefined' ? 'undefined' : _typeof(def)) === "object") {

					var row = new Row(def, self);

					self.rows.push(row);
				} else {

					console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:", def);
				}
			});

			self.table.options.dataLoaded.call(this.table, data);

			self.refreshActiveData(false, false, renderInPosition);
		} else {

			console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ", typeof data === 'undefined' ? 'undefined' : _typeof(data), "\nData:     ", data);
		}
	};

	RowManager.prototype._wipeElements = function () {

		this.rows.forEach(function (row) {

			row.wipe();
		});

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.wipe();
		}

		this.rows = [];
	};

	RowManager.prototype.deleteRow = function (row, blockRedraw) {

		var allIndex = this.rows.indexOf(row),
		    activeIndex = this.activeRows.indexOf(row);

		if (activeIndex > -1) {

			this.activeRows.splice(activeIndex, 1);
		}

		if (allIndex > -1) {

			this.rows.splice(allIndex, 1);
		}

		this.setActiveRows(this.activeRows);

		this.displayRowIterator(function (rows) {

			var displayIndex = rows.indexOf(row);

			if (displayIndex > -1) {

				rows.splice(displayIndex, 1);
			}
		});

		if (!blockRedraw) {

			this.reRenderInPosition();
		}

		this.regenerateRowNumbers();

		this.table.options.rowDeleted.call(this.table, row.getComponent());

		this.table.options.dataEdited.call(this.table, this.getData());

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.updateGroupRows(true);
		} else if (this.table.options.pagination && this.table.modExists("page")) {

			this.refreshActiveData(false, false, true);
		} else {

			if (this.table.options.pagination && this.table.modExists("page")) {

				this.refreshActiveData("page");
			}
		}
	};

	RowManager.prototype.addRow = function (data, pos, index, blockRedraw) {

		var row = this.addRowActual(data, pos, index, blockRedraw);

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.action("rowAdd", row, { data: data, pos: pos, index: index });
		}

		return row;
	};

	//add multiple rows

	RowManager.prototype.addRows = function (data, pos, index) {
		var _this11 = this;

		var self = this,
		    length = 0,
		    rows = [];

		return new Promise(function (resolve, reject) {

			pos = _this11.findAddRowPos(pos);

			if (!Array.isArray(data)) {

				data = [data];
			}

			length = data.length - 1;

			if (typeof index == "undefined" && pos || typeof index !== "undefined" && !pos) {

				data.reverse();
			}

			data.forEach(function (item, i) {

				var row = self.addRow(item, pos, index, true);

				rows.push(row);
			});

			if (_this11.table.options.groupBy && _this11.table.modExists("groupRows")) {

				_this11.table.modules.groupRows.updateGroupRows(true);
			} else if (_this11.table.options.pagination && _this11.table.modExists("page")) {

				_this11.refreshActiveData(false, false, true);
			} else {

				_this11.reRenderInPosition();
			}

			//recalc column calculations if present

			if (_this11.table.modExists("columnCalcs")) {

				_this11.table.modules.columnCalcs.recalc(_this11.table.rowManager.activeRows);
			}

			_this11.regenerateRowNumbers();

			resolve(rows);
		});
	};

	RowManager.prototype.findAddRowPos = function (pos) {

		if (typeof pos === "undefined") {

			pos = this.table.options.addRowPos;
		}

		if (pos === "pos") {

			pos = true;
		}

		if (pos === "bottom") {

			pos = false;
		}

		return pos;
	};

	RowManager.prototype.addRowActual = function (data, pos, index, blockRedraw) {

		var row = data instanceof Row ? data : new Row(data || {}, this),
		    top = this.findAddRowPos(pos),
		    allIndex = -1,
		    activeIndex,
		    dispRows;

		if (!index && this.table.options.pagination && this.table.options.paginationAddRow == "page") {

			dispRows = this.getDisplayRows();

			if (top) {

				if (dispRows.length) {

					index = dispRows[0];
				} else {

					if (this.activeRows.length) {

						index = this.activeRows[this.activeRows.length - 1];

						top = false;
					}
				}
			} else {

				if (dispRows.length) {

					index = dispRows[dispRows.length - 1];

					top = dispRows.length < this.table.modules.page.getPageSize() ? false : true;
				}
			}
		}

		if (typeof index !== "undefined") {

			index = this.findRow(index);
		}

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.assignRowToGroup(row);

			var groupRows = row.getGroup().rows;

			if (groupRows.length > 1) {

				if (!index || index && groupRows.indexOf(index) == -1) {

					if (top) {

						if (groupRows[0] !== row) {

							index = groupRows[0];

							this._moveRowInArray(row.getGroup().rows, row, index, !top);
						}
					} else {

						if (groupRows[groupRows.length - 1] !== row) {

							index = groupRows[groupRows.length - 1];

							this._moveRowInArray(row.getGroup().rows, row, index, !top);
						}
					}
				} else {

					this._moveRowInArray(row.getGroup().rows, row, index, !top);
				}
			}
		}

		if (index) {

			allIndex = this.rows.indexOf(index);
		}

		if (index && allIndex > -1) {

			activeIndex = this.activeRows.indexOf(index);

			this.displayRowIterator(function (rows) {

				var displayIndex = rows.indexOf(index);

				if (displayIndex > -1) {

					rows.splice(top ? displayIndex : displayIndex + 1, 0, row);
				}
			});

			if (activeIndex > -1) {

				this.activeRows.splice(top ? activeIndex : activeIndex + 1, 0, row);
			}

			this.rows.splice(top ? allIndex : allIndex + 1, 0, row);
		} else {

			if (top) {

				this.displayRowIterator(function (rows) {

					rows.unshift(row);
				});

				this.activeRows.unshift(row);

				this.rows.unshift(row);
			} else {

				this.displayRowIterator(function (rows) {

					rows.push(row);
				});

				this.activeRows.push(row);

				this.rows.push(row);
			}
		}

		this.setActiveRows(this.activeRows);

		this.table.options.rowAdded.call(this.table, row.getComponent());

		this.table.options.dataEdited.call(this.table, this.getData());

		if (!blockRedraw) {

			this.reRenderInPosition();
		}

		return row;
	};

	RowManager.prototype.moveRow = function (from, to, after) {

		if (this.table.options.history && this.table.modExists("history")) {

			this.table.modules.history.action("rowMove", from, { posFrom: this.getRowPosition(from), posTo: this.getRowPosition(to), to: to, after: after });
		}

		this.moveRowActual(from, to, after);

		this.regenerateRowNumbers();

		this.table.options.rowMoved.call(this.table, from.getComponent());
	};

	RowManager.prototype.moveRowActual = function (from, to, after) {

		var self = this;

		this._moveRowInArray(this.rows, from, to, after);

		this._moveRowInArray(this.activeRows, from, to, after);

		this.displayRowIterator(function (rows) {

			self._moveRowInArray(rows, from, to, after);
		});

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			var toGroup = to.getGroup();

			var fromGroup = from.getGroup();

			if (toGroup === fromGroup) {

				this._moveRowInArray(toGroup.rows, from, to, after);
			} else {

				if (fromGroup) {

					fromGroup.removeRow(from);
				}

				toGroup.insertRow(from, to, after);
			}
		}
	};

	RowManager.prototype._moveRowInArray = function (rows, from, to, after) {

		var fromIndex, toIndex, start, end;

		if (from !== to) {

			fromIndex = rows.indexOf(from);

			if (fromIndex > -1) {

				rows.splice(fromIndex, 1);

				toIndex = rows.indexOf(to);

				if (toIndex > -1) {

					if (after) {

						rows.splice(toIndex + 1, 0, from);
					} else {

						rows.splice(toIndex, 0, from);
					}
				} else {

					rows.splice(fromIndex, 0, from);
				}
			}

			//restyle rows

			if (rows === this.getDisplayRows()) {

				start = fromIndex < toIndex ? fromIndex : toIndex;

				end = toIndex > fromIndex ? toIndex : fromIndex + 1;

				for (var i = start; i <= end; i++) {

					if (rows[i]) {

						this.styleRow(rows[i], i);
					}
				}
			}
		}
	};

	RowManager.prototype.clearData = function () {

		this.setData([]);
	};

	RowManager.prototype.getRowIndex = function (row) {

		return this.findRowIndex(row, this.rows);
	};

	RowManager.prototype.getDisplayRowIndex = function (row) {

		var index = this.getDisplayRows().indexOf(row);

		return index > -1 ? index : false;
	};

	RowManager.prototype.nextDisplayRow = function (row, rowOnly) {

		var index = this.getDisplayRowIndex(row),
		    nextRow = false;

		if (index !== false && index < this.displayRowsCount - 1) {

			nextRow = this.getDisplayRows()[index + 1];
		}

		if (nextRow && (!(nextRow instanceof Row) || nextRow.type != "row")) {

			return this.nextDisplayRow(nextRow, rowOnly);
		}

		return nextRow;
	};

	RowManager.prototype.prevDisplayRow = function (row, rowOnly) {

		var index = this.getDisplayRowIndex(row),
		    prevRow = false;

		if (index) {

			prevRow = this.getDisplayRows()[index - 1];
		}

		if (prevRow && (!(prevRow instanceof Row) || prevRow.type != "row")) {

			return this.prevDisplayRow(prevRow, rowOnly);
		}

		return prevRow;
	};

	RowManager.prototype.findRowIndex = function (row, list) {

		var rowIndex;

		row = this.findRow(row);

		if (row) {

			rowIndex = list.indexOf(row);

			if (rowIndex > -1) {

				return rowIndex;
			}
		}

		return false;
	};

	RowManager.prototype.getData = function (active, transform) {

		var output = [],
		    rows = this.getRows(active);

		rows.forEach(function (row) {

			if (row.type == "row") {

				output.push(row.getData(transform || "data"));
			}
		});

		return output;
	};

	RowManager.prototype.getComponents = function (active) {

		var output = [],
		    rows = this.getRows(active);

		rows.forEach(function (row) {

			output.push(row.getComponent());
		});

		return output;
	};

	RowManager.prototype.getDataCount = function (active) {

		var rows = this.getRows(active);

		return rows.length;
	};

	RowManager.prototype._genRemoteRequest = function () {
		var _this12 = this;

		var table = this.table,
		    options = table.options,
		    params = {};

		if (table.modExists("page")) {

			//set sort data if defined

			if (options.ajaxSorting) {

				var sorters = this.table.modules.sort.getSort();

				sorters.forEach(function (item) {

					delete item.column;
				});

				params[this.table.modules.page.paginationDataSentNames.sorters] = sorters;
			}

			//set filter data if defined

			if (options.ajaxFiltering) {

				var filters = this.table.modules.filter.getFilters(true, true);

				params[this.table.modules.page.paginationDataSentNames.filters] = filters;
			}

			this.table.modules.ajax.setParams(params, true);
		}

		table.modules.ajax.sendRequest().then(function (data) {

			_this12._setDataActual(data, true);
		}).catch(function (e) {});
	};

	//choose the path to refresh data after a filter update

	RowManager.prototype.filterRefresh = function () {

		var table = this.table,
		    options = table.options,
		    left = this.scrollLeft;

		if (options.ajaxFiltering) {

			if (options.pagination == "remote" && table.modExists("page")) {

				table.modules.page.reset(true);

				table.modules.page.setPage(1).then(function () {}).catch(function () {});
			} else if (options.ajaxProgressiveLoad) {

				table.modules.ajax.loadData().then(function () {}).catch(function () {});
			} else {

				//assume data is url, make ajax call to url to get data

				this._genRemoteRequest();
			}
		} else {

			this.refreshActiveData("filter");
		}

		this.scrollHorizontal(left);
	};

	//choose the path to refresh data after a sorter update

	RowManager.prototype.sorterRefresh = function (loadOrignalData) {

		var table = this.table,
		    options = this.table.options,
		    left = this.scrollLeft;

		if (options.ajaxSorting) {

			if ((options.pagination == "remote" || options.progressiveLoad) && table.modExists("page")) {

				table.modules.page.reset(true);

				table.modules.page.setPage(1).then(function () {}).catch(function () {});
			} else if (options.ajaxProgressiveLoad) {

				table.modules.ajax.loadData().then(function () {}).catch(function () {});
			} else {

				//assume data is url, make ajax call to url to get data

				this._genRemoteRequest();
			}
		} else {

			this.refreshActiveData(loadOrignalData ? "filter" : "sort");
		}

		this.scrollHorizontal(left);
	};

	RowManager.prototype.scrollHorizontal = function (left) {

		this.scrollLeft = left;

		this.element.scrollLeft = left;

		if (this.table.options.groupBy) {

			this.table.modules.groupRows.scrollHeaders(left);
		}

		if (this.table.modExists("columnCalcs")) {

			this.table.modules.columnCalcs.scrollHorizontal(left);
		}
	};

	//set active data set

	RowManager.prototype.refreshActiveData = function (stage, skipStage, renderInPosition) {

		var self = this,
		    table = this.table,
		    cascadeOrder = ["all", "filter", "sort", "display", "freeze", "group", "tree", "page"],
		    displayIndex;

		if (this.redrawBlock) {

			if (!this.redrawBlockRestoreConfig || cascadeOrder.indexOf(stage) < cascadeOrder.indexOf(this.redrawBlockRestoreConfig.stage)) {

				this.redrawBlockRestoreConfig = {

					stage: stage,

					skipStage: skipStage,

					renderInPosition: renderInPosition

				};
			}

			return;
		} else {

			if (self.table.modExists("edit")) {

				self.table.modules.edit.cancelEdit();
			}

			if (!stage) {

				stage = "all";
			}

			if (table.options.selectable && !table.options.selectablePersistence && table.modExists("selectRow")) {

				table.modules.selectRow.deselectRows();
			}

			//cascade through data refresh stages

			switch (stage) {

				case "all":

				case "filter":

					if (!skipStage) {

						if (table.modExists("filter")) {

							self.setActiveRows(table.modules.filter.filter(self.rows));
						} else {

							self.setActiveRows(self.rows.slice(0));
						}
					} else {

						skipStage = false;
					}

				case "sort":

					if (!skipStage) {

						if (table.modExists("sort")) {

							table.modules.sort.sort(this.activeRows);
						}
					} else {

						skipStage = false;
					}

					//regenerate row numbers for row number formatter if in use

					this.regenerateRowNumbers();

				//generic stage to allow for pipeline trigger after the data manipulation stage

				case "display":

					this.resetDisplayRows();

				case "freeze":

					if (!skipStage) {

						if (this.table.modExists("frozenRows")) {

							if (table.modules.frozenRows.isFrozen()) {

								if (!table.modules.frozenRows.getDisplayIndex()) {

									table.modules.frozenRows.setDisplayIndex(this.getNextDisplayIndex());
								}

								displayIndex = table.modules.frozenRows.getDisplayIndex();

								displayIndex = self.setDisplayRows(table.modules.frozenRows.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

								if (displayIndex !== true) {

									table.modules.frozenRows.setDisplayIndex(displayIndex);
								}
							}
						}
					} else {

						skipStage = false;
					}

				case "group":

					if (!skipStage) {

						if (table.options.groupBy && table.modExists("groupRows")) {

							if (!table.modules.groupRows.getDisplayIndex()) {

								table.modules.groupRows.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.groupRows.getDisplayIndex();

							displayIndex = self.setDisplayRows(table.modules.groupRows.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.groupRows.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

				case "tree":

					if (!skipStage) {

						if (table.options.dataTree && table.modExists("dataTree")) {

							if (!table.modules.dataTree.getDisplayIndex()) {

								table.modules.dataTree.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.dataTree.getDisplayIndex();

							displayIndex = self.setDisplayRows(table.modules.dataTree.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.dataTree.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

					if (table.options.pagination && table.modExists("page") && !renderInPosition) {

						if (table.modules.page.getMode() == "local") {

							table.modules.page.reset();
						}
					}

				case "page":

					if (!skipStage) {

						if (table.options.pagination && table.modExists("page")) {

							if (!table.modules.page.getDisplayIndex()) {

								table.modules.page.setDisplayIndex(this.getNextDisplayIndex());
							}

							displayIndex = table.modules.page.getDisplayIndex();

							if (table.modules.page.getMode() == "local") {

								table.modules.page.setMaxRows(this.getDisplayRows(displayIndex - 1).length);
							}

							displayIndex = self.setDisplayRows(table.modules.page.getRows(this.getDisplayRows(displayIndex - 1)), displayIndex);

							if (displayIndex !== true) {

								table.modules.page.setDisplayIndex(displayIndex);
							}
						}
					} else {

						skipStage = false;
					}

			}

			if (Tabulator.prototype.helpers.elVisible(self.element)) {

				if (renderInPosition) {

					self.reRenderInPosition();
				} else {

					self.renderTable();

					if (table.options.layoutColumnsOnNewData) {

						self.table.columnManager.redraw(true);
					}
				}
			}

			if (table.modExists("columnCalcs")) {

				table.modules.columnCalcs.recalc(this.activeRows);
			}
		}
	};

	//regenerate row numbers for row number formatter if in use

	RowManager.prototype.regenerateRowNumbers = function () {
		var _this13 = this;

		if (this.rowNumColumn) {

			this.activeRows.forEach(function (row) {

				var cell = row.getCell(_this13.rowNumColumn);

				if (cell) {

					cell._generateContents();
				}
			});
		}
	};

	RowManager.prototype.setActiveRows = function (activeRows) {

		this.activeRows = activeRows;

		this.activeRowsCount = this.activeRows.length;
	};

	//reset display rows array

	RowManager.prototype.resetDisplayRows = function () {

		this.displayRows = [];

		this.displayRows.push(this.activeRows.slice(0));

		this.displayRowsCount = this.displayRows[0].length;

		if (this.table.modExists("frozenRows")) {

			this.table.modules.frozenRows.setDisplayIndex(0);
		}

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {

			this.table.modules.groupRows.setDisplayIndex(0);
		}

		if (this.table.options.pagination && this.table.modExists("page")) {

			this.table.modules.page.setDisplayIndex(0);
		}
	};

	RowManager.prototype.getNextDisplayIndex = function () {

		return this.displayRows.length;
	};

	//set display row pipeline data

	RowManager.prototype.setDisplayRows = function (displayRows, index) {

		var output = true;

		if (index && typeof this.displayRows[index] != "undefined") {

			this.displayRows[index] = displayRows;

			output = true;
		} else {

			this.displayRows.push(displayRows);

			output = index = this.displayRows.length - 1;
		}

		if (index == this.displayRows.length - 1) {

			this.displayRowsCount = this.displayRows[this.displayRows.length - 1].length;
		}

		return output;
	};

	RowManager.prototype.getDisplayRows = function (index) {

		if (typeof index == "undefined") {

			return this.displayRows.length ? this.displayRows[this.displayRows.length - 1] : [];
		} else {

			return this.displayRows[index] || [];
		}
	};

	RowManager.prototype.getVisibleRows = function (viewable) {

		var topEdge = this.element.scrollTop,
		    bottomEdge = this.element.clientHeight + topEdge,
		    topFound = false,
		    topRow = 0,
		    bottomRow = 0,
		    rows = this.getDisplayRows();

		if (viewable) {

			this.getDisplayRows();

			for (var i = this.vDomTop; i <= this.vDomBottom; i++) {

				if (rows[i]) {

					if (!topFound) {

						if (topEdge - rows[i].getElement().offsetTop >= 0) {

							topRow = i;
						} else {

							topFound = true;

							if (bottomEdge - rows[i].getElement().offsetTop >= 0) {

								bottomRow = i;
							} else {

								break;
							}
						}
					} else {

						if (bottomEdge - rows[i].getElement().offsetTop >= 0) {

							bottomRow = i;
						} else {

							break;
						}
					}
				}
			}
		} else {

			topRow = this.vDomTop;

			bottomRow = this.vDomBottom;
		}

		return rows.slice(topRow, bottomRow + 1);
	};

	//repeat action accross display rows

	RowManager.prototype.displayRowIterator = function (callback) {

		this.displayRows.forEach(callback);

		this.displayRowsCount = this.displayRows[this.displayRows.length - 1].length;
	};

	//return only actual rows (not group headers etc)

	RowManager.prototype.getRows = function (active) {

		var rows;

		switch (active) {

			case "active":

				rows = this.activeRows;

				break;

			case "display":

				rows = this.table.rowManager.getDisplayRows();

				break;

			case "visible":

				rows = this.getVisibleRows(true);

				break;

			default:

				rows = this.rows;

		}

		return rows;
	};

	///////////////// Table Rendering /////////////////


	//trigger rerender of table in current position

	RowManager.prototype.reRenderInPosition = function (callback) {

		if (this.getRenderMode() == "virtual") {

			if (this.redrawBlock) {

				if (callback) {

					callback();
				} else {

					this.redrawBlockRederInPosition = true;
				}
			} else {

				var scrollTop = this.element.scrollTop;

				var topRow = false;

				var topOffset = false;

				var left = this.scrollLeft;

				var rows = this.getDisplayRows();

				for (var i = this.vDomTop; i <= this.vDomBottom; i++) {

					if (rows[i]) {

						var diff = scrollTop - rows[i].getElement().offsetTop;

						if (topOffset === false || Math.abs(diff) < topOffset) {

							topOffset = diff;

							topRow = i;
						} else {

							break;
						}
					}
				}

				if (callback) {

					callback();
				}

				this._virtualRenderFill(topRow === false ? this.displayRowsCount - 1 : topRow, true, topOffset || 0);

				this.scrollHorizontal(left);
			}
		} else {

			this.renderTable();

			if (callback) {

				callback();
			}
		}
	};

	RowManager.prototype.setRenderMode = function () {

		if (this.table.options.virtualDom) {

			this.renderMode = "virtual";

			if (this.table.element.clientHeight || this.table.options.height) {

				this.fixedHeight = true;
			} else {

				this.fixedHeight = false;
			}
		} else {

			this.renderMode = "classic";
		}
	};

	RowManager.prototype.getRenderMode = function () {

		return this.renderMode;
	};

	RowManager.prototype.renderTable = function () {

		this.table.options.renderStarted.call(this.table);

		this.element.scrollTop = 0;

		switch (this.renderMode) {

			case "classic":

				this._simpleRender();

				break;

			case "virtual":

				this._virtualRenderFill();

				break;

		}

		if (this.firstRender) {

			if (this.displayRowsCount) {

				this.firstRender = false;

				this.table.modules.layout.layout();
			} else {

				this.renderEmptyScroll();
			}
		}

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layout();
		}

		if (!this.displayRowsCount) {

			if (this.table.options.placeholder) {

				this.table.options.placeholder.setAttribute("tabulator-render-mode", this.renderMode);

				this.getElement().appendChild(this.table.options.placeholder);

				this.table.options.placeholder.style.width = this.table.columnManager.getWidth() + "px";
			}
		}

		this.table.options.renderComplete.call(this.table);
	};

	//simple render on heightless table

	RowManager.prototype._simpleRender = function () {

		this._clearVirtualDom();

		if (this.displayRowsCount) {

			this.checkClassicModeGroupHeaderWidth();
		} else {

			this.renderEmptyScroll();
		}
	};

	RowManager.prototype.checkClassicModeGroupHeaderWidth = function () {

		var self = this,
		    element = this.tableElement,
		    onlyGroupHeaders = true;

		self.getDisplayRows().forEach(function (row, index) {

			self.styleRow(row, index);

			element.appendChild(row.getElement());

			row.initialize(true);

			if (row.type !== "group") {

				onlyGroupHeaders = false;
			}
		});

		if (onlyGroupHeaders) {

			element.style.minWidth = self.table.columnManager.getWidth() + "px";
		} else {

			element.style.minWidth = "";
		}
	};

	//show scrollbars on empty table div

	RowManager.prototype.renderEmptyScroll = function () {

		if (this.table.options.placeholder) {

			this.tableElement.style.display = "none";
		} else {

			this.tableElement.style.minWidth = this.table.columnManager.getWidth() + "px";

			this.tableElement.style.minHeight = "1px";

			this.tableElement.style.visibility = "hidden";
		}
	};

	RowManager.prototype._clearVirtualDom = function () {

		var element = this.tableElement;

		if (this.table.options.placeholder && this.table.options.placeholder.parentNode) {

			this.table.options.placeholder.parentNode.removeChild(this.table.options.placeholder);
		}

		// element.children.detach();

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		}element.style.paddingTop = "";

		element.style.paddingBottom = "";

		element.style.minWidth = "";

		element.style.minHeight = "";

		element.style.display = "";

		element.style.visibility = "";

		this.scrollTop = 0;

		this.scrollLeft = 0;

		this.vDomTop = 0;

		this.vDomBottom = 0;

		this.vDomTopPad = 0;

		this.vDomBottomPad = 0;
	};

	RowManager.prototype.styleRow = function (row, index) {

		var rowEl = row.getElement();

		if (index % 2) {

			rowEl.classList.add("tabulator-row-even");

			rowEl.classList.remove("tabulator-row-odd");
		} else {

			rowEl.classList.add("tabulator-row-odd");

			rowEl.classList.remove("tabulator-row-even");
		}
	};

	//full virtual render

	RowManager.prototype._virtualRenderFill = function (position, forceMove, offset) {

		var self = this,
		    element = self.tableElement,
		    holder = self.element,
		    topPad = 0,
		    rowsHeight = 0,
		    topPadHeight = 0,
		    i = 0,
		    onlyGroupHeaders = true,
		    rows = self.getDisplayRows();

		position = position || 0;

		offset = offset || 0;

		if (!position) {

			self._clearVirtualDom();
		} else {

			while (element.firstChild) {
				element.removeChild(element.firstChild);
			} //check if position is too close to bottom of table

			var heightOccupied = (self.displayRowsCount - position + 1) * self.vDomRowHeight;

			if (heightOccupied < self.height) {

				position -= Math.ceil((self.height - heightOccupied) / self.vDomRowHeight);

				if (position < 0) {

					position = 0;
				}
			}

			//calculate initial pad

			topPad = Math.min(Math.max(Math.floor(self.vDomWindowBuffer / self.vDomRowHeight), self.vDomWindowMinMarginRows), position);

			position -= topPad;
		}

		if (self.displayRowsCount && Tabulator.prototype.helpers.elVisible(self.element)) {

			self.vDomTop = position;

			self.vDomBottom = position - 1;

			while ((rowsHeight <= self.height + self.vDomWindowBuffer || i < self.vDomWindowMinTotalRows) && self.vDomBottom < self.displayRowsCount - 1) {

				var index = self.vDomBottom + 1,
				    row = rows[index],
				    rowHeight = 0;

				self.styleRow(row, index);

				element.appendChild(row.getElement());

				if (!row.initialized) {

					row.initialize(true);
				} else {

					if (!row.heightInitialized) {

						row.normalizeHeight(true);
					}
				}

				rowHeight = row.getHeight();

				if (i < topPad) {

					topPadHeight += rowHeight;
				} else {

					rowsHeight += rowHeight;
				}

				if (rowHeight > this.vDomWindowBuffer) {

					this.vDomWindowBuffer = rowHeight * 2;
				}

				if (row.type !== "group") {

					onlyGroupHeaders = false;
				}

				self.vDomBottom++;

				i++;
			}

			if (!position) {

				this.vDomTopPad = 0;

				//adjust rowheight to match average of rendered elements

				self.vDomRowHeight = Math.floor((rowsHeight + topPadHeight) / i);

				self.vDomBottomPad = self.vDomRowHeight * (self.displayRowsCount - self.vDomBottom - 1);

				self.vDomScrollHeight = topPadHeight + rowsHeight + self.vDomBottomPad - self.height;
			} else {

				self.vDomTopPad = !forceMove ? self.scrollTop - topPadHeight : self.vDomRowHeight * this.vDomTop + offset;

				self.vDomBottomPad = self.vDomBottom == self.displayRowsCount - 1 ? 0 : Math.max(self.vDomScrollHeight - self.vDomTopPad - rowsHeight - topPadHeight, 0);
			}

			element.style.paddingTop = self.vDomTopPad + "px";

			element.style.paddingBottom = self.vDomBottomPad + "px";

			if (forceMove) {

				this.scrollTop = self.vDomTopPad + topPadHeight + offset - (this.element.scrollWidth > this.element.clientWidth ? this.element.offsetHeight - this.element.clientHeight : 0);
			}

			this.scrollTop = Math.min(this.scrollTop, this.element.scrollHeight - this.height);

			//adjust for horizontal scrollbar if present (and not at top of table)

			if (this.element.scrollWidth > this.element.offsetWidth && forceMove) {

				this.scrollTop += this.element.offsetHeight - this.element.clientHeight;
			}

			this.vDomScrollPosTop = this.scrollTop;

			this.vDomScrollPosBottom = this.scrollTop;

			holder.scrollTop = this.scrollTop;

			element.style.minWidth = onlyGroupHeaders ? self.table.columnManager.getWidth() + "px" : "";

			if (self.table.options.groupBy) {

				if (self.table.modules.layout.getMode() != "fitDataFill" && self.displayRowsCount == self.table.modules.groupRows.countGroups()) {

					self.tableElement.style.minWidth = self.table.columnManager.getWidth();
				}
			}
		} else {

			this.renderEmptyScroll();
		}

		if (!this.fixedHeight) {

			this.adjustTableSize();
		}
	};

	//handle vertical scrolling

	RowManager.prototype.scrollVertical = function (dir) {

		var topDiff = this.scrollTop - this.vDomScrollPosTop;

		var bottomDiff = this.scrollTop - this.vDomScrollPosBottom;

		var margin = this.vDomWindowBuffer * 2;

		if (-topDiff > margin || bottomDiff > margin) {

			//if big scroll redraw table;

			var left = this.scrollLeft;

			this._virtualRenderFill(Math.floor(this.element.scrollTop / this.element.scrollHeight * this.displayRowsCount));

			this.scrollHorizontal(left);
		} else {

			if (dir) {

				//scrolling up

				if (topDiff < 0) {

					this._addTopRow(-topDiff);
				}

				if (bottomDiff < 0) {

					//hide bottom row if needed

					if (this.vDomScrollHeight - this.scrollTop > this.vDomWindowBuffer) {

						this._removeBottomRow(-bottomDiff);
					}
				}
			} else {

				//scrolling down

				if (topDiff >= 0) {

					//hide top row if needed

					if (this.scrollTop > this.vDomWindowBuffer) {

						this._removeTopRow(topDiff);
					}
				}

				if (bottomDiff >= 0) {

					this._addBottomRow(bottomDiff);
				}
			}
		}
	};

	RowManager.prototype._addTopRow = function (topDiff) {
		var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;


		var table = this.tableElement,
		    rows = this.getDisplayRows();

		if (this.vDomTop) {

			var index = this.vDomTop - 1,
			    topRow = rows[index],
			    topRowHeight = topRow.getHeight() || this.vDomRowHeight;

			//hide top row if needed

			if (topDiff >= topRowHeight) {

				this.styleRow(topRow, index);

				table.insertBefore(topRow.getElement(), table.firstChild);

				if (!topRow.initialized || !topRow.heightInitialized) {

					this.vDomTopNewRows.push(topRow);

					if (!topRow.heightInitialized) {

						topRow.clearCellHeight();
					}
				}

				topRow.initialize();

				this.vDomTopPad -= topRowHeight;

				if (this.vDomTopPad < 0) {

					this.vDomTopPad = index * this.vDomRowHeight;
				}

				if (!index) {

					this.vDomTopPad = 0;
				}

				table.style.paddingTop = this.vDomTopPad + "px";

				this.vDomScrollPosTop -= topRowHeight;

				this.vDomTop--;
			}

			topDiff = -(this.scrollTop - this.vDomScrollPosTop);

			if (topRow.getHeight() > this.vDomWindowBuffer) {

				this.vDomWindowBuffer = topRow.getHeight() * 2;
			}

			if (i < this.vDomMaxRenderChain && this.vDomTop && topDiff >= (rows[this.vDomTop - 1].getHeight() || this.vDomRowHeight)) {

				this._addTopRow(topDiff, i + 1);
			} else {

				this._quickNormalizeRowHeight(this.vDomTopNewRows);
			}
		}
	};

	RowManager.prototype._removeTopRow = function (topDiff) {

		var table = this.tableElement,
		    topRow = this.getDisplayRows()[this.vDomTop],
		    topRowHeight = topRow.getHeight() || this.vDomRowHeight;

		if (topDiff >= topRowHeight) {

			var rowEl = topRow.getElement();

			rowEl.parentNode.removeChild(rowEl);

			this.vDomTopPad += topRowHeight;

			table.style.paddingTop = this.vDomTopPad + "px";

			this.vDomScrollPosTop += this.vDomTop ? topRowHeight : topRowHeight + this.vDomWindowBuffer;

			this.vDomTop++;

			topDiff = this.scrollTop - this.vDomScrollPosTop;

			this._removeTopRow(topDiff);
		}
	};

	RowManager.prototype._addBottomRow = function (bottomDiff) {
		var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;


		var table = this.tableElement,
		    rows = this.getDisplayRows();

		if (this.vDomBottom < this.displayRowsCount - 1) {

			var index = this.vDomBottom + 1,
			    bottomRow = rows[index],
			    bottomRowHeight = bottomRow.getHeight() || this.vDomRowHeight;

			//hide bottom row if needed

			if (bottomDiff >= bottomRowHeight) {

				this.styleRow(bottomRow, index);

				table.appendChild(bottomRow.getElement());

				if (!bottomRow.initialized || !bottomRow.heightInitialized) {

					this.vDomBottomNewRows.push(bottomRow);

					if (!bottomRow.heightInitialized) {

						bottomRow.clearCellHeight();
					}
				}

				bottomRow.initialize();

				this.vDomBottomPad -= bottomRowHeight;

				if (this.vDomBottomPad < 0 || index == this.displayRowsCount - 1) {

					this.vDomBottomPad = 0;
				}

				table.style.paddingBottom = this.vDomBottomPad + "px";

				this.vDomScrollPosBottom += bottomRowHeight;

				this.vDomBottom++;
			}

			bottomDiff = this.scrollTop - this.vDomScrollPosBottom;

			if (bottomRow.getHeight() > this.vDomWindowBuffer) {

				this.vDomWindowBuffer = bottomRow.getHeight() * 2;
			}

			if (i < this.vDomMaxRenderChain && this.vDomBottom < this.displayRowsCount - 1 && bottomDiff >= (rows[this.vDomBottom + 1].getHeight() || this.vDomRowHeight)) {

				this._addBottomRow(bottomDiff, i + 1);
			} else {

				this._quickNormalizeRowHeight(this.vDomBottomNewRows);
			}
		}
	};

	RowManager.prototype._removeBottomRow = function (bottomDiff) {

		var table = this.tableElement,
		    bottomRow = this.getDisplayRows()[this.vDomBottom],
		    bottomRowHeight = bottomRow.getHeight() || this.vDomRowHeight;

		if (bottomDiff >= bottomRowHeight) {

			var rowEl = bottomRow.getElement();

			if (rowEl.parentNode) {

				rowEl.parentNode.removeChild(rowEl);
			}

			this.vDomBottomPad += bottomRowHeight;

			if (this.vDomBottomPad < 0) {

				this.vDomBottomPad = 0;
			}

			table.style.paddingBottom = this.vDomBottomPad + "px";

			this.vDomScrollPosBottom -= bottomRowHeight;

			this.vDomBottom--;

			bottomDiff = -(this.scrollTop - this.vDomScrollPosBottom);

			this._removeBottomRow(bottomDiff);
		}
	};

	RowManager.prototype._quickNormalizeRowHeight = function (rows) {

		rows.forEach(function (row) {

			row.calcHeight();
		});

		rows.forEach(function (row) {

			row.setCellHeight();
		});

		rows.length = 0;
	};

	//normalize height of active rows

	RowManager.prototype.normalizeHeight = function () {

		this.activeRows.forEach(function (row) {

			row.normalizeHeight();
		});
	};

	//adjust the height of the table holder to fit in the Tabulator element

	RowManager.prototype.adjustTableSize = function () {

		var initialHeight = this.element.clientHeight,
		    modExists;

		if (this.renderMode === "virtual") {

			var otherHeight = this.columnManager.getElement().offsetHeight + (this.table.footerManager && !this.table.footerManager.external ? this.table.footerManager.getElement().offsetHeight : 0);

			if (this.fixedHeight) {

				this.element.style.minHeight = "calc(100% - " + otherHeight + "px)";

				this.element.style.height = "calc(100% - " + otherHeight + "px)";

				this.element.style.maxHeight = "calc(100% - " + otherHeight + "px)";
			} else {

				this.element.style.height = "";

				this.element.style.height = this.table.element.clientHeight - otherHeight + "px";

				this.element.scrollTop = this.scrollTop;
			}

			this.height = this.element.clientHeight;

			this.vDomWindowBuffer = this.table.options.virtualDomBuffer || this.height;

			//check if the table has changed size when dealing with variable height tables

			if (!this.fixedHeight && initialHeight != this.element.clientHeight) {

				modExists = this.table.modExists("resizeTable");

				if (modExists && !this.table.modules.resizeTable.autoResize || !modExists) {

					this.redraw();
				}
			}
		}
	};

	//renitialize all rows

	RowManager.prototype.reinitialize = function () {

		this.rows.forEach(function (row) {

			row.reinitialize();
		});
	};

	//prevent table from being redrawn

	RowManager.prototype.blockRedraw = function () {

		this.redrawBlock = true;

		this.redrawBlockRestoreConfig = false;
	};

	//restore table redrawing

	RowManager.prototype.restoreRedraw = function () {

		this.redrawBlock = false;

		if (this.redrawBlockRestoreConfig) {

			this.refreshActiveData(this.redrawBlockRestoreConfig.stage, this.redrawBlockRestoreConfig.skipStage, this.redrawBlockRestoreConfig.renderInPosition);

			this.redrawBlockRestoreConfig = false;
		} else {

			if (this.redrawBlockRederInPosition) {

				this.reRenderInPosition();
			}
		}

		this.redrawBlockRederInPosition = false;
	};

	//redraw table

	RowManager.prototype.redraw = function (force) {

		var pos = 0,
		    left = this.scrollLeft;

		this.adjustTableSize();

		this.table.tableWidth = this.table.element.clientWidth;

		if (!force) {

			if (this.renderMode == "classic") {

				if (this.table.options.groupBy) {

					this.refreshActiveData("group", false, false);
				} else {

					this._simpleRender();
				}
			} else {

				this.reRenderInPosition();

				this.scrollHorizontal(left);
			}

			if (!this.displayRowsCount) {

				if (this.table.options.placeholder) {

					this.getElement().appendChild(this.table.options.placeholder);
				}
			}
		} else {

			this.renderTable();
		}
	};

	RowManager.prototype.resetScroll = function () {

		this.element.scrollLeft = 0;

		this.element.scrollTop = 0;

		if (this.table.browser === "ie") {

			var event = document.createEvent("Event");

			event.initEvent("scroll", false, true);

			this.element.dispatchEvent(event);
		} else {

			this.element.dispatchEvent(new Event('scroll'));
		}
	};

	//public row object

	var RowComponent = function RowComponent(row) {

		this._row = row;
	};

	RowComponent.prototype.getData = function (transform) {

		return this._row.getData(transform);
	};

	RowComponent.prototype.getElement = function () {

		return this._row.getElement();
	};

	RowComponent.prototype.getCells = function () {

		var cells = [];

		this._row.getCells().forEach(function (cell) {

			cells.push(cell.getComponent());
		});

		return cells;
	};

	RowComponent.prototype.getCell = function (column) {

		var cell = this._row.getCell(column);

		return cell ? cell.getComponent() : false;
	};

	RowComponent.prototype.getIndex = function () {

		return this._row.getData("data")[this._row.table.options.index];
	};

	RowComponent.prototype.getPosition = function (active) {

		return this._row.table.rowManager.getRowPosition(this._row, active);
	};

	RowComponent.prototype.delete = function () {

		return this._row.delete();
	};

	RowComponent.prototype.scrollTo = function () {

		return this._row.table.rowManager.scrollToRow(this._row);
	};

	RowComponent.prototype.pageTo = function () {

		if (this._row.table.modExists("page", true)) {

			return this._row.table.modules.page.setPageToRow(this._row);
		}
	};

	RowComponent.prototype.move = function (to, after) {

		this._row.moveToRow(to, after);
	};

	RowComponent.prototype.update = function (data) {

		return this._row.updateData(data);
	};

	RowComponent.prototype.normalizeHeight = function () {

		this._row.normalizeHeight(true);
	};

	RowComponent.prototype.select = function () {

		this._row.table.modules.selectRow.selectRows(this._row);
	};

	RowComponent.prototype.deselect = function () {

		this._row.table.modules.selectRow.deselectRows(this._row);
	};

	RowComponent.prototype.toggleSelect = function () {

		this._row.table.modules.selectRow.toggleRow(this._row);
	};

	RowComponent.prototype.isSelected = function () {

		return this._row.table.modules.selectRow.isRowSelected(this._row);
	};

	RowComponent.prototype._getSelf = function () {

		return this._row;
	};

	RowComponent.prototype.freeze = function () {

		if (this._row.table.modExists("frozenRows", true)) {

			this._row.table.modules.frozenRows.freezeRow(this._row);
		}
	};

	RowComponent.prototype.unfreeze = function () {

		if (this._row.table.modExists("frozenRows", true)) {

			this._row.table.modules.frozenRows.unfreezeRow(this._row);
		}
	};

	RowComponent.prototype.treeCollapse = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.collapseRow(this._row);
		}
	};

	RowComponent.prototype.treeExpand = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.expandRow(this._row);
		}
	};

	RowComponent.prototype.treeToggle = function () {

		if (this._row.table.modExists("dataTree", true)) {

			this._row.table.modules.dataTree.toggleRow(this._row);
		}
	};

	RowComponent.prototype.getTreeParent = function () {

		if (this._row.table.modExists("dataTree", true)) {

			return this._row.table.modules.dataTree.getTreeParent(this._row);
		}

		return false;
	};

	RowComponent.prototype.getTreeChildren = function () {

		if (this._row.table.modExists("dataTree", true)) {

			return this._row.table.modules.dataTree.getTreeChildren(this._row);
		}

		return false;
	};

	RowComponent.prototype.reformat = function () {

		return this._row.reinitialize();
	};

	RowComponent.prototype.getGroup = function () {

		return this._row.getGroup().getComponent();
	};

	RowComponent.prototype.getTable = function () {

		return this._row.table;
	};

	RowComponent.prototype.getNextRow = function () {

		var row = this._row.nextRow();

		return row ? row.getComponent() : row;
	};

	RowComponent.prototype.getPrevRow = function () {

		var row = this._row.prevRow();

		return row ? row.getComponent() : row;
	};

	var Row = function Row(data, parent) {
		var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "row";


		this.table = parent.table;

		this.parent = parent;

		this.data = {};

		this.type = type; //type of element

		this.element = this.createElement();

		this.modules = {}; //hold module variables;

		this.cells = [];

		this.height = 0; //hold element height

		this.heightStyled = ""; //hold element height prestyled to improve render efficiency

		this.manualHeight = false; //user has manually set row height

		this.outerHeight = 0; //holde lements outer height

		this.initialized = false; //element has been rendered

		this.heightInitialized = false; //element has resized cells to fit


		this.setData(data);

		this.generateElement();
	};

	Row.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-row");

		el.setAttribute("role", "row");

		return el;
	};

	Row.prototype.getElement = function () {

		return this.element;
	};

	Row.prototype.detachElement = function () {

		if (this.element && this.element.parentNode) {

			this.element.parentNode.removeChild(this.element);
		}
	};

	Row.prototype.generateElement = function () {

		var self = this,
		    dblTap,
		    tapHold,
		    tap;

		//set row selection characteristics

		if (self.table.options.selectable !== false && self.table.modExists("selectRow")) {

			self.table.modules.selectRow.initializeRow(this);
		}

		//setup movable rows

		if (self.table.options.movableRows !== false && self.table.modExists("moveRow")) {

			self.table.modules.moveRow.initializeRow(this);
		}

		//setup data tree

		if (self.table.options.dataTree !== false && self.table.modExists("dataTree")) {

			self.table.modules.dataTree.initializeRow(this);
		}

		//setup column colapse container

		if (self.table.options.responsiveLayout === "collapse" && self.table.modExists("responsiveLayout")) {

			self.table.modules.responsiveLayout.initializeRow(this);
		}

		//set column menu

		if (self.table.options.rowContextMenu && this.table.modExists("menu")) {

			self.table.modules.menu.initializeRow(this);
		}

		//handle row click events

		if (self.table.options.rowClick) {

			self.element.addEventListener("click", function (e) {

				self.table.options.rowClick(e, self.getComponent());
			});
		}

		if (self.table.options.rowDblClick) {

			self.element.addEventListener("dblclick", function (e) {

				self.table.options.rowDblClick(e, self.getComponent());
			});
		}

		if (self.table.options.rowContext) {

			self.element.addEventListener("contextmenu", function (e) {

				self.table.options.rowContext(e, self.getComponent());
			});
		}

		//handle mouse events

		if (self.table.options.rowMouseEnter) {

			self.element.addEventListener("mouseenter", function (e) {

				self.table.options.rowMouseEnter(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseLeave) {

			self.element.addEventListener("mouseleave", function (e) {

				self.table.options.rowMouseLeave(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseOver) {

			self.element.addEventListener("mouseover", function (e) {

				self.table.options.rowMouseOver(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseOut) {

			self.element.addEventListener("mouseout", function (e) {

				self.table.options.rowMouseOut(e, self.getComponent());
			});
		}

		if (self.table.options.rowMouseMove) {

			self.element.addEventListener("mousemove", function (e) {

				self.table.options.rowMouseMove(e, self.getComponent());
			});
		}

		if (self.table.options.rowTap) {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				if (tap) {

					self.table.options.rowTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (self.table.options.rowDblTap) {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					self.table.options.rowDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (self.table.options.rowTapHold) {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					self.table.options.rowTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}
	};

	Row.prototype.generateCells = function () {

		this.cells = this.table.columnManager.generateCells(this);
	};

	//functions to setup on first render

	Row.prototype.initialize = function (force) {

		var self = this;

		if (!self.initialized || force) {

			self.deleteCells();

			while (self.element.firstChild) {
				self.element.removeChild(self.element.firstChild);
			} //handle frozen cells

			if (this.table.modExists("frozenColumns")) {

				this.table.modules.frozenColumns.layoutRow(this);
			}

			this.generateCells();

			self.cells.forEach(function (cell) {

				self.element.appendChild(cell.getElement());

				cell.cellRendered();
			});

			if (force) {

				self.normalizeHeight();
			}

			//setup movable rows

			if (self.table.options.dataTree && self.table.modExists("dataTree")) {

				self.table.modules.dataTree.layoutRow(this);
			}

			//setup column colapse container

			if (self.table.options.responsiveLayout === "collapse" && self.table.modExists("responsiveLayout")) {

				self.table.modules.responsiveLayout.layoutRow(this);
			}

			if (self.table.options.rowFormatter) {

				self.table.options.rowFormatter(self.getComponent());
			}

			//set resizable handles

			if (self.table.options.resizableRows && self.table.modExists("resizeRows")) {

				self.table.modules.resizeRows.initializeRow(self);
			}

			self.initialized = true;
		}
	};

	Row.prototype.reinitializeHeight = function () {

		this.heightInitialized = false;

		if (this.element.offsetParent !== null) {

			this.normalizeHeight(true);
		}
	};

	Row.prototype.reinitialize = function () {

		this.initialized = false;

		this.heightInitialized = false;

		if (!this.manualHeight) {

			this.height = 0;

			this.heightStyled = "";
		}

		if (this.element.offsetParent !== null) {

			this.initialize(true);
		}
	};

	//get heights when doing bulk row style calcs in virtual DOM

	Row.prototype.calcHeight = function (force) {

		var maxHeight = 0,
		    minHeight = this.table.options.resizableRows ? this.element.clientHeight : 0;

		this.cells.forEach(function (cell) {

			var height = cell.getHeight();

			if (height > maxHeight) {

				maxHeight = height;
			}
		});

		if (force) {

			this.height = Math.max(maxHeight, minHeight);
		} else {

			this.height = this.manualHeight ? this.height : Math.max(maxHeight, minHeight);
		}

		this.heightStyled = this.height ? this.height + "px" : "";

		this.outerHeight = this.element.offsetHeight;
	};

	//set of cells

	Row.prototype.setCellHeight = function () {

		this.cells.forEach(function (cell) {

			cell.setHeight();
		});

		this.heightInitialized = true;
	};

	Row.prototype.clearCellHeight = function () {

		this.cells.forEach(function (cell) {

			cell.clearHeight();
		});
	};

	//normalize the height of elements in the row

	Row.prototype.normalizeHeight = function (force) {

		if (force) {

			this.clearCellHeight();
		}

		this.calcHeight(force);

		this.setCellHeight();
	};

	// Row.prototype.setHeight = function(height){

	// 	this.height = height;


	// 	this.setCellHeight();

	// };


	//set height of rows

	Row.prototype.setHeight = function (height, force) {

		if (this.height != height || force) {

			this.manualHeight = true;

			this.height = height;

			this.heightStyled = height ? height + "px" : "";

			this.setCellHeight();

			// this.outerHeight = this.element.outerHeight();

			this.outerHeight = this.element.offsetHeight;
		}
	};

	//return rows outer height

	Row.prototype.getHeight = function () {

		return this.outerHeight;
	};

	//return rows outer Width

	Row.prototype.getWidth = function () {

		return this.element.offsetWidth;
	};

	//////////////// Cell Management /////////////////


	Row.prototype.deleteCell = function (cell) {

		var index = this.cells.indexOf(cell);

		if (index > -1) {

			this.cells.splice(index, 1);
		}
	};

	//////////////// Data Management /////////////////


	Row.prototype.setData = function (data) {

		if (this.table.modExists("mutator")) {

			data = this.table.modules.mutator.transformRow(data, "data");
		}

		this.data = data;

		if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {

			this.table.modules.reactiveData.watchRow(this);
		}
	};

	//update the rows data

	Row.prototype.updateData = function (updatedData) {
		var _this14 = this;

		var visible = Tabulator.prototype.helpers.elVisible(this.element),
		    tempData = {},
		    newRowData;

		return new Promise(function (resolve, reject) {

			if (typeof updatedData === "string") {

				updatedData = JSON.parse(updatedData);
			}

			if (_this14.table.options.reactiveData && _this14.table.modExists("reactiveData", true)) {

				_this14.table.modules.reactiveData.block();
			}

			//mutate incomming data if needed

			if (_this14.table.modExists("mutator")) {

				tempData = Object.assign(tempData, _this14.data);

				tempData = Object.assign(tempData, updatedData);

				newRowData = _this14.table.modules.mutator.transformRow(tempData, "data", updatedData);
			} else {

				newRowData = updatedData;
			}

			//set data

			for (var attrname in newRowData) {

				_this14.data[attrname] = newRowData[attrname];
			}

			if (_this14.table.options.reactiveData && _this14.table.modExists("reactiveData", true)) {

				_this14.table.modules.reactiveData.unblock();
			}

			//update affected cells only

			for (var attrname in updatedData) {

				var columns = _this14.table.columnManager.getColumnsByFieldRoot(attrname);

				columns.forEach(function (column) {

					var cell = _this14.getCell(column.getField());

					if (cell) {

						var value = column.getFieldValue(newRowData);

						if (cell.getValue() != value) {

							cell.setValueProcessData(value);

							if (visible) {

								cell.cellRendered();
							}
						}
					}
				});
			}

			//Partial reinitialization if visible

			if (visible) {

				_this14.normalizeHeight();

				if (_this14.table.options.rowFormatter) {

					_this14.table.options.rowFormatter(_this14.getComponent());
				}
			} else {

				_this14.initialized = false;

				_this14.height = 0;

				_this14.heightStyled = "";
			}

			if (_this14.table.options.dataTree !== false && _this14.table.modExists("dataTree") && _this14.table.modules.dataTree.redrawNeeded(updatedData)) {

				_this14.table.modules.dataTree.initializeRow(_this14);

				_this14.table.modules.dataTree.layoutRow(_this14);

				_this14.table.rowManager.refreshActiveData("tree", false, true);
			}

			//this.reinitialize();


			_this14.table.options.rowUpdated.call(_this14.table, _this14.getComponent());

			resolve();
		});
	};

	Row.prototype.getData = function (transform) {

		var self = this;

		if (transform) {

			if (self.table.modExists("accessor")) {

				return self.table.modules.accessor.transformRow(self.data, transform);
			}
		} else {

			return this.data;
		}
	};

	Row.prototype.getCell = function (column) {

		var match = false;

		column = this.table.columnManager.findColumn(column);

		match = this.cells.find(function (cell) {

			return cell.column === column;
		});

		return match;
	};

	Row.prototype.getCellIndex = function (findCell) {

		return this.cells.findIndex(function (cell) {

			return cell === findCell;
		});
	};

	Row.prototype.findNextEditableCell = function (index) {

		var nextCell = false;

		if (index < this.cells.length - 1) {

			for (var i = index + 1; i < this.cells.length; i++) {

				var cell = this.cells[i];

				if (cell.column.modules.edit && Tabulator.prototype.helpers.elVisible(cell.getElement())) {

					var allowEdit = true;

					if (typeof cell.column.modules.edit.check == "function") {

						allowEdit = cell.column.modules.edit.check(cell.getComponent());
					}

					if (allowEdit) {

						nextCell = cell;

						break;
					}
				}
			}
		}

		return nextCell;
	};

	Row.prototype.findPrevEditableCell = function (index) {

		var prevCell = false;

		if (index > 0) {

			for (var i = index - 1; i >= 0; i--) {

				var cell = this.cells[i],
				    allowEdit = true;

				if (cell.column.modules.edit && Tabulator.prototype.helpers.elVisible(cell.getElement())) {

					if (typeof cell.column.modules.edit.check == "function") {

						allowEdit = cell.column.modules.edit.check(cell.getComponent());
					}

					if (allowEdit) {

						prevCell = cell;

						break;
					}
				}
			}
		}

		return prevCell;
	};

	Row.prototype.getCells = function () {

		return this.cells;
	};

	Row.prototype.nextRow = function () {

		var row = this.table.rowManager.nextDisplayRow(this, true);

		return row || false;
	};

	Row.prototype.prevRow = function () {

		var row = this.table.rowManager.prevDisplayRow(this, true);

		return row || false;
	};

	Row.prototype.moveToRow = function (to, before) {

		var toRow = this.table.rowManager.findRow(to);

		if (toRow) {

			this.table.rowManager.moveRowActual(this, toRow, !before);

			this.table.rowManager.refreshActiveData("display", false, true);
		} else {

			console.warn("Move Error - No matching row found:", to);
		}
	};

	///////////////////// Actions  /////////////////////


	Row.prototype.delete = function () {
		var _this15 = this;

		return new Promise(function (resolve, reject) {

			var index, rows;

			if (_this15.table.options.history && _this15.table.modExists("history")) {

				if (_this15.table.options.groupBy && _this15.table.modExists("groupRows")) {

					rows = _this15.getGroup().rows;

					index = rows.indexOf(_this15);

					if (index) {

						index = rows[index - 1];
					}
				} else {

					index = _this15.table.rowManager.getRowIndex(_this15);

					if (index) {

						index = _this15.table.rowManager.rows[index - 1];
					}
				}

				_this15.table.modules.history.action("rowDelete", _this15, { data: _this15.getData(), pos: !index, index: index });
			}

			_this15.deleteActual();

			resolve();
		});
	};

	Row.prototype.deleteActual = function (blockRedraw) {

		var index = this.table.rowManager.getRowIndex(this);

		//deselect row if it is selected

		if (this.table.modExists("selectRow")) {

			this.table.modules.selectRow._deselectRow(this, true);
		}

		// if(this.table.options.dataTree && this.table.modExists("dataTree")){

		// 	this.table.modules.dataTree.collapseRow(this, true);

		// }


		//remove any reactive data watchers from row object

		if (this.table.options.reactiveData && this.table.modExists("reactiveData", true)) {}

		// this.table.modules.reactiveData.unwatchRow(this);

		//remove from group

		if (this.modules.group) {

			this.modules.group.removeRow(this);
		}

		this.table.rowManager.deleteRow(this, blockRedraw);

		this.deleteCells();

		this.initialized = false;

		this.heightInitialized = false;

		//recalc column calculations if present

		if (this.table.modExists("columnCalcs")) {

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {

				this.table.modules.columnCalcs.recalcRowGroup(this);
			} else {

				this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
			}
		}
	};

	Row.prototype.deleteCells = function () {

		var cellCount = this.cells.length;

		for (var i = 0; i < cellCount; i++) {

			this.cells[0].delete();
		}
	};

	Row.prototype.wipe = function () {

		this.deleteCells();

		while (this.element.firstChild) {
			this.element.removeChild(this.element.firstChild);
		}this.element = false;

		this.modules = {};

		if (this.element.parentNode) {

			this.element.parentNode.removeChild(this.element);
		}
	};

	Row.prototype.getGroup = function () {

		return this.modules.group || false;
	};

	//////////////// Object Generation /////////////////

	Row.prototype.getComponent = function () {

		return new RowComponent(this);
	};

	//public row object

	var CellComponent = function CellComponent(cell) {

		this._cell = cell;
	};

	CellComponent.prototype.getValue = function () {

		return this._cell.getValue();
	};

	CellComponent.prototype.getOldValue = function () {

		return this._cell.getOldValue();
	};

	CellComponent.prototype.getElement = function () {

		return this._cell.getElement();
	};

	CellComponent.prototype.getRow = function () {

		return this._cell.row.getComponent();
	};

	CellComponent.prototype.getData = function () {

		return this._cell.row.getData();
	};

	CellComponent.prototype.getField = function () {

		return this._cell.column.getField();
	};

	CellComponent.prototype.getColumn = function () {

		return this._cell.column.getComponent();
	};

	CellComponent.prototype.setValue = function (value, mutate) {

		if (typeof mutate == "undefined") {

			mutate = true;
		}

		this._cell.setValue(value, mutate);
	};

	CellComponent.prototype.restoreOldValue = function () {

		this._cell.setValueActual(this._cell.getOldValue());
	};

	CellComponent.prototype.edit = function (force) {

		return this._cell.edit(force);
	};

	CellComponent.prototype.cancelEdit = function () {

		this._cell.cancelEdit();
	};

	CellComponent.prototype.nav = function () {

		return this._cell.nav();
	};

	CellComponent.prototype.checkHeight = function () {

		this._cell.checkHeight();
	};

	CellComponent.prototype.getTable = function () {

		return this._cell.table;
	};

	CellComponent.prototype._getSelf = function () {

		return this._cell;
	};

	var Cell = function Cell(column, row) {

		this.table = column.table;

		this.column = column;

		this.row = row;

		this.element = null;

		this.value = null;

		this.oldValue = null;

		this.modules = {};

		this.height = null;

		this.width = null;

		this.minWidth = null;

		this.build();
	};

	//////////////// Setup Functions /////////////////


	//generate element

	Cell.prototype.build = function () {

		this.generateElement();

		this.setWidth();

		this._configureCell();

		this.setValueActual(this.column.getFieldValue(this.row.data));
	};

	Cell.prototype.generateElement = function () {

		this.element = document.createElement('div');

		this.element.className = "tabulator-cell";

		this.element.setAttribute("role", "gridcell");

		this.element = this.element;
	};

	Cell.prototype._configureCell = function () {

		var self = this,
		    cellEvents = self.column.cellEvents,
		    element = self.element,
		    field = this.column.getField(),
		    vertAligns = {

			top: "flex-start",

			bottom: "flex-end",

			middle: "center"

		},
		    hozAligns = {

			left: "flex-start",

			right: "flex-end",

			center: "center"

		};

		//set text alignment

		element.style.textAlign = self.column.hozAlign;

		if (self.column.vertAlign) {

			element.style.display = "inline-flex";

			element.style.alignItems = vertAligns[self.column.vertAlign] || "";

			if (self.column.hozAlign) {

				element.style.justifyContent = hozAligns[self.column.hozAlign] || "";
			}
		}

		if (field) {

			element.setAttribute("tabulator-field", field);
		}

		//add class to cell if needed

		if (self.column.definition.cssClass) {

			var classNames = self.column.definition.cssClass.split(" ");

			classNames.forEach(function (className) {

				element.classList.add(className);
			});
		}

		//update tooltip on mouse enter

		if (this.table.options.tooltipGenerationMode === "hover") {

			element.addEventListener("mouseenter", function (e) {

				self._generateTooltip();
			});
		}

		self._bindClickEvents(cellEvents);

		self._bindTouchEvents(cellEvents);

		self._bindMouseEvents(cellEvents);

		if (self.column.modules.edit) {

			self.table.modules.edit.bindEditor(self);
		}

		if (self.column.definition.rowHandle && self.table.options.movableRows !== false && self.table.modExists("moveRow")) {

			self.table.modules.moveRow.initializeCell(self);
		}

		//hide cell if not visible

		if (!self.column.visible) {

			self.hide();
		}
	};

	Cell.prototype._bindClickEvents = function (cellEvents) {

		var self = this,
		    element = self.element;

		//set event bindings

		if (cellEvents.cellClick || self.table.options.cellClick) {

			element.addEventListener("click", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellClick) {

					cellEvents.cellClick.call(self.table, e, component);
				}

				if (self.table.options.cellClick) {

					self.table.options.cellClick.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellDblClick || this.table.options.cellDblClick) {

			element.addEventListener("dblclick", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellDblClick) {

					cellEvents.cellDblClick.call(self.table, e, component);
				}

				if (self.table.options.cellDblClick) {

					self.table.options.cellDblClick.call(self.table, e, component);
				}
			});
		} else {

			// element.addEventListener("dblclick", function(e){

			// e.preventDefault();

			// try{

			// 	if (document.selection) { // IE

			// 		var range = document.body.createTextRange();

			// 		range.moveToElementText(self.element);

			// 		range.select();

			// 	} else if (window.getSelection) {

			// 		var range = document.createRange();

			// 		range.selectNode(self.element);

			// 		window.getSelection().removeAllRanges();

			// 		window.getSelection().addRange(range);

			// 	}

			// }catch(e){}

			// });

		}

		if (cellEvents.cellContext || this.table.options.cellContext) {

			element.addEventListener("contextmenu", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellContext) {

					cellEvents.cellContext.call(self.table, e, component);
				}

				if (self.table.options.cellContext) {

					self.table.options.cellContext.call(self.table, e, component);
				}
			});
		}
	};

	Cell.prototype._bindMouseEvents = function (cellEvents) {

		var self = this,
		    element = self.element;

		if (cellEvents.cellMouseEnter || self.table.options.cellMouseEnter) {

			element.addEventListener("mouseenter", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseEnter) {

					cellEvents.cellMouseEnter.call(self.table, e, component);
				}

				if (self.table.options.cellMouseEnter) {

					self.table.options.cellMouseEnter.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseLeave || self.table.options.cellMouseLeave) {

			element.addEventListener("mouseleave", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseLeave) {

					cellEvents.cellMouseLeave.call(self.table, e, component);
				}

				if (self.table.options.cellMouseLeave) {

					self.table.options.cellMouseLeave.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseOver || self.table.options.cellMouseOver) {

			element.addEventListener("mouseover", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseOver) {

					cellEvents.cellMouseOver.call(self.table, e, component);
				}

				if (self.table.options.cellMouseOver) {

					self.table.options.cellMouseOver.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseOut || self.table.options.cellMouseOut) {

			element.addEventListener("mouseout", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseOut) {

					cellEvents.cellMouseOut.call(self.table, e, component);
				}

				if (self.table.options.cellMouseOut) {

					self.table.options.cellMouseOut.call(self.table, e, component);
				}
			});
		}

		if (cellEvents.cellMouseMove || self.table.options.cellMouseMove) {

			element.addEventListener("mousemove", function (e) {

				var component = self.getComponent();

				if (cellEvents.cellMouseMove) {

					cellEvents.cellMouseMove.call(self.table, e, component);
				}

				if (self.table.options.cellMouseMove) {

					self.table.options.cellMouseMove.call(self.table, e, component);
				}
			});
		}
	};

	Cell.prototype._bindTouchEvents = function (cellEvents) {

		var self = this,
		    element = self.element,
		    dblTap,
		    tapHold,
		    tap;

		if (cellEvents.cellTap || this.table.options.cellTap) {

			tap = false;

			element.addEventListener("touchstart", function (e) {

				tap = true;
			}, { passive: true });

			element.addEventListener("touchend", function (e) {

				if (tap) {

					var component = self.getComponent();

					if (cellEvents.cellTap) {

						cellEvents.cellTap.call(self.table, e, component);
					}

					if (self.table.options.cellTap) {

						self.table.options.cellTap.call(self.table, e, component);
					}
				}

				tap = false;
			});
		}

		if (cellEvents.cellDblTap || this.table.options.cellDblTap) {

			dblTap = null;

			element.addEventListener("touchend", function (e) {

				if (dblTap) {

					clearTimeout(dblTap);

					dblTap = null;

					var component = self.getComponent();

					if (cellEvents.cellDblTap) {

						cellEvents.cellDblTap.call(self.table, e, component);
					}

					if (self.table.options.cellDblTap) {

						self.table.options.cellDblTap.call(self.table, e, component);
					}
				} else {

					dblTap = setTimeout(function () {

						clearTimeout(dblTap);

						dblTap = null;
					}, 300);
				}
			});
		}

		if (cellEvents.cellTapHold || this.table.options.cellTapHold) {

			tapHold = null;

			element.addEventListener("touchstart", function (e) {

				clearTimeout(tapHold);

				tapHold = setTimeout(function () {

					clearTimeout(tapHold);

					tapHold = null;

					tap = false;

					var component = self.getComponent();

					if (cellEvents.cellTapHold) {

						cellEvents.cellTapHold.call(self.table, e, component);
					}

					if (self.table.options.cellTapHold) {

						self.table.options.cellTapHold.call(self.table, e, component);
					}
				}, 1000);
			}, { passive: true });

			element.addEventListener("touchend", function (e) {

				clearTimeout(tapHold);

				tapHold = null;
			});
		}
	};

	//generate cell contents

	Cell.prototype._generateContents = function () {

		var val;

		if (this.table.modExists("format")) {

			val = this.table.modules.format.formatValue(this);
		} else {

			val = this.element.innerHTML = this.value;
		}

		switch (typeof val === 'undefined' ? 'undefined' : _typeof(val)) {

			case "object":

				if (val instanceof Node) {

					//clear previous cell contents

					while (this.element.firstChild) {
						this.element.removeChild(this.element.firstChild);
					}this.element.appendChild(val);
				} else {

					this.element.innerHTML = "";

					if (val != null) {

						console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", val);
					}
				}

				break;

			case "undefined":

			case "null":

				this.element.innerHTML = "";

				break;

			default:

				this.element.innerHTML = val;

		}
	};

	Cell.prototype.cellRendered = function () {

		if (this.table.modExists("format") && this.table.modules.format.cellRendered) {

			this.table.modules.format.cellRendered(this);
		}
	};

	//generate tooltip text

	Cell.prototype._generateTooltip = function () {

		var tooltip = this.column.tooltip;

		if (tooltip) {

			if (tooltip === true) {

				tooltip = this.value;
			} else if (typeof tooltip == "function") {

				tooltip = tooltip(this.getComponent());

				if (tooltip === false) {

					tooltip = "";
				}
			}

			if (typeof tooltip === "undefined") {

				tooltip = "";
			}

			this.element.setAttribute("title", tooltip);
		} else {

			this.element.setAttribute("title", "");
		}
	};

	//////////////////// Getters ////////////////////

	Cell.prototype.getElement = function () {

		return this.element;
	};

	Cell.prototype.getValue = function () {

		return this.value;
	};

	Cell.prototype.getOldValue = function () {

		return this.oldValue;
	};

	//////////////////// Actions ////////////////////


	Cell.prototype.setValue = function (value, mutate) {

		var changed = this.setValueProcessData(value, mutate),
		    component;

		if (changed) {

			if (this.table.options.history && this.table.modExists("history")) {

				this.table.modules.history.action("cellEdit", this, { oldValue: this.oldValue, newValue: this.value });
			}

			component = this.getComponent();

			if (this.column.cellEvents.cellEdited) {

				this.column.cellEvents.cellEdited.call(this.table, component);
			}

			this.table.options.cellEdited.call(this.table, component);

			this.table.options.dataEdited.call(this.table, this.table.rowManager.getData());
		}
	};

	Cell.prototype.setValueProcessData = function (value, mutate) {

		var changed = false;

		if (this.value != value) {

			changed = true;

			if (mutate) {

				if (this.column.modules.mutate) {

					value = this.table.modules.mutator.transformCell(this, value);
				}
			}
		}

		this.setValueActual(value);

		if (changed && this.table.modExists("columnCalcs")) {

			if (this.column.definition.topCalc || this.column.definition.bottomCalc) {

				if (this.table.options.groupBy && this.table.modExists("groupRows")) {

					if (this.table.options.columnCalcs == "table" || this.table.options.columnCalcs == "both") {

						this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
					}

					if (this.table.options.columnCalcs != "table") {

						this.table.modules.columnCalcs.recalcRowGroup(this.row);
					}
				} else {

					this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows);
				}
			}
		}

		return changed;
	};

	Cell.prototype.setValueActual = function (value) {

		this.oldValue = this.value;

		this.value = value;

		if (this.table.options.reactiveData && this.table.modExists("reactiveData")) {

			this.table.modules.reactiveData.block();
		}

		this.column.setFieldValue(this.row.data, value);

		if (this.table.options.reactiveData && this.table.modExists("reactiveData")) {

			this.table.modules.reactiveData.unblock();
		}

		this._generateContents();

		this._generateTooltip();

		//set resizable handles

		if (this.table.options.resizableColumns && this.table.modExists("resizeColumns")) {

			this.table.modules.resizeColumns.initializeColumn("cell", this.column, this.element);
		}

		//set column menu

		if (this.column.definition.contextMenu && this.table.modExists("menu")) {

			this.table.modules.menu.initializeCell(this);
		}

		//handle frozen cells

		if (this.table.modExists("frozenColumns")) {

			this.table.modules.frozenColumns.layoutElement(this.element, this.column);
		}
	};

	Cell.prototype.setWidth = function () {

		this.width = this.column.width;

		this.element.style.width = this.column.widthStyled;
	};

	Cell.prototype.clearWidth = function () {

		this.width = "";

		this.element.style.width = "";
	};

	Cell.prototype.getWidth = function () {

		return this.width || this.element.offsetWidth;
	};

	Cell.prototype.setMinWidth = function () {

		this.minWidth = this.column.minWidth;

		this.element.style.minWidth = this.column.minWidthStyled;
	};

	Cell.prototype.checkHeight = function () {

		// var height = this.element.css("height");

		this.row.reinitializeHeight();
	};

	Cell.prototype.clearHeight = function () {

		this.element.style.height = "";

		this.height = null;
	};

	Cell.prototype.setHeight = function () {

		this.height = this.row.height;

		this.element.style.height = this.row.heightStyled;
	};

	Cell.prototype.getHeight = function () {

		return this.height || this.element.offsetHeight;
	};

	Cell.prototype.show = function () {

		this.element.style.display = "";
	};

	Cell.prototype.hide = function () {

		this.element.style.display = "none";
	};

	Cell.prototype.edit = function (force) {

		if (this.table.modExists("edit", true)) {

			return this.table.modules.edit.editCell(this, force);
		}
	};

	Cell.prototype.cancelEdit = function () {

		if (this.table.modExists("edit", true)) {

			var editing = this.table.modules.edit.getCurrentCell();

			if (editing && editing._getSelf() === this) {

				this.table.modules.edit.cancelEdit();
			} else {

				console.warn("Cancel Editor Error - This cell is not currently being edited ");
			}
		}
	};

	Cell.prototype.delete = function () {

		if (!this.table.rowManager.redrawBlock) {

			this.element.parentNode.removeChild(this.element);
		}

		this.element = false;

		this.column.deleteCell(this);

		this.row.deleteCell(this);

		this.calcs = {};
	};

	//////////////// Navigation /////////////////


	Cell.prototype.nav = function () {

		var self = this,
		    nextCell = false,
		    index = this.row.getCellIndex(this);

		return {

			next: function next() {

				var nextCell = this.right(),
				    nextRow;

				if (!nextCell) {

					nextRow = self.table.rowManager.nextDisplayRow(self.row, true);

					if (nextRow) {

						nextCell = nextRow.findNextEditableCell(-1);

						if (nextCell) {

							nextCell.edit();

							return true;
						}
					}
				} else {

					return true;
				}

				return false;
			},

			prev: function prev() {

				var nextCell = this.left(),
				    prevRow;

				if (!nextCell) {

					prevRow = self.table.rowManager.prevDisplayRow(self.row, true);

					if (prevRow) {

						nextCell = prevRow.findPrevEditableCell(prevRow.cells.length);

						if (nextCell) {

							nextCell.edit();

							return true;
						}
					}
				} else {

					return true;
				}

				return false;
			},

			left: function left() {

				nextCell = self.row.findPrevEditableCell(index);

				if (nextCell) {

					nextCell.edit();

					return true;
				} else {

					return false;
				}
			},

			right: function right() {

				nextCell = self.row.findNextEditableCell(index);

				if (nextCell) {

					nextCell.edit();

					return true;
				} else {

					return false;
				}
			},

			up: function up() {

				var nextRow = self.table.rowManager.prevDisplayRow(self.row, true);

				if (nextRow) {

					nextRow.cells[index].edit();
				}
			},

			down: function down() {

				var nextRow = self.table.rowManager.nextDisplayRow(self.row, true);

				if (nextRow) {

					nextRow.cells[index].edit();
				}
			}

		};
	};

	Cell.prototype.getIndex = function () {

		this.row.getCellIndex(this);
	};

	//////////////// Object Generation /////////////////

	Cell.prototype.getComponent = function () {

		return new CellComponent(this);
	};

	var FooterManager = function FooterManager(table) {

		this.table = table;

		this.active = false;

		this.element = this.createElement(); //containing element

		this.external = false;

		this.links = [];

		this._initialize();
	};

	FooterManager.prototype.createElement = function () {

		var el = document.createElement("div");

		el.classList.add("tabulator-footer");

		return el;
	};

	FooterManager.prototype._initialize = function (element) {

		if (this.table.options.footerElement) {

			switch (_typeof(this.table.options.footerElement)) {

				case "string":

					if (this.table.options.footerElement[0] === "<") {

						this.element.innerHTML = this.table.options.footerElement;
					} else {

						this.external = true;

						this.element = document.querySelector(this.table.options.footerElement);
					}

					break;

				default:

					this.element = this.table.options.footerElement;

					break;

			}
		}
	};

	FooterManager.prototype.getElement = function () {

		return this.element;
	};

	FooterManager.prototype.append = function (element, parent) {

		this.activate(parent);

		this.element.appendChild(element);

		this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.prepend = function (element, parent) {

		this.activate(parent);

		this.element.insertBefore(element, this.element.firstChild);

		this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.remove = function (element) {

		element.parentNode.removeChild(element);

		this.deactivate();
	};

	FooterManager.prototype.deactivate = function (force) {

		if (!this.element.firstChild || force) {

			if (!this.external) {

				this.element.parentNode.removeChild(this.element);
			}

			this.active = false;
		}

		// this.table.rowManager.adjustTableSize();
	};

	FooterManager.prototype.activate = function (parent) {

		if (!this.active) {

			this.active = true;

			if (!this.external) {

				this.table.element.appendChild(this.getElement());

				this.table.element.style.display = '';
			}
		}

		if (parent) {

			this.links.push(parent);
		}
	};

	FooterManager.prototype.redraw = function () {

		this.links.forEach(function (link) {

			link.footerRedraw();
		});
	};

	var Tabulator = function Tabulator(element, options) {

		this.options = {};

		this.columnManager = null; // hold Column Manager

		this.rowManager = null; //hold Row Manager

		this.footerManager = null; //holder Footer Manager

		this.browser = ""; //hold current browser type

		this.browserSlow = false; //handle reduced functionality for slower browsers

		this.browserMobile = false; //check if running on moble, prevent resize cancelling edit on keyboard appearence


		this.modules = {}; //hold all modules bound to this table


		this.initializeElement(element);

		this.initializeOptions(options || {});

		this._create();

		Tabulator.prototype.comms.register(this); //register table for inderdevice communication
	};

	//default setup options

	Tabulator.prototype.defaultOptions = {

		height: false, //height of tabulator

		minHeight: false, //minimum height of tabulator

		maxHeight: false, //maximum height of tabulator


		layout: "fitData", ///layout type "fitColumns" | "fitData"

		layoutColumnsOnNewData: false, //update column widths on setData


		columnMinWidth: 40, //minimum global width for a column

		columnHeaderVertAlign: "top", //vertical alignment of column headers

		columnVertAlign: false, // DEPRECATED - Left to allow warning


		resizableColumns: true, //resizable columns

		resizableRows: false, //resizable rows

		autoResize: true, //auto resize table


		columns: [], //store for colum header info


		cellHozAlign: "", //horizontal align columns

		cellVertAlign: "", //certical align columns


		data: [], //default starting data


		autoColumns: false, //build columns from data row structure


		reactiveData: false, //enable data reactivity


		nestedFieldSeparator: ".", //seperatpr for nested data


		tooltips: false, //Tool tip value

		tooltipsHeader: false, //Tool tip for headers

		tooltipGenerationMode: "load", //when to generate tooltips


		initialSort: false, //initial sorting criteria

		initialFilter: false, //initial filtering criteria

		initialHeaderFilter: false, //initial header filtering criteria


		columnHeaderSortMulti: true, //multiple or single column sorting


		sortOrderReverse: false, //reverse internal sort ordering


		headerSort: true, //set default global header sort

		headerSortTristate: false, //set default tristate header sorting


		footerElement: false, //hold footer element


		index: "id", //filed for row index


		keybindings: [], //array for keybindings


		tabEndNewRow: false, //create new row when tab to end of table


		invalidOptionWarnings: true, //allow toggling of invalid option warnings


		clipboard: false, //enable clipboard

		clipboardCopyStyled: true, //formatted table data

		clipboardCopyConfig: false, //clipboard config

		clipboardCopyFormatter: false, //DEPRICATED - REMOVE in 5.0

		clipboardCopyRowRange: "active", //restrict clipboard to visible rows only

		clipboardPasteParser: "table", //convert pasted clipboard data to rows

		clipboardPasteAction: "insert", //how to insert pasted data into the table


		clipboardCopied: function clipboardCopied() {}, //data has been copied to the clipboard

		clipboardPasted: function clipboardPasted() {}, //data has been pasted into the table

		clipboardPasteError: function clipboardPasteError() {}, //data has not successfully been pasted into the table


		downloadDataFormatter: false, //function to manipulate table data before it is downloaded

		downloadReady: function downloadReady(data, blob) {
			return blob;
		}, //function to manipulate download data

		downloadComplete: false, //function to manipulate download data

		downloadConfig: false, //download config


		dataTree: false, //enable data tree

		dataTreeElementColumn: false,

		dataTreeBranchElement: true, //show data tree branch element

		dataTreeChildIndent: 9, //data tree child indent in px

		dataTreeChildField: "_children", //data tre column field to look for child rows

		dataTreeCollapseElement: false, //data tree row collapse element

		dataTreeExpandElement: false, //data tree row expand element

		dataTreeStartExpanded: false,

		dataTreeRowExpanded: function dataTreeRowExpanded() {}, //row has been expanded

		dataTreeRowCollapsed: function dataTreeRowCollapsed() {}, //row has been collapsed

		dataTreeChildColumnCalcs: false, //include visible data tree rows in column calculations

		dataTreeSelectPropagate: false, //seleccting a parent row selects its children


		printAsHtml: false, //enable print as html

		printFormatter: false, //printing page formatter

		printHeader: false, //page header contents

		printFooter: false, //page footer contents

		printCopyStyle: true, //DEPRICATED - REMOVE in 5.0

		printStyled: true, //enable print as html styling

		printVisibleRows: true, //DEPRICATED - REMOVE in 5.0

		printRowRange: "visible", //restrict print to visible rows only

		printConfig: {}, //print config options


		addRowPos: "bottom", //position to insert blank rows, top|bottom


		selectable: "highlight", //highlight rows on hover

		selectableRangeMode: "drag", //highlight rows on hover

		selectableRollingSelection: true, //roll selection once maximum number of selectable rows is reached

		selectablePersistence: true, // maintain selection when table view is updated

		selectableCheck: function selectableCheck(data, row) {
			return true;
		}, //check wheather row is selectable


		headerFilterLiveFilterDelay: 300, //delay before updating column after user types in header filter

		headerFilterPlaceholder: false, //placeholder text to display in header filters


		headerVisible: true, //hide header


		history: false, //enable edit history


		locale: false, //current system language

		langs: {},

		virtualDom: true, //enable DOM virtualization

		virtualDomBuffer: 0, // set virtual DOM buffer size


		persistentLayout: false, //DEPRICATED - REMOVE in 5.0

		persistentSort: false, //DEPRICATED - REMOVE in 5.0

		persistentFilter: false, //DEPRICATED - REMOVE in 5.0

		persistenceID: "", //key for persistent storage

		persistenceMode: true, //mode for storing persistence information

		persistenceReaderFunc: false, //function for handling persistence data reading

		persistenceWriterFunc: false, //function for handling persistence data writing


		persistence: false,

		responsiveLayout: false, //responsive layout flags

		responsiveLayoutCollapseStartOpen: true, //start showing collapsed data

		responsiveLayoutCollapseUseFormatters: true, //responsive layout collapse formatter

		responsiveLayoutCollapseFormatter: false, //responsive layout collapse formatter


		pagination: false, //set pagination type

		paginationSize: false, //set number of rows to a page

		paginationInitialPage: 1, //initail page to show on load

		paginationButtonCount: 5, // set count of page button

		paginationSizeSelector: false, //add pagination size selector element

		paginationElement: false, //element to hold pagination numbers

		paginationDataSent: {}, //pagination data sent to the server

		paginationDataReceived: {}, //pagination data received from the server

		paginationAddRow: "page", //add rows on table or page


		ajaxURL: false, //url for ajax loading

		ajaxURLGenerator: false,

		ajaxParams: {}, //params for ajax loading

		ajaxConfig: "get", //ajax request type

		ajaxContentType: "form", //ajax request type

		ajaxRequestFunc: false, //promise function

		ajaxLoader: true, //show loader

		ajaxLoaderLoading: false, //loader element

		ajaxLoaderError: false, //loader element

		ajaxFiltering: false,

		ajaxSorting: false,

		ajaxProgressiveLoad: false, //progressive loading

		ajaxProgressiveLoadDelay: 0, //delay between requests

		ajaxProgressiveLoadScrollMargin: 0, //margin before scroll begins


		groupBy: false, //enable table grouping and set field to group by

		groupStartOpen: true, //starting state of group

		groupValues: false,

		groupHeader: false, //header generation function


		htmlOutputConfig: false, //html outypu config


		movableColumns: false, //enable movable columns


		movableRows: false, //enable movable rows

		movableRowsConnectedTables: false, //tables for movable rows to be connected to

		movableRowsSender: false,

		movableRowsReceiver: "insert",

		movableRowsSendingStart: function movableRowsSendingStart() {},

		movableRowsSent: function movableRowsSent() {},

		movableRowsSentFailed: function movableRowsSentFailed() {},

		movableRowsSendingStop: function movableRowsSendingStop() {},

		movableRowsReceivingStart: function movableRowsReceivingStart() {},

		movableRowsReceived: function movableRowsReceived() {},

		movableRowsReceivedFailed: function movableRowsReceivedFailed() {},

		movableRowsReceivingStop: function movableRowsReceivingStop() {},

		scrollToRowPosition: "top",

		scrollToRowIfVisible: true,

		scrollToColumnPosition: "left",

		scrollToColumnIfVisible: true,

		rowFormatter: false,

		rowFormatterPrint: null,

		rowFormatterClipboard: null,

		rowFormatterHtmlOutput: null,

		placeholder: false,

		//table building callbacks

		tableBuilding: function tableBuilding() {},

		tableBuilt: function tableBuilt() {},

		//render callbacks

		renderStarted: function renderStarted() {},

		renderComplete: function renderComplete() {},

		//row callbacks

		rowClick: false,

		rowDblClick: false,

		rowContext: false,

		rowTap: false,

		rowDblTap: false,

		rowTapHold: false,

		rowMouseEnter: false,

		rowMouseLeave: false,

		rowMouseOver: false,

		rowMouseOut: false,

		rowMouseMove: false,

		rowContextMenu: false,

		rowAdded: function rowAdded() {},

		rowDeleted: function rowDeleted() {},

		rowMoved: function rowMoved() {},

		rowUpdated: function rowUpdated() {},

		rowSelectionChanged: function rowSelectionChanged() {},

		rowSelected: function rowSelected() {},

		rowDeselected: function rowDeselected() {},

		rowResized: function rowResized() {},

		//cell callbacks

		//row callbacks

		cellClick: false,

		cellDblClick: false,

		cellContext: false,

		cellTap: false,

		cellDblTap: false,

		cellTapHold: false,

		cellMouseEnter: false,

		cellMouseLeave: false,

		cellMouseOver: false,

		cellMouseOut: false,

		cellMouseMove: false,

		cellEditing: function cellEditing() {},

		cellEdited: function cellEdited() {},

		cellEditCancelled: function cellEditCancelled() {},

		//column callbacks

		columnMoved: false,

		columnResized: function columnResized() {},

		columnTitleChanged: function columnTitleChanged() {},

		columnVisibilityChanged: function columnVisibilityChanged() {},

		//HTML iport callbacks

		htmlImporting: function htmlImporting() {},

		htmlImported: function htmlImported() {},

		//data callbacks

		dataLoading: function dataLoading() {},

		dataLoaded: function dataLoaded() {},

		dataEdited: function dataEdited() {},

		//ajax callbacks

		ajaxRequesting: function ajaxRequesting() {},

		ajaxResponse: false,

		ajaxError: function ajaxError() {},

		//filtering callbacks

		dataFiltering: false,

		dataFiltered: false,

		//sorting callbacks

		dataSorting: function dataSorting() {},

		dataSorted: function dataSorted() {},

		//grouping callbacks

		groupToggleElement: "arrow",

		groupClosedShowCalcs: false,

		dataGrouping: function dataGrouping() {},

		dataGrouped: false,

		groupVisibilityChanged: function groupVisibilityChanged() {},

		groupClick: false,

		groupDblClick: false,

		groupContext: false,

		groupTap: false,

		groupDblTap: false,

		groupTapHold: false,

		columnCalcs: true,

		//pagination callbacks

		pageLoaded: function pageLoaded() {},

		//localization callbacks

		localized: function localized() {},

		//validation has failed

		validationFailed: function validationFailed() {},

		//history callbacks

		historyUndo: function historyUndo() {},

		historyRedo: function historyRedo() {},

		//scroll callbacks

		scrollHorizontal: function scrollHorizontal() {},

		scrollVertical: function scrollVertical() {}

	};

	Tabulator.prototype.initializeOptions = function (options) {

		//warn user if option is not available

		if (options.invalidOptionWarnings !== false) {

			for (var key in options) {

				if (typeof this.defaultOptions[key] === "undefined") {

					console.warn("Invalid table constructor option:", key);
				}
			}
		}

		//assign options to table

		for (var key in this.defaultOptions) {

			if (key in options) {

				this.options[key] = options[key];
			} else {

				if (Array.isArray(this.defaultOptions[key])) {

					this.options[key] = [];
				} else if (_typeof(this.defaultOptions[key]) === "object" && this.defaultOptions[key] !== null) {

					this.options[key] = {};
				} else {

					this.options[key] = this.defaultOptions[key];
				}
			}
		}
	};

	Tabulator.prototype.initializeElement = function (element) {

		if (typeof HTMLElement !== "undefined" && element instanceof HTMLElement) {

			this.element = element;

			return true;
		} else if (typeof element === "string") {

			this.element = document.querySelector(element);

			if (this.element) {

				return true;
			} else {

				console.error("Tabulator Creation Error - no element found matching selector: ", element);

				return false;
			}
		} else {

			console.error("Tabulator Creation Error - Invalid element provided:", element);

			return false;
		}
	};

	//convert depricated functionality to new functions

	Tabulator.prototype._mapDepricatedFunctionality = function () {

		//map depricated persistance setup options

		if (this.options.persistentLayout || this.options.persistentSort || this.options.persistentFilter) {

			if (!this.options.persistence) {

				this.options.persistence = {};
			}
		}

		if (typeof this.options.clipboardCopyHeader !== "undefined") {

			this.options.columnHeaders = this.options.clipboardCopyHeader;

			console.warn("DEPRECATION WARNING - clipboardCopyHeader option has been deprecated, please use the columnHeaders property on the clipboardCopyConfig option");
		}

		if (this.options.printVisibleRows !== true) {

			console.warn("printVisibleRows option is deprecated, you should now use the printRowRange option");

			this.options.persistence.printRowRange = "active";
		}

		if (this.options.printCopyStyle !== true) {

			console.warn("printCopyStyle option is deprecated, you should now use the printStyled option");

			this.options.persistence.printStyled = this.options.printCopyStyle;
		}

		if (this.options.persistentLayout) {

			console.warn("persistentLayout option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.columns === "undefined") {

				this.options.persistence.columns = true;
			}
		}

		if (this.options.persistentSort) {

			console.warn("persistentSort option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.sort === "undefined") {

				this.options.persistence.sort = true;
			}
		}

		if (this.options.persistentFilter) {

			console.warn("persistentFilter option is deprecated, you should now use the persistence option");

			if (this.options.persistence !== true && typeof this.options.persistence.filter === "undefined") {

				this.options.persistence.filter = true;
			}
		}

		if (this.options.columnVertAlign) {

			console.warn("columnVertAlign option is deprecated, you should now use the columnHeaderVertAlign option");

			this.options.columnHeaderVertAlign = this.options.columnVertAlign;
		}
	};

	Tabulator.prototype._clearSelection = function () {

		this.element.classList.add("tabulator-block-select");

		if (window.getSelection) {

			if (window.getSelection().empty) {
				// Chrome

				window.getSelection().empty();
			} else if (window.getSelection().removeAllRanges) {
				// Firefox

				window.getSelection().removeAllRanges();
			}
		} else if (document.selection) {
			// IE?

			document.selection.empty();
		}

		this.element.classList.remove("tabulator-block-select");
	};

	//concreate table

	Tabulator.prototype._create = function () {

		this._clearObjectPointers();

		this._mapDepricatedFunctionality();

		this.bindModules();

		if (this.element.tagName === "TABLE") {

			if (this.modExists("htmlTableImport", true)) {

				this.modules.htmlTableImport.parseTable();
			}
		}

		this.columnManager = new ColumnManager(this);

		this.rowManager = new RowManager(this);

		this.footerManager = new FooterManager(this);

		this.columnManager.setRowManager(this.rowManager);

		this.rowManager.setColumnManager(this.columnManager);

		this._buildElement();

		this._loadInitialData();
	};

	//clear pointers to objects in default config object

	Tabulator.prototype._clearObjectPointers = function () {

		this.options.columns = this.options.columns.slice(0);

		if (!this.options.reactiveData) {

			this.options.data = this.options.data.slice(0);
		}
	};

	//build tabulator element

	Tabulator.prototype._buildElement = function () {
		var _this16 = this;

		var element = this.element,
		    mod = this.modules,
		    options = this.options;

		options.tableBuilding.call(this);

		element.classList.add("tabulator");

		element.setAttribute("role", "grid");

		//empty element

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		} //set table height

		if (options.height) {

			options.height = isNaN(options.height) ? options.height : options.height + "px";

			element.style.height = options.height;
		}

		//set table min height

		if (options.minHeight !== false) {

			options.minHeight = isNaN(options.minHeight) ? options.minHeight : options.minHeight + "px";

			element.style.minHeight = options.minHeight;
		}

		//set table maxHeight

		if (options.maxHeight !== false) {

			options.maxHeight = isNaN(options.maxHeight) ? options.maxHeight : options.maxHeight + "px";

			element.style.maxHeight = options.maxHeight;
		}

		this.columnManager.initialize();

		this.rowManager.initialize();

		this._detectBrowser();

		if (this.modExists("layout", true)) {

			mod.layout.initialize(options.layout);
		}

		//set localization

		if (options.headerFilterPlaceholder !== false) {

			mod.localize.setHeaderFilterPlaceholder(options.headerFilterPlaceholder);
		}

		for (var locale in options.langs) {

			mod.localize.installLang(locale, options.langs[locale]);
		}

		mod.localize.setLocale(options.locale);

		//configure placeholder element

		if (typeof options.placeholder == "string") {

			var el = document.createElement("div");

			el.classList.add("tabulator-placeholder");

			var span = document.createElement("span");

			span.innerHTML = options.placeholder;

			el.appendChild(span);

			options.placeholder = el;
		}

		//build table elements

		element.appendChild(this.columnManager.getElement());

		element.appendChild(this.rowManager.getElement());

		if (options.footerElement) {

			this.footerManager.activate();
		}

		if (options.persistence && this.modExists("persistence", true)) {

			mod.persistence.initialize();
		}

		if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.columns) {

			options.columns = mod.persistence.load("columns", options.columns);
		}

		if (options.movableRows && this.modExists("moveRow")) {

			mod.moveRow.initialize();
		}

		if (options.autoColumns && this.options.data) {

			this.columnManager.generateColumnsFromRowData(this.options.data);
		}

		if (this.modExists("columnCalcs")) {

			mod.columnCalcs.initialize();
		}

		this.columnManager.setColumns(options.columns);

		if (options.dataTree && this.modExists("dataTree", true)) {

			mod.dataTree.initialize();
		}

		if (this.modExists("frozenRows")) {

			this.modules.frozenRows.initialize();
		}

		if ((options.persistence && this.modExists("persistence", true) && mod.persistence.config.sort || options.initialSort) && this.modExists("sort", true)) {

			var sorters = [];

			if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.sort) {

				sorters = mod.persistence.load("sort");

				if (sorters === false && options.initialSort) {

					sorters = options.initialSort;
				}
			} else if (options.initialSort) {

				sorters = options.initialSort;
			}

			mod.sort.setSort(sorters);
		}

		if ((options.persistence && this.modExists("persistence", true) && mod.persistence.config.filter || options.initialFilter) && this.modExists("filter", true)) {

			var filters = [];

			if (options.persistence && this.modExists("persistence", true) && mod.persistence.config.filter) {

				filters = mod.persistence.load("filter");

				if (filters === false && options.initialFilter) {

					filters = options.initialFilter;
				}
			} else if (options.initialFilter) {

				filters = options.initialFilter;
			}

			mod.filter.setFilter(filters);
		}

		if (options.initialHeaderFilter && this.modExists("filter", true)) {

			options.initialHeaderFilter.forEach(function (item) {

				var column = _this16.columnManager.findColumn(item.field);

				if (column) {

					mod.filter.setHeaderFilterValue(column, item.value);
				} else {

					console.warn("Column Filter Error - No matching column found:", item.field);

					return false;
				}
			});
		}

		if (this.modExists("ajax")) {

			mod.ajax.initialize();
		}

		if (options.pagination && this.modExists("page", true)) {

			mod.page.initialize();
		}

		if (options.groupBy && this.modExists("groupRows", true)) {

			mod.groupRows.initialize();
		}

		if (this.modExists("keybindings")) {

			mod.keybindings.initialize();
		}

		if (this.modExists("selectRow")) {

			mod.selectRow.clearSelectionData(true);
		}

		if (options.autoResize && this.modExists("resizeTable")) {

			mod.resizeTable.initialize();
		}

		if (this.modExists("clipboard")) {

			mod.clipboard.initialize();
		}

		if (options.printAsHtml && this.modExists("print")) {

			mod.print.initialize();
		}

		options.tableBuilt.call(this);
	};

	Tabulator.prototype._loadInitialData = function () {

		var self = this;

		if (self.options.pagination && self.modExists("page")) {

			self.modules.page.reset(true, true);

			if (self.options.pagination == "local") {

				if (self.options.data.length) {

					self.rowManager.setData(self.options.data, false, true);
				} else {

					if ((self.options.ajaxURL || self.options.ajaxURLGenerator) && self.modExists("ajax")) {

						self.modules.ajax.loadData(false, true).then(function () {}).catch(function () {

							if (self.options.paginationInitialPage) {

								self.modules.page.setPage(self.options.paginationInitialPage);
							}
						});

						return;
					} else {

						self.rowManager.setData(self.options.data, false, true);
					}
				}

				if (self.options.paginationInitialPage) {

					self.modules.page.setPage(self.options.paginationInitialPage);
				}
			} else {

				if (self.options.ajaxURL) {

					self.modules.page.setPage(self.options.paginationInitialPage).then(function () {}).catch(function () {});
				} else {

					self.rowManager.setData([], false, true);
				}
			}
		} else {

			if (self.options.data.length) {

				self.rowManager.setData(self.options.data);
			} else {

				if ((self.options.ajaxURL || self.options.ajaxURLGenerator) && self.modExists("ajax")) {

					self.modules.ajax.loadData(false, true).then(function () {}).catch(function () {});
				} else {

					self.rowManager.setData(self.options.data, false, true);
				}
			}
		}
	};

	//deconstructor

	Tabulator.prototype.destroy = function () {

		var element = this.element;

		Tabulator.prototype.comms.deregister(this); //deregister table from inderdevice communication


		if (this.options.reactiveData && this.modExists("reactiveData", true)) {

			this.modules.reactiveData.unwatchData();
		}

		//clear row data

		this.rowManager.rows.forEach(function (row) {

			row.wipe();
		});

		this.rowManager.rows = [];

		this.rowManager.activeRows = [];

		this.rowManager.displayRows = [];

		//clear event bindings

		if (this.options.autoResize && this.modExists("resizeTable")) {

			this.modules.resizeTable.clearBindings();
		}

		if (this.modExists("keybindings")) {

			this.modules.keybindings.clearBindings();
		}

		//clear DOM

		while (element.firstChild) {
			element.removeChild(element.firstChild);
		}element.classList.remove("tabulator");
	};

	Tabulator.prototype._detectBrowser = function () {

		var ua = navigator.userAgent || navigator.vendor || window.opera;

		if (ua.indexOf("Trident") > -1) {

			this.browser = "ie";

			this.browserSlow = true;
		} else if (ua.indexOf("Edge") > -1) {

			this.browser = "edge";

			this.browserSlow = true;
		} else if (ua.indexOf("Firefox") > -1) {

			this.browser = "firefox";

			this.browserSlow = false;
		} else {

			this.browser = "other";

			this.browserSlow = false;
		}

		this.browserMobile = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ua) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ua.substr(0, 4));
	};

	////////////////// Data Handling //////////////////


	//block table redrawing

	Tabulator.prototype.blockRedraw = function () {

		return this.rowManager.blockRedraw();
	};

	//restore table redrawing

	Tabulator.prototype.restoreRedraw = function () {

		return this.rowManager.restoreRedraw();
	};

	//local data from local file

	Tabulator.prototype.setDataFromLocalFile = function (extensions) {
		var _this17 = this;

		return new Promise(function (resolve, reject) {

			var input = document.createElement("input");

			input.type = "file";

			input.accept = extensions || ".json,application/json";

			input.addEventListener("change", function (e) {

				var file = input.files[0],
				    reader = new FileReader(),
				    data;

				reader.readAsText(file);

				reader.onload = function (e) {

					try {

						data = JSON.parse(reader.result);
					} catch (e) {

						console.warn("File Load Error - File contents is invalid JSON", e);

						reject(e);

						return;
					}

					_this17._setData(data).then(function (data) {

						resolve(data);
					}).catch(function (err) {

						resolve(err);
					});
				};

				reader.onerror = function (e) {

					console.warn("File Load Error - Unable to read file");

					reject();
				};
			});

			input.click();
		});
	};

	//load data

	Tabulator.prototype.setData = function (data, params, config) {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		return this._setData(data, params, config, false, true);
	};

	Tabulator.prototype._setData = function (data, params, config, inPosition, columnsChanged) {

		var self = this;

		if (typeof data === "string") {

			if (data.indexOf("{") == 0 || data.indexOf("[") == 0) {

				//data is a json encoded string

				return self.rowManager.setData(JSON.parse(data), inPosition, columnsChanged);
			} else {

				if (self.modExists("ajax", true)) {

					if (params) {

						self.modules.ajax.setParams(params);
					}

					if (config) {

						self.modules.ajax.setConfig(config);
					}

					self.modules.ajax.setUrl(data);

					if (self.options.pagination == "remote" && self.modExists("page", true)) {

						self.modules.page.reset(true, true);

						return self.modules.page.setPage(1);
					} else {

						//assume data is url, make ajax call to url to get data

						return self.modules.ajax.loadData(inPosition, columnsChanged);
					}
				}
			}
		} else {

			if (data) {

				//asume data is already an object

				return self.rowManager.setData(data, inPosition, columnsChanged);
			} else {

				//no data provided, check if ajaxURL is present;

				if (self.modExists("ajax") && (self.modules.ajax.getUrl || self.options.ajaxURLGenerator)) {

					if (self.options.pagination == "remote" && self.modExists("page", true)) {

						self.modules.page.reset(true, true);

						return self.modules.page.setPage(1);
					} else {

						return self.modules.ajax.loadData(inPosition, columnsChanged);
					}
				} else {

					//empty data

					return self.rowManager.setData([], inPosition, columnsChanged);
				}
			}
		}
	};

	//clear data

	Tabulator.prototype.clearData = function () {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		this.rowManager.clearData();
	};

	//get table data array

	Tabulator.prototype.getData = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getData function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getData(active);
	};

	//get table data array count

	Tabulator.prototype.getDataCount = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getDataCount function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getDataCount(active);
	};

	//search for specific row components

	Tabulator.prototype.searchRows = function (field, type, value) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.search("rows", field, type, value);
		}
	};

	//search for specific data

	Tabulator.prototype.searchData = function (field, type, value) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.search("data", field, type, value);
		}
	};

	//get table html

	Tabulator.prototype.getHtml = function (visible, style, config) {

		if (this.modExists("export", true)) {

			return this.modules.export.getHtml(visible, style, config);
		}
	};

	//get print html

	Tabulator.prototype.print = function (visible, style, config) {

		if (this.modExists("print", true)) {

			return this.modules.print.printFullscreen(visible, style, config);
		}
	};

	//retrieve Ajax URL

	Tabulator.prototype.getAjaxUrl = function () {

		if (this.modExists("ajax", true)) {

			return this.modules.ajax.getUrl();
		}
	};

	//replace data, keeping table in position with same sort

	Tabulator.prototype.replaceData = function (data, params, config) {

		if (this.modExists("ajax")) {

			this.modules.ajax.blockActiveRequest();
		}

		return this._setData(data, params, config, true);
	};

	//update table data

	Tabulator.prototype.updateData = function (data) {
		var _this18 = this;

		var self = this;

		var responses = 0;

		return new Promise(function (resolve, reject) {

			if (_this18.modExists("ajax")) {

				_this18.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				data.forEach(function (item) {

					var row = self.rowManager.findRow(item[self.options.index]);

					if (row) {

						responses++;

						row.updateData(item).then(function () {

							responses--;

							if (!responses) {

								resolve();
							}
						});
					}
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	Tabulator.prototype.addData = function (data, pos, index) {
		var _this19 = this;

		return new Promise(function (resolve, reject) {

			if (_this19.modExists("ajax")) {

				_this19.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				_this19.rowManager.addRows(data, pos, index).then(function (rows) {

					var output = [];

					rows.forEach(function (row) {

						output.push(row.getComponent());
					});

					resolve(output);
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	//update table data

	Tabulator.prototype.updateOrAddData = function (data) {
		var _this20 = this;

		var self = this,
		    rows = [],
		    responses = 0;

		return new Promise(function (resolve, reject) {

			if (_this20.modExists("ajax")) {

				_this20.modules.ajax.blockActiveRequest();
			}

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (data) {

				data.forEach(function (item) {

					var row = self.rowManager.findRow(item[self.options.index]);

					responses++;

					if (row) {

						row.updateData(item).then(function () {

							responses--;

							rows.push(row.getComponent());

							if (!responses) {

								resolve(rows);
							}
						});
					} else {

						self.rowManager.addRows(item).then(function (newRows) {

							responses--;

							rows.push(newRows[0].getComponent());

							if (!responses) {

								resolve(rows);
							}
						});
					}
				});
			} else {

				console.warn("Update Error - No data provided");

				reject("Update Error - No data provided");
			}
		});
	};

	//get row object

	Tabulator.prototype.getRow = function (index) {

		var row = this.rowManager.findRow(index);

		if (row) {

			return row.getComponent();
		} else {

			console.warn("Find Error - No matching row found:", index);

			return false;
		}
	};

	//get row object

	Tabulator.prototype.getRowFromPosition = function (position, active) {

		var row = this.rowManager.getRowFromPosition(position, active);

		if (row) {

			return row.getComponent();
		} else {

			console.warn("Find Error - No matching row found:", position);

			return false;
		}
	};

	//delete row from table

	Tabulator.prototype.deleteRow = function (index) {
		var _this21 = this;

		return new Promise(function (resolve, reject) {

			var self = _this21,
			    count = 0,
			    successCount = 0,
			    foundRows = [];

			function doneCheck() {

				count++;

				if (count == index.length) {

					if (successCount) {

						self.rowManager.reRenderInPosition();

						resolve();
					}
				}
			}

			if (!Array.isArray(index)) {

				index = [index];
			}

			//find matching rows

			index.forEach(function (item) {

				var row = _this21.rowManager.findRow(item, true);

				if (row) {

					foundRows.push(row);
				} else {

					console.warn("Delete Error - No matching row found:", item);

					reject("Delete Error - No matching row found");

					doneCheck();
				}
			});

			//sort rows into correct order to ensure smooth delete from table

			foundRows.sort(function (a, b) {

				return _this21.rowManager.rows.indexOf(a) > _this21.rowManager.rows.indexOf(b) ? 1 : -1;
			});

			foundRows.forEach(function (row) {

				row.delete().then(function () {

					successCount++;

					doneCheck();
				}).catch(function (err) {

					doneCheck();

					reject(err);
				});
			});
		});
	};

	//add row to table

	Tabulator.prototype.addRow = function (data, pos, index) {
		var _this22 = this;

		return new Promise(function (resolve, reject) {

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			_this22.rowManager.addRows(data, pos, index).then(function (rows) {

				//recalc column calculations if present

				if (_this22.modExists("columnCalcs")) {

					_this22.modules.columnCalcs.recalc(_this22.rowManager.activeRows);
				}

				resolve(rows[0].getComponent());
			});
		});
	};

	//update a row if it exitsts otherwise create it

	Tabulator.prototype.updateOrAddRow = function (index, data) {
		var _this23 = this;

		return new Promise(function (resolve, reject) {

			var row = _this23.rowManager.findRow(index);

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (row) {

				row.updateData(data).then(function () {

					//recalc column calculations if present

					if (_this23.modExists("columnCalcs")) {

						_this23.modules.columnCalcs.recalc(_this23.rowManager.activeRows);
					}

					resolve(row.getComponent());
				}).catch(function (err) {

					reject(err);
				});
			} else {

				row = _this23.rowManager.addRows(data).then(function (rows) {

					//recalc column calculations if present

					if (_this23.modExists("columnCalcs")) {

						_this23.modules.columnCalcs.recalc(_this23.rowManager.activeRows);
					}

					resolve(rows[0].getComponent());
				}).catch(function (err) {

					reject(err);
				});
			}
		});
	};

	//update row data

	Tabulator.prototype.updateRow = function (index, data) {
		var _this24 = this;

		return new Promise(function (resolve, reject) {

			var row = _this24.rowManager.findRow(index);

			if (typeof data === "string") {

				data = JSON.parse(data);
			}

			if (row) {

				row.updateData(data).then(function () {

					resolve(row.getComponent());
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Update Error - No matching row found:", index);

				reject("Update Error - No matching row found");
			}
		});
	};

	//scroll to row in DOM

	Tabulator.prototype.scrollToRow = function (index, position, ifVisible) {
		var _this25 = this;

		return new Promise(function (resolve, reject) {

			var row = _this25.rowManager.findRow(index);

			if (row) {

				_this25.rowManager.scrollToRow(row, position, ifVisible).then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Scroll Error - No matching row found:", index);

				reject("Scroll Error - No matching row found");
			}
		});
	};

	Tabulator.prototype.moveRow = function (from, to, after) {

		var fromRow = this.rowManager.findRow(from);

		if (fromRow) {

			fromRow.moveToRow(to, after);
		} else {

			console.warn("Move Error - No matching row found:", from);
		}
	};

	Tabulator.prototype.getRows = function (active) {

		if (active === true) {

			console.warn("passing a boolean to the getRows function is deprecated, you should now pass the string 'active'");

			active = "active";
		}

		return this.rowManager.getComponents(active);
	};

	//get position of row in table

	Tabulator.prototype.getRowPosition = function (index, active) {

		var row = this.rowManager.findRow(index);

		if (row) {

			return this.rowManager.getRowPosition(row, active);
		} else {

			console.warn("Position Error - No matching row found:", index);

			return false;
		}
	};

	//copy table data to clipboard

	Tabulator.prototype.copyToClipboard = function (selector) {

		if (this.modExists("clipboard", true)) {

			this.modules.clipboard.copy(selector);
		}
	};

	/////////////// Column Functions  ///////////////


	Tabulator.prototype.setColumns = function (definition) {

		this.columnManager.setColumns(definition);
	};

	Tabulator.prototype.getColumns = function (structured) {

		return this.columnManager.getComponents(structured);
	};

	Tabulator.prototype.getColumn = function (field) {

		var col = this.columnManager.findColumn(field);

		if (col) {

			return col.getComponent();
		} else {

			console.warn("Find Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.getColumnDefinitions = function () {

		return this.columnManager.getDefinitionTree();
	};

	Tabulator.prototype.getColumnLayout = function () {

		if (this.modExists("persistence", true)) {

			return this.modules.persistence.parseColumns(this.columnManager.getColumns());
		}
	};

	Tabulator.prototype.setColumnLayout = function (layout) {

		if (this.modExists("persistence", true)) {

			this.columnManager.setColumns(this.modules.persistence.mergeDefinition(this.options.columns, layout));

			return true;
		}

		return false;
	};

	Tabulator.prototype.showColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			column.show();

			if (this.options.responsiveLayout && this.modExists("responsiveLayout", true)) {

				this.modules.responsiveLayout.update();
			}
		} else {

			console.warn("Column Show Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.hideColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			column.hide();

			if (this.options.responsiveLayout && this.modExists("responsiveLayout", true)) {

				this.modules.responsiveLayout.update();
			}
		} else {

			console.warn("Column Hide Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.toggleColumn = function (field) {

		var column = this.columnManager.findColumn(field);

		if (column) {

			if (column.visible) {

				column.hide();
			} else {

				column.show();
			}
		} else {

			console.warn("Column Visibility Toggle Error - No matching column found:", field);

			return false;
		}
	};

	Tabulator.prototype.addColumn = function (definition, before, field) {
		var _this26 = this;

		return new Promise(function (resolve, reject) {

			var column = _this26.columnManager.findColumn(field);

			_this26.columnManager.addColumn(definition, before, column).then(function (column) {

				resolve(column.getComponent());
			}).catch(function (err) {

				reject(err);
			});
		});
	};

	Tabulator.prototype.deleteColumn = function (field) {
		var _this27 = this;

		return new Promise(function (resolve, reject) {

			var column = _this27.columnManager.findColumn(field);

			if (column) {

				column.delete().then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Delete Error - No matching column found:", field);

				reject();
			}
		});
	};

	Tabulator.prototype.updateColumnDefinition = function (field, definition) {
		var _this28 = this;

		return new Promise(function (resolve, reject) {

			var column = _this28.columnManager.findColumn(field);

			if (column) {

				column.updateDefinition(definition).then(function (col) {

					resolve(col);
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Column Update Error - No matching column found:", field);

				reject();
			}
		});
	};

	Tabulator.prototype.moveColumn = function (from, to, after) {

		var fromColumn = this.columnManager.findColumn(from);

		var toColumn = this.columnManager.findColumn(to);

		if (fromColumn) {

			if (toColumn) {

				this.columnManager.moveColumn(fromColumn, toColumn, after);
			} else {

				console.warn("Move Error - No matching column found:", toColumn);
			}
		} else {

			console.warn("Move Error - No matching column found:", from);
		}
	};

	//scroll to column in DOM

	Tabulator.prototype.scrollToColumn = function (field, position, ifVisible) {
		var _this29 = this;

		return new Promise(function (resolve, reject) {

			var column = _this29.columnManager.findColumn(field);

			if (column) {

				_this29.columnManager.scrollToColumn(column, position, ifVisible).then(function () {

					resolve();
				}).catch(function (err) {

					reject(err);
				});
			} else {

				console.warn("Scroll Error - No matching column found:", field);

				reject("Scroll Error - No matching column found");
			}
		});
	};

	//////////// Localization Functions  ////////////

	Tabulator.prototype.setLocale = function (locale) {

		this.modules.localize.setLocale(locale);
	};

	Tabulator.prototype.getLocale = function () {

		return this.modules.localize.getLocale();
	};

	Tabulator.prototype.getLang = function (locale) {

		return this.modules.localize.getLang(locale);
	};

	//////////// General Public Functions ////////////


	//redraw list without updating data

	Tabulator.prototype.redraw = function (force) {

		this.columnManager.redraw(force);

		this.rowManager.redraw(force);
	};

	Tabulator.prototype.setHeight = function (height) {

		if (this.rowManager.renderMode !== "classic") {

			this.options.height = isNaN(height) ? height : height + "px";

			this.element.style.height = this.options.height;

			this.rowManager.setRenderMode();

			this.rowManager.redraw();
		} else {

			console.warn("setHeight function is not available in classic render mode");
		}
	};

	///////////////////// Sorting ////////////////////


	//trigger sort

	Tabulator.prototype.setSort = function (sortList, dir) {

		if (this.modExists("sort", true)) {

			this.modules.sort.setSort(sortList, dir);

			this.rowManager.sorterRefresh();
		}
	};

	Tabulator.prototype.getSorters = function () {

		if (this.modExists("sort", true)) {

			return this.modules.sort.getSort();
		}
	};

	Tabulator.prototype.clearSort = function () {

		if (this.modExists("sort", true)) {

			this.modules.sort.clear();

			this.rowManager.sorterRefresh();
		}
	};

	///////////////////// Filtering ////////////////////


	//set standard filters

	Tabulator.prototype.setFilter = function (field, type, value) {

		if (this.modExists("filter", true)) {

			this.modules.filter.setFilter(field, type, value);

			this.rowManager.filterRefresh();
		}
	};

	//add filter to array

	Tabulator.prototype.addFilter = function (field, type, value) {

		if (this.modExists("filter", true)) {

			this.modules.filter.addFilter(field, type, value);

			this.rowManager.filterRefresh();
		}
	};

	//get all filters

	Tabulator.prototype.getFilters = function (all) {

		if (this.modExists("filter", true)) {

			return this.modules.filter.getFilters(all);
		}
	};

	Tabulator.prototype.setHeaderFilterFocus = function (field) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				this.modules.filter.setHeaderFilterFocus(column);
			} else {

				console.warn("Column Filter Focus Error - No matching column found:", field);

				return false;
			}
		}
	};

	Tabulator.prototype.getHeaderFilterValue = function (field) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				return this.modules.filter.getHeaderFilterValue(column);
			} else {

				console.warn("Column Filter Error - No matching column found:", field);
			}
		}
	};

	Tabulator.prototype.setHeaderFilterValue = function (field, value) {

		if (this.modExists("filter", true)) {

			var column = this.columnManager.findColumn(field);

			if (column) {

				this.modules.filter.setHeaderFilterValue(column, value);
			} else {

				console.warn("Column Filter Error - No matching column found:", field);

				return false;
			}
		}
	};

	Tabulator.prototype.getHeaderFilters = function () {

		if (this.modExists("filter", true)) {

			return this.modules.filter.getHeaderFilters();
		}
	};

	//remove filter from array

	Tabulator.prototype.removeFilter = function (field, type, value) {

		if (this.modExists("filter", true)) {

			this.modules.filter.removeFilter(field, type, value);

			this.rowManager.filterRefresh();
		}
	};

	//clear filters

	Tabulator.prototype.clearFilter = function (all) {

		if (this.modExists("filter", true)) {

			this.modules.filter.clearFilter(all);

			this.rowManager.filterRefresh();
		}
	};

	//clear header filters

	Tabulator.prototype.clearHeaderFilter = function () {

		if (this.modExists("filter", true)) {

			this.modules.filter.clearHeaderFilter();

			this.rowManager.filterRefresh();
		}
	};

	///////////////////// Filtering ////////////////////

	Tabulator.prototype.selectRow = function (rows) {

		if (this.modExists("selectRow", true)) {

			if (rows === true) {

				console.warn("passing a boolean to the selectRowselectRow function is deprecated, you should now pass the string 'active'");

				rows = "active";
			}

			this.modules.selectRow.selectRows(rows);
		}
	};

	Tabulator.prototype.deselectRow = function (rows) {

		if (this.modExists("selectRow", true)) {

			this.modules.selectRow.deselectRows(rows);
		}
	};

	Tabulator.prototype.toggleSelectRow = function (row) {

		if (this.modExists("selectRow", true)) {

			this.modules.selectRow.toggleRow(row);
		}
	};

	Tabulator.prototype.getSelectedRows = function () {

		if (this.modExists("selectRow", true)) {

			return this.modules.selectRow.getSelectedRows();
		}
	};

	Tabulator.prototype.getSelectedData = function () {

		if (this.modExists("selectRow", true)) {

			return this.modules.selectRow.getSelectedData();
		}
	};

	//////////// Pagination Functions  ////////////


	Tabulator.prototype.setMaxPage = function (max) {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.setMaxPage(max);
		} else {

			return false;
		}
	};

	Tabulator.prototype.setPage = function (page) {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.setPage(page);
		} else {

			return new Promise(function (resolve, reject) {
				reject();
			});
		}
	};

	Tabulator.prototype.setPageToRow = function (row) {
		var _this30 = this;

		return new Promise(function (resolve, reject) {

			if (_this30.options.pagination && _this30.modExists("page")) {

				row = _this30.rowManager.findRow(row);

				if (row) {

					_this30.modules.page.setPageToRow(row).then(function () {

						resolve();
					}).catch(function () {

						reject();
					});
				} else {

					reject();
				}
			} else {

				reject();
			}
		});
	};

	Tabulator.prototype.setPageSize = function (size) {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.setPageSize(size);

			this.modules.page.setPage(1).then(function () {}).catch(function () {});
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPageSize = function () {

		if (this.options.pagination && this.modExists("page", true)) {

			return this.modules.page.getPageSize();
		}
	};

	Tabulator.prototype.previousPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.previousPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.nextPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			this.modules.page.nextPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPage = function () {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.getPage();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getPageMax = function () {

		if (this.options.pagination && this.modExists("page")) {

			return this.modules.page.getPageMax();
		} else {

			return false;
		}
	};

	///////////////// Grouping Functions ///////////////


	Tabulator.prototype.setGroupBy = function (groups) {

		if (this.modExists("groupRows", true)) {

			this.options.groupBy = groups;

			this.modules.groupRows.initialize();

			this.rowManager.refreshActiveData("display");

			if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

				this.modules.persistence.save("group");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.setGroupStartOpen = function (values) {

		if (this.modExists("groupRows", true)) {

			this.options.groupStartOpen = values;

			this.modules.groupRows.initialize();

			if (this.options.groupBy) {

				this.rowManager.refreshActiveData("group");

				if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

					this.modules.persistence.save("group");
				}
			} else {

				console.warn("Grouping Update - cant refresh view, no groups have been set");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.setGroupHeader = function (values) {

		if (this.modExists("groupRows", true)) {

			this.options.groupHeader = values;

			this.modules.groupRows.initialize();

			if (this.options.groupBy) {

				this.rowManager.refreshActiveData("group");

				if (this.options.persistence && this.modExists("persistence", true) && this.modules.persistence.config.group) {

					this.modules.persistence.save("group");
				}
			} else {

				console.warn("Grouping Update - cant refresh view, no groups have been set");
			}
		} else {

			return false;
		}
	};

	Tabulator.prototype.getGroups = function (values) {

		if (this.modExists("groupRows", true)) {

			return this.modules.groupRows.getGroups(true);
		} else {

			return false;
		}
	};

	// get grouped table data in the same format as getData()

	Tabulator.prototype.getGroupedData = function () {

		if (this.modExists("groupRows", true)) {

			return this.options.groupBy ? this.modules.groupRows.getGroupedData() : this.getData();
		}
	};

	///////////////// Column Calculation Functions ///////////////

	Tabulator.prototype.getCalcResults = function () {

		if (this.modExists("columnCalcs", true)) {

			return this.modules.columnCalcs.getResults();
		} else {

			return false;
		}
	};

	Tabulator.prototype.recalc = function () {

		if (this.modExists("columnCalcs", true)) {

			this.modules.columnCalcs.recalcAll(this.rowManager.activeRows);
		}
	};

	/////////////// Navigation Management //////////////


	Tabulator.prototype.navigatePrev = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				return cell.nav().prev();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateNext = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				return cell.nav().next();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateLeft = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().left();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateRight = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().right();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateUp = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().up();
			}
		}

		return false;
	};

	Tabulator.prototype.navigateDown = function () {

		var cell = false;

		if (this.modExists("edit", true)) {

			cell = this.modules.edit.currentCell;

			if (cell) {

				e.preventDefault();

				return cell.nav().down();
			}
		}

		return false;
	};

	/////////////// History Management //////////////

	Tabulator.prototype.undo = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.undo();
		} else {

			return false;
		}
	};

	Tabulator.prototype.redo = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.redo();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getHistoryUndoSize = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.getHistoryUndoSize();
		} else {

			return false;
		}
	};

	Tabulator.prototype.getHistoryRedoSize = function () {

		if (this.options.history && this.modExists("history", true)) {

			return this.modules.history.getHistoryRedoSize();
		} else {

			return false;
		}
	};

	/////////////// Download Management //////////////


	Tabulator.prototype.download = function (type, filename, options, active) {

		if (this.modExists("download", true)) {

			this.modules.download.download(type, filename, options, active);
		}
	};

	Tabulator.prototype.downloadToTab = function (type, filename, options, active) {

		if (this.modExists("download", true)) {

			this.modules.download.download(type, filename, options, active, true);
		}
	};

	/////////// Inter Table Communications ///////////


	Tabulator.prototype.tableComms = function (table, module, action, data) {

		this.modules.comms.receive(table, module, action, data);
	};

	////////////// Extension Management //////////////


	//object to hold module

	Tabulator.prototype.moduleBindings = {};

	//extend module

	Tabulator.prototype.extendModule = function (name, property, values) {

		if (Tabulator.prototype.moduleBindings[name]) {

			var source = Tabulator.prototype.moduleBindings[name].prototype[property];

			if (source) {

				if ((typeof values === 'undefined' ? 'undefined' : _typeof(values)) == "object") {

					for (var key in values) {

						source[key] = values[key];
					}
				} else {

					console.warn("Module Error - Invalid value type, it must be an object");
				}
			} else {

				console.warn("Module Error - property does not exist:", property);
			}
		} else {

			console.warn("Module Error - module does not exist:", name);
		}
	};

	//add module to tabulator

	Tabulator.prototype.registerModule = function (name, module) {

		var self = this;

		Tabulator.prototype.moduleBindings[name] = module;
	};

	//ensure that module are bound to instantiated function

	Tabulator.prototype.bindModules = function () {

		this.modules = {};

		for (var name in Tabulator.prototype.moduleBindings) {

			this.modules[name] = new Tabulator.prototype.moduleBindings[name](this);
		}
	};

	//Check for module

	Tabulator.prototype.modExists = function (plugin, required) {

		if (this.modules[plugin]) {

			return true;
		} else {

			if (required) {

				console.error("Tabulator Module Not Installed: " + plugin);
			}

			return false;
		}
	};

	Tabulator.prototype.helpers = {

		elVisible: function elVisible(el) {

			return !(el.offsetWidth <= 0 && el.offsetHeight <= 0);
		},

		elOffset: function elOffset(el) {

			var box = el.getBoundingClientRect();

			return {

				top: box.top + window.pageYOffset - document.documentElement.clientTop,

				left: box.left + window.pageXOffset - document.documentElement.clientLeft

			};
		},

		deepClone: function deepClone(obj) {

			var clone = Array.isArray(obj) ? [] : {};

			for (var i in obj) {

				if (obj[i] != null && _typeof(obj[i]) === "object") {

					if (obj[i] instanceof Date) {

						clone[i] = new Date(obj[i]);
					} else {

						clone[i] = this.deepClone(obj[i]);
					}
				} else {

					clone[i] = obj[i];
				}
			}

			return clone;
		}

	};

	Tabulator.prototype.comms = {

		tables: [],

		register: function register(table) {

			Tabulator.prototype.comms.tables.push(table);
		},

		deregister: function deregister(table) {

			var index = Tabulator.prototype.comms.tables.indexOf(table);

			if (index > -1) {

				Tabulator.prototype.comms.tables.splice(index, 1);
			}
		},

		lookupTable: function lookupTable(query, silent) {

			var results = [],
			    matches,
			    match;

			if (typeof query === "string") {

				matches = document.querySelectorAll(query);

				if (matches.length) {

					for (var i = 0; i < matches.length; i++) {

						match = Tabulator.prototype.comms.matchElement(matches[i]);

						if (match) {

							results.push(match);
						}
					}
				}
			} else if (typeof HTMLElement !== "undefined" && query instanceof HTMLElement || query instanceof Tabulator) {

				match = Tabulator.prototype.comms.matchElement(query);

				if (match) {

					results.push(match);
				}
			} else if (Array.isArray(query)) {

				query.forEach(function (item) {

					results = results.concat(Tabulator.prototype.comms.lookupTable(item));
				});
			} else {

				if (!silent) {

					console.warn("Table Connection Error - Invalid Selector", query);
				}
			}

			return results;
		},

		matchElement: function matchElement(element) {

			return Tabulator.prototype.comms.tables.find(function (table) {

				return element instanceof Tabulator ? table === element : table.element === element;
			});
		}

	};

	Tabulator.prototype.findTable = function (query) {

		var results = Tabulator.prototype.comms.lookupTable(query, true);

		return Array.isArray(results) && !results.length ? false : results;
	};

	var Layout = function Layout(table) {

		this.table = table;

		this.mode = null;
	};

	//initialize layout system


	Layout.prototype.initialize = function (layout) {

		if (this.modes[layout]) {

			this.mode = layout;
		} else {

			console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : " + layout);

			this.mode = 'fitData';
		}

		this.table.element.setAttribute("tabulator-layout", this.mode);
	};

	Layout.prototype.getMode = function () {

		return this.mode;
	};

	//trigger table layout


	Layout.prototype.layout = function () {

		this.modes[this.mode].call(this, this.table.columnManager.columnsByIndex);
	};

	//layout render functions


	Layout.prototype.modes = {

		//resize columns to fit data the contain


		"fitData": function fitData(columns) {

			columns.forEach(function (column) {

				column.reinitializeWidth();
			});

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}
		},

		//resize columns to fit data the contain and stretch row to fill table


		"fitDataFill": function fitDataFill(columns) {

			columns.forEach(function (column) {

				column.reinitializeWidth();
			});

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}
		},

		//resize columns to fit data the contain and stretch last column to fill table


		"fitDataStretch": function fitDataStretch(columns) {
			var _this31 = this;

			var colsWidth = 0,
			    tableWidth = this.table.rowManager.element.clientWidth,
			    gap = 0,
			    lastCol = false;

			columns.forEach(function (column, i) {

				if (!column.widthFixed) {

					column.reinitializeWidth();
				}

				if (_this31.table.options.responsiveLayout ? column.modules.responsive.visible : column.visible) {

					lastCol = column;
				}

				if (column.visible) {

					colsWidth += column.getWidth();
				}
			});

			if (lastCol) {

				gap = tableWidth - colsWidth + lastCol.getWidth();

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					lastCol.setWidth(0);

					this.table.modules.responsiveLayout.update();
				}

				if (gap > 0) {

					lastCol.setWidth(gap);
				} else {

					lastCol.reinitializeWidth();
				}
			} else {

				if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

					this.table.modules.responsiveLayout.update();
				}
			}
		},

		//resize columns to fit


		"fitColumns": function fitColumns(columns) {

			var self = this;

			var totalWidth = self.table.element.clientWidth; //table element width


			var fixedWidth = 0; //total width of columns with a defined width


			var flexWidth = 0; //total width available to flexible columns


			var flexGrowUnits = 0; //total number of widthGrow blocks accross all columns


			var flexColWidth = 0; //desired width of flexible columns


			var flexColumns = []; //array of flexible width columns


			var fixedShrinkColumns = []; //array of fixed width columns that can shrink


			var flexShrinkUnits = 0; //total number of widthShrink blocks accross all columns


			var overflowWidth = 0; //horizontal overflow width


			var gapFill = 0; //number of pixels to be added to final column to close and half pixel gaps


			function calcWidth(width) {

				var colWidth;

				if (typeof width == "string") {

					if (width.indexOf("%") > -1) {

						colWidth = totalWidth / 100 * parseInt(width);
					} else {

						colWidth = parseInt(width);
					}
				} else {

					colWidth = width;
				}

				return colWidth;
			}

			//ensure columns resize to take up the correct amount of space


			function scaleColumns(columns, freeSpace, colWidth, shrinkCols) {

				var oversizeCols = [],
				    oversizeSpace = 0,
				    remainingSpace = 0,
				    nextColWidth = 0,
				    gap = 0,
				    changeUnits = 0,
				    undersizeCols = [];

				function calcGrow(col) {

					return colWidth * (col.column.definition.widthGrow || 1);
				}

				function calcShrink(col) {

					return calcWidth(col.width) - colWidth * (col.column.definition.widthShrink || 0);
				}

				columns.forEach(function (col, i) {

					var width = shrinkCols ? calcShrink(col) : calcGrow(col);

					if (col.column.minWidth >= width) {

						oversizeCols.push(col);
					} else {

						undersizeCols.push(col);

						changeUnits += shrinkCols ? col.column.definition.widthShrink || 1 : col.column.definition.widthGrow || 1;
					}
				});

				if (oversizeCols.length) {

					oversizeCols.forEach(function (col) {

						oversizeSpace += shrinkCols ? col.width - col.column.minWidth : col.column.minWidth;

						col.width = col.column.minWidth;
					});

					remainingSpace = freeSpace - oversizeSpace;

					nextColWidth = changeUnits ? Math.floor(remainingSpace / changeUnits) : remainingSpace;

					gap = remainingSpace - nextColWidth * changeUnits;

					gap += scaleColumns(undersizeCols, remainingSpace, nextColWidth, shrinkCols);
				} else {

					gap = changeUnits ? freeSpace - Math.floor(freeSpace / changeUnits) * changeUnits : freeSpace;

					undersizeCols.forEach(function (column) {

						column.width = shrinkCols ? calcShrink(column) : calcGrow(column);
					});
				}

				return gap;
			}

			if (this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)) {

				this.table.modules.responsiveLayout.update();
			}

			//adjust for vertical scrollbar if present


			if (this.table.rowManager.element.scrollHeight > this.table.rowManager.element.clientHeight) {

				totalWidth -= this.table.rowManager.element.offsetWidth - this.table.rowManager.element.clientWidth;
			}

			columns.forEach(function (column) {

				var width, minWidth, colWidth;

				if (column.visible) {

					width = column.definition.width;

					minWidth = parseInt(column.minWidth);

					if (width) {

						colWidth = calcWidth(width);

						fixedWidth += colWidth > minWidth ? colWidth : minWidth;

						if (column.definition.widthShrink) {

							fixedShrinkColumns.push({

								column: column,

								width: colWidth > minWidth ? colWidth : minWidth

							});

							flexShrinkUnits += column.definition.widthShrink;
						}
					} else {

						flexColumns.push({

							column: column,

							width: 0

						});

						flexGrowUnits += column.definition.widthGrow || 1;
					}
				}
			});

			//calculate available space


			flexWidth = totalWidth - fixedWidth;

			//calculate correct column size


			flexColWidth = Math.floor(flexWidth / flexGrowUnits);

			//generate column widths


			var gapFill = scaleColumns(flexColumns, flexWidth, flexColWidth, false);

			//increase width of last column to account for rounding errors


			if (flexColumns.length && gapFill > 0) {

				flexColumns[flexColumns.length - 1].width += +gapFill;
			}

			//caculate space for columns to be shrunk into


			flexColumns.forEach(function (col) {

				flexWidth -= col.width;
			});

			overflowWidth = Math.abs(gapFill) + flexWidth;

			//shrink oversize columns if there is no available space


			if (overflowWidth > 0 && flexShrinkUnits) {

				gapFill = scaleColumns(fixedShrinkColumns, overflowWidth, Math.floor(overflowWidth / flexShrinkUnits), true);
			}

			//decrease width of last column to account for rounding errors


			if (fixedShrinkColumns.length) {

				fixedShrinkColumns[fixedShrinkColumns.length - 1].width -= gapFill;
			}

			flexColumns.forEach(function (col) {

				col.column.setWidth(col.width);
			});

			fixedShrinkColumns.forEach(function (col) {

				col.column.setWidth(col.width);
			});
		}

	};

	Tabulator.prototype.registerModule("layout", Layout);

	var Localize = function Localize(table) {

		this.table = table; //hold Tabulator object

		this.locale = "default"; //current locale

		this.lang = false; //current language

		this.bindings = {}; //update events to call when locale is changed
	};

	//set header placehoder

	Localize.prototype.setHeaderFilterPlaceholder = function (placeholder) {

		this.langs.default.headerFilters.default = placeholder;
	};

	//set header filter placeholder by column

	Localize.prototype.setHeaderFilterColumnPlaceholder = function (column, placeholder) {

		this.langs.default.headerFilters.columns[column] = placeholder;

		if (this.lang && !this.lang.headerFilters.columns[column]) {

			this.lang.headerFilters.columns[column] = placeholder;
		}
	};

	//setup a lang description object

	Localize.prototype.installLang = function (locale, lang) {

		if (this.langs[locale]) {

			this._setLangProp(this.langs[locale], lang);
		} else {

			this.langs[locale] = lang;
		}
	};

	Localize.prototype._setLangProp = function (lang, values) {

		for (var key in values) {

			if (lang[key] && _typeof(lang[key]) == "object") {

				this._setLangProp(lang[key], values[key]);
			} else {

				lang[key] = values[key];
			}
		}
	};

	//set current locale

	Localize.prototype.setLocale = function (desiredLocale) {

		var self = this;

		desiredLocale = desiredLocale || "default";

		//fill in any matching languge values

		function traverseLang(trans, path) {

			for (var prop in trans) {

				if (_typeof(trans[prop]) == "object") {

					if (!path[prop]) {

						path[prop] = {};
					}

					traverseLang(trans[prop], path[prop]);
				} else {

					path[prop] = trans[prop];
				}
			}
		}

		//determing correct locale to load

		if (desiredLocale === true && navigator.language) {

			//get local from system

			desiredLocale = navigator.language.toLowerCase();
		}

		if (desiredLocale) {

			//if locale is not set, check for matching top level locale else use default

			if (!self.langs[desiredLocale]) {

				var prefix = desiredLocale.split("-")[0];

				if (self.langs[prefix]) {

					console.warn("Localization Error - Exact matching locale not found, using closest match: ", desiredLocale, prefix);

					desiredLocale = prefix;
				} else {

					console.warn("Localization Error - Matching locale not found, using default: ", desiredLocale);

					desiredLocale = "default";
				}
			}
		}

		self.locale = desiredLocale;

		//load default lang template

		self.lang = Tabulator.prototype.helpers.deepClone(self.langs.default || {});

		if (desiredLocale != "default") {

			traverseLang(self.langs[desiredLocale], self.lang);
		}

		self.table.options.localized.call(self.table, self.locale, self.lang);

		self._executeBindings();
	};

	//get current locale

	Localize.prototype.getLocale = function (locale) {

		return self.locale;
	};

	//get lang object for given local or current if none provided

	Localize.prototype.getLang = function (locale) {

		return locale ? this.langs[locale] : this.lang;
	};

	//get text for current locale

	Localize.prototype.getText = function (path, value) {

		var path = value ? path + "|" + value : path,
		    pathArray = path.split("|"),
		    text = this._getLangElement(pathArray, this.locale);

		// if(text === false){

		// 	console.warn("Localization Error - Matching localized text not found for given path: ", path);

		// }


		return text || "";
	};

	//traverse langs object and find localized copy

	Localize.prototype._getLangElement = function (path, locale) {

		var self = this;

		var root = self.lang;

		path.forEach(function (level) {

			var rootPath;

			if (root) {

				rootPath = root[level];

				if (typeof rootPath != "undefined") {

					root = rootPath;
				} else {

					root = false;
				}
			}
		});

		return root;
	};

	//set update binding

	Localize.prototype.bind = function (path, callback) {

		if (!this.bindings[path]) {

			this.bindings[path] = [];
		}

		this.bindings[path].push(callback);

		callback(this.getText(path), this.lang);
	};

	//itterate through bindings and trigger updates

	Localize.prototype._executeBindings = function () {

		var self = this;

		var _loop = function _loop(path) {

			self.bindings[path].forEach(function (binding) {

				binding(self.getText(path), self.lang);
			});
		};

		for (var path in self.bindings) {
			_loop(path);
		}
	};

	//Localized text listings

	Localize.prototype.langs = {

		"default": { //hold default locale text

			"groups": {

				"item": "item",

				"items": "items"

			},

			"columns": {},

			"ajax": {

				"loading": "Loading",

				"error": "Error"

			},

			"pagination": {

				"page_size": "Page Size",

				"first": "First",

				"first_title": "First Page",

				"last": "Last",

				"last_title": "Last Page",

				"prev": "Prev",

				"prev_title": "Prev Page",

				"next": "Next",

				"next_title": "Next Page"

			},

			"headerFilters": {

				"default": "filter column...",

				"columns": {}

			}

		}

	};

	Tabulator.prototype.registerModule("localize", Localize);

	var Comms = function Comms(table) {

		this.table = table;
	};

	Comms.prototype.getConnections = function (selectors) {

		var self = this,
		    connections = [],
		    connection;

		connection = Tabulator.prototype.comms.lookupTable(selectors);

		connection.forEach(function (con) {

			if (self.table !== con) {

				connections.push(con);
			}
		});

		return connections;
	};

	Comms.prototype.send = function (selectors, module, action, data) {

		var self = this,
		    connections = this.getConnections(selectors);

		connections.forEach(function (connection) {

			connection.tableComms(self.table.element, module, action, data);
		});

		if (!connections.length && selectors) {

			console.warn("Table Connection Error - No tables matching selector found", selectors);
		}
	};

	Comms.prototype.receive = function (table, module, action, data) {

		if (this.table.modExists(module)) {

			return this.table.modules[module].commsReceived(table, action, data);
		} else {

			console.warn("Inter-table Comms Error - no such module:", module);
		}
	};

	Tabulator.prototype.registerModule("comms", Comms);

	var Accessor = function Accessor(table) {
		this.table = table; //hold Tabulator object
		this.allowedTypes = ["", "data", "download", "clipboard", "print", "htmlOutput"]; //list of accessor types
	};

	//initialize column accessor
	Accessor.prototype.initializeColumn = function (column) {
		var self = this,
		    match = false,
		    config = {};

		this.allowedTypes.forEach(function (type) {
			var key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1)),
			    accessor;

			if (column.definition[key]) {
				accessor = self.lookupAccessor(column.definition[key]);

				if (accessor) {
					match = true;

					config[key] = {
						accessor: accessor,
						params: column.definition[key + "Params"] || {}
					};
				}
			}
		});

		if (match) {
			column.modules.accessor = config;
		}
	};

	Accessor.prototype.lookupAccessor = function (value) {
		var accessor = false;

		//set column accessor
		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				if (this.accessors[value]) {
					accessor = this.accessors[value];
				} else {
					console.warn("Accessor Error - No such accessor found, ignoring: ", value);
				}
				break;

			case "function":
				accessor = value;
				break;
		}

		return accessor;
	};

	//apply accessor to row
	Accessor.prototype.transformRow = function (dataIn, type) {
		var self = this,
		    key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1));

		//clone data object with deep copy to isolate internal data from returned result
		var data = Tabulator.prototype.helpers.deepClone(dataIn || {});

		self.table.columnManager.traverse(function (column) {
			var value, accessor, params, component;

			if (column.modules.accessor) {

				accessor = column.modules.accessor[key] || column.modules.accessor.accessor || false;

				if (accessor) {
					value = column.getFieldValue(data);

					if (value != "undefined") {
						component = column.getComponent();
						params = typeof accessor.params === "function" ? accessor.params(value, data, type, component) : accessor.params;
						column.setFieldValue(data, accessor.accessor(value, data, type, params, component));
					}
				}
			}
		});

		return data;
	},

	//default accessors
	Accessor.prototype.accessors = {};

	Tabulator.prototype.registerModule("accessor", Accessor);
	var Ajax = function Ajax(table) {

		this.table = table; //hold Tabulator object
		this.config = false; //hold config object for ajax request
		this.url = ""; //request URL
		this.urlGenerator = false;
		this.params = false; //request parameters

		this.loaderElement = this.createLoaderElement(); //loader message div
		this.msgElement = this.createMsgElement(); //message element
		this.loadingElement = false;
		this.errorElement = false;
		this.loaderPromise = false;

		this.progressiveLoad = false;
		this.loading = false;

		this.requestOrder = 0; //prevent requests comming out of sequence if overridden by another load request
	};

	//initialize setup options
	Ajax.prototype.initialize = function () {
		var template;

		this.loaderElement.appendChild(this.msgElement);

		if (this.table.options.ajaxLoaderLoading) {
			if (typeof this.table.options.ajaxLoaderLoading == "string") {
				template = document.createElement('template');
				template.innerHTML = this.table.options.ajaxLoaderLoading.trim();
				this.loadingElement = template.content.firstChild;
			} else {
				this.loadingElement = this.table.options.ajaxLoaderLoading;
			}
		}

		this.loaderPromise = this.table.options.ajaxRequestFunc || this.defaultLoaderPromise;

		this.urlGenerator = this.table.options.ajaxURLGenerator || this.defaultURLGenerator;

		if (this.table.options.ajaxLoaderError) {
			if (typeof this.table.options.ajaxLoaderError == "string") {
				template = document.createElement('template');
				template.innerHTML = this.table.options.ajaxLoaderError.trim();
				this.errorElement = template.content.firstChild;
			} else {
				this.errorElement = this.table.options.ajaxLoaderError;
			}
		}

		if (this.table.options.ajaxParams) {
			this.setParams(this.table.options.ajaxParams);
		}

		if (this.table.options.ajaxConfig) {
			this.setConfig(this.table.options.ajaxConfig);
		}

		if (this.table.options.ajaxURL) {
			this.setUrl(this.table.options.ajaxURL);
		}

		if (this.table.options.ajaxProgressiveLoad) {
			if (this.table.options.pagination) {
				this.progressiveLoad = false;
				console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time");
			} else {
				if (this.table.modExists("page")) {
					this.progressiveLoad = this.table.options.ajaxProgressiveLoad;
					this.table.modules.page.initializeProgressive(this.progressiveLoad);
				} else {
					console.error("Pagination plugin is required for progressive ajax loading");
				}
			}
		}
	};

	Ajax.prototype.createLoaderElement = function () {
		var el = document.createElement("div");
		el.classList.add("tabulator-loader");
		return el;
	};

	Ajax.prototype.createMsgElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-loader-msg");
		el.setAttribute("role", "alert");

		return el;
	};

	//set ajax params
	Ajax.prototype.setParams = function (params, update) {
		if (update) {
			this.params = this.params || {};

			for (var key in params) {
				this.params[key] = params[key];
			}
		} else {
			this.params = params;
		}
	};

	Ajax.prototype.getParams = function () {
		return this.params || {};
	};

	//load config object
	Ajax.prototype.setConfig = function (config) {
		this._loadDefaultConfig();

		if (typeof config == "string") {
			this.config.method = config;
		} else {
			for (var key in config) {
				this.config[key] = config[key];
			}
		}
	};

	//create config object from default
	Ajax.prototype._loadDefaultConfig = function (force) {
		var self = this;
		if (!self.config || force) {

			self.config = {};

			//load base config from defaults
			for (var key in self.defaultConfig) {
				self.config[key] = self.defaultConfig[key];
			}
		}
	};

	//set request url
	Ajax.prototype.setUrl = function (url) {
		this.url = url;
	};

	//get request url
	Ajax.prototype.getUrl = function () {
		return this.url;
	};

	//lstandard loading function
	Ajax.prototype.loadData = function (inPosition, columnsChanged) {
		var self = this;

		if (this.progressiveLoad) {
			return this._loadDataProgressive();
		} else {
			return this._loadDataStandard(inPosition, columnsChanged);
		}
	};

	Ajax.prototype.nextPage = function (diff) {
		var margin;

		if (!this.loading) {

			margin = this.table.options.ajaxProgressiveLoadScrollMargin || this.table.rowManager.getElement().clientHeight * 2;

			if (diff < margin) {
				this.table.modules.page.nextPage().then(function () {}).catch(function () {});
			}
		}
	};

	Ajax.prototype.blockActiveRequest = function () {
		this.requestOrder++;
	};

	Ajax.prototype._loadDataProgressive = function () {
		this.table.rowManager.setData([]);
		return this.table.modules.page.setPage(1);
	};

	Ajax.prototype._loadDataStandard = function (inPosition, columnsChanged) {
		var _this32 = this;

		return new Promise(function (resolve, reject) {
			_this32.sendRequest(inPosition).then(function (data) {
				_this32.table.rowManager.setData(data, inPosition, columnsChanged).then(function () {
					resolve();
				}).catch(function (e) {
					reject(e);
				});
			}).catch(function (e) {
				reject(e);
			});
		});
	};

	Ajax.prototype.generateParamsList = function (data, prefix) {
		var self = this,
		    output = [];

		prefix = prefix || "";

		if (Array.isArray(data)) {
			data.forEach(function (item, i) {
				output = output.concat(self.generateParamsList(item, prefix ? prefix + "[" + i + "]" : i));
			});
		} else if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) === "object") {
			for (var key in data) {
				output = output.concat(self.generateParamsList(data[key], prefix ? prefix + "[" + key + "]" : key));
			}
		} else {
			output.push({ key: prefix, value: data });
		}

		return output;
	};

	Ajax.prototype.serializeParams = function (params) {
		var output = this.generateParamsList(params),
		    encoded = [];

		output.forEach(function (item) {
			encoded.push(encodeURIComponent(item.key) + "=" + encodeURIComponent(item.value));
		});

		return encoded.join("&");
	};

	//send ajax request
	Ajax.prototype.sendRequest = function (silent) {
		var _this33 = this;

		var self = this,
		    url = self.url,
		    requestNo,
		    esc,
		    query;

		self.requestOrder++;
		requestNo = self.requestOrder;

		self._loadDefaultConfig();

		return new Promise(function (resolve, reject) {
			if (self.table.options.ajaxRequesting.call(_this33.table, self.url, self.params) !== false) {

				self.loading = true;

				if (!silent) {
					self.showLoader();
				}

				_this33.loaderPromise(url, self.config, self.params).then(function (data) {
					if (requestNo === self.requestOrder) {
						if (self.table.options.ajaxResponse) {
							data = self.table.options.ajaxResponse.call(self.table, self.url, self.params, data);
						}
						resolve(data);

						self.hideLoader();
						self.loading = false;
					} else {
						console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made");
					}
				}).catch(function (error) {
					console.error("Ajax Load Error: ", error);
					self.table.options.ajaxError.call(self.table, error);

					self.showError();

					setTimeout(function () {
						self.hideLoader();
					}, 3000);

					self.loading = false;

					reject();
				});
			} else {
				reject();
			}
		});
	};

	Ajax.prototype.showLoader = function () {
		var shouldLoad = typeof this.table.options.ajaxLoader === "function" ? this.table.options.ajaxLoader() : this.table.options.ajaxLoader;

		if (shouldLoad) {

			this.hideLoader();

			while (this.msgElement.firstChild) {
				this.msgElement.removeChild(this.msgElement.firstChild);
			}this.msgElement.classList.remove("tabulator-error");
			this.msgElement.classList.add("tabulator-loading");

			if (this.loadingElement) {
				this.msgElement.appendChild(this.loadingElement);
			} else {
				this.msgElement.innerHTML = this.table.modules.localize.getText("ajax|loading");
			}

			this.table.element.appendChild(this.loaderElement);
		}
	};

	Ajax.prototype.showError = function () {
		this.hideLoader();

		while (this.msgElement.firstChild) {
			this.msgElement.removeChild(this.msgElement.firstChild);
		}this.msgElement.classList.remove("tabulator-loading");
		this.msgElement.classList.add("tabulator-error");

		if (this.errorElement) {
			this.msgElement.appendChild(this.errorElement);
		} else {
			this.msgElement.innerHTML = this.table.modules.localize.getText("ajax|error");
		}

		this.table.element.appendChild(this.loaderElement);
	};

	Ajax.prototype.hideLoader = function () {
		if (this.loaderElement.parentNode) {
			this.loaderElement.parentNode.removeChild(this.loaderElement);
		}
	};

	//default ajax config object
	Ajax.prototype.defaultConfig = {
		method: "GET"
	};

	Ajax.prototype.defaultURLGenerator = function (url, config, params) {

		if (url) {
			if (params && Object.keys(params).length) {
				if (!config.method || config.method.toLowerCase() == "get") {
					config.method = "get";

					url += (url.includes("?") ? "&" : "?") + this.serializeParams(params);
				}
			}
		}

		return url;
	};

	Ajax.prototype.defaultLoaderPromise = function (url, config, params) {
		var self = this,
		    contentType;

		return new Promise(function (resolve, reject) {

			//set url
			url = self.urlGenerator(url, config, params);

			//set body content if not GET request
			if (config.method.toUpperCase() != "GET") {
				contentType = _typeof(self.table.options.ajaxContentType) === "object" ? self.table.options.ajaxContentType : self.contentTypeFormatters[self.table.options.ajaxContentType];
				if (contentType) {

					for (var key in contentType.headers) {
						if (!config.headers) {
							config.headers = {};
						}

						if (typeof config.headers[key] === "undefined") {
							config.headers[key] = contentType.headers[key];
						}
					}

					config.body = contentType.body.call(self, url, config, params);
				} else {
					console.warn("Ajax Error - Invalid ajaxContentType value:", self.table.options.ajaxContentType);
				}
			}

			if (url) {

				//configure headers
				if (typeof config.headers === "undefined") {
					config.headers = {};
				}

				if (typeof config.headers.Accept === "undefined") {
					config.headers.Accept = "application/json";
				}

				if (typeof config.headers["X-Requested-With"] === "undefined") {
					config.headers["X-Requested-With"] = "XMLHttpRequest";
				}

				if (typeof config.mode === "undefined") {
					config.mode = "cors";
				}

				if (config.mode == "cors") {

					if (typeof config.headers["Access-Control-Allow-Origin"] === "undefined") {
						config.headers["Access-Control-Allow-Origin"] = window.location.origin;
					}

					if (typeof config.credentials === "undefined") {
						config.credentials = 'same-origin';
					}
				} else {
					if (typeof config.credentials === "undefined") {
						config.credentials = 'include';
					}
				}

				//send request
				fetch(url, config).then(function (response) {
					if (response.ok) {
						response.json().then(function (data) {
							resolve(data);
						}).catch(function (error) {
							reject(error);
							console.warn("Ajax Load Error - Invalid JSON returned", error);
						});
					} else {
						console.error("Ajax Load Error - Connection Error: " + response.status, response.statusText);
						reject(response);
					}
				}).catch(function (error) {
					console.error("Ajax Load Error - Connection Error: ", error);
					reject(error);
				});
			} else {
				console.warn("Ajax Load Error - No URL Set");
				resolve([]);
			}
		});
	};

	Ajax.prototype.contentTypeFormatters = {
		"json": {
			headers: {
				'Content-Type': 'application/json'
			},
			body: function body(url, config, params) {
				return JSON.stringify(params);
			}
		},
		"form": {
			headers: {},
			body: function body(url, config, params) {
				var output = this.generateParamsList(params),
				    form = new FormData();

				output.forEach(function (item) {
					form.append(item.key, item.value);
				});

				return form;
			}
		}
	};

	Tabulator.prototype.registerModule("ajax", Ajax);

	var ColumnCalcs = function ColumnCalcs(table) {
		this.table = table; //hold Tabulator object
		this.topCalcs = [];
		this.botCalcs = [];
		this.genColumn = false;
		this.topElement = this.createElement();
		this.botElement = this.createElement();
		this.topRow = false;
		this.botRow = false;
		this.topInitialized = false;
		this.botInitialized = false;

		this.initialize();
	};

	ColumnCalcs.prototype.createElement = function () {
		var el = document.createElement("div");
		el.classList.add("tabulator-calcs-holder");
		return el;
	};

	ColumnCalcs.prototype.initialize = function () {
		this.genColumn = new Column({ field: "value" }, this);
	};

	//dummy functions to handle being mock column manager
	ColumnCalcs.prototype.registerColumnField = function () {};

	//initialize column calcs
	ColumnCalcs.prototype.initializeColumn = function (column) {
		var def = column.definition;

		var config = {
			topCalcParams: def.topCalcParams || {},
			botCalcParams: def.bottomCalcParams || {}
		};

		if (def.topCalc) {

			switch (_typeof(def.topCalc)) {
				case "string":
					if (this.calculations[def.topCalc]) {
						config.topCalc = this.calculations[def.topCalc];
					} else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.topCalc);
					}
					break;

				case "function":
					config.topCalc = def.topCalc;
					break;

			}

			if (config.topCalc) {
				column.modules.columnCalcs = config;
				this.topCalcs.push(column);

				if (this.table.options.columnCalcs != "group") {
					this.initializeTopRow();
				}
			}
		}

		if (def.bottomCalc) {
			switch (_typeof(def.bottomCalc)) {
				case "string":
					if (this.calculations[def.bottomCalc]) {
						config.botCalc = this.calculations[def.bottomCalc];
					} else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.bottomCalc);
					}
					break;

				case "function":
					config.botCalc = def.bottomCalc;
					break;

			}

			if (config.botCalc) {
				column.modules.columnCalcs = config;
				this.botCalcs.push(column);

				if (this.table.options.columnCalcs != "group") {
					this.initializeBottomRow();
				}
			}
		}
	};

	ColumnCalcs.prototype.removeCalcs = function () {
		var changed = false;

		if (this.topInitialized) {
			this.topInitialized = false;
			this.topElement.parentNode.removeChild(this.topElement);
			changed = true;
		}

		if (this.botInitialized) {
			this.botInitialized = false;
			this.table.footerManager.remove(this.botElement);
			changed = true;
		}

		if (changed) {
			this.table.rowManager.adjustTableSize();
		}
	};

	ColumnCalcs.prototype.initializeTopRow = function () {
		if (!this.topInitialized) {
			// this.table.columnManager.headersElement.after(this.topElement);
			this.table.columnManager.getElement().insertBefore(this.topElement, this.table.columnManager.headersElement.nextSibling);
			this.topInitialized = true;
		}
	};

	ColumnCalcs.prototype.initializeBottomRow = function () {
		if (!this.botInitialized) {
			this.table.footerManager.prepend(this.botElement);
			this.botInitialized = true;
		}
	};

	ColumnCalcs.prototype.scrollHorizontal = function (left) {
		var hozAdjust = 0,
		    scrollWidth = this.table.columnManager.getElement().scrollWidth - this.table.element.clientWidth;

		if (this.botInitialized) {
			this.botRow.getElement().style.marginLeft = -left + "px";
		}
	};

	ColumnCalcs.prototype.recalc = function (rows) {
		var data, row;

		if (this.topInitialized || this.botInitialized) {
			data = this.rowsToData(rows);

			if (this.topInitialized) {
				if (this.topRow) {
					this.topRow.deleteCells();
				}

				row = this.generateRow("top", this.rowsToData(rows));
				this.topRow = row;
				while (this.topElement.firstChild) {
					this.topElement.removeChild(this.topElement.firstChild);
				}this.topElement.appendChild(row.getElement());
				row.initialize(true);
			}

			if (this.botInitialized) {
				if (this.botRow) {
					this.botRow.deleteCells();
				}

				row = this.generateRow("bottom", this.rowsToData(rows));
				this.botRow = row;
				while (this.botElement.firstChild) {
					this.botElement.removeChild(this.botElement.firstChild);
				}this.botElement.appendChild(row.getElement());
				row.initialize(true);
			}

			this.table.rowManager.adjustTableSize();

			//set resizable handles
			if (this.table.modExists("frozenColumns")) {
				this.table.modules.frozenColumns.layout();
			}
		}
	};

	ColumnCalcs.prototype.recalcRowGroup = function (row) {
		this.recalcGroup(this.table.modules.groupRows.getRowGroup(row));
	};

	ColumnCalcs.prototype.recalcAll = function () {
		var _this34 = this;

		if (this.topCalcs.length || this.botCalcs.length) {
			if (this.table.options.columnCalcs !== "group") {
				this.recalc(this.table.rowManager.activeRows);
			}

			if (this.table.options.groupBy && this.table.options.columnCalcs !== "table") {

				var groups = table.modules.groupRows.getChildGroups();

				groups.forEach(function (group) {
					_this34.recalcGroup(group);
				});
			}
		}
	};

	ColumnCalcs.prototype.recalcGroup = function (group) {
		var data, rowData;

		if (group) {
			if (group.calcs) {
				if (group.calcs.bottom) {
					data = this.rowsToData(group.rows);
					rowData = this.generateRowData("bottom", data);

					group.calcs.bottom.updateData(rowData);
					group.calcs.bottom.reinitialize();
				}

				if (group.calcs.top) {
					data = this.rowsToData(group.rows);
					rowData = this.generateRowData("top", data);

					group.calcs.top.updateData(rowData);
					group.calcs.top.reinitialize();
				}
			}
		}
	};

	//generate top stats row
	ColumnCalcs.prototype.generateTopRow = function (rows) {
		return this.generateRow("top", this.rowsToData(rows));
	};
	//generate bottom stats row
	ColumnCalcs.prototype.generateBottomRow = function (rows) {
		return this.generateRow("bottom", this.rowsToData(rows));
	};

	ColumnCalcs.prototype.rowsToData = function (rows) {
		var _this35 = this;

		var data = [];

		rows.forEach(function (row) {
			data.push(row.getData());

			if (_this35.table.options.dataTree && _this35.table.options.dataTreeChildColumnCalcs) {
				if (row.modules.dataTree.open) {
					var children = _this35.rowsToData(_this35.table.modules.dataTree.getFilteredTreeChildren(row));
					data = data.concat(children);
				}
			}
		});

		return data;
	};

	//generate stats row
	ColumnCalcs.prototype.generateRow = function (pos, data) {
		var self = this,
		    rowData = this.generateRowData(pos, data),
		    row;

		if (self.table.modExists("mutator")) {
			self.table.modules.mutator.disable();
		}

		row = new Row(rowData, this, "calc");

		if (self.table.modExists("mutator")) {
			self.table.modules.mutator.enable();
		}

		row.getElement().classList.add("tabulator-calcs", "tabulator-calcs-" + pos);

		row.generateCells = function () {

			var cells = [];

			self.table.columnManager.columnsByIndex.forEach(function (column) {

				//set field name of mock column
				self.genColumn.setField(column.getField());
				self.genColumn.hozAlign = column.hozAlign;

				if (column.definition[pos + "CalcFormatter"] && self.table.modExists("format")) {

					self.genColumn.modules.format = {
						formatter: self.table.modules.format.getFormatter(column.definition[pos + "CalcFormatter"]),
						params: column.definition[pos + "CalcFormatterParams"]
					};
				} else {
					self.genColumn.modules.format = {
						formatter: self.table.modules.format.getFormatter("plaintext"),
						params: {}
					};
				}

				//ensure css class defintion is replicated to calculation cell
				self.genColumn.definition.cssClass = column.definition.cssClass;

				//generate cell and assign to correct column
				var cell = new Cell(self.genColumn, row);
				cell.column = column;
				cell.setWidth();

				column.cells.push(cell);
				cells.push(cell);

				if (!column.visible) {
					cell.hide();
				}
			});

			this.cells = cells;
		};

		return row;
	};

	//generate stats row
	ColumnCalcs.prototype.generateRowData = function (pos, data) {
		var rowData = {},
		    calcs = pos == "top" ? this.topCalcs : this.botCalcs,
		    type = pos == "top" ? "topCalc" : "botCalc",
		    params,
		    paramKey;

		calcs.forEach(function (column) {
			var values = [];

			if (column.modules.columnCalcs && column.modules.columnCalcs[type]) {
				data.forEach(function (item) {
					values.push(column.getFieldValue(item));
				});

				paramKey = type + "Params";
				params = typeof column.modules.columnCalcs[paramKey] === "function" ? column.modules.columnCalcs[paramKey](values, data) : column.modules.columnCalcs[paramKey];

				column.setFieldValue(rowData, column.modules.columnCalcs[type](values, data, params));
			}
		});

		return rowData;
	};

	ColumnCalcs.prototype.hasTopCalcs = function () {
		return !!this.topCalcs.length;
	};

	ColumnCalcs.prototype.hasBottomCalcs = function () {
		return !!this.botCalcs.length;
	};

	//handle table redraw
	ColumnCalcs.prototype.redraw = function () {
		if (this.topRow) {
			this.topRow.normalizeHeight(true);
		}
		if (this.botRow) {
			this.botRow.normalizeHeight(true);
		}
	};

	//return the calculated
	ColumnCalcs.prototype.getResults = function () {
		var self = this,
		    results = {},
		    groups;

		if (this.table.options.groupBy && this.table.modExists("groupRows")) {
			groups = this.table.modules.groupRows.getGroups(true);

			groups.forEach(function (group) {
				results[group.getKey()] = self.getGroupResults(group);
			});
		} else {
			results = {
				top: this.topRow ? this.topRow.getData() : {},
				bottom: this.botRow ? this.botRow.getData() : {}
			};
		}

		return results;
	};

	//get results from a group
	ColumnCalcs.prototype.getGroupResults = function (group) {
		var self = this,
		    groupObj = group._getSelf(),
		    subGroups = group.getSubGroups(),
		    subGroupResults = {},
		    results = {};

		subGroups.forEach(function (subgroup) {
			subGroupResults[subgroup.getKey()] = self.getGroupResults(subgroup);
		});

		results = {
			top: groupObj.calcs.top ? groupObj.calcs.top.getData() : {},
			bottom: groupObj.calcs.bottom ? groupObj.calcs.bottom.getData() : {},
			groups: subGroupResults
		};

		return results;
	};

	//default calculations
	ColumnCalcs.prototype.calculations = {
		"avg": function avg(values, data, calcParams) {
			var output = 0,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : 2;

			if (values.length) {
				output = values.reduce(function (sum, value) {
					value = Number(value);
					return sum + value;
				});

				output = output / values.length;

				output = precision !== false ? output.toFixed(precision) : output;
			}

			return parseFloat(output).toString();
		},
		"max": function max(values, data, calcParams) {
			var output = null,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			values.forEach(function (value) {

				value = Number(value);

				if (value > output || output === null) {
					output = value;
				}
			});

			return output !== null ? precision !== false ? output.toFixed(precision) : output : "";
		},
		"min": function min(values, data, calcParams) {
			var output = null,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			values.forEach(function (value) {

				value = Number(value);

				if (value < output || output === null) {
					output = value;
				}
			});

			return output !== null ? precision !== false ? output.toFixed(precision) : output : "";
		},
		"sum": function sum(values, data, calcParams) {
			var output = 0,
			    precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

			if (values.length) {
				values.forEach(function (value) {
					value = Number(value);

					output += !isNaN(value) ? Number(value) : 0;
				});
			}

			return precision !== false ? output.toFixed(precision) : output;
		},
		"concat": function concat(values, data, calcParams) {
			var output = 0;

			if (values.length) {
				output = values.reduce(function (sum, value) {
					return String(sum) + String(value);
				});
			}

			return output;
		},
		"count": function count(values, data, calcParams) {
			var output = 0;

			if (values.length) {
				values.forEach(function (value) {
					if (value) {
						output++;
					}
				});
			}

			return output;
		}
	};

	Tabulator.prototype.registerModule("columnCalcs", ColumnCalcs);

	var Clipboard = function Clipboard(table) {
		this.table = table;
		this.mode = true;

		this.pasteParser = function () {};
		this.pasteAction = function () {};
		this.customSelection = false;
		this.rowRange = false;
		this.blocked = true; //block copy actions not originating from this command
	};

	Clipboard.prototype.initialize = function () {
		var _this36 = this;

		this.mode = this.table.options.clipboard;

		this.rowRange = this.table.options.clipboardCopyRowRange;

		if (this.mode === true || this.mode === "copy") {
			this.table.element.addEventListener("copy", function (e) {
				var plain, html;

				if (!_this36.blocked) {
					e.preventDefault();

					if (_this36.customSelection) {
						plain = _this36.customSelection;

						if (_this36.table.options.clipboardCopyFormatter) {
							plain = _this36.table.options.clipboardCopyFormatter("plain", plain);
						}
					} else {
						html = _this36.table.modules.export.getHtml(_this36.rowRange, _this36.table.options.clipboardCopyStyled, _this36.table.options.clipboardCopyConfig, "clipboard");
						plain = html ? _this36.generatePlainContent(html) : "";

						if (_this36.table.options.clipboardCopyFormatter) {
							plain = _this36.table.options.clipboardCopyFormatter("plain", plain);
							html = _this36.table.options.clipboardCopyFormatter("html", html);
						}
					}

					if (window.clipboardData && window.clipboardData.setData) {
						window.clipboardData.setData('Text', plain);
					} else if (e.clipboardData && e.clipboardData.setData) {
						e.clipboardData.setData('text/plain', plain);
						if (html) {
							e.clipboardData.setData('text/html', html);
						}
					} else if (e.originalEvent && e.originalEvent.clipboardData.setData) {
						e.originalEvent.clipboardData.setData('text/plain', plain);
						if (html) {
							e.originalEvent.clipboardData.setData('text/html', html);
						}
					}

					_this36.table.options.clipboardCopied.call(_this36.table, plain, html);

					_this36.reset();
				}
			});
		}

		if (this.mode === true || this.mode === "paste") {
			this.table.element.addEventListener("paste", function (e) {
				_this36.paste(e);
			});
		}

		this.setPasteParser(this.table.options.clipboardPasteParser);
		this.setPasteAction(this.table.options.clipboardPasteAction);
	};

	Clipboard.prototype.reset = function () {
		this.blocked = false;
		this.originalSelectionText = "";
	};

	Clipboard.prototype.generatePlainContent = function (html) {
		var output = [];

		var holder = document.createElement("div");
		holder.innerHTML = html;

		var table = holder.getElementsByTagName("table")[0];
		var rows = Array.prototype.slice.call(table.getElementsByTagName("tr"));

		rows.forEach(function (row) {
			var rowData = [];

			var headers = Array.prototype.slice.call(row.getElementsByTagName("th"));
			var cells = Array.prototype.slice.call(row.getElementsByTagName("td"));

			cells = cells.concat(headers);

			cells.forEach(function (cell) {
				var val = cell.innerHTML;

				val = val == "&nbsp;" ? "" : val;

				rowData.push(val);
			});

			output.push(rowData.join("\t"));
		});

		return output.join("\n");
	};

	Clipboard.prototype.copy = function (range, internal) {
		var range, sel, textRange;
		this.blocked = false;
		this.customSelection = false;

		if (this.mode === true || this.mode === "copy") {

			this.rowRange = range || this.table.options.clipboardCopyRowRange;

			if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
				range = document.createRange();
				range.selectNodeContents(this.table.element);
				sel = window.getSelection();

				if (sel.toString() && internal) {
					this.customSelection = sel.toString();
				}

				sel.removeAllRanges();
				sel.addRange(range);
			} else if (typeof document.selection != "undefined" && typeof document.body.createTextRange != "undefined") {
				textRange = document.body.createTextRange();
				textRange.moveToElementText(this.table.element);
				textRange.select();
			}

			document.execCommand('copy');

			if (sel) {
				sel.removeAllRanges();
			}
		}
	};

	//PASTE EVENT HANDLING

	Clipboard.prototype.setPasteAction = function (action) {

		switch (typeof action === 'undefined' ? 'undefined' : _typeof(action)) {
			case "string":
				this.pasteAction = this.pasteActions[action];

				if (!this.pasteAction) {
					console.warn("Clipboard Error - No such paste action found:", action);
				}
				break;

			case "function":
				this.pasteAction = action;
				break;
		}
	};

	Clipboard.prototype.setPasteParser = function (parser) {
		switch (typeof parser === 'undefined' ? 'undefined' : _typeof(parser)) {
			case "string":
				this.pasteParser = this.pasteParsers[parser];

				if (!this.pasteParser) {
					console.warn("Clipboard Error - No such paste parser found:", parser);
				}
				break;

			case "function":
				this.pasteParser = parser;
				break;
		}
	};

	Clipboard.prototype.paste = function (e) {
		var data, rowData, rows;

		if (this.checkPaseOrigin(e)) {

			data = this.getPasteData(e);

			rowData = this.pasteParser.call(this, data);

			if (rowData) {
				e.preventDefault();

				if (this.table.modExists("mutator")) {
					rowData = this.mutateData(rowData);
				}

				rows = this.pasteAction.call(this, rowData);
				this.table.options.clipboardPasted.call(this.table, data, rowData, rows);
			} else {
				this.table.options.clipboardPasteError.call(this.table, data);
			}
		}
	};

	Clipboard.prototype.mutateData = function (data) {
		var self = this,
		    output = [];

		if (Array.isArray(data)) {
			data.forEach(function (row) {
				output.push(self.table.modules.mutator.transformRow(row, "clipboard"));
			});
		} else {
			output = data;
		}

		return output;
	};

	Clipboard.prototype.checkPaseOrigin = function (e) {
		var valid = true;

		if (e.target.tagName != "DIV" || this.table.modules.edit.currentCell) {
			valid = false;
		}

		return valid;
	};

	Clipboard.prototype.getPasteData = function (e) {
		var data;

		if (window.clipboardData && window.clipboardData.getData) {
			data = window.clipboardData.getData('Text');
		} else if (e.clipboardData && e.clipboardData.getData) {
			data = e.clipboardData.getData('text/plain');
		} else if (e.originalEvent && e.originalEvent.clipboardData.getData) {
			data = e.originalEvent.clipboardData.getData('text/plain');
		}

		return data;
	};

	Clipboard.prototype.pasteParsers = {
		table: function table(clipboard) {
			var data = [],
			    success = false,
			    headerFindSuccess = true,
			    columns = this.table.columnManager.columns,
			    columnMap = [],
			    rows = [];

			//get data from clipboard into array of columns and rows.
			clipboard = clipboard.split("\n");

			clipboard.forEach(function (row) {
				data.push(row.split("\t"));
			});

			if (data.length && !(data.length === 1 && data[0].length < 2)) {
				success = true;

				//check if headers are present by title
				data[0].forEach(function (value) {
					var column = columns.find(function (column) {
						return value && column.definition.title && value.trim() && column.definition.title.trim() === value.trim();
					});

					if (column) {
						columnMap.push(column);
					} else {
						headerFindSuccess = false;
					}
				});

				//check if column headers are present by field
				if (!headerFindSuccess) {
					headerFindSuccess = true;
					columnMap = [];

					data[0].forEach(function (value) {
						var column = columns.find(function (column) {
							return value && column.field && value.trim() && column.field.trim() === value.trim();
						});

						if (column) {
							columnMap.push(column);
						} else {
							headerFindSuccess = false;
						}
					});

					if (!headerFindSuccess) {
						columnMap = this.table.columnManager.columnsByIndex;
					}
				}

				//remove header row if found
				if (headerFindSuccess) {
					data.shift();
				}

				data.forEach(function (item) {
					var row = {};

					item.forEach(function (value, i) {
						if (columnMap[i]) {
							row[columnMap[i].field] = value;
						}
					});

					rows.push(row);
				});

				return rows;
			} else {
				return false;
			}
		}
	};

	Clipboard.prototype.pasteActions = {
		replace: function replace(rows) {
			return this.table.setData(rows);
		},
		update: function update(rows) {
			return this.table.updateOrAddData(rows);
		},
		insert: function insert(rows) {
			return this.table.addData(rows);
		}
	};

	Tabulator.prototype.registerModule("clipboard", Clipboard);

	var DataTree = function DataTree(table) {
		this.table = table;
		this.indent = 10;
		this.field = "";
		this.collapseEl = null;
		this.expandEl = null;
		this.branchEl = null;
		this.elementField = false;

		this.startOpen = function () {};

		this.displayIndex = 0;
	};

	DataTree.prototype.initialize = function () {
		var dummyEl = null,
		    firstCol = this.table.columnManager.getFirstVisibileColumn(),
		    options = this.table.options;

		this.field = options.dataTreeChildField;
		this.indent = options.dataTreeChildIndent;
		this.elementField = options.dataTreeElementColumn || (firstCol ? firstCol.field : false);

		if (options.dataTreeBranchElement) {

			if (options.dataTreeBranchElement === true) {
				this.branchEl = document.createElement("div");
				this.branchEl.classList.add("tabulator-data-tree-branch");
			} else {
				if (typeof options.dataTreeBranchElement === "string") {
					dummyEl = document.createElement("div");
					dummyEl.innerHTML = options.dataTreeBranchElement;
					this.branchEl = dummyEl.firstChild;
				} else {
					this.branchEl = options.dataTreeBranchElement;
				}
			}
		}

		if (options.dataTreeCollapseElement) {
			if (typeof options.dataTreeCollapseElement === "string") {
				dummyEl = document.createElement("div");
				dummyEl.innerHTML = options.dataTreeCollapseElement;
				this.collapseEl = dummyEl.firstChild;
			} else {
				this.collapseEl = options.dataTreeCollapseElement;
			}
		} else {
			this.collapseEl = document.createElement("div");
			this.collapseEl.classList.add("tabulator-data-tree-control");
			this.collapseEl.tabIndex = 0;
			this.collapseEl.innerHTML = "<div class='tabulator-data-tree-control-collapse'></div>";
		}

		if (options.dataTreeExpandElement) {
			if (typeof options.dataTreeExpandElement === "string") {
				dummyEl = document.createElement("div");
				dummyEl.innerHTML = options.dataTreeExpandElement;
				this.expandEl = dummyEl.firstChild;
			} else {
				this.expandEl = options.dataTreeExpandElement;
			}
		} else {
			this.expandEl = document.createElement("div");
			this.expandEl.classList.add("tabulator-data-tree-control");
			this.expandEl.tabIndex = 0;
			this.expandEl.innerHTML = "<div class='tabulator-data-tree-control-expand'></div>";
		}

		switch (_typeof(options.dataTreeStartExpanded)) {
			case "boolean":
				this.startOpen = function (row, index) {
					return options.dataTreeStartExpanded;
				};
				break;

			case "function":
				this.startOpen = options.dataTreeStartExpanded;
				break;

			default:
				this.startOpen = function (row, index) {
					return options.dataTreeStartExpanded[index];
				};
				break;
		}
	};

	DataTree.prototype.initializeRow = function (row) {
		var childArray = row.getData()[this.field];
		var isArray = Array.isArray(childArray);

		var children = isArray || !isArray && (typeof childArray === 'undefined' ? 'undefined' : _typeof(childArray)) === "object" && childArray !== null;

		if (!children && row.modules.dataTree && row.modules.dataTree.branchEl) {
			row.modules.dataTree.branchEl.parentNode.removeChild(row.modules.dataTree.branchEl);
		}

		if (!children && row.modules.dataTree && row.modules.dataTree.controlEl) {
			row.modules.dataTree.controlEl.parentNode.removeChild(row.modules.dataTree.controlEl);
		}

		row.modules.dataTree = {
			index: 0,
			open: children ? row.modules.dataTree ? row.modules.dataTree.open : this.startOpen(row.getComponent(), 0) : false,
			controlEl: row.modules.dataTree && children ? row.modules.dataTree.controlEl : false,
			branchEl: row.modules.dataTree && children ? row.modules.dataTree.branchEl : false,
			parent: false,
			children: children
		};
	};

	DataTree.prototype.layoutRow = function (row) {
		var cell = this.elementField ? row.getCell(this.elementField) : row.getCells()[0],
		    el = cell.getElement(),
		    config = row.modules.dataTree;

		if (config.branchEl) {
			config.branchEl.parentNode.removeChild(config.branchEl);
			config.branchEl = false;
		}

		if (config.controlEl) {
			config.controlEl.parentNode.removeChild(config.controlEl);
			config.controlEl = false;
		}

		this.generateControlElement(row, el);

		row.element.classList.add("tabulator-tree-level-" + config.index);

		if (config.index) {
			if (this.branchEl) {
				config.branchEl = this.branchEl.cloneNode(true);
				el.insertBefore(config.branchEl, el.firstChild);
				config.branchEl.style.marginLeft = (config.branchEl.offsetWidth + config.branchEl.style.marginRight) * (config.index - 1) + config.index * this.indent + "px";
			} else {
				el.style.paddingLeft = parseInt(window.getComputedStyle(el, null).getPropertyValue('padding-left')) + config.index * this.indent + "px";
			}
		}
	};

	DataTree.prototype.generateControlElement = function (row, el) {
		var _this37 = this;

		var config = row.modules.dataTree,
		    el = el || row.getCells()[0].getElement(),
		    oldControl = config.controlEl;

		if (config.children !== false) {

			if (config.open) {
				config.controlEl = this.collapseEl.cloneNode(true);
				config.controlEl.addEventListener("click", function (e) {
					e.stopPropagation();
					_this37.collapseRow(row);
				});
			} else {
				config.controlEl = this.expandEl.cloneNode(true);
				config.controlEl.addEventListener("click", function (e) {
					e.stopPropagation();
					_this37.expandRow(row);
				});
			}

			config.controlEl.addEventListener("mousedown", function (e) {
				e.stopPropagation();
			});

			if (oldControl && oldControl.parentNode === el) {
				oldControl.parentNode.replaceChild(config.controlEl, oldControl);
			} else {
				el.insertBefore(config.controlEl, el.firstChild);
			}
		}
	};

	DataTree.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	DataTree.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	DataTree.prototype.getRows = function (rows) {
		var _this38 = this;

		var output = [];

		rows.forEach(function (row, i) {
			var config, children;

			output.push(row);

			if (row instanceof Row) {

				config = row.modules.dataTree.children;

				if (!config.index && config.children !== false) {
					children = _this38.getChildren(row);

					children.forEach(function (child) {
						output.push(child);
					});
				}
			}
		});

		return output;
	};

	DataTree.prototype.getChildren = function (row) {
		var _this39 = this;

		var config = row.modules.dataTree,
		    children = [],
		    output = [];

		if (config.children !== false && config.open) {
			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			if (this.table.modExists("filter")) {
				children = this.table.modules.filter.filter(config.children);
			} else {
				children = config.children;
			}

			if (this.table.modExists("sort")) {
				this.table.modules.sort.sort(children);
			}

			children.forEach(function (child) {
				output.push(child);

				var subChildren = _this39.getChildren(child);

				subChildren.forEach(function (sub) {
					output.push(sub);
				});
			});
		}

		return output;
	};

	DataTree.prototype.generateChildren = function (row) {
		var _this40 = this;

		var children = [];

		var childArray = row.getData()[this.field];

		if (!Array.isArray(childArray)) {
			childArray = [childArray];
		}

		childArray.forEach(function (childData) {
			var childRow = new Row(childData || {}, _this40.table.rowManager);
			childRow.modules.dataTree.index = row.modules.dataTree.index + 1;
			childRow.modules.dataTree.parent = row;
			if (childRow.modules.dataTree.children) {
				childRow.modules.dataTree.open = _this40.startOpen(childRow.getComponent(), childRow.modules.dataTree.index);
			}
			children.push(childRow);
		});

		return children;
	};

	DataTree.prototype.expandRow = function (row, silent) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			config.open = true;

			row.reinitialize();

			this.table.rowManager.refreshActiveData("tree", false, true);

			this.table.options.dataTreeRowExpanded(row.getComponent(), row.modules.dataTree.index);
		}
	};

	DataTree.prototype.collapseRow = function (row) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			config.open = false;

			row.reinitialize();

			this.table.rowManager.refreshActiveData("tree", false, true);

			this.table.options.dataTreeRowCollapsed(row.getComponent(), row.modules.dataTree.index);
		}
	};

	DataTree.prototype.toggleRow = function (row) {
		var config = row.modules.dataTree;

		if (config.children !== false) {
			if (config.open) {
				this.collapseRow(row);
			} else {
				this.expandRow(row);
			}
		}
	};

	DataTree.prototype.getTreeParent = function (row) {
		return row.modules.dataTree.parent ? row.modules.dataTree.parent.getComponent() : false;
	};

	DataTree.prototype.getFilteredTreeChildren = function (row) {
		var config = row.modules.dataTree,
		    output = [],
		    children;

		if (config.children) {

			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			if (this.table.modExists("filter")) {
				children = this.table.modules.filter.filter(config.children);
			} else {
				children = config.children;
			}

			children.forEach(function (childRow) {
				if (childRow instanceof Row) {
					output.push(childRow);
				}
			});
		}

		return output;
	};

	DataTree.prototype.getTreeChildren = function (row) {
		var config = row.modules.dataTree,
		    output = [];

		if (config.children) {

			if (!Array.isArray(config.children)) {
				config.children = this.generateChildren(row);
			}

			config.children.forEach(function (childRow) {
				if (childRow instanceof Row) {
					output.push(childRow.getComponent());
				}
			});
		}

		return output;
	};

	DataTree.prototype.checkForRestyle = function (cell) {
		if (!cell.row.cells.indexOf(cell)) {
			if (cell.row.modules.dataTree.children !== false) {
				cell.row.reinitialize();
			}
		}
	};

	DataTree.prototype.getChildField = function () {
		return this.field;
	};

	DataTree.prototype.redrawNeeded = function (data) {
		return (this.field ? typeof data[this.field] !== "undefined" : false) || (this.elementField ? typeof data[this.elementField] !== "undefined" : false);
	};

	Tabulator.prototype.registerModule("dataTree", DataTree);

	var Download = function Download(table) {
		this.table = table; //hold Tabulator object
		this.fields = {}; //hold filed multi dimension arrays
		this.columnsByIndex = []; //hold columns in their order in the table
		this.columnsByField = {}; //hold columns with lookup by field name
		this.config = {};
		this.active = false;
	};

	//trigger file download
	Download.prototype.download = function (type, filename, options, active, interceptCallback) {
		var self = this,
		    downloadFunc = false;
		this.processConfig();
		this.active = active;

		function buildLink(data, mime) {
			if (interceptCallback) {
				if (interceptCallback === true) {
					self.triggerDownload(data, mime, type, filename, true);
				} else {
					interceptCallback(data);
				}
			} else {
				self.triggerDownload(data, mime, type, filename);
			}
		}

		if (typeof type == "function") {
			downloadFunc = type;
		} else {
			if (self.downloaders[type]) {
				downloadFunc = self.downloaders[type];
			} else {
				console.warn("Download Error - No such download type found: ", type);
			}
		}

		this.processColumns();

		if (downloadFunc) {
			downloadFunc.call(this, self.processDefinitions(), self.processData(active || "active"), options || {}, buildLink, this.config);
		}
	};

	Download.prototype.processConfig = function () {
		var config = { //download config
			columnGroups: true,
			rowGroups: true,
			columnCalcs: true,
			dataTree: true
		};

		if (this.table.options.downloadConfig) {
			for (var key in this.table.options.downloadConfig) {
				config[key] = this.table.options.downloadConfig[key];
			}
		}

		this.config.rowGroups = config.rowGroups && this.table.options.groupBy && this.table.modExists("groupRows");

		if (config.columnGroups && this.table.columnManager.columns.length != this.table.columnManager.columnsByIndex.length) {
			this.config.columnGroups = true;
		}

		if (config.columnCalcs && this.table.modExists("columnCalcs")) {
			this.config.columnCalcs = true;
		}

		if (config.dataTree && this.table.options.dataTree && this.table.modExists("dataTree")) {
			this.config.dataTree = true;
		}
	};

	Download.prototype.processColumns = function () {
		var self = this;

		self.columnsByIndex = [];
		self.columnsByField = {};

		self.table.columnManager.columnsByIndex.forEach(function (column) {

			if (column.field && column.definition.download !== false && (column.visible || !column.visible && column.definition.download)) {
				self.columnsByIndex.push(column);
				self.columnsByField[column.field] = column;
			}
		});
	};

	Download.prototype.processDefinitions = function () {
		var self = this,
		    processedDefinitions = [];

		if (this.config.columnGroups) {
			self.table.columnManager.columns.forEach(function (column) {
				var colData = self.processColumnGroup(column);

				if (colData) {
					processedDefinitions.push(colData);
				}
			});
		} else {
			self.columnsByIndex.forEach(function (column) {
				if (column.download !== false) {
					//isolate definiton from defintion object
					processedDefinitions.push(self.processDefinition(column));
				}
			});
		}

		return processedDefinitions;
	};

	Download.prototype.processColumnGroup = function (column) {
		var _this41 = this;

		var subGroups = column.columns,
		    maxDepth = 0;
		var processedColumn = this.processDefinition(column);
		var groupData = {
			type: "group",
			title: processedColumn.title,
			depth: 1
		};

		if (subGroups.length) {
			groupData.subGroups = [];
			groupData.width = 0;

			subGroups.forEach(function (subGroup) {
				var subGroupData = _this41.processColumnGroup(subGroup);

				if (subGroupData.depth > maxDepth) {
					maxDepth = subGroupData.depth;
				}

				if (subGroupData) {
					groupData.width += subGroupData.width;
					groupData.subGroups.push(subGroupData);
				}
			});

			groupData.depth += maxDepth;

			if (!groupData.width) {
				return false;
			}
		} else {
			if (column.field && column.definition.download !== false && (column.visible || !column.visible && column.definition.download)) {
				groupData.width = 1;
				groupData.definition = processedColumn;
			} else {
				return false;
			}
		}

		return groupData;
	};

	Download.prototype.processDefinition = function (column) {
		var def = {};

		for (var key in column.definition) {
			def[key] = column.definition[key];
		}

		if (typeof column.definition.downloadTitle != "undefined") {
			def.title = column.definition.downloadTitle;
		}

		return def;
	};

	Download.prototype.processData = function (active) {
		var _this42 = this;

		var self = this,
		    data = [],
		    groups = [],
		    rows = false,
		    calcs = {};

		if (this.config.rowGroups) {

			if (active == "visible") {

				rows = self.table.rowManager.getRows(active);

				rows.forEach(function (row) {
					if (row.type == "row") {
						var group = row.getGroup();

						if (groups.indexOf(group) === -1) {
							groups.push(group);
						}
					}
				});
			} else {
				groups = this.table.modules.groupRows.getGroups();
			}

			groups.forEach(function (group) {
				data.push(_this42.processGroupData(group, rows));
			});
		} else {
			if (this.config.dataTree) {
				active = active = "active" ? "display" : active;
			}
			data = self.table.rowManager.getData(active, "download");
		}

		if (this.config.columnCalcs) {
			calcs = this.table.getCalcResults();

			data = {
				calcs: calcs,
				data: data
			};
		}

		//bulk data processing
		if (typeof self.table.options.downloadDataFormatter == "function") {
			data = self.table.options.downloadDataFormatter(data);
		}

		return data;
	};

	Download.prototype.processGroupData = function (group, visRows) {
		var _this43 = this;

		var subGroups = group.getSubGroups();

		var groupData = {
			type: "group",
			key: group.key
		};

		if (subGroups.length) {
			groupData.subGroups = [];

			subGroups.forEach(function (subGroup) {
				groupData.subGroups.push(_this43.processGroupData(subGroup, visRows));
			});
		} else {
			if (visRows) {
				groupData.rows = [];

				group.rows.forEach(function (row) {
					if (visRows.indexOf(row) > -1) {
						groupData.rows.push(row.getData("download"));
					}
				});
			} else {
				groupData.rows = group.getData(true, "download");
			}
		}

		return groupData;
	};

	Download.prototype.triggerDownload = function (data, mime, type, filename, newTab) {
		var element = document.createElement('a'),
		    blob = new Blob([data], { type: mime }),
		    filename = filename || "Tabulator." + (typeof type === "function" ? "txt" : type);

		blob = this.table.options.downloadReady.call(this.table, data, blob);

		if (blob) {

			if (newTab) {
				window.open(window.URL.createObjectURL(blob));
			} else {
				if (navigator.msSaveOrOpenBlob) {
					navigator.msSaveOrOpenBlob(blob, filename);
				} else {
					element.setAttribute('href', window.URL.createObjectURL(blob));

					//set file title
					element.setAttribute('download', filename);

					//trigger download
					element.style.display = 'none';
					document.body.appendChild(element);
					element.click();

					//remove temporary link element
					document.body.removeChild(element);
				}
			}

			if (this.table.options.downloadComplete) {
				this.table.options.downloadComplete();
			}
		}
	};

	//nested field lookup
	Download.prototype.getFieldValue = function (field, data) {
		var column = this.columnsByField[field];

		if (column) {
			return column.getFieldValue(data);
		}

		return false;
	};

	Download.prototype.commsReceived = function (table, action, data) {
		switch (action) {
			case "intercept":
				this.download(data.type, "", data.options, data.active, data.intercept);
				break;
		}
	};

	//downloaders
	Download.prototype.downloaders = {
		csv: function csv(columns, data, options, setFileContents, config) {
			var self = this,
			    titles = [],
			    fields = [],
			    delimiter = options && options.delimiter ? options.delimiter : ",",
			    fileContents,
			    output;

			//build column headers
			function parseSimpleTitles() {
				columns.forEach(function (column) {
					titles.push('"' + String(column.title).split('"').join('""') + '"');
					fields.push(column.field);
				});
			}

			function parseColumnGroup(column, level) {
				if (column.subGroups) {
					column.subGroups.forEach(function (subGroup) {
						parseColumnGroup(subGroup, level + 1);
					});
				} else {
					titles.push('"' + String(column.title).split('"').join('""') + '"');
					fields.push(column.definition.field);
				}
			}

			if (config.columnGroups) {
				console.warn("Download Warning - CSV downloader cannot process column groups");

				columns.forEach(function (column) {
					parseColumnGroup(column, 0);
				});
			} else {
				parseSimpleTitles();
			}

			//generate header row
			fileContents = [titles.join(delimiter)];

			function parseRows(data) {
				//generate each row of the table
				data.forEach(function (row) {
					var rowData = [];

					fields.forEach(function (field) {
						var value = self.getFieldValue(field, row);

						switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
							case "object":
								value = JSON.stringify(value);
								break;

							case "undefined":
							case "null":
								value = "";
								break;

							default:
								value = value;
						}

						//escape quotation marks
						rowData.push('"' + String(value).split('"').join('""') + '"');
					});

					fileContents.push(rowData.join(delimiter));
				});
			}

			function parseGroup(group) {
				if (group.subGroups) {
					group.subGroups.forEach(function (subGroup) {
						parseGroup(subGroup);
					});
				} else {
					parseRows(group.rows);
				}
			}

			if (config.columnCalcs) {
				console.warn("Download Warning - CSV downloader cannot process column calculations");
				data = data.data;
			}

			if (config.rowGroups) {
				console.warn("Download Warning - CSV downloader cannot process row groups");

				data.forEach(function (group) {
					parseGroup(group);
				});
			} else {
				parseRows(data);
			}

			output = fileContents.join("\n");

			if (options.bom) {
				output = '\uFEFF' + output;
			}

			setFileContents(output, "text/csv");
		},

		json: function json(columns, data, options, setFileContents, config) {
			var fileContents;

			if (config.columnCalcs) {
				console.warn("Download Warning - CSV downloader cannot process column calculations");
				data = data.data;
			}

			fileContents = JSON.stringify(data, null, '\t');

			setFileContents(fileContents, "application/json");
		},

		pdf: function pdf(columns, data, options, setFileContents, config) {
			var self = this,
			    fields = [],
			    header = [],
			    body = [],
			    calcs = {},
			    headerDepth = 1,
			    table = "",
			    autoTableParams = {},
			    rowGroupStyles = options.rowGroupStyles || {
				fontStyle: "bold",
				fontSize: 12,
				cellPadding: 6,
				fillColor: 220
			},
			    rowCalcStyles = options.rowCalcStyles || {
				fontStyle: "bold",
				fontSize: 10,
				cellPadding: 4,
				fillColor: 232
			},
			    jsPDFParams = options.jsPDF || {},
			    title = options && options.title ? options.title : "";

			if (config.columnCalcs) {
				calcs = data.calcs;
				data = data.data;
			}

			if (!jsPDFParams.orientation) {
				jsPDFParams.orientation = options.orientation || "landscape";
			}

			if (!jsPDFParams.unit) {
				jsPDFParams.unit = "pt";
			}

			//build column headers
			function parseSimpleTitles() {
				columns.forEach(function (column) {
					if (column.field) {
						header.push(column.title || "");
						fields.push(column.field);
					}
				});

				header = [header];
			}

			function parseColumnGroup(column, level) {
				var colSpan = column.width,
				    rowSpan = 1,
				    col = {
					content: column.title || ""
				};

				if (column.subGroups) {
					column.subGroups.forEach(function (subGroup) {
						parseColumnGroup(subGroup, level + 1);
					});
					rowSpan = 1;
				} else {
					fields.push(column.definition.field);
					rowSpan = headerDepth - level;
				}

				col.rowSpan = rowSpan;
				// col.colSpan = colSpan;

				header[level].push(col);

				colSpan--;

				if (rowSpan > 1) {
					for (var i = level + 1; i < headerDepth; i++) {
						header[i].push("");
					}
				}

				for (var i = 0; i < colSpan; i++) {
					header[level].push("");
				}
			}

			if (config.columnGroups) {
				columns.forEach(function (column) {
					if (column.depth > headerDepth) {
						headerDepth = column.depth;
					}
				});

				for (var i = 0; i < headerDepth; i++) {
					header.push([]);
				}

				columns.forEach(function (column) {
					parseColumnGroup(column, 0);
				});
			} else {
				parseSimpleTitles();
			}

			function parseValue(value) {
				switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
					case "object":
						value = JSON.stringify(value);
						break;

					case "undefined":
					case "null":
						value = "";
						break;

					default:
						value = value;
				}

				return value;
			}

			function parseRows(data) {
				//build table rows
				data.forEach(function (row) {
					body.push(parseRow(row));
				});
			}

			function parseRow(row, styles) {
				var rowData = [];

				fields.forEach(function (field) {
					var value = self.getFieldValue(field, row);
					value = parseValue(value);

					if (styles) {
						rowData.push({
							content: value,
							styles: styles
						});
					} else {
						rowData.push(value);
					}
				});

				return rowData;
			}

			function parseGroup(group, calcObj) {
				var groupData = [];

				groupData.push({ content: parseValue(group.key), colSpan: fields.length, styles: rowGroupStyles });

				body.push(groupData);

				if (group.subGroups) {
					group.subGroups.forEach(function (subGroup) {
						parseGroup(subGroup, calcObj[group.key] ? calcObj[group.key].groups || {} : {});
					});
				} else {

					if (config.columnCalcs) {
						addCalcRow(calcObj, group.key, "top");
					}

					parseRows(group.rows);

					if (config.columnCalcs) {
						addCalcRow(calcObj, group.key, "bottom");
					}
				}
			}

			function addCalcRow(calcs, selector, pos) {
				var calcData = calcs[selector];

				if (calcData) {
					if (pos) {
						calcData = calcData[pos];
					}

					if (Object.keys(calcData).length) {
						body.push(parseRow(calcData, rowCalcStyles));
					}
				}
			}

			if (config.rowGroups) {
				data.forEach(function (group) {
					parseGroup(group, calcs);
				});
			} else {
				if (config.columnCalcs) {
					addCalcRow(calcs, "top");
				}

				parseRows(data);

				if (config.columnCalcs) {
					addCalcRow(calcs, "bottom");
				}
			}

			var doc = new jsPDF(jsPDFParams); //set document to landscape, better for most tables

			if (options && options.autoTable) {
				if (typeof options.autoTable === "function") {
					autoTableParams = options.autoTable(doc) || {};
				} else {
					autoTableParams = options.autoTable;
				}
			}

			if (title) {
				autoTableParams.addPageContent = function (data) {
					doc.text(title, 40, 30);
				};
			}

			autoTableParams.head = header;
			autoTableParams.body = body;

			doc.autoTable(autoTableParams);

			if (options && options.documentProcessing) {
				options.documentProcessing(doc);
			}

			setFileContents(doc.output("arraybuffer"), "application/pdf");
		},

		xlsx: function xlsx(columns, data, options, setFileContents, config) {
			var self = this,
			    sheetName = options.sheetName || "Sheet1",
			    workbook = XLSX.utils.book_new(),
			    calcs = {},
			    groupRowIndexs = [],
			    groupColumnIndexs = [],
			    calcRowIndexs = [],
			    output;

			workbook.SheetNames = [];
			workbook.Sheets = {};

			if (config.columnCalcs) {
				calcs = data.calcs;
				data = data.data;
			}

			function generateSheet() {
				var titles = [],
				    fields = [],
				    rows = [],
				    worksheet;

				//convert rows to worksheet
				function rowsToSheet() {
					var sheet = {};
					var range = { s: { c: 0, r: 0 }, e: { c: fields.length, r: rows.length } };

					XLSX.utils.sheet_add_aoa(sheet, rows);

					sheet['!ref'] = XLSX.utils.encode_range(range);

					var merges = generateMerges();

					if (merges.length) {
						sheet["!merges"] = merges;
					}

					return sheet;
				}

				function parseSimpleTitles() {
					//get field lists
					columns.forEach(function (column) {
						titles.push(column.title);
						fields.push(column.field);
					});

					rows.push(titles);
				}

				function parseColumnGroup(column, level) {

					if (typeof titles[level] === "undefined") {
						titles[level] = [];
					}

					if (typeof groupColumnIndexs[level] === "undefined") {
						groupColumnIndexs[level] = [];
					}

					if (column.width > 1) {

						groupColumnIndexs[level].push({
							type: "hoz",
							start: titles[level].length,
							end: titles[level].length + column.width - 1
						});
					}

					titles[level].push(column.title);

					if (column.subGroups) {
						column.subGroups.forEach(function (subGroup) {
							parseColumnGroup(subGroup, level + 1);
						});
					} else {
						fields.push(column.definition.field);
						padColumnTitles(fields.length - 1, level);

						groupColumnIndexs[level].push({
							type: "vert",
							start: fields.length - 1
						});
					}
				}

				function padColumnTitles() {
					var max = 0;

					titles.forEach(function (title) {
						var len = title.length;
						if (len > max) {
							max = len;
						}
					});

					titles.forEach(function (title) {
						var len = title.length;
						if (len < max) {
							for (var i = len; i < max; i++) {
								title.push("");
							}
						}
					});
				}

				if (config.columnGroups) {
					columns.forEach(function (column) {
						parseColumnGroup(column, 0);
					});

					titles.forEach(function (title) {
						rows.push(title);
					});
				} else {
					parseSimpleTitles();
				}

				function generateMerges() {
					var output = [];

					groupRowIndexs.forEach(function (index) {
						output.push({ s: { r: index, c: 0 }, e: { r: index, c: fields.length - 1 } });
					});

					groupColumnIndexs.forEach(function (merges, level) {
						merges.forEach(function (merge) {
							if (merge.type === "hoz") {
								output.push({ s: { r: level, c: merge.start }, e: { r: level, c: merge.end } });
							} else {
								if (level != titles.length - 1) {
									output.push({ s: { r: level, c: merge.start }, e: { r: titles.length - 1, c: merge.start } });
								}
							}
						});
					});

					return output;
				}

				//generate each row of the table
				function parseRows(data) {
					data.forEach(function (row) {
						rows.push(parseRow(row));
					});
				}

				function parseRow(row) {
					var rowData = [];

					fields.forEach(function (field) {
						var value = self.getFieldValue(field, row);
						rowData.push(!(value instanceof Date) && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === "object" ? JSON.stringify(value) : value);
					});

					return rowData;
				}

				function addCalcRow(calcs, selector, pos) {
					var calcData = calcs[selector];

					if (calcData) {
						if (pos) {
							calcData = calcData[pos];
						}

						if (Object.keys(calcData).length) {
							calcRowIndexs.push(rows.length);
							rows.push(parseRow(calcData));
						}
					}
				}

				function parseGroup(group, calcObj) {
					var groupData = [];

					groupData.push(group.key);

					groupRowIndexs.push(rows.length);

					rows.push(groupData);

					if (group.subGroups) {
						group.subGroups.forEach(function (subGroup) {
							parseGroup(subGroup, calcObj[group.key] ? calcObj[group.key].groups || {} : {});
						});
					} else {

						if (config.columnCalcs) {
							addCalcRow(calcObj, group.key, "top");
						}

						parseRows(group.rows);

						if (config.columnCalcs) {
							addCalcRow(calcObj, group.key, "bottom");
						}
					}
				}

				if (config.rowGroups) {
					data.forEach(function (group) {
						parseGroup(group, calcs);
					});
				} else {
					if (config.columnCalcs) {
						addCalcRow(calcs, "top");
					}

					parseRows(data);

					if (config.columnCalcs) {
						addCalcRow(calcs, "bottom");
					}
				}

				worksheet = rowsToSheet();

				return worksheet;
			}

			if (options.sheetOnly) {
				setFileContents(generateSheet());
				return;
			}

			if (options.sheets) {
				for (var sheet in options.sheets) {

					if (options.sheets[sheet] === true) {
						workbook.SheetNames.push(sheet);
						workbook.Sheets[sheet] = generateSheet();
					} else {

						workbook.SheetNames.push(sheet);

						this.table.modules.comms.send(options.sheets[sheet], "download", "intercept", {
							type: "xlsx",
							options: { sheetOnly: true },
							active: self.active,
							intercept: function intercept(data) {
								workbook.Sheets[sheet] = data;
							}
						});
					}
				}
			} else {
				workbook.SheetNames.push(sheetName);
				workbook.Sheets[sheetName] = generateSheet();
			}

			if (options.documentProcessing) {
				workbook = options.documentProcessing(workbook);
			}

			//convert workbook to binary array
			function s2ab(s) {
				var buf = new ArrayBuffer(s.length);
				var view = new Uint8Array(buf);
				for (var i = 0; i != s.length; ++i) {
					view[i] = s.charCodeAt(i) & 0xFF;
				}return buf;
			}

			output = XLSX.write(workbook, { bookType: 'xlsx', bookSST: true, type: 'binary' });

			setFileContents(s2ab(output), "application/octet-stream");
		},

		html: function html(columns, data, options, setFileContents, config) {
			if (this.table.modExists("export", true)) {
				setFileContents(this.table.modules.export.getHtml(true, options.style, config), "text/html");
			}
		}

	};

	Tabulator.prototype.registerModule("download", Download);

	var Edit = function Edit(table) {
		this.table = table; //hold Tabulator object
		this.currentCell = false; //hold currently editing cell
		this.mouseClick = false; //hold mousedown state to prevent click binding being overriden by editor opening
		this.recursionBlock = false; //prevent focus recursion
		this.invalidEdit = false;
	};

	//initialize column editor
	Edit.prototype.initializeColumn = function (column) {
		var self = this,
		    config = {
			editor: false,
			blocked: false,
			check: column.definition.editable,
			params: column.definition.editorParams || {}
		};

		//set column editor
		switch (_typeof(column.definition.editor)) {
			case "string":

				if (column.definition.editor === "tick") {
					column.definition.editor = "tickCross";
					console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor");
				}

				if (self.editors[column.definition.editor]) {
					config.editor = self.editors[column.definition.editor];
				} else {
					console.warn("Editor Error - No such editor found: ", column.definition.editor);
				}
				break;

			case "function":
				config.editor = column.definition.editor;
				break;

			case "boolean":

				if (column.definition.editor === true) {

					if (typeof column.definition.formatter !== "function") {

						if (column.definition.formatter === "tick") {
							column.definition.formatter = "tickCross";
							console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor");
						}

						if (self.editors[column.definition.formatter]) {
							config.editor = self.editors[column.definition.formatter];
						} else {
							config.editor = self.editors["input"];
						}
					} else {
						console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ", column.definition.formatter);
					}
				}
				break;
		}

		if (config.editor) {
			column.modules.edit = config;
		}
	};

	Edit.prototype.getCurrentCell = function () {
		return this.currentCell ? this.currentCell.getComponent() : false;
	};

	Edit.prototype.clearEditor = function () {
		var cell = this.currentCell,
		    cellEl;

		this.invalidEdit = false;

		if (cell) {
			this.currentCell = false;

			cellEl = cell.getElement();
			cellEl.classList.remove("tabulator-validation-fail");
			cellEl.classList.remove("tabulator-editing");
			while (cellEl.firstChild) {
				cellEl.removeChild(cellEl.firstChild);
			}cell.row.getElement().classList.remove("tabulator-row-editing");
		}
	};

	Edit.prototype.cancelEdit = function () {

		if (this.currentCell) {
			var cell = this.currentCell;
			var component = this.currentCell.getComponent();

			this.clearEditor();
			cell.setValueActual(cell.getValue());

			if (cell.column.cellEvents.cellEditCancelled) {
				cell.column.cellEvents.cellEditCancelled.call(this.table, component);
			}

			this.table.options.cellEditCancelled.call(this.table, component);
		}
	};

	//return a formatted value for a cell
	Edit.prototype.bindEditor = function (cell) {
		var self = this,
		    element = cell.getElement();

		element.setAttribute("tabindex", 0);

		element.addEventListener("click", function (e) {
			if (!element.classList.contains("tabulator-editing")) {
				element.focus();
			}
		});

		element.addEventListener("mousedown", function (e) {
			self.mouseClick = true;
		});

		element.addEventListener("focus", function (e) {
			if (!self.recursionBlock) {
				self.edit(cell, e, false);
			}
		});
	};

	Edit.prototype.focusCellNoEvent = function (cell, block) {
		this.recursionBlock = true;
		if (!(block && this.table.browser === "ie")) {
			cell.getElement().focus();
		}
		this.recursionBlock = false;
	};

	Edit.prototype.editCell = function (cell, forceEdit) {
		this.focusCellNoEvent(cell);
		this.edit(cell, false, forceEdit);
	};

	Edit.prototype.edit = function (cell, e, forceEdit) {
		var self = this,
		    allowEdit = true,
		    rendered = function rendered() {},
		    element = cell.getElement(),
		    cellEditor,
		    component,
		    params;

		//prevent editing if another cell is refusing to leave focus (eg. validation fail)
		if (this.currentCell) {
			if (!this.invalidEdit) {
				this.cancelEdit();
			}
			return;
		}

		//handle successfull value change
		function success(value) {
			if (self.currentCell === cell) {
				var valid = true;

				if (cell.column.modules.validate && self.table.modExists("validate")) {
					valid = self.table.modules.validate.validate(cell.column.modules.validate, cell.getComponent(), value);
				}

				if (valid === true) {
					self.clearEditor();
					cell.setValue(value, true);

					if (self.table.options.dataTree && self.table.modExists("dataTree")) {
						self.table.modules.dataTree.checkForRestyle(cell);
					}

					return true;
				} else {
					self.invalidEdit = true;
					element.classList.add("tabulator-validation-fail");
					self.focusCellNoEvent(cell, true);
					rendered();
					self.table.options.validationFailed.call(self.table, cell.getComponent(), value, valid);

					return false;
				}
			} else {
				// console.warn("Edit Success Error - cannot call success on a cell that is no longer being edited");
			}
		}

		//handle aborted edit
		function cancel() {
			if (self.currentCell === cell) {
				self.cancelEdit();

				if (self.table.options.dataTree && self.table.modExists("dataTree")) {
					self.table.modules.dataTree.checkForRestyle(cell);
				}
			} else {
				// console.warn("Edit Success Error - cannot call cancel on a cell that is no longer being edited");
			}
		}

		function onRendered(callback) {
			rendered = callback;
		}

		if (!cell.column.modules.edit.blocked) {
			if (e) {
				e.stopPropagation();
			}

			switch (_typeof(cell.column.modules.edit.check)) {
				case "function":
					allowEdit = cell.column.modules.edit.check(cell.getComponent());
					break;

				case "boolean":
					allowEdit = cell.column.modules.edit.check;
					break;
			}

			if (allowEdit || forceEdit) {

				self.cancelEdit();

				self.currentCell = cell;

				component = cell.getComponent();

				if (this.mouseClick) {
					this.mouseClick = false;

					if (cell.column.cellEvents.cellClick) {
						cell.column.cellEvents.cellClick.call(this.table, e, component);
					}
				}

				if (cell.column.cellEvents.cellEditing) {
					cell.column.cellEvents.cellEditing.call(this.table, component);
				}

				self.table.options.cellEditing.call(this.table, component);

				params = typeof cell.column.modules.edit.params === "function" ? cell.column.modules.edit.params(component) : cell.column.modules.edit.params;

				cellEditor = cell.column.modules.edit.editor.call(self, component, onRendered, success, cancel, params);

				//if editor returned, add to DOM, if false, abort edit
				if (cellEditor !== false) {

					if (cellEditor instanceof Node) {
						element.classList.add("tabulator-editing");
						cell.row.getElement().classList.add("tabulator-row-editing");
						while (element.firstChild) {
							element.removeChild(element.firstChild);
						}element.appendChild(cellEditor);

						//trigger onRendered Callback
						rendered();

						//prevent editing from triggering rowClick event
						var children = element.children;

						for (var i = 0; i < children.length; i++) {
							children[i].addEventListener("click", function (e) {
								e.stopPropagation();
							});
						}
					} else {
						console.warn("Edit Error - Editor should return an instance of Node, the editor returned:", cellEditor);
						element.blur();
						return false;
					}
				} else {
					element.blur();
					return false;
				}

				return true;
			} else {
				this.mouseClick = false;
				element.blur();
				return false;
			}
		} else {
			this.mouseClick = false;
			element.blur();
			return false;
		}
	};

	Edit.prototype.maskInput = function (el, options) {
		var mask = options.mask,
		    maskLetter = typeof options.maskLetterChar !== "undefined" ? options.maskLetterChar : "A",
		    maskNumber = typeof options.maskNumberChar !== "undefined" ? options.maskNumberChar : "9",
		    maskWildcard = typeof options.maskWildcardChar !== "undefined" ? options.maskWildcardChar : "*",
		    success = false;

		function fillSymbols(index) {
			var symbol = mask[index];
			if (typeof symbol !== "undefined" && symbol !== maskWildcard && symbol !== maskLetter && symbol !== maskNumber) {
				el.value = el.value + "" + symbol;
				fillSymbols(index + 1);
			}
		}

		el.addEventListener("keydown", function (e) {
			var index = el.value.length,
			    char = e.key;

			if (e.keyCode > 46) {
				if (index >= mask.length) {
					e.preventDefault();
					e.stopPropagation();
					success = false;
					return false;
				} else {
					switch (mask[index]) {
						case maskLetter:
							if (char.toUpperCase() == char.toLowerCase()) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
							break;

						case maskNumber:
							if (isNaN(char)) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
							break;

						case maskWildcard:
							break;

						default:
							if (char !== mask[index]) {
								e.preventDefault();
								e.stopPropagation();
								success = false;
								return false;
							}
					}
				}

				success = true;
			}

			return;
		});

		el.addEventListener("keyup", function (e) {
			if (e.keyCode > 46) {
				if (options.maskAutoFill) {
					fillSymbols(el.value.length);
				}
			}
		});

		if (!el.placeholder) {
			el.placeholder = mask;
		}

		if (options.maskAutoFill) {
			fillSymbols(el.value.length);
		}
	};

	//default data editors
	Edit.prototype.editors = {

		//input element
		input: function input(cell, onRendered, success, cancel, editorParams) {

			//create and style input
			var cellValue = cell.getValue(),
			    input = document.createElement("input");

			input.setAttribute("type", editorParams.search ? "search" : "text");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = typeof cellValue !== "undefined" ? cellValue : "";

			onRendered(function () {
				input.focus();
				input.style.height = "100%";
			});

			function onChange(e) {
				if ((cellValue === null || typeof cellValue === "undefined") && input.value !== "" || input.value !== cellValue) {

					if (success(input.value)) {
						cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on blur or change
			input.addEventListener("change", onChange);
			input.addEventListener("blur", onChange);

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					// case 9:
					case 13:
						onChange(e);
						break;

					case 27:
						cancel();
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//resizable text area element
		textarea: function textarea(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "hybrid",
			    value = String(cellValue !== null && typeof cellValue !== "undefined" ? cellValue : ""),
			    count = (value.match(/(?:\r\n|\r|\n)/g) || []).length + 1,
			    input = document.createElement("textarea"),
			    scrollHeight = 0;

			//create and style input
			input.style.display = "block";
			input.style.padding = "2px";
			input.style.height = "100%";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";
			input.style.whiteSpace = "pre-wrap";
			input.style.resize = "none";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = value;

			onRendered(function () {
				input.focus();
				input.style.height = "100%";
			});

			function onChange(e) {

				if ((cellValue === null || typeof cellValue === "undefined") && input.value !== "" || input.value !== cellValue) {

					if (success(input.value)) {
						cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
					}

					setTimeout(function () {
						cell.getRow().normalizeHeight();
					}, 300);
				} else {
					cancel();
				}
			}

			//submit new value on blur or change
			input.addEventListener("change", onChange);
			input.addEventListener("blur", onChange);

			input.addEventListener("keyup", function () {

				input.style.height = "";

				var heightNow = input.scrollHeight;

				input.style.height = heightNow + "px";

				if (heightNow != scrollHeight) {
					scrollHeight = heightNow;
					cell.getRow().normalizeHeight();
				}
			});

			input.addEventListener("keydown", function (e) {

				switch (e.keyCode) {
					case 27:
						cancel();
						break;

					case 38:
						//up arrow
						if (vertNav == "editor" || vertNav == "hybrid" && input.selectionStart) {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}

						break;

					case 40:
						//down arrow
						if (vertNav == "editor" || vertNav == "hybrid" && input.selectionStart !== input.value.length) {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//input element with type of number
		number: function number(cell, onRendered, success, cancel, editorParams) {

			var cellValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    input = document.createElement("input");

			input.setAttribute("type", "number");

			if (typeof editorParams.max != "undefined") {
				input.setAttribute("max", editorParams.max);
			}

			if (typeof editorParams.min != "undefined") {
				input.setAttribute("min", editorParams.min);
			}

			if (typeof editorParams.step != "undefined") {
				input.setAttribute("step", editorParams.step);
			}

			//create and style input
			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = cellValue;

			var blurFunc = function blurFunc(e) {
				onChange();
			};

			onRendered(function () {
				//submit new value on blur
				input.removeEventListener("blur", blurFunc);

				input.focus();
				input.style.height = "100%";

				//submit new value on blur
				input.addEventListener("blur", blurFunc);
			});

			function onChange() {
				var value = input.value;

				if (!isNaN(value) && value !== "") {
					value = Number(value);
				}

				if (value !== cellValue) {
					if (success(value)) {
						cellValue = value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 13:
						// case 9:
						onChange();
						break;

					case 27:
						cancel();
						break;

					case 38: //up arrow
					case 40:
						//down arrow
						if (vertNav == "editor") {
							e.stopImmediatePropagation();
							e.stopPropagation();
						}
						break;
				}
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//input element with type of number
		range: function range(cell, onRendered, success, cancel, editorParams) {

			var cellValue = cell.getValue(),
			    input = document.createElement("input");

			input.setAttribute("type", "range");

			if (typeof editorParams.max != "undefined") {
				input.setAttribute("max", editorParams.max);
			}

			if (typeof editorParams.min != "undefined") {
				input.setAttribute("min", editorParams.min);
			}

			if (typeof editorParams.step != "undefined") {
				input.setAttribute("step", editorParams.step);
			}

			//create and style input
			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = cellValue;

			onRendered(function () {
				input.focus();
				input.style.height = "100%";
			});

			function onChange() {
				var value = input.value;

				if (!isNaN(value) && value !== "") {
					value = Number(value);
				}

				if (value != cellValue) {
					if (success(value)) {
						cellValue = value; //persist value if successfully validated incase editor is used as header filter
					}
				} else {
					cancel();
				}
			}

			//submit new value on blur
			input.addEventListener("blur", function (e) {
				onChange();
			});

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 13:
					case 9:
						onChange();
						break;

					case 27:
						cancel();
						break;
				}
			});

			return input;
		},

		//select
		select: function select(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellEl = cell.getElement(),
			    initialValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    initialDisplayValue = typeof initialValue !== "undefined" || initialValue === null ? initialValue : typeof editorParams.defaultValue !== "undefined" ? editorParams.defaultValue : "",
			    input = document.createElement("input"),
			    listEl = document.createElement("div"),
			    dataItems = [],
			    displayItems = [],
			    currentItem = {},
			    blurable = true;

			this.table.rowManager.element.addEventListener("scroll", cancelItem);

			if (Array.isArray(editorParams) || !Array.isArray(editorParams) && (typeof editorParams === 'undefined' ? 'undefined' : _typeof(editorParams)) === "object" && !editorParams.values) {
				console.warn("DEPRECATION WANRING - values for the select editor must now be passed into the values property of the editorParams object, not as the editorParams object");
				editorParams = { values: editorParams };
			}

			function getUniqueColumnValues(field) {
				var output = {},
				    data = self.table.getData(),
				    column;

				if (field) {
					column = self.table.columnManager.getColumnByField(field);
				} else {
					column = cell.getColumn()._getSelf();
				}

				if (column) {
					data.forEach(function (row) {
						var val = column.getFieldValue(row);

						if (val !== null && typeof val !== "undefined" && val !== "") {
							output[val] = true;
						}
					});

					if (editorParams.sortValuesList) {
						if (editorParams.sortValuesList == "asc") {
							output = Object.keys(output).sort();
						} else {
							output = Object.keys(output).sort().reverse();
						}
					} else {
						output = Object.keys(output);
					}
				} else {
					console.warn("unable to find matching column to create select lookup list:", field);
				}

				return output;
			}

			function parseItems(inputValues, curentValue) {
				var dataList = [];
				var displayList = [];

				function processComplexListItem(item) {
					var item = {
						label: editorParams.listItemFormatter ? editorParams.listItemFormatter(item.value, item.label) : item.label,
						value: item.value,
						element: false
					};

					if (item.value === curentValue || !isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue)) {
						setCurrentItem(item);
					}

					dataList.push(item);
					displayList.push(item);

					return item;
				}

				if (typeof inputValues == "function") {
					inputValues = inputValues(cell);
				}

				if (Array.isArray(inputValues)) {
					inputValues.forEach(function (value) {
						var item;

						if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === "object") {

							if (value.options) {
								item = {
									label: value.label,
									group: true,
									element: false
								};

								displayList.push(item);

								value.options.forEach(function (item) {
									processComplexListItem(item);
								});
							} else {
								processComplexListItem(value);
							}
						} else {

							item = {
								label: editorParams.listItemFormatter ? editorParams.listItemFormatter(value, value) : value,
								value: value,
								element: false
							};

							if (item.value === curentValue || !isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue)) {
								setCurrentItem(item);
							}

							dataList.push(item);
							displayList.push(item);
						}
					});
				} else {
					for (var key in inputValues) {
						var item = {
							label: editorParams.listItemFormatter ? editorParams.listItemFormatter(key, inputValues[key]) : inputValues[key],
							value: key,
							element: false
						};

						if (item.value === curentValue || !isNaN(parseFloat(item.value)) && !isNaN(parseFloat(item.value)) && parseFloat(item.value) === parseFloat(curentValue)) {
							setCurrentItem(item);
						}

						dataList.push(item);
						displayList.push(item);
					}
				}

				dataItems = dataList;
				displayItems = displayList;

				fillList();
			}

			function fillList() {
				while (listEl.firstChild) {
					listEl.removeChild(listEl.firstChild);
				}displayItems.forEach(function (item) {
					var el = item.element;

					if (!el) {

						if (item.group) {
							el = document.createElement("div");
							el.classList.add("tabulator-edit-select-list-group");
							el.tabIndex = 0;
							el.innerHTML = item.label === "" ? "&nbsp;" : item.label;
						} else {
							el = document.createElement("div");
							el.classList.add("tabulator-edit-select-list-item");
							el.tabIndex = 0;
							el.innerHTML = item.label === "" ? "&nbsp;" : item.label;

							el.addEventListener("click", function () {
								setCurrentItem(item);
								chooseItem();
							});

							if (item === currentItem) {
								el.classList.add("active");
							}
						}

						el.addEventListener("mousedown", function () {
							blurable = false;

							setTimeout(function () {
								blurable = true;
							}, 10);
						});

						item.element = el;
					}

					listEl.appendChild(el);
				});
			}

			function setCurrentItem(item) {

				if (currentItem && currentItem.element) {
					currentItem.element.classList.remove("active");
				}

				currentItem = item;
				input.value = item.label === "&nbsp;" ? "" : item.label;

				if (item.element) {
					item.element.classList.add("active");
				}
			}

			function chooseItem() {
				hideList();

				if (initialValue !== currentItem.value) {
					initialValue = currentItem.value;
					success(currentItem.value);
				} else {
					cancel();
				}
			}

			function cancelItem() {
				hideList();
				cancel();
			}

			function showList() {
				if (!listEl.parentNode) {

					if (editorParams.values === true) {
						parseItems(getUniqueColumnValues(), initialDisplayValue);
					} else if (typeof editorParams.values === "string") {
						parseItems(getUniqueColumnValues(editorParams.values), initialDisplayValue);
					} else {
						parseItems(editorParams.values || [], initialDisplayValue);
					}

					var offset = Tabulator.prototype.helpers.elOffset(cellEl);

					listEl.style.minWidth = cellEl.offsetWidth + "px";

					listEl.style.top = offset.top + cellEl.offsetHeight + "px";
					listEl.style.left = offset.left + "px";
					document.body.appendChild(listEl);
				}
			}

			function hideList() {
				if (listEl.parentNode) {
					listEl.parentNode.removeChild(listEl);
				}

				removeScrollListener();
			}

			function removeScrollListener() {
				self.table.rowManager.element.removeEventListener("scroll", cancelItem);
			}

			//style input
			input.setAttribute("type", "text");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";
			input.style.cursor = "default";
			input.readOnly = this.currentCell != false;

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = typeof initialValue !== "undefined" || initialValue === null ? initialValue : "";

			// if(editorParams.values === true){
			// 	parseItems(getUniqueColumnValues(), initialValue);
			// }else if(typeof editorParams.values === "string"){
			// 	parseItems(getUniqueColumnValues(editorParams.values), initialValue);
			// }else{
			// 	parseItems(editorParams.values || [], initialValue);
			// }

			//allow key based navigation
			input.addEventListener("keydown", function (e) {
				var index;

				switch (e.keyCode) {
					case 38:
						//up arrow
						index = dataItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index > 0) {
								setCurrentItem(dataItems[index - 1]);
							}
						}
						break;

					case 40:
						//down arrow
						index = dataItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index < dataItems.length - 1) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index < dataItems.length - 1) {
								if (index == -1) {
									setCurrentItem(dataItems[0]);
								} else {
									setCurrentItem(dataItems[index + 1]);
								}
							}
						}
						break;

					case 37: //left arrow
					case 39:
						//right arrow
						e.stopImmediatePropagation();
						e.stopPropagation();
						e.preventDefault();
						break;

					case 13:
						//enter
						chooseItem();
						break;

					case 27:
						//escape
						cancelItem();
						break;
				}
			});

			input.addEventListener("blur", function (e) {
				if (blurable) {
					cancelItem();
				}
			});

			input.addEventListener("focus", function (e) {
				showList();
			});

			//style list element
			listEl = document.createElement("div");
			listEl.classList.add("tabulator-edit-select-list");

			onRendered(function () {
				input.style.height = "100%";
				input.focus();
			});

			return input;
		},

		//autocomplete
		autocomplete: function autocomplete(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    cellEl = cell.getElement(),
			    initialValue = cell.getValue(),
			    vertNav = editorParams.verticalNavigation || "editor",
			    initialDisplayValue = typeof initialValue !== "undefined" || initialValue === null ? initialValue : typeof editorParams.defaultValue !== "undefined" ? editorParams.defaultValue : "",
			    input = document.createElement("input"),
			    listEl = document.createElement("div"),
			    allItems = [],
			    displayItems = [],
			    values = [],
			    currentItem = false,
			    blurable = true;

			this.table.rowManager.element.addEventListener("scroll", cancelItem);

			//style input
			input.setAttribute("type", "search");

			input.style.padding = "4px";
			input.style.width = "100%";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//style list element
			listEl.classList.add("tabulator-edit-select-list");

			function getUniqueColumnValues(field) {
				var output = {},
				    data = self.table.getData(),
				    column;

				if (field) {
					column = self.table.columnManager.getColumnByField(field);
				} else {
					column = cell.getColumn()._getSelf();
				}

				if (column) {
					data.forEach(function (row) {
						var val = column.getFieldValue(row);

						if (val !== null && typeof val !== "undefined" && val !== "") {
							output[val] = true;
						}
					});

					if (editorParams.sortValuesList) {
						if (editorParams.sortValuesList == "asc") {
							output = Object.keys(output).sort();
						} else {
							output = Object.keys(output).sort().reverse();
						}
					} else {
						output = Object.keys(output);
					}
				} else {
					console.warn("unable to find matching column to create autocomplete lookup list:", field);
				}

				return output;
			}

			function filterList(term, intialLoad) {
				var matches = [],
				    values,
				    items,
				    searchEl;

				//lookup base values list
				if (editorParams.values === true) {
					values = getUniqueColumnValues();
				} else if (typeof editorParams.values === "string") {
					values = getUniqueColumnValues(editorParams.values);
				} else {
					values = editorParams.values || [];
				}

				if (editorParams.searchFunc) {
					matches = editorParams.searchFunc(term, values);

					if (matches instanceof Promise) {

						addNotice(typeof editorParams.searchingPlaceholder !== "undefined" ? editorParams.searchingPlaceholder : "Searching...");

						matches.then(function (result) {
							fillListIfNotEmpty(parseItems(result), intialLoad);
						}).catch(function (err) {
							console.err("error in autocomplete search promise:", err);
						});
					} else {
						fillListIfNotEmpty(parseItems(matches), intialLoad);
					}
				} else {
					items = parseItems(values);

					if (term === "") {
						if (editorParams.showListOnEmpty) {
							matches = items;
						}
					} else {
						items.forEach(function (item) {
							if (item.value !== null || typeof item.value !== "undefined") {
								if (String(item.value).toLowerCase().indexOf(String(term).toLowerCase()) > -1 || String(item.title).toLowerCase().indexOf(String(term).toLowerCase()) > -1) {
									matches.push(item);
								}
							}
						});
					}

					fillListIfNotEmpty(matches, intialLoad);
				}
			}

			function addNotice(notice) {
				var searchEl = document.createElement("div");

				clearList();

				if (notice !== false) {
					searchEl.classList.add("tabulator-edit-select-list-notice");
					searchEl.tabIndex = 0;

					if (notice instanceof Node) {
						searchEl.appendChild(notice);
					} else {
						searchEl.innerHTML = notice;
					}

					listEl.appendChild(searchEl);
				}
			}

			function parseItems(inputValues) {
				var itemList = [];

				if (Array.isArray(inputValues)) {
					inputValues.forEach(function (value) {
						var item = {
							title: editorParams.listItemFormatter ? editorParams.listItemFormatter(value, value) : value,
							value: value
						};

						itemList.push(item);
					});
				} else {
					for (var key in inputValues) {
						var item = {
							title: editorParams.listItemFormatter ? editorParams.listItemFormatter(key, inputValues[key]) : inputValues[key],
							value: key
						};

						itemList.push(item);
					}
				}

				return itemList;
			}

			function clearList() {
				while (listEl.firstChild) {
					listEl.removeChild(listEl.firstChild);
				}
			}

			function fillListIfNotEmpty(items, intialLoad) {
				if (items.length) {
					fillList(items, intialLoad);
				} else {
					if (editorParams.emptyPlaceholder) {
						addNotice(editorParams.emptyPlaceholder);
					}
				}
			}

			function fillList(items, intialLoad) {
				var current = false;

				clearList();

				displayItems = items;

				displayItems.forEach(function (item) {
					var el = item.element;

					if (!el) {
						el = document.createElement("div");
						el.classList.add("tabulator-edit-select-list-item");
						el.tabIndex = 0;
						el.innerHTML = item.title;

						el.addEventListener("click", function () {
							setCurrentItem(item);
							chooseItem();
						});

						el.addEventListener("mousedown", function () {
							blurable = false;

							setTimeout(function () {
								blurable = true;
							}, 10);
						});

						item.element = el;

						if (intialLoad && item.value == initialValue) {
							input.value = item.title;
							item.element.classList.add("active");
							current = true;
						}

						if (item === currentItem) {
							item.element.classList.add("active");
							current = true;
						}
					}

					listEl.appendChild(el);
				});

				if (!current) {
					setCurrentItem(false);
				}
			}

			function chooseItem() {
				hideList();

				if (currentItem) {
					if (initialValue !== currentItem.value) {
						initialValue = currentItem.value;
						input.value = currentItem.title;
						success(currentItem.value);
					} else {
						cancel();
					}
				} else {
					if (editorParams.freetext) {
						initialValue = input.value;
						success(input.value);
					} else {
						if (editorParams.allowEmpty && input.value === "") {
							initialValue = input.value;
							success(input.value);
						} else {
							cancel();
						}
					}
				}
			}

			function showList() {
				if (!listEl.parentNode) {
					while (listEl.firstChild) {
						listEl.removeChild(listEl.firstChild);
					}var offset = Tabulator.prototype.helpers.elOffset(cellEl);

					listEl.style.minWidth = cellEl.offsetWidth + "px";

					listEl.style.top = offset.top + cellEl.offsetHeight + "px";
					listEl.style.left = offset.left + "px";
					document.body.appendChild(listEl);
				}
			}

			function setCurrentItem(item, showInputValue) {
				if (currentItem && currentItem.element) {
					currentItem.element.classList.remove("active");
				}

				currentItem = item;

				if (item && item.element) {
					item.element.classList.add("active");
				}
			}

			function hideList() {
				if (listEl.parentNode) {
					listEl.parentNode.removeChild(listEl);
				}

				removeScrollListener();
			}

			function cancelItem() {
				hideList();
				cancel();
			}

			function removeScrollListener() {
				self.table.rowManager.element.removeEventListener("scroll", cancelItem);
			}

			//allow key based navigation
			input.addEventListener("keydown", function (e) {
				var index;

				switch (e.keyCode) {
					case 38:
						//up arrow
						index = displayItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index) {
							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index > 0) {
								setCurrentItem(displayItems[index - 1]);
							} else {
								setCurrentItem(false);
							}
						}
						break;

					case 40:
						//down arrow

						index = displayItems.indexOf(currentItem);

						if (vertNav == "editor" || vertNav == "hybrid" && index < displayItems.length - 1) {

							e.stopImmediatePropagation();
							e.stopPropagation();
							e.preventDefault();

							if (index < displayItems.length - 1) {
								if (index == -1) {
									setCurrentItem(displayItems[0]);
								} else {
									setCurrentItem(displayItems[index + 1]);
								}
							}
						}
						break;

					case 37: //left arrow
					case 39:
						//right arrow
						e.stopImmediatePropagation();
						e.stopPropagation();
						e.preventDefault();
						break;

					case 13:
						//enter
						chooseItem();
						break;

					case 27:
						//escape
						cancelItem();
						break;

					case 36: //home
					case 35:
						//end
						//prevent table navigation while using input element
						e.stopImmediatePropagation();
						break;
				}
			});

			input.addEventListener("keyup", function (e) {

				switch (e.keyCode) {
					case 38: //up arrow
					case 37: //left arrow
					case 39: //up arrow
					case 40: //right arrow
					case 13: //enter
					case 27:
						//escape
						break;

					default:
						filterList(input.value);
				}
			});

			input.addEventListener("search", function (e) {
				filterList(input.value);
			});

			input.addEventListener("blur", function (e) {
				if (blurable) {
					chooseItem();
				}
			});

			input.addEventListener("focus", function (e) {
				var value = initialDisplayValue;
				showList();
				input.value = value;
				filterList(value, true);
			});

			onRendered(function () {
				input.style.height = "100%";
				input.focus();
			});

			if (editorParams.mask) {
				this.table.modules.edit.maskInput(input, editorParams);
			}

			return input;
		},

		//start rating
		star: function star(cell, onRendered, success, cancel, editorParams) {
			var self = this,
			    element = cell.getElement(),
			    value = cell.getValue(),
			    maxStars = element.getElementsByTagName("svg").length || 5,
			    size = element.getElementsByTagName("svg")[0] ? element.getElementsByTagName("svg")[0].getAttribute("width") : 14,
			    stars = [],
			    starsHolder = document.createElement("div"),
			    star = document.createElementNS('http://www.w3.org/2000/svg', "svg");

			//change star type
			function starChange(val) {
				stars.forEach(function (star, i) {
					if (i < val) {
						if (self.table.browser == "ie") {
							star.setAttribute("class", "tabulator-star-active");
						} else {
							star.classList.replace("tabulator-star-inactive", "tabulator-star-active");
						}

						star.innerHTML = '<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
					} else {
						if (self.table.browser == "ie") {
							star.setAttribute("class", "tabulator-star-inactive");
						} else {
							star.classList.replace("tabulator-star-active", "tabulator-star-inactive");
						}

						star.innerHTML = '<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
					}
				});
			}

			//build stars
			function buildStar(i) {

				var starHolder = document.createElement("span");
				var nextStar = star.cloneNode(true);

				stars.push(nextStar);

				starHolder.addEventListener("mouseenter", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
					starChange(i);
				});

				starHolder.addEventListener("mousemove", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
				});

				starHolder.addEventListener("click", function (e) {
					e.stopPropagation();
					e.stopImmediatePropagation();
					success(i);
				});

				starHolder.appendChild(nextStar);
				starsHolder.appendChild(starHolder);
			}

			//handle keyboard navigation value change
			function changeValue(val) {
				value = val;
				starChange(val);
			}

			//style cell
			element.style.whiteSpace = "nowrap";
			element.style.overflow = "hidden";
			element.style.textOverflow = "ellipsis";

			//style holding element
			starsHolder.style.verticalAlign = "middle";
			starsHolder.style.display = "inline-block";
			starsHolder.style.padding = "4px";

			//style star
			star.setAttribute("width", size);
			star.setAttribute("height", size);
			star.setAttribute("viewBox", "0 0 512 512");
			star.setAttribute("xml:space", "preserve");
			star.style.padding = "0 1px";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						starsHolder.setAttribute(key, starsHolder.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						starsHolder.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//create correct number of stars
			for (var i = 1; i <= maxStars; i++) {
				buildStar(i);
			}

			//ensure value does not exceed number of stars
			value = Math.min(parseInt(value), maxStars);

			// set initial styling of stars
			starChange(value);

			starsHolder.addEventListener("mousemove", function (e) {
				starChange(0);
			});

			starsHolder.addEventListener("click", function (e) {
				success(0);
			});

			element.addEventListener("blur", function (e) {
				cancel();
			});

			//allow key based navigation
			element.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 39:
						//right arrow
						changeValue(value + 1);
						break;

					case 37:
						//left arrow
						changeValue(value - 1);
						break;

					case 13:
						//enter
						success(value);
						break;

					case 27:
						//escape
						cancel();
						break;
				}
			});

			return starsHolder;
		},

		//draggable progress bar
		progress: function progress(cell, onRendered, success, cancel, editorParams) {
			var element = cell.getElement(),
			    max = typeof editorParams.max === "undefined" ? element.getElementsByTagName("div")[0].getAttribute("max") || 100 : editorParams.max,
			    min = typeof editorParams.min === "undefined" ? element.getElementsByTagName("div")[0].getAttribute("min") || 0 : editorParams.min,
			    percent = (max - min) / 100,
			    value = cell.getValue() || 0,
			    handle = document.createElement("div"),
			    bar = document.createElement("div"),
			    mouseDrag,
			    mouseDragWidth;

			//set new value
			function updateValue() {
				var calcVal = percent * Math.round(bar.offsetWidth / (element.clientWidth / 100)) + min;
				success(calcVal);
				element.setAttribute("aria-valuenow", calcVal);
				element.setAttribute("aria-label", value);
			}

			//style handle
			handle.style.position = "absolute";
			handle.style.right = "0";
			handle.style.top = "0";
			handle.style.bottom = "0";
			handle.style.width = "5px";
			handle.classList.add("tabulator-progress-handle");

			//style bar
			bar.style.display = "inline-block";
			bar.style.position = "relative";
			// bar.style.top = "8px";
			// bar.style.bottom = "8px";
			// bar.style.left = "4px";
			// bar.style.marginRight = "4px";
			bar.style.height = "100%";
			bar.style.backgroundColor = "#488CE9";
			bar.style.maxWidth = "100%";
			bar.style.minWidth = "0%";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						bar.setAttribute(key, bar.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						bar.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			//style cell
			element.style.padding = "4px 4px";

			//make sure value is in range
			value = Math.min(parseFloat(value), max);
			value = Math.max(parseFloat(value), min);

			//workout percentage
			value = Math.round((value - min) / percent);
			// bar.style.right = value + "%";
			bar.style.width = value + "%";

			element.setAttribute("aria-valuemin", min);
			element.setAttribute("aria-valuemax", max);

			bar.appendChild(handle);

			handle.addEventListener("mousedown", function (e) {
				mouseDrag = e.screenX;
				mouseDragWidth = bar.offsetWidth;
			});

			handle.addEventListener("mouseover", function () {
				handle.style.cursor = "ew-resize";
			});

			element.addEventListener("mousemove", function (e) {
				if (mouseDrag) {
					bar.style.width = mouseDragWidth + e.screenX - mouseDrag + "px";
				}
			});

			element.addEventListener("mouseup", function (e) {
				if (mouseDrag) {
					e.stopPropagation();
					e.stopImmediatePropagation();

					mouseDrag = false;
					mouseDragWidth = false;

					updateValue();
				}
			});

			//allow key based navigation
			element.addEventListener("keydown", function (e) {
				switch (e.keyCode) {
					case 39:
						//right arrow
						bar.style.width = bar.clientWidth + element.clientWidth / 100 + "px";
						break;

					case 37:
						//left arrow
						bar.style.width = bar.clientWidth - element.clientWidth / 100 + "px";
						break;

					case 13:
						//enter
						updateValue();
						break;

					case 27:
						//escape
						cancel();
						break;

				}
			});

			element.addEventListener("blur", function () {
				cancel();
			});

			return bar;
		},

		//checkbox
		tickCross: function tickCross(cell, onRendered, success, cancel, editorParams) {
			var value = cell.getValue(),
			    input = document.createElement("input"),
			    tristate = editorParams.tristate,
			    indetermValue = typeof editorParams.indeterminateValue === "undefined" ? null : editorParams.indeterminateValue,
			    indetermState = false;

			input.setAttribute("type", "checkbox");
			input.style.marginTop = "5px";
			input.style.boxSizing = "border-box";

			if (editorParams.elementAttributes && _typeof(editorParams.elementAttributes) == "object") {
				for (var key in editorParams.elementAttributes) {
					if (key.charAt(0) == "+") {
						key = key.slice(1);
						input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
					} else {
						input.setAttribute(key, editorParams.elementAttributes[key]);
					}
				}
			}

			input.value = value;

			if (tristate && (typeof value === "undefined" || value === indetermValue || value === "")) {
				indetermState = true;
				input.indeterminate = true;
			}

			if (this.table.browser != "firefox") {
				//prevent blur issue on mac firefox
				onRendered(function () {
					input.focus();
				});
			}

			input.checked = value === true || value === "true" || value === "True" || value === 1;

			function setValue(blur) {
				if (tristate) {
					if (!blur) {
						if (input.checked && !indetermState) {
							input.checked = false;
							input.indeterminate = true;
							indetermState = true;
							return indetermValue;
						} else {
							indetermState = false;
							return input.checked;
						}
					} else {
						if (indetermState) {
							return indetermValue;
						} else {
							return input.checked;
						}
					}
				} else {
					return input.checked;
				}
			}

			//submit new value on blur
			input.addEventListener("change", function (e) {
				success(setValue());
			});

			input.addEventListener("blur", function (e) {
				success(setValue(true));
			});

			//submit new value on enter
			input.addEventListener("keydown", function (e) {
				if (e.keyCode == 13) {
					success(setValue());
				}
				if (e.keyCode == 27) {
					cancel();
				}
			});

			return input;
		}
	};

	Tabulator.prototype.registerModule("edit", Edit);

	var Export = function Export(table) {
		this.table = table; //hold Tabulator object
		this.config = {};
		this.cloneTableStyle = true;
		this.colVisProp = "";
	};

	Export.prototype.genereateTable = function (config, style, range, colVisProp) {
		this.cloneTableStyle = style;
		this.config = config || {};
		this.colVisProp = colVisProp;

		var table = document.createElement("table");
		table.classList.add("tabulator-print-table");

		if (this.config.columnHeaders !== false) {
			table.appendChild(this.generateHeaderElements());
		}

		table.appendChild(this.generateBodyElements(this.rowLookup(range)));

		this.mapElementStyles(this.table.element, table, ["border-top", "border-left", "border-right", "border-bottom"]);

		return table;
	};

	Export.prototype.rowLookup = function (range) {
		var _this44 = this;

		var rows = [];

		if (typeof range == "function") {
			range.call(this.table).forEach(function (row) {
				row = _this44.table.rowManager.findRow(row);

				if (row) {
					rows.push(row);
				}
			});
		} else {
			switch (range) {
				case true:
				case "visible":
					rows = this.table.rowManager.getVisibleRows(true);
					break;

				case "all":
					rows = this.table.rowManager.rows;
					break;

				case "selected":
					rows = this.modules.selectRow.selectedRows;
					break;

				case "active":
				default:
					rows = this.table.rowManager.getDisplayRows();
			}
		}

		return Object.assign([], rows);
	};

	Export.prototype.generateColumnGroupHeaders = function () {
		var _this45 = this;

		var output = [];

		var columns = this.config.columnGroups !== false ? this.table.columnManager.columns : this.table.columnManager.columnsByIndex;

		columns.forEach(function (column) {
			var colData = _this45.processColumnGroup(column);

			if (colData) {
				output.push(colData);
			}
		});

		return output;
	};

	Export.prototype.processColumnGroup = function (column) {
		var _this46 = this;

		var subGroups = column.columns,
		    maxDepth = 0;

		var groupData = {
			title: column.definition.title,
			column: column,
			depth: 1
		};

		if (subGroups.length) {
			groupData.subGroups = [];
			groupData.width = 0;

			subGroups.forEach(function (subGroup) {
				var subGroupData = _this46.processColumnGroup(subGroup);

				if (subGroupData) {
					groupData.width += subGroupData.width;
					groupData.subGroups.push(subGroupData);

					if (subGroupData.depth > maxDepth) {
						maxDepth = subGroupData.depth;
					}
				}
			});

			groupData.depth += maxDepth;

			if (!groupData.width) {
				return false;
			}
		} else {
			if (this.columnVisCheck(column)) {
				groupData.width = 1;
			} else {
				return false;
			}
		}

		return groupData;
	};

	Export.prototype.groupHeadersToRows = function (columns) {

		var headers = [],
		    headerDepth = 0;

		function parseColumnGroup(column, level) {

			var depth = headerDepth - level;

			if (typeof headers[level] === "undefined") {
				headers[level] = [];
			}

			column.height = column.subGroups ? 1 : depth - column.depth + 1;

			headers[level].push(column);

			if (column.subGroups) {
				column.subGroups.forEach(function (subGroup) {
					parseColumnGroup(subGroup, level + 1);
				});
			}
		}

		//calculate maximum header debth
		columns.forEach(function (column) {
			if (column.depth > headerDepth) {
				headerDepth = column.depth;
			}
		});

		columns.forEach(function (column) {
			parseColumnGroup(column, 0);
		});

		return headers;
	};

	Export.prototype.generateHeaderElements = function () {
		var _this47 = this;

		var headerEl = document.createElement("thead");

		var rows = this.groupHeadersToRows(this.generateColumnGroupHeaders());

		rows.forEach(function (row) {
			var rowEl = document.createElement("tr");

			_this47.mapElementStyles(_this47.table.columnManager.getHeadersElement(), headerEl, ["border-top", "border-left", "border-right", "border-bottom", "background-color", "color", "font-weight", "font-family", "font-size"]);

			row.forEach(function (column) {
				var cellEl = document.createElement("th");
				var classNames = column.column.definition.cssClass ? column.column.definition.cssClass.split(" ") : [];

				cellEl.colSpan = column.width;
				cellEl.rowSpan = column.height;

				cellEl.innerHTML = column.column.definition.title;

				if (_this47.cloneTableStyle) {
					cellEl.style.boxSizing = "border-box";
				}

				classNames.forEach(function (className) {
					cellEl.classList.add(className);
				});

				_this47.mapElementStyles(column.column.getElement(), cellEl, ["text-align", "border-top", "border-left", "border-right", "border-bottom", "background-color", "color", "font-weight", "font-family", "font-size"]);
				_this47.mapElementStyles(column.column.contentElement, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);

				if (column.column.visible) {
					_this47.mapElementStyles(column.column.getElement(), cellEl, ["width"]);
				} else {
					if (column.column.definition.width) {
						cellEl.style.width = column.column.definition.width + "px";
					}
				}

				if (column.column.parent) {
					_this47.mapElementStyles(column.column.parent.groupElement, cellEl, ["border-top"]);
				}

				rowEl.appendChild(cellEl);
			});

			headerEl.appendChild(rowEl);
		});

		return headerEl;
	};

	Export.prototype.generateBodyElements = function (rows) {};

	Export.prototype.generateBodyElements = function (rows) {
		var _this48 = this;

		var oddRow, evenRow, calcRow, firstRow, firstCell, firstGroup, lastCell, styleCells, styleRow, treeElementField, rowFormatter;

		//assign row formatter
		rowFormatter = this.table.options["rowFormatter" + (this.colVisProp.charAt(0).toUpperCase() + this.colVisProp.slice(1))];
		rowFormatter = rowFormatter !== null ? rowFormatter : this.table.options.rowFormatter;

		//lookup row styles
		if (this.cloneTableStyle && window.getComputedStyle) {
			oddRow = this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)");
			evenRow = this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)");
			calcRow = this.table.element.querySelector(".tabulator-row.tabulator-calcs");
			firstRow = this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)");
			firstGroup = this.table.element.getElementsByClassName("tabulator-group")[0];

			if (firstRow) {
				styleCells = firstRow.getElementsByClassName("tabulator-cell");
				firstCell = styleCells[0];
				lastCell = styleCells[styleCells.length - 1];
			}
		}

		var bodyEl = document.createElement("tbody");

		var columns = [];

		if (this.config.columnCalcs !== false && this.table.modExists("columnCalcs")) {
			if (this.table.modules.columnCalcs.topInitialized) {
				rows.unshift(this.table.modules.columnCalcs.topRow);
			}

			if (this.table.modules.columnCalcs.botInitialized) {
				rows.push(this.table.modules.columnCalcs.botRow);
			}
		}

		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (_this48.columnVisCheck(column)) {
				columns.push(column);
			}
		});

		if (this.table.options.dataTree && this.config.dataTree !== false && this.table.modExists("columnCalcs")) {
			treeElementField = this.table.modules.dataTree.elementField;
		}

		rows = rows.filter(function (row) {
			switch (row.type) {
				case "group":
					return _this48.config.rowGroups !== false;
					break;

				case "calc":
					return _this48.config.columnCalcs !== false;
					break;
			}

			return true;
		});

		if (rows.length > 1000) {
			console.warn("It may take a long time to render an HTML table with more than 1000 rows");
		}

		rows.forEach(function (row, i) {
			var rowData = row.getData(_this48.colVisProp);

			var rowEl = document.createElement("tr");
			rowEl.classList.add("tabulator-print-table-row");

			switch (row.type) {
				case "group":
					var cellEl = document.createElement("td");
					cellEl.colSpan = columns.length;
					cellEl.innerHTML = row.key;

					rowEl.classList.add("tabulator-print-table-group");

					_this48.mapElementStyles(firstGroup, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
					_this48.mapElementStyles(firstGroup, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);
					rowEl.appendChild(cellEl);
					break;

				case "calc":
					rowEl.classList.add("tabulator-print-table-calcs");

				case "row":

					if (_this48.table.options.dataTree && _this48.config.dataTree === false && row.modules.dataTree.parent) {
						return;
					}

					columns.forEach(function (column, i) {
						var cellEl = document.createElement("td");

						var value = column.getFieldValue(rowData);

						var cellWrapper = {
							modules: {},
							getValue: function getValue() {
								return value;
							},
							getField: function getField() {
								return column.definition.field;
							},
							getElement: function getElement() {
								return cellEl;
							},
							getColumn: function getColumn() {
								return column.getComponent();
							},
							getData: function getData() {
								return rowData;
							},
							getRow: function getRow() {
								return row.getComponent();
							},
							getComponent: function getComponent() {
								return cellWrapper;
							},
							column: column
						};

						var classNames = column.definition.cssClass ? column.definition.cssClass.split(" ") : [];

						classNames.forEach(function (className) {
							cellEl.classList.add(className);
						});

						if (_this48.table.modExists("format") && _this48.config.formatCells !== false) {
							value = _this48.table.modules.format.formatExportValue(cellWrapper, _this48.colVisProp);
						} else {
							switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
								case "object":
									value = JSON.stringify(value);
									break;

								case "undefined":
								case "null":
									value = "";
									break;

								default:
									value = value;
							}
						}

						if (value instanceof Node) {
							cellEl.appendChild(value);
						} else {
							cellEl.innerHTML = value;
						}

						if (firstCell) {
							_this48.mapElementStyles(firstCell, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom", "border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size"]);

							if (column.definition.align) {
								cellEl.style.textAlign = column.definition.align;
							}
						}

						if (_this48.table.options.dataTree && _this48.config.dataTree !== false) {
							if (treeElementField && treeElementField == column.field || !treeElementField && i == 0) {
								if (row.modules.dataTree.controlEl) {
									cellEl.insertBefore(row.modules.dataTree.controlEl.cloneNode(true), cellEl.firstChild);
								}
								if (row.modules.dataTree.branchEl) {
									cellEl.insertBefore(row.modules.dataTree.branchEl.cloneNode(true), cellEl.firstChild);
								}
							}
						}

						rowEl.appendChild(cellEl);

						if (cellWrapper.modules.format && cellWrapper.modules.format.renderedCallback) {
							cellWrapper.modules.format.renderedCallback();
						}
					});

					styleRow = row.type == "calc" ? calcRow : i % 2 && evenRow ? evenRow : oddRow;

					_this48.mapElementStyles(styleRow, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);

					if (rowFormatter && _this48.config.formatCells !== false) {
						var rowComponent = row.getComponent();

						rowComponent.getElement = function () {
							return rowEl;
						};

						rowFormatter(rowComponent);
					}

					break;
			}

			bodyEl.appendChild(rowEl);
		});

		return bodyEl;
	};

	Export.prototype.columnVisCheck = function (column) {
		return column.definition[this.colVisProp] !== false && (column.visible || !column.visible && column.definition[this.colVisProp]);
	};

	Export.prototype.getHtml = function (visible, style, config, colVisProp) {
		var holder = document.createElement("div");

		holder.appendChild(this.genereateTable(config || this.table.options.htmlOutputConfig, style, visible, colVisProp || "htmlOutput"));

		return holder.innerHTML;
	};

	Export.prototype.mapElementStyles = function (from, to, props) {
		if (this.cloneTableStyle && from && to) {

			var lookup = {
				"background-color": "backgroundColor",
				"color": "fontColor",
				"width": "width",
				"font-weight": "fontWeight",
				"font-family": "fontFamily",
				"font-size": "fontSize",
				"text-align": "textAlign",
				"border-top": "borderTop",
				"border-left": "borderLeft",
				"border-right": "borderRight",
				"border-bottom": "borderBottom",
				"padding-top": "paddingTop",
				"padding-left": "paddingLeft",
				"padding-right": "paddingRight",
				"padding-bottom": "paddingBottom"
			};

			if (window.getComputedStyle) {
				var fromStyle = window.getComputedStyle(from);

				props.forEach(function (prop) {
					to.style[lookup[prop]] = fromStyle.getPropertyValue(prop);
				});
			}
		}
	};

	Tabulator.prototype.registerModule("export", Export);

	var Filter = function Filter(table) {

		this.table = table; //hold Tabulator object

		this.filterList = []; //hold filter list
		this.headerFilters = {}; //hold column filters
		this.headerFilterColumns = []; //hold columns that use header filters

		this.prevHeaderFilterChangeCheck = "";
		this.prevHeaderFilterChangeCheck = "{}";

		this.changed = false; //has filtering changed since last render
	};

	//initialize column header filter
	Filter.prototype.initializeColumn = function (column, value) {
		var self = this,
		    field = column.getField(),
		    params;

		//handle successfull value change
		function success(value) {
			var filterType = column.modules.filter.tagType == "input" && column.modules.filter.attrType == "text" || column.modules.filter.tagType == "textarea" ? "partial" : "match",
			    type = "",
			    filterChangeCheck = "",
			    filterFunc;

			if (typeof column.modules.filter.prevSuccess === "undefined" || column.modules.filter.prevSuccess !== value) {

				column.modules.filter.prevSuccess = value;

				if (!column.modules.filter.emptyFunc(value)) {
					column.modules.filter.value = value;

					switch (_typeof(column.definition.headerFilterFunc)) {
						case "string":
							if (self.filters[column.definition.headerFilterFunc]) {
								type = column.definition.headerFilterFunc;
								filterFunc = function filterFunc(data) {
									var params = column.definition.headerFilterFuncParams || {};
									var fieldVal = column.getFieldValue(data);

									params = typeof params === "function" ? params(value, fieldVal, data) : params;

									return self.filters[column.definition.headerFilterFunc](value, fieldVal, data, params);
								};
							} else {
								console.warn("Header Filter Error - Matching filter function not found: ", column.definition.headerFilterFunc);
							}
							break;

						case "function":
							filterFunc = function filterFunc(data) {
								var params = column.definition.headerFilterFuncParams || {};
								var fieldVal = column.getFieldValue(data);

								params = typeof params === "function" ? params(value, fieldVal, data) : params;

								return column.definition.headerFilterFunc(value, fieldVal, data, params);
							};

							type = filterFunc;
							break;
					}

					if (!filterFunc) {
						switch (filterType) {
							case "partial":
								filterFunc = function filterFunc(data) {
									var colVal = column.getFieldValue(data);

									if (typeof colVal !== 'undefined' && colVal !== null) {
										return String(colVal).toLowerCase().indexOf(String(value).toLowerCase()) > -1;
									} else {
										return false;
									}
								};
								type = "like";
								break;

							default:
								filterFunc = function filterFunc(data) {
									return column.getFieldValue(data) == value;
								};
								type = "=";
						}
					}

					self.headerFilters[field] = { value: value, func: filterFunc, type: type };
				} else {
					delete self.headerFilters[field];
				}

				filterChangeCheck = JSON.stringify(self.headerFilters);

				if (self.prevHeaderFilterChangeCheck !== filterChangeCheck) {
					self.prevHeaderFilterChangeCheck = filterChangeCheck;

					self.changed = true;
					self.table.rowManager.filterRefresh();
				}
			}

			return true;
		}

		column.modules.filter = {
			success: success,
			attrType: false,
			tagType: false,
			emptyFunc: false
		};

		this.generateHeaderFilterElement(column);
	};

	Filter.prototype.generateHeaderFilterElement = function (column, initialValue, reinitialize) {
		var _this49 = this;

		var self = this,
		    success = column.modules.filter.success,
		    field = column.getField(),
		    filterElement,
		    editor,
		    editorElement,
		    cellWrapper,
		    typingTimer,
		    searchTrigger,
		    params;

		//handle aborted edit
		function cancel() {}

		if (column.modules.filter.headerElement && column.modules.filter.headerElement.parentNode) {
			column.contentElement.removeChild(column.modules.filter.headerElement.parentNode);
		}

		if (field) {

			//set empty value function
			column.modules.filter.emptyFunc = column.definition.headerFilterEmptyCheck || function (value) {
				return !value && value !== "0";
			};

			filterElement = document.createElement("div");
			filterElement.classList.add("tabulator-header-filter");

			//set column editor
			switch (_typeof(column.definition.headerFilter)) {
				case "string":
					if (self.table.modules.edit.editors[column.definition.headerFilter]) {
						editor = self.table.modules.edit.editors[column.definition.headerFilter];

						if ((column.definition.headerFilter === "tick" || column.definition.headerFilter === "tickCross") && !column.definition.headerFilterEmptyCheck) {
							column.modules.filter.emptyFunc = function (value) {
								return value !== true && value !== false;
							};
						}
					} else {
						console.warn("Filter Error - Cannot build header filter, No such editor found: ", column.definition.editor);
					}
					break;

				case "function":
					editor = column.definition.headerFilter;
					break;

				case "boolean":
					if (column.modules.edit && column.modules.edit.editor) {
						editor = column.modules.edit.editor;
					} else {
						if (column.definition.formatter && self.table.modules.edit.editors[column.definition.formatter]) {
							editor = self.table.modules.edit.editors[column.definition.formatter];

							if ((column.definition.formatter === "tick" || column.definition.formatter === "tickCross") && !column.definition.headerFilterEmptyCheck) {
								column.modules.filter.emptyFunc = function (value) {
									return value !== true && value !== false;
								};
							}
						} else {
							editor = self.table.modules.edit.editors["input"];
						}
					}
					break;
			}

			if (editor) {

				cellWrapper = {
					getValue: function getValue() {
						return typeof initialValue !== "undefined" ? initialValue : "";
					},
					getField: function getField() {
						return column.definition.field;
					},
					getElement: function getElement() {
						return filterElement;
					},
					getColumn: function getColumn() {
						return column.getComponent();
					},
					getRow: function getRow() {
						return {
							normalizeHeight: function normalizeHeight() {}
						};
					}
				};

				params = column.definition.headerFilterParams || {};

				params = typeof params === "function" ? params.call(self.table) : params;

				editorElement = editor.call(this.table.modules.edit, cellWrapper, function () {}, success, cancel, params);

				if (!editorElement) {
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor returned a value of false");
					return;
				}

				if (!(editorElement instanceof Node)) {
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor should return an instance of Node, the editor returned:", editorElement);
					return;
				}

				//set Placeholder Text
				if (field) {
					self.table.modules.localize.bind("headerFilters|columns|" + column.definition.field, function (value) {
						editorElement.setAttribute("placeholder", typeof value !== "undefined" && value ? value : self.table.modules.localize.getText("headerFilters|default"));
					});
				} else {
					self.table.modules.localize.bind("headerFilters|default", function (value) {
						editorElement.setAttribute("placeholder", typeof self.column.definition.headerFilterPlaceholder !== "undefined" && self.column.definition.headerFilterPlaceholder ? self.column.definition.headerFilterPlaceholder : value);
					});
				}

				//focus on element on click
				editorElement.addEventListener("click", function (e) {
					e.stopPropagation();
					editorElement.focus();
				});

				editorElement.addEventListener("focus", function (e) {
					var left = _this49.table.columnManager.element.scrollLeft;

					if (left !== _this49.table.rowManager.element.scrollLeft) {
						_this49.table.rowManager.scrollHorizontal(left);
						_this49.table.columnManager.scrollHorizontal(left);
					}
				});

				//live update filters as user types
				typingTimer = false;

				searchTrigger = function searchTrigger(e) {
					if (typingTimer) {
						clearTimeout(typingTimer);
					}

					typingTimer = setTimeout(function () {
						success(editorElement.value);
					}, self.table.options.headerFilterLiveFilterDelay);
				};

				column.modules.filter.headerElement = editorElement;
				column.modules.filter.attrType = editorElement.hasAttribute("type") ? editorElement.getAttribute("type").toLowerCase() : "";
				column.modules.filter.tagType = editorElement.tagName.toLowerCase();

				if (column.definition.headerFilterLiveFilter !== false) {

					if (!(column.definition.headerFilter === 'autocomplete' || column.definition.headerFilter === 'tickCross' || (column.definition.editor === 'autocomplete' || column.definition.editor === 'tickCross') && column.definition.headerFilter === true)) {
						editorElement.addEventListener("keyup", searchTrigger);
						editorElement.addEventListener("search", searchTrigger);

						//update number filtered columns on change
						if (column.modules.filter.attrType == "number") {
							editorElement.addEventListener("change", function (e) {
								success(editorElement.value);
							});
						}

						//change text inputs to search inputs to allow for clearing of field
						if (column.modules.filter.attrType == "text" && this.table.browser !== "ie") {
							editorElement.setAttribute("type", "search");
							// editorElement.off("change blur"); //prevent blur from triggering filter and preventing selection click
						}
					}

					//prevent input and select elements from propegating click to column sorters etc
					if (column.modules.filter.tagType == "input" || column.modules.filter.tagType == "select" || column.modules.filter.tagType == "textarea") {
						editorElement.addEventListener("mousedown", function (e) {
							e.stopPropagation();
						});
					}
				}

				filterElement.appendChild(editorElement);

				column.contentElement.appendChild(filterElement);

				if (!reinitialize) {
					self.headerFilterColumns.push(column);
				}
			}
		} else {
			console.warn("Filter Error - Cannot add header filter, column has no field set:", column.definition.title);
		}
	};

	//hide all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	Filter.prototype.hideHeaderFilterElements = function () {
		this.headerFilterColumns.forEach(function (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				column.modules.filter.headerElement.style.display = 'none';
			}
		});
	};

	//show all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	Filter.prototype.showHeaderFilterElements = function () {
		this.headerFilterColumns.forEach(function (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				column.modules.filter.headerElement.style.display = '';
			}
		});
	};

	//programatically set focus of header filter
	Filter.prototype.setHeaderFilterFocus = function (column) {
		if (column.modules.filter && column.modules.filter.headerElement) {
			column.modules.filter.headerElement.focus();
		} else {
			console.warn("Column Filter Focus Error - No header filter set on column:", column.getField());
		}
	};

	//programmatically get value of header filter
	Filter.prototype.getHeaderFilterValue = function (column) {
		if (column.modules.filter && column.modules.filter.headerElement) {
			return column.modules.filter.headerElement.value;
		} else {
			console.warn("Column Filter Error - No header filter set on column:", column.getField());
		}
	};

	//programatically set value of header filter
	Filter.prototype.setHeaderFilterValue = function (column, value) {
		if (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				this.generateHeaderFilterElement(column, value, true);
				column.modules.filter.success(value);
			} else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	};

	Filter.prototype.reloadHeaderFilter = function (column) {
		if (column) {
			if (column.modules.filter && column.modules.filter.headerElement) {
				this.generateHeaderFilterElement(column, column.modules.filter.value, true);
			} else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	};

	//check if the filters has changed since last use
	Filter.prototype.hasChanged = function () {
		var changed = this.changed;
		this.changed = false;
		return changed;
	};

	//set standard filters
	Filter.prototype.setFilter = function (field, type, value) {
		var self = this;

		self.filterList = [];

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		self.addFilter(field);
	};

	//add filter to array
	Filter.prototype.addFilter = function (field, type, value) {
		var self = this;

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		field.forEach(function (filter) {

			filter = self.findFilter(filter);

			if (filter) {
				self.filterList.push(filter);

				self.changed = true;
			}
		});

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	Filter.prototype.findFilter = function (filter) {
		var self = this,
		    column;

		if (Array.isArray(filter)) {
			return this.findSubFilters(filter);
		}

		var filterFunc = false;

		if (typeof filter.field == "function") {
			filterFunc = function filterFunc(data) {
				return filter.field(data, filter.type || {}); // pass params to custom filter function
			};
		} else {

			if (self.filters[filter.type]) {

				column = self.table.columnManager.getColumnByField(filter.field);

				if (column) {
					filterFunc = function filterFunc(data) {
						return self.filters[filter.type](filter.value, column.getFieldValue(data));
					};
				} else {
					filterFunc = function filterFunc(data) {
						return self.filters[filter.type](filter.value, data[filter.field]);
					};
				}
			} else {
				console.warn("Filter Error - No such filter type found, ignoring: ", filter.type);
			}
		}

		filter.func = filterFunc;

		return filter.func ? filter : false;
	};

	Filter.prototype.findSubFilters = function (filters) {
		var self = this,
		    output = [];

		filters.forEach(function (filter) {
			filter = self.findFilter(filter);

			if (filter) {
				output.push(filter);
			}
		});

		return output.length ? output : false;
	};

	//get all filters
	Filter.prototype.getFilters = function (all, ajax) {
		var output = [];

		if (all) {
			output = this.getHeaderFilters();
		}

		if (ajax) {
			output.forEach(function (item) {
				if (typeof item.type == "function") {
					item.type = "function";
				}
			});
		}

		output = output.concat(this.filtersToArray(this.filterList, ajax));

		return output;
	};

	//filter to Object
	Filter.prototype.filtersToArray = function (filterList, ajax) {
		var _this50 = this;

		var output = [];

		filterList.forEach(function (filter) {
			var item;

			if (Array.isArray(filter)) {
				output.push(_this50.filtersToArray(filter, ajax));
			} else {
				item = { field: filter.field, type: filter.type, value: filter.value };

				if (ajax) {
					if (typeof item.type == "function") {
						item.type = "function";
					}
				}

				output.push(item);
			}
		});

		return output;
	};

	//get all filters
	Filter.prototype.getHeaderFilters = function () {
		var self = this,
		    output = [];

		for (var key in this.headerFilters) {
			output.push({ field: key, type: this.headerFilters[key].type, value: this.headerFilters[key].value });
		}

		return output;
	};

	//remove filter from array
	Filter.prototype.removeFilter = function (field, type, value) {
		var self = this;

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		field.forEach(function (filter) {
			var index = -1;

			if (_typeof(filter.field) == "object") {
				index = self.filterList.findIndex(function (element) {
					return filter === element;
				});
			} else {
				index = self.filterList.findIndex(function (element) {
					return filter.field === element.field && filter.type === element.type && filter.value === element.value;
				});
			}

			if (index > -1) {
				self.filterList.splice(index, 1);
				self.changed = true;
			} else {
				console.warn("Filter Error - No matching filter type found, ignoring: ", filter.type);
			}
		});

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	//clear filters
	Filter.prototype.clearFilter = function (all) {
		this.filterList = [];

		if (all) {
			this.clearHeaderFilter();
		}

		this.changed = true;

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.filter) {
			this.table.modules.persistence.save("filter");
		}
	};

	//clear header filters
	Filter.prototype.clearHeaderFilter = function () {
		var self = this;

		this.headerFilters = {};
		self.prevHeaderFilterChangeCheck = "{}";

		this.headerFilterColumns.forEach(function (column) {
			column.modules.filter.value = null;
			column.modules.filter.prevSuccess = undefined;
			self.reloadHeaderFilter(column);
		});

		this.changed = true;
	};

	//search data and return matching rows
	Filter.prototype.search = function (searchType, field, type, value) {
		var self = this,
		    activeRows = [],
		    filterList = [];

		if (!Array.isArray(field)) {
			field = [{ field: field, type: type, value: value }];
		}

		field.forEach(function (filter) {
			filter = self.findFilter(filter);

			if (filter) {
				filterList.push(filter);
			}
		});

		this.table.rowManager.rows.forEach(function (row) {
			var match = true;

			filterList.forEach(function (filter) {
				if (!self.filterRecurse(filter, row.getData())) {
					match = false;
				}
			});

			if (match) {
				activeRows.push(searchType === "data" ? row.getData("data") : row.getComponent());
			}
		});

		return activeRows;
	};

	//filter row array
	Filter.prototype.filter = function (rowList, filters) {
		var self = this,
		    activeRows = [],
		    activeRowComponents = [];

		if (self.table.options.dataFiltering) {
			self.table.options.dataFiltering.call(self.table, self.getFilters());
		}

		if (!self.table.options.ajaxFiltering && (self.filterList.length || Object.keys(self.headerFilters).length)) {

			rowList.forEach(function (row) {
				if (self.filterRow(row)) {
					activeRows.push(row);
				}
			});
		} else {
			activeRows = rowList.slice(0);
		}

		if (self.table.options.dataFiltered) {

			activeRows.forEach(function (row) {
				activeRowComponents.push(row.getComponent());
			});

			self.table.options.dataFiltered.call(self.table, self.getFilters(), activeRowComponents);
		}

		return activeRows;
	};

	//filter individual row
	Filter.prototype.filterRow = function (row, filters) {
		var self = this,
		    match = true,
		    data = row.getData();

		self.filterList.forEach(function (filter) {
			if (!self.filterRecurse(filter, data)) {
				match = false;
			}
		});

		for (var field in self.headerFilters) {
			if (!self.headerFilters[field].func(data)) {
				match = false;
			}
		}

		return match;
	};

	Filter.prototype.filterRecurse = function (filter, data) {
		var self = this,
		    match = false;

		if (Array.isArray(filter)) {
			filter.forEach(function (subFilter) {
				if (self.filterRecurse(subFilter, data)) {
					match = true;
				}
			});
		} else {
			match = filter.func(data);
		}

		return match;
	};

	//list of available filters
	Filter.prototype.filters = {

		//equal to
		"=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal == filterVal ? true : false;
		},

		//less than
		"<": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal < filterVal ? true : false;
		},

		//less than or equal to
		"<=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal <= filterVal ? true : false;
		},

		//greater than
		">": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal > filterVal ? true : false;
		},

		//greater than or equal to
		">=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal >= filterVal ? true : false;
		},

		//not equal to
		"!=": function _(filterVal, rowVal, rowData, filterParams) {
			return rowVal != filterVal ? true : false;
		},

		"regex": function regex(filterVal, rowVal, rowData, filterParams) {

			if (typeof filterVal == "string") {
				filterVal = new RegExp(filterVal);
			}

			return filterVal.test(rowVal);
		},

		//contains the string
		"like": function like(filterVal, rowVal, rowData, filterParams) {
			if (filterVal === null || typeof filterVal === "undefined") {
				return rowVal === filterVal ? true : false;
			} else {
				if (typeof rowVal !== 'undefined' && rowVal !== null) {
					return String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase()) > -1;
				} else {
					return false;
				}
			}
		},

		//in array
		"in": function _in(filterVal, rowVal, rowData, filterParams) {
			if (Array.isArray(filterVal)) {
				return filterVal.indexOf(rowVal) > -1;
			} else {
				console.warn("Filter Error - filter value is not an array:", filterVal);
				return false;
			}
		}
	};

	Tabulator.prototype.registerModule("filter", Filter);

	var Format = function Format(table) {
		this.table = table; //hold Tabulator object
	};

	//initialize column formatter
	Format.prototype.initializeColumn = function (column) {
		column.modules.format = this.lookupFormatter(column, "");

		if (typeof column.definition.formatterPrint !== "undefined") {
			column.modules.format.print = this.lookupFormatter(column, "Print");
		}

		if (typeof column.definition.formatterClipboard !== "undefined") {
			column.modules.format.clipboard = this.lookupFormatter(column, "Clipboard");
		}

		if (typeof column.definition.formatterHtmlOutput !== "undefined") {
			column.modules.format.htmlOutput = this.lookupFormatter(column, "HtmlOutput");
		}
	};

	Format.prototype.lookupFormatter = function (column, type) {
		var config = { params: column.definition["formatter" + type + "Params"] || {} },
		    formatter = column.definition["formatter" + type];

		//set column formatter
		switch (typeof formatter === 'undefined' ? 'undefined' : _typeof(formatter)) {
			case "string":

				if (formatter === "tick") {
					formatter = "tickCross";

					if (typeof config.params.crossElement == "undefined") {
						config.params.crossElement = false;
					}

					console.warn("DEPRECATION WARNING - the tick formatter has been deprecated, please use the tickCross formatter with the crossElement param set to false");
				}

				if (this.formatters[formatter]) {
					config.formatter = this.formatters[formatter];
				} else {
					console.warn("Formatter Error - No such formatter found: ", formatter);
					config.formatter = this.formatters.plaintext;
				}
				break;

			case "function":
				config.formatter = formatter;
				break;

			default:
				config.formatter = this.formatters.plaintext;
				break;
		}

		return config;
	};

	Format.prototype.cellRendered = function (cell) {
		if (cell.modules.format && cell.modules.format.renderedCallback) {
			cell.modules.format.renderedCallback();
		}
	};

	//return a formatted value for a cell
	Format.prototype.formatValue = function (cell) {
		var component = cell.getComponent(),
		    params = typeof cell.column.modules.format.params === "function" ? cell.column.modules.format.params(component) : cell.column.modules.format.params;

		function onRendered(callback) {
			if (!cell.modules.format) {
				cell.modules.format = {};
			}

			cell.modules.format.renderedCallback = callback;
		}

		return cell.column.modules.format.formatter.call(this, component, params, onRendered);
	};

	Format.prototype.formatExportValue = function (cell, type) {
		var formatter = cell.column.modules.format[type],
		    params;

		if (formatter) {
			var onRendered = function onRendered(callback) {
				if (!cell.modules.format) {
					cell.modules.format = {};
				}

				cell.modules.format.renderedCallback = callback;
			};

			params = typeof formatter.params === "function" ? formatter.params(component) : formatter.params;

			return formatter.formatter.call(this, cell.getComponent(), params, onRendered);
		} else {
			return this.formatValue(cell);
		}
	};

	Format.prototype.sanitizeHTML = function (value) {
		if (value) {
			var entityMap = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#39;',
				'/': '&#x2F;',
				'`': '&#x60;',
				'=': '&#x3D;'
			};

			return String(value).replace(/[&<>"'`=\/]/g, function (s) {
				return entityMap[s];
			});
		} else {
			return value;
		}
	};

	Format.prototype.emptyToSpace = function (value) {
		return value === null || typeof value === "undefined" ? "&nbsp;" : value;
	};

	//get formatter for cell
	Format.prototype.getFormatter = function (formatter) {
		var formatter;

		switch (typeof formatter === 'undefined' ? 'undefined' : _typeof(formatter)) {
			case "string":
				if (this.formatters[formatter]) {
					formatter = this.formatters[formatter];
				} else {
					console.warn("Formatter Error - No such formatter found: ", formatter);
					formatter = this.formatters.plaintext;
				}
				break;

			case "function":
				formatter = formatter;
				break;

			default:
				formatter = this.formatters.plaintext;
				break;
		}

		return formatter;
	};

	//default data formatters
	Format.prototype.formatters = {
		//plain text value
		plaintext: function plaintext(cell, formatterParams, onRendered) {
			return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
		},

		//html text value
		html: function html(cell, formatterParams, onRendered) {
			return cell.getValue();
		},

		//multiline text area
		textarea: function textarea(cell, formatterParams, onRendered) {
			cell.getElement().style.whiteSpace = "pre-wrap";
			return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
		},

		//currency formatting
		money: function money(cell, formatterParams, onRendered) {
			var floatVal = parseFloat(cell.getValue()),
			    number,
			    integer,
			    decimal,
			    rgx;

			var decimalSym = formatterParams.decimal || ".";
			var thousandSym = formatterParams.thousand || ",";
			var symbol = formatterParams.symbol || "";
			var after = !!formatterParams.symbolAfter;
			var precision = typeof formatterParams.precision !== "undefined" ? formatterParams.precision : 2;

			if (isNaN(floatVal)) {
				return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
			}

			number = precision !== false ? floatVal.toFixed(precision) : floatVal;
			number = String(number).split(".");

			integer = number[0];
			decimal = number.length > 1 ? decimalSym + number[1] : "";

			rgx = /(\d+)(\d{3})/;

			while (rgx.test(integer)) {
				integer = integer.replace(rgx, "$1" + thousandSym + "$2");
			}

			return after ? integer + decimal + symbol : symbol + integer + decimal;
		},

		//clickable anchor tag
		link: function link(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    urlPrefix = formatterParams.urlPrefix || "",
			    download = formatterParams.download,
			    label = value,
			    el = document.createElement("a"),
			    data;

			if (formatterParams.labelField) {
				data = cell.getData();
				label = data[formatterParams.labelField];
			}

			if (formatterParams.label) {
				switch (_typeof(formatterParams.label)) {
					case "string":
						label = formatterParams.label;
						break;

					case "function":
						label = formatterParams.label(cell);
						break;
				}
			}

			if (label) {
				if (formatterParams.urlField) {
					data = cell.getData();
					value = data[formatterParams.urlField];
				}

				if (formatterParams.url) {
					switch (_typeof(formatterParams.url)) {
						case "string":
							value = formatterParams.url;
							break;

						case "function":
							value = formatterParams.url(cell);
							break;
					}
				}

				el.setAttribute("href", urlPrefix + value);

				if (formatterParams.target) {
					el.setAttribute("target", formatterParams.target);
				}

				if (formatterParams.download) {

					if (typeof download == "function") {
						download = download(cell);
					} else {
						download = download === true ? "" : download;
					}

					el.setAttribute("download", download);
				}

				el.innerHTML = this.emptyToSpace(this.sanitizeHTML(label));

				return el;
			} else {
				return "&nbsp;";
			}
		},

		//image element
		image: function image(cell, formatterParams, onRendered) {
			var el = document.createElement("img");
			el.setAttribute("src", cell.getValue());

			switch (_typeof(formatterParams.height)) {
				case "number":
					el.style.height = formatterParams.height + "px";
					break;

				case "string":
					el.style.height = formatterParams.height;
					break;
			}

			switch (_typeof(formatterParams.width)) {
				case "number":
					el.style.width = formatterParams.width + "px";
					break;

				case "string":
					el.style.width = formatterParams.width;
					break;
			}

			el.addEventListener("load", function () {
				cell.getRow().normalizeHeight();
			});

			return el;
		},

		//tick or cross
		tickCross: function tickCross(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    element = cell.getElement(),
			    empty = formatterParams.allowEmpty,
			    truthy = formatterParams.allowTruthy,
			    tick = typeof formatterParams.tickElement !== "undefined" ? formatterParams.tickElement : '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',
			    cross = typeof formatterParams.crossElement !== "undefined" ? formatterParams.crossElement : '<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';

			if (truthy && value || value === true || value === "true" || value === "True" || value === 1 || value === "1") {
				element.setAttribute("aria-checked", true);
				return tick || "";
			} else {
				if (empty && (value === "null" || value === "" || value === null || typeof value === "undefined")) {
					element.setAttribute("aria-checked", "mixed");
					return "";
				} else {
					element.setAttribute("aria-checked", false);
					return cross || "";
				}
			}
		},

		datetime: function datetime(cell, formatterParams, onRendered) {
			var inputFormat = formatterParams.inputFormat || "YYYY-MM-DD hh:mm:ss";
			var outputFormat = formatterParams.outputFormat || "DD/MM/YYYY hh:mm:ss";
			var invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
			var value = cell.getValue();

			var newDatetime = moment(value, inputFormat);

			if (newDatetime.isValid()) {
				return newDatetime.format(outputFormat);
			} else {

				if (invalid === true) {
					return value;
				} else if (typeof invalid === "function") {
					return invalid(value);
				} else {
					return invalid;
				}
			}
		},

		datetimediff: function datetime(cell, formatterParams, onRendered) {
			var inputFormat = formatterParams.inputFormat || "YYYY-MM-DD hh:mm:ss";
			var invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
			var suffix = typeof formatterParams.suffix !== "undefined" ? formatterParams.suffix : false;
			var unit = typeof formatterParams.unit !== "undefined" ? formatterParams.unit : undefined;
			var humanize = typeof formatterParams.humanize !== "undefined" ? formatterParams.humanize : false;
			var date = typeof formatterParams.date !== "undefined" ? formatterParams.date : moment();
			var value = cell.getValue();

			var newDatetime = moment(value, inputFormat);

			if (newDatetime.isValid()) {
				if (humanize) {
					return moment.duration(newDatetime.diff(date)).humanize(suffix);
				} else {
					return newDatetime.diff(date, unit) + (suffix ? " " + suffix : "");
				}
			} else {

				if (invalid === true) {
					return value;
				} else if (typeof invalid === "function") {
					return invalid(value);
				} else {
					return invalid;
				}
			}
		},

		//select
		lookup: function lookup(cell, formatterParams, onRendered) {
			var value = cell.getValue();

			if (typeof formatterParams[value] === "undefined") {
				console.warn('Missing display value for ' + value);
				return value;
			}

			return formatterParams[value];
		},

		//star rating
		star: function star(cell, formatterParams, onRendered) {
			var value = cell.getValue(),
			    element = cell.getElement(),
			    maxStars = formatterParams && formatterParams.stars ? formatterParams.stars : 5,
			    stars = document.createElement("span"),
			    star = document.createElementNS('http://www.w3.org/2000/svg', "svg"),
			    starActive = '<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',
			    starInactive = '<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';

			//style stars holder
			stars.style.verticalAlign = "middle";

			//style star
			star.setAttribute("width", "14");
			star.setAttribute("height", "14");
			star.setAttribute("viewBox", "0 0 512 512");
			star.setAttribute("xml:space", "preserve");
			star.style.padding = "0 1px";

			value = value && !isNaN(value) ? parseInt(value) : 0;

			value = Math.max(0, Math.min(value, maxStars));

			for (var i = 1; i <= maxStars; i++) {
				var nextStar = star.cloneNode(true);
				nextStar.innerHTML = i <= value ? starActive : starInactive;

				stars.appendChild(nextStar);
			}

			element.style.whiteSpace = "nowrap";
			element.style.overflow = "hidden";
			element.style.textOverflow = "ellipsis";

			element.setAttribute("aria-label", value);

			return stars;
		},

		traffic: function traffic(cell, formatterParams, onRendered) {
			var value = this.sanitizeHTML(cell.getValue()) || 0,
			    el = document.createElement("span"),
			    max = formatterParams && formatterParams.max ? formatterParams.max : 100,
			    min = formatterParams && formatterParams.min ? formatterParams.min : 0,
			    colors = formatterParams && typeof formatterParams.color !== "undefined" ? formatterParams.color : ["red", "orange", "green"],
			    color = "#666666",
			    percent,
			    percentValue;

			if (isNaN(value) || typeof cell.getValue() === "undefined") {
				return;
			}

			el.classList.add("tabulator-traffic-light");

			//make sure value is in range
			percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
			percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

			//workout percentage
			percent = (max - min) / 100;
			percentValue = Math.round((percentValue - min) / percent);

			//set color
			switch (typeof colors === 'undefined' ? 'undefined' : _typeof(colors)) {
				case "string":
					color = colors;
					break;
				case "function":
					color = colors(value);
					break;
				case "object":
					if (Array.isArray(colors)) {
						var unit = 100 / colors.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, colors.length - 1);
						index = Math.max(index, 0);
						color = colors[index];
						break;
					}
			}

			el.style.backgroundColor = color;

			return el;
		},

		//progress bar
		progress: function progress(cell, formatterParams, onRendered) {
			//progress bar
			var value = this.sanitizeHTML(cell.getValue()) || 0,
			    element = cell.getElement(),
			    max = formatterParams && formatterParams.max ? formatterParams.max : 100,
			    min = formatterParams && formatterParams.min ? formatterParams.min : 0,
			    legendAlign = formatterParams && formatterParams.legendAlign ? formatterParams.legendAlign : "center",
			    percent,
			    percentValue,
			    color,
			    legend,
			    legendColor,
			    top,
			    left,
			    right,
			    bottom;

			//make sure value is in range
			percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
			percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

			//workout percentage
			percent = (max - min) / 100;
			percentValue = Math.round((percentValue - min) / percent);

			//set bar color
			switch (_typeof(formatterParams.color)) {
				case "string":
					color = formatterParams.color;
					break;
				case "function":
					color = formatterParams.color(value);
					break;
				case "object":
					if (Array.isArray(formatterParams.color)) {
						var unit = 100 / formatterParams.color.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, formatterParams.color.length - 1);
						index = Math.max(index, 0);
						color = formatterParams.color[index];
						break;
					}
				default:
					color = "#2DC214";
			}

			//generate legend
			switch (_typeof(formatterParams.legend)) {
				case "string":
					legend = formatterParams.legend;
					break;
				case "function":
					legend = formatterParams.legend(value);
					break;
				case "boolean":
					legend = value;
					break;
				default:
					legend = false;
			}

			//set legend color
			switch (_typeof(formatterParams.legendColor)) {
				case "string":
					legendColor = formatterParams.legendColor;
					break;
				case "function":
					legendColor = formatterParams.legendColor(value);
					break;
				case "object":
					if (Array.isArray(formatterParams.legendColor)) {
						var unit = 100 / formatterParams.legendColor.length;
						var index = Math.floor(percentValue / unit);

						index = Math.min(index, formatterParams.legendColor.length - 1);
						index = Math.max(index, 0);
						legendColor = formatterParams.legendColor[index];
					}
					break;
				default:
					legendColor = "#000";
			}

			element.style.minWidth = "30px";
			element.style.position = "relative";

			element.setAttribute("aria-label", percentValue);

			var barEl = document.createElement("div");
			barEl.style.display = "inline-block";
			barEl.style.position = "relative";
			barEl.style.width = percentValue + "%";
			barEl.style.backgroundColor = color;
			barEl.style.height = "100%";

			barEl.setAttribute('data-max', max);
			barEl.setAttribute('data-min', min);

			if (legend) {
				var legendEl = document.createElement("div");
				legendEl.style.position = "absolute";
				legendEl.style.top = "4px";
				legendEl.style.left = 0;
				legendEl.style.textAlign = legendAlign;
				legendEl.style.width = "100%";
				legendEl.style.color = legendColor;
				legendEl.innerHTML = legend;
			}

			onRendered(function () {

				//handle custom element needed if formatter is to be included in printed/downloaded output
				if (!(cell instanceof CellComponent)) {
					var holderEl = document.createElement("div");
					holderEl.style.position = "absolute";
					holderEl.style.top = "4px";
					holderEl.style.bottom = "4px";
					holderEl.style.left = "4px";
					holderEl.style.right = "4px";

					element.appendChild(holderEl);

					element = holderEl;
				}

				element.appendChild(barEl);

				if (legend) {
					element.appendChild(legendEl);
				}
			});

			return "";
		},

		//background color
		color: function color(cell, formatterParams, onRendered) {
			cell.getElement().style.backgroundColor = this.sanitizeHTML(cell.getValue());
			return "";
		},

		//tick icon
		buttonTick: function buttonTick(cell, formatterParams, onRendered) {
			return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>';
		},

		//cross icon
		buttonCross: function buttonCross(cell, formatterParams, onRendered) {
			return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';
		},

		//current row number
		rownum: function rownum(cell, formatterParams, onRendered) {
			return this.table.rowManager.activeRows.indexOf(cell.getRow()._getSelf()) + 1;
		},

		//row handle
		handle: function handle(cell, formatterParams, onRendered) {
			cell.getElement().classList.add("tabulator-row-handle");
			return "<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>";
		},

		responsiveCollapse: function responsiveCollapse(cell, formatterParams, onRendered) {
			var self = this,
			    open = false,
			    el = document.createElement("div"),
			    config = cell.getRow()._row.modules.responsiveLayout;

			el.classList.add("tabulator-responsive-collapse-toggle");
			el.innerHTML = "<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>";

			cell.getElement().classList.add("tabulator-row-handle");

			function toggleList(isOpen) {
				var collapseEl = config.element;

				config.open = isOpen;

				if (collapseEl) {

					if (config.open) {
						el.classList.add("open");
						collapseEl.style.display = '';
					} else {
						el.classList.remove("open");
						collapseEl.style.display = 'none';
					}
				}
			}

			el.addEventListener("click", function (e) {
				e.stopImmediatePropagation();
				toggleList(!config.open);
			});

			toggleList(config.open);

			return el;
		},

		rowSelection: function rowSelection(cell) {
			var _this51 = this;

			var checkbox = document.createElement("input");

			checkbox.type = 'checkbox';

			if (this.table.modExists("selectRow", true)) {

				checkbox.addEventListener("click", function (e) {
					e.stopPropagation();
				});

				if (typeof cell.getRow == 'function') {
					var row = cell.getRow();

					checkbox.addEventListener("change", function (e) {
						row.toggleSelect();
					});

					checkbox.checked = row.isSelected();
					this.table.modules.selectRow.registerRowSelectCheckbox(row, checkbox);
				} else {
					checkbox.addEventListener("change", function (e) {
						if (_this51.table.modules.selectRow.selectedRows.length) {
							_this51.table.deselectRow();
						} else {
							_this51.table.selectRow();
						}
					});

					this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);
				}
			}
			return checkbox;
		}
	};

	Tabulator.prototype.registerModule("format", Format);

	var FrozenColumns = function FrozenColumns(table) {
		this.table = table; //hold Tabulator object
		this.leftColumns = [];
		this.rightColumns = [];
		this.leftMargin = 0;
		this.rightMargin = 0;
		this.rightPadding = 0;
		this.initializationMode = "left";
		this.active = false;
		this.scrollEndTimer = false;
	};

	//reset initial state
	FrozenColumns.prototype.reset = function () {
		this.initializationMode = "left";
		this.leftColumns = [];
		this.rightColumns = [];
		this.leftMargin = 0;
		this.rightMargin = 0;
		this.rightMargin = 0;
		this.active = false;

		this.table.columnManager.headersElement.style.marginLeft = 0;
		this.table.columnManager.element.style.paddingRight = 0;
	};

	//initialize specific column
	FrozenColumns.prototype.initializeColumn = function (column) {
		var config = { margin: 0, edge: false };

		if (!column.isGroup) {

			if (this.frozenCheck(column)) {

				config.position = this.initializationMode;

				if (this.initializationMode == "left") {
					this.leftColumns.push(column);
				} else {
					this.rightColumns.unshift(column);
				}

				this.active = true;

				column.modules.frozen = config;
			} else {
				this.initializationMode = "right";
			}
		}
	};

	FrozenColumns.prototype.frozenCheck = function (column) {
		var frozen = false;

		if (column.parent.isGroup && column.definition.frozen) {
			console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups");
		}

		if (column.parent.isGroup) {
			return this.frozenCheck(column.parent);
		} else {
			return column.definition.frozen;
		}

		return frozen;
	};

	//quick layout to smooth horizontal scrolling
	FrozenColumns.prototype.scrollHorizontal = function () {
		var _this52 = this;

		var rows;

		if (this.active) {
			clearTimeout(this.scrollEndTimer);

			//layout all rows after scroll is complete
			this.scrollEndTimer = setTimeout(function () {
				_this52.layout();
			}, 100);

			rows = this.table.rowManager.getVisibleRows();

			this.calcMargins();

			this.layoutColumnPosition();

			this.layoutCalcRows();

			rows.forEach(function (row) {
				if (row.type === "row") {
					_this52.layoutRow(row);
				}
			});

			this.table.rowManager.tableElement.style.marginRight = this.rightMargin;
		}
	};

	//calculate margins for rows
	FrozenColumns.prototype.calcMargins = function () {
		this.leftMargin = this._calcSpace(this.leftColumns, this.leftColumns.length) + "px";
		this.table.columnManager.headersElement.style.marginLeft = this.leftMargin;

		this.rightMargin = this._calcSpace(this.rightColumns, this.rightColumns.length) + "px";
		this.table.columnManager.element.style.paddingRight = this.rightMargin;

		//calculate right frozen columns
		this.rightPadding = this.table.rowManager.element.clientWidth + this.table.columnManager.scrollLeft;
	};

	//layout calculation rows
	FrozenColumns.prototype.layoutCalcRows = function () {
		if (this.table.modExists("columnCalcs")) {
			if (this.table.modules.columnCalcs.topInitialized && this.table.modules.columnCalcs.topRow) {
				this.layoutRow(this.table.modules.columnCalcs.topRow);
			}
			if (this.table.modules.columnCalcs.botInitialized && this.table.modules.columnCalcs.botRow) {
				this.layoutRow(this.table.modules.columnCalcs.botRow);
			}
		}
	};

	//calculate column positions and layout headers
	FrozenColumns.prototype.layoutColumnPosition = function (allCells) {
		var _this53 = this;

		var leftParents = [];

		this.leftColumns.forEach(function (column, i) {
			column.modules.frozen.margin = _this53._calcSpace(_this53.leftColumns, i) + _this53.table.columnManager.scrollLeft + "px";

			if (i == _this53.leftColumns.length - 1) {
				column.modules.frozen.edge = true;
			} else {
				column.modules.frozen.edge = false;
			}

			if (column.parent.isGroup) {
				var parentEl = _this53.getColGroupParentElement(column);
				if (!leftParents.includes(parentEl)) {
					_this53.layoutElement(parentEl, column);
					leftParents.push(parentEl);
				}

				if (column.modules.frozen.edge) {
					parentEl.classList.add("tabulator-frozen-" + column.modules.frozen.position);
				}
			} else {
				_this53.layoutElement(column.getElement(), column);
			}

			if (allCells) {
				column.cells.forEach(function (cell) {
					_this53.layoutElement(cell.getElement(), column);
				});
			}
		});

		this.rightColumns.forEach(function (column, i) {
			column.modules.frozen.margin = _this53.rightPadding - _this53._calcSpace(_this53.rightColumns, i + 1) + "px";

			if (i == _this53.rightColumns.length - 1) {
				column.modules.frozen.edge = true;
			} else {
				column.modules.frozen.edge = false;
			}

			if (column.parent.isGroup) {
				_this53.layoutElement(_this53.getColGroupParentElement(column), column);
			} else {
				_this53.layoutElement(column.getElement(), column);
			}

			if (allCells) {
				column.cells.forEach(function (cell) {
					_this53.layoutElement(cell.getElement(), column);
				});
			}
		});
	};

	FrozenColumns.prototype.getColGroupParentElement = function (column) {
		return column.parent.isGroup ? this.getColGroupParentElement(column.parent) : column.getElement();
	};

	//layout columns appropropriatly
	FrozenColumns.prototype.layout = function () {
		var self = this,
		    rightMargin = 0;

		if (self.active) {

			//calculate row padding
			this.calcMargins();

			// self.table.rowManager.activeRows.forEach(function(row){
			// 	self.layoutRow(row);
			// });

			// if(self.table.options.dataTree){
			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row") {
					self.layoutRow(row);
				}
			});
			// }

			this.layoutCalcRows();

			//calculate left columns
			this.layoutColumnPosition(true);

			// if(tableHolder.scrollHeight > tableHolder.clientHeight){
			// 	rightMargin -= tableHolder.offsetWidth - tableHolder.clientWidth;
			// }

			this.table.rowManager.tableElement.style.marginRight = this.rightMargin;
		}
	};

	FrozenColumns.prototype.layoutRow = function (row) {
		var _this54 = this;

		var rowEl = row.getElement();

		rowEl.style.paddingLeft = this.leftMargin;
		// rowEl.style.paddingRight = this.rightMargin + "px";

		this.leftColumns.forEach(function (column) {
			var cell = row.getCell(column);

			if (cell) {
				_this54.layoutElement(cell.getElement(), column);
			}
		});

		this.rightColumns.forEach(function (column) {
			var cell = row.getCell(column);

			if (cell) {
				_this54.layoutElement(cell.getElement(), column);
			}
		});
	};

	FrozenColumns.prototype.layoutElement = function (element, column) {

		if (column.modules.frozen) {
			element.style.position = "absolute";
			element.style.left = column.modules.frozen.margin;

			element.classList.add("tabulator-frozen");

			if (column.modules.frozen.edge) {
				element.classList.add("tabulator-frozen-" + column.modules.frozen.position);
			}
		}
	};

	FrozenColumns.prototype._calcSpace = function (columns, index) {
		var width = 0;

		for (var i = 0; i < index; i++) {
			if (columns[i].visible) {
				width += columns[i].getWidth();
			}
		}

		return width;
	};

	Tabulator.prototype.registerModule("frozenColumns", FrozenColumns);
	var FrozenRows = function FrozenRows(table) {
		this.table = table; //hold Tabulator object
		this.topElement = document.createElement("div");
		this.rows = [];
		this.displayIndex = 0; //index in display pipeline
	};

	FrozenRows.prototype.initialize = function () {
		this.rows = [];

		this.topElement.classList.add("tabulator-frozen-rows-holder");

		// this.table.columnManager.element.append(this.topElement);
		this.table.columnManager.getElement().insertBefore(this.topElement, this.table.columnManager.headersElement.nextSibling);
	};

	FrozenRows.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	FrozenRows.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	FrozenRows.prototype.isFrozen = function () {
		return !!this.rows.length;
	};

	//filter frozen rows out of display data
	FrozenRows.prototype.getRows = function (rows) {
		var self = this,
		    frozen = [],
		    output = rows.slice(0);

		this.rows.forEach(function (row) {
			var index = output.indexOf(row);

			if (index > -1) {
				output.splice(index, 1);
			}
		});

		return output;
	};

	FrozenRows.prototype.freezeRow = function (row) {
		if (!row.modules.frozen) {
			row.modules.frozen = true;
			this.topElement.appendChild(row.getElement());
			row.initialize();
			row.normalizeHeight();
			this.table.rowManager.adjustTableSize();

			this.rows.push(row);

			this.table.rowManager.refreshActiveData("display");

			this.styleRows();
		} else {
			console.warn("Freeze Error - Row is already frozen");
		}
	};

	FrozenRows.prototype.unfreezeRow = function (row) {
		var index = this.rows.indexOf(row);

		if (row.modules.frozen) {

			row.modules.frozen = false;

			var rowEl = row.getElement();
			rowEl.parentNode.removeChild(rowEl);

			this.table.rowManager.adjustTableSize();

			this.rows.splice(index, 1);

			this.table.rowManager.refreshActiveData("display");

			if (this.rows.length) {
				this.styleRows();
			}
		} else {
			console.warn("Freeze Error - Row is already unfrozen");
		}
	};

	FrozenRows.prototype.styleRows = function (row) {
		var self = this;

		this.rows.forEach(function (row, i) {
			self.table.rowManager.styleRow(row, i);
		});
	};

	Tabulator.prototype.registerModule("frozenRows", FrozenRows);

	//public group object
	var GroupComponent = function GroupComponent(group) {
		this._group = group;
		this.type = "GroupComponent";
	};

	GroupComponent.prototype.getKey = function () {
		return this._group.key;
	};

	GroupComponent.prototype.getField = function () {
		return this._group.field;
	};

	GroupComponent.prototype.getElement = function () {
		return this._group.element;
	};

	GroupComponent.prototype.getRows = function () {
		return this._group.getRows(true);
	};

	GroupComponent.prototype.getSubGroups = function () {
		return this._group.getSubGroups(true);
	};

	GroupComponent.prototype.getParentGroup = function () {
		return this._group.parent ? this._group.parent.getComponent() : false;
	};

	GroupComponent.prototype.getVisibility = function () {
		return this._group.visible;
	};

	GroupComponent.prototype.show = function () {
		this._group.show();
	};

	GroupComponent.prototype.hide = function () {
		this._group.hide();
	};

	GroupComponent.prototype.toggle = function () {
		this._group.toggleVisibility();
	};

	GroupComponent.prototype._getSelf = function () {
		return this._group;
	};

	GroupComponent.prototype.getTable = function () {
		return this._group.groupManager.table;
	};

	//////////////////////////////////////////////////
	//////////////// Group Functions /////////////////
	//////////////////////////////////////////////////

	var Group = function Group(groupManager, parent, level, key, field, generator, oldGroup) {

		this.groupManager = groupManager;
		this.parent = parent;
		this.key = key;
		this.level = level;
		this.field = field;
		this.hasSubGroups = level < groupManager.groupIDLookups.length - 1;
		this.addRow = this.hasSubGroups ? this._addRowToGroup : this._addRow;
		this.type = "group"; //type of element
		this.old = oldGroup;
		this.rows = [];
		this.groups = [];
		this.groupList = [];
		this.generator = generator;
		this.elementContents = false;
		this.height = 0;
		this.outerHeight = 0;
		this.initialized = false;
		this.calcs = {};
		this.initialized = false;
		this.modules = {};
		this.arrowElement = false;

		this.visible = oldGroup ? oldGroup.visible : typeof groupManager.startOpen[level] !== "undefined" ? groupManager.startOpen[level] : groupManager.startOpen[0];

		this.createElements();
		this.addBindings();

		this.createValueGroups();
	};

	Group.prototype.wipe = function () {
		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				group.wipe();
			});
		} else {
			this.element = false;
			this.arrowElement = false;
			this.elementContents = false;
		}
	};

	Group.prototype.createElements = function () {
		var arrow = document.createElement("div");
		arrow.classList.add("tabulator-arrow");

		this.element = document.createElement("div");
		this.element.classList.add("tabulator-row");
		this.element.classList.add("tabulator-group");
		this.element.classList.add("tabulator-group-level-" + this.level);
		this.element.setAttribute("role", "rowgroup");

		this.arrowElement = document.createElement("div");
		this.arrowElement.classList.add("tabulator-group-toggle");
		this.arrowElement.appendChild(arrow);

		//setup movable rows
		if (this.groupManager.table.options.movableRows !== false && this.groupManager.table.modExists("moveRow")) {
			this.groupManager.table.modules.moveRow.initializeGroupHeader(this);
		}
	};

	Group.prototype.createValueGroups = function () {
		var _this55 = this;

		var level = this.level + 1;
		if (this.groupManager.allowedValues && this.groupManager.allowedValues[level]) {
			this.groupManager.allowedValues[level].forEach(function (value) {
				_this55._createGroup(value, level);
			});
		}
	};

	Group.prototype.addBindings = function () {
		var self = this,
		    dblTap,
		    tapHold,
		    tap,
		    toggleElement;

		//handle group click events
		if (self.groupManager.table.options.groupClick) {
			self.element.addEventListener("click", function (e) {
				self.groupManager.table.options.groupClick.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupDblClick) {
			self.element.addEventListener("dblclick", function (e) {
				self.groupManager.table.options.groupDblClick.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupContext) {
			self.element.addEventListener("contextmenu", function (e) {
				self.groupManager.table.options.groupContext.call(self.groupManager.table, e, self.getComponent());
			});
		}

		if (self.groupManager.table.options.groupTap) {

			tap = false;

			self.element.addEventListener("touchstart", function (e) {
				tap = true;
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {
				if (tap) {
					self.groupManager.table.options.groupTap(e, self.getComponent());
				}

				tap = false;
			});
		}

		if (self.groupManager.table.options.groupDblTap) {

			dblTap = null;

			self.element.addEventListener("touchend", function (e) {

				if (dblTap) {
					clearTimeout(dblTap);
					dblTap = null;

					self.groupManager.table.options.groupDblTap(e, self.getComponent());
				} else {

					dblTap = setTimeout(function () {
						clearTimeout(dblTap);
						dblTap = null;
					}, 300);
				}
			});
		}

		if (self.groupManager.table.options.groupTapHold) {

			tapHold = null;

			self.element.addEventListener("touchstart", function (e) {
				clearTimeout(tapHold);

				tapHold = setTimeout(function () {
					clearTimeout(tapHold);
					tapHold = null;
					tap = false;
					self.groupManager.table.options.groupTapHold(e, self.getComponent());
				}, 1000);
			}, { passive: true });

			self.element.addEventListener("touchend", function (e) {
				clearTimeout(tapHold);
				tapHold = null;
			});
		}

		if (self.groupManager.table.options.groupToggleElement) {
			toggleElement = self.groupManager.table.options.groupToggleElement == "arrow" ? self.arrowElement : self.element;

			toggleElement.addEventListener("click", function (e) {
				e.stopPropagation();
				e.stopImmediatePropagation();
				self.toggleVisibility();
			});
		}
	};

	Group.prototype._createGroup = function (groupID, level) {
		var groupKey = level + "_" + groupID;
		var group = new Group(this.groupManager, this, level, groupID, this.groupManager.groupIDLookups[level].field, this.groupManager.headerGenerator[level] || this.groupManager.headerGenerator[0], this.old ? this.old.groups[groupKey] : false);

		this.groups[groupKey] = group;
		this.groupList.push(group);
	};

	Group.prototype._addRowToGroup = function (row) {

		var level = this.level + 1;

		if (this.hasSubGroups) {
			var groupID = this.groupManager.groupIDLookups[level].func(row.getData()),
			    groupKey = level + "_" + groupID;

			if (this.groupManager.allowedValues && this.groupManager.allowedValues[level]) {
				if (this.groups[groupKey]) {
					this.groups[groupKey].addRow(row);
				}
			} else {
				if (!this.groups[groupKey]) {
					this._createGroup(groupID, level);
				}

				this.groups[groupKey].addRow(row);
			}
		}
	};

	Group.prototype._addRow = function (row) {
		this.rows.push(row);
		row.modules.group = this;
	};

	Group.prototype.insertRow = function (row, to, after) {
		var data = this.conformRowData({});

		row.updateData(data);

		var toIndex = this.rows.indexOf(to);

		if (toIndex > -1) {
			if (after) {
				this.rows.splice(toIndex + 1, 0, row);
			} else {
				this.rows.splice(toIndex, 0, row);
			}
		} else {
			if (after) {
				this.rows.push(row);
			} else {
				this.rows.unshift(row);
			}
		}

		row.modules.group = this;

		this.generateGroupHeaderContents();

		if (this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table") {
			this.groupManager.table.modules.columnCalcs.recalcGroup(this);
		}

		this.groupManager.updateGroupRows(true);
	};

	Group.prototype.scrollHeader = function (left) {
		this.arrowElement.style.marginLeft = left;

		this.groupList.forEach(function (child) {
			child.scrollHeader(left);
		});
	};

	Group.prototype.getRowIndex = function (row) {};

	//update row data to match grouping contraints
	Group.prototype.conformRowData = function (data) {
		if (this.field) {
			data[this.field] = this.key;
		} else {
			console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function");
		}

		if (this.parent) {
			data = this.parent.conformRowData(data);
		}

		return data;
	};

	Group.prototype.removeRow = function (row) {
		var index = this.rows.indexOf(row);
		var el = row.getElement();

		if (index > -1) {
			this.rows.splice(index, 1);
		}

		if (!this.groupManager.table.options.groupValues && !this.rows.length) {
			if (this.parent) {
				this.parent.removeGroup(this);
			} else {
				this.groupManager.removeGroup(this);
			}

			this.groupManager.updateGroupRows(true);
		} else {

			if (el.parentNode) {
				el.parentNode.removeChild(el);
			}

			this.generateGroupHeaderContents();

			if (this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table") {
				this.groupManager.table.modules.columnCalcs.recalcGroup(this);
			}
		}
	};

	Group.prototype.removeGroup = function (group) {
		var groupKey = group.level + "_" + group.key,
		    index;

		if (this.groups[groupKey]) {
			delete this.groups[groupKey];

			index = this.groupList.indexOf(group);

			if (index > -1) {
				this.groupList.splice(index, 1);
			}

			if (!this.groupList.length) {
				if (this.parent) {
					this.parent.removeGroup(this);
				} else {
					this.groupManager.removeGroup(this);
				}
			}
		}
	};

	Group.prototype.getHeadersAndRows = function (noCalc) {
		var output = [];

		output.push(this);

		this._visSet();

		if (this.visible) {
			if (this.groupList.length) {
				this.groupList.forEach(function (group) {
					output = output.concat(group.getHeadersAndRows(noCalc));
				});
			} else {
				if (!noCalc && this.groupManager.table.options.columnCalcs != "table" && this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasTopCalcs()) {
					if (this.calcs.top) {
						this.calcs.top.detachElement();
						this.calcs.top.deleteCells();
					}

					this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
					output.push(this.calcs.top);
				}

				output = output.concat(this.rows);

				if (!noCalc && this.groupManager.table.options.columnCalcs != "table" && this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasBottomCalcs()) {
					if (this.calcs.bottom) {
						this.calcs.bottom.detachElement();
						this.calcs.bottom.deleteCells();
					}

					this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
					output.push(this.calcs.bottom);
				}
			}
		} else {
			if (!this.groupList.length && this.groupManager.table.options.columnCalcs != "table") {

				if (this.groupManager.table.modExists("columnCalcs")) {

					if (!noCalc && this.groupManager.table.modules.columnCalcs.hasTopCalcs()) {
						if (this.calcs.top) {
							this.calcs.top.detachElement();
							this.calcs.top.deleteCells();
						}

						if (this.groupManager.table.options.groupClosedShowCalcs) {
							this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
							output.push(this.calcs.top);
						}
					}

					if (!noCalc && this.groupManager.table.modules.columnCalcs.hasBottomCalcs()) {
						if (this.calcs.bottom) {
							this.calcs.bottom.detachElement();
							this.calcs.bottom.deleteCells();
						}

						if (this.groupManager.table.options.groupClosedShowCalcs) {
							this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
							output.push(this.calcs.bottom);
						}
					}
				}
			}
		}

		return output;
	};

	Group.prototype.getData = function (visible, transform) {
		var self = this,
		    output = [];

		this._visSet();

		if (!visible || visible && this.visible) {
			this.rows.forEach(function (row) {
				output.push(row.getData(transform || "data"));
			});
		}

		return output;
	};

	// Group.prototype.getRows = function(){
	// 	this._visSet();

	// 	return this.visible ? this.rows : [];
	// };

	Group.prototype.getRowCount = function () {
		var count = 0;

		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				count += group.getRowCount();
			});
		} else {
			count = this.rows.length;
		}
		return count;
	};

	Group.prototype.toggleVisibility = function () {
		if (this.visible) {
			this.hide();
		} else {
			this.show();
		}
	};

	Group.prototype.hide = function () {
		this.visible = false;

		if (this.groupManager.table.rowManager.getRenderMode() == "classic" && !this.groupManager.table.options.pagination) {

			this.element.classList.remove("tabulator-group-visible");

			if (this.groupList.length) {
				this.groupList.forEach(function (group) {

					var rows = group.getHeadersAndRows();

					rows.forEach(function (row) {
						row.detachElement();
					});
				});
			} else {
				this.rows.forEach(function (row) {
					var rowEl = row.getElement();
					rowEl.parentNode.removeChild(rowEl);
				});
			}

			this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(), this.groupManager.getDisplayIndex());

			this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth();
		} else {
			this.groupManager.updateGroupRows(true);
		}

		this.groupManager.table.options.groupVisibilityChanged.call(this.table, this.getComponent(), false);
	};

	Group.prototype.show = function () {
		var self = this;

		self.visible = true;

		if (this.groupManager.table.rowManager.getRenderMode() == "classic" && !this.groupManager.table.options.pagination) {

			this.element.classList.add("tabulator-group-visible");

			var prev = self.getElement();

			if (this.groupList.length) {
				this.groupList.forEach(function (group) {
					var rows = group.getHeadersAndRows();

					rows.forEach(function (row) {
						var rowEl = row.getElement();
						prev.parentNode.insertBefore(rowEl, prev.nextSibling);
						row.initialize();
						prev = rowEl;
					});
				});
			} else {
				self.rows.forEach(function (row) {
					var rowEl = row.getElement();
					prev.parentNode.insertBefore(rowEl, prev.nextSibling);
					row.initialize();
					prev = rowEl;
				});
			}

			this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(), this.groupManager.getDisplayIndex());

			this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth();
		} else {
			this.groupManager.updateGroupRows(true);
		}

		this.groupManager.table.options.groupVisibilityChanged.call(this.table, this.getComponent(), true);
	};

	Group.prototype._visSet = function () {
		var data = [];

		if (typeof this.visible == "function") {

			this.rows.forEach(function (row) {
				data.push(row.getData());
			});

			this.visible = this.visible(this.key, this.getRowCount(), data, this.getComponent());
		}
	};

	Group.prototype.getRowGroup = function (row) {
		var match = false;
		if (this.groupList.length) {
			this.groupList.forEach(function (group) {
				var result = group.getRowGroup(row);

				if (result) {
					match = result;
				}
			});
		} else {
			if (this.rows.find(function (item) {
				return item === row;
			})) {
				match = this;
			}
		}

		return match;
	};

	Group.prototype.getSubGroups = function (component) {
		var output = [];

		this.groupList.forEach(function (child) {
			output.push(component ? child.getComponent() : child);
		});

		return output;
	};

	Group.prototype.getRows = function (compoment) {
		var output = [];

		this.rows.forEach(function (row) {
			output.push(compoment ? row.getComponent() : row);
		});

		return output;
	};

	Group.prototype.generateGroupHeaderContents = function () {
		var data = [];

		this.rows.forEach(function (row) {
			data.push(row.getData());
		});

		this.elementContents = this.generator(this.key, this.getRowCount(), data, this.getComponent());

		while (this.element.firstChild) {
			this.element.removeChild(this.element.firstChild);
		}if (typeof this.elementContents === "string") {
			this.element.innerHTML = this.elementContents;
		} else {
			this.element.appendChild(this.elementContents);
		}

		this.element.insertBefore(this.arrowElement, this.element.firstChild);
	};

	////////////// Standard Row Functions //////////////

	Group.prototype.getElement = function () {
		this.addBindingsd = false;

		this._visSet();

		if (this.visible) {
			this.element.classList.add("tabulator-group-visible");
		} else {
			this.element.classList.remove("tabulator-group-visible");
		}

		for (var i = 0; i < this.element.childNodes.length; ++i) {
			this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);
		}

		this.generateGroupHeaderContents();

		// this.addBindings();

		return this.element;
	};

	Group.prototype.detachElement = function () {
		if (this.element && this.element.parentNode) {
			this.element.parentNode.removeChild(this.element);
		}
	};

	//normalize the height of elements in the row
	Group.prototype.normalizeHeight = function () {
		this.setHeight(this.element.clientHeight);
	};

	Group.prototype.initialize = function (force) {
		if (!this.initialized || force) {
			this.normalizeHeight();
			this.initialized = true;
		}
	};

	Group.prototype.reinitialize = function () {
		this.initialized = false;
		this.height = 0;

		if (Tabulator.prototype.helpers.elVisible(this.element)) {
			this.initialize(true);
		}
	};

	Group.prototype.setHeight = function (height) {
		if (this.height != height) {
			this.height = height;
			this.outerHeight = this.element.offsetHeight;
		}
	};

	//return rows outer height
	Group.prototype.getHeight = function () {
		return this.outerHeight;
	};

	Group.prototype.getGroup = function () {
		return this;
	};

	Group.prototype.reinitializeHeight = function () {};
	Group.prototype.calcHeight = function () {};
	Group.prototype.setCellHeight = function () {};
	Group.prototype.clearCellHeight = function () {};

	//////////////// Object Generation /////////////////
	Group.prototype.getComponent = function () {
		return new GroupComponent(this);
	};

	//////////////////////////////////////////////////
	////////////// Group Row Extension ///////////////
	//////////////////////////////////////////////////

	var GroupRows = function GroupRows(table) {

		this.table = table; //hold Tabulator object

		this.groupIDLookups = false; //enable table grouping and set field to group by
		this.startOpen = [function () {
			return false;
		}]; //starting state of group
		this.headerGenerator = [function () {
			return "";
		}];
		this.groupList = []; //ordered list of groups
		this.allowedValues = false;
		this.groups = {}; //hold row groups
		this.displayIndex = 0; //index in display pipeline
	};

	//initialize group configuration
	GroupRows.prototype.initialize = function () {
		var self = this,
		    groupBy = self.table.options.groupBy,
		    startOpen = self.table.options.groupStartOpen,
		    groupHeader = self.table.options.groupHeader;

		this.allowedValues = self.table.options.groupValues;

		if (Array.isArray(groupBy) && Array.isArray(groupHeader) && groupBy.length > groupHeader.length) {
			console.warn("Error creating group headers, groupHeader array is shorter than groupBy array");
		}

		self.headerGenerator = [function () {
			return "";
		}];
		this.startOpen = [function () {
			return false;
		}]; //starting state of group

		self.table.modules.localize.bind("groups|item", function (langValue, lang) {
			self.headerGenerator[0] = function (value, count, data) {
				//header layout function
				return (typeof value === "undefined" ? "" : value) + "<span>(" + count + " " + (count === 1 ? langValue : lang.groups.items) + ")</span>";
			};
		});

		this.groupIDLookups = [];

		if (Array.isArray(groupBy) || groupBy) {
			if (this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "table" && this.table.options.columnCalcs != "both") {
				this.table.modules.columnCalcs.removeCalcs();
			}
		} else {
			if (this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "group") {

				var cols = this.table.columnManager.getRealColumns();

				cols.forEach(function (col) {
					if (col.definition.topCalc) {
						self.table.modules.columnCalcs.initializeTopRow();
					}

					if (col.definition.bottomCalc) {
						self.table.modules.columnCalcs.initializeBottomRow();
					}
				});
			}
		}

		if (!Array.isArray(groupBy)) {
			groupBy = [groupBy];
		}

		groupBy.forEach(function (group, i) {
			var lookupFunc, column;

			if (typeof group == "function") {
				lookupFunc = group;
			} else {
				column = self.table.columnManager.getColumnByField(group);

				if (column) {
					lookupFunc = function lookupFunc(data) {
						return column.getFieldValue(data);
					};
				} else {
					lookupFunc = function lookupFunc(data) {
						return data[group];
					};
				}
			}

			self.groupIDLookups.push({
				field: typeof group === "function" ? false : group,
				func: lookupFunc,
				values: self.allowedValues ? self.allowedValues[i] : false
			});
		});

		if (startOpen) {

			if (!Array.isArray(startOpen)) {
				startOpen = [startOpen];
			}

			startOpen.forEach(function (level) {
				level = typeof level == "function" ? level : function () {
					return true;
				};
			});

			self.startOpen = startOpen;
		}

		if (groupHeader) {
			self.headerGenerator = Array.isArray(groupHeader) ? groupHeader : [groupHeader];
		}

		this.initialized = true;
	};

	GroupRows.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	GroupRows.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	//return appropriate rows with group headers
	GroupRows.prototype.getRows = function (rows) {
		if (this.groupIDLookups.length) {

			this.table.options.dataGrouping.call(this.table);

			this.generateGroups(rows);

			if (this.table.options.dataGrouped) {
				this.table.options.dataGrouped.call(this.table, this.getGroups(true));
			}

			return this.updateGroupRows();
		} else {
			return rows.slice(0);
		}
	};

	GroupRows.prototype.getGroups = function (compoment) {
		var groupComponents = [];

		this.groupList.forEach(function (group) {
			groupComponents.push(compoment ? group.getComponent() : group);
		});

		return groupComponents;
	};

	GroupRows.prototype.getChildGroups = function (group) {
		var _this56 = this;

		var groupComponents = [];

		if (!group) {
			group = this;
		}

		group.groupList.forEach(function (child) {
			if (child.groupList.length) {
				groupComponents = groupComponents.concat(_this56.getChildGroups(child));
			} else {
				groupComponents.push(child);
			}
		});

		return groupComponents;
	};

	GroupRows.prototype.wipe = function () {
		this.groupList.forEach(function (group) {
			group.wipe();
		});
	};

	GroupRows.prototype.pullGroupListData = function (groupList) {
		var self = this;
		var groupListData = [];

		groupList.forEach(function (group) {
			var groupHeader = {};
			groupHeader.level = 0;
			groupHeader.rowCount = 0;
			groupHeader.headerContent = "";
			var childData = [];

			if (group.hasSubGroups) {
				childData = self.pullGroupListData(group.groupList);

				groupHeader.level = group.level;
				groupHeader.rowCount = childData.length - group.groupList.length; // data length minus number of sub-headers
				groupHeader.headerContent = group.generator(group.key, groupHeader.rowCount, group.rows, group);

				groupListData.push(groupHeader);
				groupListData = groupListData.concat(childData);
			} else {
				groupHeader.level = group.level;
				groupHeader.headerContent = group.generator(group.key, group.rows.length, group.rows, group);
				groupHeader.rowCount = group.getRows().length;

				groupListData.push(groupHeader);

				group.getRows().forEach(function (row) {
					groupListData.push(row.getData("data"));
				});
			}
		});

		return groupListData;
	};

	GroupRows.prototype.getGroupedData = function () {

		return this.pullGroupListData(this.groupList);
	};

	GroupRows.prototype.getRowGroup = function (row) {
		var match = false;

		this.groupList.forEach(function (group) {
			var result = group.getRowGroup(row);

			if (result) {
				match = result;
			}
		});

		return match;
	};

	GroupRows.prototype.countGroups = function () {
		return this.groupList.length;
	};

	GroupRows.prototype.generateGroups = function (rows) {
		var self = this,
		    oldGroups = self.groups;

		self.groups = {};
		self.groupList = [];

		if (this.allowedValues && this.allowedValues[0]) {
			this.allowedValues[0].forEach(function (value) {
				self.createGroup(value, 0, oldGroups);
			});

			rows.forEach(function (row) {
				self.assignRowToExistingGroup(row, oldGroups);
			});
		} else {
			rows.forEach(function (row) {
				self.assignRowToGroup(row, oldGroups);
			});
		}
	};

	GroupRows.prototype.createGroup = function (groupID, level, oldGroups) {
		var groupKey = level + "_" + groupID,
		    group;

		oldGroups = oldGroups || [];

		group = new Group(this, false, level, groupID, this.groupIDLookups[0].field, this.headerGenerator[0], oldGroups[groupKey]);

		this.groups[groupKey] = group;
		this.groupList.push(group);
	};

	// GroupRows.prototype.assignRowToGroup = function(row, oldGroups){
	// 	var groupID = this.groupIDLookups[0].func(row.getData()),
	// 	groupKey = "0_" + groupID;

	// 	if(!this.groups[groupKey]){
	// 		this.createGroup(groupID, 0, oldGroups);
	// 	}

	// 	this.groups[groupKey].addRow(row);
	// };

	GroupRows.prototype.assignRowToExistingGroup = function (row, oldGroups) {
		var groupID = this.groupIDLookups[0].func(row.getData()),
		    groupKey = "0_" + groupID;

		if (this.groups[groupKey]) {
			this.groups[groupKey].addRow(row);
		}
	};

	GroupRows.prototype.assignRowToGroup = function (row, oldGroups) {
		var groupID = this.groupIDLookups[0].func(row.getData()),
		    newGroupNeeded = !this.groups["0_" + groupID];

		if (newGroupNeeded) {
			this.createGroup(groupID, 0, oldGroups);
		}

		this.groups["0_" + groupID].addRow(row);

		return !newGroupNeeded;
	};

	GroupRows.prototype.updateGroupRows = function (force) {
		var self = this,
		    output = [],
		    oldRowCount;

		self.groupList.forEach(function (group) {
			output = output.concat(group.getHeadersAndRows());
		});

		//force update of table display
		if (force) {

			var displayIndex = self.table.rowManager.setDisplayRows(output, this.getDisplayIndex());

			if (displayIndex !== true) {
				this.setDisplayIndex(displayIndex);
			}

			self.table.rowManager.refreshActiveData("group", true, true);
		}

		return output;
	};

	GroupRows.prototype.scrollHeaders = function (left) {
		left = left + "px";

		this.groupList.forEach(function (group) {
			group.scrollHeader(left);
		});
	};

	GroupRows.prototype.removeGroup = function (group) {
		var groupKey = group.level + "_" + group.key,
		    index;

		if (this.groups[groupKey]) {
			delete this.groups[groupKey];

			index = this.groupList.indexOf(group);

			if (index > -1) {
				this.groupList.splice(index, 1);
			}
		}
	};

	Tabulator.prototype.registerModule("groupRows", GroupRows);
	var History = function History(table) {
		this.table = table; //hold Tabulator object

		this.history = [];
		this.index = -1;
	};

	History.prototype.clear = function () {
		this.history = [];
		this.index = -1;
	};

	History.prototype.action = function (type, component, data) {

		this.history = this.history.slice(0, this.index + 1);

		this.history.push({
			type: type,
			component: component,
			data: data
		});

		this.index++;
	};

	History.prototype.getHistoryUndoSize = function () {
		return this.index + 1;
	};

	History.prototype.getHistoryRedoSize = function () {
		return this.history.length - (this.index + 1);
	};

	History.prototype.undo = function () {

		if (this.index > -1) {
			var action = this.history[this.index];

			this.undoers[action.type].call(this, action);

			this.index--;

			this.table.options.historyUndo.call(this.table, action.type, action.component.getComponent(), action.data);

			return true;
		} else {
			console.warn("History Undo Error - No more history to undo");
			return false;
		}
	};

	History.prototype.redo = function () {
		if (this.history.length - 1 > this.index) {

			this.index++;

			var action = this.history[this.index];

			this.redoers[action.type].call(this, action);

			this.table.options.historyRedo.call(this.table, action.type, action.component.getComponent(), action.data);

			return true;
		} else {
			console.warn("History Redo Error - No more history to redo");
			return false;
		}
	};

	History.prototype.undoers = {
		cellEdit: function cellEdit(action) {
			action.component.setValueProcessData(action.data.oldValue);
		},

		rowAdd: function rowAdd(action) {
			action.component.deleteActual();
		},

		rowDelete: function rowDelete(action) {
			var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {
				this.table.modules.groupRows.updateGroupRows(true);
			}

			this._rebindRow(action.component, newRow);
		},

		rowMove: function rowMove(action) {
			this.table.rowManager.moveRowActual(action.component, this.table.rowManager.rows[action.data.posFrom], !action.data.after);
			this.table.rowManager.redraw();
		}
	};

	History.prototype.redoers = {
		cellEdit: function cellEdit(action) {
			action.component.setValueProcessData(action.data.newValue);
		},

		rowAdd: function rowAdd(action) {
			var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

			if (this.table.options.groupBy && this.table.modExists("groupRows")) {
				this.table.modules.groupRows.updateGroupRows(true);
			}

			this._rebindRow(action.component, newRow);
		},

		rowDelete: function rowDelete(action) {
			action.component.deleteActual();
		},

		rowMove: function rowMove(action) {
			this.table.rowManager.moveRowActual(action.component, this.table.rowManager.rows[action.data.posTo], action.data.after);
			this.table.rowManager.redraw();
		}
	};

	//rebind rows to new element after deletion
	History.prototype._rebindRow = function (oldRow, newRow) {
		this.history.forEach(function (action) {
			if (action.component instanceof Row) {
				if (action.component === oldRow) {
					action.component = newRow;
				}
			} else if (action.component instanceof Cell) {
				if (action.component.row === oldRow) {
					var field = action.component.column.getField();

					if (field) {
						action.component = newRow.getCell(field);
					}
				}
			}
		});
	};

	Tabulator.prototype.registerModule("history", History);
	var HtmlTableImport = function HtmlTableImport(table) {
		this.table = table; //hold Tabulator object
		this.fieldIndex = [];
		this.hasIndex = false;
	};

	HtmlTableImport.prototype.parseTable = function () {
		var self = this,
		    element = self.table.element,
		    options = self.table.options,
		    columns = options.columns,
		    headers = element.getElementsByTagName("th"),
		    rows = element.getElementsByTagName("tbody")[0],
		    data = [],
		    newTable;

		self.hasIndex = false;

		self.table.options.htmlImporting.call(this.table);

		rows = rows ? rows.getElementsByTagName("tr") : [];

		//check for tablator inline options
		self._extractOptions(element, options);

		if (headers.length) {
			self._extractHeaders(headers, rows);
		} else {
			self._generateBlankHeaders(headers, rows);
		}

		//iterate through table rows and build data set
		for (var index = 0; index < rows.length; index++) {
			var row = rows[index],
			    cells = row.getElementsByTagName("td"),
			    item = {};

			//create index if the dont exist in table
			if (!self.hasIndex) {
				item[options.index] = index;
			}

			for (var i = 0; i < cells.length; i++) {
				var cell = cells[i];
				if (typeof this.fieldIndex[i] !== "undefined") {
					item[this.fieldIndex[i]] = cell.innerHTML;
				}
			}

			//add row data to item
			data.push(item);
		}

		//create new element
		var newElement = document.createElement("div");

		//transfer attributes to new element
		var attributes = element.attributes;

		// loop through attributes and apply them on div

		for (var i in attributes) {
			if (_typeof(attributes[i]) == "object") {
				newElement.setAttribute(attributes[i].name, attributes[i].value);
			}
		}

		// replace table with div element
		element.parentNode.replaceChild(newElement, element);

		options.data = data;

		self.table.options.htmlImported.call(this.table);

		// // newElement.tabulator(options);

		this.table.element = newElement;
	};

	//extract tabulator attribute options
	HtmlTableImport.prototype._extractOptions = function (element, options, defaultOptions) {
		var attributes = element.attributes;
		var optionsArr = defaultOptions ? Object.assign([], defaultOptions) : Object.keys(options);
		var optionsList = {};

		optionsArr.forEach(function (item) {
			optionsList[item.toLowerCase()] = item;
		});

		for (var index in attributes) {
			var attrib = attributes[index];
			var name;

			if (attrib && (typeof attrib === 'undefined' ? 'undefined' : _typeof(attrib)) == "object" && attrib.name && attrib.name.indexOf("tabulator-") === 0) {
				name = attrib.name.replace("tabulator-", "");

				if (typeof optionsList[name] !== "undefined") {
					options[optionsList[name]] = this._attribValue(attrib.value);
				}
			}
		}
	};

	//get value of attribute
	HtmlTableImport.prototype._attribValue = function (value) {
		if (value === "true") {
			return true;
		}

		if (value === "false") {
			return false;
		}

		return value;
	};

	//find column if it has already been defined
	HtmlTableImport.prototype._findCol = function (title) {
		var match = this.table.options.columns.find(function (column) {
			return column.title === title;
		});

		return match || false;
	};

	//extract column from headers
	HtmlTableImport.prototype._extractHeaders = function (headers, rows) {
		for (var index = 0; index < headers.length; index++) {
			var header = headers[index],
			    exists = false,
			    col = this._findCol(header.textContent),
			    width,
			    attributes;

			if (col) {
				exists = true;
			} else {
				col = { title: header.textContent.trim() };
			}

			if (!col.field) {
				col.field = header.textContent.trim().toLowerCase().replace(" ", "_");
			}

			width = header.getAttribute("width");

			if (width && !col.width) {
				col.width = width;
			}

			//check for tablator inline options
			attributes = header.attributes;

			// //check for tablator inline options
			this._extractOptions(header, col, Column.prototype.defaultOptionList);

			this.fieldIndex[index] = col.field;

			if (col.field == this.table.options.index) {
				this.hasIndex = true;
			}

			if (!exists) {
				this.table.options.columns.push(col);
			}
		}
	};

	//generate blank headers
	HtmlTableImport.prototype._generateBlankHeaders = function (headers, rows) {
		for (var index = 0; index < headers.length; index++) {
			var header = headers[index],
			    col = { title: "", field: "col" + index };

			this.fieldIndex[index] = col.field;

			var width = header.getAttribute("width");

			if (width) {
				col.width = width;
			}

			this.table.options.columns.push(col);
		}
	};

	Tabulator.prototype.registerModule("htmlTableImport", HtmlTableImport);
	var Keybindings = function Keybindings(table) {
		this.table = table; //hold Tabulator object
		this.watchKeys = null;
		this.pressedKeys = null;
		this.keyupBinding = false;
		this.keydownBinding = false;
	};

	Keybindings.prototype.initialize = function () {
		var bindings = this.table.options.keybindings,
		    mergedBindings = {};

		this.watchKeys = {};
		this.pressedKeys = [];

		if (bindings !== false) {

			for (var key in this.bindings) {
				mergedBindings[key] = this.bindings[key];
			}

			if (Object.keys(bindings).length) {

				for (var _key in bindings) {
					mergedBindings[_key] = bindings[_key];
				}
			}

			this.mapBindings(mergedBindings);
			this.bindEvents();
		}
	};

	Keybindings.prototype.mapBindings = function (bindings) {
		var _this57 = this;

		var self = this;

		var _loop2 = function _loop2(key) {

			if (_this57.actions[key]) {

				if (bindings[key]) {

					if (_typeof(bindings[key]) !== "object") {
						bindings[key] = [bindings[key]];
					}

					bindings[key].forEach(function (binding) {
						self.mapBinding(key, binding);
					});
				}
			} else {
				console.warn("Key Binding Error - no such action:", key);
			}
		};

		for (var key in bindings) {
			_loop2(key);
		}
	};

	Keybindings.prototype.mapBinding = function (action, symbolsList) {
		var self = this;

		var binding = {
			action: this.actions[action],
			keys: [],
			ctrl: false,
			shift: false,
			meta: false
		};

		var symbols = symbolsList.toString().toLowerCase().split(" ").join("").split("+");

		symbols.forEach(function (symbol) {
			switch (symbol) {
				case "ctrl":
					binding.ctrl = true;
					break;

				case "shift":
					binding.shift = true;
					break;

				case "meta":
					binding.meta = true;
					break;

				default:
					symbol = parseInt(symbol);
					binding.keys.push(symbol);

					if (!self.watchKeys[symbol]) {
						self.watchKeys[symbol] = [];
					}

					self.watchKeys[symbol].push(binding);
			}
		});
	};

	Keybindings.prototype.bindEvents = function () {
		var self = this;

		this.keyupBinding = function (e) {
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if (bindings) {

				self.pressedKeys.push(code);

				bindings.forEach(function (binding) {
					self.checkBinding(e, binding);
				});
			}
		};

		this.keydownBinding = function (e) {
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if (bindings) {

				var index = self.pressedKeys.indexOf(code);

				if (index > -1) {
					self.pressedKeys.splice(index, 1);
				}
			}
		};

		this.table.element.addEventListener("keydown", this.keyupBinding);

		this.table.element.addEventListener("keyup", this.keydownBinding);
	};

	Keybindings.prototype.clearBindings = function () {
		if (this.keyupBinding) {
			this.table.element.removeEventListener("keydown", this.keyupBinding);
		}

		if (this.keydownBinding) {
			this.table.element.removeEventListener("keyup", this.keydownBinding);
		}
	};

	Keybindings.prototype.checkBinding = function (e, binding) {
		var self = this,
		    match = true;

		if (e.ctrlKey == binding.ctrl && e.shiftKey == binding.shift && e.metaKey == binding.meta) {
			binding.keys.forEach(function (key) {
				var index = self.pressedKeys.indexOf(key);

				if (index == -1) {
					match = false;
				}
			});

			if (match) {
				binding.action.call(self, e);
			}

			return true;
		}

		return false;
	};

	//default bindings
	Keybindings.prototype.bindings = {
		navPrev: "shift + 9",
		navNext: 9,
		navUp: 38,
		navDown: 40,
		scrollPageUp: 33,
		scrollPageDown: 34,
		scrollToStart: 36,
		scrollToEnd: 35,
		undo: "ctrl + 90",
		redo: "ctrl + 89",
		copyToClipboard: "ctrl + 67"
	};

	//default actions
	Keybindings.prototype.actions = {
		keyBlock: function keyBlock(e) {
			e.stopPropagation();
			e.preventDefault();
		},
		scrollPageUp: function scrollPageUp(e) {
			var rowManager = this.table.rowManager,
			    newPos = rowManager.scrollTop - rowManager.height,
			    scrollMax = rowManager.element.scrollHeight;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				if (newPos >= 0) {
					rowManager.element.scrollTop = newPos;
				} else {
					rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
				}
			}

			this.table.element.focus();
		},
		scrollPageDown: function scrollPageDown(e) {
			var rowManager = this.table.rowManager,
			    newPos = rowManager.scrollTop + rowManager.height,
			    scrollMax = rowManager.element.scrollHeight;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				if (newPos <= scrollMax) {
					rowManager.element.scrollTop = newPos;
				} else {
					rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
				}
			}

			this.table.element.focus();
		},
		scrollToStart: function scrollToStart(e) {
			var rowManager = this.table.rowManager;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
			}

			this.table.element.focus();
		},
		scrollToEnd: function scrollToEnd(e) {
			var rowManager = this.table.rowManager;

			e.preventDefault();

			if (rowManager.displayRowsCount) {
				rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
			}

			this.table.element.focus();
		},
		navPrev: function navPrev(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().prev();
				}
			}
		},

		navNext: function navNext(e) {
			var cell = false;
			var newRow = this.table.options.tabEndNewRow;
			var nav;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();

					nav = cell.nav();

					if (!nav.next()) {
						if (newRow) {

							cell.getElement().firstChild.blur();

							if (newRow === true) {
								newRow = this.table.addRow({});
							} else {
								if (typeof newRow == "function") {
									newRow = this.table.addRow(newRow(cell.row.getComponent()));
								} else {
									newRow = this.table.addRow(newRow);
								}
							}

							newRow.then(function () {
								setTimeout(function () {
									nav.next();
								});
							});
						}
					}
				}
			}
		},

		navLeft: function navLeft(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().left();
				}
			}
		},

		navRight: function navRight(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().right();
				}
			}
		},

		navUp: function navUp(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().up();
				}
			}
		},

		navDown: function navDown(e) {
			var cell = false;

			if (this.table.modExists("edit")) {
				cell = this.table.modules.edit.currentCell;

				if (cell) {
					e.preventDefault();
					cell.nav().down();
				}
			}
		},

		undo: function undo(e) {
			var cell = false;
			if (this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")) {

				cell = this.table.modules.edit.currentCell;

				if (!cell) {
					e.preventDefault();
					this.table.modules.history.undo();
				}
			}
		},

		redo: function redo(e) {
			var cell = false;
			if (this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")) {

				cell = this.table.modules.edit.currentCell;

				if (!cell) {
					e.preventDefault();
					this.table.modules.history.redo();
				}
			}
		},

		copyToClipboard: function copyToClipboard(e) {
			if (!this.table.modules.edit.currentCell) {
				if (this.table.modExists("clipboard", true)) {
					this.table.modules.clipboard.copy(false, true);
				}
			}
		}
	};

	Tabulator.prototype.registerModule("keybindings", Keybindings);
	var Menu = function Menu(table) {
		this.table = table; //hold Tabulator object
		this.menuEl = false;
		this.blurEvent = this.hideMenu.bind(this);
	};

	Menu.prototype.initializeColumnHeader = function (column) {
		var _this58 = this;

		var headerMenuEl;

		if (column.definition.headerContextMenu) {
			column.getElement().addEventListener("contextmenu", function (e) {
				var menu = typeof column.definition.headerContextMenu == "function" ? column.definition.headerContextMenu() : column.definition.headerContextMenu;

				e.preventDefault();

				_this58.loadMenu(e, column, menu);
			});
		}

		if (column.definition.headerMenu) {

			headerMenuEl = document.createElement("span");
			headerMenuEl.classList.add("tabulator-header-menu-button");
			headerMenuEl.innerHTML = "&vellip;";

			headerMenuEl.addEventListener("click", function (e) {
				var menu = typeof column.definition.headerMenu == "function" ? column.definition.headerMenu() : column.definition.headerMenu;
				e.stopPropagation();
				e.preventDefault();

				_this58.loadMenu(e, column, menu);
			});

			column.titleElement.insertBefore(headerMenuEl, column.titleElement.firstChild);
		}
	};

	Menu.prototype.initializeCell = function (cell) {
		var _this59 = this;

		cell.getElement().addEventListener("contextmenu", function (e) {
			var menu = typeof cell.column.definition.contextMenu == "function" ? cell.column.definition.contextMenu() : cell.column.definition.contextMenu;

			e.preventDefault();

			_this59.loadMenu(e, cell, menu);
		});
	};

	Menu.prototype.initializeRow = function (row) {
		var _this60 = this;

		row.getElement().addEventListener("contextmenu", function (e) {
			var menu = typeof _this60.table.options.rowContextMenu == "function" ? _this60.table.options.rowContextMenu() : _this60.table.options.rowContextMenu;

			e.preventDefault();

			_this60.loadMenu(e, row, menu);
		});
	};

	Menu.prototype.loadMenu = function (e, component, menu) {
		var _this61 = this;

		var docHeight = document.body.offsetHeight;

		//abort if no menu set
		if (!menu || !menu.length) {
			return;
		}

		this.hideMenu();

		this.menuEl = document.createElement("div");
		this.menuEl.classList.add("tabulator-menu");

		menu.forEach(function (item) {
			var itemEl = document.createElement("div");
			var label = item.label;
			var disabled = item.disabled;

			if (item.separator) {
				itemEl.classList.add("tabulator-menu-separator");
			} else {
				itemEl.classList.add("tabulator-menu-item");

				if (typeof label == "function") {
					label = label(component.getComponent());
				}

				if (label instanceof Node) {
					itemEl.appendChild(label);
				} else {
					itemEl.innerHTML = label;
				}

				if (typeof disabled == "function") {
					disabled = disabled(component.getComponent());
				}

				if (disabled) {
					itemEl.classList.add("tabulator-menu-item-disabled");
					itemEl.addEventListener("click", function (e) {
						e.stopPropagation();
					});
				} else {
					itemEl.addEventListener("click", function (e) {
						_this61.hideMenu();
						item.action(e, component.getComponent());
					});
				}
			}

			_this61.menuEl.appendChild(itemEl);
		});

		this.menuEl.style.top = e.pageY + "px";
		this.menuEl.style.left = e.pageX + "px";

		document.body.addEventListener("click", this.blurEvent);
		this.table.rowManager.element.addEventListener("scroll", this.blurEvent);

		setTimeout(function () {
			document.body.addEventListener("contextmenu", _this61.blurEvent);
		}, 100);

		document.body.appendChild(this.menuEl);

		//move menu to start on right edge if it is too close to the edge of the screen
		if (e.pageX + this.menuEl.offsetWidth >= document.body.offsetWidth) {
			this.menuEl.style.left = "";
			this.menuEl.style.right = document.body.offsetWidth - e.pageX + "px";
		}

		//move menu to start on bottom edge if it is too close to the edge of the screen
		if (e.pageY + this.menuEl.offsetHeight >= docHeight) {
			this.menuEl.style.top = "";
			this.menuEl.style.bottom = docHeight - e.pageY + "px";
		}
	};

	Menu.prototype.hideMenu = function () {
		if (this.menuEl.parentNode) {
			this.menuEl.parentNode.removeChild(this.menuEl);
		}

		if (this.blurEvent) {
			document.body.removeEventListener("click", this.blurEvent);
			document.body.removeEventListener("contextmenu", this.blurEvent);
			this.table.rowManager.element.removeEventListener("scroll", this.blurEvent);
		}
	};

	//default accessors
	Menu.prototype.menus = {};

	Tabulator.prototype.registerModule("menu", Menu);
	var MoveColumns = function MoveColumns(table) {
		this.table = table; //hold Tabulator object
		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating column header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 250; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving column
		this.toCol = false; //destination column
		this.toColAfter = false; //position of moving column relative to the desitnation column
		this.startX = 0; //starting position within header element
		this.autoScrollMargin = 40; //auto scroll on edge when within margin
		this.autoScrollStep = 5; //auto scroll distance in pixels
		this.autoScrollTimeout = false; //auto scroll timeout
		this.touchMove = false;

		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
	};

	MoveColumns.prototype.createPlaceholderElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-col");
		el.classList.add("tabulator-col-placeholder");

		return el;
	};

	MoveColumns.prototype.initializeColumn = function (column) {
		var self = this,
		    config = {},
		    colEl;

		if (!column.modules.frozen) {

			colEl = column.getElement();

			config.mousemove = function (e) {
				if (column.parent === self.moving.parent) {
					if ((self.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(colEl).left + self.table.columnManager.element.scrollLeft > column.getWidth() / 2) {
						if (self.toCol !== column || !self.toColAfter) {
							colEl.parentNode.insertBefore(self.placeholderElement, colEl.nextSibling);
							self.moveColumn(column, true);
						}
					} else {
						if (self.toCol !== column || self.toColAfter) {
							colEl.parentNode.insertBefore(self.placeholderElement, colEl);
							self.moveColumn(column, false);
						}
					}
				}
			}.bind(self);

			colEl.addEventListener("mousedown", function (e) {
				self.touchMove = false;
				if (e.which === 1) {
					self.checkTimeout = setTimeout(function () {
						self.startMove(e, column);
					}, self.checkPeriod);
				}
			});

			colEl.addEventListener("mouseup", function (e) {
				if (e.which === 1) {
					if (self.checkTimeout) {
						clearTimeout(self.checkTimeout);
					}
				}
			});

			self.bindTouchEvents(column);
		}

		column.modules.moveColumn = config;
	};

	MoveColumns.prototype.bindTouchEvents = function (column) {
		var self = this,
		    colEl = column.getElement(),
		    startXMove = false,
		    //shifting center position of the cell
		dir = false,
		    currentCol,
		    nextCol,
		    prevCol,
		    nextColWidth,
		    prevColWidth,
		    nextColWidthLast,
		    prevColWidthLast;

		colEl.addEventListener("touchstart", function (e) {
			self.checkTimeout = setTimeout(function () {
				self.touchMove = true;
				currentCol = column;
				nextCol = column.nextColumn();
				nextColWidth = nextCol ? nextCol.getWidth() / 2 : 0;
				prevCol = column.prevColumn();
				prevColWidth = prevCol ? prevCol.getWidth() / 2 : 0;
				nextColWidthLast = 0;
				prevColWidthLast = 0;
				startXMove = false;

				self.startMove(e, column);
			}, self.checkPeriod);
		}, { passive: true });

		colEl.addEventListener("touchmove", function (e) {
			var halfCol, diff, moveToCol;

			if (self.moving) {
				self.moveHover(e);

				if (!startXMove) {
					startXMove = e.touches[0].pageX;
				}

				diff = e.touches[0].pageX - startXMove;

				if (diff > 0) {
					if (nextCol && diff - nextColWidthLast > nextColWidth) {
						moveToCol = nextCol;

						if (moveToCol !== column) {
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(self.placeholderElement, moveToCol.getElement().nextSibling);
							self.moveColumn(moveToCol, true);
						}
					}
				} else {
					if (prevCol && -diff - prevColWidthLast > prevColWidth) {
						moveToCol = prevCol;

						if (moveToCol !== column) {
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(self.placeholderElement, moveToCol.getElement());
							self.moveColumn(moveToCol, false);
						}
					}
				}

				if (moveToCol) {
					currentCol = moveToCol;
					nextCol = moveToCol.nextColumn();
					nextColWidthLast = nextColWidth;
					nextColWidth = nextCol ? nextCol.getWidth() / 2 : 0;
					prevCol = moveToCol.prevColumn();
					prevColWidthLast = prevColWidth;
					prevColWidth = prevCol ? prevCol.getWidth() / 2 : 0;
				}
			}
		}, { passive: true });

		colEl.addEventListener("touchend", function (e) {
			if (self.checkTimeout) {
				clearTimeout(self.checkTimeout);
			}
			if (self.moving) {
				self.endMove(e);
			}
		});
	};

	MoveColumns.prototype.startMove = function (e, column) {
		var element = column.getElement();

		this.moving = column;
		this.startX = (this.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(element).left;

		this.table.element.classList.add("tabulator-block-select");

		//create placeholder
		this.placeholderElement.style.width = column.getWidth() + "px";
		this.placeholderElement.style.height = column.getHeight() + "px";

		element.parentNode.insertBefore(this.placeholderElement, element);
		element.parentNode.removeChild(element);

		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");

		this.table.columnManager.getElement().appendChild(this.hoverElement);

		this.hoverElement.style.left = "0";
		this.hoverElement.style.bottom = "0";

		if (!this.touchMove) {
			this._bindMouseMove();

			document.body.addEventListener("mousemove", this.moveHover);
			document.body.addEventListener("mouseup", this.endMove);
		}

		this.moveHover(e);
	};

	MoveColumns.prototype._bindMouseMove = function () {
		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (column.modules.moveColumn.mousemove) {
				column.getElement().addEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	};

	MoveColumns.prototype._unbindMouseMove = function () {
		this.table.columnManager.columnsByIndex.forEach(function (column) {
			if (column.modules.moveColumn.mousemove) {
				column.getElement().removeEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	};

	MoveColumns.prototype.moveColumn = function (column, after) {
		var movingCells = this.moving.getCells();

		this.toCol = column;
		this.toColAfter = after;

		if (after) {
			column.getCells().forEach(function (cell, i) {
				var cellEl = cell.getElement();
				cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl.nextSibling);
			});
		} else {
			column.getCells().forEach(function (cell, i) {
				var cellEl = cell.getElement();
				cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl);
			});
		}
	};

	MoveColumns.prototype.endMove = function (e) {
		if (e.which === 1 || this.touchMove) {
			this._unbindMouseMove();

			this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
			this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			this.hoverElement.parentNode.removeChild(this.hoverElement);

			this.table.element.classList.remove("tabulator-block-select");

			if (this.toCol) {
				this.table.columnManager.moveColumnActual(this.moving, this.toCol, this.toColAfter);
			}

			this.moving = false;
			this.toCol = false;
			this.toColAfter = false;

			if (!this.touchMove) {
				document.body.removeEventListener("mousemove", this.moveHover);
				document.body.removeEventListener("mouseup", this.endMove);
			}
		}
	};

	MoveColumns.prototype.moveHover = function (e) {
		var self = this,
		    columnHolder = self.table.columnManager.getElement(),
		    scrollLeft = columnHolder.scrollLeft,
		    xPos = (self.touchMove ? e.touches[0].pageX : e.pageX) - Tabulator.prototype.helpers.elOffset(columnHolder).left + scrollLeft,
		    scrollPos;

		self.hoverElement.style.left = xPos - self.startX + "px";

		if (xPos - scrollLeft < self.autoScrollMargin) {
			if (!self.autoScrollTimeout) {
				self.autoScrollTimeout = setTimeout(function () {
					scrollPos = Math.max(0, scrollLeft - 5);
					self.table.rowManager.getElement().scrollLeft = scrollPos;
					self.autoScrollTimeout = false;
				}, 1);
			}
		}

		if (scrollLeft + columnHolder.clientWidth - xPos < self.autoScrollMargin) {
			if (!self.autoScrollTimeout) {
				self.autoScrollTimeout = setTimeout(function () {
					scrollPos = Math.min(columnHolder.clientWidth, scrollLeft + 5);
					self.table.rowManager.getElement().scrollLeft = scrollPos;
					self.autoScrollTimeout = false;
				}, 1);
			}
		}
	};

	Tabulator.prototype.registerModule("moveColumn", MoveColumns);

	var MoveRows = function MoveRows(table) {

		this.table = table; //hold Tabulator object
		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating row header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 150; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving row
		this.toRow = false; //destination row
		this.toRowAfter = false; //position of moving row relative to the desitnation row
		this.hasHandle = false; //row has handle instead of fully movable row
		this.startY = 0; //starting Y position within header element
		this.startX = 0; //starting X position within header element

		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
		this.tableRowDropEvent = false;

		this.touchMove = false;

		this.connection = false;
		this.connections = [];

		this.connectedTable = false;
		this.connectedRow = false;
	};

	MoveRows.prototype.createPlaceholderElement = function () {
		var el = document.createElement("div");

		el.classList.add("tabulator-row");
		el.classList.add("tabulator-row-placeholder");

		return el;
	};

	MoveRows.prototype.initialize = function (handle) {
		this.connection = this.table.options.movableRowsConnectedTables;
	};

	MoveRows.prototype.setHandle = function (handle) {
		this.hasHandle = handle;
	};

	MoveRows.prototype.initializeGroupHeader = function (group) {
		var self = this,
		    config = {},
		    rowEl;

		//inter table drag drop
		config.mouseup = function (e) {
			self.tableRowDrop(e, row);
		}.bind(self);

		//same table drag drop
		config.mousemove = function (e) {
			if (e.pageY - Tabulator.prototype.helpers.elOffset(group.element).top + self.table.rowManager.element.scrollTop > group.getHeight() / 2) {
				if (self.toRow !== group || !self.toRowAfter) {
					var rowEl = group.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(group, true);
				}
			} else {
				if (self.toRow !== group || self.toRowAfter) {
					var rowEl = group.getElement();
					if (rowEl.previousSibling) {
						rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
						self.moveRow(group, false);
					}
				}
			}
		}.bind(self);

		group.modules.moveRow = config;
	};

	MoveRows.prototype.initializeRow = function (row) {
		var self = this,
		    config = {},
		    rowEl;

		//inter table drag drop
		config.mouseup = function (e) {
			self.tableRowDrop(e, row);
		}.bind(self);

		//same table drag drop
		config.mousemove = function (e) {
			if (e.pageY - Tabulator.prototype.helpers.elOffset(row.element).top + self.table.rowManager.element.scrollTop > row.getHeight() / 2) {
				if (self.toRow !== row || !self.toRowAfter) {
					var rowEl = row.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(row, true);
				}
			} else {
				if (self.toRow !== row || self.toRowAfter) {
					var rowEl = row.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
					self.moveRow(row, false);
				}
			}
		}.bind(self);

		if (!this.hasHandle) {

			rowEl = row.getElement();

			rowEl.addEventListener("mousedown", function (e) {
				if (e.which === 1) {
					self.checkTimeout = setTimeout(function () {
						self.startMove(e, row);
					}, self.checkPeriod);
				}
			});

			rowEl.addEventListener("mouseup", function (e) {
				if (e.which === 1) {
					if (self.checkTimeout) {
						clearTimeout(self.checkTimeout);
					}
				}
			});

			this.bindTouchEvents(row, row.getElement());
		}

		row.modules.moveRow = config;
	};

	MoveRows.prototype.initializeCell = function (cell) {
		var self = this,
		    cellEl = cell.getElement();

		cellEl.addEventListener("mousedown", function (e) {
			if (e.which === 1) {
				self.checkTimeout = setTimeout(function () {
					self.startMove(e, cell.row);
				}, self.checkPeriod);
			}
		});

		cellEl.addEventListener("mouseup", function (e) {
			if (e.which === 1) {
				if (self.checkTimeout) {
					clearTimeout(self.checkTimeout);
				}
			}
		});

		this.bindTouchEvents(cell.row, cell.getElement());
	};

	MoveRows.prototype.bindTouchEvents = function (row, element) {
		var self = this,
		    startYMove = false,
		    //shifting center position of the cell
		dir = false,
		    currentRow,
		    nextRow,
		    prevRow,
		    nextRowHeight,
		    prevRowHeight,
		    nextRowHeightLast,
		    prevRowHeightLast;

		element.addEventListener("touchstart", function (e) {
			self.checkTimeout = setTimeout(function () {
				self.touchMove = true;
				currentRow = row;
				nextRow = row.nextRow();
				nextRowHeight = nextRow ? nextRow.getHeight() / 2 : 0;
				prevRow = row.prevRow();
				prevRowHeight = prevRow ? prevRow.getHeight() / 2 : 0;
				nextRowHeightLast = 0;
				prevRowHeightLast = 0;
				startYMove = false;

				self.startMove(e, row);
			}, self.checkPeriod);
		}, { passive: true });
		this.moving, this.toRow, this.toRowAfter;
		element.addEventListener("touchmove", function (e) {

			var halfCol, diff, moveToRow;

			if (self.moving) {
				e.preventDefault();

				self.moveHover(e);

				if (!startYMove) {
					startYMove = e.touches[0].pageY;
				}

				diff = e.touches[0].pageY - startYMove;

				if (diff > 0) {
					if (nextRow && diff - nextRowHeightLast > nextRowHeight) {
						moveToRow = nextRow;

						if (moveToRow !== row) {
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(self.placeholderElement, moveToRow.getElement().nextSibling);
							self.moveRow(moveToRow, true);
						}
					}
				} else {
					if (prevRow && -diff - prevRowHeightLast > prevRowHeight) {
						moveToRow = prevRow;

						if (moveToRow !== row) {
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(self.placeholderElement, moveToRow.getElement());
							self.moveRow(moveToRow, false);
						}
					}
				}

				if (moveToRow) {
					currentRow = moveToRow;
					nextRow = moveToRow.nextRow();
					nextRowHeightLast = nextRowHeight;
					nextRowHeight = nextRow ? nextRow.getHeight() / 2 : 0;
					prevRow = moveToRow.prevRow();
					prevRowHeightLast = prevRowHeight;
					prevRowHeight = prevRow ? prevRow.getHeight() / 2 : 0;
				}
			}
		});

		element.addEventListener("touchend", function (e) {
			if (self.checkTimeout) {
				clearTimeout(self.checkTimeout);
			}
			if (self.moving) {
				self.endMove(e);
				self.touchMove = false;
			}
		});
	};

	MoveRows.prototype._bindMouseMove = function () {
		var self = this;

		self.table.rowManager.getDisplayRows().forEach(function (row) {
			if ((row.type === "row" || row.type === "group") && row.modules.moveRow.mousemove) {
				row.getElement().addEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	};

	MoveRows.prototype._unbindMouseMove = function () {
		var self = this;

		self.table.rowManager.getDisplayRows().forEach(function (row) {
			if ((row.type === "row" || row.type === "group") && row.modules.moveRow.mousemove) {
				row.getElement().removeEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	};

	MoveRows.prototype.startMove = function (e, row) {
		var element = row.getElement();

		this.setStartPosition(e, row);

		this.moving = row;

		this.table.element.classList.add("tabulator-block-select");

		//create placeholder
		this.placeholderElement.style.width = row.getWidth() + "px";
		this.placeholderElement.style.height = row.getHeight() + "px";

		if (!this.connection) {
			element.parentNode.insertBefore(this.placeholderElement, element);
			element.parentNode.removeChild(element);
		} else {
			this.table.element.classList.add("tabulator-movingrow-sending");
			this.connectToTables(row);
		}

		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");

		if (this.connection) {
			document.body.appendChild(this.hoverElement);
			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";
			this.hoverElement.style.width = this.table.element.clientWidth + "px";
			this.hoverElement.style.whiteSpace = "nowrap";
			this.hoverElement.style.overflow = "hidden";
			this.hoverElement.style.pointerEvents = "none";
		} else {
			this.table.rowManager.getTableElement().appendChild(this.hoverElement);

			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";

			this._bindMouseMove();
		}

		document.body.addEventListener("mousemove", this.moveHover);
		document.body.addEventListener("mouseup", this.endMove);

		this.moveHover(e);
	};

	MoveRows.prototype.setStartPosition = function (e, row) {
		var pageX = this.touchMove ? e.touches[0].pageX : e.pageX,
		    pageY = this.touchMove ? e.touches[0].pageY : e.pageY,
		    element,
		    position;

		element = row.getElement();
		if (this.connection) {
			position = element.getBoundingClientRect();

			this.startX = position.left - pageX + window.pageXOffset;
			this.startY = position.top - pageY + window.pageYOffset;
		} else {
			this.startY = pageY - element.getBoundingClientRect().top;
		}
	};

	MoveRows.prototype.endMove = function (e) {
		if (!e || e.which === 1 || this.touchMove) {
			this._unbindMouseMove();

			if (!this.connection) {
				this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
				this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			}

			this.hoverElement.parentNode.removeChild(this.hoverElement);

			this.table.element.classList.remove("tabulator-block-select");

			if (this.toRow) {
				this.table.rowManager.moveRow(this.moving, this.toRow, this.toRowAfter);
			}

			this.moving = false;
			this.toRow = false;
			this.toRowAfter = false;

			document.body.removeEventListener("mousemove", this.moveHover);
			document.body.removeEventListener("mouseup", this.endMove);

			if (this.connection) {
				this.table.element.classList.remove("tabulator-movingrow-sending");
				this.disconnectFromTables();
			}
		}
	};

	MoveRows.prototype.moveRow = function (row, after) {
		this.toRow = row;
		this.toRowAfter = after;
	};

	MoveRows.prototype.moveHover = function (e) {
		if (this.connection) {
			this.moveHoverConnections.call(this, e);
		} else {
			this.moveHoverTable.call(this, e);
		}
	};

	MoveRows.prototype.moveHoverTable = function (e) {
		var rowHolder = this.table.rowManager.getElement(),
		    scrollTop = rowHolder.scrollTop,
		    yPos = (this.touchMove ? e.touches[0].pageY : e.pageY) - rowHolder.getBoundingClientRect().top + scrollTop,
		    scrollPos;

		this.hoverElement.style.top = yPos - this.startY + "px";
	};

	MoveRows.prototype.moveHoverConnections = function (e) {
		this.hoverElement.style.left = this.startX + (this.touchMove ? e.touches[0].pageX : e.pageX) + "px";
		this.hoverElement.style.top = this.startY + (this.touchMove ? e.touches[0].pageY : e.pageY) + "px";
	};

	//establish connection with other tables
	MoveRows.prototype.connectToTables = function (row) {
		var self = this,
		    connections = this.table.modules.comms.getConnections(this.connection);

		this.table.options.movableRowsSendingStart.call(this.table, connections);

		this.table.modules.comms.send(this.connection, "moveRow", "connect", {
			row: row
		});
	};

	//disconnect from other tables
	MoveRows.prototype.disconnectFromTables = function () {
		var self = this,
		    connections = this.table.modules.comms.getConnections(this.connection);

		this.table.options.movableRowsSendingStop.call(this.table, connections);

		this.table.modules.comms.send(this.connection, "moveRow", "disconnect");
	};

	//accept incomming connection
	MoveRows.prototype.connect = function (table, row) {
		var self = this;
		if (!this.connectedTable) {
			this.connectedTable = table;
			this.connectedRow = row;

			this.table.element.classList.add("tabulator-movingrow-receiving");

			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup) {
					row.getElement().addEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			self.tableRowDropEvent = self.tableRowDrop.bind(self);

			self.table.element.addEventListener("mouseup", self.tableRowDropEvent);

			this.table.options.movableRowsReceivingStart.call(this.table, row, table);

			return true;
		} else {
			console.warn("Move Row Error - Table cannot accept connection, already connected to table:", this.connectedTable);
			return false;
		}
	};

	//close incomming connection
	MoveRows.prototype.disconnect = function (table) {
		var self = this;
		if (table === this.connectedTable) {
			this.connectedTable = false;
			this.connectedRow = false;

			this.table.element.classList.remove("tabulator-movingrow-receiving");

			self.table.rowManager.getDisplayRows().forEach(function (row) {
				if (row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup) {
					row.getElement().removeEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			self.table.element.removeEventListener("mouseup", self.tableRowDropEvent);

			this.table.options.movableRowsReceivingStop.call(this.table, table);
		} else {
			console.warn("Move Row Error - trying to disconnect from non connected table");
		}
	};

	MoveRows.prototype.dropComplete = function (table, row, success) {
		var sender = false;

		if (success) {

			switch (_typeof(this.table.options.movableRowsSender)) {
				case "string":
					sender = this.senders[this.table.options.movableRowsSender];
					break;

				case "function":
					sender = this.table.options.movableRowsSender;
					break;
			}

			if (sender) {
				sender.call(this, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
			} else {
				if (this.table.options.movableRowsSender) {
					console.warn("Mover Row Error - no matching sender found:", this.table.options.movableRowsSender);
				}
			}

			this.table.options.movableRowsSent.call(this.table, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		} else {
			this.table.options.movableRowsSentFailed.call(this.table, this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		}

		this.endMove();
	};

	MoveRows.prototype.tableRowDrop = function (e, row) {
		var receiver = false,
		    success = false;

		e.stopImmediatePropagation();

		switch (_typeof(this.table.options.movableRowsReceiver)) {
			case "string":
				receiver = this.receivers[this.table.options.movableRowsReceiver];
				break;

			case "function":
				receiver = this.table.options.movableRowsReceiver;
				break;
		}

		if (receiver) {
			success = receiver.call(this, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		} else {
			console.warn("Mover Row Error - no matching receiver found:", this.table.options.movableRowsReceiver);
		}

		if (success) {
			this.table.options.movableRowsReceived.call(this.table, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		} else {
			this.table.options.movableRowsReceivedFailed.call(this.table, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		}

		this.table.modules.comms.send(this.connectedTable, "moveRow", "dropcomplete", {
			row: row,
			success: success
		});
	};

	MoveRows.prototype.receivers = {
		insert: function insert(fromRow, toRow, fromTable) {
			this.table.addRow(fromRow.getData(), undefined, toRow);
			return true;
		},

		add: function add(fromRow, toRow, fromTable) {
			this.table.addRow(fromRow.getData());
			return true;
		},

		update: function update(fromRow, toRow, fromTable) {
			if (toRow) {
				toRow.update(fromRow.getData());
				return true;
			}

			return false;
		},

		replace: function replace(fromRow, toRow, fromTable) {
			if (toRow) {
				this.table.addRow(fromRow.getData(), undefined, toRow);
				toRow.delete();
				return true;
			}

			return false;
		}
	};

	MoveRows.prototype.senders = {
		delete: function _delete(fromRow, toRow, toTable) {
			fromRow.delete();
		}
	};

	MoveRows.prototype.commsReceived = function (table, action, data) {
		switch (action) {
			case "connect":
				return this.connect(table, data.row);
				break;

			case "disconnect":
				return this.disconnect(table);
				break;

			case "dropcomplete":
				return this.dropComplete(table, data.row, data.success);
				break;
		}
	};

	Tabulator.prototype.registerModule("moveRow", MoveRows);
	var Mutator = function Mutator(table) {
		this.table = table; //hold Tabulator object
		this.allowedTypes = ["", "data", "edit", "clipboard"]; //list of muatation types
		this.enabled = true;
	};

	//initialize column mutator
	Mutator.prototype.initializeColumn = function (column) {
		var self = this,
		    match = false,
		    config = {};

		this.allowedTypes.forEach(function (type) {
			var key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
			    mutator;

			if (column.definition[key]) {
				mutator = self.lookupMutator(column.definition[key]);

				if (mutator) {
					match = true;

					config[key] = {
						mutator: mutator,
						params: column.definition[key + "Params"] || {}
					};
				}
			}
		});

		if (match) {
			column.modules.mutate = config;
		}
	};

	Mutator.prototype.lookupMutator = function (value) {
		var mutator = false;

		//set column mutator
		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				if (this.mutators[value]) {
					mutator = this.mutators[value];
				} else {
					console.warn("Mutator Error - No such mutator found, ignoring: ", value);
				}
				break;

			case "function":
				mutator = value;
				break;
		}

		return mutator;
	};

	//apply mutator to row
	Mutator.prototype.transformRow = function (data, type, updatedData) {
		var self = this,
		    key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
		    value;

		if (this.enabled) {

			self.table.columnManager.traverse(function (column) {
				var mutator, params, component;

				if (column.modules.mutate) {
					mutator = column.modules.mutate[key] || column.modules.mutate.mutator || false;

					if (mutator) {
						value = column.getFieldValue(typeof updatedData !== "undefined" ? updatedData : data);

						if (type == "data" || typeof value !== "undefined") {
							component = column.getComponent();
							params = typeof mutator.params === "function" ? mutator.params(value, data, type, component) : mutator.params;
							column.setFieldValue(data, mutator.mutator(value, data, type, params, component));
						}
					}
				}
			});
		}

		return data;
	};

	//apply mutator to new cell value
	Mutator.prototype.transformCell = function (cell, value) {
		var mutator = cell.column.modules.mutate.mutatorEdit || cell.column.modules.mutate.mutator || false,
		    tempData = {};

		if (mutator) {
			tempData = Object.assign(tempData, cell.row.getData());
			cell.column.setFieldValue(tempData, value);
			return mutator.mutator(value, tempData, "edit", mutator.params, cell.getComponent());
		} else {
			return value;
		}
	};

	Mutator.prototype.enable = function () {
		this.enabled = true;
	};

	Mutator.prototype.disable = function () {
		this.enabled = false;
	};

	//default mutators
	Mutator.prototype.mutators = {};

	Tabulator.prototype.registerModule("mutator", Mutator);
	var Page = function Page(table) {

		this.table = table; //hold Tabulator object

		this.mode = "local";
		this.progressiveLoad = false;

		this.size = 0;
		this.page = 1;
		this.count = 5;
		this.max = 1;

		this.displayIndex = 0; //index in display pipeline

		this.initialLoad = true;

		this.pageSizes = [];

		this.createElements();
	};

	Page.prototype.createElements = function () {

		var button;

		this.element = document.createElement("span");
		this.element.classList.add("tabulator-paginator");

		this.pagesElement = document.createElement("span");
		this.pagesElement.classList.add("tabulator-pages");

		button = document.createElement("button");
		button.classList.add("tabulator-page");
		button.setAttribute("type", "button");
		button.setAttribute("role", "button");
		button.setAttribute("aria-label", "");
		button.setAttribute("title", "");

		this.firstBut = button.cloneNode(true);
		this.firstBut.setAttribute("data-page", "first");

		this.prevBut = button.cloneNode(true);
		this.prevBut.setAttribute("data-page", "prev");

		this.nextBut = button.cloneNode(true);
		this.nextBut.setAttribute("data-page", "next");

		this.lastBut = button.cloneNode(true);
		this.lastBut.setAttribute("data-page", "last");

		if (this.table.options.paginationSizeSelector) {
			this.pageSizeSelect = document.createElement("select");
			this.pageSizeSelect.classList.add("tabulator-page-size");
		}
	};

	Page.prototype.generatePageSizeSelectList = function () {
		var _this62 = this;

		var pageSizes = [];

		if (this.pageSizeSelect) {

			if (Array.isArray(this.table.options.paginationSizeSelector)) {
				pageSizes = this.table.options.paginationSizeSelector;
				this.pageSizes = pageSizes;

				if (this.pageSizes.indexOf(this.size) == -1) {
					pageSizes.unshift(this.size);
				}
			} else {

				if (this.pageSizes.indexOf(this.size) == -1) {
					pageSizes = [];

					for (var i = 1; i < 5; i++) {
						pageSizes.push(this.size * i);
					}

					this.pageSizes = pageSizes;
				} else {
					pageSizes = this.pageSizes;
				}
			}

			while (this.pageSizeSelect.firstChild) {
				this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);
			}pageSizes.forEach(function (item) {
				var itemEl = document.createElement("option");
				itemEl.value = item;
				itemEl.innerHTML = item;

				_this62.pageSizeSelect.appendChild(itemEl);
			});

			this.pageSizeSelect.value = this.size;
		}
	};

	//setup pageination
	Page.prototype.initialize = function (hidden) {
		var self = this,
		    pageSelectLabel;

		//update param names
		for (var key in self.table.options.paginationDataSent) {
			self.paginationDataSentNames[key] = self.table.options.paginationDataSent[key];
		}

		for (var _key2 in self.table.options.paginationDataReceived) {
			self.paginationDataReceivedNames[_key2] = self.table.options.paginationDataReceived[_key2];
		}

		//build pagination element

		//bind localizations
		self.table.modules.localize.bind("pagination|first", function (value) {
			self.firstBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|first_title", function (value) {
			self.firstBut.setAttribute("aria-label", value);
			self.firstBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|prev", function (value) {
			self.prevBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|prev_title", function (value) {
			self.prevBut.setAttribute("aria-label", value);
			self.prevBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|next", function (value) {
			self.nextBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|next_title", function (value) {
			self.nextBut.setAttribute("aria-label", value);
			self.nextBut.setAttribute("title", value);
		});

		self.table.modules.localize.bind("pagination|last", function (value) {
			self.lastBut.innerHTML = value;
		});

		self.table.modules.localize.bind("pagination|last_title", function (value) {
			self.lastBut.setAttribute("aria-label", value);
			self.lastBut.setAttribute("title", value);
		});

		//click bindings
		self.firstBut.addEventListener("click", function () {
			self.setPage(1);
		});

		self.prevBut.addEventListener("click", function () {
			self.previousPage();
		});

		self.nextBut.addEventListener("click", function () {
			self.nextPage().then(function () {}).catch(function () {});
		});

		self.lastBut.addEventListener("click", function () {
			self.setPage(self.max);
		});

		if (self.table.options.paginationElement) {
			self.element = self.table.options.paginationElement;
		}

		if (this.pageSizeSelect) {
			pageSelectLabel = document.createElement("label");

			self.table.modules.localize.bind("pagination|page_size", function (value) {
				self.pageSizeSelect.setAttribute("aria-label", value);
				self.pageSizeSelect.setAttribute("title", value);
				pageSelectLabel.innerHTML = value;
			});

			self.element.appendChild(pageSelectLabel);
			self.element.appendChild(self.pageSizeSelect);

			self.pageSizeSelect.addEventListener("change", function (e) {
				self.setPageSize(self.pageSizeSelect.value);
				self.setPage(1).then(function () {}).catch(function () {});
			});
		}

		//append to DOM
		self.element.appendChild(self.firstBut);
		self.element.appendChild(self.prevBut);
		self.element.appendChild(self.pagesElement);
		self.element.appendChild(self.nextBut);
		self.element.appendChild(self.lastBut);

		if (!self.table.options.paginationElement && !hidden) {
			self.table.footerManager.append(self.element, self);
		}

		//set default values
		self.mode = self.table.options.pagination;

		self.size = self.table.options.paginationSize || Math.floor(self.table.rowManager.getElement().clientHeight / 24);
		// self.page = self.table.options.paginationInitialPage || 1;
		self.count = self.table.options.paginationButtonCount;

		self.generatePageSizeSelectList();
	};

	Page.prototype.initializeProgressive = function (mode) {
		this.initialize(true);
		this.mode = "progressive_" + mode;
		this.progressiveLoad = true;
	};

	Page.prototype.setDisplayIndex = function (index) {
		this.displayIndex = index;
	};

	Page.prototype.getDisplayIndex = function () {
		return this.displayIndex;
	};

	//calculate maximum page from number of rows
	Page.prototype.setMaxRows = function (rowCount) {
		if (!rowCount) {
			this.max = 1;
		} else {
			this.max = Math.ceil(rowCount / this.size);
		}

		if (this.page > this.max) {
			this.page = this.max;
		}
	};

	//reset to first page without triggering action
	Page.prototype.reset = function (force, columnsChanged) {
		if (this.mode == "local" || force) {
			this.page = 1;
		}

		if (columnsChanged) {
			this.initialLoad = true;
		}

		return true;
	};

	//set the maxmum page
	Page.prototype.setMaxPage = function (max) {

		max = parseInt(max);

		this.max = max || 1;

		if (this.page > this.max) {
			this.page = this.max;
			this.trigger();
		}
	};

	//set current page number
	Page.prototype.setPage = function (page) {
		var _this63 = this;

		var self = this;

		return new Promise(function (resolve, reject) {

			page = parseInt(page);

			if (page > 0 && page <= _this63.max) {
				_this63.page = page;
				_this63.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (self.table.options.persistence && self.table.modExists("persistence", true) && self.table.modules.persistence.config.page) {
					self.table.modules.persistence.save("page");
				}
			} else {
				console.warn("Pagination Error - Requested page is out of range of 1 - " + _this63.max + ":", page);
				reject();
			}
		});
	};

	Page.prototype.setPageToRow = function (row) {
		var _this64 = this;

		return new Promise(function (resolve, reject) {

			var rows = _this64.table.rowManager.getDisplayRows(_this64.displayIndex - 1);
			var index = rows.indexOf(row);

			if (index > -1) {
				var page = Math.ceil((index + 1) / _this64.size);

				_this64.setPage(page).then(function () {
					resolve();
				}).catch(function () {
					reject();
				});
			} else {
				console.warn("Pagination Error - Requested row is not visible");
				reject();
			}
		});
	};

	Page.prototype.setPageSize = function (size) {
		size = parseInt(size);

		if (size > 0) {
			this.size = size;
		}

		if (this.pageSizeSelect) {
			// this.pageSizeSelect.value = size;
			this.generatePageSizeSelectList();
		}

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.page) {
			this.table.modules.persistence.save("page");
		}
	};

	//setup the pagination buttons
	Page.prototype._setPageButtons = function () {
		var self = this;

		var leftSize = Math.floor((this.count - 1) / 2);
		var rightSize = Math.ceil((this.count - 1) / 2);
		var min = this.max - this.page + leftSize + 1 < this.count ? this.max - this.count + 1 : Math.max(this.page - leftSize, 1);
		var max = this.page <= rightSize ? Math.min(this.count, this.max) : Math.min(this.page + rightSize, this.max);

		while (self.pagesElement.firstChild) {
			self.pagesElement.removeChild(self.pagesElement.firstChild);
		}if (self.page == 1) {
			self.firstBut.disabled = true;
			self.prevBut.disabled = true;
		} else {
			self.firstBut.disabled = false;
			self.prevBut.disabled = false;
		}

		if (self.page == self.max) {
			self.lastBut.disabled = true;
			self.nextBut.disabled = true;
		} else {
			self.lastBut.disabled = false;
			self.nextBut.disabled = false;
		}

		for (var i = min; i <= max; i++) {
			if (i > 0 && i <= self.max) {
				self.pagesElement.appendChild(self._generatePageButton(i));
			}
		}

		this.footerRedraw();
	};

	Page.prototype._generatePageButton = function (page) {
		var self = this,
		    button = document.createElement("button");

		button.classList.add("tabulator-page");
		if (page == self.page) {
			button.classList.add("active");
		}

		button.setAttribute("type", "button");
		button.setAttribute("role", "button");
		button.setAttribute("aria-label", "Show Page " + page);
		button.setAttribute("title", "Show Page " + page);
		button.setAttribute("data-page", page);
		button.textContent = page;

		button.addEventListener("click", function (e) {
			self.setPage(page);
		});

		return button;
	};

	//previous page
	Page.prototype.previousPage = function () {
		var _this65 = this;

		return new Promise(function (resolve, reject) {
			if (_this65.page > 1) {
				_this65.page--;
				_this65.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (_this65.table.options.persistence && _this65.table.modExists("persistence", true) && _this65.table.modules.persistence.config.page) {
					_this65.table.modules.persistence.save("page");
				}
			} else {
				console.warn("Pagination Error - Previous page would be less than page 1:", 0);
				reject();
			}
		});
	};

	//next page
	Page.prototype.nextPage = function () {
		var _this66 = this;

		return new Promise(function (resolve, reject) {
			if (_this66.page < _this66.max) {
				_this66.page++;
				_this66.trigger().then(function () {
					resolve();
				}).catch(function () {
					reject();
				});

				if (_this66.table.options.persistence && _this66.table.modExists("persistence", true) && _this66.table.modules.persistence.config.page) {
					_this66.table.modules.persistence.save("page");
				}
			} else {
				if (!_this66.progressiveLoad) {
					console.warn("Pagination Error - Next page would be greater than maximum page of " + _this66.max + ":", _this66.max + 1);
				}
				reject();
			}
		});
	};

	//return current page number
	Page.prototype.getPage = function () {
		return this.page;
	};

	//return max page number
	Page.prototype.getPageMax = function () {
		return this.max;
	};

	Page.prototype.getPageSize = function (size) {
		return this.size;
	};

	Page.prototype.getMode = function () {
		return this.mode;
	};

	//return appropriate rows for current page
	Page.prototype.getRows = function (data) {
		var output, start, end;

		if (this.mode == "local") {
			output = [];
			start = this.size * (this.page - 1);
			end = start + parseInt(this.size);

			this._setPageButtons();

			for (var i = start; i < end; i++) {
				if (data[i]) {
					output.push(data[i]);
				}
			}

			return output;
		} else {

			this._setPageButtons();

			return data.slice(0);
		}
	};

	Page.prototype.trigger = function () {
		var _this67 = this;

		var left;

		return new Promise(function (resolve, reject) {

			switch (_this67.mode) {
				case "local":
					left = _this67.table.rowManager.scrollLeft;

					_this67.table.rowManager.refreshActiveData("page");
					_this67.table.rowManager.scrollHorizontal(left);

					_this67.table.options.pageLoaded.call(_this67.table, _this67.getPage());
					resolve();
					break;

				case "remote":
				case "progressive_load":
				case "progressive_scroll":
					_this67.table.modules.ajax.blockActiveRequest();
					_this67._getRemotePage().then(function () {
						resolve();
					}).catch(function () {
						reject();
					});
					break;

				default:
					console.warn("Pagination Error - no such pagination mode:", _this67.mode);
					reject();
			}
		});
	};

	Page.prototype._getRemotePage = function () {
		var _this68 = this;

		var self = this,
		    oldParams,
		    pageParams;

		return new Promise(function (resolve, reject) {

			if (!self.table.modExists("ajax", true)) {
				reject();
			}

			//record old params and restore after request has been made
			oldParams = Tabulator.prototype.helpers.deepClone(self.table.modules.ajax.getParams() || {});
			pageParams = self.table.modules.ajax.getParams();

			//configure request params
			pageParams[_this68.paginationDataSentNames.page] = self.page;

			//set page size if defined
			if (_this68.size) {
				pageParams[_this68.paginationDataSentNames.size] = _this68.size;
			}

			//set sort data if defined
			if (_this68.table.options.ajaxSorting && _this68.table.modExists("sort")) {
				var sorters = self.table.modules.sort.getSort();

				sorters.forEach(function (item) {
					delete item.column;
				});

				pageParams[_this68.paginationDataSentNames.sorters] = sorters;
			}

			//set filter data if defined
			if (_this68.table.options.ajaxFiltering && _this68.table.modExists("filter")) {
				var filters = self.table.modules.filter.getFilters(true, true);
				pageParams[_this68.paginationDataSentNames.filters] = filters;
			}

			self.table.modules.ajax.setParams(pageParams);

			self.table.modules.ajax.sendRequest(_this68.progressiveLoad).then(function (data) {
				self._parseRemoteData(data);
				resolve();
			}).catch(function (e) {
				reject();
			});

			self.table.modules.ajax.setParams(oldParams);
		});
	};

	Page.prototype._parseRemoteData = function (data) {
		var self = this,
		    left,
		    data,
		    margin;

		if (typeof data[this.paginationDataReceivedNames.last_page] === "undefined") {
			console.warn("Remote Pagination Error - Server response missing '" + this.paginationDataReceivedNames.last_page + "' property");
		}

		if (data[this.paginationDataReceivedNames.data]) {
			this.max = parseInt(data[this.paginationDataReceivedNames.last_page]) || 1;

			if (this.progressiveLoad) {
				switch (this.mode) {
					case "progressive_load":

						if (this.page == 1) {
							this.table.rowManager.setData(data[this.paginationDataReceivedNames.data], false, this.initialLoad && this.page == 1);
						} else {
							this.table.rowManager.addRows(data[this.paginationDataReceivedNames.data]);
						}

						if (this.page < this.max) {
							setTimeout(function () {
								self.nextPage().then(function () {}).catch(function () {});
							}, self.table.options.ajaxProgressiveLoadDelay);
						}
						break;

					case "progressive_scroll":
						data = this.table.rowManager.getData().concat(data[this.paginationDataReceivedNames.data]);

						this.table.rowManager.setData(data, true, this.initialLoad && this.page == 1);

						margin = this.table.options.ajaxProgressiveLoadScrollMargin || this.table.rowManager.element.clientHeight * 2;

						if (self.table.rowManager.element.scrollHeight <= self.table.rowManager.element.clientHeight + margin) {
							self.nextPage().then(function () {}).catch(function () {});
						}
						break;
				}
			} else {
				left = this.table.rowManager.scrollLeft;

				this.table.rowManager.setData(data[this.paginationDataReceivedNames.data], false, this.initialLoad && this.page == 1);

				this.table.rowManager.scrollHorizontal(left);

				this.table.columnManager.scrollHorizontal(left);

				this.table.options.pageLoaded.call(this.table, this.getPage());
			}

			this.initialLoad = false;
		} else {
			console.warn("Remote Pagination Error - Server response missing '" + this.paginationDataReceivedNames.data + "' property");
		}
	};

	//handle the footer element being redrawn
	Page.prototype.footerRedraw = function () {
		var footer = this.table.footerManager.element;

		if (Math.ceil(footer.clientWidth) - footer.scrollWidth < 0) {
			this.pagesElement.style.display = 'none';
		} else {
			this.pagesElement.style.display = '';

			if (Math.ceil(footer.clientWidth) - footer.scrollWidth < 0) {
				this.pagesElement.style.display = 'none';
			}
		}
	};

	//set the paramter names for pagination requests
	Page.prototype.paginationDataSentNames = {
		"page": "page",
		"size": "size",
		"sorters": "sorters",
		// "sort_dir":"sort_dir",
		"filters": "filters"
		// "filter_value":"filter_value",
		// "filter_type":"filter_type",
	};

	//set the property names for pagination responses
	Page.prototype.paginationDataReceivedNames = {
		"current_page": "current_page",
		"last_page": "last_page",
		"data": "data"
	};

	Tabulator.prototype.registerModule("page", Page);

	var Persistence = function Persistence(table) {
		this.table = table; //hold Tabulator object
		this.mode = "";
		this.id = "";
		// this.persistProps = ["field", "width", "visible"];
		this.defWatcherBlock = false;
		this.config = {};
		this.readFunc = false;
		this.writeFunc = false;
	};

	// Test for whether localStorage is available for use.
	Persistence.prototype.localStorageTest = function () {
		var testKey = "_tabulator_test";

		try {
			window.localStorage.setItem(testKey, testKey);
			window.localStorage.removeItem(testKey);
			return true;
		} catch (e) {
			return false;
		}
	};

	//setup parameters
	Persistence.prototype.initialize = function () {
		//determine persistent layout storage type

		var mode = this.table.options.persistenceMode,
		    id = this.table.options.persistenceID,
		    retreivedData;

		this.mode = mode !== true ? mode : this.localStorageTest() ? "local" : "cookie";

		if (this.table.options.persistenceReaderFunc) {
			if (typeof this.table.options.persistenceReaderFunc === "function") {
				this.readFunc = this.table.options.persistenceReaderFunc;
			} else {
				if (this.readers[this.table.options.persistenceReaderFunc]) {
					this.readFunc = this.readers[this.table.options.persistenceReaderFunc];
				} else {
					console.warn("Persistence Read Error - invalid reader set", this.table.options.persistenceReaderFunc);
				}
			}
		} else {
			if (this.readers[this.mode]) {
				this.readFunc = this.readers[this.mode];
			} else {
				console.warn("Persistence Read Error - invalid reader set", this.mode);
			}
		}

		if (this.table.options.persistenceWriterFunc) {
			if (typeof this.table.options.persistenceWriterFunc === "function") {
				this.writeFunc = this.table.options.persistenceWriterFunc;
			} else {
				if (this.readers[this.table.options.persistenceWriterFunc]) {
					this.writeFunc = this.readers[this.table.options.persistenceWriterFunc];
				} else {
					console.warn("Persistence Write Error - invalid reader set", this.table.options.persistenceWriterFunc);
				}
			}
		} else {
			if (this.writers[this.mode]) {
				this.writeFunc = this.writers[this.mode];
			} else {
				console.warn("Persistence Write Error - invalid writer set", this.mode);
			}
		}

		//set storage tag
		this.id = "tabulator-" + (id || this.table.element.getAttribute("id") || "");

		this.config = {
			sort: this.table.options.persistence === true || this.table.options.persistence.sort,
			filter: this.table.options.persistence === true || this.table.options.persistence.filter,
			group: this.table.options.persistence === true || this.table.options.persistence.group,
			page: this.table.options.persistence === true || this.table.options.persistence.page,
			columns: this.table.options.persistence === true ? ["title", "width", "visible"] : this.table.options.persistence.columns
		};

		//load pagination data if needed
		if (this.config.page) {
			retreivedData = this.retreiveData("page");

			if (retreivedData) {
				if (typeof retreivedData.paginationSize !== "undefined" && (this.config.page === true || this.config.page.size)) {
					this.table.options.paginationSize = retreivedData.paginationSize;
				}

				if (typeof retreivedData.paginationInitialPage !== "undefined" && (this.config.page === true || this.config.page.page)) {
					this.table.options.paginationInitialPage = retreivedData.paginationInitialPage;
				}
			}
		}

		//load group data if needed
		if (this.config.group) {
			retreivedData = this.retreiveData("group");

			if (retreivedData) {
				if (typeof retreivedData.groupBy !== "undefined" && (this.config.group === true || this.config.group.groupBy)) {
					this.table.options.groupBy = retreivedData.groupBy;
				}
				if (typeof retreivedData.groupStartOpen !== "undefined" && (this.config.group === true || this.config.group.groupStartOpen)) {
					this.table.options.groupStartOpen = retreivedData.groupStartOpen;
				}
				if (typeof retreivedData.groupHeader !== "undefined" && (this.config.group === true || this.config.group.groupHeader)) {
					this.table.options.groupHeader = retreivedData.groupHeader;
				}
			}
		}
	};

	Persistence.prototype.initializeColumn = function (column) {
		var self = this,
		    def,
		    keys;

		if (this.config.columns) {
			this.defWatcherBlock = true;

			def = column.getDefinition();

			keys = this.config.columns === true ? Object.keys(def) : this.config.columns;

			keys.forEach(function (key) {
				var props = Object.getOwnPropertyDescriptor(def, key);
				var value = def[key];
				if (props) {
					Object.defineProperty(def, key, {
						set: function set(newValue) {
							value = newValue;

							if (!self.defWatcherBlock) {
								self.save("columns");
							}

							if (props.set) {
								props.set(newValue);
							}
						},
						get: function get() {
							if (props.get) {
								props.get();
							}
							return value;
						}
					});
				}
			});

			this.defWatcherBlock = false;
		}
	};

	//load saved definitions
	Persistence.prototype.load = function (type, current) {
		var data = this.retreiveData(type);

		if (current) {
			data = data ? this.mergeDefinition(current, data) : current;
		}

		return data;
	};

	//retreive data from memory
	Persistence.prototype.retreiveData = function (type) {
		return this.readFunc ? this.readFunc(this.id, type) : false;
	};

	//merge old and new column definitions
	Persistence.prototype.mergeDefinition = function (oldCols, newCols) {
		var self = this,
		    output = [];

		// oldCols = oldCols || [];
		newCols = newCols || [];

		newCols.forEach(function (column, to) {

			var from = self._findColumn(oldCols, column),
			    keys;

			if (from) {

				if (self.config.columns === true || self.config.columns == undefined) {
					keys = Object.keys(from);
					keys.push("width");
				} else {
					keys = self.config.columns;
				}

				keys.forEach(function (key) {
					if (typeof column[key] !== "undefined") {
						from[key] = column[key];
					}
				});

				if (from.columns) {
					from.columns = self.mergeDefinition(from.columns, column.columns);
				}

				output.push(from);
			}
		});

		oldCols.forEach(function (column, i) {
			var from = self._findColumn(newCols, column);
			if (!from) {
				if (output.length > i) {
					output.splice(i, 0, column);
				} else {
					output.push(column);
				}
			}
		});

		return output;
	};

	//find matching columns
	Persistence.prototype._findColumn = function (columns, subject) {
		var type = subject.columns ? "group" : subject.field ? "field" : "object";

		return columns.find(function (col) {
			switch (type) {
				case "group":
					return col.title === subject.title && col.columns.length === subject.columns.length;
					break;

				case "field":
					return col.field === subject.field;
					break;

				case "object":
					return col === subject;
					break;
			}
		});
	};

	//save data
	Persistence.prototype.save = function (type) {
		var data = {};

		switch (type) {
			case "columns":
				data = this.parseColumns(this.table.columnManager.getColumns());
				break;

			case "filter":
				data = this.table.modules.filter.getFilters();
				break;

			case "sort":
				data = this.validateSorters(this.table.modules.sort.getSort());
				break;

			case "group":
				data = this.getGroupConfig();
				break;

			case "page":
				data = this.getPageConfig();
				break;
		}

		if (this.writeFunc) {
			this.writeFunc(this.id, type, data);
		}
	};

	//ensure sorters contain no function data
	Persistence.prototype.validateSorters = function (data) {
		data.forEach(function (item) {
			item.column = item.field;
			delete item.field;
		});

		return data;
	};

	Persistence.prototype.getGroupConfig = function () {
		if (this.config.group) {
			if (this.config.group === true || this.config.group.groupBy) {
				data.groupBy = this.table.options.groupBy;
			}

			if (this.config.group === true || this.config.group.groupStartOpen) {
				data.groupStartOpen = this.table.options.groupStartOpen;
			}

			if (this.config.group === true || this.config.group.groupHeader) {
				data.groupHeader = this.table.options.groupHeader;
			}
		}

		return data;
	};

	Persistence.prototype.getPageConfig = function () {
		var data = {};

		if (this.config.page) {
			if (this.config.page === true || this.config.page.size) {
				data.paginationSize = this.table.modules.page.getPageSize();
			}

			if (this.config.page === true || this.config.page.page) {
				data.paginationInitialPage = this.table.modules.page.getPage();
			}
		}

		return data;
	};

	//parse columns for data to store
	Persistence.prototype.parseColumns = function (columns) {
		var self = this,
		    definitions = [];

		columns.forEach(function (column) {
			var defStore = {},
			    colDef = column.getDefinition(),
			    keys;

			if (column.isGroup) {
				defStore.title = colDef.title;
				defStore.columns = self.parseColumns(column.getColumns());
			} else {
				defStore.field = column.getField();

				if (self.config.columns === true || self.config.columns == undefined) {
					keys = Object.keys(colDef);
					keys.push("width");
				} else {
					keys = self.config.columns;
				}

				keys.forEach(function (key) {

					switch (key) {
						case "width":
							defStore.width = column.getWidth();
							break;
						case "visible":
							defStore.visible = column.visible;
							break;

						default:
							defStore[key] = colDef[key];
					}
				});
			}

			definitions.push(defStore);
		});

		return definitions;
	};

	// read peristence information from storage
	Persistence.prototype.readers = {
		local: function local(id, type) {
			var data = localStorage.getItem(id + "-" + type);

			return data ? JSON.parse(data) : false;
		},
		cookie: function cookie(id, type) {
			var cookie = document.cookie,
			    key = id + "-" + type,
			    cookiePos = cookie.indexOf(key + "="),
			    end,
			    data;

			//if cookie exists, decode and load column data into tabulator
			if (cookiePos > -1) {
				cookie = cookie.substr(cookiePos);

				end = cookie.indexOf(";");

				if (end > -1) {
					cookie = cookie.substr(0, end);
				}

				data = cookie.replace(key + "=", "");
			}

			return data ? JSON.parse(data) : false;
		}
	};

	//write persistence information to storage
	Persistence.prototype.writers = {
		local: function local(id, type, data) {
			localStorage.setItem(id + "-" + type, JSON.stringify(data));
		},
		cookie: function cookie(id, type, data) {
			var expireDate = new Date();

			expireDate.setDate(expireDate.getDate() + 10000);

			document.cookie = id + "-" + type + "=" + JSON.stringify(data) + "; expires=" + expireDate.toUTCString();
		}
	};

	Tabulator.prototype.registerModule("persistence", Persistence);

	var Print = function Print(table) {
		this.table = table; //hold Tabulator object
		this.element = false;
		this.manualBlock = false;
	};

	Print.prototype.initialize = function () {
		window.addEventListener("beforeprint", this.replaceTable.bind(this));
		window.addEventListener("afterprint", this.cleanup.bind(this));
	};

	Print.prototype.replaceTable = function () {
		if (!this.manualBlock) {
			this.element = document.createElement("div");
			this.element.classList.add("tabulator-print-table");

			this.element.appendChild(this.table.modules.export.genereateTable(this.table.options.printConfig, this.table.options.printStyled, this.table.options.printRowRange, "print"));

			this.table.element.style.display = "none";

			this.table.element.parentNode.insertBefore(this.element, this.table.element);
		}
	};

	Print.prototype.cleanup = function () {
		document.body.classList.remove("tabulator-print-fullscreen-hide");

		if (this.element && this.element.parentNode) {
			this.element.parentNode.removeChild(this.element);
			this.table.element.style.display = "";
		}
	};

	Print.prototype.printFullscreen = function (visible, style, config) {
		var scrollX = window.scrollX,
		    scrollY = window.scrollY,
		    headerEl = document.createElement("div"),
		    footerEl = document.createElement("div"),
		    tableEl = this.table.modules.export.genereateTable(typeof config != "undefined" ? config : this.table.options.printConfig, typeof style != "undefined" ? style : this.table.options.printStyled, visible, "print"),
		    headerContent,
		    footerContent;

		this.manualBlock = true;

		this.element = document.createElement("div");
		this.element.classList.add("tabulator-print-fullscreen");

		if (this.table.options.printHeader) {
			headerEl.classList.add("tabulator-print-header");

			headerContent = typeof this.table.options.printHeader == "function" ? this.table.options.printHeader.call(this.table) : this.table.options.printHeader;

			if (typeof headerContent == "string") {
				headerEl.innerHTML = headerContent;
			} else {
				headerEl.appendChild(headerContent);
			}

			this.element.appendChild(headerEl);
		}

		this.element.appendChild(tableEl);

		if (this.table.options.printFooter) {
			footerEl.classList.add("tabulator-print-footer");

			footerContent = typeof this.table.options.printFooter == "function" ? this.table.options.printFooter.call(this.table) : this.table.options.printFooter;

			if (typeof footerContent == "string") {
				footerEl.innerHTML = footerContent;
			} else {
				footerEl.appendChild(footerContent);
			}

			this.element.appendChild(footerEl);
		}

		document.body.classList.add("tabulator-print-fullscreen-hide");
		document.body.appendChild(this.element);

		if (this.table.options.printFormatter) {
			this.table.options.printFormatter(this.element, tableEl);
		}

		window.print();

		this.cleanup();

		window.scrollTo(scrollX, scrollY);

		this.manualBlock = false;
	};

	Tabulator.prototype.registerModule("print", Print);
	var ReactiveData = function ReactiveData(table) {
		this.table = table; //hold Tabulator object
		this.data = false;
		this.blocked = false; //block reactivity while performing update
		this.origFuncs = {}; // hold original data array functions to allow replacement after data is done with
		this.currentVersion = 0;
	};

	ReactiveData.prototype.watchData = function (data) {
		var self = this,
		    pushFunc,
		    version;

		this.currentVersion++;

		version = this.currentVersion;

		self.unwatchData();

		self.data = data;

		//override array push function
		self.origFuncs.push = data.push;

		Object.defineProperty(self.data, "push", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments);

				if (!self.blocked && version === self.currentVersion) {
					args.forEach(function (arg) {
						self.table.rowManager.addRowActual(arg, false);
					});
				}

				return self.origFuncs.push.apply(data, arguments);
			}
		});

		//override array unshift function
		self.origFuncs.unshift = data.unshift;

		Object.defineProperty(self.data, "unshift", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments);

				if (!self.blocked && version === self.currentVersion) {
					args.forEach(function (arg) {
						self.table.rowManager.addRowActual(arg, true);
					});
				}

				return self.origFuncs.unshift.apply(data, arguments);
			}
		});

		//override array shift function
		self.origFuncs.shift = data.shift;

		Object.defineProperty(self.data, "shift", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var row;

				if (!self.blocked && version === self.currentVersion) {
					if (self.data.length) {
						row = self.table.rowManager.getRowFromDataObject(self.data[0]);

						if (row) {
							row.deleteActual();
						}
					}
				}

				return self.origFuncs.shift.call(data);
			}
		});

		//override array pop function
		self.origFuncs.pop = data.pop;

		Object.defineProperty(self.data, "pop", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var row;
				if (!self.blocked && version === self.currentVersion) {
					if (self.data.length) {
						row = self.table.rowManager.getRowFromDataObject(self.data[self.data.length - 1]);

						if (row) {
							row.deleteActual();
						}
					}
				}
				return self.origFuncs.pop.call(data);
			}
		});

		//override array splice function
		self.origFuncs.splice = data.splice;

		Object.defineProperty(self.data, "splice", {
			enumerable: false,
			configurable: true,
			value: function value() {
				var args = Array.from(arguments),
				    start = args[0] < 0 ? data.length + args[0] : args[0],
				    end = args[1],
				    newRows = args[2] ? args.slice(2) : false,
				    startRow;

				if (!self.blocked && version === self.currentVersion) {

					//add new rows
					if (newRows) {
						startRow = data[start] ? self.table.rowManager.getRowFromDataObject(data[start]) : false;

						if (startRow) {
							newRows.forEach(function (rowData) {
								self.table.rowManager.addRowActual(rowData, true, startRow, true);
							});
						} else {
							newRows = newRows.slice().reverse();

							newRows.forEach(function (rowData) {
								self.table.rowManager.addRowActual(rowData, true, false, true);
							});
						}
					}

					//delete removed rows
					if (end !== 0) {
						var oldRows = data.slice(start, typeof args[1] === "undefined" ? args[1] : start + end);

						oldRows.forEach(function (rowData, i) {
							var row = self.table.rowManager.getRowFromDataObject(rowData);

							if (row) {
								row.deleteActual(i !== oldRows.length - 1);
							}
						});
					}

					if (newRows || end !== 0) {
						self.table.rowManager.reRenderInPosition();
					}
				}

				return self.origFuncs.splice.apply(data, arguments);
			}
		});
	};

	ReactiveData.prototype.unwatchData = function () {
		if (this.data !== false) {
			for (var key in this.origFuncs) {
				Object.defineProperty(this.data, key, {
					enumerable: true,
					configurable: true,
					writable: true,
					value: this.origFuncs.key
				});
			}
		}
	};

	ReactiveData.prototype.watchRow = function (row) {
		var self = this,
		    data = row.getData();

		this.blocked = true;

		for (var key in data) {
			this.watchKey(row, data, key);
		}

		this.blocked = false;
	};

	ReactiveData.prototype.watchKey = function (row, data, key) {
		var self = this,
		    props = Object.getOwnPropertyDescriptor(data, key),
		    value = data[key],
		    version = this.currentVersion;

		Object.defineProperty(data, key, {
			set: function set(newValue) {
				value = newValue;
				if (!self.blocked && version === self.currentVersion) {
					var update = {};
					update[key] = newValue;
					row.updateData(update);
				}

				if (props.set) {
					props.set(newValue);
				}
			},
			get: function get() {

				if (props.get) {
					props.get();
				}

				return value;
			}
		});
	};

	ReactiveData.prototype.unwatchRow = function (row) {
		var data = row.getData();

		for (var key in data) {
			Object.defineProperty(data, key, {
				value: data[key]
			});
		}
	};

	ReactiveData.prototype.block = function () {
		this.blocked = true;
	};

	ReactiveData.prototype.unblock = function () {
		this.blocked = false;
	};

	Tabulator.prototype.registerModule("reactiveData", ReactiveData);

	var ResizeColumns = function ResizeColumns(table) {
		this.table = table; //hold Tabulator object
		this.startColumn = false;
		this.startX = false;
		this.startWidth = false;
		this.handle = null;
		this.prevHandle = null;
	};

	ResizeColumns.prototype.initializeColumn = function (type, column, element) {
		var self = this,
		    variableHeight = false,
		    mode = this.table.options.resizableColumns;

		//set column resize mode
		if (type === "header") {
			variableHeight = column.definition.formatter == "textarea" || column.definition.variableHeight;
			column.modules.resize = { variableHeight: variableHeight };
		}

		if (mode === true || mode == type) {

			var handle = document.createElement('div');
			handle.className = "tabulator-col-resize-handle";

			var prevHandle = document.createElement('div');
			prevHandle.className = "tabulator-col-resize-handle prev";

			handle.addEventListener("click", function (e) {
				e.stopPropagation();
			});

			var handleDown = function handleDown(e) {
				var nearestColumn = column.getLastColumn();

				if (nearestColumn && self._checkResizability(nearestColumn)) {
					self.startColumn = column;
					self._mouseDown(e, nearestColumn, handle);
				}
			};

			handle.addEventListener("mousedown", handleDown);
			handle.addEventListener("touchstart", handleDown, { passive: true });

			//reszie column on  double click
			handle.addEventListener("dblclick", function (e) {
				var col = column.getLastColumn();

				if (col && self._checkResizability(col)) {
					e.stopPropagation();
					col.reinitializeWidth(true);
				}
			});

			prevHandle.addEventListener("click", function (e) {
				e.stopPropagation();
			});

			var prevHandleDown = function prevHandleDown(e) {
				var nearestColumn, colIndex, prevColumn;

				nearestColumn = column.getFirstColumn();

				if (nearestColumn) {
					colIndex = self.table.columnManager.findColumnIndex(nearestColumn);
					prevColumn = colIndex > 0 ? self.table.columnManager.getColumnByIndex(colIndex - 1) : false;

					if (prevColumn && self._checkResizability(prevColumn)) {
						self.startColumn = column;
						self._mouseDown(e, prevColumn, prevHandle);
					}
				}
			};

			prevHandle.addEventListener("mousedown", prevHandleDown);
			prevHandle.addEventListener("touchstart", prevHandleDown, { passive: true });

			//resize column on double click
			prevHandle.addEventListener("dblclick", function (e) {
				var nearestColumn, colIndex, prevColumn;

				nearestColumn = column.getFirstColumn();

				if (nearestColumn) {
					colIndex = self.table.columnManager.findColumnIndex(nearestColumn);
					prevColumn = colIndex > 0 ? self.table.columnManager.getColumnByIndex(colIndex - 1) : false;

					if (prevColumn && self._checkResizability(prevColumn)) {
						e.stopPropagation();
						prevColumn.reinitializeWidth(true);
					}
				}
			});

			element.appendChild(handle);
			element.appendChild(prevHandle);
		}
	};

	ResizeColumns.prototype._checkResizability = function (column) {
		return typeof column.definition.resizable != "undefined" ? column.definition.resizable : this.table.options.resizableColumns;
	};

	ResizeColumns.prototype._mouseDown = function (e, column, handle) {
		var self = this;

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e) {
			// self.table.columnManager.tempScrollBlock();

			column.setWidth(self.startWidth + ((typeof e.screenX === "undefined" ? e.touches[0].screenX : e.screenX) - self.startX));

			if (!self.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight) {
				column.checkCellHeights();
			}
		}

		function mouseUp(e) {

			//block editor from taking action while resizing is taking place
			if (self.startColumn.modules.edit) {
				self.startColumn.modules.edit.blocked = false;
			}

			if (self.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight) {
				column.checkCellHeights();
			}

			document.body.removeEventListener("mouseup", mouseUp);
			document.body.removeEventListener("mousemove", mouseMove);

			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);

			self.table.element.classList.remove("tabulator-block-select");

			if (self.table.options.persistence && self.table.modExists("persistence", true) && self.table.modules.persistence.config.columns) {
				self.table.modules.persistence.save("columns");
			}

			self.table.options.columnResized.call(self.table, column.getComponent());
		}

		e.stopPropagation(); //prevent resize from interfereing with movable columns

		//block editor from taking action while resizing is taking place
		if (self.startColumn.modules.edit) {
			self.startColumn.modules.edit.blocked = true;
		}

		self.startX = typeof e.screenX === "undefined" ? e.touches[0].screenX : e.screenX;
		self.startWidth = column.getWidth();

		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);
		handle.addEventListener("touchmove", mouseMove, { passive: true });
		handle.addEventListener("touchend", mouseUp);
	};

	Tabulator.prototype.registerModule("resizeColumns", ResizeColumns);
	var ResizeRows = function ResizeRows(table) {
		this.table = table; //hold Tabulator object
		this.startColumn = false;
		this.startY = false;
		this.startHeight = false;
		this.handle = null;
		this.prevHandle = null;
	};

	ResizeRows.prototype.initializeRow = function (row) {
		var self = this,
		    rowEl = row.getElement();

		var handle = document.createElement('div');
		handle.className = "tabulator-row-resize-handle";

		var prevHandle = document.createElement('div');
		prevHandle.className = "tabulator-row-resize-handle prev";

		handle.addEventListener("click", function (e) {
			e.stopPropagation();
		});

		var handleDown = function handleDown(e) {
			self.startRow = row;
			self._mouseDown(e, row, handle);
		};

		handle.addEventListener("mousedown", handleDown);
		handle.addEventListener("touchstart", handleDown, { passive: true });

		prevHandle.addEventListener("click", function (e) {
			e.stopPropagation();
		});

		var prevHandleDown = function prevHandleDown(e) {
			var prevRow = self.table.rowManager.prevDisplayRow(row);

			if (prevRow) {
				self.startRow = prevRow;
				self._mouseDown(e, prevRow, prevHandle);
			}
		};

		prevHandle.addEventListener("mousedown", prevHandleDown);
		prevHandle.addEventListener("touchstart", prevHandleDown, { passive: true });

		rowEl.appendChild(handle);
		rowEl.appendChild(prevHandle);
	};

	ResizeRows.prototype._mouseDown = function (e, row, handle) {
		var self = this;

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e) {
			row.setHeight(self.startHeight + ((typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY) - self.startY));
		}

		function mouseUp(e) {

			// //block editor from taking action while resizing is taking place
			// if(self.startColumn.modules.edit){
			// 	self.startColumn.modules.edit.blocked = false;
			// }

			document.body.removeEventListener("mouseup", mouseMove);
			document.body.removeEventListener("mousemove", mouseMove);

			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);

			self.table.element.classList.remove("tabulator-block-select");

			self.table.options.rowResized.call(this.table, row.getComponent());
		}

		e.stopPropagation(); //prevent resize from interfereing with movable columns

		//block editor from taking action while resizing is taking place
		// if(self.startColumn.modules.edit){
		// 	self.startColumn.modules.edit.blocked = true;
		// }

		self.startY = typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY;
		self.startHeight = row.getHeight();

		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);

		handle.addEventListener("touchmove", mouseMove, { passive: true });
		handle.addEventListener("touchend", mouseUp);
	};

	Tabulator.prototype.registerModule("resizeRows", ResizeRows);
	var ResizeTable = function ResizeTable(table) {
		this.table = table; //hold Tabulator object
		this.binding = false;
		this.observer = false;
		this.containerObserver = false;

		this.tableHeight = 0;
		this.tableWidth = 0;
		this.containerHeight = 0;
		this.containerWidth = 0;

		this.autoResize = false;
	};

	ResizeTable.prototype.initialize = function (row) {
		var _this69 = this;

		var table = this.table,
		    tableStyle;

		this.tableHeight = table.element.clientHeight;
		this.tableWidth = table.element.clientWidth;

		if (table.element.parentNode) {
			this.containerHeight = table.element.parentNode.clientHeight;
			this.containerWidth = table.element.parentNode.clientWidth;
		}

		if (typeof ResizeObserver !== "undefined" && table.rowManager.getRenderMode() === "virtual") {

			this.autoResize = true;

			this.observer = new ResizeObserver(function (entry) {
				if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {

					var nodeHeight = Math.floor(entry[0].contentRect.height);
					var nodeWidth = Math.floor(entry[0].contentRect.width);

					if (_this69.tableHeight != nodeHeight || _this69.tableWidth != nodeWidth) {
						_this69.tableHeight = nodeHeight;
						_this69.tableWidth = nodeWidth;

						if (table.element.parentNode) {
							_this69.containerHeight = table.element.parentNode.clientHeight;
							_this69.containerWidth = table.element.parentNode.clientWidth;
						}

						table.redraw();
					}
				}
			});

			this.observer.observe(table.element);

			tableStyle = window.getComputedStyle(table.element);

			if (this.table.element.parentNode && !this.table.rowManager.fixedHeight && (tableStyle.getPropertyValue("max-height") || tableStyle.getPropertyValue("min-height"))) {

				this.containerObserver = new ResizeObserver(function (entry) {
					if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {

						var nodeHeight = Math.floor(entry[0].contentRect.height);
						var nodeWidth = Math.floor(entry[0].contentRect.width);

						if (_this69.containerHeight != nodeHeight || _this69.containerWidth != nodeWidth) {
							_this69.containerHeight = nodeHeight;
							_this69.containerWidth = nodeWidth;
							_this69.tableHeight = table.element.clientHeight;
							_this69.tableWidth = table.element.clientWidth;

							table.redraw();
						}

						table.redraw();
					}
				});

				this.containerObserver.observe(this.table.element.parentNode);
			}
		} else {
			this.binding = function () {
				if (!table.browserMobile || table.browserMobile && !table.modules.edit.currentCell) {
					table.redraw();
				}
			};

			window.addEventListener("resize", this.binding);
		}
	};

	ResizeTable.prototype.clearBindings = function (row) {
		if (this.binding) {
			window.removeEventListener("resize", this.binding);
		}

		if (this.observer) {
			this.observer.unobserve(this.table.element);
		}

		if (this.containerObserver) {
			this.containerObserver.unobserve(this.table.element.parentNode);
		}
	};

	Tabulator.prototype.registerModule("resizeTable", ResizeTable);
	var ResponsiveLayout = function ResponsiveLayout(table) {
		this.table = table; //hold Tabulator object
		this.columns = [];
		this.hiddenColumns = [];
		this.mode = "";
		this.index = 0;
		this.collapseFormatter = [];
		this.collapseStartOpen = true;
		this.collapseHandleColumn = false;
	};

	//generate resposive columns list
	ResponsiveLayout.prototype.initialize = function () {
		var self = this,
		    columns = [];

		this.mode = this.table.options.responsiveLayout;
		this.collapseFormatter = this.table.options.responsiveLayoutCollapseFormatter || this.formatCollapsedData;
		this.collapseStartOpen = this.table.options.responsiveLayoutCollapseStartOpen;
		this.hiddenColumns = [];

		//detemine level of responsivity for each column
		this.table.columnManager.columnsByIndex.forEach(function (column, i) {
			if (column.modules.responsive) {
				if (column.modules.responsive.order && column.modules.responsive.visible) {
					column.modules.responsive.index = i;
					columns.push(column);

					if (!column.visible && self.mode === "collapse") {
						self.hiddenColumns.push(column);
					}
				}
			}
		});

		//sort list by responsivity
		columns = columns.reverse();
		columns = columns.sort(function (a, b) {
			var diff = b.modules.responsive.order - a.modules.responsive.order;
			return diff || b.modules.responsive.index - a.modules.responsive.index;
		});

		this.columns = columns;

		if (this.mode === "collapse") {
			this.generateCollapsedContent();
		}

		//assign collapse column
		for (var _iterator = this.table.columnManager.columnsByIndex, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
			var _ref;

			if (_isArray) {
				if (_i >= _iterator.length) break;
				_ref = _iterator[_i++];
			} else {
				_i = _iterator.next();
				if (_i.done) break;
				_ref = _i.value;
			}

			var col = _ref;

			if (col.definition.formatter == "responsiveCollapse") {
				this.collapseHandleColumn = col;
				break;
			}
		}

		if (this.collapseHandleColumn) {
			if (this.hiddenColumns.length) {
				this.collapseHandleColumn.show();
			} else {
				this.collapseHandleColumn.hide();
			}
		}
	};

	//define layout information
	ResponsiveLayout.prototype.initializeColumn = function (column) {
		var def = column.getDefinition();

		column.modules.responsive = { order: typeof def.responsive === "undefined" ? 1 : def.responsive, visible: def.visible === false ? false : true };
	};

	ResponsiveLayout.prototype.initializeRow = function (row) {
		var el;

		if (row.type !== "calc") {
			el = document.createElement("div");
			el.classList.add("tabulator-responsive-collapse");

			row.modules.responsiveLayout = {
				element: el,
				open: this.collapseStartOpen
			};

			if (!this.collapseStartOpen) {
				el.style.display = 'none';
			}
		}
	};

	ResponsiveLayout.prototype.layoutRow = function (row) {
		var rowEl = row.getElement();

		if (row.modules.responsiveLayout) {
			rowEl.appendChild(row.modules.responsiveLayout.element);
			this.generateCollapsedRowContent(row);
		}
	};

	//update column visibility
	ResponsiveLayout.prototype.updateColumnVisibility = function (column, visible) {
		var index;
		if (column.modules.responsive) {
			column.modules.responsive.visible = visible;
			this.initialize();
		}
	};

	ResponsiveLayout.prototype.hideColumn = function (column) {
		var colCount = this.hiddenColumns.length;

		column.hide(false, true);

		if (this.mode === "collapse") {
			this.hiddenColumns.unshift(column);
			this.generateCollapsedContent();

			if (this.collapseHandleColumn && !colCount) {
				this.collapseHandleColumn.show();
			}
		}
	};

	ResponsiveLayout.prototype.showColumn = function (column) {
		var index;

		column.show(false, true);
		//set column width to prevent calculation loops on uninitialized columns
		column.setWidth(column.getWidth());

		if (this.mode === "collapse") {
			index = this.hiddenColumns.indexOf(column);

			if (index > -1) {
				this.hiddenColumns.splice(index, 1);
			}

			this.generateCollapsedContent();

			if (this.collapseHandleColumn && !this.hiddenColumns.length) {
				this.collapseHandleColumn.hide();
			}
		}
	};

	//redraw columns to fit space
	ResponsiveLayout.prototype.update = function () {
		var self = this,
		    working = true;

		while (working) {

			var width = self.table.modules.layout.getMode() == "fitColumns" ? self.table.columnManager.getFlexBaseWidth() : self.table.columnManager.getWidth();

			var diff = (self.table.options.headerVisible ? self.table.columnManager.element.clientWidth : self.table.element.clientWidth) - width;

			if (diff < 0) {
				//table is too wide
				var column = self.columns[self.index];

				if (column) {
					self.hideColumn(column);
					self.index++;
				} else {
					working = false;
				}
			} else {

				//table has spare space
				var _column = self.columns[self.index - 1];

				if (_column) {
					if (diff > 0) {
						if (diff >= _column.getWidth()) {
							self.showColumn(_column);
							self.index--;
						} else {
							working = false;
						}
					} else {
						working = false;
					}
				} else {
					working = false;
				}
			}

			if (!self.table.rowManager.activeRowsCount) {
				self.table.rowManager.renderEmptyScroll();
			}
		}
	};

	ResponsiveLayout.prototype.generateCollapsedContent = function () {
		var self = this,
		    rows = this.table.rowManager.getDisplayRows();

		rows.forEach(function (row) {
			self.generateCollapsedRowContent(row);
		});
	};

	ResponsiveLayout.prototype.generateCollapsedRowContent = function (row) {
		var el, contents;

		if (row.modules.responsiveLayout) {
			el = row.modules.responsiveLayout.element;

			while (el.firstChild) {
				el.removeChild(el.firstChild);
			}contents = this.collapseFormatter(this.generateCollapsedRowData(row));
			if (contents) {
				el.appendChild(contents);
			}
		}
	};

	ResponsiveLayout.prototype.generateCollapsedRowData = function (row) {
		var self = this,
		    data = row.getData(),
		    output = [],
		    mockCellComponent;

		this.hiddenColumns.forEach(function (column) {
			var value = column.getFieldValue(data);

			if (column.definition.title && column.field) {
				if (column.modules.format && self.table.options.responsiveLayoutCollapseUseFormatters) {

					mockCellComponent = {
						value: false,
						data: {},
						getValue: function getValue() {
							return value;
						},
						getData: function getData() {
							return data;
						},
						getElement: function getElement() {
							return document.createElement("div");
						},
						getRow: function getRow() {
							return row.getComponent();
						},
						getColumn: function getColumn() {
							return column.getComponent();
						}
					};

					output.push({
						title: column.definition.title,
						value: column.modules.format.formatter.call(self.table.modules.format, mockCellComponent, column.modules.format.params)
					});
				} else {
					output.push({
						title: column.definition.title,
						value: value
					});
				}
			}
		});

		return output;
	};

	ResponsiveLayout.prototype.formatCollapsedData = function (data) {
		var list = document.createElement("table"),
		    listContents = "";

		data.forEach(function (item) {
			var div = document.createElement("div");

			if (item.value instanceof Node) {
				div.appendChild(item.value);
				item.value = div.innerHTML;
			}

			listContents += "<tr><td><strong>" + item.title + "</strong></td><td>" + item.value + "</td></tr>";
		});

		list.innerHTML = listContents;

		return Object.keys(data).length ? list : "";
	};

	Tabulator.prototype.registerModule("responsiveLayout", ResponsiveLayout);

	var SelectRow = function SelectRow(table) {
		this.table = table; //hold Tabulator object
		this.selecting = false; //flag selecting in progress
		this.lastClickedRow = false; //last clicked row
		this.selectPrev = []; //hold previously selected element for drag drop selection
		this.selectedRows = []; //hold selected rows
		this.headerCheckboxElement = null; // hold header select element
	};

	SelectRow.prototype.clearSelectionData = function (silent) {
		this.selecting = false;
		this.lastClickedRow = false;
		this.selectPrev = [];
		this.selectedRows = [];

		if (!silent) {
			this._rowSelectionChanged();
		}
	};

	SelectRow.prototype.initializeRow = function (row) {
		var self = this,
		    element = row.getElement();

		// trigger end of row selection
		var endSelect = function endSelect() {

			setTimeout(function () {
				self.selecting = false;
			}, 50);

			document.body.removeEventListener("mouseup", endSelect);
		};

		row.modules.select = { selected: false };

		//set row selection class
		if (self.table.options.selectableCheck.call(this.table, row.getComponent())) {
			element.classList.add("tabulator-selectable");
			element.classList.remove("tabulator-unselectable");

			if (self.table.options.selectable && self.table.options.selectable != "highlight") {
				if (self.table.options.selectableRangeMode === "click") {
					element.addEventListener("click", function (e) {
						if (e.shiftKey) {
							self.table._clearSelection();
							self.lastClickedRow = self.lastClickedRow || row;

							var lastClickedRowIdx = self.table.rowManager.getDisplayRowIndex(self.lastClickedRow);
							var rowIdx = self.table.rowManager.getDisplayRowIndex(row);

							var fromRowIdx = lastClickedRowIdx <= rowIdx ? lastClickedRowIdx : rowIdx;
							var toRowIdx = lastClickedRowIdx >= rowIdx ? lastClickedRowIdx : rowIdx;

							var rows = self.table.rowManager.getDisplayRows().slice(0);
							var toggledRows = rows.splice(fromRowIdx, toRowIdx - fromRowIdx + 1);

							if (e.ctrlKey || e.metaKey) {
								toggledRows.forEach(function (toggledRow) {
									if (toggledRow !== self.lastClickedRow) {

										if (self.table.options.selectable !== true && !self.isRowSelected(row)) {
											if (self.selectedRows.length < self.table.options.selectable) {
												self.toggleRow(toggledRow);
											}
										} else {
											self.toggleRow(toggledRow);
										}
									}
								});
								self.lastClickedRow = row;
							} else {
								self.deselectRows(undefined, true);

								if (self.table.options.selectable !== true) {
									if (toggledRows.length > self.table.options.selectable) {
										toggledRows = toggledRows.slice(0, self.table.options.selectable);
									}
								}

								self.selectRows(toggledRows);
							}
							self.table._clearSelection();
						} else if (e.ctrlKey || e.metaKey) {
							self.toggleRow(row);
							self.lastClickedRow = row;
						} else {
							self.deselectRows(undefined, true);
							self.selectRows(row);
							self.lastClickedRow = row;
						}
					});
				} else {
					element.addEventListener("click", function (e) {
						if (!self.table.modExists("edit") || !self.table.modules.edit.getCurrentCell()) {
							self.table._clearSelection();
						}

						if (!self.selecting) {
							self.toggleRow(row);
						}
					});

					element.addEventListener("mousedown", function (e) {
						if (e.shiftKey) {
							self.table._clearSelection();

							self.selecting = true;

							self.selectPrev = [];

							document.body.addEventListener("mouseup", endSelect);
							document.body.addEventListener("keyup", endSelect);

							self.toggleRow(row);

							return false;
						}
					});

					element.addEventListener("mouseenter", function (e) {
						if (self.selecting) {
							self.table._clearSelection();
							self.toggleRow(row);

							if (self.selectPrev[1] == row) {
								self.toggleRow(self.selectPrev[0]);
							}
						}
					});

					element.addEventListener("mouseout", function (e) {
						if (self.selecting) {
							self.table._clearSelection();
							self.selectPrev.unshift(row);
						}
					});
				}
			}
		} else {
			element.classList.add("tabulator-unselectable");
			element.classList.remove("tabulator-selectable");
		}
	};

	//toggle row selection
	SelectRow.prototype.toggleRow = function (row) {
		if (this.table.options.selectableCheck.call(this.table, row.getComponent())) {
			if (row.modules.select && row.modules.select.selected) {
				this._deselectRow(row);
			} else {
				this._selectRow(row);
			}
		}
	};

	//select a number of rows
	SelectRow.prototype.selectRows = function (rows) {
		var _this70 = this;

		var rowMatch;

		switch (typeof rows === 'undefined' ? 'undefined' : _typeof(rows)) {
			case "undefined":
				this.table.rowManager.rows.forEach(function (row) {
					_this70._selectRow(row, true, true);
				});

				this._rowSelectionChanged();
				break;

			case "string":

				rowMatch = this.table.rowManager.findRow(rows);

				if (rowMatch) {
					this._selectRow(rowMatch, true, true);
				} else {
					this.table.rowManager.getRows(rows).forEach(function (row) {
						_this70._selectRow(row, true, true);
					});
				}

				this._rowSelectionChanged();
				break;

			default:
				if (Array.isArray(rows)) {
					rows.forEach(function (row) {
						_this70._selectRow(row, true, true);
					});

					this._rowSelectionChanged();
				} else {
					this._selectRow(rows, false, true);
				}
				break;
		}
	};

	//select an individual row
	SelectRow.prototype._selectRow = function (rowInfo, silent, force) {
		var index;

		//handle max row count
		if (!isNaN(this.table.options.selectable) && this.table.options.selectable !== true && !force) {
			if (this.selectedRows.length >= this.table.options.selectable) {
				if (this.table.options.selectableRollingSelection) {
					this._deselectRow(this.selectedRows[0]);
				} else {
					return false;
				}
			}
		}

		var row = this.table.rowManager.findRow(rowInfo);

		if (row) {
			if (this.selectedRows.indexOf(row) == -1) {
				if (!row.modules.select) {
					row.modules.select = {};
				}

				row.modules.select.selected = true;
				if (row.modules.select.checkboxEl) {
					row.modules.select.checkboxEl.checked = true;
				}
				row.getElement().classList.add("tabulator-selected");

				this.selectedRows.push(row);

				if (this.table.options.dataTreeSelectPropagate) {
					this.childRowSelection(row, true);
				}

				if (!silent) {
					this.table.options.rowSelected.call(this.table, row.getComponent());
				}

				this._rowSelectionChanged(silent);
			}
		} else {
			if (!silent) {
				console.warn("Selection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	};

	SelectRow.prototype.isRowSelected = function (row) {
		return this.selectedRows.indexOf(row) !== -1;
	};

	//deselect a number of rows
	SelectRow.prototype.deselectRows = function (rows, silent) {
		var self = this,
		    rowCount;

		if (typeof rows == "undefined") {

			rowCount = self.selectedRows.length;

			for (var i = 0; i < rowCount; i++) {
				self._deselectRow(self.selectedRows[0], true);
			}

			self._rowSelectionChanged(silent);
		} else {
			if (Array.isArray(rows)) {
				rows.forEach(function (row) {
					self._deselectRow(row, true);
				});

				self._rowSelectionChanged(silent);
			} else {
				self._deselectRow(rows, silent);
			}
		}
	};

	//deselect an individual row
	SelectRow.prototype._deselectRow = function (rowInfo, silent) {
		var self = this,
		    row = self.table.rowManager.findRow(rowInfo),
		    index;

		if (row) {
			index = self.selectedRows.findIndex(function (selectedRow) {
				return selectedRow == row;
			});

			if (index > -1) {

				if (!row.modules.select) {
					row.modules.select = {};
				}

				row.modules.select.selected = false;
				if (row.modules.select.checkboxEl) {
					row.modules.select.checkboxEl.checked = false;
				}
				row.getElement().classList.remove("tabulator-selected");
				self.selectedRows.splice(index, 1);

				if (this.table.options.dataTreeSelectPropagate) {
					this.childRowSelection(row, false);
				}

				if (!silent) {
					self.table.options.rowDeselected.call(this.table, row.getComponent());
				}

				self._rowSelectionChanged(silent);
			}
		} else {
			if (!silent) {
				console.warn("Deselection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	};

	SelectRow.prototype.getSelectedData = function () {
		var data = [];

		this.selectedRows.forEach(function (row) {
			data.push(row.getData());
		});

		return data;
	};

	SelectRow.prototype.getSelectedRows = function () {

		var rows = [];

		this.selectedRows.forEach(function (row) {
			rows.push(row.getComponent());
		});

		return rows;
	};

	SelectRow.prototype._rowSelectionChanged = function (silent) {
		if (this.headerCheckboxElement) {
			if (this.selectedRows.length === 0) {
				this.headerCheckboxElement.checked = false;
				this.headerCheckboxElement.indeterminate = false;
			} else if (this.table.rowManager.rows.length === this.selectedRows.length) {
				this.headerCheckboxElement.checked = true;
				this.headerCheckboxElement.indeterminate = false;
			} else {
				this.headerCheckboxElement.indeterminate = true;
				this.headerCheckboxElement.checked = false;
			}
		}

		if (!silent) {
			this.table.options.rowSelectionChanged.call(this.table, this.getSelectedData(), this.getSelectedRows());
		}
	};

	SelectRow.prototype.registerRowSelectCheckbox = function (row, element) {
		if (!row._row.modules.select) {
			row._row.modules.select = {};
		}

		row._row.modules.select.checkboxEl = element;
	};

	SelectRow.prototype.registerHeaderSelectCheckbox = function (element) {
		this.headerCheckboxElement = element;
	};

	SelectRow.prototype.childRowSelection = function (row, select) {
		var children = this.table.modules.dataTree.getChildren(row);

		if (select) {
			for (var _iterator2 = children, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
				var _ref2;

				if (_isArray2) {
					if (_i2 >= _iterator2.length) break;
					_ref2 = _iterator2[_i2++];
				} else {
					_i2 = _iterator2.next();
					if (_i2.done) break;
					_ref2 = _i2.value;
				}

				var child = _ref2;

				this._selectRow(child, true);
			}
		} else {
			for (var _iterator3 = children, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {
				var _ref3;

				if (_isArray3) {
					if (_i3 >= _iterator3.length) break;
					_ref3 = _iterator3[_i3++];
				} else {
					_i3 = _iterator3.next();
					if (_i3.done) break;
					_ref3 = _i3.value;
				}

				var _child = _ref3;

				this._deselectRow(_child, true);
			}
		}
	};

	Tabulator.prototype.registerModule("selectRow", SelectRow);

	var Sort = function Sort(table) {
		this.table = table; //hold Tabulator object
		this.sortList = []; //holder current sort
		this.changed = false; //has the sort changed since last render
	};

	//initialize column header for sorting
	Sort.prototype.initializeColumn = function (column, content) {
		var self = this,
		    sorter = false,
		    colEl,
		    arrowEl;

		switch (_typeof(column.definition.sorter)) {
			case "string":
				if (self.sorters[column.definition.sorter]) {
					sorter = self.sorters[column.definition.sorter];
				} else {
					console.warn("Sort Error - No such sorter found: ", column.definition.sorter);
				}
				break;

			case "function":
				sorter = column.definition.sorter;
				break;
		}

		column.modules.sort = {
			sorter: sorter, dir: "none",
			params: column.definition.sorterParams || {},
			startingDir: column.definition.headerSortStartingDir || "asc",
			tristate: typeof column.definition.headerSortTristate !== "undefined" ? column.definition.headerSortTristate : this.table.options.headerSortTristate
		};

		if (typeof column.definition.headerSort === "undefined" ? this.table.options.headerSort !== false : column.definition.headerSort !== false) {

			colEl = column.getElement();

			colEl.classList.add("tabulator-sortable");

			arrowEl = document.createElement("div");
			arrowEl.classList.add("tabulator-arrow");
			//create sorter arrow
			content.appendChild(arrowEl);

			//sort on click
			colEl.addEventListener("click", function (e) {
				var dir = "",
				    sorters = [],
				    match = false;

				if (column.modules.sort) {
					if (column.modules.sort.tristate) {
						if (column.modules.sort.dir == "none") {
							dir = column.modules.sort.startingDir;
						} else {
							if (column.modules.sort.dir == column.modules.sort.startingDir) {
								dir = column.modules.sort.dir == "asc" ? "desc" : "asc";
							} else {
								dir = "none";
							}
						}
					} else {
						switch (column.modules.sort.dir) {
							case "asc":
								dir = "desc";
								break;

							case "desc":
								dir = "asc";
								break;

							default:
								dir = column.modules.sort.startingDir;
						}
					}

					if (self.table.options.columnHeaderSortMulti && (e.shiftKey || e.ctrlKey)) {
						sorters = self.getSort();

						match = sorters.findIndex(function (sorter) {
							return sorter.field === column.getField();
						});

						if (match > -1) {
							sorters[match].dir = dir;

							if (match != sorters.length - 1) {
								match = sorters.splice(match, 1)[0];
								if (dir != "none") {
									sorters.push(match);
								}
							}
						} else {
							if (dir != "none") {
								sorters.push({ column: column, dir: dir });
							}
						}

						//add to existing sort
						self.setSort(sorters);
					} else {
						if (dir == "none") {
							self.clear();
						} else {
							//sort by column only
							self.setSort(column, dir);
						}
					}

					self.table.rowManager.sorterRefresh(!self.sortList.length);
				}
			});
		}
	};

	//check if the sorters have changed since last use
	Sort.prototype.hasChanged = function () {
		var changed = this.changed;
		this.changed = false;
		return changed;
	};

	//return current sorters
	Sort.prototype.getSort = function () {
		var self = this,
		    sorters = [];

		self.sortList.forEach(function (item) {
			if (item.column) {
				sorters.push({ column: item.column.getComponent(), field: item.column.getField(), dir: item.dir });
			}
		});

		return sorters;
	};

	//change sort list and trigger sort
	Sort.prototype.setSort = function (sortList, dir) {
		var self = this,
		    newSortList = [];

		if (!Array.isArray(sortList)) {
			sortList = [{ column: sortList, dir: dir }];
		}

		sortList.forEach(function (item) {
			var column;

			column = self.table.columnManager.findColumn(item.column);

			if (column) {
				item.column = column;
				newSortList.push(item);
				self.changed = true;
			} else {
				console.warn("Sort Warning - Sort field does not exist and is being ignored: ", item.column);
			}
		});

		self.sortList = newSortList;

		if (this.table.options.persistence && this.table.modExists("persistence", true) && this.table.modules.persistence.config.sort) {
			this.table.modules.persistence.save("sort");
		}
	};

	//clear sorters
	Sort.prototype.clear = function () {
		this.setSort([]);
	};

	//find appropriate sorter for column
	Sort.prototype.findSorter = function (column) {
		var row = this.table.rowManager.activeRows[0],
		    sorter = "string",
		    field,
		    value;

		if (row) {
			row = row.getData();
			field = column.getField();

			if (field) {

				value = column.getFieldValue(row);

				switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
					case "undefined":
						sorter = "string";
						break;

					case "boolean":
						sorter = "boolean";
						break;

					default:
						if (!isNaN(value) && value !== "") {
							sorter = "number";
						} else {
							if (value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)) {
								sorter = "alphanum";
							}
						}
						break;
				}
			}
		}

		return this.sorters[sorter];
	};

	//work through sort list sorting data
	Sort.prototype.sort = function (data) {
		var self = this,
		    lastSort,
		    sortList;

		sortList = this.table.options.sortOrderReverse ? self.sortList.slice().reverse() : self.sortList;

		if (self.table.options.dataSorting) {
			self.table.options.dataSorting.call(self.table, self.getSort());
		}

		self.clearColumnHeaders();

		if (!self.table.options.ajaxSorting) {

			sortList.forEach(function (item, i) {

				if (item.column && item.column.modules.sort) {

					//if no sorter has been defined, take a guess
					if (!item.column.modules.sort.sorter) {
						item.column.modules.sort.sorter = self.findSorter(item.column);
					}

					self._sortItem(data, item.column, item.dir, sortList, i);
				}

				self.setColumnHeader(item.column, item.dir);
			});
		} else {
			sortList.forEach(function (item, i) {
				self.setColumnHeader(item.column, item.dir);
			});
		}

		if (self.table.options.dataSorted) {
			self.table.options.dataSorted.call(self.table, self.getSort(), self.table.rowManager.getComponents("active"));
		}
	};

	//clear sort arrows on columns
	Sort.prototype.clearColumnHeaders = function () {
		this.table.columnManager.getRealColumns().forEach(function (column) {
			if (column.modules.sort) {
				column.modules.sort.dir = "none";
				column.getElement().setAttribute("aria-sort", "none");
			}
		});
	};

	//set the column header sort direction
	Sort.prototype.setColumnHeader = function (column, dir) {
		column.modules.sort.dir = dir;
		column.getElement().setAttribute("aria-sort", dir);
	};

	//sort each item in sort list
	Sort.prototype._sortItem = function (data, column, dir, sortList, i) {
		var self = this;

		var params = typeof column.modules.sort.params === "function" ? column.modules.sort.params(column.getComponent(), dir) : column.modules.sort.params;

		data.sort(function (a, b) {

			var result = self._sortRow(a, b, column, dir, params);

			//if results match recurse through previous searchs to be sure
			if (result === 0 && i) {
				for (var j = i - 1; j >= 0; j--) {
					result = self._sortRow(a, b, sortList[j].column, sortList[j].dir, params);

					if (result !== 0) {
						break;
					}
				}
			}

			return result;
		});
	};

	//process individual rows for a sort function on active data
	Sort.prototype._sortRow = function (a, b, column, dir, params) {
		var el1Comp, el2Comp, colComp;

		//switch elements depending on search direction
		var el1 = dir == "asc" ? a : b;
		var el2 = dir == "asc" ? b : a;

		a = column.getFieldValue(el1.getData());
		b = column.getFieldValue(el2.getData());

		a = typeof a !== "undefined" ? a : "";
		b = typeof b !== "undefined" ? b : "";

		el1Comp = el1.getComponent();
		el2Comp = el2.getComponent();

		return column.modules.sort.sorter.call(this, a, b, el1Comp, el2Comp, column.getComponent(), dir, params);
	};

	//default data sorters
	Sort.prototype.sorters = {

		//sort numbers
		number: function number(a, b, aRow, bRow, column, dir, params) {
			var alignEmptyValues = params.alignEmptyValues;
			var decimal = params.decimalSeparator || ".";
			var thousand = params.thousandSeparator || ",";
			var emptyAlign = 0;

			a = parseFloat(String(a).split(thousand).join("").split(decimal).join("."));
			b = parseFloat(String(b).split(thousand).join("").split(decimal).join("."));

			//handle non numeric values
			if (isNaN(a)) {
				emptyAlign = isNaN(b) ? 0 : -1;
			} else if (isNaN(b)) {
				emptyAlign = 1;
			} else {
				//compare valid values
				return a - b;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort strings
		string: function string(a, b, aRow, bRow, column, dir, params) {
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;
			var locale;

			//handle empty values
			if (!a) {
				emptyAlign = !b ? 0 : -1;
			} else if (!b) {
				emptyAlign = 1;
			} else {
				//compare valid values
				switch (_typeof(params.locale)) {
					case "boolean":
						if (params.locale) {
							locale = this.table.modules.localize.getLocale();
						}
						break;
					case "string":
						locale = params.locale;
						break;
				}

				return String(a).toLowerCase().localeCompare(String(b).toLowerCase(), locale);
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort date
		date: function date(a, b, aRow, bRow, column, dir, params) {
			if (!params.format) {
				params.format = "DD/MM/YYYY";
			}

			return this.sorters.datetime.call(this, a, b, aRow, bRow, column, dir, params);
		},

		//sort hh:mm formatted times
		time: function time(a, b, aRow, bRow, column, dir, params) {
			if (!params.format) {
				params.format = "hh:mm";
			}

			return this.sorters.datetime.call(this, a, b, aRow, bRow, column, dir, params);
		},

		//sort datetime
		datetime: function datetime(a, b, aRow, bRow, column, dir, params) {
			var format = params.format || "DD/MM/YYYY hh:mm:ss",
			    alignEmptyValues = params.alignEmptyValues,
			    emptyAlign = 0;

			if (typeof moment != "undefined") {
				a = moment(a, format);
				b = moment(b, format);

				if (!a.isValid()) {
					emptyAlign = !b.isValid() ? 0 : -1;
				} else if (!b.isValid()) {
					emptyAlign = 1;
				} else {
					//compare valid values
					return a - b;
				}

				//fix empty values in position
				if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
					emptyAlign *= -1;
				}

				return emptyAlign;
			} else {
				console.error("Sort Error - 'datetime' sorter is dependant on moment.js");
			}
		},

		//sort booleans
		boolean: function boolean(a, b, aRow, bRow, column, dir, params) {
			var el1 = a === true || a === "true" || a === "True" || a === 1 ? 1 : 0;
			var el2 = b === true || b === "true" || b === "True" || b === 1 ? 1 : 0;

			return el1 - el2;
		},

		//sort if element contains any data
		array: function array(a, b, aRow, bRow, column, dir, params) {
			var el1 = 0;
			var el2 = 0;
			var type = params.type || "length";
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;

			function calc(value) {

				switch (type) {
					case "length":
						return value.length;
						break;

					case "sum":
						return value.reduce(function (c, d) {
							return c + d;
						});
						break;

					case "max":
						return Math.max.apply(null, value);
						break;

					case "min":
						return Math.min.apply(null, value);
						break;

					case "avg":
						return value.reduce(function (c, d) {
							return c + d;
						}) / value.length;
						break;
				}
			}

			//handle non array values
			if (!Array.isArray(a)) {
				alignEmptyValues = !Array.isArray(b) ? 0 : -1;
			} else if (!Array.isArray(b)) {
				alignEmptyValues = 1;
			} else {

				//compare valid values
				el1 = a ? calc(a) : 0;
				el2 = b ? calc(b) : 0;

				return el1 - el2;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		},

		//sort if element contains any data
		exists: function exists(a, b, aRow, bRow, column, dir, params) {
			var el1 = typeof a == "undefined" ? 0 : 1;
			var el2 = typeof b == "undefined" ? 0 : 1;

			return el1 - el2;
		},

		//sort alpha numeric strings
		alphanum: function alphanum(as, bs, aRow, bRow, column, dir, params) {
			var a,
			    b,
			    a1,
			    b1,
			    i = 0,
			    L,
			    rx = /(\d+)|(\D+)/g,
			    rd = /\d/;
			var alignEmptyValues = params.alignEmptyValues;
			var emptyAlign = 0;

			//handle empty values
			if (!as && as !== 0) {
				emptyAlign = !bs && bs !== 0 ? 0 : -1;
			} else if (!bs && bs !== 0) {
				emptyAlign = 1;
			} else {

				if (isFinite(as) && isFinite(bs)) return as - bs;
				a = String(as).toLowerCase();
				b = String(bs).toLowerCase();
				if (a === b) return 0;
				if (!(rd.test(a) && rd.test(b))) return a > b ? 1 : -1;
				a = a.match(rx);
				b = b.match(rx);
				L = a.length > b.length ? b.length : a.length;
				while (i < L) {
					a1 = a[i];
					b1 = b[i++];
					if (a1 !== b1) {
						if (isFinite(a1) && isFinite(b1)) {
							if (a1.charAt(0) === "0") a1 = "." + a1;
							if (b1.charAt(0) === "0") b1 = "." + b1;
							return a1 - b1;
						} else return a1 > b1 ? 1 : -1;
					}
				}

				return a.length > b.length;
			}

			//fix empty values in position
			if (alignEmptyValues === "top" && dir === "desc" || alignEmptyValues === "bottom" && dir === "asc") {
				emptyAlign *= -1;
			}

			return emptyAlign;
		}
	};

	Tabulator.prototype.registerModule("sort", Sort);

	var Validate = function Validate(table) {
		this.table = table;
	};

	//validate
	Validate.prototype.initializeColumn = function (column) {
		var self = this,
		    config = [],
		    validator;

		if (column.definition.validator) {

			if (Array.isArray(column.definition.validator)) {
				column.definition.validator.forEach(function (item) {
					validator = self._extractValidator(item);

					if (validator) {
						config.push(validator);
					}
				});
			} else {
				validator = this._extractValidator(column.definition.validator);

				if (validator) {
					config.push(validator);
				}
			}

			column.modules.validate = config.length ? config : false;
		}
	};

	Validate.prototype._extractValidator = function (value) {
		var type, params, pos;

		switch (typeof value === 'undefined' ? 'undefined' : _typeof(value)) {
			case "string":
				pos = value.indexOf(':');

				if (pos > -1) {
					type = value.substring(0, pos);
					params = value.substring(pos + 1);
				} else {
					type = value;
				}

				return this._buildValidator(type, params);
				break;

			case "function":
				return this._buildValidator(value);
				break;

			case "object":
				return this._buildValidator(value.type, value.parameters);
				break;
		}
	};

	Validate.prototype._buildValidator = function (type, params) {

		var func = typeof type == "function" ? type : this.validators[type];

		if (!func) {
			console.warn("Validator Setup Error - No matching validator found:", type);
			return false;
		} else {
			return {
				type: typeof type == "function" ? "function" : type,
				func: func,
				params: params
			};
		}
	};

	Validate.prototype.validate = function (validators, cell, value) {
		var self = this,
		    valid = [];

		if (validators) {
			validators.forEach(function (item) {
				if (!item.func.call(self, cell, value, item.params)) {
					valid.push({
						type: item.type,
						parameters: item.params
					});
				}
			});
		}

		return valid.length ? valid : true;
	};

	Validate.prototype.validators = {

		//is integer
		integer: function integer(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			value = Number(value);
			return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;
		},

		//is float
		float: function float(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			value = Number(value);
			return typeof value === 'number' && isFinite(value) && value % 1 !== 0;
		},

		//must be a number
		numeric: function numeric(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return !isNaN(value);
		},

		//must be a string
		string: function string(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return isNaN(value);
		},

		//maximum value
		max: function max(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return parseFloat(value) <= parameters;
		},

		//minimum value
		min: function min(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return parseFloat(value) >= parameters;
		},

		//minimum string length
		minLength: function minLength(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).length >= parameters;
		},

		//maximum string length
		maxLength: function maxLength(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			return String(value).length <= parameters;
		},

		//in provided value list
		in: function _in(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			if (typeof parameters == "string") {
				parameters = parameters.split("|");
			}

			return value === "" || parameters.indexOf(value) > -1;
		},

		//must match provided regex
		regex: function regex(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			var reg = new RegExp(parameters);

			return reg.test(value);
		},

		//value must be unique in this column
		unique: function unique(cell, value, parameters) {
			if (value === "" || value === null || typeof value === "undefined") {
				return true;
			}
			var unique = true;

			var cellData = cell.getData();
			var column = cell.getColumn()._getSelf();

			this.table.rowManager.rows.forEach(function (row) {
				var data = row.getData();

				if (data !== cellData) {
					if (value == column.getFieldValue(data)) {
						unique = false;
					}
				}
			});

			return unique;
		},

		//must have a value
		required: function required(cell, value, parameters) {
			return value !== "" && value !== null && typeof value !== "undefined";
		}
	};

	Tabulator.prototype.registerModule("validate", Validate);

	return Tabulator;
});

/***/ }),
/* 29 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__utils_index__ = __webpack_require__(4);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AlternativeVisualizersWrapper; });




var AlternativeVisualizersWrapper = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AlternativeVisualizersWrapper, _super);
    function AlternativeVisualizersWrapper(visualizers, targetElement, question, data, options) {
        var _this = _super.call(this, targetElement, question, data, options) || this;
        _this.visualizers = visualizers;
        if (!visualizers || visualizers.length < 2) {
            throw new Error("VisualizerArrayWrapper works with visualizers collection only.");
        }
        _this.visualizer = visualizers[0];
        return _this;
    }
    AlternativeVisualizersWrapper.prototype.setVisualizer = function (name) {
        if (!!this.visualizer) {
            this.visualizer.destroy();
        }
        this.visualizer = this.visualizers.filter(function (v) { return v.name === name; })[0];
        this.visualizer.render(this.visualizerContainer);
        this.invokeOnUpdate();
    };
    AlternativeVisualizersWrapper.prototype.update = function (data) {
        this.visualizer.update(data);
    };
    AlternativeVisualizersWrapper.prototype.destroy = function () {
        this.visualizer.destroy();
        _super.prototype.destroy.call(this);
    };
    AlternativeVisualizersWrapper.prototype.renderContent = function (container) {
        this.visualizerContainer = container;
        this.visualizer.render(this.visualizerContainer);
    };
    AlternativeVisualizersWrapper.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        var selectWrapper = __WEBPACK_IMPORTED_MODULE_3__utils_index__["a" /* ToolbarHelper */].createSelector(toolbar, this.visualizers.map(function (visualizer) {
            return {
                value: visualizer.name,
                text: __WEBPACK_IMPORTED_MODULE_2__localizationManager__["a" /* localization */].getString("visualizer_" + visualizer.name)
            };
        }), function (option) { return _this.visualizer.name === option.value; }, function (e) { return _this.setVisualizer(e.target.value); });
        toolbar.appendChild(selectWrapper);
        _super.prototype.createToolbarItems.call(this, toolbar);
    };
    return AlternativeVisualizersWrapper;
}(__WEBPACK_IMPORTED_MODULE_1__visualizerBase__["a" /* VisualizerBase */]));



/***/ }),
/* 30 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ElementVisibility; });
var ElementVisibility;
(function (ElementVisibility) {
    ElementVisibility[ElementVisibility["Visible"] = 0] = "Visible";
    ElementVisibility[ElementVisibility["Invisible"] = 1] = "Invisible";
    ElementVisibility[ElementVisibility["PublicInvisible"] = 2] = "PublicInvisible";
})(ElementVisibility || (ElementVisibility = {}));


/***/ }),
/* 31 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return englishStrings; });
//Uncomment this line on creating a translation file
//import { localization } from "../localizationManager";
var englishStrings = {
    groupButton: "Group By Me",
    ungroupButton: "Ungroup By Me",
    selectButton: "Select Me",
    hideColumn: "Hide column",
    showColumn: "Show column",
    makePrivateColumn: "Make column private",
    makePublicColumn: "Make column public",
    moveToDetail: "Move to Detail",
    showAsColumn: "Show as Column",
    visualizer_text: "Texts in table",
    visualizer_wordcloud: "Wordcloud",
    chartType_bar: "Bar",
    chartType_stackedbar: "Stacked Bar",
    chartType_doughnut: "Doughnut",
    chartType_pie: "Pie",
    chartType_scatter: "Scatter",
    chartType_gauge: "Gauge",
    chartType_bullet: "Bullet",
    hideButton: "Hide",
    resetFilter: "Reset Filter",
    clearButton: "Clear",
    addElement: "Choose question to show...",
    defaultOrder: "Default",
    ascOrder: "Ascending",
    descOrder: "Descending",
    showMinorColumns: "Show minor columns"
};
//Uncomment these two lines on creating a translation file. You should replace "en" and enStrings with your locale ("fr", "de" and so on) and your variable.
//localization.locales["en"] = englishStrings;
//localization.localeNames["en"] = "English";


/***/ }),
/* 32 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_survey_core__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__selectBase__ = __webpack_require__(6);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return BooleanPlotly; });




var BooleanPlotly = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](BooleanPlotly, _super);
    function BooleanPlotly(targetElement, question, data, options) {
        var _this = _super.call(this, targetElement, question, data, options) || this;
        _this.targetElement = targetElement;
        _this.chartTypes = BooleanPlotly.types;
        _this.chartType = _this.chartTypes[0];
        return _this;
    }
    Object.defineProperty(BooleanPlotly.prototype, "booleanQuestion", {
        get: function () {
            return this.question;
        },
        enumerable: true,
        configurable: true
    });
    BooleanPlotly.prototype.patchConfigParameters = function (chartNode, traces, layout, config) {
        var colors = this.getColors();
        var boolColors = [
            BooleanPlotly.trueColor || colors[0],
            BooleanPlotly.falseColor || colors[1]
        ];
        if (this.chartType === "pie" || this.chartType === "doughnut") {
            traces.forEach(function (trace) {
                trace.marker.colors = boolColors;
            });
        }
        else if (this.chartType === "bar") {
            traces.forEach(function (trace) {
                trace.marker.color = boolColors;
            });
        }
    };
    BooleanPlotly.prototype.getSelectedItemByText = function (itemText) {
        var labels = this.getLabels();
        var values = this.getValues();
        return new __WEBPACK_IMPORTED_MODULE_1_survey_core__["ItemValue"](values[labels.indexOf(itemText)], itemText);
    };
    BooleanPlotly.prototype.getValues = function () {
        return [
            this.booleanQuestion.valueTrue !== undefined
                ? this.booleanQuestion.valueTrue
                : true,
            this.booleanQuestion.valueFalse !== undefined
                ? this.booleanQuestion.valueFalse
                : false
        ];
    };
    BooleanPlotly.prototype.getLabels = function () {
        var labels = this.getValues();
        if (this.booleanQuestion.labelTrue !== undefined) {
            labels[0] = this.booleanQuestion.locLabelTrue.textOrHtml;
        }
        if (this.booleanQuestion.labelFalse !== undefined) {
            labels[1] = this.booleanQuestion.locLabelFalse.textOrHtml;
        }
        return labels;
    };
    BooleanPlotly.prototype.getData = function () {
        var _this = this;
        var values = this.getValues();
        var trueCount = 0;
        var falseCount = 0;
        this.data.forEach(function (row) {
            var rowValue = row[_this.question.name];
            if (rowValue === values[0]) {
                trueCount++;
            }
            if (rowValue === values[1]) {
                falseCount++;
            }
        });
        return [[trueCount, falseCount]];
    };
    BooleanPlotly.trueColor = "";
    BooleanPlotly.falseColor = "";
    BooleanPlotly.types = ["pie", "bar", "doughnut"];
    return BooleanPlotly;
}(__WEBPACK_IMPORTED_MODULE_3__selectBase__["b" /* SelectBasePlotly */]));

__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("boolean", BooleanPlotly);


/***/ }),
/* 33 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_survey_core___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_survey_core__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__selectBase__ = __webpack_require__(6);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return MatrixPlotly; });




var MatrixPlotly = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](MatrixPlotly, _super);
    function MatrixPlotly(targetNode, question, data, options) {
        var _this = _super.call(this, targetNode, question, data, options) || this;
        _this.chartTypes = MatrixPlotly.types;
        _this.chartType = _this.chartTypes[0];
        return _this;
    }
    MatrixPlotly.prototype.patchConfigParameters = function (chartNode, traces, layout, config) {
        var _this = this;
        var question = this.question;
        //var valueTitles = question.columns.map(column => column.text);
        layout.showlegend = true;
        if (this.chartType === "pie" || this.chartType === "doughnut") {
            layout.grid = { rows: 1, columns: traces.length };
        }
        else if (this.chartType === "stackedbar") {
            layout.height = undefined;
            layout.barmode = "stack";
        }
        else {
            layout.height = undefined;
        }
        question.columns.forEach(function (column, index) {
            if (_this.chartType === "pie" || _this.chartType === "doughnut") {
                traces[index].domain = { column: index };
            }
            else {
                traces[index].hoverinfo = "x+name";
                traces[index].marker.color = undefined;
                if (_this.chartType === "stackedbar") {
                    traces[index].type = "bar";
                    traces[index].name = column.text;
                    traces[index].width = 0.5 / traces.length;
                }
                else {
                    traces[index].name = column.text;
                    traces[index].width = 0.5 / traces.length;
                }
            }
        });
    };
    MatrixPlotly.prototype.valuesSource = function () {
        var question = this.question;
        return question.columns;
    };
    MatrixPlotly.prototype.getLabels = function () {
        var question = this.question;
        return question.rows.map(function (row) {
            return __WEBPACK_IMPORTED_MODULE_1_survey_core__["ItemValue"].getTextOrHtmlByValue(question.rows, row.value);
        });
    };
    MatrixPlotly.prototype.getData = function () {
        var _this = this;
        var question = this.question;
        var datasets = this.valuesSource().map(function (choice) {
            return question.rows.map(function (v) { return 0; });
        });
        this.data.forEach(function (rowData) {
            var questionValue = rowData[_this.question.name];
            if (!!questionValue) {
                question.rows.forEach(function (row, index) {
                    _this.getValues().forEach(function (val, dsIndex) {
                        if (questionValue[row.value] == val) {
                            datasets[dsIndex][index]++;
                        }
                    });
                });
            }
        });
        return datasets;
    };
    MatrixPlotly.types = ["bar", "stackedbar", "pie", "doughnut"];
    return MatrixPlotly;
}(__WEBPACK_IMPORTED_MODULE_3__selectBase__["b" /* SelectBasePlotly */]));

__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("matrix", MatrixPlotly);


/***/ }),
/* 34 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__visualizerBase__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__visualizationManager__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__localizationManager__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__utils_index__ = __webpack_require__(4);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return GaugePlotly; });

var Plotly = __webpack_require__(14);




var GaugePlotly = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](GaugePlotly, _super);
    function GaugePlotly(targetElement, question, data, options) {
        var _this = _super.call(this, targetElement, question, data, options) || this;
        _this.targetElement = targetElement;
        _this.chartNode = document.createElement("div");
        _this.toolbarChangeHandler = function (e) {
            if (_this.chartType !== e.target.value) {
                _this.chartType = e.target.value;
                _this.update(_this.data);
            }
        };
        _this.chartTypes = GaugePlotly.types;
        _this.chartType = _this.chartTypes[0];
        return _this;
    }
    GaugePlotly.prototype.update = function (data) {
        if (data !== undefined) {
            this._result = undefined;
        }
        _super.prototype.update.call(this, data);
        this.destroy();
        this.createChart();
        this.invokeOnUpdate();
    };
    GaugePlotly.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        if (this.chartTypes.length > 1) {
            var selectWrapper = __WEBPACK_IMPORTED_MODULE_4__utils_index__["a" /* ToolbarHelper */].createSelector(toolbar, this.chartTypes.map(function (chartType) {
                return {
                    value: chartType,
                    text: __WEBPACK_IMPORTED_MODULE_3__localizationManager__["a" /* localization */].getString("chartType_" + chartType)
                };
            }), function (option) { return _this.chartType === option.value; }, this.toolbarChangeHandler);
            toolbar.appendChild(selectWrapper);
        }
        _super.prototype.createToolbarItems.call(this, toolbar);
    };
    GaugePlotly.prototype.destroy = function () {
        Plotly.purge(this.chartNode);
        this._result = undefined;
    };
    GaugePlotly.prototype.generateText = function (maxValue, minValue, stepsCount) {
        var texts = [];
        if (stepsCount === 5) {
            texts = [
                "very high (" + maxValue + ")",
                "high",
                "medium",
                "low",
                "very low (" + minValue + ")"
            ];
        }
        else {
            texts.push(maxValue);
            for (var i = 0; i < stepsCount - 2; i++) {
                texts.push("");
            }
            texts.push(minValue);
        }
        if (!!GaugePlotly.generateTextsCallback) {
            return GaugePlotly.generateTextsCallback(this.question, maxValue, minValue, stepsCount, texts);
        }
        return texts;
    };
    GaugePlotly.prototype.generateValues = function (maxValue, stepsCount) {
        var values = [];
        for (var i = 0; i < stepsCount; i++) {
            values.push(maxValue / stepsCount);
        }
        values.push(maxValue);
        return values;
    };
    GaugePlotly.prototype.generateColors = function (maxValue, minValue, stepsCount) {
        var palette = this.getColors();
        var colors = [];
        for (var i = 0; i < stepsCount; i++) {
            colors.push(palette[i]);
        }
        colors.push("rgba(255, 255, 255, 0)");
        return colors;
    };
    GaugePlotly.prototype.toPercentage = function (value, maxValue) {
        return (value / maxValue) * 100;
    };
    GaugePlotly.prototype.createChart = function () {
        var question = this.question;
        var rateValues = question.visibleRateValues;
        var maxValue = rateValues[rateValues.length - 1].value;
        var minValue = rateValues[0].value;
        var colors = this.generateColors(maxValue, minValue, GaugePlotly.stepsCount);
        var level = this.result;
        if (GaugePlotly.showAsPercentage) {
            level = this.toPercentage(level, maxValue);
            minValue = this.toPercentage(minValue, maxValue);
            maxValue = this.toPercentage(maxValue, maxValue);
        }
        var data = [
            {
                type: "indicator",
                mode: "gauge+number",
                gauge: {
                    axis: { range: [minValue, maxValue] },
                    shape: this.chartType,
                    bgcolor: "white",
                    bar: { color: colors[0] }
                },
                value: level,
                text: question.name,
                domain: { x: [0, 1], y: [0, 1] }
            }
        ];
        var height = 400;
        if (this.chartType === "bullet") {
            height = 250;
        }
        var layout = {
            width: 600,
            height: height,
            plot_bgcolor: this.backgroundColor,
            paper_bgcolor: this.backgroundColor
        };
        var config = {
            displayModeBar: false,
            staticPlot: true
        };
        this.chart = Plotly.newPlot(this.chartNode, data, layout, config);
    };
    GaugePlotly.prototype.renderContent = function (container) {
        this.createChart();
        container.appendChild(this.chartNode);
    };
    Object.defineProperty(GaugePlotly.prototype, "result", {
        get: function () {
            var _this = this;
            if (this._result === undefined) {
                var questionValues_1 = [];
                this.data.forEach(function (rowData) {
                    var questionValue = +rowData[_this.question.name];
                    if (!!questionValue) {
                        questionValues_1.push(questionValue);
                    }
                });
                this._result =
                    (questionValues_1 &&
                        questionValues_1.reduce(function (a, b) { return a + b; }, 0) / questionValues_1.length) ||
                        0;
                this._result = Math.ceil(this._result * 100) / 100;
            }
            return this._result;
        },
        enumerable: true,
        configurable: true
    });
    GaugePlotly.stepsCount = 5;
    GaugePlotly.types = ["gauge", "bullet"];
    GaugePlotly.showAsPercentage = false;
    return GaugePlotly;
}(__WEBPACK_IMPORTED_MODULE_1__visualizerBase__["a" /* VisualizerBase */]));

__WEBPACK_IMPORTED_MODULE_2__visualizationManager__["a" /* VisualizationManager */].registerVisualizer("rating", GaugePlotly);


/***/ }),
/* 35 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__selectBase__ = __webpack_require__(6);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3____ = __webpack_require__(15);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return SelectBaseSortablePlotly; });




var SelectBaseSortablePlotly = /** @class */ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SelectBaseSortablePlotly, _super);
    function SelectBaseSortablePlotly() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SelectBaseSortablePlotly.prototype.onChartTypeChanged = function () {
        this.setLabelsOrder("default");
        this.updateOrderSelector();
    };
    SelectBaseSortablePlotly.prototype.updateOrderSelector = function () {
        if (this.chartType == "bar") {
            this.choicesOrder.style.display = "inline-block";
        }
        else {
            this.choicesOrder.style.display = "none";
            this.choicesOrder.getElementsByTagName("select")[0].value = "default";
        }
    };
    SelectBaseSortablePlotly.prototype.createToolbarItems = function (toolbar) {
        var _this = this;
        if (this.chartTypes.length > 0) {
            this.choicesOrder = __WEBPACK_IMPORTED_MODULE_2__utils__["a" /* ToolbarHelper */].createSelector(toolbar, [
                { text: __WEBPACK_IMPORTED_MODULE_3____["localization"].getString("defaultOrder"), value: "default" },
                { text: __WEBPACK_IMPORTED_MODULE_3____["localization"].getString("ascOrder"), value: "asc" },
                { text: __WEBPACK_IMPORTED_MODULE_3____["localization"].getString("descOrder"), value: "desc" }
            ], function (option) { return false; }, function (e) {
                _this.setLabelsOrder(e.target.value);
                _this.update(_this.data);
            });
            _super.prototype.createToolbarItems.call(this, toolbar);
            toolbar.appendChild(this.choicesOrder);
        }
    };
    return SelectBaseSortablePlotly;
}(__WEBPACK_IMPORTED_MODULE_1__selectBase__["b" /* SelectBasePlotly */]));

__WEBPACK_IMPORTED_MODULE_3____["VisualizationManager"].registerVisualizer("checkbox", SelectBaseSortablePlotly);
__WEBPACK_IMPORTED_MODULE_3____["VisualizationManager"].registerVisualizer("radiogroup", SelectBaseSortablePlotly);
__WEBPACK_IMPORTED_MODULE_3____["VisualizationManager"].registerVisualizer("dropdown", SelectBaseSortablePlotly);
__WEBPACK_IMPORTED_MODULE_3____["VisualizationManager"].registerVisualizer("imagepicker", SelectBaseSortablePlotly);


/***/ }),
/* 36 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return stopWords; });
var stopWords = new Array("a", "about", "above", "across", "after", "again", "against", "all", "almost", "alone", "along", "already", "also", "although", "always", "among", "an", "and", "another", "any", "anybody", "anyone", "anything", "anywhere", "are", "area", "areas", "around", "as", "ask", "asked", "asking", "asks", "at", "away", "b", "back", "backed", "backing", "backs", "be", "became", "because", "become", "becomes", "been", "before", "began", "behind", "being", "beings", "best", "better", "between", "big", "both", "but", "by", "c", "came", "can", "cannot", "case", "cases", "certain", "certainly", "clear", "clearly", "come", "could", "d", "did", "differ", "different", "differently", "do", "does", "done", "down", "down", "downed", "downing", "downs", "during", "e", "each", "early", "either", "end", "ended", "ending", "ends", "enough", "even", "evenly", "ever", "every", "everybody", "everyone", "everything", "everywhere", "f", "face", "faces", "fact", "facts", "far", "felt", "few", "find", "finds", "first", "for", "four", "from", "full", "fully", "further", "furthered", "furthering", "furthers", "g", "gave", "general", "generally", "get", "gets", "give", "given", "gives", "go", "going", "good", "goods", "got", "great", "greater", "greatest", "group", "grouped", "grouping", "groups", "h", "had", "has", "have", "having", "he", "her", "here", "herself", "high", "high", "high", "higher", "highest", "him", "himself", "his", "how", "however", "i", "if", "important", "in", "interest", "interested", "interesting", "interests", "into", "is", "it", "its", "itself", "j", "just", "k", "keep", "keeps", "kind", "knew", "know", "known", "knows", "l", "large", "largely", "last", "later", "latest", "least", "less", "let", "lets", "like", "likely", "long", "longer", "longest", "m", "made", "make", "making", "man", "many", "may", "me", "member", "members", "men", "might", "more", "most", "mostly", "mr", "mrs", "much", "must", "my", "myself", "n", "necessary", "need", "needed", "needing", "needs", "never", "new", "new", "newer", "newest", "next", "no", "nobody", "non", "noone", "not", "nothing", "now", "nowhere", "number", "numbers", "o", "of", "off", "often", "old", "older", "oldest", "on", "once", "one", "only", "open", "opened", "opening", "opens", "or", "order", "ordered", "ordering", "orders", "other", "others", "our", "out", "over", "p", "part", "parted", "parting", "parts", "per", "perhaps", "place", "places", "point", "pointed", "pointing", "points", "possible", "present", "presented", "presenting", "presents", "problem", "problems", "put", "puts", "q", "quite", "r", "rather", "really", "right", "right", "room", "rooms", "s", "said", "same", "saw", "say", "says", "second", "seconds", "see", "seem", "seemed", "seeming", "seems", "sees", "several", "shall", "she", "should", "show", "showed", "showing", "shows", "side", "sides", "since", "small", "smaller", "smallest", "so", "some", "somebody", "someone", "something", "somewhere", "state", "states", "still", "still", "such", "sure", "t", "take", "taken", "than", "that", "the", "their", "them", "then", "there", "therefore", "these", "they", "thing", "things", "think", "thinks", "this", "those", "though", "thought", "thoughts", "three", "through", "thus", "to", "today", "together", "too", "took", "toward", "turn", "turned", "turning", "turns", "two", "u", "under", "until", "up", "upon", "us", "use", "used", "uses", "v", "very", "w", "want", "wanted", "wanting", "wants", "was", "way", "ways", "we", "well", "wells", "went", "were", "what", "when", "where", "whether", "which", "while", "who", "whole", "whose", "why", "will", "with", "within", "without", "work", "worked", "working", "works", "would", "x", "y", "year", "years", "yet", "you", "young", "younger", "youngest", "your", "yours", "z");


/***/ }),
/* 37 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_37__;

/***/ }),
/* 38 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_38__;

/***/ })
/******/ ]);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCA3MWIxMWFhMDdlODJhMWQ0ZGQ2YSIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMvaGVscGVycy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdmlzdWFsaXphdGlvbk1hbmFnZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Zpc3VhbGl6ZXJCYXNlLnRzIiwid2VicGFjazovLy8uL3NyYy9sb2NhbGl6YXRpb25NYW5hZ2VyLnRzIiwid2VicGFjazovLy8uL3NyYy91dGlscy9pbmRleC50cyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwge1wicm9vdFwiOlwiU3VydmV5XCIsXCJjb21tb25qczJcIjpcInN1cnZleS1jb3JlXCIsXCJjb21tb25qc1wiOlwic3VydmV5LWNvcmVcIixcImFtZFwiOlwic3VydmV5LWNvcmVcIn0iLCJ3ZWJwYWNrOi8vLy4vc3JjL3Bsb3RseS9zZWxlY3RCYXNlLnRzIiwid2VicGFjazovLy8uL3NyYy90YWJsZXMvY29uZmlnLnRzIiwid2VicGFjazovLy8uL3NyYy92aXN1YWxpemF0aW9uUGFuZWwudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Zpc3VhbGl6YXRpb25QYW5lbER5bmFtaWMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dvcmRjbG91ZC9zdG9wd29yZHMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N2Z2J1bmRsZS5odG1sIiwid2VicGFjazovLy8uL3NyYy9zZWxlY3RCYXNlLnRzIiwid2VicGFjazovLy8uL3NyYy90YWJsZXMvdGFibGUudHMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIHtcInJvb3RcIjpcIlBsb3RseVwiLFwiY29tbW9uanMyXCI6XCJwbG90bHkuanMtZGlzdFwiLFwiY29tbW9uanNcIjpcInBsb3RseS5qcy1kaXN0XCIsXCJhbWRcIjpcInBsb3RseS5qcy1kaXN0XCJ9Iiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcGxvdGx5L2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy90YWJsZXMvZGF0YXRhYmxlcy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdGFibGVzL3RhYnVsYXRvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdGV4dC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdmlzdWFsaXphdGlvbk1hdHJpeER5bmFtaWMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dvcmRjbG91ZC93b3JkY2xvdWQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RhYmxlcy9kYXRhdGFibGVzLnNjc3MiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RhYmxlcy90YWJ1bGF0b3Iuc2NzcyIsIndlYnBhY2s6Ly8vLi9zcmMvdGV4dC5zY3NzIiwid2VicGFjazovLy8uL3NyYy92aXN1YWxpemF0aW9uUGFuZWwuc2NzcyIsIndlYnBhY2s6Ly8vLi9zcmMvdmlzdWFsaXplckJhc2Uuc2NzcyIsIndlYnBhY2s6Ly8vLi9+L211dXJpL2Rpc3QvbXV1cmkuanMiLCJ3ZWJwYWNrOi8vLy4vfi90YWJ1bGF0b3ItdGFibGVzL2Rpc3QvanMvdGFidWxhdG9yLmpzIiwid2VicGFjazovLy8uL3NyYy9hbHRlcm5hdGl2ZVZpenVhbGl6ZXJzV3JhcHBlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY29uZmlnLnRzIiwid2VicGFjazovLy8uL3NyYy9sb2NhbGl6YXRpb24vZW5nbGlzaC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvcGxvdGx5L2Jvb2xlYW4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Bsb3RseS9tYXRyaXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Bsb3RseS9yYXRpbmcudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Bsb3RseS9zZWxlY3RCYXNlU29ydGFibGUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dvcmRjbG91ZC9zdG9wd29yZHMvZW5nbGlzaC50cyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwge1wicm9vdFwiOlwiV29yZENsb3VkXCIsXCJjb21tb25qczJcIjpcIndvcmRjbG91ZFwiLFwiY29tbW9uanNcIjpcIndvcmRjbG91ZFwiLFwiYW1kXCI6XCJ3b3JkY2xvdWRcIn0iLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIHtcInJvb3RcIjpcImpRdWVyeVwiLFwiY29tbW9uanMyXCI6XCJqcXVlcnlcIixcImNvbW1vbmpzXCI6XCJqcXVlcnlcIixcImFtZFwiOlwianF1ZXJ5XCJ9Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELE87QUNWQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxtREFBMkMsY0FBYzs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBMkIsMEJBQTBCLEVBQUU7QUFDdkQseUNBQWlDLGVBQWU7QUFDaEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOERBQXNELCtEQUErRDs7QUFFckg7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNoRU8sSUFBSSxRQUFRLEdBQ1gsTUFBTyxDQUFDLFFBQVEsQ0FBQztJQUN2QixVQUFTLE1BQVc7UUFDbEIsS0FBSyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbkQsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQixLQUFLLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ2IsSUFBSSxNQUFNLENBQUMs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O0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsaUNBQWlDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCLGFBQWEscUNBQXFDO0FBQ2xELGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQixhQUFhLHFDQUFxQztBQUNsRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLHFDQUFxQztBQUNsRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxxQ0FBcUM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxxQ0FBcUM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEscUNBQXFDO0FBQ2xEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEscUNBQXFDO0FBQ2xEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCO0FBQ0EsYUFBYSxTQUFTO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQSxhQUFhLFNBQVM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFlBQVk7QUFDM0I7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVB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QU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSztBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSztBQUNsQixhQUFhLGFBQWE7QUFDMUIsYUFBYSxPQUFPO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSztBQUNsQixhQUFhLE9BQU87QUFDcEIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQixlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7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O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUIsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0IseURBQXlEO0FBQ3hGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHlEQUF5RDtBQUNuRjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxNQUFNO0FBQ25CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFVBQVU7QUFDdkIsYUFBYSxVQUFVO0FBQ3ZCLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsWUFBWTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxLQUFLO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCOztBQUV4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSztBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsS0FBSztBQUNsQixhQUFhLEtBQUs7QUFDbEIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsS0FBSztBQUNsQixhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFNBQVM7QUFDdEIsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxFQUFFO0FBQ2YsYUFBYSxFQUFFO0FBQ2YsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsWUFBWTtBQUMzQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLEtBQUs7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxRQUFRO0FBQ3JCLGFBQWEsU0FBUztBQUN0QixlQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLE9BQU87QUFDcEIsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLEtBQUs7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsS0FBSztBQUNsQixhQUFhLG9CQUFvQjtBQUNqQyxhQUFhLFlBQVk7QUFDekIsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQkFBK0Isd0RBQXdEO0FBQ3ZGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHdEQUF3RDtBQUMvRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx3REFBd0Q7QUFDeEY7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxRQUFRO0FBQ3JCO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLEtBQUs7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFlBQVk7QUFDekIsYUFBYSxPQUFPO0FBQ3BCLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxLQUFLO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFFBQVE7QUFDckIsYUFBYSxTQUFTO0FBQ3RCLGVBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLFNBQVM7QUFDdEIsZUFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBCQUEwQjs7QUFFMUI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxRQUFRO0FBQ3JCLGFBQWEsUUFBUTtBQUNyQixhQUFhLFNBQVM7QUFDdEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLEtBQUs7QUFDbEIsYUFBYSxZQUFZO0FBQ3pCLGFBQWEsUUFBUTtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFD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RUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7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QUF5Qjs7O0FBR3pCLG9CQUFvQjs7O0FBR3BCLDJCQUEyQjs7O0FBRzNCLDJCQUEyQjs7O0FBRzNCOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTs7O0FBR0E7OztBQUdBOzs7QUFHQTs7O0FBR0EsTUFBTTs7QUFFTjs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7OztBQUdBLGtEQUFrRCxrQ0FBa0M7OztBQUdwRjs7O0FBR0E7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7O0FBR0E7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsT0FBTzs7QUFFUDs7QUFFQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTtBQUNBLElBQUk7O0FBRUo7OztBQUdBO0FBQ0EsSUFBSTs7QUFFSjs7O0FBR0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxHQUFHOztBQUVIOzs7QUFHQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsd0JBQXdCOztBQUV4Qix1QkFBdUI7O0FBRXZCLHVCQUF1Qjs7QUFFdkIsb0JBQW9COztBQUVwQixrQkFBa0I7O0FBRWxCLHNDQUFzQzs7QUFFdEM7O0FBRUE7O0FBRUEsZ0RBQWdEOztBQUVoRDs7QUFFQSx1QkFBdUI7O0FBRXZCLHFCQUFxQjs7QUFFckIsc0JBQXNCOzs7QUFHdEI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSxvQkFBb0I7OztBQUdwQjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxvQkFBb0I7O0FBRXBCLHdCQUF3Qjs7QUFFeEIsdUJBQXVCOztBQUV2QiwyQkFBMkI7O0FBRTNCLDBCQUEwQjs7O0FBRzFCLHNCQUFzQjs7O0FBR3RCOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTs7QUFFQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTCxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUEsc0RBQXNEO0FBQ3RELEtBQUs7QUFDTCxJQUFJOztBQUVKLDZDQUE2QztBQUM3QztBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUEsbUZBQW1GO0FBQ25GLEtBQUs7QUFDTCxJQUFJOztBQUVKLDBFQUEwRTtBQUMxRTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUJBQWlCLFlBQVk7O0FBRTdCOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsaUJBQWlCLFlBQVk7O0FBRTdCOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTs7QUFFQSxrQkFBa0IsZUFBZTs7QUFFakM7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FB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Q0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE9BQU87O0FBRVA7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE9BQU87O0FBRVA7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxxREFBcUQscUNBQXFDO0FBQzFGOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBLDJEQUEyRDtBQUMzRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLHVEQUF1RCwyRkFBMkY7QUFDbEo7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSx1QkFBdUIsVUFBVTs7QUFFakM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUcsdUJBQXVCO0FBQzFCOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxxREFBcUQsc0JBQXNCO0FBQzNFLElBQUk7O0FBRUoscURBQXFELHNCQUFzQjtBQUMzRSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEscURBQXFELHNCQUFzQjtBQUMzRSxJQUFJOztBQUVKLHFEQUFxRCxzQkFBc0I7QUFDM0UsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsNkJBQTZCLHNCQUFzQjs7QUFFbkQ7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxPQUFPOztBQUVQOztBQUVBOztBQUVBO0FBQ0EsUUFBUTs7QUFFUjtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsOEJBQThCLHNCQUFzQjs7QUFFcEQ7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQSxtQkFBbUI7O0FBRW5COztBQUVBLG9CQUFvQjs7QUFFcEI7O0FBRUEsa0JBQWtCOztBQUVsQix5QkFBeUI7O0FBRXpCLDRCQUE0Qjs7QUFFNUIsdUJBQXVCOztBQUV2QiwyQkFBMkI7O0FBRTNCLGlDQUFpQzs7O0FBR2pDOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTs7QUFFQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTCxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLG1CQUFtQjtBQUNuQjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBLDBCQUEwQix1QkFBdUI7O0FBRWpEOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLDBCQUEwQixRQUFROztBQUVsQztBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBLGdFQUFnRSxxREFBcUQ7QUFDckg7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7O0FBR0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsaUJBQWlCLGVBQWU7O0FBRWhDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQSxnQ0FBZ0M7O0FBRWhDOztBQUVBOztBQUVBOztBQUVBLFFBQVE7O0FBRVI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsT0FBTzs7QUFFUCxPQUFPOztBQUVQOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJLEdBQUcsZ0JBQWdCOztBQUV2Qjs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSzs7QUFFTDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEseURBQXlELGdEQUFnRDtBQUN6Rzs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsc0NBQXNDOztBQUV0Qzs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7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QUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBLGlFQUFpRTs7QUFFakU7O0FBRUE7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQSxzRkFBc0Ysc0JBQXNCO0FBQzVHLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUEsZ0VBQWdFLHNCQUFzQjtBQUN0RixLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsNkNBQTZDOzs7QUFHN0M7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0EsTUFBTTtBQUNOOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQSxzQkFBc0I7O0FBRXRCOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNOztBQUVOOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLEtBQUs7QUFDTCxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxLQUFLO0FBQ0wsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQSxNQUFNO0FBQ04sS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBOztBQUVBOztBQUVBLG1EQUFtRCxzQkFBc0I7QUFDekUsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUEsb0JBQW9CLG9CQUFvQjs7QUFFeEM7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0EsS0FBSztBQUNMLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOzs7QUFHQTs7QUFFQTs7QUFFQSxtREFBbUQ7OztBQUduRCxzQkFBc0I7OztBQUd0QixxQkFBcUI7OztBQUdyQix5QkFBeUI7OztBQUd6Qix3QkFBd0I7OztBQUd4Qix3QkFBd0I7OztBQUd4QiwrQkFBK0I7OztBQUcvQiwyQkFBMkI7OztBQUczQix5QkFBeUI7OztBQUd6QixtQkFBbUI7OztBQUduQjs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7O0FBRUE7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLFFBQVE7O0FBRVI7QUFDQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7O0FBRUE7O0FBRUEsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOzs7QUFHQTs7QUFFQTs7O0FBR0E7O0FBRUE7OztBQUdBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBLHFCQUFxQjs7QUFFckIsMEJBQTBCOztBQUUxQixvQkFBb0I7O0FBRXBCLHFCQUFxQjtBQUNyQjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSw0RUFBNEU7O0FBRTVFOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOzs7QUFHQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FB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QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxnQkFBZ0IsMkJBQTJCO0FBQzNDOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07O0FBRU47O0FBRUE7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLGlCQUFpQjtBQUNoRDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSw4REFBOEQ7QUFDOUQsdUVBQXVFO0FBQ3ZFO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSx3QkFBd0I7O0FBRXhCO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCLG1CQUFtQjtBQUNuQiwyQkFBMkI7QUFDM0IsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHlHQUF5RztBQUN6RztBQUNBOztBQUVBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsK0JBQStCLGFBQWE7QUFDNUM7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSix3Q0FBd0M7QUFDeEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVB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QTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTs7QUFFQTtBQUNBOztBQUVBLHFCQUFxQixxQkFBcUI7QUFDMUM7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTtBQUNBLDhCQUE4QjtBQUM5Qjs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjs7QUFFQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQ7QUFDakQsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRDs7QUFFakQ7QUFDQTtBQUNBO0FBQ0EsUUFBUTs7QUFFUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdDQUF3Qzs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLE9BQU87O0FBRVA7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLHFCQUFxQjs7QUFFckIsdUJBQXVCO0FBQ3ZCLDBCQUEwQjtBQUMxQixnQ0FBZ0M7O0FBRWhDO0FBQ0Esd0NBQXdDOztBQUV4Qyx1QkFBdUI7QUFDdkI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0M7QUFDbEMsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSxvRkFBb0Y7O0FBRXBGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0Es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OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdCQUFnQiwrREFBK0QsRUFBRTtBQUNqRjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixjQUFjO0FBQ2QsY0FBYztBQUNkLGdCQUFnQjtBQUNoQixlQUFlO0FBQ2YsZ0JBQWdCO0FBQ2hCLGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEI7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUVBQWlFO0FBQ2pFOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbUJBQW1CLEVBQUU7O0FBRXJCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKLGtCQUFrQjtBQUNsQjtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLGtCQUFrQixlQUFlO0FBQ2pDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQjs7QUFFaEI7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxpQkFBaUIsV0FBVztBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHdCQUF3QjtBQUN4Qjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSSxHQUFHLGdCQUFnQjs7QUFFdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUksR0FBRyxnQkFBZ0I7O0FBRXZCO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsbUNBQW1DOztBQUVuQzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQSxpQkFBaUIsb0NBQW9DO0FBQ3JEO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEscUJBQXFCOztBQUVyQiw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBLEdBQUcsRUFBRTtBQUNMO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsc0JBQXNCO0FBQ3RCO0FBQ0EsbUJBQW1CO0FBQ25CLHdCQUF3QjtBQUN4Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUcsRUFBRTs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHFFQUFxRTtBQUNyRTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjs7QUFFckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0EscUJBQXFCLHFCQUFxQjtBQUMxQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLGtCQUFrQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCLHdCQUF3QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osV0FBVztBQUNYOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUIsd0JBQXdCO0FBQzdDO0FBQ0EsY0FBYzs7QUFFZDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUNBQXFDO0FBQ3JDLFFBQVE7QUFDUjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxxQ0FBcUM7O0FBRXJDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtB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RUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRyxHQUFHLGdCQUFnQjtBQUN0QjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsd0RBQXdEO0FBQ3hEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscUJBQXFCOztBQUVyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHdCQUF3Qjs7QUFFeEI7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUEsb0JBQW9CLE9BQU87QUFDM0I7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSxzQ0FBc0Msc0JBQXNCO0FBQzVELEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVDQUF1QyxzQkFBc0I7QUFDN0QsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLFVBQVU7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLHNCQUFzQixTQUFTO0FBQy9CO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhGQUE4RjtBQUM5Rjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakUsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLDBDQUEwQyxzQkFBc0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCOztBQUUzQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQSxzRUFBc0U7QUFDdEU7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHVCQUF1QjtBQUN2QixzQkFBc0I7QUFDdEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzREFBc0QsZ0JBQWdCOztBQUV0RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhEQUE4RCxnQkFBZ0I7O0FBRTlFO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLHNCQUFzQjs7QUFFdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxREFBcUQsZ0JBQWdCOztBQUVyRTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw2REFBNkQsZ0JBQWdCOztBQUU3RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsc0JBQXNCOztBQUV0QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4S0FBOEs7QUFDOUs7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwrQkFBK0I7QUFDL0I7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckIseUJBQXlCO0FBQ3pCLDhCQUE4QjtBQUM5Qix1QkFBdUI7QUFDdkIseUJBQXlCO0FBQ3pCLG9DQUFvQztBQUNwQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUEsd0JBQXdCOztBQUV4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVE7QUFDUjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVB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QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QixRQUFRO0FBQy9COztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtB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LEVBQ1IsT0FBTyxFQUNQLE9BQU8sRUFDUCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFFBQVEsRUFDUixPQUFPLEVBQ1AsT0FBTyxFQUNQLFNBQVMsRUFDVCxNQUFNLEVBQ04sVUFBVSxFQUNWLFFBQVEsRUFDUixPQUFPLEVBQ1AsSUFBSSxFQUNKLEtBQUssRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFNBQVMsRUFDVCxRQUFRLEVBQ1IsVUFBVSxFQUNWLFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUNOLE9BQU8sRUFDUCxRQUFRLEVBQ1IsSUFBSSxFQUNKLEtBQUssRUFDTCxPQUFPLEVBQ1AsUUFBUSxFQUNSLE1BQU0sRUFDTixJQUFJLEVBQ0osTUFBTSxFQUNOLEdBQUcsRUFDSCxNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxPQUFPLEVBQ1AsSUFBSSxFQUNKLFFBQVEsRUFDUixTQUFTLEVBQ1QsUUFBUSxFQUNSLFNBQVMsRUFDVCxNQUFNLEVBQ04sUUFBUSxFQUNSLE9BQU8sRUFDUCxRQUFRLEVBQ1IsT0FBTyxFQUNQLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLEtBQUssRUFDTCxJQUFJLEVBQ0osR0FBRyxFQUNILE1BQU0sRUFDTixLQUFLLEVBQ0wsUUFBUSxFQUNSLE1BQU0sRUFDTixPQUFPLEVBQ1AsU0FBUyxFQUNULFdBQVcsRUFDWCxPQUFPLEVBQ1AsU0FBUyxFQUNULE1BQU0sRUFDTixPQUFPLEVBQ1AsR0FBRyxFQUNILEtBQUssRUFDTCxRQUFRLEVBQ1IsV0FBVyxFQUNYLGFBQWEsRUFDYixJQUFJLEVBQ0osTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEVBQ04sTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLFFBQVEsRUFDUixHQUFHLEVBQ0gsTUFBTSxFQUNOLE9BQU8sRUFDUCxRQUFRLEVBQ1IsS0FBSyxFQUNMLE9BQU8sRUFDUCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxFQUNSLE1BQU0sRUFDTixPQUFPLEVBQ1AsV0FBVyxFQUNYLFVBQVUsRUFDVixZQUFZLEVBQ1osWUFBWSxFQUNaLEdBQUcsRUFDSCxNQUFNLEVBQ04sT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQ1AsS0FBSyxFQUNMLE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxFQUNOLE9BQU8sRUFDUCxPQUFPLEVBQ1AsS0FBSyxFQUNMLE1BQU0sRUFDTixNQUFNLEVBQ04sTUFBTSxFQUNOLE9BQU8sRUFDUCxTQUFTLEVBQ1QsV0FBVyxFQUNYLFlBQVksRUFDWixVQUFVLEVBQ1YsR0FBRyxFQUNILE1BQU0sRUFDTixTQUFTLEVBQ1QsV0FBVyxFQUNYLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLE9BQU8sRUFDUCxPQUFPLEVBQ1AsSUFBSSxFQUNKLE9BQU8sRUFDUCxNQUFNLEVBQ04sT0FBTyxFQUNQLEtBQUssRUFDTCxPQUFPLEVBQ1AsU0FBUyxFQUNULFVBQVUsRUFDVixPQUFPLEVBQ1AsU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsR0FBRyxFQUNILEtBQUssRUFDTCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixJQUFJLEVBQ0osS0FBSyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxLQUFLLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxLQUFLLEVBQ0wsU0FBUyxFQUNULEdBQUcsRUFDSCxJQUFJLEVBQ0osV0FBVyxFQUNYLElBQUksRUFDSixVQUFVLEVBQ1YsWUFBWSxFQUNaLGFBQWEsRUFDYixXQUFXLEVBQ1gsTUFBTSxFQUNOLElBQUksRUFDSixJQUFJLEVBQ0osS0FBSyxFQUNMLFFBQVEsRUFDUixHQUFHLEVBQ0gsTUFBTSxFQUNOLEdBQUcsRUFDSCxNQUFNLEVBQ04sT0FBTyxFQUNQLE1BQU0sRUFDTixNQUFNLEVBQ04sTUFBTSxFQUNOLE9BQU8sRUFDUCxPQUFPLEVBQ1AsR0FBRyxFQUNILE9BQU8sRUFDUCxTQUFTLEVBQ1QsTUFBTSxFQUNOLE9BQU8sRUFDUCxRQUFRLEVBQ1IsT0FBTyxFQUNQLE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixRQUFRLEVBQ1IsTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsR0FBRyxFQUNILE1BQU0sRUFDTixNQUFNLEVBQ04sUUFBUSxFQUNSLEtBQUssRUFDTCxNQUFNLEVBQ04sS0FBSyxFQUNMLElBQUksRUFDSixRQUFRLEVBQ1IsU0FBUyxFQUNULEtBQUssRUFDTCxPQUFPLEVBQ1AsTUFBTSxFQUNOLE1BQU0sRUFDTixRQUFRLEVBQ1IsSUFBSSxFQUNKLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLElBQUksRUFDSixRQUFRLEVBQ1IsR0FBRyxFQUNILFdBQVcsRUFDWCxNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxPQUFPLEVBQ1AsT0FBTyxFQUNQLEtBQUssRUFDTCxLQUFLLEVBQ0wsT0FBTyxFQUNQLFFBQVEsRUFDUixNQUFNLEVBQ04sSUFBSSxFQUNKLFFBQVEsRUFDUixLQUFLLEVBQ0wsT0FBTyxFQUNQLEtBQUssRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFNBQVMsRUFDVCxRQUFRLEVBQ1IsU0FBUyxFQUNULEdBQUcsRUFDSCxJQUFJLEVBQ0osS0FBSyxFQUNMLE9BQU8sRUFDUCxLQUFLLEVBQ0wsT0FBTyxFQUNQLFFBQVEsRUFDUixJQUFJLEVBQ0osTUFBTSxFQUNOLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLElBQUksRUFDSixPQUFPLEVBQ1AsU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsT0FBTyxFQUNQLFFBQVEsRUFDUixLQUFLLEVBQ0wsS0FBSyxFQUNMLE1BQU0sRUFDTixHQUFHLEVBQ0gsTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLEtBQUssRUFDTCxTQUFTLEVBQ1QsT0FBTyxFQUNQLFFBQVEsRUFDUixPQUFPLEVBQ1AsU0FBUyxFQUNULFVBQVUsRUFDVixRQUFRLEVBQ1IsVUFBVSxFQUNWLFNBQVMsRUFDVCxXQUFXLEVBQ1gsWUFBWSxFQUNaLFVBQVUsRUFDVixTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxNQUFNLEVBQ04sR0FBRyxFQUNILE9BQU8sRUFDUCxHQUFHLEVBQ0gsUUFBUSxFQUNSLFFBQVEsRUFDUixPQUFPLEVBQ1AsT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQ1AsR0FBRyxFQUNILE1BQU0sRUFDTixNQUFNLEVBQ04sS0FBSyxFQUNMLEtBQUssRUFDTCxNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLE1BQU0sRUFDTixTQUFTLEVBQ1QsT0FBTyxFQUNQLEtBQUssRUFDTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQ1AsT0FBTyxFQUNQLE9BQU8sRUFDUCxTQUFTLEVBQ1QsVUFBVSxFQUNWLElBQUksRUFDSixNQUFNLEVBQ04sVUFBVSxFQUNWLFNBQVMsRUFDVCxXQUFXLEVBQ1gsV0FBVyxFQUNYLE9BQU8sRUFDUCxRQUFRLEVBQ1IsT0FBTyxFQUNQLE9BQU8sRUFDUCxNQUFNLEVBQ04sTUFBTSxFQUNOLEdBQUcsRUFDSCxNQUFNLEVBQ04sT0FBTyxFQUNQLE1BQU0sRUFDTixNQUFNLEVBQ04sS0FBSyxFQUNMLE9BQU8sRUFDUCxNQUFNLEVBQ04sTUFBTSxFQUNOLE9BQU8sRUFDUCxXQUFXLEVBQ1gsT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQ1AsUUFBUSxFQUNSLE9BQU8sRUFDUCxRQUFRLEVBQ1IsTUFBTSxFQUNOLE9BQU8sRUFDUCxRQUFRLEVBQ1IsU0FBUyxFQUNULFVBQVUsRUFDVixPQUFPLEVBQ1AsU0FBUyxFQUNULE1BQU0sRUFDTixJQUFJLEVBQ0osT0FBTyxFQUNQLFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxPQUFPLEVBQ1AsS0FBSyxFQUNMLEdBQUcsRUFDSCxPQUFPLEVBQ1AsT0FBTyxFQUNQLElBQUksRUFDSixNQUFNLEVBQ04sSUFBSSxFQUNKLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLEdBQUcsRUFDSCxNQUFNLEVBQ04sR0FBRyxFQUNILE1BQU0sRUFDTixRQUFRLEVBQ1IsU0FBUyxFQUNULE9BQU8sRUFDUCxLQUFLLEVBQ0wsS0FBSyxFQUNMLE1BQU0sRUFDTixJQUFJLEVBQ0osTUFBTSxFQUNOLE9BQU8sRUFDUCxNQUFNLEVBQ04sTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEVBQ04sT0FBTyxFQUNQLFNBQVMsRUFDVCxPQUFPLEVBQ1AsT0FBTyxFQUNQLEtBQUssRUFDTCxPQUFPLEVBQ1AsT0FBTyxFQUNQLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsTUFBTSxFQUNOLFFBQVEsRUFDUixTQUFTLEVBQ1QsT0FBTyxFQUNQLE9BQU8sRUFDUCxHQUFHLEVBQ0gsR0FBRyxFQUNILE1BQU0sRUFDTixPQUFPLEVBQ1AsS0FBSyxFQUNMLEtBQUssRUFDTCxPQUFPLEVBQ1AsU0FBUyxFQUNULFVBQVUsRUFDVixNQUFNLEVBQ04sT0FBTyxFQUNQLEdBQUcsQ0FDSixDQUFDOzs7Ozs7O0FDOWFGLGdEOzs7Ozs7QUNBQSxnRCIsImZpbGUiOiIuL3BhY2thZ2VzL3N1cnZleS5hbmFseXRpY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJzdXJ2ZXktY29yZVwiKSwgcmVxdWlyZShcInBsb3RseS5qcy1kaXN0XCIpLCByZXF1aXJlKFwid29yZGNsb3VkXCIpLCByZXF1aXJlKFwianF1ZXJ5XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiU3VydmV5QW5hbHl0aWNzXCIsIFtcInN1cnZleS1jb3JlXCIsIFwicGxvdGx5LmpzLWRpc3RcIiwgXCJ3b3JkY2xvdWRcIiwgXCJqcXVlcnlcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiU3VydmV5QW5hbHl0aWNzXCJdID0gZmFjdG9yeShyZXF1aXJlKFwic3VydmV5LWNvcmVcIiksIHJlcXVpcmUoXCJwbG90bHkuanMtZGlzdFwiKSwgcmVxdWlyZShcIndvcmRjbG91ZFwiKSwgcmVxdWlyZShcImpxdWVyeVwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiU3VydmV5QW5hbHl0aWNzXCJdID0gZmFjdG9yeShyb290W1wiU3VydmV5XCJdLCByb290W1wiUGxvdGx5XCJdLCByb290W1wiV29yZENsb3VkXCJdLCByb290W1wialF1ZXJ5XCJdKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNV9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzE0X18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMzdfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8zOF9fKSB7XG5yZXR1cm4gXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBpZGVudGl0eSBmdW5jdGlvbiBmb3IgY2FsbGluZyBoYXJtb255IGltcG9ydHMgd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0XG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmkgPSBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH07XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDE1KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCA3MWIxMWFhMDdlODJhMWQ0ZGQ2YSIsImV4cG9ydCB2YXIgX19hc3NpZ24gPVxuICAoPGFueT5PYmplY3QpW1wiYXNzaWduXCJdIHx8XG4gIGZ1bmN0aW9uKHRhcmdldDogYW55KSB7XG4gICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIgcCBpbiBzKVxuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0YXJnZXRbcF0gPSBzW3BdO1xuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9O1xuXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKHRoaXNDbGFzczogYW55LCBiYXNlQ2xhc3M6IGFueSkge1xuICBmb3IgKHZhciBwIGluIGJhc2VDbGFzcylcbiAgICBpZiAoYmFzZUNsYXNzLmhhc093blByb3BlcnR5KHApKSB0aGlzQ2xhc3NbcF0gPSBiYXNlQ2xhc3NbcF07XG4gIGZ1bmN0aW9uIF9fKCkge1xuICAgIHRoaXMuY29uc3RydWN0b3IgPSB0aGlzQ2xhc3M7XG4gIH1cbiAgdGhpc0NsYXNzLnByb3RvdHlwZSA9XG4gICAgYmFzZUNsYXNzID09PSBudWxsXG4gICAgICA/IE9iamVjdC5jcmVhdGUoYmFzZUNsYXNzKVxuICAgICAgOiAoKF9fLnByb3RvdHlwZSA9IGJhc2VDbGFzcy5wcm90b3R5cGUpLCBuZXcgKDxhbnk+X18pKCkpO1xufVxuXG5leHBvcnQgdmFyIF9fcmVzdCA9IGZ1bmN0aW9uKHNvdXJjZTogYW55LCBlOiBhbnkpIHtcbiAgdmFyIHJlc3VsdDogYW55ID0ge307XG4gIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiBzb3VyY2UpXG4gICAgaWYgKFxuICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwgcHJvcGVydHlOYW1lKSAmJlxuICAgICAgZS5pbmRleE9mKHByb3BlcnR5TmFtZSkgPCAwXG4gICAgKVxuICAgICAgcmVzdWx0W3Byb3BlcnR5TmFtZV0gPSBzb3VyY2VbcHJvcGVydHlOYW1lXTtcbiAgaWYgKFxuICAgIHNvdXJjZSAhPSBudWxsICYmXG4gICAgdHlwZW9mICg8YW55Pk9iamVjdClbXCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHNcIl0gPT09IFwiZnVuY3Rpb25cIlxuICApXG4gICAgZm9yIChcbiAgICAgIHZhciBpID0gMCxcbiAgICAgICAgcHJvcGVydHlTeW1ib2xzID0gKDxhbnk+T2JqZWN0KVtcImdldE93blByb3BlcnR5U3ltYm9sc1wiXShzb3VyY2UpO1xuICAgICAgaSA8IHByb3BlcnR5U3ltYm9scy5sZW5ndGg7XG4gICAgICBpKytcbiAgICApXG4gICAgICBpZiAoZS5pbmRleE9mKHByb3BlcnR5U3ltYm9sc1tpXSkgPCAwKVxuICAgICAgICByZXN1bHRbcHJvcGVydHlTeW1ib2xzW2ldXSA9IHNvdXJjZVtwcm9wZXJ0eVN5bWJvbHNbaV1dO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuZGVjbGFyZSB2YXIgUmVmbGVjdDogYW55O1xuXG5leHBvcnQgdmFyIF9fZGVjb3JhdGUgPSBmdW5jdGlvbihcbiAgZGVjb3JhdG9yczogYW55LFxuICB0YXJnZXQ6IGFueSxcbiAga2V5OiBhbnksXG4gIGRlc2M6IGFueVxuKSB7XG4gIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCxcbiAgICByID1cbiAgICAgIGMgPCAzXG4gICAgICAgID8gdGFyZ2V0XG4gICAgICAgIDogZGVzYyA9PT0gbnVsbFxuICAgICAgICA/IChkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkpXG4gICAgICAgIDogZGVzYyxcbiAgICBkO1xuICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIilcbiAgICByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XG4gIGVsc2VcbiAgICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlcbiAgICAgIGlmICgoZCA9IGRlY29yYXRvcnNbaV0pKVxuICAgICAgICByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcbiAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdXRpbHMvaGVscGVycy50cyIsImltcG9ydCB7IFF1ZXN0aW9uIH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5pbXBvcnQgeyBWaXN1YWxpemVyQmFzZSB9IGZyb20gXCIuL3Zpc3VhbGl6ZXJCYXNlXCI7XG5cbmRlY2xhcmUgdHlwZSBWaXN1YWxpemVyQ29uc3RydWN0b3IgPSBuZXcgKFxuICB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgcXVlc3Rpb246IFF1ZXN0aW9uLFxuICBkYXRhOiBBcnJheTx7IFtpbmRleDogc3RyaW5nXTogYW55IH0+LFxuICBvcHRpb25zPzogT2JqZWN0XG4pID0+IGFueTtcblxuZXhwb3J0IGNsYXNzIFZpc3VhbGl6YXRpb25NYW5hZ2VyIHtcbiAgc3RhdGljIHZpenVhbGl6ZXJzOiB7IFtpbmRleDogc3RyaW5nXTogQXJyYXk8VmlzdWFsaXplckNvbnN0cnVjdG9yPiB9ID0ge307XG4gIHN0YXRpYyByZWdpc3RlclZpc3VhbGl6ZXIoXG4gICAgdHlwZU5hbWU6IHN0cmluZyxcbiAgICBjb25zdHJ1Y3RvcjogVmlzdWFsaXplckNvbnN0cnVjdG9yXG4gICkge1xuICAgIGxldCB2aXp1YWxpemVycyA9IFZpc3VhbGl6YXRpb25NYW5hZ2VyLnZpenVhbGl6ZXJzW3R5cGVOYW1lXTtcbiAgICBpZiAoIXZpenVhbGl6ZXJzKSB7XG4gICAgICB2aXp1YWxpemVycyA9IFtdO1xuICAgICAgVmlzdWFsaXphdGlvbk1hbmFnZXIudml6dWFsaXplcnNbdHlwZU5hbWVdID0gdml6dWFsaXplcnM7XG4gICAgfVxuICAgIHZpenVhbGl6ZXJzLnB1c2goY29uc3RydWN0b3IpO1xuICB9XG4gIHN0YXRpYyBnZXRWaXN1YWxpemVycyh0eXBlTmFtZTogc3RyaW5nKSB7XG4gICAgbGV0IHZpenVhbGl6ZXJzID0gVmlzdWFsaXphdGlvbk1hbmFnZXIudml6dWFsaXplcnNbdHlwZU5hbWVdO1xuICAgIGlmICghdml6dWFsaXplcnMpIHtcbiAgICAgIHJldHVybiBbVmlzdWFsaXplckJhc2VdO1xuICAgIH1cbiAgICByZXR1cm4gdml6dWFsaXplcnM7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy92aXN1YWxpemF0aW9uTWFuYWdlci50cyIsImltcG9ydCB7IFF1ZXN0aW9uIH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5cbmltcG9ydCBcIi4vdmlzdWFsaXplckJhc2Uuc2Nzc1wiO1xuXG5leHBvcnQgY2xhc3MgVmlzdWFsaXplckJhc2Uge1xuXG4gIHB1YmxpYyB0b29sYmFySXRlbUNyZWF0b3JzOiB7IFtuYW1lOiBzdHJpbmddOiAodG9vbGJhcjogSFRNTERpdkVsZW1lbnQpID0+IEhUTUxFbGVtZW50IH0gPSB7fTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgcHVibGljIHF1ZXN0aW9uOiBRdWVzdGlvbixcbiAgICBwcm90ZWN0ZWQgZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PixcbiAgICBwcm90ZWN0ZWQgb3B0aW9ucz86IE9iamVjdFxuICApIHt9XG5cbiAgcHVibGljIHJlZ2lzdGVyVG9vbGJhckl0ZW0obmFtZTogc3RyaW5nLCBjcmVhdG9yOiAodG9vbGJhcjogSFRNTERpdkVsZW1lbnQpID0+IEhUTUxFbGVtZW50KSB7XG4gICAgdGhpcy50b29sYmFySXRlbUNyZWF0b3JzW25hbWVdID0gY3JlYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgbmFtZSgpIHtcbiAgICByZXR1cm4gXCJ2aXN1YWxpemVyXCI7XG4gIH1cblxuICB1cGRhdGUoZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9Pikge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gIH1cblxuICBvblVwZGF0ZTogKCkgPT4gdm9pZDtcblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMudGFyZ2V0RWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xuICB9XG5cbiAgcHJvdGVjdGVkIHJlbmRlckNvbnRlbnQoY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlRoaXMgcXVlc3Rpb24gdHlwZSBpcyBub3QgdmlzdWFsaXplZCB5ZXRcIjtcbiAgfVxuXG4gIHJlbmRlcih0YXJnZXRFbGVtZW50PzogSFRNTEVsZW1lbnQpIHtcbiAgICB0aGlzLnRhcmdldEVsZW1lbnQgPSB0YXJnZXRFbGVtZW50IHx8IHRoaXMudGFyZ2V0RWxlbWVudDtcblxuICAgIGNvbnN0IHRvb2xiYXJOb2RlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250ZW50Q29udGFpbmVyLmNsYXNzTmFtZSA9IFwic2EtdmlzdWFsaXplcl9fY29udGVudFwiO1xuXG4gICAgdGhpcy5jcmVhdGVUb29sYmFyKHRvb2xiYXJOb2RlQ29udGFpbmVyKTtcbiAgICB0aGlzLnJlbmRlckNvbnRlbnQoY29udGVudENvbnRhaW5lcik7XG5cbiAgICB0aGlzLnRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQodG9vbGJhck5vZGVDb250YWluZXIpO1xuICAgIHRoaXMudGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChjb250ZW50Q29udGFpbmVyKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVUb29sYmFySXRlbXModG9vbGJhcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICBPYmplY3Qua2V5cyh0aGlzLnRvb2xiYXJJdGVtQ3JlYXRvcnMgfHwge30pLmZvckVhY2godG9vbGJhckl0ZW1OYW1lID0+IHRoaXMudG9vbGJhckl0ZW1DcmVhdG9yc1t0b29sYmFySXRlbU5hbWVdKHRvb2xiYXIpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVUb29sYmFyKGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICBjb25zdCB0b29sYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0b29sYmFyLmNsYXNzTmFtZSA9IFwic3ZhLXRvb2xiYXJcIjtcbiAgICB0aGlzLmNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sYmFyKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbGJhcik7XG4gIH1cblxuICBpbnZva2VPblVwZGF0ZSgpIHtcbiAgICB0aGlzLm9uVXBkYXRlICYmIHRoaXMub25VcGRhdGUoKTtcbiAgfVxuXG4gIGdldFJhbmRvbUNvbG9yKCkge1xuICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Q29sb3JzKCk7XG4gICAgcmV0dXJuIGNvbG9yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjb2xvcnMubGVuZ3RoKV07XG4gIH1cblxuICBiYWNrZ3JvdW5kQ29sb3IgPSBcIiNmN2Y3ZjdcIjtcblxuICBzdGF0aWMgY3VzdG9tQ29sb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBwcml2YXRlIHN0YXRpYyBjb2xvcnMgPSBbXG4gICAgXCIjODZlMWZiXCIsXG4gICAgXCIjMzk5OWZiXCIsXG4gICAgXCIjZmY2NzcxXCIsXG4gICAgXCIjMWViNDk2XCIsXG4gICAgXCIjZmZjMTUyXCIsXG4gICAgXCIjYWJhMWZmXCIsXG4gICAgXCIjN2Q4ZGE1XCIsXG4gICAgXCIjNGVjNDZjXCIsXG4gICAgXCIjY2YzN2E2XCIsXG4gICAgXCIjNGU2MTk4XCJcbiAgXTtcblxuICBnZXRDb2xvcnMoY291bnQgPSAxMCkge1xuICAgIGNvbnN0IGNvbG9ycyA9XG4gICAgICBBcnJheS5pc0FycmF5KFZpc3VhbGl6ZXJCYXNlLmN1c3RvbUNvbG9ycykgJiZcbiAgICAgIFZpc3VhbGl6ZXJCYXNlLmN1c3RvbUNvbG9ycy5sZW5ndGggPiAwXG4gICAgICAgID8gVmlzdWFsaXplckJhc2UuY3VzdG9tQ29sb3JzXG4gICAgICAgIDogVmlzdWFsaXplckJhc2UuY29sb3JzO1xuXG4gICAgbGV0IG1hbnlDb2xvcnM6IGFueSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNvdW50OyBpbmRleCsrKSB7XG4gICAgICBtYW55Q29sb3JzID0gbWFueUNvbG9ycy5jb25jYXQoY29sb3JzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWFueUNvbG9ycztcbiAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3Zpc3VhbGl6ZXJCYXNlLnRzIiwiaW1wb3J0IHsgZW5nbGlzaFN0cmluZ3MgfSBmcm9tIFwiLi9sb2NhbGl6YXRpb24vZW5nbGlzaFwiO1xuXG5leHBvcnQgdmFyIGxvY2FsaXphdGlvbiA9IHtcbiAgY3VycmVudExvY2FsZVZhbHVlOiBcIlwiLFxuICBkZWZhdWx0TG9jYWxlVmFsdWU6IFwiZW5cIixcbiAgbG9jYWxlczogPHtbaW5kZXg6IHN0cmluZ106IGFueX0+e30sXG4gIGxvY2FsZU5hbWVzOiA8e1tpbmRleDogc3RyaW5nXTogYW55fT57fSxcbiAgc3VwcG9ydGVkTG9jYWxlczogPEFycmF5PGFueT4+W10sXG4gIGdldCBjdXJyZW50TG9jYWxlKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRMb2NhbGVWYWx1ZSA9PT0gdGhpcy5kZWZhdWx0TG9jYWxlVmFsdWVcbiAgICAgID8gXCJcIlxuICAgICAgOiB0aGlzLmN1cnJlbnRMb2NhbGVWYWx1ZTtcbiAgfSxcbiAgc2V0IGN1cnJlbnRMb2NhbGUodmFsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmN1cnJlbnRMb2NhbGVWYWx1ZSA9IHZhbDtcbiAgfSxcbiAgZ2V0IGRlZmF1bHRMb2NhbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGVmYXVsdExvY2FsZVZhbHVlO1xuICB9LFxuICBzZXQgZGVmYXVsdExvY2FsZSh2YWw6IHN0cmluZykge1xuICAgIHRoaXMuZGVmYXVsdExvY2FsZVZhbHVlID0gdmFsO1xuICB9LFxuICBnZXRTdHJpbmc6IGZ1bmN0aW9uKHN0ck5hbWU6IHN0cmluZykge1xuICAgIHZhciBsb2MgPSB0aGlzLmN1cnJlbnRMb2NhbGVcbiAgICAgID8gdGhpcy5sb2NhbGVzW3RoaXMuY3VycmVudExvY2FsZV1cbiAgICAgIDogdGhpcy5sb2NhbGVzW3RoaXMuZGVmYXVsdExvY2FsZV07XG4gICAgaWYgKCFsb2MgfHwgIWxvY1tzdHJOYW1lXSkgbG9jID0gdGhpcy5sb2NhbGVzW3RoaXMuZGVmYXVsdExvY2FsZV07XG4gICAgdmFyIHJlc3VsdCA9IGxvY1tzdHJOYW1lXTtcbiAgICBpZihyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVzdWx0ID0gdGhpcy5sb2NhbGVzW1wiZW5cIl1bc3RyTmFtZV0gfHwgc3RyTmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSxcbiAgZ2V0TG9jYWxlczogZnVuY3Rpb24oKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgdmFyIHJlcyA9IFtdO1xuICAgIHJlcy5wdXNoKFwiXCIpO1xuICAgIGlmICh0aGlzLnN1cHBvcnRlZExvY2FsZXMgJiYgdGhpcy5zdXBwb3J0ZWRMb2NhbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdXBwb3J0ZWRMb2NhbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJlcy5wdXNoKHRoaXMuc3VwcG9ydGVkTG9jYWxlc1tpXSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmxvY2FsZXMpIHtcbiAgICAgICAgcmVzLnB1c2goa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzLnNvcnQoKTtcbiAgICByZXR1cm4gcmVzO1xuICB9XG59O1xuXG5leHBvcnQgdmFyIHN1cnZleVN0cmluZ3MgPSBlbmdsaXNoU3RyaW5ncztcbig8YW55PmxvY2FsaXphdGlvbikubG9jYWxlc1tcImVuXCJdID0gZW5nbGlzaFN0cmluZ3M7XG4oPGFueT5sb2NhbGl6YXRpb24pLmxvY2FsZU5hbWVzW1wiZW5cIl0gPSBcImVuZ2xpc2hcIjtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9sb2NhbGl6YXRpb25NYW5hZ2VyLnRzIiwiZXhwb3J0IGNsYXNzIFRvb2xiYXJIZWxwZXIge1xyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVTZWxlY3Rvcih0b29sYmFyOiBIVE1MRGl2RWxlbWVudCwgb3B0aW9uczogQXJyYXk8e3ZhbHVlOiBzdHJpbmcsIHRleHQ6IHN0cmluZ30+LCBpc1NlbGVjdGVkOiAob3B0aW9uOiB7dmFsdWU6IHN0cmluZywgdGV4dDogc3RyaW5nfSkgPT4gYm9vbGVhbiwgaGFuZGVyOiAoZTogYW55KSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0V3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgc2VsZWN0V3JhcHBlci5jbGFzc05hbWUgPSBcInN2YS1xdWVzdGlvbl9fc2VsZWN0LXdyYXBwZXJcIjtcclxuICAgICAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xyXG4gICAgICAgIHNlbGVjdC5jbGFzc05hbWUgPSBcInN2YS1xdWVzdGlvbl9fc2VsZWN0XCI7XHJcbiAgICAgICAgb3B0aW9ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XHJcbiAgICAgICAgICAgIGxldCBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgb3B0aW9uRWxlbWVudC52YWx1ZSA9IG9wdGlvbi52YWx1ZTtcclxuICAgICAgICAgICAgb3B0aW9uRWxlbWVudC50ZXh0ID0gb3B0aW9uLnRleHQ7XHJcbiAgICAgICAgICAgIG9wdGlvbkVsZW1lbnQuc2VsZWN0ZWQgPSBpc1NlbGVjdGVkKG9wdGlvbik7XHJcbiAgICAgICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb25FbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzZWxlY3Qub25jaGFuZ2UgPSBoYW5kZXI7XHJcbiAgICAgICAgc2VsZWN0V3JhcHBlci5hcHBlbmRDaGlsZChzZWxlY3QpO1xyXG4gICAgICAgIHJldHVybiBzZWxlY3RXcmFwcGVyO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVCdXR0b24odG9vbGJhcjogSFRNTERpdkVsZW1lbnQsIGhhbmRlcjogKGU6IGFueSkgPT4gdm9pZCwgdGV4dCA9IFwiXCIsIGNzc0NsYXNzID0gXCJcIikge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInN2YS10b29sYmFyX19idXR0b24gXCIgKyBjc3NDbGFzcztcclxuICAgICAgICBidXR0b24uaW5uZXJUZXh0ID0gdGV4dDtcclxuICAgICAgICBidXR0b24ub25jbGljayA9IGhhbmRlcjtcclxuICAgICAgICB0b29sYmFyLmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcclxuICAgIH1cclxufVxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdXRpbHMvaW5kZXgudHMiLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNV9fO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIHtcInJvb3RcIjpcIlN1cnZleVwiLFwiY29tbW9uanMyXCI6XCJzdXJ2ZXktY29yZVwiLFwiY29tbW9uanNcIjpcInN1cnZleS1jb3JlXCIsXCJhbWRcIjpcInN1cnZleS1jb3JlXCJ9XG4vLyBtb2R1bGUgaWQgPSA1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImltcG9ydCB7IFF1ZXN0aW9uIH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5pbXBvcnQgeyBJdGVtVmFsdWUgfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcbmltcG9ydCB7IFZpc3VhbGl6YXRpb25NYW5hZ2VyIH0gZnJvbSBcIi4uL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XG5pbXBvcnQgeyBTZWxlY3RCYXNlIH0gZnJvbSBcIi4uL3NlbGVjdEJhc2VcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbkxvYWRQbG90bHkoKSB7XG4gIHJldHVybiAhIXdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMO1xufVxuXG52YXIgUGxvdGx5OiBhbnk7XG5pZiAoY2FuTG9hZFBsb3RseSgpKSB7XG4gIFBsb3RseSA9IDxhbnk+cmVxdWlyZShcInBsb3RseS5qcy1kaXN0XCIpO1xufVxuXG5leHBvcnQgY2xhc3MgU2VsZWN0QmFzZVBsb3RseSBleHRlbmRzIFNlbGVjdEJhc2Uge1xuICBzdGF0aWMgZGlzcGxheU1vZGVCYXI6IGFueSA9IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgcXVlc3Rpb246IFF1ZXN0aW9uLFxuICAgIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4sXG4gICAgb3B0aW9ucz86IE9iamVjdFxuICApIHtcbiAgICBzdXBlcih0YXJnZXRFbGVtZW50LCBxdWVzdGlvbiwgZGF0YSwgb3B0aW9ucyk7XG4gICAgdGhpcy5jaGFydFR5cGVzID0gU2VsZWN0QmFzZVBsb3RseS50eXBlcztcbiAgICB0aGlzLmNoYXJ0VHlwZSA9IHRoaXMuY2hhcnRUeXBlc1swXTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhcnQ6IFByb21pc2U8UGxvdGx5LlBsb3RseUhUTUxFbGVtZW50PjtcbiAgcHJpdmF0ZSBmaWx0ZXJUZXh0OiBIVE1MU3BhbkVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gIHByaXZhdGUgZmlsdGVyOiBIVE1MRGl2RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgcHVibGljIHN0YXRpYyB0eXBlcyA9IFtcImJhclwiLCBcInBpZVwiLCBcImRvdWdobnV0XCIsIFwic2NhdHRlclwiXTtcblxuICB1cGRhdGUoZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9Pikge1xuICAgIHN1cGVyLnVwZGF0ZShkYXRhKTtcbiAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB0aGlzLmNoYXJ0ID0gdGhpcy5nZXRQbG90bHlDaGFydCh0aGlzLmNoYXJ0Tm9kZSwgdGhpcy5jaGFydFR5cGUpO1xuICAgIHRoaXMuaW52b2tlT25VcGRhdGUoKTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgUGxvdGx5LnB1cmdlKHRoaXMuY2hhcnROb2RlKTtcbiAgfVxuXG4gIGNyZWF0ZUNoYXJ0KCkge1xuICAgIHRoaXMuY2hhcnQgPSB0aGlzLmdldFBsb3RseUNoYXJ0KHRoaXMuY2hhcnROb2RlLCB0aGlzLmNoYXJ0VHlwZSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VsZWN0ZWRJdGVtQnlUZXh0KGl0ZW1UZXh0OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5xdWVzdGlvbi5jaG9pY2VzLmZpbHRlcihcbiAgICAgIChjaG9pY2U6IEl0ZW1WYWx1ZSkgPT4gY2hvaWNlLnRleHQgPT09IGl0ZW1UZXh0XG4gICAgKVswXTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwYXRjaENvbmZpZ1BhcmFtZXRlcnMoXG4gICAgY2hhcnROb2RlOiBvYmplY3QsXG4gICAgdHJhY2VzOiBBcnJheTxvYmplY3Q+LFxuICAgIGxheW91dDogb2JqZWN0LFxuICAgIGNvbmZpZzogb2JqZWN0XG4gICkge31cblxuICBwcml2YXRlIGdldFBsb3RseUNoYXJ0KFxuICAgIGNoYXJ0Tm9kZTogSFRNTEVsZW1lbnQsXG4gICAgY2hhcnRUeXBlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnQ+IHtcbiAgICBjb25zdCBxdWVzdGlvbiA9IHRoaXMucXVlc3Rpb247XG4gICAgbGV0IGRhdGFzZXRzID0gdGhpcy5nZXREYXRhKCk7XG4gICAgbGV0IGxhYmVscyA9IHRoaXMuZ2V0TGFiZWxzKCk7XG4gICAgbGV0IGNvbG9ycyA9IHRoaXMuZ2V0Q29sb3JzKCk7XG4gICAgY29uc3QgdHJhY2VzOiBhbnkgPSBbXTtcblxuICAgIGlmICh0aGlzLm9yZGVyQnlBbnN3ZXJlcyA9PSBcImFzY1wiIHx8IHRoaXMub3JkZXJCeUFuc3dlcmVzID09IFwiZGVzY1wiKSB7XG4gICAgICBsZXQgZGljdCA9IHRoaXMuc29ydERpY3Rpb25hcnkoXG4gICAgICAgIHRoaXMuemlwQXJyYXlzKGxhYmVscywgY29sb3JzKSxcbiAgICAgICAgZGF0YXNldHNbMF0sXG4gICAgICAgIHRoaXMub3JkZXJCeUFuc3dlcmVzID09IFwiZGVzY1wiXG4gICAgICApO1xuICAgICAgbGV0IGxhYmVsc0FuZENvbG9ycyA9IHRoaXMudW56aXBBcnJheXMoZGljdC5rZXlzKTtcbiAgICAgIGxhYmVscyA9IGxhYmVsc0FuZENvbG9ycy5maXJzdDtcbiAgICAgIGNvbG9ycyA9IGxhYmVsc0FuZENvbG9ycy5zZWNvbmQ7XG4gICAgICBkYXRhc2V0c1swXSA9IGRpY3QudmFsdWVzO1xuICAgIH1cbiAgICBjb25zdCB0cmFjZUNvbmZpZzogYW55ID0ge1xuICAgICAgdHlwZTogY2hhcnRUeXBlLFxuICAgICAgeTogbGFiZWxzLm1hcChsID0+IHtcbiAgICAgICAgaWYgKGwubGVuZ3RoID4gMzApIHtcbiAgICAgICAgICByZXR1cm4gbC5zdWJzdHJpbmcoMCwgMjcpICsgXCIuLi5cIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbDtcbiAgICAgIH0pLFxuICAgICAgdGV4dDogbGFiZWxzLFxuICAgICAgaG92ZXJpbmZvOiBcIngreVwiLFxuICAgICAgb3JpZW50YXRpb246IFwiaFwiLFxuICAgICAgbW9kZTogXCJtYXJrZXJzXCIsXG4gICAgICB3aWR0aDogMC41LFxuICAgICAgbWFya2VyOiA8YW55Pnt9XG4gICAgfTtcblxuICAgIGlmICh0aGlzLmNoYXJ0VHlwZSA9PT0gXCJwaWVcIiB8fCB0aGlzLmNoYXJ0VHlwZSA9PT0gXCJkb3VnaG51dFwiKSB7XG4gICAgICB0cmFjZUNvbmZpZy5ob3ZlcmluZm8gPSBcInRleHQrdmFsdWUrcGVyY2VudFwiO1xuICAgICAgdHJhY2VDb25maWcubWFya2VyLmNvbG9ycyA9IGNvbG9ycztcbiAgICAgIHRyYWNlQ29uZmlnLnRleHRwb3NpdGlvbiA9IFwiaW5zaWRlXCI7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNoYXJ0VHlwZSA9PT0gXCJiYXJcIikge1xuICAgICAgdHJhY2VDb25maWcubWFya2VyLmNvbG9yID0gY29sb3JzO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNoYXJ0VHlwZSA9PT0gXCJkb3VnaG51dFwiKSB7XG4gICAgICB0cmFjZUNvbmZpZy50eXBlID0gXCJwaWVcIjtcbiAgICAgIHRyYWNlQ29uZmlnLmhvbGUgPSAwLjQ7XG4gICAgfVxuXG4gICAgaWYgKGRhdGFzZXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdHJhY2VDb25maWcubWFya2VyLnN5bWJvbCA9IFwiY2lyY2xlXCI7XG4gICAgICB0cmFjZUNvbmZpZy5tYXJrZXIuc2l6ZSA9IDE2O1xuICAgIH1cblxuICAgIGRhdGFzZXRzLmZvckVhY2goZGF0YXNldCA9PiB7XG4gICAgICBpZiAodGhpcy5jaGFydFR5cGUgPT09IFwicGllXCIgfHwgdGhpcy5jaGFydFR5cGUgPT09IFwiZG91Z2hudXRcIikge1xuICAgICAgICB0cmFjZXMucHVzaChcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0cmFjZUNvbmZpZywge1xuICAgICAgICAgICAgdmFsdWVzOiBkYXRhc2V0LFxuICAgICAgICAgICAgbGFiZWxzOiBsYWJlbHNcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJhY2VzLnB1c2goT2JqZWN0LmFzc2lnbih7fSwgdHJhY2VDb25maWcsIHsgeDogZGF0YXNldCB9KSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBoZWlnaHQgPVxuICAgICAgY2hhcnRUeXBlID09PSBcInBpZVwiIHx8IHRoaXMuY2hhcnRUeXBlID09PSBcImRvdWdobnV0XCJcbiAgICAgICAgPyBsYWJlbHMubGVuZ3RoIDwgMTBcbiAgICAgICAgICA/IGxhYmVscy5sZW5ndGggKiA1MCArIDEwMFxuICAgICAgICAgIDogNTUwXG4gICAgICAgIDogKGxhYmVscy5sZW5ndGggKyAobGFiZWxzLmxlbmd0aCArIDEpICogMC41KSAqIDIwO1xuXG4gICAgY29uc3QgbGF5b3V0OiBhbnkgPSB7XG4gICAgICBmb250OiB7XG4gICAgICAgIGZhbWlseTogXCJTZWdvZSBVSSwgc2Fucy1zZXJpZlwiLFxuICAgICAgICBzaXplOiAxNCxcbiAgICAgICAgd2VpZ2h0OiBcIm5vcm1hbFwiLFxuICAgICAgICBjb2xvcjogXCIjNDA0MDQwXCJcbiAgICAgIH0sXG4gICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgIG1hcmdpbjoge1xuICAgICAgICB0OiAwLFxuICAgICAgICBiOiAwLFxuICAgICAgICByOiAxMFxuICAgICAgfSxcbiAgICAgIGNvbG9yd2F5OiBjb2xvcnMsXG4gICAgICBob3Zlcm1vZGU6IFwiY2xvc2VzdFwiLFxuICAgICAgeWF4aXM6IHtcbiAgICAgICAgYXV0b21hcmdpbjogdHJ1ZSxcbiAgICAgICAgdHlwZTogXCJjYXRlZ29yeVwiLFxuICAgICAgICB0aWNrbGVuOiA1LFxuICAgICAgICB0aWNrY29sb3I6IFwidHJhbnNwYXJlbnRcIlxuICAgICAgfSxcbiAgICAgIHhheGlzOiB7XG4gICAgICAgIHJhbmdlbW9kZTogXCJub25uZWdhdGl2ZVwiLFxuICAgICAgICBhdXRvbWFyZ2luOiB0cnVlXG4gICAgICB9LFxuICAgICAgcGxvdF9iZ2NvbG9yOiB0aGlzLmJhY2tncm91bmRDb2xvcixcbiAgICAgIHBhcGVyX2JnY29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yLFxuICAgICAgc2hvd2xlZ2VuZDogZmFsc2VcbiAgICB9O1xuXG4gICAgbGV0IGNvbmZpZzogYW55ID0ge1xuICAgICAgZGlzcGxheWxvZ286IGZhbHNlLFxuICAgICAgcmVzcG9uc2l2ZTogdHJ1ZVxuICAgIH07XG4gICAgaWYoU2VsZWN0QmFzZVBsb3RseS5kaXNwbGF5TW9kZUJhciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25maWcuZGlzcGxheU1vZGVCYXIgPSBTZWxlY3RCYXNlUGxvdGx5LmRpc3BsYXlNb2RlQmFyO1xuICAgIH1cblxuICAgIHRoaXMucGF0Y2hDb25maWdQYXJhbWV0ZXJzKGNoYXJ0Tm9kZSwgdHJhY2VzLCBsYXlvdXQsIGNvbmZpZyk7XG5cbiAgICBjb25zdCBwbG90ID0gUGxvdGx5Lm5ld1Bsb3QoY2hhcnROb2RlLCB0cmFjZXMsIGxheW91dCwgY29uZmlnKTtcblxuICAgICg8YW55PmNoYXJ0Tm9kZSlbXCJvblwiXShcInBsb3RseV9jbGlja1wiLCAoZGF0YTogYW55KSA9PiB7XG4gICAgICBpZiAoZGF0YS5wb2ludHMubGVuZ3RoID4gMCAmJiB0aGlzLm9uRGF0YUl0ZW1TZWxlY3RlZCkge1xuICAgICAgICBjb25zdCBpdGVtVGV4dCA9IGRhdGEucG9pbnRzWzBdLnRleHQ7XG4gICAgICAgIGNvbnN0IGl0ZW06IEl0ZW1WYWx1ZSA9IHRoaXMuZ2V0U2VsZWN0ZWRJdGVtQnlUZXh0KGl0ZW1UZXh0KTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24oaXRlbSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZ2V0RHJhZ0xheWVyID0gKCkgPT5cbiAgICAgIDxIVE1MRWxlbWVudD5jaGFydE5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm5zZXdkcmFnXCIpWzBdO1xuICAgICg8YW55PmNoYXJ0Tm9kZSlbXCJvblwiXShcInBsb3RseV9ob3ZlclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBkcmFnTGF5ZXIgPSBnZXREcmFnTGF5ZXIoKTtcbiAgICAgIGRyYWdMYXllciAmJiAoZHJhZ0xheWVyLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiKTtcbiAgICB9KTtcbiAgICAoPGFueT5jaGFydE5vZGUpW1wib25cIl0oXCJwbG90bHlfdW5ob3ZlclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBkcmFnTGF5ZXIgPSBnZXREcmFnTGF5ZXIoKTtcbiAgICAgIGRyYWdMYXllciAmJiAoZHJhZ0xheWVyLnN0eWxlLmN1cnNvciA9IFwiXCIpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHBsb3Q7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9wbG90bHkvc2VsZWN0QmFzZS50cyIsImV4cG9ydCBlbnVtIENvbHVtblZpc2liaWxpdHkge1xuICBWaXNpYmxlLFxuICBJbnZpc2libGUsXG4gIFB1YmxpY0ludmlzaWJsZSxcbn1cbmV4cG9ydCBlbnVtIFF1ZXN0aW9uTG9jYXRpb24ge1xuICBDb2x1bW4sXG4gIFJvdyxcbn1cbmV4cG9ydCBlbnVtIENvbHVtbkRhdGFUeXBlIHtcbiAgVGV4dCxcbiAgRmlsZUxpbmssXG4gIEltYWdlLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElUYWJsZUNvbHVtbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgZGlzcGxheU5hbWU6IHN0cmluZztcbiAgZGF0YVR5cGU6IENvbHVtbkRhdGFUeXBlO1xuICB2aXNpYmlsaXR5OiBDb2x1bW5WaXNpYmlsaXR5O1xuICBsb2NhdGlvbjogUXVlc3Rpb25Mb2NhdGlvbjtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy90YWJsZXMvY29uZmlnLnRzIiwiaW1wb3J0IHsgVmlzdWFsaXphdGlvbk1hbmFnZXIgfSBmcm9tIFwiLi92aXN1YWxpemF0aW9uTWFuYWdlclwiO1xuaW1wb3J0IHsgVmlzdWFsaXplckJhc2UgfSBmcm9tIFwiLi92aXN1YWxpemVyQmFzZVwiO1xuaW1wb3J0IHsgQWx0ZXJuYXRpdmVWaXN1YWxpemVyc1dyYXBwZXIgfSBmcm9tIFwiLi9hbHRlcm5hdGl2ZVZpenVhbGl6ZXJzV3JhcHBlclwiO1xuaW1wb3J0IHsgUXVlc3Rpb24sIFF1ZXN0aW9uUGFuZWxEeW5hbWljTW9kZWwsIEV2ZW50IH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5jb25zdCBNdXVyaSA9IHJlcXVpcmUoXCJtdXVyaVwiKTtcbmltcG9ydCBcIi4vdmlzdWFsaXphdGlvblBhbmVsLnNjc3NcIjtcbmltcG9ydCB7IFNlbGVjdEJhc2UgfSBmcm9tIFwiLi9zZWxlY3RCYXNlXCI7XG5pbXBvcnQgeyBUb29sYmFySGVscGVyIH0gZnJvbSBcIi4vdXRpbHMvaW5kZXhcIjtcbmltcG9ydCB7IGxvY2FsaXphdGlvbiB9IGZyb20gXCIuL2xvY2FsaXphdGlvbk1hbmFnZXJcIjtcbmltcG9ydCB7IElWaXN1YWxpemVyUGFuZWxFbGVtZW50LCBFbGVtZW50VmlzaWJpbGl0eSB9IGZyb20gXCIuL2NvbmZpZ1wiO1xuXG5jb25zdCBxdWVzdGlvbkVsZW1lbnRDbGFzc05hbWUgPSBcInN2YS1xdWVzdGlvblwiO1xuY29uc3QgcXVlc3Rpb25MYXlvdXRlZEVsZW1lbnRDbGFzc05hbWUgPSBcInN2YS1xdWVzdGlvbi1sYXlvdXRlZFwiO1xuXG4vKipcbiAqIFZpc3VhbGl6YXRpb25QYW5lbCBpcyByZXNwb25zaWJsZSBmb3IgZGlzcGxheWluZyBhbiBhcnJheSBvZiBzdXJ2ZXkgcXVlc3Rpb25zXG4gKi9cbmV4cG9ydCBjbGFzcyBWaXN1YWxpemF0aW9uUGFuZWwge1xuICBwcml2YXRlIF9zaG93SGVhZGVyID0gZmFsc2U7XG4gIHByaXZhdGUgcGFuZWxDb250ZW50OiBIVE1MRGl2RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgcHJvdGVjdGVkIGZpbHRlcmVkRGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PjtcbiAgcHJvdGVjdGVkIGZpbHRlclZhbHVlczogeyBbaW5kZXg6IHN0cmluZ106IGFueSB9ID0ge307XG4gIHByb3RlY3RlZCB2aXN1YWxpemVyczogQXJyYXk8VmlzdWFsaXplckJhc2U+ID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuICAgIHByb3RlY3RlZCBxdWVzdGlvbnM6IEFycmF5PGFueT4sXG4gICAgcHJvdGVjdGVkIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4sXG4gICAgcHJvdGVjdGVkIG9wdGlvbnM6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSA9IHt9LFxuICAgIHByaXZhdGUgX2VsZW1lbnRzOiBBcnJheTxJVmlzdWFsaXplclBhbmVsRWxlbWVudD4gPSBbXSxcbiAgICBwcml2YXRlIGlzVHJ1c3RlZEFjY2VzcyA9IGZhbHNlXG4gICkge1xuICAgIHRoaXMuZmlsdGVyZWREYXRhID0gZGF0YTtcbiAgICBpZiAoX2VsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5fZWxlbWVudHMgPSB0aGlzLmJ1aWxkRWxlbWVudHMocXVlc3Rpb25zKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IGFsbG93RHluYW1pY0xheW91dCgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5vcHRpb25zLmFsbG93RHluYW1pY0xheW91dCA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICB0aGlzLm9wdGlvbnMuYWxsb3dEeW5hbWljTGF5b3V0ID09PSB0cnVlXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TGF5b3V0RW5naW5lOiAoKSA9PiBhbnk7XG4gIHB1YmxpYyBnZXQgbGF5b3V0RW5naW5lKCkge1xuICAgIHJldHVybiAhIXRoaXMuZ2V0TGF5b3V0RW5naW5lICYmIHRoaXMuZ2V0TGF5b3V0RW5naW5lKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYnVpbGRFbGVtZW50cyhxdWVzdGlvbnM6IGFueVtdKTogSVZpc3VhbGl6ZXJQYW5lbEVsZW1lbnRbXSB7XG4gICAgcmV0dXJuIChxdWVzdGlvbnMgfHwgW10pLm1hcCgocXVlc3Rpb24pID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IHF1ZXN0aW9uLm5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBxdWVzdGlvbi50aXRsZSxcbiAgICAgICAgdmlzaWJpbGl0eTogRWxlbWVudFZpc2liaWxpdHkuVmlzaWJsZSxcbiAgICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRFbGVtZW50cygpOiBJVmlzdWFsaXplclBhbmVsRWxlbWVudFtdIHtcbiAgICByZXR1cm4gKHRoaXMuX2VsZW1lbnRzIHx8IFtdKS5tYXAoZWxlbWVudCA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBlbGVtZW50Lm5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBlbGVtZW50LmRpc3BsYXlOYW1lLFxuICAgICAgICB2aXNpYmlsaXR5OiBlbGVtZW50LnZpc2liaWxpdHksXG4gICAgICAgIHR5cGU6IGVsZW1lbnQudHlwZSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIHdoZXRoZXIgY2VydGFpbiBlbGVtZW50IGlzIHZpc2libGUuXG4gICAqL1xuICBwdWJsaWMgaXNWaXNpYmxlKHZpc2liaWxpdHk6IEVsZW1lbnRWaXNpYmlsaXR5KSB7XG4gICAgcmV0dXJuIChcbiAgICAgICh0aGlzLmlzVHJ1c3RlZEFjY2VzcyAmJiB2aXNpYmlsaXR5ICE9PSBFbGVtZW50VmlzaWJpbGl0eS5JbnZpc2libGUpIHx8XG4gICAgICAoIXRoaXMuaXNUcnVzdGVkQWNjZXNzICYmIHZpc2liaWxpdHkgPT09IEVsZW1lbnRWaXNpYmlsaXR5LlZpc2libGUpXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXQgdmlzaWJsZUVsZW1lbnRzKCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50cy5maWx0ZXIoKGVsKSA9PiB0aGlzLmlzVmlzaWJsZShlbC52aXNpYmlsaXR5KSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0IGhpZGRlbkVsZW1lbnRzKCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50cy5maWx0ZXIoKGVsKSA9PiAhdGhpcy5pc1Zpc2libGUoZWwudmlzaWJpbGl0eSkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEVsZW1lbnQobmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRzLmZpbHRlcigoZWwpID0+IGVsLm5hbWUgPT09IG5hbWUpWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpcmVzIHdoZW4gZWxlbWVudCB2aXNpYmlsaXR5IGhhcyBiZWVuIGNoYW5nZWQuXG4gICAqL1xuICBwdWJsaWMgb25WaXNpYmxlRWxlbWVudHNDaGFuZ2VkID0gbmV3IEV2ZW50PFxuICAgIChzZW5kZXI6IFZpc3VhbGl6YXRpb25QYW5lbCwgb3B0aW9uczogYW55KSA9PiBhbnksXG4gICAgYW55XG4gID4oKTtcblxuICB2aXNpYmxlRWxlbWVudHNDaGFuZ2VkKGVsZW1lbnQ6IElWaXN1YWxpemVyUGFuZWxFbGVtZW50KSB7XG4gICAgaWYgKCF0aGlzLm9uVmlzaWJsZUVsZW1lbnRzQ2hhbmdlZC5pc0VtcHR5KSB7XG4gICAgICB0aGlzLm9uVmlzaWJsZUVsZW1lbnRzQ2hhbmdlZC5maXJlKHRoaXMsIHtcbiAgICAgICAgZWxlbWVudHM6IHRoaXMuX2VsZW1lbnRzLFxuICAgICAgICBjaGFuZ2VkOiBlbGVtZW50LFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMubGF5b3V0KCk7XG4gIH1cblxuICAvKipcbiAgICogRGVzdHJveXMgZ2l2ZW4gdmlzdWFsaXplci5cbiAgICovXG4gIHB1YmxpYyBkZXN0cm95VmlzdWFsaXplcih2aXN1YWxpemVyOiBWaXN1YWxpemVyQmFzZSkge1xuICAgIGlmICh2aXN1YWxpemVyIGluc3RhbmNlb2YgU2VsZWN0QmFzZSkge1xuICAgICAgdmlzdWFsaXplci5zZXRTZWxlY3Rpb24odW5kZWZpbmVkKTtcbiAgICAgIHZpc3VhbGl6ZXIub25EYXRhSXRlbVNlbGVjdGVkID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB2aXN1YWxpemVyLm9uVXBkYXRlID0gdW5kZWZpbmVkO1xuICAgIHZpc3VhbGl6ZXIuZGVzdHJveSgpO1xuICAgIHRoaXMudmlzdWFsaXplcnMuc3BsaWNlKHRoaXMudmlzdWFsaXplcnMuaW5kZXhPZih2aXN1YWxpemVyKSwgMSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVycyBnaXZlbiBlbGVtZW50LlxuICAgKi9cbiAgcHVibGljIHJlbmRlclZpc3VhbGl6ZXIoZWxlbWVudDogSVZpc3VhbGl6ZXJQYW5lbEVsZW1lbnQpIHtcbiAgICB2YXIgcXVlc3Rpb24gPSB0aGlzLnF1ZXN0aW9ucy5maWx0ZXIoKHEpID0+IHEubmFtZSA9PT0gZWxlbWVudC5uYW1lKVswXTtcbiAgICBjb25zdCBxdWVzdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnN0IHF1ZXN0aW9uQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNvbnN0IHZpenVhbGl6ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIHRpdGxlRWxlbWVudC5pbm5lclRleHQgPSBlbGVtZW50LmRpc3BsYXlOYW1lO1xuXG4gICAgcXVlc3Rpb25FbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuYWxsb3dEeW5hbWljTGF5b3V0XG4gICAgICA/IHF1ZXN0aW9uRWxlbWVudENsYXNzTmFtZSArIFwiIFwiICsgcXVlc3Rpb25MYXlvdXRlZEVsZW1lbnRDbGFzc05hbWVcbiAgICAgIDogcXVlc3Rpb25FbGVtZW50Q2xhc3NOYW1lO1xuICAgIHF1ZXN0aW9uQ29udGVudC5jbGFzc05hbWUgPSBxdWVzdGlvbkVsZW1lbnRDbGFzc05hbWUgKyBcIl9fY29udGVudFwiO1xuICAgIHRpdGxlRWxlbWVudC5jbGFzc05hbWUgPSBxdWVzdGlvbkVsZW1lbnRDbGFzc05hbWUgKyBcIl9fdGl0bGVcIjtcblxuICAgIHF1ZXN0aW9uQ29udGVudC5hcHBlbmRDaGlsZCh0aXRsZUVsZW1lbnQpO1xuICAgIHF1ZXN0aW9uQ29udGVudC5hcHBlbmRDaGlsZCh2aXp1YWxpemVyRWxlbWVudCk7XG4gICAgcXVlc3Rpb25FbGVtZW50LmFwcGVuZENoaWxkKHF1ZXN0aW9uQ29udGVudCk7XG5cbiAgICBjb25zdCB2aXN1YWxpemVyID0gdGhpcy5jcmVhdGVWaXp1YWxpemVyKFxuICAgICAgdml6dWFsaXplckVsZW1lbnQsXG4gICAgICBxdWVzdGlvbixcbiAgICAgIHRoaXMuZmlsdGVyZWREYXRhXG4gICAgKTtcblxuICAgIHZpc3VhbGl6ZXIucmVnaXN0ZXJUb29sYmFySXRlbShcbiAgICAgIFwicmVtb3ZlUXVlc3Rpb25cIixcbiAgICAgICh0b29sYmFyOiBIVE1MRGl2RWxlbWVudCkgPT4ge1xuICAgICAgICByZXR1cm4gVG9vbGJhckhlbHBlci5jcmVhdGVCdXR0b24oXG4gICAgICAgICAgdG9vbGJhcixcbiAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgZWxlbWVudC52aXNpYmlsaXR5ID0gRWxlbWVudFZpc2liaWxpdHkuSW52aXNpYmxlO1xuICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3lWaXN1YWxpemVyKHZpc3VhbGl6ZXIpO1xuICAgICAgICAgICAgICAhIXRoaXMubGF5b3V0RW5naW5lICYmXG4gICAgICAgICAgICAgICAgdGhpcy5sYXlvdXRFbmdpbmUucmVtb3ZlKFtxdWVzdGlvbkVsZW1lbnRdKTtcbiAgICAgICAgICAgICAgdGhpcy5wYW5lbENvbnRlbnQucmVtb3ZlQ2hpbGQocXVlc3Rpb25FbGVtZW50KTtcbiAgICAgICAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNDaGFuZ2VkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiaGlkZUJ1dHRvblwiKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICk7XG5cbiAgICBpZiAodmlzdWFsaXplciBpbnN0YW5jZW9mIFNlbGVjdEJhc2UpIHtcbiAgICAgIHZhciBmaWx0ZXJJbmZvID0ge1xuICAgICAgICB0ZXh0OiA8SFRNTEVsZW1lbnQ+dW5kZWZpbmVkLFxuICAgICAgICBlbGVtZW50OiA8SFRNTERpdkVsZW1lbnQ+dW5kZWZpbmVkLFxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChzZWxlY3Rpb246IGFueSkge1xuICAgICAgICAgIGlmICghIXNlbGVjdGlvbiAmJiAhIXNlbGVjdGlvbi52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgICAgICAgdGhpcy50ZXh0LmlubmVySFRNTCA9IFwiRmlsdGVyOiBbXCIgKyBzZWxlY3Rpb24udGV4dCArIFwiXVwiO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgdGhpcy50ZXh0LmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgdmlzdWFsaXplci5yZWdpc3RlclRvb2xiYXJJdGVtKFxuICAgICAgICBcInF1ZXN0aW9uRmlsdGVySW5mb1wiLFxuICAgICAgICAodG9vbGJhcjogSFRNTERpdkVsZW1lbnQpID0+IHtcbiAgICAgICAgICBmaWx0ZXJJbmZvLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIGZpbHRlckluZm8uZWxlbWVudC5jbGFzc05hbWUgPSBcInN2YS1xdWVzdGlvbl9fZmlsdGVyXCI7XG5cbiAgICAgICAgICBmaWx0ZXJJbmZvLnRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgICBmaWx0ZXJJbmZvLnRleHQuY2xhc3NOYW1lID0gXCJzdmEtcXVlc3Rpb25fX2ZpbHRlci10ZXh0XCI7XG4gICAgICAgICAgZmlsdGVySW5mby5lbGVtZW50LmFwcGVuZENoaWxkKGZpbHRlckluZm8udGV4dCk7XG5cbiAgICAgICAgICBjb25zdCBmaWx0ZXJDbGVhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICAgIGZpbHRlckNsZWFyLmNsYXNzTmFtZSA9IFwic3ZhLXRvb2xiYXJfX2J1dHRvblwiO1xuICAgICAgICAgIGZpbHRlckNsZWFyLmlubmVySFRNTCA9IGxvY2FsaXphdGlvbi5nZXRTdHJpbmcoXCJjbGVhckJ1dHRvblwiKTtcbiAgICAgICAgICBmaWx0ZXJDbGVhci5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgdmlzdWFsaXplci5zZXRTZWxlY3Rpb24odW5kZWZpbmVkKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGZpbHRlckluZm8uZWxlbWVudC5hcHBlbmRDaGlsZChmaWx0ZXJDbGVhcik7XG4gICAgICAgICAgdG9vbGJhci5hcHBlbmRDaGlsZChmaWx0ZXJJbmZvLmVsZW1lbnQpO1xuXG4gICAgICAgICAgZmlsdGVySW5mby51cGRhdGUodmlzdWFsaXplci5zZWxlY3Rpb24pO1xuXG4gICAgICAgICAgcmV0dXJuIGZpbHRlckluZm8uZWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdmlzdWFsaXplci5vbkRhdGFJdGVtU2VsZWN0ZWQgPSAoXG4gICAgICAgIHNlbGVjdGVkVmFsdWU6IGFueSxcbiAgICAgICAgc2VsZWN0ZWRUZXh0OiBzdHJpbmdcbiAgICAgICkgPT4ge1xuICAgICAgICBmaWx0ZXJJbmZvLnVwZGF0ZSh7IHZhbHVlOiBzZWxlY3RlZFZhbHVlLCB0ZXh0OiBzZWxlY3RlZFRleHQgfSk7XG4gICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIocXVlc3Rpb24ubmFtZSwgc2VsZWN0ZWRWYWx1ZSk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIHZpc3VhbGl6ZXIucmVuZGVyKCk7XG4gICAgdmlzdWFsaXplci5vblVwZGF0ZSA9ICgpID0+IHRoaXMubGF5b3V0KCk7XG4gICAgdGhpcy52aXN1YWxpemVycy5wdXNoKHZpc3VhbGl6ZXIpO1xuXG4gICAgcmV0dXJuIHF1ZXN0aW9uRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXJzIGFsbCBxdWVzdGlvbnMgaW50byBnaXZlbiBIVE1MIGNvbnRhaW5lciBlbGVtZW50LlxuICAgKi9cbiAgcHVibGljIHJlbmRlcigpIHtcbiAgICBsZXQgbGF5b3V0RW5naW5lOiBhbnkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5nZXRMYXlvdXRFbmdpbmUgPSAoKSA9PiBsYXlvdXRFbmdpbmU7XG5cbiAgICB0aGlzLnBhbmVsQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy5wYW5lbENvbnRlbnQuY2xhc3NOYW1lID0gXCJzdmEtZ3JpZFwiO1xuXG4gICAgdGhpcy52aXNpYmxlRWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgbGV0IHF1ZXN0aW9uRWxlbWVudCA9IHRoaXMucmVuZGVyVmlzdWFsaXplcihlbGVtZW50KTtcbiAgICAgIHRoaXMucGFuZWxDb250ZW50LmFwcGVuZENoaWxkKHF1ZXN0aW9uRWxlbWVudCk7XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5zaG93SGVhZGVyKSB7XG4gICAgICBjb25zdCBwYW5lbEhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBwYW5lbEhlYWRlci5jbGFzc05hbWUgPSBcInN2YS1wYW5lbF9faGVhZGVyXCI7XG4gICAgICBjb25zdCB0b29sb2JhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0b29sb2Jhci5jbGFzc05hbWUgPSBcInN2YS10b29sYmFyXCI7XG4gICAgICB0aGlzLmNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sb2Jhcik7XG4gICAgICBwYW5lbEhlYWRlci5hcHBlbmRDaGlsZCh0b29sb2Jhcik7XG4gICAgICB0aGlzLnRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQocGFuZWxIZWFkZXIpO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5wYW5lbENvbnRlbnQpO1xuXG4gICAgdmFyIG1vdmVIYW5kbGVyID0gKGRhdGE6IGFueSkgPT4ge1xuICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5fZWxlbWVudHMuc3BsaWNlKGRhdGEuZnJvbUluZGV4LCAxKTtcbiAgICAgIHRoaXMuX2VsZW1lbnRzLnNwbGljZShkYXRhLnRvSW5kZXgsIDAsIGVsZW1lbnRzWzBdKTtcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuYWxsb3dEeW5hbWljTGF5b3V0KSB7XG4gICAgICBsYXlvdXRFbmdpbmUgPSBuZXcgTXV1cmkodGhpcy5wYW5lbENvbnRlbnQsIHtcbiAgICAgICAgaXRlbXM6IFwiLlwiICsgcXVlc3Rpb25MYXlvdXRlZEVsZW1lbnRDbGFzc05hbWUsXG4gICAgICAgIGRyYWdFbmFibGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBsYXlvdXRFbmdpbmUub24oXCJtb3ZlXCIsIG1vdmVIYW5kbGVyKTtcbiAgICB9XG4gICAgISF3aW5kb3cgJiYgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IFVJRXZlbnQoXCJyZXNpemVcIikpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sYmFyOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIGNvbnN0IHJlc2V0RmlsdGVyQnV0dG9uID0gVG9vbGJhckhlbHBlci5jcmVhdGVCdXR0b24oXG4gICAgICB0b29sYmFyLFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLnZpc3VhbGl6ZXJzLmZvckVhY2goKHZpc3VhbGl6ZXIpID0+IHtcbiAgICAgICAgICBpZiAodmlzdWFsaXplciBpbnN0YW5jZW9mIFNlbGVjdEJhc2UpIHtcbiAgICAgICAgICAgIHZpc3VhbGl6ZXIuc2V0U2VsZWN0aW9uKHVuZGVmaW5lZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwicmVzZXRGaWx0ZXJcIilcbiAgICApO1xuICAgIHRvb2xiYXIuYXBwZW5kQ2hpbGQocmVzZXRGaWx0ZXJCdXR0b24pO1xuXG4gICAgbGV0IGFkZEVsZW1lbnRTZWxlY3RvcjogSFRNTEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgY29uc3QgYWRkRWxlbWVudFNlbGVjdG9yVXBkYXRlciA9IChwYW5lbDogVmlzdWFsaXphdGlvblBhbmVsLCBfOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IGhpZGRlbkVsZW1lbnRzID0gdGhpcy5oaWRkZW5FbGVtZW50cztcbiAgICAgIGlmIChoaWRkZW5FbGVtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdFdyYXBwZXIgPSBUb29sYmFySGVscGVyLmNyZWF0ZVNlbGVjdG9yKFxuICAgICAgICAgIHRvb2xiYXIsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgPGFueT57XG4gICAgICAgICAgICAgIG5hbWU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IGxvY2FsaXphdGlvbi5nZXRTdHJpbmcoXCJhZGRFbGVtZW50XCIpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdXG4gICAgICAgICAgICAuY29uY2F0KGhpZGRlbkVsZW1lbnRzKVxuICAgICAgICAgICAgLm1hcCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBlbGVtZW50Lm5hbWUsXG4gICAgICAgICAgICAgICAgdGV4dDogZWxlbWVudC5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIChvcHRpb246IGFueSkgPT4gZmFsc2UsXG4gICAgICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgZWxlbWVudC52aXNpYmlsaXR5ID0gRWxlbWVudFZpc2liaWxpdHkuVmlzaWJsZTtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uRWxlbWVudCA9IHRoaXMucmVuZGVyVmlzdWFsaXplcihlbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMucGFuZWxDb250ZW50LmFwcGVuZENoaWxkKHF1ZXN0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAhIXRoaXMubGF5b3V0RW5naW5lICYmIHRoaXMubGF5b3V0RW5naW5lLmFkZChbcXVlc3Rpb25FbGVtZW50XSk7XG4gICAgICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c0NoYW5nZWQoZWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICAoYWRkRWxlbWVudFNlbGVjdG9yICYmXG4gICAgICAgICAgdG9vbGJhci5yZXBsYWNlQ2hpbGQoc2VsZWN0V3JhcHBlciwgYWRkRWxlbWVudFNlbGVjdG9yKSkgfHxcbiAgICAgICAgICB0b29sYmFyLmFwcGVuZENoaWxkKHNlbGVjdFdyYXBwZXIpO1xuICAgICAgICBhZGRFbGVtZW50U2VsZWN0b3IgPSBzZWxlY3RXcmFwcGVyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWRkRWxlbWVudFNlbGVjdG9yICYmIHRvb2xiYXIucmVtb3ZlQ2hpbGQoYWRkRWxlbWVudFNlbGVjdG9yKTtcbiAgICAgICAgYWRkRWxlbWVudFNlbGVjdG9yID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH07XG4gICAgYWRkRWxlbWVudFNlbGVjdG9yVXBkYXRlcih0aGlzLCB7fSk7XG4gICAgdGhpcy5vblZpc2libGVFbGVtZW50c0NoYW5nZWQuYWRkKGFkZEVsZW1lbnRTZWxlY3RvclVwZGF0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc3Ryb3lzIHZpc3VhbGl6ZXIgYW5kIGFsbCBpbm5lciBjb250ZW50LlxuICAgKi9cbiAgcHVibGljIGRlc3Ryb3koKSB7XG4gICAgbGV0IGxheW91dEVuZ2luZSA9IHRoaXMubGF5b3V0RW5naW5lO1xuICAgIGlmICghIWxheW91dEVuZ2luZSkge1xuICAgICAgbGF5b3V0RW5naW5lLm9mZihcIm1vdmVcIik7XG4gICAgICBsYXlvdXRFbmdpbmUuZGVzdHJveSgpO1xuICAgICAgdGhpcy5nZXRMYXlvdXRFbmdpbmUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHRoaXMudGFyZ2V0RWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHRoaXMucGFuZWxDb250ZW50ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudmlzdWFsaXplcnMuZm9yRWFjaCgodmlzdWFsaXplcikgPT4ge1xuICAgICAgdmlzdWFsaXplci5vblVwZGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIGlmICh2aXN1YWxpemVyIGluc3RhbmNlb2YgU2VsZWN0QmFzZSkge1xuICAgICAgICB2aXN1YWxpemVyLm9uRGF0YUl0ZW1TZWxlY3RlZCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHZpc3VhbGl6ZXIuZGVzdHJveSgpO1xuICAgIH0pO1xuICAgIHRoaXMudmlzdWFsaXplcnMgPSBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHZpc3VhbGl6ZXIgYW5kIGFsbCBpbm5lciBjb250ZW50LlxuICAgKi9cbiAgcHVibGljIHVwZGF0ZShoYXJkOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICBpZiAoaGFyZCAmJiB0aGlzLnZpc3VhbGl6ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aXN1YWxpemVycy5mb3JFYWNoKCh2aXN1YWxpemVyKSA9PlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHZpc3VhbGl6ZXIudXBkYXRlKHRoaXMuZmlsdGVyZWREYXRhKSwgMTApXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGxheW91dCBvZiB2aXN1YWxpemVyIGlubmVyIGNvbnRlbnQuXG4gICAqL1xuICBwdWJsaWMgbGF5b3V0KCkge1xuICAgIGNvbnN0IGxheW91dEVuZ2luZSA9IHRoaXMubGF5b3V0RW5naW5lO1xuICAgIGlmICghIWxheW91dEVuZ2luZSkge1xuICAgICAgbGF5b3V0RW5naW5lLnJlZnJlc2hJdGVtcygpO1xuICAgICAgbGF5b3V0RW5naW5lLmxheW91dCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBsaWVzIGZpbHRlciBieSBxdWVzdGlvbiBuYW1lIGFuZCB2YWx1ZS5cbiAgICovXG4gIHB1YmxpYyBhcHBseUZpbHRlcihxdWVzdGlvbk5hbWU6IHN0cmluZywgc2VsZWN0ZWRWYWx1ZTogYW55KSB7XG4gICAgdmFyIGZpbHRlckNoYW5nZWQgPSB0cnVlO1xuICAgIGlmIChzZWxlY3RlZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGZpbHRlckNoYW5nZWQgPSB0aGlzLmZpbHRlclZhbHVlc1txdWVzdGlvbk5hbWVdICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgdGhpcy5maWx0ZXJWYWx1ZXNbcXVlc3Rpb25OYW1lXSA9IHNlbGVjdGVkVmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbHRlckNoYW5nZWQgPSB0aGlzLmZpbHRlclZhbHVlc1txdWVzdGlvbk5hbWVdICE9PSB1bmRlZmluZWQ7XG4gICAgICBkZWxldGUgdGhpcy5maWx0ZXJWYWx1ZXNbcXVlc3Rpb25OYW1lXTtcbiAgICB9XG4gICAgaWYgKGZpbHRlckNoYW5nZWQpIHtcbiAgICAgIHRoaXMuZmlsdGVyZWREYXRhID0gdGhpcy5kYXRhLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gIU9iamVjdC5rZXlzKHRoaXMuZmlsdGVyVmFsdWVzKS5zb21lKFxuICAgICAgICAgIChrZXkpID0+IGl0ZW1ba2V5XSAhPT0gdGhpcy5maWx0ZXJWYWx1ZXNba2V5XVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHZpc3V6bGl6ZXIgYnkgcXVlc3Rpb24uXG4gICAqL1xuICBwdWJsaWMgY3JlYXRlVml6dWFsaXplcihcbiAgICB2aXp1YWxpemVyRWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgcXVlc3Rpb246IFF1ZXN0aW9uLFxuICAgIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT5cbiAgKTogVmlzdWFsaXplckJhc2Uge1xuICAgIHZhciBjcmVhdG9ycyA9IFZpc3VhbGl6YXRpb25NYW5hZ2VyLmdldFZpc3VhbGl6ZXJzKHF1ZXN0aW9uLmdldFR5cGUoKSk7XG4gICAgdmFyIHZpc3VhbGl6ZXJzID0gY3JlYXRvcnMubWFwKFxuICAgICAgKGNyZWF0b3IpID0+IG5ldyBjcmVhdG9yKHZpenVhbGl6ZXJFbGVtZW50LCBxdWVzdGlvbiwgZGF0YSlcbiAgICApO1xuICAgIGlmICh2aXN1YWxpemVycy5sZW5ndGggPiAxKSB7XG4gICAgICBsZXQgdmlzdWFsaXplciA9IG5ldyBBbHRlcm5hdGl2ZVZpc3VhbGl6ZXJzV3JhcHBlcihcbiAgICAgICAgdmlzdWFsaXplcnMsXG4gICAgICAgIHZpenVhbGl6ZXJFbGVtZW50LFxuICAgICAgICBxdWVzdGlvbixcbiAgICAgICAgZGF0YVxuICAgICAgKTtcbiAgICAgIHJldHVybiB2aXN1YWxpemVyO1xuICAgIH1cbiAgICByZXR1cm4gdmlzdWFsaXplcnNbMF07XG4gIH1cblxuICBnZXQgc2hvd0hlYWRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fc2hvd0hlYWRlcjtcbiAgfVxuICBzZXQgc2hvd0hlYWRlcihuZXdWYWx1ZTogYm9vbGVhbikge1xuICAgIGlmIChuZXdWYWx1ZSAhPSB0aGlzLl9zaG93SGVhZGVyKSB7XG4gICAgICB0aGlzLl9zaG93SGVhZGVyID0gbmV3VmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZSh0cnVlKTtcbiAgICB9XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy92aXN1YWxpemF0aW9uUGFuZWwudHMiLCJpbXBvcnQgeyBWaXN1YWxpemVyQmFzZSB9IGZyb20gXCIuL3Zpc3VhbGl6ZXJCYXNlXCI7XG5pbXBvcnQgeyBWaXN1YWxpemF0aW9uTWFuYWdlciB9IGZyb20gXCIuL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XG5pbXBvcnQgeyBWaXN1YWxpemF0aW9uUGFuZWwgfSBmcm9tIFwiLi92aXN1YWxpemF0aW9uUGFuZWxcIjtcbmltcG9ydCB7IFF1ZXN0aW9uLCBRdWVzdGlvblBhbmVsRHluYW1pY01vZGVsLCBJUXVlc3Rpb24gfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcblxuZXhwb3J0IGNsYXNzIFZpc3VhbGl6YXRpb25QYW5lbER5bmFtaWMgZXh0ZW5kcyBWaXN1YWxpemVyQmFzZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCB0YXJnZXROb2RlOiBIVE1MRWxlbWVudCxcbiAgICBxdWVzdGlvbjogUXVlc3Rpb24sXG4gICAgZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PixcbiAgICBvcHRpb25zPzogT2JqZWN0XG4gICkge1xuICAgIHN1cGVyKHRhcmdldE5vZGUsIHF1ZXN0aW9uLCBkYXRhLCBvcHRpb25zKTtcbiAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICBkYXRhLmZvckVhY2goXG4gICAgICBkYXRhSXRlbSA9PlxuICAgICAgICAhIWRhdGFJdGVtW3F1ZXN0aW9uLm5hbWVdICYmXG4gICAgICAgICh0aGlzLmRhdGEgPSB0aGlzLmRhdGEuY29uY2F0KGRhdGFJdGVtW3F1ZXN0aW9uLm5hbWVdKSlcbiAgICApO1xuICB9XG5cbiAgZ2V0UXVlc3Rpb25zKCk6IElRdWVzdGlvbltdIHtcbiAgICBjb25zdCBwYW5lbGR5bmFtaWM6IFF1ZXN0aW9uUGFuZWxEeW5hbWljTW9kZWwgPSA8YW55PnRoaXMucXVlc3Rpb247XG4gICAgcmV0dXJuIHBhbmVsZHluYW1pYy50ZW1wbGF0ZS5xdWVzdGlvbnM7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgdmFyIHZpc1BhbmVsID0gbmV3IFZpc3VhbGl6YXRpb25QYW5lbChcbiAgICAgIHRoaXMudGFyZ2V0Tm9kZSxcbiAgICAgIHRoaXMuZ2V0UXVlc3Rpb25zKCksXG4gICAgICB0aGlzLmRhdGEsXG4gICAgICB7IGFsbG93RHluYW1pY0xheW91dDogZmFsc2UgfVxuICAgICk7XG4gICAgdmlzUGFuZWwucmVuZGVyKCk7XG4gIH1cbn1cblxuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFxuICBcInBhbmVsZHluYW1pY1wiLFxuICBWaXN1YWxpemF0aW9uUGFuZWxEeW5hbWljXG4pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3Zpc3VhbGl6YXRpb25QYW5lbER5bmFtaWMudHMiLCJpbXBvcnQgeyBzdG9wV29yZHMgfSBmcm9tIFwiLi9lbmdsaXNoXCI7XG5cbnZhciBzdG9wV29yZHNEaWN0aW9uYXJ5OiB7IFtpbmRleDogc3RyaW5nXTogQXJyYXk8c3RyaW5nPiB9ID0ge307XG5zdG9wV29yZHNEaWN0aW9uYXJ5W1wiZW5cIl0gPSBzdG9wV29yZHM7XG5cbmV4cG9ydCB2YXIgdGV4dEhlbHBlciA9IHtcbiAgZ2V0U3RvcFdvcmRzOiAobG9jYWxlOiBzdHJpbmcgPSBcIlwiKSA9PiB7XG4gICAgcmV0dXJuIHN0b3BXb3Jkc0RpY3Rpb25hcnlbbG9jYWxlIHx8IFwiZW5cIl0gfHwgW107XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvd29yZGNsb3VkL3N0b3B3b3Jkcy9pbmRleC50cyIsIm1vZHVsZS5leHBvcnRzID0gXCI8c3ZnIHN0eWxlPVxcXCJkaXNwbGF5Om5vbmU7XFxcIj48c3ltYm9sIHZpZXdCb3g9XFxcIjAgMCAxNiAxNlxcXCIgaWQ9XFxcInNhLXN2Zy1kZXRhaWxcXFwiPjxjaXJjbGUgY2xhc3M9XFxcInN0MFxcXCIgY3g9XFxcIjEuNVxcXCIgY3k9XFxcIjguNVxcXCIgcj1cXFwiMS41XFxcIj48L2NpcmNsZT48Y2lyY2xlIGNsYXNzPVxcXCJzdDBcXFwiIGN4PVxcXCI3LjVcXFwiIGN5PVxcXCI4LjVcXFwiIHI9XFxcIjEuNVxcXCI+PC9jaXJjbGU+PGNpcmNsZSBjbGFzcz1cXFwic3QwXFxcIiBjeD1cXFwiMTMuNVxcXCIgY3k9XFxcIjguNVxcXCIgcj1cXFwiMS41XFxcIj48L2NpcmNsZT48L3N5bWJvbD48c3ltYm9sIHZpZXdCb3g9XFxcIjAgMCAxNiAxNlxcXCIgaWQ9XFxcInNhLXN2Zy1kcmFnXFxcIj48cGF0aCBjbGFzcz1cXFwic3QwXFxcIiBkPVxcXCJNMTMgNWwtMSAxIDEgMUg5VjNsMSAxIDEtMS0zLTMtMyAzIDEgMSAxLTF2NEgzbDEtMS0xLTEtMyAzIDMgMyAxLTEtMS0xaDR2NGwtMS0xLTEgMSAzIDMgMy0zLTEtMS0xIDFWOWg0bC0xIDEgMSAxIDMtM3pcXFwiPjwvcGF0aD48L3N5bWJvbD48c3ltYm9sIHZpZXdCb3g9XFxcIjAgMCAxNiAxNlxcXCIgaWQ9XFxcInNhLXN2Zy1oaWRlXFxcIj48cGF0aCBjbGFzcz1cXFwic3QxXFxcIiBkPVxcXCJNMTIuNzkgNC4yTDE2IDFsLTEtMS0zLjMyIDMuMzJDMTAuNTcgMi41NSA5LjMyIDIgOCAyIDMuNjMgMiAwIDcuOTcgMCA3Ljk3czEuMjcgMi4xIDMuMjEgMy44MmwtMy4yMyAzLjIzLjk4Ljk4IDMuMzUtMy4zNEM1LjQxIDEzLjQ0IDYuNjcgMTQgOCAxNGM0LjM3IDAgOC02IDgtNnMtMS4yNy0yLjA5LTMuMjEtMy44ek0yIDcuOTdjMS4wNy0xLjQ3IDMuNjEtNCA2LTQgLjggMCAxLjYuMjcgMi4zNS42OGwtLjc4Ljc4Yy0uNDYtLjI5LS45OS0uNDYtMS41Ny0uNDYtMS42NiAwLTMgMS4zNC0zIDMgMCAuNTguMTcgMS4xMS40NiAxLjU3bC0uOTcuOTdBMTMuMzggMTMuMzggMCAwIDEgMiA3Ljk3em02IDRjLS44IDAtMS41OS0uMjctMi4zMy0uNjdsLjc4LS43N2MuNDUuMjcuOTguNDQgMS41NS40NCAxLjY2IDAgMy0xLjM0IDMtMyAwLS41Ny0uMTctMS4wOS0uNDQtMS41NWwuOTgtLjk4YzEuMTEuODcgMi4wMSAxLjkxIDIuNDYgMi41Mi0xLjA3IDEuNDgtMy42MSA0LjAxLTYgNC4wMXpcXFwiPjwvcGF0aD48L3N5bWJvbD48c3ltYm9sIHZpZXdCb3g9XFxcIjAgMCAxNiAxNlxcXCIgaWQ9XFxcInNhLXN2Zy1tYWtlcHJpdmF0ZVxcXCI+PGNpcmNsZSBjbGFzcz1cXFwic3QwXFxcIiBjeD1cXFwiOFxcXCIgY3k9XFxcIjRcXFwiIHI9XFxcIjNcXFwiPjwvY2lyY2xlPjxwYXRoIGNsYXNzPVxcXCJzdDBcXFwiIGQ9XFxcIk04IDhjLTMuMzEgMC02IDIuNzMtNiA0LjY3UzUuMjcgMTUgOCAxNXM2LS40IDYtMi4zM1MxMS4zMSA4IDggOHpcXFwiPjwvcGF0aD48L3N5bWJvbD48c3ltYm9sIHZpZXdCb3g9XFxcIjAgMCAxNiAxNlxcXCIgaWQ9XFxcInNhLXN2Zy1tYWtlcHVibGljXFxcIj48Y2lyY2xlIGNsYXNzPVxcXCJzdDBcXFwiIGN4PVxcXCI2XFxcIiBjeT1cXFwiNVxcXCIgcj1cXFwiM1xcXCI+PC9jaXJjbGU+PHBhdGggY2xhc3M9XFxcInN0MFxcXCIgZD1cXFwiTTEwIDVjMCAuMzQtLjA2LjY3LS4xNC45OS4wNSAwIC4wOS4wMS4xNC4wMSAxLjY2IDAgMy0xLjM0IDMtM3MtMS4zNC0zLTMtM0M4Ljk3IDAgOC4wNy41MiA3LjUzIDEuMyA4Ljk4IDEuOTEgMTAgMy4zMyAxMCA1ek02IDljLTMuMzEgMC02IDIuNzMtNiA0LjY3UzMuMjcgMTYgNiAxNnM2LS40IDYtMi4zM1M5LjMxIDkgNiA5ek0xMCA3Yy0uMTkgMC0uMzguMDEtLjU3LjAzYTQuMTQgNC4xNCAwIDAgMS0xLjM3IDEuMzljMyAuODMgNS4yMyAzLjMxIDUuNDIgNS4yOCAxLjQ0LS4zMSAyLjUyLS45MiAyLjUyLTIuMDNDMTYgOS43NCAxMy4zMSA3IDEwIDd6XFxcIj48L3BhdGg+PC9zeW1ib2w+PHN5bWJvbCB2aWV3Qm94PVxcXCIwIDAgMTYgMTZcXFwiIGlkPVxcXCJzYS1zdmctbW92ZXRvZGV0YWlsc1xcXCI+PGNpcmNsZSBjbGFzcz1cXFwic3QwXFxcIiBjeD1cXFwiMS41XFxcIiBjeT1cXFwiMTQuNVxcXCIgcj1cXFwiMS41XFxcIj48L2NpcmNsZT48Y2lyY2xlIGNsYXNzPVxcXCJzdDBcXFwiIGN4PVxcXCI3LjVcXFwiIGN5PVxcXCIxNC41XFxcIiByPVxcXCIxLjVcXFwiPjwvY2lyY2xlPjxjaXJjbGUgY2xhc3M9XFxcInN0MFxcXCIgY3g9XFxcIjEzLjVcXFwiIGN5PVxcXCIxNC41XFxcIiByPVxcXCIxLjVcXFwiPjwvY2lyY2xlPjxwYXRoIGNsYXNzPVxcXCJzdDBcXFwiIGQ9XFxcIk0xMiAxaDN2OWgtM3pNMi4wMiA3LjAyTDEgNiAwIDdsMyAzIDMtMy0xLTEtLjk0Ljk0QzQuMzMgNC43MyA2LjIxIDMgOC41IDNjLjE3IDAgLjMzLjAzLjUuMDVWMS4wM0M4LjgzIDEuMDEgOC42NyAxIDguNSAxIDUuMDggMSAyLjI3IDMuNjYgMi4wMiA3LjAyelxcXCI+PC9wYXRoPjwvc3ltYm9sPjxzeW1ib2wgdmlld0JveD1cXFwiMCAwIDE2IDE2XFxcIiBpZD1cXFwic2Etc3ZnLXNvcnRpbmdcXFwiPjxwYXRoIGNsYXNzPVxcXCJzdDBcXFwiIGQ9XFxcIk04IDNsMiAyIDEtMS0zLTMtMyAzIDEgMXpNOCAxM2wtMi0yLTEgMSAzIDMgMy0zLTEtMXpcXFwiPjwvcGF0aD48L3N5bWJvbD48L3N2Zz5cIjtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vaHRtbC1sb2FkZXI/aW50ZXJwb2xhdGUhLi9+L3ZhbC1sb2FkZXIhLi9zcmMvc3ZnYnVuZGxlLmh0bWxcbi8vIG1vZHVsZSBpZCA9IDExXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImltcG9ydCB7IFF1ZXN0aW9uLCBRdWVzdGlvblNlbGVjdEJhc2UsIEl0ZW1WYWx1ZSB9IGZyb20gXCJzdXJ2ZXktY29yZVwiO1xuaW1wb3J0IHsgVmlzdWFsaXplckJhc2UgfSBmcm9tIFwiLi92aXN1YWxpemVyQmFzZVwiO1xuaW1wb3J0IHsgbG9jYWxpemF0aW9uIH0gZnJvbSBcIi4vbG9jYWxpemF0aW9uTWFuYWdlclwiO1xuaW1wb3J0IHsgVG9vbGJhckhlbHBlciB9IGZyb20gXCIuL3V0aWxzL2luZGV4XCI7XG5cbmV4cG9ydCBjbGFzcyBTZWxlY3RCYXNlIGV4dGVuZHMgVmlzdWFsaXplckJhc2Uge1xuICBwcml2YXRlIHNlbGVjdGVkSXRlbTogSXRlbVZhbHVlID0gdW5kZWZpbmVkO1xuICBwcm90ZWN0ZWQgb3JkZXJCeUFuc3dlcmVzOiBzdHJpbmcgPSBcImRlZmF1bHRcIjtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuICAgIHF1ZXN0aW9uOiBRdWVzdGlvbixcbiAgICBkYXRhOiBBcnJheTx7IFtpbmRleDogc3RyaW5nXTogYW55IH0+LFxuICAgIG9wdGlvbnM/OiBPYmplY3RcbiAgKSB7XG4gICAgc3VwZXIodGFyZ2V0RWxlbWVudCwgcXVlc3Rpb24sIGRhdGEsIG9wdGlvbnMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNoYXJ0VHlwZXM6IHN0cmluZ1tdO1xuICBwcm90ZWN0ZWQgY2hhcnRUeXBlOiBzdHJpbmc7XG4gIHByb3RlY3RlZCBjaGFydE5vZGU6IEhUTUxFbGVtZW50ID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHByb3RlY3RlZCBvbkNoYXJ0VHlwZUNoYW5nZWQoKSB7fVxuICBwcm90ZWN0ZWQgc2V0Q2hhcnRUeXBlKGNoYXJ0VHlwZTogc3RyaW5nKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5jaGFydFR5cGVzLmluZGV4T2YoY2hhcnRUeXBlKSAhPT0gLTEgJiZcbiAgICAgIHRoaXMuY2hhcnRUeXBlICE9PSBjaGFydFR5cGVcbiAgICApIHtcbiAgICAgIHRoaXMuY2hhcnRUeXBlID0gY2hhcnRUeXBlO1xuICAgICAgdGhpcy5jcmVhdGVDaGFydCgpO1xuICAgICAgdGhpcy5pbnZva2VPblVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZUNoYXJ0KCkge31cblxuICBzZXRTZWxlY3Rpb24oaXRlbTogSXRlbVZhbHVlKSB7XG4gICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBpdGVtO1xuICAgIHRoaXMub25EYXRhSXRlbVNlbGVjdGVkKChpdGVtICYmIGl0ZW0udmFsdWUpIHx8IHVuZGVmaW5lZCwgKGl0ZW0gJiYgaXRlbS50ZXh0KSB8fCBcIlwiKTtcbiAgfVxuICBnZXQgc2VsZWN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSXRlbTtcbiAgfVxuICBzZXRMYWJlbHNPcmRlcih2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5vcmRlckJ5QW5zd2VyZXMgPSB2YWx1ZTtcbiAgfVxuICBvbkRhdGFJdGVtU2VsZWN0ZWQ6IChzZWxlY3RlZFZhbHVlOiBhbnksIHNlbGVjdGVkVGV4dDogc3RyaW5nKSA9PiB2b2lkO1xuXG4gIHByb3RlY3RlZCByZW5kZXJDb250ZW50KGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICB0aGlzLmNyZWF0ZUNoYXJ0KCk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY2hhcnROb2RlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVUb29sYmFySXRlbXModG9vbGJhcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICBpZiAodGhpcy5jaGFydFR5cGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IHNlbGVjdFdyYXBwZXIgPSBUb29sYmFySGVscGVyLmNyZWF0ZVNlbGVjdG9yKHRvb2xiYXIsXG4gICAgICAgIHRoaXMuY2hhcnRUeXBlcy5tYXAoY2hhcnRUeXBlID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IGNoYXJ0VHlwZSxcbiAgICAgICAgICAgIHRleHQ6IGxvY2FsaXphdGlvbi5nZXRTdHJpbmcoXCJjaGFydFR5cGVfXCIgKyBjaGFydFR5cGUpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgICAgIChvcHRpb246IGFueSkgPT4gdGhpcy5jaGFydFR5cGUgPT09IG9wdGlvbi52YWx1ZSxcbiAgICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICAgIHRoaXMuc2V0Q2hhcnRUeXBlKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICB0aGlzLm9uQ2hhcnRUeXBlQ2hhbmdlZCgpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdG9vbGJhci5hcHBlbmRDaGlsZChzZWxlY3RXcmFwcGVyKTtcbiAgICB9XG4gICAgc3VwZXIuY3JlYXRlVG9vbGJhckl0ZW1zKHRvb2xiYXIpO1xuICB9XG5cbiAgdmFsdWVzU291cmNlKCk6IGFueVtdIHtcbiAgICBjb25zdCBxdWVzdGlvbiA9IDxRdWVzdGlvblNlbGVjdEJhc2U+dGhpcy5xdWVzdGlvbjtcbiAgICByZXR1cm4gcXVlc3Rpb25bXCJhY3RpdmVDaG9pY2VzXCJdO1xuICB9XG5cbiAgZ2V0VmFsdWVzKCk6IEFycmF5PGFueT4ge1xuICAgIGNvbnN0IHZhbHVlczogQXJyYXk8YW55PiA9IHRoaXMudmFsdWVzU291cmNlKCkubWFwKGNob2ljZSA9PiBjaG9pY2UudmFsdWUpO1xuXG4gICAgaWYgKHRoaXMucXVlc3Rpb24uaGFzT3RoZXIpIHZhbHVlcy51bnNoaWZ0KFwib3RoZXJcIik7XG5cbiAgICByZXR1cm4gdmFsdWVzO1xuICB9XG5cbiAgZ2V0TGFiZWxzKCk6IEFycmF5PHN0cmluZz4ge1xuICAgIGNvbnN0IGxhYmVsczogQXJyYXk8c3RyaW5nPiA9IHRoaXMudmFsdWVzU291cmNlKCkubWFwKGNob2ljZSA9PlxuICAgICAgSXRlbVZhbHVlLmdldFRleHRPckh0bWxCeVZhbHVlKHRoaXMudmFsdWVzU291cmNlKCksIGNob2ljZS52YWx1ZSlcbiAgICApO1xuXG4gICAgaWYgKHRoaXMucXVlc3Rpb24uaGFzT3RoZXIpIGxhYmVscy51bnNoaWZ0KFwiT3RoZXJcIik7XG5cbiAgICByZXR1cm4gbGFiZWxzO1xuICB9XG5cbiAgZ2V0RGF0YSgpOiBhbnlbXSB7XG4gICAgY29uc3QgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoKTtcbiAgICBjb25zdCBzdGF0aXN0aWNzID0gdmFsdWVzLm1hcCh2ID0+IDApO1xuICAgIHRoaXMuZGF0YS5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICBjb25zdCByb3dWYWx1ZTogYW55ID0gcm93W3RoaXMucXVlc3Rpb24ubmFtZV07XG4gICAgICBpZiAoISFyb3dWYWx1ZSkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyb3dWYWx1ZSkpIHtcbiAgICAgICAgICB2YWx1ZXMuZm9yRWFjaCgodmFsOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChyb3dWYWx1ZS5pbmRleE9mKHZhbCkgIT09IC0xKSB7XG4gICAgICAgICAgICAgIHN0YXRpc3RpY3NbaW5kZXhdKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsdWVzLmZvckVhY2goKHZhbDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAocm93VmFsdWUgPT0gdmFsKSB7XG4gICAgICAgICAgICAgIHN0YXRpc3RpY3NbaW5kZXhdKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gW3N0YXRpc3RpY3NdO1xuICB9XG4gIHppcEFycmF5cyhmaXJzdDogYW55W10sIHNlY29uZDogYW55W10pOiBhbnlbXVtdIHtcbiAgICBsZXQgemlwQXJyYXk6IGFueVtdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLm1pbihmaXJzdC5sZW5ndGgsIHNlY29uZC5sZW5ndGgpOyBpKyspIHtcbiAgICAgIHppcEFycmF5W2ldID0gW2ZpcnN0W2ldLCBzZWNvbmRbaV1dO1xuICAgIH1cbiAgICByZXR1cm4gemlwQXJyYXk7XG4gIH1cbiAgdW56aXBBcnJheXMoemlwQXJyYXk6IGFueVtdW10pOiB7IGZpcnN0OiBhbnlbXTsgc2Vjb25kOiBhbnlbXSB9IHtcbiAgICBsZXQgdHdvQXJyYXlzOiBhbnkgPSB7IGZpcnN0OiBbXSwgc2Vjb25kOiBbXSB9O1xuICAgIHppcEFycmF5LmZvckVhY2goKHZhbHVlLCBpKSA9PiB7XG4gICAgICB0d29BcnJheXMuZmlyc3RbaV0gPSB2YWx1ZVswXTtcbiAgICAgIHR3b0FycmF5cy5zZWNvbmRbaV0gPSB2YWx1ZVsxXTtcbiAgICB9KTtcbiAgICByZXR1cm4gdHdvQXJyYXlzO1xuICB9XG4gIHNvcnREaWN0aW9uYXJ5KFxuICAgIGtleXM6IGFueVtdLFxuICAgIHZhbHVlczogYW55W10sXG4gICAgZGVzYzogYm9vbGVhblxuICApOiB7IGtleXM6IGFueVtdOyB2YWx1ZXM6IGFueVtdIH0ge1xuICAgIGxldCBkaWN0aW9uYXJ5ID0gdGhpcy56aXBBcnJheXMoa2V5cywgdmFsdWVzKTtcbiAgICBsZXQgY29tcGFyYXRvciA9IChhOiBhbnlbXSwgYjogYW55W10sIGFzYzogYm9vbGVhbiA9IHRydWUpID0+IHtcbiAgICAgIGxldCByZXN1bHQgPSBhWzFdIDwgYlsxXSA/IDEgOiBhWzFdID09IGJbMV0gPyAwIDogLTE7XG4gICAgICByZXR1cm4gYXNjID8gcmVzdWx0IDogcmVzdWx0ICogLTE7XG4gICAgfTtcbiAgICBkaWN0aW9uYXJ5LnNvcnQoKGE6IGFueVtdLCBiOiBhbnlbXSkgPT4ge1xuICAgICAgcmV0dXJuIGRlc2MgPyBjb21wYXJhdG9yKGEsIGIsIGZhbHNlKSA6IGNvbXBhcmF0b3IoYSwgYik7XG4gICAgfSk7XG4gICAgbGV0IGtleXNBbmRWYWx1ZXMgPSB0aGlzLnVuemlwQXJyYXlzKGRpY3Rpb25hcnkpO1xuICAgIHJldHVybiB7IGtleXM6IGtleXNBbmRWYWx1ZXMuZmlyc3QsIHZhbHVlczoga2V5c0FuZFZhbHVlcy5zZWNvbmQgfTtcbiAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3NlbGVjdEJhc2UudHMiLCJpbXBvcnQgeyBTdXJ2ZXlNb2RlbCwgUXVlc3Rpb24gfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcbmltcG9ydCB7XG4gIElUYWJsZUNvbHVtbixcbiAgQ29sdW1uVmlzaWJpbGl0eSxcbiAgUXVlc3Rpb25Mb2NhdGlvbixcbiAgQ29sdW1uRGF0YVR5cGUsXG59IGZyb20gXCIuL2NvbmZpZ1wiO1xuXG5leHBvcnQgY2xhc3MgVGFibGUge1xuICBwcm90ZWN0ZWQgdGFibGVEYXRhOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHRhcmdldE5vZGU6IEhUTUxFbGVtZW50LFxuICAgIHByb3RlY3RlZCBzdXJ2ZXk6IFN1cnZleU1vZGVsLFxuICAgIHByb3RlY3RlZCBkYXRhOiBBcnJheTxPYmplY3Q+LFxuICAgIHByb3RlY3RlZCBvcHRpb25zOiBhbnksXG4gICAgcHJvdGVjdGVkIF9jb2x1bW5zOiBBcnJheTxhbnk+ID0gW10sXG4gICAgcHJvdGVjdGVkIGlzVHJ1c3RlZEFjY2VzcyA9IGZhbHNlXG4gICkge1xuICAgIGlmIChfY29sdW1ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuX2NvbHVtbnMgPSB0aGlzLmJ1aWxkQ29sdW1ucyhzdXJ2ZXkpO1xuICAgIH1cbiAgICB0aGlzLmluaXRUYWJsZURhdGEoZGF0YSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYnVpbGRDb2x1bW5zID0gKHN1cnZleTogU3VydmV5TW9kZWwpID0+IHtcbiAgICByZXR1cm4gdGhpcy5zdXJ2ZXkuZ2V0QWxsUXVlc3Rpb25zKCkubWFwKChxdWVzdGlvbjogUXVlc3Rpb24pID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IHF1ZXN0aW9uLm5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiAocXVlc3Rpb24udGl0bGUgfHwgXCJcIikudHJpbSgpIHx8IHF1ZXN0aW9uLm5hbWUsXG4gICAgICAgIGRhdGFUeXBlOlxuICAgICAgICAgIHF1ZXN0aW9uLmdldFR5cGUoKSAhPT0gXCJmaWxlXCJcbiAgICAgICAgICAgID8gQ29sdW1uRGF0YVR5cGUuVGV4dFxuICAgICAgICAgICAgOiBDb2x1bW5EYXRhVHlwZS5GaWxlTGluayxcbiAgICAgICAgdmlzaWJpbGl0eTpcbiAgICAgICAgICBxdWVzdGlvbi5nZXRUeXBlKCkgIT09IFwiZmlsZVwiXG4gICAgICAgICAgICA/IENvbHVtblZpc2liaWxpdHkuVmlzaWJsZVxuICAgICAgICAgICAgOiBDb2x1bW5WaXNpYmlsaXR5LkludmlzaWJsZSxcbiAgICAgICAgbG9jYXRpb246IFF1ZXN0aW9uTG9jYXRpb24uQ29sdW1uLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcblxuICBwdWJsaWMgaXNWaXNpYmxlID0gKHZpc2liaWxpdHk6IENvbHVtblZpc2liaWxpdHkpID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgKHRoaXMuaXNUcnVzdGVkQWNjZXNzICYmIHZpc2liaWxpdHkgIT09IENvbHVtblZpc2liaWxpdHkuSW52aXNpYmxlKSB8fFxuICAgICAgKCF0aGlzLmlzVHJ1c3RlZEFjY2VzcyAmJiB2aXNpYmlsaXR5ID09PSBDb2x1bW5WaXNpYmlsaXR5LlZpc2libGUpXG4gICAgKTtcbiAgfTtcblxuICBwcm90ZWN0ZWQgZ2V0IGNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIFtdLmNvbmNhdCh0aGlzLl9jb2x1bW5zKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBdmFpbGFibGVDb2x1bW5zID0gKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbnMuZmlsdGVyKFxuICAgICAgKGNvbHVtbikgPT5cbiAgICAgICAgY29sdW1uLmxvY2F0aW9uID09PSBRdWVzdGlvbkxvY2F0aW9uLkNvbHVtbiAmJlxuICAgICAgICB0aGlzLmlzVmlzaWJsZShjb2x1bW4udmlzaWJpbGl0eSlcbiAgICApO1xuICB9O1xuXG4gIHByb3RlY3RlZCBpbml0VGFibGVEYXRhKGRhdGE6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLnRhYmxlRGF0YSA9IChkYXRhIHx8IFtdKS5tYXAoKGl0ZW0pID0+IHtcbiAgICAgIHZhciBkYXRhSXRlbTogYW55ID0ge307XG4gICAgICB0aGlzLnN1cnZleS5kYXRhID0gaXRlbTtcbiAgICAgIHRoaXMuX2NvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIHZhciBkaXNwbGF5VmFsdWUgPSBpdGVtW2NvbHVtbi5uYW1lXTtcbiAgICAgICAgY29uc3QgcXVlc3Rpb24gPSB0aGlzLnN1cnZleS5nZXRRdWVzdGlvbkJ5TmFtZShjb2x1bW4ubmFtZSk7XG4gICAgICAgIGlmIChxdWVzdGlvbikge1xuICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IHF1ZXN0aW9uLmRpc3BsYXlWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBkYXRhSXRlbVtjb2x1bW4ubmFtZV0gPVxuICAgICAgICAgIHR5cGVvZiBkaXNwbGF5VmFsdWUgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICAgID8gZGlzcGxheVZhbHVlXG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGRpc3BsYXlWYWx1ZSkgfHwgXCJcIjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRhdGFJdGVtO1xuICAgIH0pO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdGFibGVzL3RhYmxlLnRzIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFXzE0X187XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwge1wicm9vdFwiOlwiUGxvdGx5XCIsXCJjb21tb25qczJcIjpcInBsb3RseS5qcy1kaXN0XCIsXCJjb21tb25qc1wiOlwicGxvdGx5LmpzLWRpc3RcIixcImFtZFwiOlwicGxvdGx5LmpzLWRpc3RcIn1cbi8vIG1vZHVsZSBpZCA9IDE0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImV4cG9ydCAqIGZyb20gXCIuL2xvY2FsaXphdGlvbk1hbmFnZXJcIjtcblxuZXhwb3J0ICogZnJvbSBcIi4vdmlzdWFsaXplckJhc2VcIjtcbmV4cG9ydCAqIGZyb20gXCIuL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XG5leHBvcnQgKiBmcm9tIFwiLi92aXN1YWxpemF0aW9uUGFuZWxcIjtcbmV4cG9ydCAqIGZyb20gXCIuL3Zpc3VhbGl6YXRpb25QYW5lbER5bmFtaWNcIjtcbmV4cG9ydCAqIGZyb20gXCIuL3Zpc3VhbGl6YXRpb25NYXRyaXhEeW5hbWljXCI7XG5cbmV4cG9ydCAqIGZyb20gXCIuL3RhYmxlcy9kYXRhdGFibGVzXCI7XG5leHBvcnQgKiBmcm9tIFwiLi90YWJsZXMvdGFidWxhdG9yXCI7XG5cbmV4cG9ydCAqIGZyb20gXCIuL3Bsb3RseS9pbmRleFwiO1xuZXhwb3J0ICogZnJvbSBcIi4vd29yZGNsb3VkL3dvcmRjbG91ZFwiO1xuZXhwb3J0ICogZnJvbSBcIi4vd29yZGNsb3VkL3N0b3B3b3Jkcy9pbmRleFwiO1xuZXhwb3J0ICogZnJvbSBcIi4vdGV4dFwiO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2luZGV4LnRzIiwiZXhwb3J0ICogZnJvbSBcIi4vc2VsZWN0QmFzZVwiO1xuZXhwb3J0ICogZnJvbSBcIi4vcmF0aW5nXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9tYXRyaXhcIjtcbmV4cG9ydCAqIGZyb20gXCIuL2Jvb2xlYW5cIjtcbmV4cG9ydCAqIGZyb20gXCIuL3NlbGVjdEJhc2VTb3J0YWJsZVwiXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3Bsb3RseS9pbmRleC50cyIsImltcG9ydCAqIGFzICQgZnJvbSBcImpxdWVyeVwiO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tIFwiLi90YWJsZVwiO1xuaW1wb3J0IHsgU3VydmV5TW9kZWwsIFF1ZXN0aW9uLCBFdmVudCB9IGZyb20gXCJzdXJ2ZXktY29yZVwiO1xuaW1wb3J0IHtcbiAgSVRhYmxlQ29sdW1uLFxuICBDb2x1bW5WaXNpYmlsaXR5LFxuICBRdWVzdGlvbkxvY2F0aW9uLFxuICBDb2x1bW5EYXRhVHlwZSxcbn0gZnJvbSBcIi4vY29uZmlnXCI7XG5pbXBvcnQgeyBsb2NhbGl6YXRpb24gfSBmcm9tIFwiLi4vbG9jYWxpemF0aW9uTWFuYWdlclwiO1xuXG5pbXBvcnQgXCIuL2RhdGF0YWJsZXMuc2Nzc1wiO1xuXG5pZiAoISFkb2N1bWVudCkge1xuICB2YXIgc3ZnVGVtcGxhdGUgPSByZXF1aXJlKFwiaHRtbC1sb2FkZXI/aW50ZXJwb2xhdGUhdmFsLWxvYWRlciEuLi9zdmdidW5kbGUuaHRtbFwiKTtcbiAgdmFyIHRlbXBsYXRlSG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgdGVtcGxhdGVIb2xkZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB0ZW1wbGF0ZUhvbGRlci5pbm5lckhUTUwgPSBzdmdUZW1wbGF0ZTtcbiAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0ZW1wbGF0ZUhvbGRlcik7XG59XG5cbmludGVyZmFjZSBEYXRhVGFibGVzT3B0aW9ucyB7XG4gIGJ1dHRvbnM6IGJvb2xlYW4gfCBzdHJpbmdbXSB8IGFueVtdIHwgYW55O1xuXG4gIGRvbTogc3RyaW5nO1xuXG4gIG9yZGVyRml4ZWQ6IEFycmF5PG51bWJlciB8IHN0cmluZz4gfCBBcnJheTxBcnJheTxudW1iZXIgfCBzdHJpbmc+PiB8IG9iamVjdDtcblxuICByb3dHcm91cDogYm9vbGVhbiB8IGFueTtcblxuICBoZWFkZXJDYWxsYmFjazogYW55O1xufVxuXG5leHBvcnQgY2xhc3MgRGF0YVRhYmxlcyBleHRlbmRzIFRhYmxlIHtcbiAgcHJpdmF0ZSBzdmdOb2RlOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBkYXRhdGFibGVBcGk6IGFueTtcblxuICBwdWJsaWMgY3VycmVudFBhZ2VOdW1iZXI6IG51bWJlciA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSBldmVudCBpcyBmaXJlZCBjb2x1bW5zIGNvbmZpZ3VyYXRpb24gaGFzIGJlZW4gY2hhbmdlZC5cbiAgICogPGJyLz4gc2VuZGVyIHRoZSBkYXRhdGFibGVzIGFkYXB0ZXJcbiAgICogPGJyLz4gb3B0aW9ucy5zdXJ2ZXkgY3VycmVudCBzdXJ2ZXlcbiAgICogQHNlZSBnZXRDb2x1bW5zXG4gICAqL1xuICBwdWJsaWMgY29sdW1uc0NoYW5nZWQ6IEV2ZW50PFxuICAgIChzZW5kZXI6IERhdGFUYWJsZXMsIG9wdGlvbnM6IGFueSkgPT4gYW55LFxuICAgIGFueVxuICA+ID0gbmV3IEV2ZW50PChzZW5kZXI6IERhdGFUYWJsZXMsIG9wdGlvbnM6IGFueSkgPT4gYW55LCBhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdGFyZ2V0Tm9kZTogSFRNTEVsZW1lbnQsXG4gICAgc3VydmV5OiBTdXJ2ZXlNb2RlbCxcbiAgICBkYXRhOiBBcnJheTxPYmplY3Q+LFxuICAgIG9wdGlvbnM6IERhdGFUYWJsZXNPcHRpb25zLFxuICAgIF9jb2x1bW5zOiBBcnJheTxJVGFibGVDb2x1bW4+ID0gW10sXG4gICAgaXNUcnVzdGVkQWNjZXNzID0gZmFsc2VcbiAgKSB7XG4gICAgc3VwZXIodGFyZ2V0Tm9kZSwgc3VydmV5LCBkYXRhLCBvcHRpb25zLCBfY29sdW1ucywgaXNUcnVzdGVkQWNjZXNzKTtcbiAgICB0YXJnZXROb2RlLmNsYXNzTmFtZSArPSBcInNhLWRhdGF0YWJsZXNcIjtcblxuICAgIHRoaXMuaGVhZGVyQnV0dG9uQ3JlYXRvcnMgPSBbXG4gICAgICAvLyB0aGlzLmNyZWF0ZUdyb3VwaW5nQnV0dG9uLFxuICAgICAgdGhpcy5jcmVhdGVTb3J0QnV0dG9uLFxuICAgICAgdGhpcy5jcmVhdGVIaWRlQnV0dG9uLFxuICAgICAgdGhpcy5jcmVhdGVNb3ZlVG9EZXRhaWxCdXR0b24sXG4gICAgICB0aGlzLmNyZWF0ZURyYWdCdXR0b24sXG4gICAgXTtcblxuICAgIGlmICh0aGlzLmlzVHJ1c3RlZEFjY2Vzcykge1xuICAgICAgdGhpcy5oZWFkZXJCdXR0b25DcmVhdG9ycy5zcGxpY2UoMiwgMCwgdGhpcy5jcmVhdGVDb2x1bW5Qcml2YXRlQnV0dG9uKTtcbiAgICB9XG5cbiAgICB0aGlzLmRldGFpbEJ1dHRvbkNyZWF0b3JzID0gW3RoaXMuY3JlYXRlU2hvd0FzQ29sdW1uQnV0dG9uXTtcbiAgICBpZiAoX2NvbHVtbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9jb2x1bW5zID0gdGhpcy5idWlsZENvbHVtbnMoc3VydmV5KTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgb25Db2x1bW5zQ2hhbmdlZCgpIHtcbiAgICB0aGlzLmNvbHVtbnNDaGFuZ2VkLmZpcmUodGhpcywgeyBzdXJ2ZXk6IHRoaXMuc3VydmV5IH0pO1xuICB9XG5cbiAgcHVibGljIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiBbXS5jb25jYXQodGhpcy5fY29sdW1ucyk7XG4gIH1cbiAgcHVibGljIHNldCBjb2x1bW5zKGNvbHVtbnM6IEFycmF5PElUYWJsZUNvbHVtbj4pIHtcbiAgICB0aGlzLl9jb2x1bW5zID0gY29sdW1ucztcbiAgICB0aGlzLnVwZGF0ZSh0cnVlKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGUoaGFyZDogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgaWYgKHRoaXMuaXNSZW5kZXJlZCkge1xuICAgICAgaWYgKGhhcmQpIHtcbiAgICAgICAgdGhpcy5pbml0VGFibGVEYXRhKHRoaXMuZGF0YSk7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cnJlbnRQYWdlTnVtYmVyID0gdGhpcy5kYXRhdGFibGVBcGkucGFnZS5pbmZvKCkucGFnZTtcbiAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlzUmVuZGVyZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMudGFyZ2V0Tm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwO1xuICB9XG5cbiAgZ3JvdXBCeTogQXJyYXk8c3RyaW5nPiA9IFtdO1xuXG4gIGRlc3Ryb3koKSB7XG4gICAgLy9pZighdGhpcy50YXJnZXROb2RlKSByZXR1cm47XG4gICAgY29uc3QgdGFibGVOb2RlID0gdGhpcy50YXJnZXROb2RlLmNoaWxkcmVuWzBdO1xuICAgIGlmICgoPGFueT4kLmZuKS5EYXRhVGFibGUuaXNEYXRhVGFibGUodGFibGVOb2RlKSkge1xuICAgICAgJCh0YWJsZU5vZGUpLkRhdGFUYWJsZSgpLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgdGhpcy5kYXRhdGFibGVBcGkgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50YXJnZXROb2RlLmlubmVySFRNTCA9IFwiXCI7XG4gIH1cblxuICBjcmVhdGVBY3Rpb25Db250YWluZXIoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic2EtZGF0YXRhYmxlc19fYWN0aW9uLWNvbnRhaW5lclwiO1xuXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfVxuICBjcmVhdGVNaW5vckNvbHVtbnNCdXR0b24oKSB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24udGl0bGUgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwic2hvd01pbm9yQ29sdW1uc1wiKTtcblxuICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX3N2Zy1idXR0b25cIjtcbiAgICBidXR0b24uYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVTdmdFbGVtZW50KFwiZGV0YWlsXCIpKTtcbiAgICByZXR1cm4gYnV0dG9uO1xuICB9XG4gIHNldE1pbm9yQ29sdW1uc0J1dHRvbkNhbGxiYWNrKGRhdGF0YWJsZUFwaVJlZjogYW55KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICQoZGF0YXRhYmxlQXBpUmVmLnRhYmxlKCkuYm9keSgpKS5vbihcbiAgICAgIFwiY2xpY2tcIixcbiAgICAgIFwidGQuc2EtZGF0YXRhYmxlc19fYWN0aW9uLWNvbHVtbiBidXR0b24uc2EtZGF0YXRhYmxlc19fc3ZnLWJ1dHRvblwiLFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBkZXRhaWxUciA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xuICAgICAgICB2YXIgcm93ID0gZGF0YXRhYmxlQXBpUmVmLnJvdyhkZXRhaWxUcik7XG4gICAgICAgIGlmIChkZXRhaWxUci5oYXNDbGFzcyhcInNhLWRhdGF0YWJsZXNfX2RldGFpbC1yb3dcIikpIHtcbiAgICAgICAgICBkZXRhaWxUci5uZXh0QWxsKFwidHIuc2EtZGF0YXRhYmxlc19fZGV0YWlsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgIGRldGFpbFRyLnJlbW92ZUNsYXNzKFwic2EtZGF0YXRhYmxlc19fZGV0YWlsLXJvd1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgZGF0YSA9IHNlbGYuZGF0YVtyb3cuaW5kZXgoKV07XG4gICAgICAgICAgJChzZWxmLmNyZWF0ZURldGFpbE1hcmt1cChkYXRhLCByb3cpKS5pbnNlcnRBZnRlcihkZXRhaWxUcik7XG4gICAgICAgICAgZGV0YWlsVHIuYWRkQ2xhc3MoXCJzYS1kYXRhdGFibGVzX19kZXRhaWwtcm93XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IHRhYmxlTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcbiAgICB2YXIgY29sdW1ucyA9IHRoaXMuZ2V0Q29sdW1ucygpO1xuICAgIHZhciBjb2x1bW5zRGF0YTogYW55ID0gY29sdW1ucy5tYXAoKGM6IGFueSkgPT4gYy5kYXRhKTtcbiAgICBjb25zdCBkdEJ1dHRvbkNsYXNzID1cbiAgICAgIFwic2EtZGF0YXRhYmxlc19fYnV0dG9uIHNhLWRhdGF0YWJsZXNfX2J1dHRvbi0tc21hbGwgc2EtZGF0YXRhYmxlc19fYnV0dG9uLS1ncmF5XCI7XG4gICAgY29uc3Qgb3B0aW9ucyA9ICQuZXh0ZW5kKFxuICAgICAgdHJ1ZSxcbiAgICAgIHtcbiAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgIHsgZXh0ZW5kOiBcImNvcHlcIiwgY2xhc3NOYW1lOiBkdEJ1dHRvbkNsYXNzIH0sXG4gICAgICAgICAgeyBleHRlbmQ6IFwiY3N2XCIsIGNsYXNzTmFtZTogZHRCdXR0b25DbGFzcyB9LFxuICAgICAgICAgIHsgZXh0ZW5kOiBcInByaW50XCIsIGNsYXNzTmFtZTogZHRCdXR0b25DbGFzcyB9LFxuICAgICAgICBdLFxuICAgICAgICBkb206IFwiQmZwbHJ0aXBcIixcbiAgICAgICAgZGF0YTogdGhpcy50YWJsZURhdGEsXG4gICAgICAgIHBhZ2VMZW5ndGg6IDUsXG4gICAgICAgIGxlbmd0aE1lbnU6IFsxLCA1LCAxMCwgMjUsIDUwLCA3NSwgMTAwXSxcbiAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UsXG4gICAgICAgIHNjcm9sbFg6IHRydWUsXG4gICAgICAgIGNvbHVtbnM6IGNvbHVtbnMsXG4gICAgICAgIGNvbFJlb3JkZXI6IHtcbiAgICAgICAgICBmaXhlZENvbHVtbnNMZWZ0OiAxLFxuICAgICAgICAgIHJlYWx0aW1lOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgLy8gb3JkZXJGaXhlZDogW1sxLCBcImFzY1wiXV0sXG4gICAgICAgIHJvd0dyb3VwOiB7XG4gICAgICAgICAgZGF0YVNyYzogY29sdW1uc0RhdGFbMF0sXG4gICAgICAgICAgZW5kUmVuZGVyOiAocm93czogYW55LCBncm91cDogYW55KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gXCJDb3VudDogXCIgKyByb3dzLmRhdGEoKS5jb3VudCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGxhbmd1YWdlOiB7XG4gICAgICAgICAgc1NlYXJjaDogXCIgXCIsXG4gICAgICAgICAgc2VhcmNoUGxhY2Vob2xkZXI6IFwiU2VhcmNoLi4uXCIsXG4gICAgICAgICAgc0xlbmd0aE1lbnU6IFwiU2hvdyBfTUVOVV8gZW50cmllc1wiLFxuICAgICAgICAgIHBhZ2luYXRlOiB7XG4gICAgICAgICAgICBwcmV2aW91czogXCIgXCIsXG4gICAgICAgICAgICBuZXh0OiBcIiBcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IFwiYXBpXCIsXG4gICAgICAgIGhlYWRlckNhbGxiYWNrOiAoXG4gICAgICAgICAgdGhlYWQ6IGFueSxcbiAgICAgICAgICBkYXRhOiBhbnksXG4gICAgICAgICAgc3RhcnQ6IGFueSxcbiAgICAgICAgICBlbmQ6IGFueSxcbiAgICAgICAgICBkaXNwbGF5OiBhbnlcbiAgICAgICAgKSA9PiB7XG4gICAgICAgICAgdmFyIGRhdGF0YWJsZUFwaSA9ICQodGFibGVOb2RlKS5kYXRhVGFibGUoKS5hcGkoKTtcbiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgJCh0aGVhZClcbiAgICAgICAgICAgIC5jaGlsZHJlbihcInRoXCIpXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoaW5kZXg6IG51bWJlcikge1xuICAgICAgICAgICAgICB2YXIgJHRoTm9kZSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgIGlmICghIWNvbHVtbnNEYXRhW2luZGV4XSAmJiAkdGhOb2RlLmhhcyhcImJ1dHRvblwiKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gc2VsZi5jcmVhdGVBY3Rpb25Db250YWluZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmhlYWRlckJ1dHRvbkNyZWF0b3JzLmZvckVhY2goKGNyZWF0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gY3JlYXRvcihcbiAgICAgICAgICAgICAgICAgICAgZGF0YXRhYmxlQXBpLFxuICAgICAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uc0RhdGFbaW5kZXhdXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgaWYgKCEhZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb250YWluZXIuY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX19maWx0ZXItY29udGFpbmVyXCI7XG4gICAgICAgICAgICAgICAgZmlsdGVyQ29udGFpbmVyLmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgICBcIjxpbnB1dCB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nU2VhcmNoLi4uJyAvPlwiO1xuICAgICAgICAgICAgICAgIHZhciBjb2x1bW4gPSBkYXRhdGFibGVBcGkuY29sdW1uKGluZGV4KTtcbiAgICAgICAgICAgICAgICAkKFwiaW5wdXRcIiwgJChmaWx0ZXJDb250YWluZXIpKS5vbihcImNsaWNrXCIsIChlKSA9PlxuICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgJChcImlucHV0XCIsICQoZmlsdGVyQ29udGFpbmVyKSkub24oXCJrZXl1cCBjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gKDxIVE1MSW5wdXRFbGVtZW50PnRoaXMpLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbi5zZWFyY2goKSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLnNlYXJjaCh2YWx1ZSkuZHJhdyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHRoTm9kZS5wcmVwZW5kKGZpbHRlckNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgJHRoTm9kZS5wcmVwZW5kKGNvbnRhaW5lcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHRoaXMub3B0aW9uc1xuICAgICk7XG5cbiAgICB0aGlzLnRhcmdldE5vZGUuYXBwZW5kQ2hpbGQodGFibGVOb2RlKTtcbiAgICB0YWJsZU5vZGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICB0YWJsZU5vZGUuY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX190YWJsZSBkaXNwbGF5IHJlc3BvbnNpdmUgZGF0YVRhYmxlXCI7XG5cbiAgICBjb25zdCBkYXRhdGFibGVBcGlSZWYgPSAodGhpcy5kYXRhdGFibGVBcGkgPSAkKHRhYmxlTm9kZSkuRGF0YVRhYmxlKFxuICAgICAgb3B0aW9uc1xuICAgICkpO1xuICAgIGRhdGF0YWJsZUFwaVJlZi5wYWdlKHNlbGYuY3VycmVudFBhZ2VOdW1iZXIpO1xuICAgIHRoaXMuZGF0YXRhYmxlQXBpLnJvd0dyb3VwKCkuZW5hYmxlKGZhbHNlKS5kcmF3KGZhbHNlKTtcblxuICAgIC8vIHRoaXMuZGF0YXRhYmxlQXBpLm9uKFwicm93Z3JvdXAtZGF0YXNyY1wiLCAoZSwgZHQsIHZhbCkgPT4ge1xuICAgIC8vICAgdGhpcy5kYXRhdGFibGVBcGkub3JkZXIuZml4ZWQoeyBwcmU6IFtbY29sdW1uc0RhdGEuaW5kZXhPZih2YWwpLCBcImFzY1wiXV0gfSkuZHJhdygpO1xuICAgIC8vIH0pO1xuICAgIHZhciB0YXJnZXQgPSAkKHRoaXMudGFyZ2V0Tm9kZSkuZmluZChcIi5kYXRhVGFibGVzX2ZpbHRlclwiKTtcbiAgICB2YXIgYnV0dG9uID0gdGhpcy5jcmVhdGVBZGRDb2x1bW5CdXR0b24odGhpcy5kYXRhdGFibGVBcGkpO1xuICAgICQoYnV0dG9uKS5pbnNlcnRBZnRlcih0YXJnZXRbMF0pO1xuXG4gICAgZGF0YXRhYmxlQXBpUmVmLm9uKFxuICAgICAgXCJjb2x1bW4tcmVvcmRlclwiLFxuICAgICAgKGU6IGFueSwgc2V0dGluZ3M6IGFueSwgZGV0YWlsczogYW55KSA9PiB7XG4gICAgICAgIHZhciBkZWxldGVkQ29sdW1ucyA9IHRoaXMuX2NvbHVtbnMuc3BsaWNlKGRldGFpbHMuZnJvbSAtIDEsIDEpO1xuICAgICAgICB0aGlzLl9jb2x1bW5zLnNwbGljZShkZXRhaWxzLnRvIC0gMSwgMCwgZGVsZXRlZENvbHVtbnNbMF0pO1xuICAgICAgICB2YXIgaGVhZGVyQ2VsbCA9ICQoZGF0YXRhYmxlQXBpUmVmLmNvbHVtbihkZXRhaWxzLnRvKS5oZWFkZXIoKSk7XG4gICAgICAgIHRoaXMuc2V0TWlub3JDb2x1bW5zQnV0dG9uQ2FsbGJhY2soZGF0YXRhYmxlQXBpUmVmKTtcbiAgICAgICAgdGhpcy5vbkNvbHVtbnNDaGFuZ2VkKCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIHRoaXMuc2V0TWlub3JDb2x1bW5zQnV0dG9uQ2FsbGJhY2soZGF0YXRhYmxlQXBpUmVmKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVEZXRhaWxNYXJrdXAoZGF0YTogYW55LCBkYXRhdGFibGVzUm93OiBhbnkpOiBIVE1MRWxlbWVudFtdIHtcbiAgICAvLyB2YXIgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIik7XG4gICAgLy8gdGFibGUuY2VsbFBhZGRpbmcgPSBcIjVcIjtcbiAgICAvLyB0YWJsZS5jZWxsU3BhY2luZyA9IFwiMFwiO1xuICAgIC8vIHRhYmxlLmJvcmRlciA9IFwiMFwiO1xuICAgIC8vIHRhYmxlLmNsYXNzTmFtZSA9IFwic2EtZGF0YXRhYmxlc19fZGV0YWlsXCI7XG4gICAgdmFyIHJvd3M6IEhUTUxFbGVtZW50W10gPSBbXTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHZpc2libGVDb2xDb3VudCA9IHNlbGYuY29sdW1ucy5maWx0ZXIoXG4gICAgICAoY29sdW1uKSA9PlxuICAgICAgICBjb2x1bW4ubG9jYXRpb24gPT09IFF1ZXN0aW9uTG9jYXRpb24uQ29sdW1uICYmXG4gICAgICAgIHRoaXMuaXNWaXNpYmxlKGNvbHVtbi52aXNpYmlsaXR5KVxuICAgICkubGVuZ3RoO1xuICAgIHRoaXMuY29sdW1uc1xuICAgICAgLmZpbHRlcihcbiAgICAgICAgKGNvbHVtbikgPT5cbiAgICAgICAgICBjb2x1bW4ubG9jYXRpb24gPT09IFF1ZXN0aW9uTG9jYXRpb24uUm93ICYmXG4gICAgICAgICAgdGhpcy5pc1Zpc2libGUoY29sdW1uLnZpc2liaWxpdHkpXG4gICAgICApXG4gICAgICAuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG4gICAgICAgIHJvdy5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX2RldGFpbFwiO1xuICAgICAgICB2YXIgdGQxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgICAgICB0ZDEudGV4dENvbnRlbnQgPSBjb2x1bW4uZGlzcGxheU5hbWU7XG4gICAgICAgIHRkMS5jb2xTcGFuID0gMjtcbiAgICAgICAgdmFyIHRkMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcbiAgICAgICAgdGQyLnRleHRDb250ZW50ID0gZGF0YVtjb2x1bW4ubmFtZV07XG4gICAgICAgIHZhciB0ZDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgICAgIHRkMy5jb2xTcGFuID0gTWF0aC5tYXgodmlzaWJsZUNvbENvdW50IC0gMiwgMSk7XG4gICAgICAgIHNlbGYuZGV0YWlsQnV0dG9uQ3JlYXRvcnMuZm9yRWFjaCgoY3JlYXRvcikgPT5cbiAgICAgICAgICB0ZDMuYXBwZW5kQ2hpbGQoY3JlYXRvcihjb2x1bW4ubmFtZSkpXG4gICAgICAgICk7XG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0ZDEpO1xuICAgICAgICByb3cuYXBwZW5kQ2hpbGQodGQyKTtcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKHRkMyk7XG4gICAgICAgIHJvd3MucHVzaChyb3cpO1xuICAgICAgfSk7XG5cbiAgICAvLyBpZiAoISF0aGlzLmRhdGF0YWJsZUFwaSAmJiB0aGlzLmRhdGF0YWJsZUFwaS5yZXNwb25zaXZlLmhhc0hpZGRlbigpKSB7XG4gICAgLy8gICB2YXIgY29sdW1uc1Zpc2liaWxpdHkgPSB0aGlzLmRhdGF0YWJsZUFwaS5jb2x1bW5zKCkucmVzcG9uc2l2ZUhpZGRlbigpO1xuICAgIC8vICAgdmFyIGNvbHVtbnMgPSB0aGlzLmRhdGF0YWJsZUFwaS5zZXR0aW5ncygpLmluaXQoKS5jb2x1bW5zO1xuICAgIC8vICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGNvbHVtbnNWaXNpYmlsaXR5Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIC8vICAgICBpZiAoIWNvbHVtbnNWaXNpYmlsaXR5W2luZGV4XSkge1xuICAgIC8vICAgICAgIHZhciBjb2x1bW4gPSBjb2x1bW5zW2luZGV4XTtcbiAgICAvLyAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuICAgIC8vICAgICAgIHJvdy5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX2RldGFpbFwiO1xuXG4gICAgLy8gICAgICAgdmFyIHRkMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcbiAgICAvLyAgICAgICB0ZDEudGV4dENvbnRlbnQgPSBjb2x1bW4uc1RpdGxlO1xuICAgIC8vICAgICAgIHZhciB0ZDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgLy8gICAgICAgdGQyLnRleHRDb250ZW50ID0gZGF0YVtjb2x1bW4ubURhdGFdO1xuICAgIC8vICAgICAgIHZhciB0ZDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgLy8gICAgICAgLy90aGlzLmRldGFpbEJ1dHRvbkNyZWF0b3JzLmZvckVhY2goY3JlYXRvciA9PiB0ZDMuYXBwZW5kQ2hpbGQoY3JlYXRvcihjb2x1bW4ubURhdGEpKSk7XG4gICAgLy8gICAgICAgcm93LmFwcGVuZENoaWxkKHRkMSk7XG4gICAgLy8gICAgICAgcm93LmFwcGVuZENoaWxkKHRkMik7XG4gICAgLy8gICAgICAgcm93LmFwcGVuZENoaWxkKHRkMyk7XG4gICAgLy8gICAgICAgcm93cy5wdXNoKHJvdyk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cbiAgICBpZiAoISF0aGlzLnJlbmRlckRldGFpbEFjdGlvbnMpIHtcbiAgICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG4gICAgICByb3cuY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX19kZXRhaWxcIjtcbiAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcbiAgICAgIHRkLmNvbFNwYW4gPSB2aXNpYmxlQ29sQ291bnQgKyAxO1xuICAgICAgcm93LmFwcGVuZENoaWxkKHRkKTtcbiAgICAgIC8vIHZhciB0ZDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgICAvLyByb3cuYXBwZW5kQ2hpbGQodGQxKTtcbiAgICAgIC8vIHZhciB0ZDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgICAvLyByb3cuYXBwZW5kQ2hpbGQodGQyKTtcbiAgICAgIHJvd3MucHVzaChyb3cpO1xuICAgICAgdGhpcy5yZW5kZXJEZXRhaWxBY3Rpb25zKHRkLCBkYXRhLCBkYXRhdGFibGVzUm93KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcm93cztcbiAgfVxuXG4gIHB1YmxpYyBkb1N0YXRlU2F2ZSgpIHtcbiAgICB0aGlzLmRhdGF0YWJsZUFwaS5zdGF0ZS5zYXZlKCk7XG4gIH1cbiAgcHVibGljIHN0YXRlU2F2ZUNhbGxiYWNrKHNldHRpbmdzOiBhbnksIGRhdGE6IGFueSkge31cblxuICBwdWJsaWMgcmVuZGVyRGV0YWlsQWN0aW9uczogKFxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgZGF0YTogYW55LFxuICAgIGRhdGF0YWJsZXNSb3c6IGFueVxuICApID0+IEhUTUxFbGVtZW50O1xuXG4gIHB1YmxpYyBoZWFkZXJCdXR0b25DcmVhdG9yczogQXJyYXk8XG4gICAgKGRhdGF0YWJsZUFwaTogYW55LCBjb2xJZHg6IG51bWJlciwgY29sdW1uTmFtZTogc3RyaW5nKSA9PiBIVE1MRWxlbWVudFxuICA+ID0gW107XG5cbiAgcHVibGljIGRldGFpbEJ1dHRvbkNyZWF0b3JzOiBBcnJheTwoY29sdW1uTmFtZT86IHN0cmluZykgPT4gSFRNTEVsZW1lbnQ+ID0gW107XG5cbiAgY3JlYXRlU2VsZWN0QnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogbnVtYmVyLFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24uaW5uZXJIVE1MID0gbG9jYWxpemF0aW9uLmdldFN0cmluZyhcInNlbGVjdEJ1dHRvblwiKTtcbiAgICBidXR0b24ub25jbGljayA9IChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgKDxhbnk+ZGF0YXRhYmxlQXBpLmNvbHVtbnMoKSkuZGVzZWxlY3QoKTtcbiAgICAgICg8YW55PmRhdGF0YWJsZUFwaS5jb2x1bW4oY29sSWR4KSkuc2VsZWN0KCk7XG4gICAgICAhIXRoaXMub25Db2x1bW5TZWxlY3RlZCAmJiB0aGlzLm9uQ29sdW1uU2VsZWN0ZWQoY29sdW1uTmFtZSk7XG4gICAgfTtcbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuXG4gIGNyZWF0ZUdyb3VwaW5nQnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogbnVtYmVyLFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24uaW5uZXJIVE1MID0gbG9jYWxpemF0aW9uLmdldFN0cmluZyhcImdyb3VwQnV0dG9uXCIpO1xuXG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdyb3VwQnkuaW5kZXhPZihjb2x1bW5OYW1lKTtcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgdGhpcy5ncm91cEJ5LnB1c2goY29sdW1uTmFtZSk7XG4gICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwidW5ncm91cEJ1dHRvblwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiZ3JvdXBCdXR0b25cIik7XG4gICAgICAgIHRoaXMuZ3JvdXBCeS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgfVxuXG4gICAgICBkYXRhdGFibGVBcGkucm93R3JvdXAoKS5lbmFibGUodGhpcy5ncm91cEJ5Lmxlbmd0aCA+IDApO1xuICAgICAgaWYgKHRoaXMuZ3JvdXBCeS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRhdGF0YWJsZUFwaS5yb3dHcm91cCgpLmRhdGFTcmMoPGFueT50aGlzLmdyb3VwQnkpO1xuICAgICAgfVxuICAgICAgZGF0YXRhYmxlQXBpLmRyYXcoZmFsc2UpO1xuICAgIH07XG5cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuICBjcmVhdGVTdmdFbGVtZW50ID0gKHBhdGg6IHN0cmluZyk6IFNWR0VsZW1lbnQgPT4ge1xuICAgIHZhciBzdmdFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJzdmdcIik7XG4gICAgY29uc3QgdXNlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcbiAgICAgIFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIixcbiAgICAgIFwidXNlXCJcbiAgICApO1xuICAgIHVzZUVsZW0uc2V0QXR0cmlidXRlTlMoXG4gICAgICBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIixcbiAgICAgIFwiaHJlZlwiLFxuICAgICAgXCIjc2Etc3ZnLVwiICsgcGF0aFxuICAgICk7XG4gICAgc3ZnRWxlbS5hcHBlbmRDaGlsZCh1c2VFbGVtKTtcbiAgICByZXR1cm4gc3ZnRWxlbTtcbiAgfTtcblxuICBjcmVhdGVIaWRlQnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogbnVtYmVyLFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24udGl0bGUgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiaGlkZUNvbHVtblwiKTtcbiAgICBidXR0b24uY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX19zdmctYnV0dG9uXCI7XG4gICAgYnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlU3ZnRWxlbWVudChcImhpZGVcIikpO1xuICAgIGJ1dHRvbi5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIHRoaXMuX2NvbHVtbnMuZmlsdGVyKFxuICAgICAgICAoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSA9PT0gY29sdW1uTmFtZVxuICAgICAgKVswXS52aXNpYmlsaXR5ID0gQ29sdW1uVmlzaWJpbGl0eS5JbnZpc2libGU7XG4gICAgICBkYXRhdGFibGVBcGkuY29sdW1ucyhbY29sSWR4XSkudmlzaWJsZShmYWxzZSk7XG5cbiAgICAgIC8vIFRPRE86IFVzZSBkYXRhdGFibGVzIHRvIHVwZGF0ZSBoZWFkZXJzIChzaG93IGNvbHVtbnMgb3B0aW9ucylcbiAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICAgIHRoaXMub25Db2x1bW5zQ2hhbmdlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuXG4gIGNyZWF0ZUNvbHVtblByaXZhdGVCdXR0b24gPSAoXG4gICAgZGF0YXRhYmxlQXBpOiBhbnksXG4gICAgY29sSWR4OiBudW1iZXIsXG4gICAgY29sdW1uTmFtZTogc3RyaW5nXG4gICk6IEhUTUxFbGVtZW50ID0+IHtcbiAgICBjb25zdCBjb2x1bW4gPSB0aGlzLl9jb2x1bW5zLmZpbHRlcihcbiAgICAgIChjb2x1bW4pID0+IGNvbHVtbi5uYW1lID09PSBjb2x1bW5OYW1lXG4gICAgKVswXTtcbiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIGNvbnN0IG1ha2VQcml2YXRlU3ZnID0gdGhpcy5jcmVhdGVTdmdFbGVtZW50KFwibWFrZXByaXZhdGVcIik7XG4gICAgY29uc3QgbWFrZVB1YmxpY1N2ZyA9IHRoaXMuY3JlYXRlU3ZnRWxlbWVudChcIm1ha2VwdWJsaWNcIik7XG4gICAgdXBkYXRlU3RhdGUoY29sdW1uLnZpc2liaWxpdHkpO1xuICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChtYWtlUHJpdmF0ZVN2Zyk7XG4gICAgYnV0dG9uLmFwcGVuZENoaWxkKG1ha2VQdWJsaWNTdmcpO1xuICAgIGJ1dHRvbi5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIGlmIChjb2x1bW4udmlzaWJpbGl0eSA9PT0gQ29sdW1uVmlzaWJpbGl0eS5QdWJsaWNJbnZpc2libGUpIHtcbiAgICAgICAgY29sdW1uLnZpc2liaWxpdHkgPSBDb2x1bW5WaXNpYmlsaXR5LlZpc2libGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2x1bW4udmlzaWJpbGl0eSA9IENvbHVtblZpc2liaWxpdHkuUHVibGljSW52aXNpYmxlO1xuICAgICAgfVxuXG4gICAgICB1cGRhdGVTdGF0ZShjb2x1bW4udmlzaWJpbGl0eSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHZpc2liaWxpdHk6IENvbHVtblZpc2liaWxpdHkpIHtcbiAgICAgIGNvbnN0IGlzUHJpdmF0ZSA9IHZpc2liaWxpdHkgPT09IENvbHVtblZpc2liaWxpdHkuUHVibGljSW52aXNpYmxlO1xuICAgICAgaWYgKGlzUHJpdmF0ZSkge1xuICAgICAgICBidXR0b24uY2xhc3NOYW1lID1cbiAgICAgICAgICBcInNhLWRhdGF0YWJsZXNfX3N2Zy1idXR0b24gc2EtZGF0YXRhYmxlc19fc3ZnLWJ1dHRvbi0tYWN0aXZlXCI7XG4gICAgICAgIGJ1dHRvbi50aXRsZSA9IGxvY2FsaXphdGlvbi5nZXRTdHJpbmcoXCJtYWtlUHVibGljQ29sdW1uXCIpO1xuICAgICAgICBtYWtlUHJpdmF0ZVN2Zy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICBtYWtlUHVibGljU3ZnLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX3N2Zy1idXR0b25cIjtcbiAgICAgICAgYnV0dG9uLnRpdGxlID0gbG9jYWxpemF0aW9uLmdldFN0cmluZyhcIm1ha2VQcml2YXRlQ29sdW1uXCIpO1xuICAgICAgICBtYWtlUHJpdmF0ZVN2Zy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIG1ha2VQdWJsaWNTdmcuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuXG4gIGNyZWF0ZUFkZENvbHVtbkJ1dHRvbiA9IChkYXRhdGFibGVBcGk6IGFueSk6IEhUTUxFbGVtZW50ID0+IHtcbiAgICBjb25zdCBzZWxlY3RvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgc2VsZWN0b3IuY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX19hZGQtY29sdW1uXCI7XG4gICAgc2VsZWN0b3Iub25jbGljayA9IChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH07XG5cbiAgICB2YXIgaGlkZGVuQ29sdW1ucyA9IHRoaXMuY29sdW1ucy5maWx0ZXIoXG4gICAgICAoY29sdW1uKSA9PiBjb2x1bW4udmlzaWJpbGl0eSA9PT0gQ29sdW1uVmlzaWJpbGl0eS5JbnZpc2libGVcbiAgICApO1xuXG4gICAgaWYgKGhpZGRlbkNvbHVtbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gICAgb3B0aW9uLnRleHQgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwic2hvd0NvbHVtblwiKTtcbiAgICBvcHRpb24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgc2VsZWN0b3IuYXBwZW5kQ2hpbGQob3B0aW9uKTtcblxuICAgIGhpZGRlbkNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIHZhciB0ZXh0ID0gY29sdW1uLmRpc3BsYXlOYW1lO1xuICAgICAgaWYgKHRleHQubGVuZ3RoID4gMjApIHtcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIDIwKSArIFwiLi4uXCI7XG4gICAgICB9XG4gICAgICBvcHRpb24udGV4dCA9IHRleHQ7XG4gICAgICBvcHRpb24udGl0bGUgPSBjb2x1bW4uZGlzcGxheU5hbWU7XG4gICAgICBvcHRpb24udmFsdWUgPSBjb2x1bW4ubmFtZTtcbiAgICAgIHNlbGVjdG9yLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgfSk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZWN0b3Iub25jaGFuZ2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmICghJCh0aGlzKS52YWwoKSkgcmV0dXJuO1xuXG4gICAgICB2YXIgY29sdW1uID0gc2VsZi5fY29sdW1ucy5maWx0ZXIoXG4gICAgICAgIChjb2x1bW4pID0+IGNvbHVtbi5uYW1lID09PSAkKHRoaXMpLnZhbCgpXG4gICAgICApWzBdO1xuICAgICAgY29sdW1uLnZpc2liaWxpdHkgPSBDb2x1bW5WaXNpYmlsaXR5LlZpc2libGU7XG4gICAgICBkYXRhdGFibGVBcGkuY29sdW1uKGNvbHVtbi5uYW1lICsgXCI6bmFtZVwiKS52aXNpYmxlKHRydWUpO1xuXG4gICAgICAvLyBUT0RPOiBVc2UgZGF0YXRhYmxlcyB0byB1cGRhdGUgaGVhZGVycyAoc2hvdyBjb2x1bW5zIG9wdGlvbnMpXG4gICAgICBzZWxmLnVwZGF0ZSgpO1xuXG4gICAgICBzZWxmLm9uQ29sdW1uc0NoYW5nZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHNlbGVjdG9yO1xuICB9O1xuICBjcmVhdGVEcmFnQnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogYW55LFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24uY2xhc3NOYW1lID0gXCJzYS1kYXRhdGFibGVzX19zdmctYnV0dG9uIHNhLWRhdGF0YWJsZXNfX2RyYWctYnV0dG9uXCI7XG4gICAgYnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlU3ZnRWxlbWVudChcImRyYWdcIikpO1xuICAgIGJ1dHRvbi5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfTtcbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuICBjcmVhdGVTb3J0QnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogYW55LFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBjb25zdCBkZXNjVGl0bGUgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiZGVzY09yZGVyXCIpO1xuICAgIGNvbnN0IGFzY1RpdGxlID0gbG9jYWxpemF0aW9uLmdldFN0cmluZyhcImFzY09yZGVyXCIpO1xuICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX3N2Zy1idXR0b25cIjtcbiAgICBidXR0b24udGl0bGUgPSBhc2NUaXRsZTtcbiAgICBidXR0b24uYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVTdmdFbGVtZW50KFwic29ydGluZ1wiKSk7XG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgYnV0dG9uLnRpdGxlID0gYnV0dG9uLnRpdGxlID09IGFzY1RpdGxlID8gZGVzY1RpdGxlIDogYXNjVGl0bGU7XG4gICAgfTtcbiAgICBidXR0b24ub25kcmFnID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uO1xuICAgIH07XG4gICAgcmV0dXJuIGJ1dHRvbjtcbiAgfTtcbiAgY3JlYXRlTW92ZVRvRGV0YWlsQnV0dG9uID0gKFxuICAgIGRhdGF0YWJsZUFwaTogYW55LFxuICAgIGNvbElkeDogbnVtYmVyLFxuICAgIGNvbHVtbk5hbWU6IHN0cmluZ1xuICApOiBIVE1MRWxlbWVudCA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24udGl0bGUgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwibW92ZVRvRGV0YWlsXCIpO1xuICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX3N2Zy1idXR0b25cIjtcbiAgICBidXR0b24uYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVTdmdFbGVtZW50KFwibW92ZXRvZGV0YWlsc1wiKSk7XG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgdGhpcy5fY29sdW1ucy5maWx0ZXIoKGNvbHVtbikgPT4gY29sdW1uLm5hbWUgPT09IGNvbHVtbk5hbWUpWzBdLmxvY2F0aW9uID1cbiAgICAgICAgUXVlc3Rpb25Mb2NhdGlvbi5Sb3c7XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuXG4gICAgICB0aGlzLm9uQ29sdW1uc0NoYW5nZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGJ1dHRvbjtcbiAgfTtcblxuICBjcmVhdGVTaG93QXNDb2x1bW5CdXR0b24gPSAoY29sdW1uTmFtZT86IHN0cmluZyk6IEhUTUxFbGVtZW50ID0+IHtcbiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwic2hvd0FzQ29sdW1uXCIpO1xuICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcInNhLWRhdGF0YWJsZXNfX2J1dHRvbiBzYS1kYXRhdGFibGVzX19idXR0b24tLWdyYXlcIjtcbiAgICBidXR0b24ub25jbGljayA9IChlKSA9PiB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICB0aGlzLl9jb2x1bW5zLmZpbHRlcigoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSA9PT0gY29sdW1uTmFtZSlbMF0ubG9jYXRpb24gPVxuICAgICAgICBRdWVzdGlvbkxvY2F0aW9uLkNvbHVtbjtcbiAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICAgIHRoaXMub25Db2x1bW5zQ2hhbmdlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9O1xuICBnZXRDb2x1bW5zKCk6IEFycmF5PE9iamVjdD4ge1xuICAgIGNvbnN0IGF2YWlsYWJsZUNvbHVtbnMgPSB0aGlzLmdldEF2YWlsYWJsZUNvbHVtbnMoKTtcbiAgICBjb25zdCBjb2x1bW5zOiBhbnkgPSBhdmFpbGFibGVDb2x1bW5zLm1hcCgoY29sdW1uLCBpbmRleCkgPT4ge1xuICAgICAgdmFyIHF1ZXN0aW9uID0gdGhpcy5zdXJ2ZXkuZ2V0UXVlc3Rpb25CeU5hbWUoY29sdW1uLm5hbWUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YTogY29sdW1uLm5hbWUsXG4gICAgICAgIHNUaXRsZTogKHF1ZXN0aW9uICYmIHF1ZXN0aW9uLnRpdGxlKSB8fCBjb2x1bW4uZGlzcGxheU5hbWUsXG4gICAgICAgIHZpc2libGU6IGNvbHVtbi52aXNpYmlsaXR5ICE9PSBDb2x1bW5WaXNpYmlsaXR5LkludmlzaWJsZSxcbiAgICAgICAgbVJlbmRlcjogKGRhdGE6IG9iamVjdCwgdHlwZTogc3RyaW5nLCByb3c6IGFueSkgPT4ge1xuICAgICAgICAgIHZhciB2YWx1ZSA9IHJvd1tjb2x1bW4ubmFtZV07XG4gICAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgPyAkKFwiPGRpdj5cIikudGV4dCh2YWx1ZSkuaHRtbCgpXG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBjbGFzc05hbWU6IFwic2EtZGF0YXRhYmxlc19fYWN0aW9uLWNvbHVtblwiLFxuICAgICAgICBvcmRlcmFibGU6IGZhbHNlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBkZWZhdWx0Q29udGVudDogdGhpcy5jcmVhdGVNaW5vckNvbHVtbnNCdXR0b24oKS5vdXRlckhUTUwsXG4gICAgICB9LFxuICAgIF0uY29uY2F0KGNvbHVtbnMpO1xuICB9XG5cbiAgcHVibGljIG9uQ29sdW1uU2VsZWN0ZWQ6IChkYXRhTmFtZTogc3RyaW5nKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyBsYXlvdXQoKSB7XG4gICAgISF0aGlzLmRhdGF0YWJsZUFwaSAmJiB0aGlzLmRhdGF0YWJsZUFwaS5jb2x1bW5zLmFkanVzdCgpO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdGFibGVzL2RhdGF0YWJsZXMudHMiLCJpbXBvcnQgeyBUYWJsZSB9IGZyb20gXCIuL3RhYmxlXCI7XG5pbXBvcnQgeyBTdXJ2ZXlNb2RlbCB9IGZyb20gXCJzdXJ2ZXktY29yZVwiO1xuaW1wb3J0IHsgQ29sdW1uVmlzaWJpbGl0eSwgUXVlc3Rpb25Mb2NhdGlvbiB9IGZyb20gXCIuL2NvbmZpZ1wiO1xuaW1wb3J0IHsgbG9jYWxpemF0aW9uIH0gZnJvbSBcIi4uL2xvY2FsaXphdGlvbk1hbmFnZXJcIjtcblxuaW1wb3J0IFwiLi90YWJ1bGF0b3Iuc2Nzc1wiO1xuXG5jb25zdCBUYWJ1bGF0b3JUYWJsZXMgPSByZXF1aXJlKFwidGFidWxhdG9yLXRhYmxlc1wiKTtcblxuaWYgKCEhZG9jdW1lbnQpIHtcbiAgY29uc3Qgc3ZnVGVtcGxhdGUgPSByZXF1aXJlKFwiaHRtbC1sb2FkZXI/aW50ZXJwb2xhdGUhdmFsLWxvYWRlciEuLi9zdmdidW5kbGUuaHRtbFwiKTtcbiAgY29uc3QgdGVtcGxhdGVIb2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICB0ZW1wbGF0ZUhvbGRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIHRlbXBsYXRlSG9sZGVyLmlubmVySFRNTCA9IHN2Z1RlbXBsYXRlO1xuICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRlbXBsYXRlSG9sZGVyKTtcbn1cblxuZXhwb3J0IGNsYXNzIFRhYnVsYXRvciBleHRlbmRzIFRhYmxlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgdGFyZ2V0Tm9kZTogSFRNTEVsZW1lbnQsXG4gICAgc3VydmV5OiBTdXJ2ZXlNb2RlbCxcbiAgICBkYXRhOiBBcnJheTxPYmplY3Q+LFxuICAgIG9wdGlvbnM6IGFueSxcbiAgICBfY29sdW1uczogQXJyYXk8YW55PiA9IFtdLFxuICAgIGlzVHJ1c3RlZEFjY2VzcyA9IGZhbHNlXG4gICkge1xuICAgIHN1cGVyKHRhcmdldE5vZGUsIHN1cnZleSwgZGF0YSwgb3B0aW9ucywgX2NvbHVtbnMsIGlzVHJ1c3RlZEFjY2Vzcyk7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgdGFyZ2V0Tm9kZS5jbGFzc05hbWUgKz0gXCJzYS10YWJ1bGF0b3JcIjtcbiAgICBpZiAoX2NvbHVtbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBzZWxmLl9jb2x1bW5zID0gc2VsZi5idWlsZENvbHVtbnMoc3VydmV5KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRhYnVsYXRvclRhYmxlczogYW55ID0gbnVsbDtcbiAgcHJpdmF0ZSB0b29sc0NvbnRhaW5lcjogSFRNTEVsZW1lbnQgPSBudWxsO1xuICBwcml2YXRlIHRhYmxlQ29udGFpbmVyOiBIVE1MRWxlbWVudCA9IG51bGw7XG5cbiAgcHVibGljIHJlbmRlciA9ICgpID0+IHtcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5nZXRDb2x1bW5zKCk7XG4gICAgY29uc3QgZGF0YSA9IHRoaXMudGFibGVEYXRhO1xuXG4gICAgdGhpcy50b29sc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy50YWJsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICB0aGlzLnRhcmdldE5vZGUuaW5uZXJIVE1MID0gXCJcIjtcbiAgICB0aGlzLnRhcmdldE5vZGUuYXBwZW5kQ2hpbGQodGhpcy50b29sc0NvbnRhaW5lcik7XG4gICAgdGhpcy50YXJnZXROb2RlLmFwcGVuZENoaWxkKHRoaXMudGFibGVDb250YWluZXIpO1xuXG4gICAgdGhpcy50YWJ1bGF0b3JUYWJsZXMgPSBuZXcgVGFidWxhdG9yVGFibGVzKHRoaXMudGFibGVDb250YWluZXIsIHtcbiAgICAgIGRhdGEsXG4gICAgICBsYXlvdXQ6IFwiZml0Q29sdW1uc1wiLFxuICAgICAgcGFnaW5hdGlvbjogXCJsb2NhbFwiLFxuICAgICAgcGFnaW5hdGlvblNpemU6IDUsXG4gICAgICBtb3ZhYmxlQ29sdW1uczogdHJ1ZSxcbiAgICAgIGNvbHVtbnMsXG4gICAgICByb3dGb3JtYXR0ZXI6IHRoaXMucm93Rm9ybWF0dGVyLFxuICAgIH0pO1xuXG4gICAgdGhpcy5yZW5kZXJUb29scygpO1xuICB9O1xuXG4gIHJlbmRlclRvb2xzID0gKCkgPT4ge1xuICAgIGNvbnN0IHRvb2xzQ29udGFpbmVyID0gdGhpcy50b29sc0NvbnRhaW5lcjtcbiAgICBjb25zdCBzaG93Q29sdW1uRHJvcGRvd24gPSB0aGlzLmdldFNob3dDb2x1bW5Ecm9wZG93bigpO1xuXG4gICAgdG9vbHNDb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgIHRvb2xzQ29udGFpbmVyLmFwcGVuZENoaWxkKHNob3dDb2x1bW5Ecm9wZG93bik7XG4gIH07XG5cbiAgZ2V0U2hvd0NvbHVtbkRyb3Bkb3duID0gKCk6IEhUTUxFbGVtZW50ID0+IHtcbiAgICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG5cbiAgICB2YXIgaGlkZGVuQ29sdW1ucyA9IHRoaXMuY29sdW1ucy5maWx0ZXIoXG4gICAgICAoY29sdW1uKSA9PiBjb2x1bW4udmlzaWJpbGl0eSA9PT0gQ29sdW1uVmlzaWJpbGl0eS5JbnZpc2libGVcbiAgICApO1xuXG4gICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gICAgb3B0aW9uLnRleHQgPSBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwic2hvd0NvbHVtblwiKTtcbiAgICBvcHRpb24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgZHJvcGRvd24uYXBwZW5kQ2hpbGQob3B0aW9uKTtcblxuICAgIGhpZGRlbkNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIHZhciB0ZXh0ID0gY29sdW1uLmRpc3BsYXlOYW1lO1xuICAgICAgaWYgKHRleHQubGVuZ3RoID4gMjApIHtcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIDIwKSArIFwiLi4uXCI7XG4gICAgICB9XG4gICAgICBvcHRpb24udGV4dCA9IHRleHQ7XG4gICAgICBvcHRpb24udGl0bGUgPSBjb2x1bW4uZGlzcGxheU5hbWU7XG4gICAgICBvcHRpb24udmFsdWUgPSBjb2x1bW4ubmFtZTtcbiAgICAgIGRyb3Bkb3duLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgfSk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgZHJvcGRvd24ub25jaGFuZ2UgPSBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgICBjb25zdCB2YWwgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAoIXZhbCkgcmV0dXJuO1xuXG4gICAgICB2YXIgY29sdW1uID0gc2VsZi5fY29sdW1ucy5maWx0ZXIoKGNvbHVtbikgPT4gY29sdW1uLm5hbWUgPT09IHZhbClbMF07XG4gICAgICBjb2x1bW4udmlzaWJpbGl0eSA9IENvbHVtblZpc2liaWxpdHkuVmlzaWJsZTtcbiAgICAgIHNlbGYudGFidWxhdG9yVGFibGVzLnRvZ2dsZUNvbHVtbihjb2x1bW4ubmFtZSk7XG4gICAgICBzZWxmLnVwZGF0ZSgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gZHJvcGRvd247XG4gIH07XG5cbiAgcHVibGljIGRlc3Ryb3kgPSAoKSA9PiB7XG4gICAgdGhpcy50YWJ1bGF0b3JUYWJsZXMuZGVzdHJveSgpO1xuICAgIHRoaXMudGFyZ2V0Tm9kZS5pbm5lckhUTUwgPSBcIlwiO1xuICB9O1xuXG4gIHB1YmxpYyB1cGRhdGUoKSB7XG4gICAgdGhpcy5yZW5kZXJUb29scygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHJvd0Zvcm1hdHRlcihyb3c6IGFueSkge1xuICAgIHZhciBzcGVjaWFsQ29sdW1uRWxlbWVudCA9IHJvdy5nZXRDZWxscygpWzBdLmdldEVsZW1lbnQoKTtcbiAgICB2YXIgaGlkZGVuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBoaWRkZW4uaW5uZXJIVE1MID0gXCI8cD5oaWRkZW4gaW5mbzwvcD5cIjtcbiAgICBoaWRkZW4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgc3BlY2lhbENvbHVtbkVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChoaWRkZW4uc3R5bGUuZGlzcGxheSA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgaGlkZGVuLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoaWRkZW4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgfVxuXG4gICAgICByb3cubm9ybWFsaXplSGVpZ2h0KCk7IC8vcmVjYWxjdWxhdGUgdGhlIHJvdyBoZWlnaHRcbiAgICB9O1xuXG4gICAgcm93LmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZChoaWRkZW4pO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFRpdGxlRm9ybWF0dGVyID0gKFxuICAgIGNlbGw6IGFueSxcbiAgICBmb3JtYXR0ZXJQYXJhbXM6IGFueSxcbiAgICBvblJlbmRlcmVkOiBhbnksXG4gICAgY29sdW1uTmFtZTogYW55XG4gICkgPT4ge1xuICAgIC8vYnVpbGQgZHJvcGRvd25cbiAgICB2YXIgaGlkZUNvbHVtbkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgaGlkZUNvbHVtbkJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIGhpZGVDb2x1bW5CdG4uaW5uZXJIVE1MID0gXCI8c3Bhbj4gaGlkZSA8L3NwYW4+XCI7XG4gICAgaGlkZUNvbHVtbkJ0bi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy5fY29sdW1ucy5maWx0ZXIoXG4gICAgICAgIChjb2x1bW4pID0+IGNvbHVtbi5uYW1lID09PSBjb2x1bW5OYW1lXG4gICAgICApWzBdLnZpc2liaWxpdHkgPSBDb2x1bW5WaXNpYmlsaXR5LkludmlzaWJsZTtcbiAgICAgIHRoaXMudGFidWxhdG9yVGFibGVzLnRvZ2dsZUNvbHVtbihjb2x1bW5OYW1lKTtcbiAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfTtcblxuICAgIC8vc2V0IGhlYWRlciB0aXRsZVxuICAgIHZhciB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGl0bGUuc3R5bGUuaGVpZ2h0ID0gXCI1MHB4XCI7XG4gICAgdGl0bGUuaW5uZXJIVE1MID0gY2VsbC5nZXRWYWx1ZSgpO1xuXG4gICAgLy9hZGQgbWVudSB0byB0aXRsZVxuICAgIHRpdGxlLmFwcGVuZENoaWxkKGhpZGVDb2x1bW5CdG4pO1xuXG4gICAgcmV0dXJuIHRpdGxlO1xuICB9O1xuXG4gIHByb3RlY3RlZCBnZXRDb2x1bW5zID0gKCkgPT4ge1xuICAgIGNvbnN0IGF2YWlsYWJsZUNvbHVtbnMgPSB0aGlzLmdldEF2YWlsYWJsZUNvbHVtbnMoKTtcbiAgICBjb25zdCBjb2x1bW5zOiBhbnkgPSBhdmFpbGFibGVDb2x1bW5zLm1hcCgoY29sdW1uLCBpbmRleCkgPT4ge1xuICAgICAgdmFyIHF1ZXN0aW9uID0gdGhpcy5zdXJ2ZXkuZ2V0UXVlc3Rpb25CeU5hbWUoY29sdW1uLm5hbWUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZmllbGQ6IGNvbHVtbi5uYW1lLFxuICAgICAgICB0aXRsZTogKHF1ZXN0aW9uICYmIHF1ZXN0aW9uLnRpdGxlKSB8fCBjb2x1bW4uZGlzcGxheU5hbWUsXG4gICAgICAgIHZpc2libGU6IGNvbHVtbi52aXNpYmlsaXR5ICE9PSBDb2x1bW5WaXNpYmlsaXR5LkludmlzaWJsZSxcbiAgICAgICAgaGVhZGVyRmlsdGVyOiB0cnVlLFxuICAgICAgICB0aXRsZUZvcm1hdHRlcjogKGNlbGw6IGFueSwgZm9ybWF0dGVyUGFyYW1zOiBhbnksIG9uUmVuZGVyZWQ6IGFueSkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdldFRpdGxlRm9ybWF0dGVyKFxuICAgICAgICAgICAgY2VsbCxcbiAgICAgICAgICAgIGZvcm1hdHRlclBhcmFtcyxcbiAgICAgICAgICAgIG9uUmVuZGVyZWQsXG4gICAgICAgICAgICBjb2x1bW4ubmFtZVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8gYWRkIHNwZWNpYWwgY29sdW1uIChjb2xsYXBzZS9leHBhbmQpXG4gICAgY29sdW1ucy51bnNoaWZ0KHtcbiAgICAgIGZpZWxkOiBcIlwiLFxuICAgICAgdGl0bGU6IFwiXCIsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29sdW1ucztcbiAgfTtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy90YWJsZXMvdGFidWxhdG9yLnRzIiwiaW1wb3J0IHsgUXVlc3Rpb24gfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcclxuaW1wb3J0IHsgVmlzdWFsaXplckJhc2UgfSBmcm9tIFwiLi92aXN1YWxpemVyQmFzZVwiO1xyXG5pbXBvcnQgeyBWaXN1YWxpemF0aW9uTWFuYWdlciB9IGZyb20gXCIuL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XHJcblxyXG5pbXBvcnQgXCIuL3RleHQuc2Nzc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFRleHQgZXh0ZW5kcyBWaXN1YWxpemVyQmFzZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCxcclxuICAgIHF1ZXN0aW9uOiBRdWVzdGlvbixcclxuICAgIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4sXHJcbiAgICBvcHRpb25zPzogT2JqZWN0XHJcbiAgKSB7XHJcbiAgICBzdXBlcih0YXJnZXRFbGVtZW50LCBxdWVzdGlvbiwgZGF0YSwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG5hbWUoKSB7XHJcbiAgICByZXR1cm4gXCJ0ZXh0XCI7XHJcbiAgfVxyXG5cclxuICBnZXREYXRhKCkge1xyXG4gICAgbGV0IHJlc3VsdDogQXJyYXk8QXJyYXk8c3RyaW5nPj4gPSBbXTtcclxuICAgIGxldCBjb2x1bW5zQ291bnQgPSAwO1xyXG5cclxuICAgIHRoaXMuZGF0YS5mb3JFYWNoKHJvdyA9PiB7XHJcbiAgICAgIGNvbnN0IHJvd1ZhbHVlOiBhbnkgPSByb3dbdGhpcy5xdWVzdGlvbi5uYW1lXTtcclxuICAgICAgY29uc3QgZGF0YVN0cmluZ3M6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuICAgICAgaWYgKCEhcm93VmFsdWUpIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyb3dWYWx1ZSkpIHtcclxuICAgICAgICAgIGRhdGFTdHJpbmdzLmNvbmNhdChyb3dWYWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmICh0eXBlb2Ygcm93VmFsdWUgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMocm93VmFsdWUpLmZvckVhY2goa2V5ID0+IGRhdGFTdHJpbmdzLnB1c2gocm93VmFsdWVba2V5XSkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGF0YVN0cmluZ3MucHVzaChyb3dWYWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc3VsdC5wdXNoKGRhdGFTdHJpbmdzKTtcclxuICAgICAgICBpZihkYXRhU3RyaW5ncy5sZW5ndGggPiBjb2x1bW5zQ291bnQpIHtcclxuICAgICAgICAgICAgY29sdW1uc0NvdW50ID0gZGF0YVN0cmluZ3MubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHsgY29sdW1uc0NvdW50LCBkYXRhOiByZXN1bHQgfTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCByZW5kZXJDb250ZW50KGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgIGNvbnN0IHsgY29sdW1uc0NvdW50LCBkYXRhfSAgPSB0aGlzLmdldERhdGEoKTtcclxuICAgIGNvbnN0IGVtcHR5VGV4dE5vZGUgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICBlbXB0eVRleHROb2RlLmlubmVySFRNTCA9IFwiVGhlcmUgYXJlIG5vIHJlc3VsdHMgeWV0XCI7XHJcblxyXG4gICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVtcHR5VGV4dE5vZGUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGFibGVOb2RlID0gPEhUTUxUYWJsZUVsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xyXG4gICAgdGFibGVOb2RlLmNsYXNzTmFtZSA9IFwic2EtdGV4dC10YWJsZVwiO1xyXG4gICAgdGFibGVOb2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRoaXMuYmFja2dyb3VuZENvbG9yO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlTm9kZSk7XHJcblxyXG4gICAgZGF0YS5mb3JFYWNoKHJvd0RhdGEgPT4ge1xyXG4gICAgICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNvbHVtbnNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gXCJzYS10ZXh0LXRhYmxlX19jZWxsXCI7XHJcbiAgICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gcm93RGF0YVtpXTtcclxuICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHRkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFibGVOb2RlLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzYS10ZXh0LXRhYmxlX19jb250YWluZXJcIjtcclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWJsZU5vZGUpO1xyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHN1cGVyLmRlc3Ryb3koKTtcclxuICAgIHRoaXMudGFyZ2V0RWxlbWVudC5jbGFzc05hbWUgPSBcIlwiO1xyXG4gIH1cclxufVxyXG5cclxuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwidGV4dFwiLCBUZXh0KTtcclxuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwiY29tbWVudFwiLCBUZXh0KTtcclxuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwibXVsdGlwbGV0ZXh0XCIsIFRleHQpO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdGV4dC50cyIsImltcG9ydCB7IFZpc3VhbGl6YXRpb25NYW5hZ2VyIH0gZnJvbSBcIi4vdmlzdWFsaXphdGlvbk1hbmFnZXJcIjtcbmltcG9ydCB7IFF1ZXN0aW9uLCBRdWVzdGlvbk1hdHJpeERyb3Bkb3duTW9kZWwgfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcbmltcG9ydCB7IFZpc3VhbGl6YXRpb25QYW5lbER5bmFtaWMgfSBmcm9tIFwiLi92aXN1YWxpemF0aW9uUGFuZWxEeW5hbWljXCI7XG5cbmV4cG9ydCBjbGFzcyBWaXN1YWxpemF0aW9uTWF0cml4RHluYW1pYyBleHRlbmRzIFZpc3VhbGl6YXRpb25QYW5lbER5bmFtaWMge1xuICBjb25zdHJ1Y3RvcihcbiAgICB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgICBxdWVzdGlvbjogUXVlc3Rpb24sXG4gICAgZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PixcbiAgICBvcHRpb25zPzogT2JqZWN0XG4gICkge1xuICAgIHN1cGVyKHRhcmdldEVsZW1lbnQsIHF1ZXN0aW9uLCBkYXRhLCBvcHRpb25zKTtcbiAgfVxuXG4gIGdldFF1ZXN0aW9ucygpIHtcbiAgICBjb25zdCBtYXRyaXhkeW5hbWljOiBRdWVzdGlvbk1hdHJpeERyb3Bkb3duTW9kZWwgPSA8YW55PnRoaXMucXVlc3Rpb247XG4gICAgY29uc3QgdmlzaWJsZVJvd3MgPSBtYXRyaXhkeW5hbWljLnZpc2libGVSb3dzO1xuXG4gICAgaWYgKHZpc2libGVSb3dzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuXG4gICAgcmV0dXJuIHZpc2libGVSb3dzWzBdLmNlbGxzLm1hcChjID0+IGMucXVlc3Rpb24pO1xuICB9XG59XG5cblZpc3VhbGl6YXRpb25NYW5hZ2VyLnJlZ2lzdGVyVmlzdWFsaXplcihcbiAgXCJtYXRyaXhkeW5hbWljXCIsXG4gIFZpc3VhbGl6YXRpb25NYXRyaXhEeW5hbWljXG4pO1xuXG5WaXN1YWxpemF0aW9uTWFuYWdlci5yZWdpc3RlclZpc3VhbGl6ZXIoXG4gIFwibWF0cml4ZHJvcGRvd25cIixcbiAgVmlzdWFsaXphdGlvbk1hdHJpeER5bmFtaWNcbik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvdmlzdWFsaXphdGlvbk1hdHJpeER5bmFtaWMudHMiLCJpbXBvcnQgeyBRdWVzdGlvbiB9IGZyb20gXCJzdXJ2ZXktY29yZVwiO1xuaW1wb3J0IFdvcmRDbG91ZExpYiBmcm9tIFwid29yZGNsb3VkXCI7XG5pbXBvcnQgeyBWaXN1YWxpemVyQmFzZSB9IGZyb20gXCIuLi92aXN1YWxpemVyQmFzZVwiO1xuaW1wb3J0IHsgVmlzdWFsaXphdGlvbk1hbmFnZXIgfSBmcm9tIFwiLi4vdmlzdWFsaXphdGlvbk1hbmFnZXJcIjtcbmltcG9ydCB7IHRleHRIZWxwZXIgfSBmcm9tIFwiLi9zdG9wd29yZHMvaW5kZXhcIjtcblxuZXhwb3J0IGNsYXNzIFdvcmRDbG91ZCBleHRlbmRzIFZpc3VhbGl6ZXJCYXNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgcXVlc3Rpb246IFF1ZXN0aW9uLFxuICAgIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4sXG4gICAgb3B0aW9ucz86IE9iamVjdFxuICApIHtcbiAgICBzdXBlcih0YXJnZXRFbGVtZW50LCBxdWVzdGlvbiwgZGF0YSwgb3B0aW9ucyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IG5hbWUoKSB7XG4gICAgcmV0dXJuIFwid29yZGNsb3VkXCI7XG4gIH1cblxuICBwcml2YXRlIGNsb3VkOiBhbnk7XG5cbiAgZ2V0RGF0YSgpIHtcbiAgICBsZXQgcmVzdWx0OiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9ID0ge307XG5cbiAgICBsZXQgc3RvcFdvcmRzID0gdGV4dEhlbHBlci5nZXRTdG9wV29yZHMoKTtcbiAgICBsZXQgc3RvcFRoZVdvcmQgPSAod29yZDogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAoc3RvcFdvcmRzLmluZGV4T2Yod29yZCkgIT09IC0xKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgfTtcblxuICAgIGxldCBwcm9jZXNzU3RyaW5nID0gKHJvdzogc3RyaW5nKSA9PiB7XG4gICAgICByb3cgPSBcIlwiICsgcm93O1xuICAgICAgaWYgKCEhcm93KSB7XG4gICAgICAgIHJvdy5zcGxpdChcIiBcIikuZm9yRWFjaCh3b3JkID0+IHtcbiAgICAgICAgICB3b3JkID0gc3RvcFRoZVdvcmQod29yZC50b0xvd2VyQ2FzZSgpIHx8IFwiXCIpO1xuICAgICAgICAgIGlmICghIXdvcmQpIHtcbiAgICAgICAgICAgIGlmICghcmVzdWx0W3dvcmRdKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFt3b3JkXSA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXN1bHRbd29yZF0rKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmRhdGEuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgY29uc3Qgcm93VmFsdWU6IGFueSA9IHJvd1t0aGlzLnF1ZXN0aW9uLm5hbWVdO1xuICAgICAgaWYgKCEhcm93VmFsdWUpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocm93VmFsdWUpKSB7XG4gICAgICAgICAgcm93VmFsdWUuZm9yRWFjaChwcm9jZXNzU3RyaW5nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHJvd1ZhbHVlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyb3dWYWx1ZSkuZm9yRWFjaChrZXkgPT4gcHJvY2Vzc1N0cmluZyhyb3dWYWx1ZVtrZXldKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByb2Nlc3NTdHJpbmcocm93VmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHJlc3VsdCkubWFwKGtleSA9PiB7XG4gICAgICByZXR1cm4gW2tleSwgcmVzdWx0W2tleV1dO1xuICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIHJlbmRlckNvbnRlbnQoY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldERhdGEoKTtcbiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdldENvbG9ycygpO1xuICAgIGNvbnN0IGNhbnZhc05vZGUgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjb25zdCBlbXB0eVRleHROb2RlID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgIGVtcHR5VGV4dE5vZGUuaW5uZXJIVE1MID0gXCJUaGVyZSBhcmUgbm8gcmVzdWx0cyB5ZXRcIjtcblxuICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVtcHR5VGV4dE5vZGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjYW52YXNOb2RlKTtcblxuICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgIGxpc3Q6IGRhdGEsXG4gICAgICB3ZWlnaHRGYWN0b3I6IDIwLFxuICAgICAgZm9udEZhbWlseTogXCJTZWdvZSBVSSBCb2xkLCBzYW5zLXNlcmlmXCIsXG4gICAgICBjb2xvcjogKHdvcmQ6IHN0cmluZywgd2VpZ2h0OiBudW1iZXIpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmFuZG9tQ29sb3IoKTtcbiAgICAgIH0sXG4gICAgICByb3RhdGVSYXRpbzogMC41LFxuICAgICAgcm90YXRpb25TdGVwczogMixcbiAgICAgIGJhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICBjbGljazogZnVuY3Rpb24oaXRlbTogYW55KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGl0ZW1bMF0gKyBcIjogXCIgKyBpdGVtWzFdKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5jbG91ZCA9IFdvcmRDbG91ZExpYihjYW52YXNOb2RlLCBjb25maWcpO1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICBzdXBlci5kZXN0cm95KCk7XG4gICAgaWYgKCEhdGhpcy5jbG91ZCkge1xuICAgICAgdGhpcy5jbG91ZCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbn1cblxuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwidGV4dFwiLCBXb3JkQ2xvdWQpO1xuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwiY29tbWVudFwiLCBXb3JkQ2xvdWQpO1xuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwibXVsdGlwbGV0ZXh0XCIsIFdvcmRDbG91ZCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvd29yZGNsb3VkL3dvcmRjbG91ZC50cyIsIi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvdGFibGVzL2RhdGF0YWJsZXMuc2Nzc1xuLy8gbW9kdWxlIGlkID0gMjJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLy8gcmVtb3ZlZCBieSBleHRyYWN0LXRleHQtd2VicGFjay1wbHVnaW5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy90YWJsZXMvdGFidWxhdG9yLnNjc3Ncbi8vIG1vZHVsZSBpZCA9IDIzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvdGV4dC5zY3NzXG4vLyBtb2R1bGUgaWQgPSAyNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL3Zpc3VhbGl6YXRpb25QYW5lbC5zY3NzXG4vLyBtb2R1bGUgaWQgPSAyNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL3Zpc3VhbGl6ZXJCYXNlLnNjc3Ncbi8vIG1vZHVsZSBpZCA9IDI2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qKlxuKiBNdXVyaSB2MC44LjBcbiogaHR0cHM6Ly9naXRodWIuY29tL2hhbHR1L211dXJpXG4qIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBIYWx0dSBPeVxuKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiogaHR0cHM6Ly9naXRodWIuY29tL2hhbHR1L211dXJpL2Jsb2IvbWFzdGVyL0xJQ0VOU0UubWRcbiogQGxpY2Vuc2UgTUlUXG4qXG4qIE11dXJpIFBhY2tlclxuKiBDb3B5cmlnaHQgKGMpIDIwMTYtcHJlc2VudCwgTmlrbGFzIFLDpG3DtiA8aW5yYW1vQGdtYWlsLmNvbT5cbiogQGxpY2Vuc2UgTUlUXG4qXG4qIE11dXJpIFRpY2tlciAvIE11dXJpIEVtaXR0ZXIgLyBNdXVyaSBRdWV1ZVxuKiBDb3B5cmlnaHQgKGMpIDIwMTgtcHJlc2VudCwgTmlrbGFzIFLDpG3DtiA8aW5yYW1vQGdtYWlsLmNvbT5cbiogQGxpY2Vuc2UgTUlUXG4qL1xuXG4oZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xuICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6XG4gIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6XG4gIChnbG9iYWwgPSBnbG9iYWwgfHwgc2VsZiwgZ2xvYmFsLk11dXJpID0gZmFjdG9yeSgpKTtcbn0odGhpcywgZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5hbWVzcGFjZSA9ICdNdXVyaSc7XG4gIHZhciBncmlkSW5zdGFuY2VzID0ge307XG5cbiAgdmFyIGFjdGlvblN3YXAgPSAnc3dhcCc7XG4gIHZhciBhY3Rpb25Nb3ZlID0gJ21vdmUnO1xuXG4gIHZhciBldmVudFN5bmNocm9uaXplID0gJ3N5bmNocm9uaXplJztcbiAgdmFyIGV2ZW50TGF5b3V0U3RhcnQgPSAnbGF5b3V0U3RhcnQnO1xuICB2YXIgZXZlbnRMYXlvdXRFbmQgPSAnbGF5b3V0RW5kJztcbiAgdmFyIGV2ZW50QWRkID0gJ2FkZCc7XG4gIHZhciBldmVudFJlbW92ZSA9ICdyZW1vdmUnO1xuICB2YXIgZXZlbnRTaG93U3RhcnQgPSAnc2hvd1N0YXJ0JztcbiAgdmFyIGV2ZW50U2hvd0VuZCA9ICdzaG93RW5kJztcbiAgdmFyIGV2ZW50SGlkZVN0YXJ0ID0gJ2hpZGVTdGFydCc7XG4gIHZhciBldmVudEhpZGVFbmQgPSAnaGlkZUVuZCc7XG4gIHZhciBldmVudEZpbHRlciA9ICdmaWx0ZXInO1xuICB2YXIgZXZlbnRTb3J0ID0gJ3NvcnQnO1xuICB2YXIgZXZlbnRNb3ZlID0gJ21vdmUnO1xuICB2YXIgZXZlbnRTZW5kID0gJ3NlbmQnO1xuICB2YXIgZXZlbnRCZWZvcmVTZW5kID0gJ2JlZm9yZVNlbmQnO1xuICB2YXIgZXZlbnRSZWNlaXZlID0gJ3JlY2VpdmUnO1xuICB2YXIgZXZlbnRCZWZvcmVSZWNlaXZlID0gJ2JlZm9yZVJlY2VpdmUnO1xuICB2YXIgZXZlbnREcmFnSW5pdCA9ICdkcmFnSW5pdCc7XG4gIHZhciBldmVudERyYWdTdGFydCA9ICdkcmFnU3RhcnQnO1xuICB2YXIgZXZlbnREcmFnTW92ZSA9ICdkcmFnTW92ZSc7XG4gIHZhciBldmVudERyYWdTY3JvbGwgPSAnZHJhZ1Njcm9sbCc7XG4gIHZhciBldmVudERyYWdFbmQgPSAnZHJhZ0VuZCc7XG4gIHZhciBldmVudERyYWdSZWxlYXNlU3RhcnQgPSAnZHJhZ1JlbGVhc2VTdGFydCc7XG4gIHZhciBldmVudERyYWdSZWxlYXNlRW5kID0gJ2RyYWdSZWxlYXNlRW5kJztcbiAgdmFyIGV2ZW50RGVzdHJveSA9ICdkZXN0cm95JztcblxuICAvKipcbiAgICogRXZlbnQgZW1pdHRlciBjb25zdHJ1Y3Rvci5cbiAgICpcbiAgICogQGNsYXNzXG4gICAqL1xuICBmdW5jdGlvbiBFbWl0dGVyKCkge1xuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIHRoaXMuX3F1ZXVlID0gW107XG4gICAgdGhpcy5fY291bnRlciA9IDA7XG4gICAgdGhpcy5faXNEZXN0cm95ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBCaW5kIGFuIGV2ZW50IGxpc3RlbmVyLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBFbWl0dGVyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnRcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXJcbiAgICogQHJldHVybnMge0VtaXR0ZXJ9XG4gICAqL1xuICBFbWl0dGVyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG5cbiAgICAvLyBHZXQgbGlzdGVuZXJzIHF1ZXVlIGFuZCBjcmVhdGUgaXQgaWYgaXQgZG9lcyBub3QgZXhpc3QuXG4gICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50c1tldmVudF07XG4gICAgaWYgKCFsaXN0ZW5lcnMpIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50c1tldmVudF0gPSBbXTtcblxuICAgIC8vIEFkZCB0aGUgbGlzdGVuZXIgdG8gdGhlIHF1ZXVlLlxuICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVbmJpbmQgYWxsIGV2ZW50IGxpc3RlbmVycyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBsaXN0ZW5lciBmdW5jdGlvbi5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgRW1pdHRlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtsaXN0ZW5lcl1cbiAgICogQHJldHVybnMge0VtaXR0ZXJ9XG4gICAqL1xuICBFbWl0dGVyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihldmVudCwgbGlzdGVuZXIpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgLy8gR2V0IGxpc3RlbmVycyBhbmQgcmV0dXJuIGltbWVkaWF0ZWx5IGlmIG5vbmUgaXMgZm91bmQuXG4gICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50c1tldmVudF07XG4gICAgaWYgKCFsaXN0ZW5lcnMgfHwgIWxpc3RlbmVycy5sZW5ndGgpIHJldHVybiB0aGlzO1xuXG4gICAgLy8gSWYgbm8gc3BlY2lmaWMgbGlzdGVuZXIgaXMgcHJvdmlkZWQgcmVtb3ZlIGFsbCBsaXN0ZW5lcnMuXG4gICAgaWYgKCFsaXN0ZW5lcikge1xuICAgICAgbGlzdGVuZXJzLmxlbmd0aCA9IDA7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgYWxsIG1hdGNoaW5nIGxpc3RlbmVycy5cbiAgICB2YXIgaSA9IGxpc3RlbmVycy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgaWYgKGxpc3RlbmVyID09PSBsaXN0ZW5lcnNbaV0pIGxpc3RlbmVycy5zcGxpY2UoaSwgMSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEVtaXQgYWxsIGxpc3RlbmVycyBpbiBhIHNwZWNpZmllZCBldmVudCB3aXRoIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEVtaXR0ZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudFxuICAgKiBAcGFyYW0geyp9IFthcmcxXVxuICAgKiBAcGFyYW0geyp9IFthcmcyXVxuICAgKiBAcGFyYW0geyp9IFthcmczXVxuICAgKiBAcmV0dXJucyB7RW1pdHRlcn1cbiAgICovXG4gIEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbihldmVudCwgYXJnMSwgYXJnMiwgYXJnMykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG5cbiAgICAvLyBHZXQgZXZlbnQgbGlzdGVuZXJzIGFuZCBxdWl0IGVhcmx5IGlmIHRoZXJlJ3Mgbm8gbGlzdGVuZXJzLlxuICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZlbnRdO1xuICAgIGlmICghbGlzdGVuZXJzIHx8ICFsaXN0ZW5lcnMubGVuZ3RoKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHZhciBxTGVuZ3RoID0gcXVldWUubGVuZ3RoO1xuICAgIHZhciBhTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7XG4gICAgdmFyIGk7XG5cbiAgICAvLyBBZGQgdGhlIGN1cnJlbnQgbGlzdGVuZXJzIHRvIHRoZSBjYWxsYmFjayBxdWV1ZSBiZWZvcmUgd2UgcHJvY2VzcyB0aGVtLlxuICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIGd1YXJhbnRlZSB0aGF0IGFsbCBvZiB0aGUgbGlzdGVuZXJzIGFyZSBjYWxsZWQgaW5cbiAgICAvLyBjb3JyZWN0IG9yZGVyIGV2ZW4gaWYgbmV3IGV2ZW50IGxpc3RlbmVycyBhcmUgcmVtb3ZlZC9hZGRlZCBkdXJpbmdcbiAgICAvLyBwcm9jZXNzaW5nIGFuZC9vciBldmVudHMgYXJlIGVtaXR0ZWQgZHVyaW5nIHByb2Nlc3NpbmcuXG4gICAgZm9yIChpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgcXVldWUucHVzaChsaXN0ZW5lcnNbaV0pO1xuICAgIH1cblxuICAgIC8vIEluY3JlbWVudCBxdWV1ZSBjb3VudGVyLiBUaGlzIGlzIG5lZWRlZCBmb3IgdGhlIHNjZW5hcmlvcyB3aGVyZSBlbWl0IGlzXG4gICAgLy8gdHJpZ2dlcmVkIHdoaWxlIHRoZSBxdWV1ZSBpcyBhbHJlYWR5IHByb2Nlc3NpbmcuIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZlxuICAgIC8vIGhvdyBtYW55IFwicXVldWUgcHJvY2Vzc29yc1wiIHRoZXJlIGFyZSBhY3RpdmUgc28gdGhhdCB3ZSBjYW4gc2FmZWx5IHJlc2V0XG4gICAgLy8gdGhlIHF1ZXVlIGluIHRoZSBlbmQgd2hlbiB0aGUgbGFzdCBxdWV1ZSBwcm9jZXNzb3IgaXMgZmluaXNoZWQuXG4gICAgKyt0aGlzLl9jb3VudGVyO1xuXG4gICAgLy8gUHJvY2VzcyB0aGUgcXVldWUgKHRoZSBzcGVjaWZpYyBwYXJ0IG9mIGl0IGZvciB0aGlzIGVtaXQpLlxuICAgIGZvciAoaSA9IHFMZW5ndGgsIHFMZW5ndGggPSBxdWV1ZS5sZW5ndGg7IGkgPCBxTGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vIHByZXR0aWVyLWlnbm9yZVxuICAgICAgYUxlbmd0aCA9PT0gMCA/IHF1ZXVlW2ldKCkgOlxuICAgICAgYUxlbmd0aCA9PT0gMSA/IHF1ZXVlW2ldKGFyZzEpIDpcbiAgICAgIGFMZW5ndGggPT09IDIgPyBxdWV1ZVtpXShhcmcxLCBhcmcyKSA6XG4gICAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0oYXJnMSwgYXJnMiwgYXJnMyk7XG5cbiAgICAgIC8vIFN0b3AgcHJvY2Vzc2luZyBpZiB0aGUgZW1pdHRlciBpcyBkZXN0cm95ZWQuXG4gICAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIERlY3JlbWVudCBxdWV1ZSBwcm9jZXNzIGNvdW50ZXIuXG4gICAgLS10aGlzLl9jb3VudGVyO1xuXG4gICAgLy8gUmVzZXQgdGhlIHF1ZXVlIGlmIHRoZXJlIGFyZSBubyBtb3JlIHF1ZXVlIHByb2Nlc3NlcyBydW5uaW5nLlxuICAgIGlmICghdGhpcy5fY291bnRlcikgcXVldWUubGVuZ3RoID0gMDtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IGVtaXR0ZXIgaW5zdGFuY2UuIEJhc2ljYWxseSBqdXN0IHJlbW92ZXMgYWxsIGJvdW5kIGxpc3RlbmVycy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgRW1pdHRlci5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0VtaXR0ZXJ9XG4gICAqL1xuICBFbWl0dGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHM7XG4gICAgdmFyIGV2ZW50O1xuXG4gICAgLy8gRmxhZyBhcyBkZXN0cm95ZWQuXG4gICAgdGhpcy5faXNEZXN0cm95ZWQgPSB0cnVlO1xuXG4gICAgLy8gUmVzZXQgcXVldWUgKGlmIHF1ZXVlIGlzIGN1cnJlbnRseSBwcm9jZXNzaW5nIHRoaXMgd2lsbCBhbHNvIHN0b3AgdGhhdCkuXG4gICAgdGhpcy5fcXVldWUubGVuZ3RoID0gdGhpcy5fY291bnRlciA9IDA7XG5cbiAgICAvLyBSZW1vdmUgYWxsIGxpc3RlbmVycy5cbiAgICBmb3IgKGV2ZW50IGluIGV2ZW50cykge1xuICAgICAgaWYgKGV2ZW50c1tldmVudF0pIHtcbiAgICAgICAgZXZlbnRzW2V2ZW50XS5sZW5ndGggPSAwO1xuICAgICAgICBldmVudHNbZXZlbnRdID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIFNldCB1cCB0aGUgZGVmYXVsdCBleHBvcnQgdmFsdWVzLlxuICB2YXIgdHJhbnNmb3JtU3R5bGUgPSAndHJhbnNmb3JtJztcbiAgdmFyIHRyYW5zZm9ybVByb3AgPSAndHJhbnNmb3JtJztcblxuICAvLyBGaW5kIHRoZSBzdXBwb3J0ZWQgdHJhbnNmb3JtIHByb3AgYW5kIHN0eWxlIG5hbWVzLlxuICB2YXIgZG9jRWxlbVN0eWxlID0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZTtcbiAgdmFyIHN0eWxlID0gJ3RyYW5zZm9ybSc7XG4gIHZhciBzdHlsZUNhcCA9ICdUcmFuc2Zvcm0nO1xuICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgWycnLCAnV2Via2l0JywgJ01veicsICdPJywgJ21zJ10uZm9yRWFjaChmdW5jdGlvbihwcmVmaXgpIHtcbiAgICBpZiAoZm91bmQpIHJldHVybjtcbiAgICB2YXIgcHJvcE5hbWUgPSBwcmVmaXggPyBwcmVmaXggKyBzdHlsZUNhcCA6IHN0eWxlO1xuICAgIGlmIChkb2NFbGVtU3R5bGVbcHJvcE5hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHByZWZpeCA9IHByZWZpeC50b0xvd2VyQ2FzZSgpO1xuICAgICAgdHJhbnNmb3JtU3R5bGUgPSBwcmVmaXggPyAnLScgKyBwcmVmaXggKyAnLScgKyBzdHlsZSA6IHN0eWxlO1xuICAgICAgdHJhbnNmb3JtUHJvcCA9IHByb3BOYW1lO1xuICAgICAgZm91bmQgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIHN0eWxlc0NhY2hlID0gdHlwZW9mIFdlYWtNYXAgPT09ICdmdW5jdGlvbicgPyBuZXcgV2Vha01hcCgpIDogbnVsbDtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29tcHV0ZWQgdmFsdWUgb2YgYW4gZWxlbWVudCdzIHN0eWxlIHByb3BlcnR5IGFzIGEgc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHlsZVxuICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0U3R5bGUoZWxlbWVudCwgc3R5bGUpIHtcbiAgICB2YXIgc3R5bGVzID0gc3R5bGVzQ2FjaGUgJiYgc3R5bGVzQ2FjaGUuZ2V0KGVsZW1lbnQpO1xuICAgIGlmICghc3R5bGVzKSB7XG4gICAgICBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcbiAgICAgIGlmIChzdHlsZXNDYWNoZSkgc3R5bGVzQ2FjaGUuc2V0KGVsZW1lbnQsIHN0eWxlcyk7XG4gICAgfVxuICAgIHJldHVybiBzdHlsZXMuZ2V0UHJvcGVydHlWYWx1ZShzdHlsZSA9PT0gJ3RyYW5zZm9ybScgPyB0cmFuc2Zvcm1TdHlsZSA6IHN0eWxlKTtcbiAgfVxuXG4gIHZhciBzdHlsZU5hbWVSZWdFeCA9IC8oW0EtWl0pL2c7XG5cbiAgLyoqXG4gICAqIFRyYW5zZm9ybXMgYSBjYW1lbCBjYXNlIHN0eWxlIHByb3BlcnR5IHRvIGtlYmFiIGNhc2Ugc3R5bGUgcHJvcGVydHkuXG4gICAqXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmdcbiAgICogQHJldHVybnMge1N0cmluZ31cbiAgICovXG4gIGZ1bmN0aW9uIGdldFN0eWxlTmFtZShzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2Uoc3R5bGVOYW1lUmVnRXgsICctJDEnKS50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgdmFyIHN0ckZ1bmN0aW9uID0gJ2Z1bmN0aW9uJztcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0geyp9IHZhbFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09IHN0ckZ1bmN0aW9uO1xuICB9XG5cbiAgdmFyIHRyYW5zZm9ybVN0eWxlJDEgPSAndHJhbnNmb3JtJztcblxuICAvKipcbiAgICogU2V0IGlubGluZSBzdHlsZXMgdG8gYW4gZWxlbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgKiBAcGFyYW0ge09iamVjdH0gc3R5bGVzXG4gICAqL1xuICBmdW5jdGlvbiBzZXRTdHlsZXMoZWxlbWVudCwgc3R5bGVzKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBzdHlsZXMpIHtcbiAgICAgIGVsZW1lbnQuc3R5bGVbcHJvcCA9PT0gdHJhbnNmb3JtU3R5bGUkMSA/IHRyYW5zZm9ybVByb3AgOiBwcm9wXSA9IHN0eWxlc1twcm9wXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSXRlbSBhbmltYXRpb24gaGFuZGxlciBwb3dlcmVkIGJ5IFdlYiBBbmltYXRpb25zIEFQSS5cbiAgICpcbiAgICogQGNsYXNzXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICovXG4gIGZ1bmN0aW9uIEl0ZW1BbmltYXRlKGVsZW1lbnQpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgIHRoaXMuX2NhbGxiYWNrID0gbnVsbDtcbiAgICB0aGlzLl9wcm9wcyA9IFtdO1xuICAgIHRoaXMuX3ZhbHVlcyA9IFtdO1xuICAgIHRoaXMuX2tleWZyYW1lcyA9IFtdO1xuICAgIHRoaXMuX29wdGlvbnMgPSB7fTtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuX29uRmluaXNoID0gdGhpcy5fb25GaW5pc2guYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdGFydCBpbnN0YW5jZSdzIGFuaW1hdGlvbi4gQXV0b21hdGljYWxseSBzdG9wcyBjdXJyZW50IGFuaW1hdGlvbiBpZiBpdCBpc1xuICAgKiBydW5uaW5nLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtQW5pbWF0ZS5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtPYmplY3R9IHByb3BzRnJvbVxuICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcHNUb1xuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5kdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5lYXNpbmc9J2Vhc2UnXVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9ucy5vbkZpbmlzaF1cbiAgICovXG4gIEl0ZW1BbmltYXRlLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKHByb3BzRnJvbSwgcHJvcHNUbywgb3B0aW9ucykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuO1xuXG4gICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuX2FuaW1hdGlvbjtcbiAgICB2YXIgY3VycmVudFByb3BzID0gdGhpcy5fcHJvcHM7XG4gICAgdmFyIGN1cnJlbnRWYWx1ZXMgPSB0aGlzLl92YWx1ZXM7XG4gICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IDA7XG4gICAgdmFyIGNhbmNlbEFuaW1hdGlvbiA9IGZhbHNlO1xuXG4gICAgLy8gSWYgd2UgaGF2ZSBhbiBleGlzdGluZyBhbmltYXRpb24gcnVubmluZywgbGV0J3MgY2hlY2sgaWYgaXQgbmVlZHMgdG8gYmVcbiAgICAvLyBjYW5jZWxsZWQgb3IgaWYgaXQgY2FuIGNvbnRpbnVlIHJ1bm5pbmcuXG4gICAgaWYgKGFuaW1hdGlvbikge1xuICAgICAgdmFyIHByb3BDb3VudCA9IDA7XG4gICAgICB2YXIgcHJvcEluZGV4O1xuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgcmVxdWVzdGVkIGFuaW1hdGlvbiB0YXJnZXQgcHJvcHMgYW5kIHZhbHVlcyBtYXRjaCB3aXRoIHRoZVxuICAgICAgLy8gY3VycmVudCBwcm9wcyBhbmQgdmFsdWVzLlxuICAgICAgZm9yICh2YXIgcHJvcE5hbWUgaW4gcHJvcHNUbykge1xuICAgICAgICArK3Byb3BDb3VudDtcbiAgICAgICAgcHJvcEluZGV4ID0gY3VycmVudFByb3BzLmluZGV4T2YocHJvcE5hbWUpO1xuICAgICAgICBpZiAocHJvcEluZGV4ID09PSAtMSB8fCBwcm9wc1RvW3Byb3BOYW1lXSAhPT0gY3VycmVudFZhbHVlc1twcm9wSW5kZXhdKSB7XG4gICAgICAgICAgY2FuY2VsQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdGFyZ2V0IHByb3BzIGNvdW50IG1hdGNoZXMgY3VycmVudCBwcm9wcyBjb3VudC4gVGhpcyBpc1xuICAgICAgLy8gbmVlZGVkIGZvciB0aGUgZWRnZSBjYXNlIHNjZW5hcmlvIHdoZXJlIHRhcmdldCBwcm9wcyBjb250YWluIHRoZSBzYW1lXG4gICAgICAvLyBzdHlsZXMgYXMgY3VycmVudCBwcm9wcywgYnV0IHRoZSBjdXJyZW50IHByb3BzIGhhdmUgc29tZSBhZGRpdGlvbmFsXG4gICAgICAvLyBwcm9wcy5cbiAgICAgIGlmICghY2FuY2VsQW5pbWF0aW9uICYmIHByb3BDb3VudCAhPT0gY3VycmVudFByb3BzLmxlbmd0aCkge1xuICAgICAgICBjYW5jZWxBbmltYXRpb24gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbmNlbCBhbmltYXRpb24gKGlmIHJlcXVpcmVkKS5cbiAgICBpZiAoY2FuY2VsQW5pbWF0aW9uKSBhbmltYXRpb24uY2FuY2VsKCk7XG5cbiAgICAvLyBTdG9yZSBhbmltYXRpb24gY2FsbGJhY2suXG4gICAgdGhpcy5fY2FsbGJhY2sgPSBpc0Z1bmN0aW9uKG9wdHMub25GaW5pc2gpID8gb3B0cy5vbkZpbmlzaCA6IG51bGw7XG5cbiAgICAvLyBJZiB3ZSBoYXZlIGEgcnVubmluZyBhbmltYXRpb24gdGhhdCBkb2VzIG5vdCBuZWVkIHRvIGJlIGNhbmNlbGxlZCwgbGV0J3NcbiAgICAvLyBjYWxsIGl0IGEgZGF5IGhlcmUgYW5kIGxldCBpdCBydW4uXG4gICAgaWYgKGFuaW1hdGlvbiAmJiAhY2FuY2VsQW5pbWF0aW9uKSByZXR1cm47XG5cbiAgICAvLyBTdG9yZSB0YXJnZXQgcHJvcHMgYW5kIHZhbHVlcyB0byBpbnN0YW5jZS5cbiAgICBjdXJyZW50UHJvcHMubGVuZ3RoID0gY3VycmVudFZhbHVlcy5sZW5ndGggPSAwO1xuICAgIGZvciAocHJvcE5hbWUgaW4gcHJvcHNUbykge1xuICAgICAgY3VycmVudFByb3BzLnB1c2gocHJvcE5hbWUpO1xuICAgICAgY3VycmVudFZhbHVlcy5wdXNoKHByb3BzVG9bcHJvcE5hbWVdKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgdXAga2V5ZnJhbWVzLlxuICAgIHZhciBhbmltS2V5ZnJhbWVzID0gdGhpcy5fa2V5ZnJhbWVzO1xuICAgIGFuaW1LZXlmcmFtZXNbMF0gPSBwcm9wc0Zyb207XG4gICAgYW5pbUtleWZyYW1lc1sxXSA9IHByb3BzVG87XG5cbiAgICAvLyBTZXQgdXAgb3B0aW9ucy5cbiAgICB2YXIgYW5pbU9wdGlvbnMgPSB0aGlzLl9vcHRpb25zO1xuICAgIGFuaW1PcHRpb25zLmR1cmF0aW9uID0gb3B0cy5kdXJhdGlvbiB8fCAzMDA7XG4gICAgYW5pbU9wdGlvbnMuZWFzaW5nID0gb3B0cy5lYXNpbmcgfHwgJ2Vhc2UnO1xuXG4gICAgLy8gU3RhcnQgdGhlIGFuaW1hdGlvblxuICAgIHZhciBlbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcbiAgICBhbmltYXRpb24gPSBlbGVtZW50LmFuaW1hdGUoYW5pbUtleWZyYW1lcywgYW5pbU9wdGlvbnMpO1xuICAgIGFuaW1hdGlvbi5vbmZpbmlzaCA9IHRoaXMuX29uRmluaXNoO1xuICAgIHRoaXMuX2FuaW1hdGlvbiA9IGFuaW1hdGlvbjtcblxuICAgIC8vIFNldCB0aGUgZW5kIHN0eWxlcy4gVGhpcyBtYWtlcyBzdXJlIHRoYXQgdGhlIGVsZW1lbnQgc3RheXMgYXQgdGhlIGVuZFxuICAgIC8vIHZhbHVlcyBhZnRlciBhbmltYXRpb24gaXMgZmluaXNoZWQuXG4gICAgc2V0U3R5bGVzKGVsZW1lbnQsIHByb3BzVG8pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTdG9wIGluc3RhbmNlJ3MgY3VycmVudCBhbmltYXRpb24gaWYgcnVubmluZy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbUFuaW1hdGUucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc3R5bGVzXVxuICAgKi9cbiAgSXRlbUFuaW1hdGUucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbihzdHlsZXMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgIXRoaXMuX2FuaW1hdGlvbikgcmV0dXJuO1xuXG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuICAgIHZhciBjdXJyZW50UHJvcHMgPSB0aGlzLl9wcm9wcztcbiAgICB2YXIgY3VycmVudFZhbHVlcyA9IHRoaXMuX3ZhbHVlcztcbiAgICB2YXIgcHJvcE5hbWU7XG4gICAgdmFyIHByb3BWYWx1ZTtcbiAgICB2YXIgaTtcblxuICAgIC8vIENhbGN1bGF0ZSAoaWYgbm90IHByb3ZpZGVkKSBhbmQgc2V0IHN0eWxlcy5cbiAgICBpZiAoIXN0eWxlcykge1xuICAgICAgZm9yIChpID0gMDsgaSA8IGN1cnJlbnRQcm9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBwcm9wTmFtZSA9IGN1cnJlbnRQcm9wc1tpXTtcbiAgICAgICAgcHJvcFZhbHVlID0gZ2V0U3R5bGUoZWxlbWVudCwgZ2V0U3R5bGVOYW1lKHByb3BOYW1lKSk7XG4gICAgICAgIGVsZW1lbnQuc3R5bGVbcHJvcE5hbWUgPT09ICd0cmFuc2Zvcm0nID8gdHJhbnNmb3JtUHJvcCA6IHByb3BOYW1lXSA9IHByb3BWYWx1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2V0U3R5bGVzKGVsZW1lbnQsIHN0eWxlcyk7XG4gICAgfVxuXG4gICAgLy8gIENhbmNlbCBhbmltYXRpb24uXG4gICAgdGhpcy5fYW5pbWF0aW9uLmNhbmNlbCgpO1xuICAgIHRoaXMuX2FuaW1hdGlvbiA9IHRoaXMuX2NhbGxiYWNrID0gbnVsbDtcblxuICAgIC8vIFJlc2V0IGN1cnJlbnQgcHJvcHMgYW5kIHZhbHVlcy5cbiAgICBjdXJyZW50UHJvcHMubGVuZ3RoID0gY3VycmVudFZhbHVlcy5sZW5ndGggPSAwO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgaXRlbSBpcyBiZWluZyBhbmltYXRlZCBjdXJyZW50bHkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1BbmltYXRlLnByb3RvdHlwZVxuICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgKi9cbiAgSXRlbUFuaW1hdGUucHJvdG90eXBlLmlzQW5pbWF0aW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEhdGhpcy5fYW5pbWF0aW9uO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBpbnN0YW5jZSBhbmQgc3RvcCBjdXJyZW50IGFuaW1hdGlvbiBpZiBpdCBpcyBydW5uaW5nLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtQW5pbWF0ZS5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1BbmltYXRlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm47XG4gICAgdGhpcy5zdG9wKCk7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX29wdGlvbnMgPSB0aGlzLl9rZXlmcmFtZXMgPSBudWxsO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdHJ1ZTtcbiAgfTtcblxuICAvKipcbiAgICogUHJpdmF0ZSBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBBbmltYXRpb24gZW5kIGhhbmRsZXIuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtQW5pbWF0ZS5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1BbmltYXRlLnByb3RvdHlwZS5fb25GaW5pc2ggPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2FsbGJhY2sgPSB0aGlzLl9jYWxsYmFjaztcbiAgICB0aGlzLl9hbmltYXRpb24gPSB0aGlzLl9jYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5fcHJvcHMubGVuZ3RoID0gdGhpcy5fdmFsdWVzLmxlbmd0aCA9IDA7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgfTtcblxuICB2YXIgdmVuZG9yUHJlZml4ZXMgPSBbJycsICd3ZWJraXQnLCAnbW96JywgJ21zJywgJ28nLCAnV2Via2l0JywgJ01veicsICdNUycsICdPJ107XG5cbiAgLyoqXG4gICAqIEdldCBwcmVmaXhlZCBDU1MgcHJvcGVydHkgbmFtZSB3aGVuIGdpdmVuIGEgbm9uLXByZWZpeGVkIENTUyBwcm9wZXJ0eSBuYW1lLlxuICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbVN0eWxlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wTmFtZVxuICAgKiBAcmV0dXJucyB7IVN0cmluZ31cbiAgICovXG4gIGZ1bmN0aW9uIGdldFByZWZpeGVkUHJvcE5hbWUoZWxlbVN0eWxlLCBwcm9wTmFtZSkge1xuICAgIHZhciBjYW1lbFByb3BOYW1lID0gcHJvcE5hbWVbMF0udG9VcHBlckNhc2UoKSArIHByb3BOYW1lLnNsaWNlKDEpO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgcHJlZml4O1xuICAgIHZhciBwcmVmaXhlZFByb3BOYW1lO1xuXG4gICAgd2hpbGUgKGkgPCB2ZW5kb3JQcmVmaXhlcy5sZW5ndGgpIHtcbiAgICAgIHByZWZpeCA9IHZlbmRvclByZWZpeGVzW2ldO1xuICAgICAgcHJlZml4ZWRQcm9wTmFtZSA9IHByZWZpeCA/IHByZWZpeCArIGNhbWVsUHJvcE5hbWUgOiBwcm9wTmFtZTtcbiAgICAgIGlmIChwcmVmaXhlZFByb3BOYW1lIGluIGVsZW1TdHlsZSkgcmV0dXJuIHByZWZpeGVkUHJvcE5hbWU7XG4gICAgICArK2k7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB2YXIgZHQgPSAxMDAwIC8gNjA7XG5cbiAgdmFyIHJhZiA9IChcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgY2FsbGJhY2soZHQpO1xuICAgICAgfSwgZHQpO1xuICAgIH1cbiAgKS5iaW5kKHdpbmRvdyk7XG5cbiAgLy8gRGV0ZWN0IHN1cHBvcnQgZm9yIHBhc3NpdmUgZXZlbnRzOlxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vV0lDRy9FdmVudExpc3RlbmVyT3B0aW9ucy9ibG9iL2doLXBhZ2VzL2V4cGxhaW5lci5tZCNmZWF0dXJlLWRldGVjdGlvblxuICB2YXIgaXNQYXNzaXZlRXZlbnRzU3VwcG9ydGVkID0gZmFsc2U7XG4gIHRyeSB7XG4gICAgdmFyIHBhc3NpdmVPcHRzID0gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAncGFzc2l2ZScsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlzUGFzc2l2ZUV2ZW50c1N1cHBvcnRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Rlc3RQYXNzaXZlJywgbnVsbCwgcGFzc2l2ZU9wdHMpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0ZXN0UGFzc2l2ZScsIG51bGwsIHBhc3NpdmVPcHRzKTtcbiAgfSBjYXRjaCAoZSkge31cblxuICAvLyBEcmFnZ2VyIGV2ZW50cy5cbiAgdmFyIGV2ZW50cyA9IHtcbiAgICBzdGFydDogJ3N0YXJ0JyxcbiAgICBtb3ZlOiAnbW92ZScsXG4gICAgZW5kOiAnZW5kJyxcbiAgICBjYW5jZWw6ICdjYW5jZWwnXG4gIH07XG5cbiAgdmFyIGhhc1RvdWNoRXZlbnRzID0gISEoJ29udG91Y2hzdGFydCcgaW4gd2luZG93IHx8IHdpbmRvdy5Ub3VjaEV2ZW50KTtcbiAgdmFyIGhhc1BvaW50ZXJFdmVudHMgPSAhIXdpbmRvdy5Qb2ludGVyRXZlbnQ7XG4gIHZhciBoYXNNc1BvaW50ZXJFdmVudHMgPSAhIXdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZDtcbiAgdmFyIGlzQW5kcm9pZCA9IC8oYW5kcm9pZCkvaS50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcbiAgdmFyIGxpc3RlbmVyT3B0aW9ucyA9IGlzUGFzc2l2ZUV2ZW50c1N1cHBvcnRlZCA/IHsgcGFzc2l2ZTogdHJ1ZSB9IDogZmFsc2U7XG5cbiAgdmFyIHRhUHJvcCA9ICd0b3VjaEFjdGlvbic7XG4gIHZhciB0YVByb3BQcmVmaXhlZCA9IGdldFByZWZpeGVkUHJvcE5hbWUod2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZSwgdGFQcm9wKTtcbiAgdmFyIHRhRGVmYXVsdFZhbHVlID0gJ2F1dG8nO1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IERyYWdnZXIgaW5zdGFuY2UgZm9yIGFuIGVsZW1lbnQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQGNsYXNzXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtPYmplY3R9IFtjc3NQcm9wc11cbiAgICovXG4gIGZ1bmN0aW9uIERyYWdnZXIoZWxlbWVudCwgY3NzUHJvcHMpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLl9lbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuX2Nzc1Byb3BzID0ge307XG4gICAgdGhpcy5fdG91Y2hBY3Rpb24gPSAnJztcbiAgICB0aGlzLl9zdGFydEV2ZW50ID0gbnVsbDtcblxuICAgIHRoaXMuX3BvaW50ZXJJZCA9IG51bGw7XG4gICAgdGhpcy5fc3RhcnRUaW1lID0gMDtcbiAgICB0aGlzLl9zdGFydFggPSAwO1xuICAgIHRoaXMuX3N0YXJ0WSA9IDA7XG4gICAgdGhpcy5fY3VycmVudFggPSAwO1xuICAgIHRoaXMuX2N1cnJlbnRZID0gMDtcblxuICAgIHRoaXMuX3ByZVN0YXJ0Q2hlY2sgPSB0aGlzLl9wcmVTdGFydENoZWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fYWJvcnROb25DYW5jZWxhYmxlID0gdGhpcy5fYWJvcnROb25DYW5jZWxhYmxlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25TdGFydCA9IHRoaXMuX29uU3RhcnQuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbk1vdmUgPSB0aGlzLl9vbk1vdmUuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbkNhbmNlbCA9IHRoaXMuX29uQ2FuY2VsLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25FbmQgPSB0aGlzLl9vbkVuZC5iaW5kKHRoaXMpO1xuXG4gICAgLy8gQXBwbHkgaW5pdGlhbCBjc3MgcHJvcHMuXG4gICAgdGhpcy5zZXRDc3NQcm9wcyhjc3NQcm9wcyk7XG5cbiAgICAvLyBJZiB0b3VjaCBhY3Rpb24gd2FzIG5vdCBwcm92aWRlZCB3aXRoIGluaXRpYWwgY3NzIHByb3BzIGxldCdzIGFzc3VtZSBpdCdzXG4gICAgLy8gYXV0by5cbiAgICBpZiAoIXRoaXMuX3RvdWNoQWN0aW9uKSB7XG4gICAgICB0aGlzLnNldFRvdWNoQWN0aW9uKHRhRGVmYXVsdFZhbHVlKTtcbiAgICB9XG5cbiAgICAvLyBQcmV2ZW50IG5hdGl2ZSBsaW5rL2ltYWdlIGRyYWdnaW5nIGZvciB0aGUgaXRlbSBhbmQgaXQncyBhbmNlc3RvcnMuXG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBEcmFnZ2VyLl9wcmV2ZW50RGVmYXVsdCwgZmFsc2UpO1xuXG4gICAgLy8gTGlzdGVuIHRvIHN0YXJ0IGV2ZW50LlxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihEcmFnZ2VyLl9ldmVudHMuc3RhcnQsIHRoaXMuX3ByZVN0YXJ0Q2hlY2ssIGxpc3RlbmVyT3B0aW9ucyk7XG5cbiAgICAvLyBJZiB3ZSBoYXZlIHRvdWNoIGV2ZW50cywgYnV0IG5vIHBvaW50ZXIgZXZlbnRzIHdlIG5lZWQgdG8gYWxzbyBsaXN0ZW4gZm9yXG4gICAgLy8gbW91c2UgZXZlbnRzIGluIGFkZGl0aW9uIHRvIHRvdWNoIGV2ZW50cyBmb3IgZGV2aWNlcyB3aGljaCBzdXBwb3J0IGJvdGhcbiAgICAvLyBtb3VzZSBhbmQgdG91Y2ggaW50ZXJhY3Rpb24uXG4gICAgaWYgKGhhc1RvdWNoRXZlbnRzICYmICFoYXNQb2ludGVyRXZlbnRzICYmICFoYXNNc1BvaW50ZXJFdmVudHMpIHtcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihEcmFnZ2VyLl9tb3VzZUV2ZW50cy5zdGFydCwgdGhpcy5fcHJlU3RhcnRDaGVjaywgbGlzdGVuZXJPcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvdGVjdGVkIHByb3BlcnRpZXNcbiAgICogKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgRHJhZ2dlci5fcG9pbnRlckV2ZW50cyA9IHtcbiAgICBzdGFydDogJ3BvaW50ZXJkb3duJyxcbiAgICBtb3ZlOiAncG9pbnRlcm1vdmUnLFxuICAgIGNhbmNlbDogJ3BvaW50ZXJjYW5jZWwnLFxuICAgIGVuZDogJ3BvaW50ZXJ1cCdcbiAgfTtcblxuICBEcmFnZ2VyLl9tc1BvaW50ZXJFdmVudHMgPSB7XG4gICAgc3RhcnQ6ICdNU1BvaW50ZXJEb3duJyxcbiAgICBtb3ZlOiAnTVNQb2ludGVyTW92ZScsXG4gICAgY2FuY2VsOiAnTVNQb2ludGVyQ2FuY2VsJyxcbiAgICBlbmQ6ICdNU1BvaW50ZXJVcCdcbiAgfTtcblxuICBEcmFnZ2VyLl90b3VjaEV2ZW50cyA9IHtcbiAgICBzdGFydDogJ3RvdWNoc3RhcnQnLFxuICAgIG1vdmU6ICd0b3VjaG1vdmUnLFxuICAgIGNhbmNlbDogJ3RvdWNoY2FuY2VsJyxcbiAgICBlbmQ6ICd0b3VjaGVuZCdcbiAgfTtcblxuICBEcmFnZ2VyLl9tb3VzZUV2ZW50cyA9IHtcbiAgICBzdGFydDogJ21vdXNlZG93bicsXG4gICAgbW92ZTogJ21vdXNlbW92ZScsXG4gICAgY2FuY2VsOiAnJyxcbiAgICBlbmQ6ICdtb3VzZXVwJ1xuICB9O1xuXG4gIERyYWdnZXIuX2V2ZW50cyA9IChmdW5jdGlvbigpIHtcbiAgICBpZiAoaGFzUG9pbnRlckV2ZW50cykgcmV0dXJuIERyYWdnZXIuX3BvaW50ZXJFdmVudHM7XG4gICAgaWYgKGhhc01zUG9pbnRlckV2ZW50cykgcmV0dXJuIERyYWdnZXIuX21zUG9pbnRlckV2ZW50cztcbiAgICBpZiAoaGFzVG91Y2hFdmVudHMpIHJldHVybiBEcmFnZ2VyLl90b3VjaEV2ZW50cztcbiAgICByZXR1cm4gRHJhZ2dlci5fbW91c2VFdmVudHM7XG4gIH0pKCk7XG5cbiAgRHJhZ2dlci5fZW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7XG5cbiAgRHJhZ2dlci5fYWN0aXZlSW5zdGFuY2VzID0gW107XG5cbiAgLyoqXG4gICAqIFByb3RlY3RlZCBzdGF0aWMgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgRHJhZ2dlci5fcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUucHJldmVudERlZmF1bHQgJiYgZS5jYW5jZWxhYmxlICE9PSBmYWxzZSkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9O1xuXG4gIERyYWdnZXIuX2FjdGl2YXRlSW5zdGFuY2UgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgIHZhciBpbmRleCA9IERyYWdnZXIuX2FjdGl2ZUluc3RhbmNlcy5pbmRleE9mKGluc3RhbmNlKTtcbiAgICBpZiAoaW5kZXggPiAtMSkgcmV0dXJuO1xuXG4gICAgRHJhZ2dlci5fYWN0aXZlSW5zdGFuY2VzLnB1c2goaW5zdGFuY2UpO1xuICAgIERyYWdnZXIuX2VtaXR0ZXIub24oZXZlbnRzLm1vdmUsIGluc3RhbmNlLl9vbk1vdmUpO1xuICAgIERyYWdnZXIuX2VtaXR0ZXIub24oZXZlbnRzLmNhbmNlbCwgaW5zdGFuY2UuX29uQ2FuY2VsKTtcbiAgICBEcmFnZ2VyLl9lbWl0dGVyLm9uKGV2ZW50cy5lbmQsIGluc3RhbmNlLl9vbkVuZCk7XG5cbiAgICBpZiAoRHJhZ2dlci5fYWN0aXZlSW5zdGFuY2VzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgRHJhZ2dlci5fYmluZExpc3RlbmVycygpO1xuICAgIH1cbiAgfTtcblxuICBEcmFnZ2VyLl9kZWFjdGl2YXRlSW5zdGFuY2UgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgIHZhciBpbmRleCA9IERyYWdnZXIuX2FjdGl2ZUluc3RhbmNlcy5pbmRleE9mKGluc3RhbmNlKTtcbiAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm47XG5cbiAgICBEcmFnZ2VyLl9hY3RpdmVJbnN0YW5jZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICBEcmFnZ2VyLl9lbWl0dGVyLm9mZihldmVudHMubW92ZSwgaW5zdGFuY2UuX29uTW92ZSk7XG4gICAgRHJhZ2dlci5fZW1pdHRlci5vZmYoZXZlbnRzLmNhbmNlbCwgaW5zdGFuY2UuX29uQ2FuY2VsKTtcbiAgICBEcmFnZ2VyLl9lbWl0dGVyLm9mZihldmVudHMuZW5kLCBpbnN0YW5jZS5fb25FbmQpO1xuXG4gICAgaWYgKCFEcmFnZ2VyLl9hY3RpdmVJbnN0YW5jZXMubGVuZ3RoKSB7XG4gICAgICBEcmFnZ2VyLl91bmJpbmRMaXN0ZW5lcnMoKTtcbiAgICB9XG4gIH07XG5cbiAgRHJhZ2dlci5fYmluZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBldmVudHMgPSBEcmFnZ2VyLl9ldmVudHM7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRzLm1vdmUsIERyYWdnZXIuX29uTW92ZSwgbGlzdGVuZXJPcHRpb25zKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudHMuZW5kLCBEcmFnZ2VyLl9vbkVuZCwgbGlzdGVuZXJPcHRpb25zKTtcbiAgICBldmVudHMuY2FuY2VsICYmIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50cy5jYW5jZWwsIERyYWdnZXIuX29uQ2FuY2VsLCBsaXN0ZW5lck9wdGlvbnMpO1xuICB9O1xuXG4gIERyYWdnZXIuX3VuYmluZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBldmVudHMgPSBEcmFnZ2VyLl9ldmVudHM7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRzLm1vdmUsIERyYWdnZXIuX29uTW92ZSwgbGlzdGVuZXJPcHRpb25zKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudHMuZW5kLCBEcmFnZ2VyLl9vbkVuZCwgbGlzdGVuZXJPcHRpb25zKTtcbiAgICBldmVudHMuY2FuY2VsICYmIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50cy5jYW5jZWwsIERyYWdnZXIuX29uQ2FuY2VsLCBsaXN0ZW5lck9wdGlvbnMpO1xuICB9O1xuXG4gIERyYWdnZXIuX2dldEV2ZW50UG9pbnRlcklkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAvLyBJZiB3ZSBoYXZlIHBvaW50ZXIgaWQgYXZhaWxhYmxlIGxldCdzIHVzZSBpdC5cbiAgICBpZiAodHlwZW9mIGV2ZW50LnBvaW50ZXJJZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiBldmVudC5wb2ludGVySWQ7XG4gICAgfVxuXG4gICAgLy8gRm9yIHRvdWNoIGV2ZW50cyBsZXQncyBnZXQgdGhlIGZpcnN0IGNoYW5nZWQgdG91Y2gncyBpZGVudGlmaWVyLlxuICAgIGlmIChldmVudC5jaGFuZ2VkVG91Y2hlcykge1xuICAgICAgcmV0dXJuIGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllciA6IG51bGw7XG4gICAgfVxuXG4gICAgLy8gRm9yIG1vdXNlL290aGVyIGV2ZW50cyBsZXQncyBwcm92aWRlIGEgc3RhdGljIGlkLlxuICAgIHJldHVybiAxO1xuICB9O1xuXG4gIERyYWdnZXIuX2dldFRvdWNoQnlJZCA9IGZ1bmN0aW9uKGV2ZW50LCBpZCkge1xuICAgIC8vIElmIHdlIGhhdmUgYSBwb2ludGVyIGV2ZW50IHJldHVybiB0aGUgd2hvbGUgZXZlbnQgaWYgdGhlcmUncyBhIG1hdGNoLCBhbmRcbiAgICAvLyBudWxsIG90aGVyd2lzZS5cbiAgICBpZiAodHlwZW9mIGV2ZW50LnBvaW50ZXJJZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiBldmVudC5wb2ludGVySWQgPT09IGlkID8gZXZlbnQgOiBudWxsO1xuICAgIH1cblxuICAgIC8vIEZvciB0b3VjaCBldmVudHMgbGV0J3MgY2hlY2sgaWYgdGhlcmUncyBhIGNoYW5nZWQgdG91Y2ggb2JqZWN0IHRoYXQgbWF0Y2hlc1xuICAgIC8vIHRoZSBwb2ludGVySWQgaW4gd2hpY2ggY2FzZSByZXR1cm4gdGhlIHRvdWNoIG9iamVjdC5cbiAgICBpZiAoZXZlbnQuY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGV2ZW50LmNoYW5nZWRUb3VjaGVzW2ldLmlkZW50aWZpZXIgPT09IGlkKSB7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50LmNoYW5nZWRUb3VjaGVzW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBGb3IgbW91c2Uvb3RoZXIgZXZlbnRzIGxldCdzIGFzc3VtZSB0aGVyZSdzIG9ubHkgb25lIHBvaW50ZXIgYW5kIGp1c3RcbiAgICAvLyByZXR1cm4gdGhlIGV2ZW50LlxuICAgIHJldHVybiBldmVudDtcbiAgfTtcblxuICBEcmFnZ2VyLl9vbk1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgRHJhZ2dlci5fZW1pdHRlci5lbWl0KGV2ZW50cy5tb3ZlLCBlKTtcbiAgfTtcblxuICBEcmFnZ2VyLl9vbkNhbmNlbCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBEcmFnZ2VyLl9lbWl0dGVyLmVtaXQoZXZlbnRzLmNhbmNlbCwgZSk7XG4gIH07XG5cbiAgRHJhZ2dlci5fb25FbmQgPSBmdW5jdGlvbihlKSB7XG4gICAgRHJhZ2dlci5fZW1pdHRlci5lbWl0KGV2ZW50cy5lbmQsIGUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcml2YXRlIHByb3RvdHlwZSBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIFJlc2V0IGN1cnJlbnQgZHJhZyBvcGVyYXRpb24gKGlmIGFueSkuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuX3Jlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm47XG5cbiAgICB0aGlzLl9wb2ludGVySWQgPSBudWxsO1xuICAgIHRoaXMuX3N0YXJ0VGltZSA9IDA7XG4gICAgdGhpcy5fc3RhcnRYID0gMDtcbiAgICB0aGlzLl9zdGFydFkgPSAwO1xuICAgIHRoaXMuX2N1cnJlbnRYID0gMDtcbiAgICB0aGlzLl9jdXJyZW50WSA9IDA7XG4gICAgdGhpcy5fc3RhcnRFdmVudCA9IG51bGw7XG5cbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXG4gICAgICBEcmFnZ2VyLl90b3VjaEV2ZW50cy5zdGFydCxcbiAgICAgIHRoaXMuX2Fib3J0Tm9uQ2FuY2VsYWJsZSxcbiAgICAgIGxpc3RlbmVyT3B0aW9uc1xuICAgICk7XG5cbiAgICBEcmFnZ2VyLl9kZWFjdGl2YXRlSW5zdGFuY2UodGhpcyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGN1c3RvbSBkcmFnZ2VyIGV2ZW50IGZyb20gYSByYXcgZXZlbnQuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZVxuICAgKiBAcGFyYW0geyhQb2ludGVyRXZlbnR8VG91Y2hFdmVudHxNb3VzZUV2ZW50KX0gZVxuICAgKiBAcmV0dXJucyB7RHJhZ2dlckV2ZW50fVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuX2NyZWF0ZUV2ZW50ID0gZnVuY3Rpb24odHlwZSwgZSkge1xuICAgIHZhciB0b3VjaCA9IHRoaXMuX2dldFRyYWNrZWRUb3VjaChlKTtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gSGFtbWVyLmpzIGNvbXBhdGliaWxpdHkgaW50ZXJmYWNlLlxuICAgICAgdHlwZTogdHlwZSxcbiAgICAgIHNyY0V2ZW50OiBlLFxuICAgICAgZGlzdGFuY2U6IHRoaXMuZ2V0RGlzdGFuY2UoKSxcbiAgICAgIGRlbHRhWDogdGhpcy5nZXREZWx0YVgoKSxcbiAgICAgIGRlbHRhWTogdGhpcy5nZXREZWx0YVkoKSxcbiAgICAgIGRlbHRhVGltZTogdHlwZSA9PT0gZXZlbnRzLnN0YXJ0ID8gMCA6IHRoaXMuZ2V0RGVsdGFUaW1lKCksXG4gICAgICBpc0ZpcnN0OiB0eXBlID09PSBldmVudHMuc3RhcnQsXG4gICAgICBpc0ZpbmFsOiB0eXBlID09PSBldmVudHMuZW5kIHx8IHR5cGUgPT09IGV2ZW50cy5jYW5jZWwsXG4gICAgICAvLyBQYXJ0aWFsIFRvdWNoIEFQSSBpbnRlcmZhY2UuXG4gICAgICBpZGVudGlmaWVyOiB0aGlzLl9wb2ludGVySWQsXG4gICAgICBzY3JlZW5YOiB0b3VjaC5zY3JlZW5YLFxuICAgICAgc2NyZWVuWTogdG91Y2guc2NyZWVuWSxcbiAgICAgIGNsaWVudFg6IHRvdWNoLmNsaWVudFgsXG4gICAgICBjbGllbnRZOiB0b3VjaC5jbGllbnRZLFxuICAgICAgcGFnZVg6IHRvdWNoLnBhZ2VYLFxuICAgICAgcGFnZVk6IHRvdWNoLnBhZ2VZLFxuICAgICAgdGFyZ2V0OiB0b3VjaC50YXJnZXRcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBFbWl0IGEgcmF3IGV2ZW50IGFzIGRyYWdnZXIgZXZlbnQgaW50ZXJuYWxseS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlXG4gICAqIEBwYXJhbSB7KFBvaW50ZXJFdmVudHxUb3VjaEV2ZW50fE1vdXNlRXZlbnQpfSBlXG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5fZW1pdCA9IGZ1bmN0aW9uKHR5cGUsIGUpIHtcbiAgICB0aGlzLl9lbWl0dGVyLmVtaXQodHlwZSwgdGhpcy5fY3JlYXRlRXZlbnQodHlwZSwgZSkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJZiB0aGUgcHJvdmlkZWQgZXZlbnQgaXMgYSBQb2ludGVyRXZlbnQgdGhpcyBtZXRob2Qgd2lsbCByZXR1cm4gaXQgaWYgaXQgaGFzXG4gICAqIHRoZSBzYW1lIHBvaW50ZXJJZCBhcyB0aGUgaW5zdGFuY2UuIElmIHRoZSBwcm92aWRlZCBldmVudCBpcyBhIFRvdWNoRXZlbnRcbiAgICogdGhpcyBtZXRob2Qgd2lsbCB0cnkgdG8gbG9vayBmb3IgYSBUb3VjaCBpbnN0YW5jZSBpbiB0aGUgY2hhbmdlZFRvdWNoZXMgdGhhdFxuICAgKiBoYXMgYW4gaWRlbnRpZmllciBtYXRjaGluZyB0aGlzIGluc3RhbmNlJ3MgcG9pbnRlcklkLiBJZiB0aGUgcHJvdmlkZWQgZXZlbnRcbiAgICogaXMgYSBNb3VzZUV2ZW50IChvciBqdXN0IGFueSBvdGhlciBldmVudCB0aGFuIFBvaW50ZXJFdmVudCBvciBUb3VjaEV2ZW50KVxuICAgKiBpdCB3aWxsIGJlIHJldHVybmVkIGltbWVkaWF0ZWx5LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgRHJhZ2dlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHsoUG9pbnRlckV2ZW50fFRvdWNoRXZlbnR8TW91c2VFdmVudCl9XG4gICAqIEByZXR1cm5zIHs/KFRvdWNofFBvaW50ZXJFdmVudHxNb3VzZUV2ZW50KX1cbiAgICovXG4gIERyYWdnZXIucHJvdG90eXBlLl9nZXRUcmFja2VkVG91Y2ggPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMuX3BvaW50ZXJJZCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBEcmFnZ2VyLl9nZXRUb3VjaEJ5SWQoZSwgdGhpcy5fcG9pbnRlcklkKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEEgcHJlLWhhbmRsZXIgZm9yIHN0YXJ0IGV2ZW50IHRoYXQgY2hlY2tzIGlmIHdlIGNhbiBzdGFydCBkcmFnZ2luZy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7KFBvaW50ZXJFdmVudHxUb3VjaEV2ZW50fE1vdXNlRXZlbnQpfSBlXG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5fcHJlU3RhcnRDaGVjayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcblxuICAgIC8vIE1ha2Ugc3VyZSB0aGUgZWxlbWVudCBpcyBub3QgYmVpbmcgZHJhZ2dlZCBjdXJyZW50bHkuXG4gICAgaWYgKHRoaXMuaXNEcmFnZ2luZygpKSByZXR1cm47XG5cbiAgICAvLyBTcGVjaWFsIGNhbmNlbGFibGUgY2hlY2sgZm9yIEFuZHJvaWQgdG8gcHJldmVudCBkcmFnIHByb2NlZHVyZSBmcm9tXG4gICAgLy8gc3RhcnRpbmcgaWYgbmF0aXZlIHNjcm9sbGluZyBpcyBpbiBwcm9ncmVzcy4gUGFydCAxLlxuICAgIGlmIChpc0FuZHJvaWQgJiYgZS5jYW5jZWxhYmxlID09PSBmYWxzZSkgcmV0dXJuO1xuXG4gICAgLy8gTWFrZSBzdXJlIGxlZnQgYnV0dG9uIGlzIHByZXNzZWQgb24gbW91c2UuXG4gICAgaWYgKGUuYnV0dG9uKSByZXR1cm47XG5cbiAgICAvLyBHZXQgKGFuZCBzZXQpIHBvaW50ZXIgaWQuXG4gICAgdGhpcy5fcG9pbnRlcklkID0gRHJhZ2dlci5fZ2V0RXZlbnRQb2ludGVySWQoZSk7XG4gICAgaWYgKHRoaXMuX3BvaW50ZXJJZCA9PT0gbnVsbCkgcmV0dXJuO1xuXG4gICAgLy8gU3RvcmUgdGhlIHN0YXJ0IGV2ZW50IGFuZCB0cmlnZ2VyIHN0YXJ0IChhc3luYyBvciBzeW5jKS4gUG9pbnRlciBldmVudHNcbiAgICAvLyBhcmUgZW1pdHRlZCBiZWZvcmUgdG91Y2ggZXZlbnRzIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGJvdGggb2YgdGhlbS4gQW5kXG4gICAgLy8gaWYgeW91IHRyeSB0byBtb3ZlIGFuIGVsZW1lbnQgYmVmb3JlIGB0b3VjaHN0YXJ0YCBpcyBlbWl0dGVkIHRoZSBwb2ludGVyXG4gICAgLy8gZXZlbnRzIGZvciB0aGF0IGVsZW1lbnQgd2lsbCBiZSBjYW5jZWxlZC4gVGhlIGZpeCBpcyB0byBkZWxheSB0aGUgZW1pdHRlZFxuICAgIC8vIHBvaW50ZXIgZXZlbnRzIGluIHN1Y2ggYSBzY2VuYXJpbyBieSBvbmUgZnJhbWUgc28gdGhhdCBgdG91Y2hzdGFydGAgaGFzXG4gICAgLy8gdGltZSB0byBiZSBlbWl0dGVkIGJlZm9yZSB0aGUgZWxlbWVudCBpcyAocG90ZW50aWFsbHkpIG1vdmVkLlxuICAgIHRoaXMuX3N0YXJ0RXZlbnQgPSBlO1xuICAgIGlmIChoYXNUb3VjaEV2ZW50cyAmJiAoaGFzUG9pbnRlckV2ZW50cyB8fCBoYXNNc1BvaW50ZXJFdmVudHMpKSB7XG4gICAgICAvLyBTcGVjaWFsIGNhbmNlbGFibGUgY2hlY2sgZm9yIEFuZHJvaWQgdG8gcHJldmVudCBkcmFnIHByb2NlZHVyZSBmcm9tXG4gICAgICAvLyBzdGFydGluZyBpZiBuYXRpdmUgc2Nyb2xsaW5nIGlzIGluIHByb2dyZXNzLiBQYXJ0IDIuXG4gICAgICBpZiAoaXNBbmRyb2lkKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICBEcmFnZ2VyLl90b3VjaEV2ZW50cy5zdGFydCxcbiAgICAgICAgICB0aGlzLl9hYm9ydE5vbkNhbmNlbGFibGUsXG4gICAgICAgICAgbGlzdGVuZXJPcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByYWYodGhpcy5fb25TdGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX29uU3RhcnQoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEFib3J0IHN0YXJ0IGV2ZW50IGlmIGl0IHR1cm5zIG91dCB0byBiZSBub24tY2FuY2VsYWJsZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7KFBvaW50ZXJFdmVudHxUb3VjaEV2ZW50fE1vdXNlRXZlbnQpfSBlXG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5fYWJvcnROb25DYW5jZWxhYmxlID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgIERyYWdnZXIuX3RvdWNoRXZlbnRzLnN0YXJ0LFxuICAgICAgdGhpcy5fYWJvcnROb25DYW5jZWxhYmxlLFxuICAgICAgbGlzdGVuZXJPcHRpb25zXG4gICAgKTtcblxuICAgIGlmICh0aGlzLl9zdGFydEV2ZW50ICYmIGUuY2FuY2VsYWJsZSA9PT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuX3BvaW50ZXJJZCA9IG51bGw7XG4gICAgICB0aGlzLl9zdGFydEV2ZW50ID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSBkcmFnIHByb2NlZHVyZSBpZiBwb3NzaWJsZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5fb25TdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlID0gdGhpcy5fc3RhcnRFdmVudDtcbiAgICBpZiAoIWUpIHJldHVybjtcblxuICAgIHRoaXMuX3N0YXJ0RXZlbnQgPSBudWxsO1xuXG4gICAgdmFyIHRvdWNoID0gdGhpcy5fZ2V0VHJhY2tlZFRvdWNoKGUpO1xuICAgIGlmICghdG91Y2gpIHJldHVybjtcblxuICAgIC8vIFNldCB1cCBpbml0IGRhdGEgYW5kIGVtaXQgc3RhcnQgZXZlbnQuXG4gICAgdGhpcy5fc3RhcnRYID0gdGhpcy5fY3VycmVudFggPSB0b3VjaC5jbGllbnRYO1xuICAgIHRoaXMuX3N0YXJ0WSA9IHRoaXMuX2N1cnJlbnRZID0gdG91Y2guY2xpZW50WTtcbiAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2VtaXQoZXZlbnRzLnN0YXJ0LCBlKTtcbiAgICBEcmFnZ2VyLl9hY3RpdmF0ZUluc3RhbmNlKHRoaXMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGVyIGZvciBtb3ZlIGV2ZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgRHJhZ2dlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHsoUG9pbnRlckV2ZW50fFRvdWNoRXZlbnR8TW91c2VFdmVudCl9IGVcbiAgICovXG4gIERyYWdnZXIucHJvdG90eXBlLl9vbk1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIHRvdWNoID0gdGhpcy5fZ2V0VHJhY2tlZFRvdWNoKGUpO1xuICAgIGlmICghdG91Y2gpIHJldHVybjtcblxuICAgIHRoaXMuX2N1cnJlbnRYID0gdG91Y2guY2xpZW50WDtcbiAgICB0aGlzLl9jdXJyZW50WSA9IHRvdWNoLmNsaWVudFk7XG4gICAgdGhpcy5fZW1pdChldmVudHMubW92ZSwgZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZXIgZm9yIG1vdmUgY2FuY2VsIGV2ZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgRHJhZ2dlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHsoUG9pbnRlckV2ZW50fFRvdWNoRXZlbnR8TW91c2VFdmVudCl9IGVcbiAgICovXG4gIERyYWdnZXIucHJvdG90eXBlLl9vbkNhbmNlbCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoIXRoaXMuX2dldFRyYWNrZWRUb3VjaChlKSkgcmV0dXJuO1xuXG4gICAgdGhpcy5fZW1pdChldmVudHMuY2FuY2VsLCBlKTtcbiAgICB0aGlzLl9yZXNldCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGVyIGZvciBlbmQgZXZlbnQuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0geyhQb2ludGVyRXZlbnR8VG91Y2hFdmVudHxNb3VzZUV2ZW50KX0gZVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuX29uRW5kID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICghdGhpcy5fZ2V0VHJhY2tlZFRvdWNoKGUpKSByZXR1cm47XG5cbiAgICB0aGlzLl9lbWl0KGV2ZW50cy5lbmQsIGUpO1xuICAgIHRoaXMuX3Jlc2V0KCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHRoZSBlbGVtZW50IGlzIGJlaW5nIGRyYWdnZWQgYXQgdGhlIG1vbWVudC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgRHJhZ2dlci5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5pc0RyYWdnaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BvaW50ZXJJZCAhPT0gbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogU2V0IGVsZW1lbnQncyB0b3VjaC1hY3Rpb24gQ1NTIHByb3BlcnR5LlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICovXG4gIERyYWdnZXIucHJvdG90eXBlLnNldFRvdWNoQWN0aW9uID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAvLyBTdG9yZSB1bm1vZGlmaWVkIHRvdWNoIGFjdGlvbiB2YWx1ZSAod2UgdHJ1c3QgdXNlciBpbnB1dCBoZXJlKS5cbiAgICB0aGlzLl90b3VjaEFjdGlvbiA9IHZhbHVlO1xuXG4gICAgLy8gU2V0IHRvdWNoLWFjdGlvbiBzdHlsZS5cbiAgICBpZiAodGFQcm9wUHJlZml4ZWQpIHtcbiAgICAgIHRoaXMuX2Nzc1Byb3BzW3RhUHJvcFByZWZpeGVkXSA9ICcnO1xuICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZVt0YVByb3BQcmVmaXhlZF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIGFuIHVuc3VwcG9ydGVkIHRvdWNoLWFjdGlvbiB2YWx1ZSBsZXQncyBhZGQgYSBzcGVjaWFsIGxpc3RlbmVyXG4gICAgLy8gdGhhdCBwcmV2ZW50cyBkZWZhdWx0IGFjdGlvbiBvbiB0b3VjaCBzdGFydCBldmVudC4gQSBkaXJ0eSBoYWNrLCBidXQgYmVzdFxuICAgIC8vIHdlIGNhbiBkbyBmb3Igbm93LiBUaGUgb3RoZXIgb3B0aW9ucyB3b3VsZCBiZSB0byBzb21laG93IHBvbHlmaWxsIHRoZVxuICAgIC8vIHVuc3VwcG9ydGVkIHRvdWNoIGFjdGlvbiBiZWhhdmlvciB3aXRoIGN1c3RvbSBoZXVyaXN0aWNzIHdoaWNoIHNvdW5kcyBsaWtlXG4gICAgLy8gYSBjYW4gb2Ygd29ybXMuXG4gICAgaWYgKGhhc1RvdWNoRXZlbnRzKSB7XG4gICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoRHJhZ2dlci5fdG91Y2hFdmVudHMuc3RhcnQsIERyYWdnZXIuX3ByZXZlbnREZWZhdWx0LCBmYWxzZSk7XG4gICAgICBpZiAodGhpcy5fZWxlbWVudC5zdHlsZVt0YVByb3BQcmVmaXhlZF0gIT09IHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihEcmFnZ2VyLl90b3VjaEV2ZW50cy5zdGFydCwgRHJhZ2dlci5fcHJldmVudERlZmF1bHQsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBlbGVtZW50J3MgQ1NTIHByb3BlcnRpZXMuIEFjY2VwdHMgYW4gb2JqZWN0IHdpdGggY2FtZWwgY2FzZWQgc3R5bGVcbiAgICogcHJvcHMgd2l0aCB2YWx1ZSBwYWlycyBhcyBpdCdzIGZpcnN0IGFyZ3VtZW50LlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge09iamVjdH0gW25ld1Byb3BzXVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuc2V0Q3NzUHJvcHMgPSBmdW5jdGlvbihuZXdQcm9wcykge1xuICAgIGlmICghbmV3UHJvcHMpIHJldHVybjtcblxuICAgIHZhciBjdXJyZW50UHJvcHMgPSB0aGlzLl9jc3NQcm9wcztcbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQ7XG4gICAgdmFyIHByb3A7XG4gICAgdmFyIHByZWZpeGVkUHJvcDtcblxuICAgIC8vIFJlc2V0IGN1cnJlbnQgcHJvcHMuXG4gICAgZm9yIChwcm9wIGluIGN1cnJlbnRQcm9wcykge1xuICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IGN1cnJlbnRQcm9wc1twcm9wXTtcbiAgICAgIGRlbGV0ZSBjdXJyZW50UHJvcHNbcHJvcF07XG4gICAgfVxuXG4gICAgLy8gU2V0IG5ldyBwcm9wcy5cbiAgICBmb3IgKHByb3AgaW4gbmV3UHJvcHMpIHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgdmFsdWUgZm9yIHRoZSBwcm9wLlxuICAgICAgaWYgKCFuZXdQcm9wc1twcm9wXSkgY29udGludWU7XG5cbiAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHRvdWNoLWFjdGlvbi5cbiAgICAgIGlmIChwcm9wID09PSB0YVByb3ApIHtcbiAgICAgICAgdGhpcy5zZXRUb3VjaEFjdGlvbihuZXdQcm9wc1twcm9wXSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgcHJlZml4ZWQgcHJvcCBhbmQgc2tpcCBpZiBpdCBkb2VzIG5vdCBleGlzdC5cbiAgICAgIHByZWZpeGVkUHJvcCA9IGdldFByZWZpeGVkUHJvcE5hbWUoZWxlbWVudC5zdHlsZSwgcHJvcCk7XG4gICAgICBpZiAoIXByZWZpeGVkUHJvcCkgY29udGludWU7XG5cbiAgICAgIC8vIFN0b3JlIHRoZSBwcm9wIGFuZCBhZGQgdGhlIHN0eWxlLlxuICAgICAgY3VycmVudFByb3BzW3ByZWZpeGVkUHJvcF0gPSAnJztcbiAgICAgIGVsZW1lbnQuc3R5bGVbcHJlZml4ZWRQcm9wXSA9IG5ld1Byb3BzW3Byb3BdO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogSG93IG11Y2ggdGhlIHBvaW50ZXIgaGFzIG1vdmVkIG9uIHgtYXhpcyBmcm9tIHN0YXJ0IHBvc2l0aW9uLCBpbiBwaXhlbHMuXG4gICAqIFBvc2l0aXZlIHZhbHVlIGluZGljYXRlcyBtb3ZlbWVudCBmcm9tIGxlZnQgdG8gcmlnaHQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5nZXREZWx0YVggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudFggLSB0aGlzLl9zdGFydFg7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhvdyBtdWNoIHRoZSBwb2ludGVyIGhhcyBtb3ZlZCBvbiB5LWF4aXMgZnJvbSBzdGFydCBwb3NpdGlvbiwgaW4gcGl4ZWxzLlxuICAgKiBQb3NpdGl2ZSB2YWx1ZSBpbmRpY2F0ZXMgbW92ZW1lbnQgZnJvbSB0b3AgdG8gYm90dG9tLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuZ2V0RGVsdGFZID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRZIC0gdGhpcy5fc3RhcnRZO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIb3cgZmFyIChpbiBwaXhlbHMpIGhhcyBwb2ludGVyIG1vdmVkIGZyb20gc3RhcnQgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIERyYWdnZXIucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBEcmFnZ2VyLnByb3RvdHlwZS5nZXREaXN0YW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB4ID0gdGhpcy5nZXREZWx0YVgoKTtcbiAgICB2YXIgeSA9IHRoaXMuZ2V0RGVsdGFZKCk7XG4gICAgcmV0dXJuIE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgfTtcblxuICAvKipcbiAgICogSG93IGxvbmcgaGFzIHBvaW50ZXIgYmVlbiBkcmFnZ2VkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUuZ2V0RGVsdGFUaW1lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXJ0VGltZSA/IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWUgOiAwO1xuICB9O1xuXG4gIC8qKlxuICAgKiBCaW5kIGRyYWcgZXZlbnQgbGlzdGVuZXJzLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lXG4gICAqICAgLSAnc3RhcnQnLCAnbW92ZScsICdjYW5jZWwnIG9yICdlbmQnLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lclxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbihldmVudE5hbWUsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5fZW1pdHRlci5vbihldmVudE5hbWUsIGxpc3RlbmVyKTtcbiAgfTtcblxuICAvKipcbiAgICogVW5iaW5kIGRyYWcgZXZlbnQgbGlzdGVuZXJzLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBEcmFnZ2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lXG4gICAqICAgLSAnc3RhcnQnLCAnbW92ZScsICdjYW5jZWwnIG9yICdlbmQnLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lclxuICAgKi9cbiAgRHJhZ2dlci5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oZXZlbnRzLCBsaXN0ZW5lcikge1xuICAgIHRoaXMuX2VtaXR0ZXIub2ZmKGV2ZW50TmFtZSwgbGlzdGVuZXIpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBpbnN0YW5jZSBhbmQgdW5iaW5kIGFsbCBkcmFnIGV2ZW50IGxpc3RlbmVycy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgRHJhZ2dlci5wcm90b3R5cGVcbiAgICovXG4gIERyYWdnZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcblxuICAgIHZhciBlbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcbiAgICB2YXIgZXZlbnRzID0gRHJhZ2dlci5fZXZlbnRzO1xuXG4gICAgLy8gUmVzZXQgZGF0YSBhbmQgZGVhY3RpdmF0ZSB0aGUgaW5zdGFuY2UuXG4gICAgdGhpcy5fcmVzZXQoKTtcblxuICAgIC8vIERlc3Ryb3kgZW1pdHRlci5cbiAgICB0aGlzLl9lbWl0dGVyLmRlc3Ryb3koKTtcblxuICAgIC8vIFVuYmluZCBldmVudCBoYW5kbGVycy5cbiAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRzLnN0YXJ0LCB0aGlzLl9wcmVTdGFydENoZWNrLCBsaXN0ZW5lck9wdGlvbnMpO1xuICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihEcmFnZ2VyLl9tb3VzZUV2ZW50cy5zdGFydCwgdGhpcy5fcHJlU3RhcnRDaGVjaywgbGlzdGVuZXJPcHRpb25zKTtcbiAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIERyYWdnZXIuX3ByZXZlbnREZWZhdWx0LCBmYWxzZSk7XG4gICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKERyYWdnZXIuX3RvdWNoRXZlbnRzLnN0YXJ0LCBEcmFnZ2VyLl9wcmV2ZW50RGVmYXVsdCwgZmFsc2UpO1xuXG4gICAgLy8gUmVzZXQgc3R5bGVzLlxuICAgIGZvciAodmFyIHByb3AgaW4gdGhpcy5fY3NzUHJvcHMpIHtcbiAgICAgIGVsZW1lbnQuc3R5bGVbcHJvcF0gPSB0aGlzLl9jc3NQcm9wc1twcm9wXTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9jc3NQcm9wc1twcm9wXTtcbiAgICB9XG5cbiAgICAvLyBSZXNldCBkYXRhLlxuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuXG4gICAgLy8gTWFyayBhcyBkZXN0cm95ZWQuXG4gICAgdGhpcy5faXNEZXN0cm95ZWQgPSB0cnVlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBBIHRpY2tlciBzeXN0ZW0gZm9yIGhhbmRsaW5nIERPTSByZWFkcyBhbmQgd3JpdGVzIGluIGFuIGVmZmljaWVudCB3YXkuXG4gICAqIENvbnRhaW5zIGEgcmVhZCBxdWV1ZSBhbmQgYSB3cml0ZSBxdWV1ZSB0aGF0IGFyZSBwcm9jZXNzZWQgb24gdGhlIG5leHRcbiAgICogYW5pbWF0aW9uIGZyYW1lIHdoZW4gbmVlZGVkLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICovXG4gIGZ1bmN0aW9uIFRpY2tlcigpIHtcbiAgICB0aGlzLl9uZXh0U3RlcCA9IG51bGw7XG5cbiAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgIHRoaXMuX3JlYWRzID0ge307XG4gICAgdGhpcy5fd3JpdGVzID0ge307XG5cbiAgICB0aGlzLl9iYXRjaCA9IFtdO1xuICAgIHRoaXMuX2JhdGNoUmVhZHMgPSB7fTtcbiAgICB0aGlzLl9iYXRjaFdyaXRlcyA9IHt9O1xuXG4gICAgdGhpcy5fc3RlcCA9IHRoaXMuX3N0ZXAuYmluZCh0aGlzKTtcbiAgfVxuXG4gIFRpY2tlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oaWQsIHJlYWRPcGVyYXRpb24sIHdyaXRlT3BlcmF0aW9uLCBpc1ByaW9yaXRpemVkKSB7XG4gICAgLy8gRmlyc3QsIGxldCdzIGNoZWNrIGlmIGFuIGl0ZW0gaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHF1ZXVlcyB3aXRoIHRoZSBzYW1lIGlkXG4gICAgLy8gYW5kIGlmIHNvIC0+IHJlbW92ZSBpdC5cbiAgICB2YXIgY3VycmVudEluZGV4ID0gdGhpcy5fcXVldWUuaW5kZXhPZihpZCk7XG4gICAgaWYgKGN1cnJlbnRJbmRleCA+IC0xKSB0aGlzLl9xdWV1ZVtjdXJyZW50SW5kZXhdID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gQWRkIGVudHJ5LlxuICAgIGlzUHJpb3JpdGl6ZWQgPyB0aGlzLl9xdWV1ZS51bnNoaWZ0KGlkKSA6IHRoaXMuX3F1ZXVlLnB1c2goaWQpO1xuICAgIHRoaXMuX3JlYWRzW2lkXSA9IHJlYWRPcGVyYXRpb247XG4gICAgdGhpcy5fd3JpdGVzW2lkXSA9IHdyaXRlT3BlcmF0aW9uO1xuXG4gICAgLy8gRmluYWxseSwgbGV0J3Mga2ljay1zdGFydCB0aGUgbmV4dCB0aWNrIGlmIGl0IGlzIG5vdCBydW5uaW5nIHlldC5cbiAgICBpZiAoIXRoaXMuX25leHRTdGVwKSB0aGlzLl9uZXh0U3RlcCA9IHJhZih0aGlzLl9zdGVwKTtcbiAgfTtcblxuICBUaWNrZXIucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIGN1cnJlbnRJbmRleCA9IHRoaXMuX3F1ZXVlLmluZGV4T2YoaWQpO1xuICAgIGlmIChjdXJyZW50SW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5fcXVldWVbY3VycmVudEluZGV4XSA9IHVuZGVmaW5lZDtcbiAgICAgIGRlbGV0ZSB0aGlzLl9yZWFkc1tpZF07XG4gICAgICBkZWxldGUgdGhpcy5fd3JpdGVzW2lkXTtcbiAgICB9XG4gIH07XG5cbiAgVGlja2VyLnByb3RvdHlwZS5fc3RlcCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHZhciByZWFkcyA9IHRoaXMuX3JlYWRzO1xuICAgIHZhciB3cml0ZXMgPSB0aGlzLl93cml0ZXM7XG4gICAgdmFyIGJhdGNoID0gdGhpcy5fYmF0Y2g7XG4gICAgdmFyIGJhdGNoUmVhZHMgPSB0aGlzLl9iYXRjaFJlYWRzO1xuICAgIHZhciBiYXRjaFdyaXRlcyA9IHRoaXMuX2JhdGNoV3JpdGVzO1xuICAgIHZhciBsZW5ndGggPSBxdWV1ZS5sZW5ndGg7XG4gICAgdmFyIGlkO1xuICAgIHZhciBpO1xuXG4gICAgLy8gUmVzZXQgdGlja2VyLlxuICAgIHRoaXMuX25leHRTdGVwID0gbnVsbDtcblxuICAgIC8vIFNldHVwIHF1ZXVlcyBhbmQgY2FsbGJhY2sgcGxhY2Vob2xkZXJzLlxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWQgPSBxdWV1ZVtpXTtcbiAgICAgIGlmICghaWQpIGNvbnRpbnVlO1xuXG4gICAgICBiYXRjaC5wdXNoKGlkKTtcblxuICAgICAgYmF0Y2hSZWFkc1tpZF0gPSByZWFkc1tpZF07XG4gICAgICBkZWxldGUgcmVhZHNbaWRdO1xuXG4gICAgICBiYXRjaFdyaXRlc1tpZF0gPSB3cml0ZXNbaWRdO1xuICAgICAgZGVsZXRlIHdyaXRlc1tpZF07XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgcXVldWUuXG4gICAgcXVldWUubGVuZ3RoID0gMDtcblxuICAgIC8vIFByb2Nlc3MgcmVhZCBjYWxsYmFja3MuXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZCA9IGJhdGNoW2ldO1xuICAgICAgaWYgKGJhdGNoUmVhZHNbaWRdKSB7XG4gICAgICAgIGJhdGNoUmVhZHNbaWRdKCk7XG4gICAgICAgIGRlbGV0ZSBiYXRjaFJlYWRzW2lkXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIHdyaXRlIGNhbGxiYWNrcy5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlkID0gYmF0Y2hbaV07XG4gICAgICBpZiAoYmF0Y2hXcml0ZXNbaWRdKSB7XG4gICAgICAgIGJhdGNoV3JpdGVzW2lkXSgpO1xuICAgICAgICBkZWxldGUgYmF0Y2hXcml0ZXNbaWRdO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlc2V0IGJhdGNoLlxuICAgIGJhdGNoLmxlbmd0aCA9IDA7XG5cbiAgICAvLyBSZXN0YXJ0IHRoZSB0aWNrZXIgaWYgbmVlZGVkLlxuICAgIGlmICghdGhpcy5fbmV4dFN0ZXAgJiYgcXVldWUubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9uZXh0U3RlcCA9IHJhZih0aGlzLl9zdGVwKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIHRpY2tlciA9IG5ldyBUaWNrZXIoKTtcblxuICB2YXIgbGF5b3V0VGljayA9ICdsYXlvdXQnO1xuICB2YXIgdmlzaWJpbGl0eVRpY2sgPSAndmlzaWJpbGl0eSc7XG4gIHZhciBtb3ZlVGljayA9ICdtb3ZlJztcbiAgdmFyIHNjcm9sbFRpY2sgPSAnc2Nyb2xsJztcbiAgdmFyIHBsYWNlaG9sZGVyVGljayA9ICdwbGFjZWhvbGRlcic7XG5cbiAgZnVuY3Rpb24gYWRkTGF5b3V0VGljayhpdGVtSWQsIHJlYWRDYWxsYmFjaywgd3JpdGVDYWxsYmFjaykge1xuICAgIHJldHVybiB0aWNrZXIuYWRkKGl0ZW1JZCArIGxheW91dFRpY2ssIHJlYWRDYWxsYmFjaywgd3JpdGVDYWxsYmFjayk7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWxMYXlvdXRUaWNrKGl0ZW1JZCkge1xuICAgIHJldHVybiB0aWNrZXIuY2FuY2VsKGl0ZW1JZCArIGxheW91dFRpY2spO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkVmlzaWJpbGl0eVRpY2soaXRlbUlkLCByZWFkQ2FsbGJhY2ssIHdyaXRlQ2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGlja2VyLmFkZChpdGVtSWQgKyB2aXNpYmlsaXR5VGljaywgcmVhZENhbGxiYWNrLCB3cml0ZUNhbGxiYWNrKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbmNlbFZpc2liaWxpdHlUaWNrKGl0ZW1JZCkge1xuICAgIHJldHVybiB0aWNrZXIuY2FuY2VsKGl0ZW1JZCArIHZpc2liaWxpdHlUaWNrKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZE1vdmVUaWNrKGl0ZW1JZCwgcmVhZENhbGxiYWNrLCB3cml0ZUNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRpY2tlci5hZGQoaXRlbUlkICsgbW92ZVRpY2ssIHJlYWRDYWxsYmFjaywgd3JpdGVDYWxsYmFjaywgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWxNb3ZlVGljayhpdGVtSWQpIHtcbiAgICByZXR1cm4gdGlja2VyLmNhbmNlbChpdGVtSWQgKyBtb3ZlVGljayk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRTY3JvbGxUaWNrKGl0ZW1JZCwgcmVhZENhbGxiYWNrLCB3cml0ZUNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRpY2tlci5hZGQoaXRlbUlkICsgc2Nyb2xsVGljaywgcmVhZENhbGxiYWNrLCB3cml0ZUNhbGxiYWNrLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbmNlbFNjcm9sbFRpY2soaXRlbUlkKSB7XG4gICAgcmV0dXJuIHRpY2tlci5jYW5jZWwoaXRlbUlkICsgc2Nyb2xsVGljayk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRQbGFjZWhvbGRlclRpY2soaXRlbUlkLCByZWFkQ2FsbGJhY2ssIHdyaXRlQ2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGlja2VyLmFkZChpdGVtSWQgKyBwbGFjZWhvbGRlclRpY2ssIHJlYWRDYWxsYmFjaywgd3JpdGVDYWxsYmFjayk7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWxQbGFjZWhvbGRlclRpY2soaXRlbUlkKSB7XG4gICAgcmV0dXJuIHRpY2tlci5jYW5jZWwoaXRlbUlkICsgcGxhY2Vob2xkZXJUaWNrKTtcbiAgfVxuXG4gIHZhciBFbFByb3RvID0gd2luZG93LkVsZW1lbnQucHJvdG90eXBlO1xuICB2YXIgbWF0Y2hlc0ZuID1cbiAgICBFbFByb3RvLm1hdGNoZXMgfHxcbiAgICBFbFByb3RvLm1hdGNoZXNTZWxlY3RvciB8fFxuICAgIEVsUHJvdG8ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8XG4gICAgRWxQcm90by5tb3pNYXRjaGVzU2VsZWN0b3IgfHxcbiAgICBFbFByb3RvLm1zTWF0Y2hlc1NlbGVjdG9yIHx8XG4gICAgRWxQcm90by5vTWF0Y2hlc1NlbGVjdG9yIHx8XG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgZWxlbWVudCBtYXRjaGVzIGEgQ1NTIHNlbGVjdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvclxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVzKGVsLCBzZWxlY3Rvcikge1xuICAgIHJldHVybiBtYXRjaGVzRm4uY2FsbChlbCwgc2VsZWN0b3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBjbGFzcyB0byBhbiBlbGVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWVcbiAgICovXG4gIGZ1bmN0aW9uIGFkZENsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdCkge1xuICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghZWxlbWVudE1hdGNoZXMoZWxlbWVudCwgJy4nICsgY2xhc3NOYW1lKSkge1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyBjbGFzc05hbWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmFyIHRlbXBBcnJheSA9IFtdO1xuICB2YXIgbnVtYmVyVHlwZSA9ICdudW1iZXInO1xuXG4gIC8qKlxuICAgKiBJbnNlcnQgYW4gaXRlbSBvciBhbiBhcnJheSBvZiBpdGVtcyB0byBhcnJheSB0byBhIHNwZWNpZmllZCBpbmRleC4gTXV0YXRlc1xuICAgKiB0aGUgYXJyYXkuIFRoZSBpbmRleCBjYW4gYmUgbmVnYXRpdmUgaW4gd2hpY2ggY2FzZSB0aGUgaXRlbXMgd2lsbCBiZSBhZGRlZFxuICAgKiB0byB0aGUgZW5kIG9mIHRoZSBhcnJheS5cbiAgICpcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAgICogQHBhcmFtIHsqfSBpdGVtc1xuICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4PS0xXVxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlJbnNlcnQoYXJyYXksIGl0ZW1zLCBpbmRleCkge1xuICAgIHZhciBzdGFydEluZGV4ID0gdHlwZW9mIGluZGV4ID09PSBudW1iZXJUeXBlID8gaW5kZXggOiAtMTtcbiAgICBpZiAoc3RhcnRJbmRleCA8IDApIHN0YXJ0SW5kZXggPSBhcnJheS5sZW5ndGggLSBzdGFydEluZGV4ICsgMTtcblxuICAgIGFycmF5LnNwbGljZS5hcHBseShhcnJheSwgdGVtcEFycmF5LmNvbmNhdChzdGFydEluZGV4LCAwLCBpdGVtcykpO1xuICAgIHRlbXBBcnJheS5sZW5ndGggPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vcm1hbGl6ZSBhcnJheSBpbmRleC4gQmFzaWNhbGx5IHRoaXMgZnVuY3Rpb24gbWFrZXMgc3VyZSB0aGF0IHRoZSBwcm92aWRlZFxuICAgKiBhcnJheSBpbmRleCBpcyB3aXRoaW4gdGhlIGJvdW5kcyBvZiB0aGUgcHJvdmlkZWQgYXJyYXkgYW5kIGFsc28gdHJhbnNmb3Jtc1xuICAgKiBuZWdhdGl2ZSBpbmRleCB0byB0aGUgbWF0Y2hpbmcgcG9zaXRpdmUgaW5kZXguXG4gICAqXG4gICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleFxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzTWlncmF0aW9uXG4gICAqL1xuICBmdW5jdGlvbiBub3JtYWxpemVBcnJheUluZGV4KGFycmF5LCBpbmRleCwgaXNNaWdyYXRpb24pIHtcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgIHZhciBtYXhJbmRleCA9IE1hdGgubWF4KDAsIGlzTWlncmF0aW9uID8gbGVuZ3RoIDogbGVuZ3RoIC0gMSk7XG4gICAgcmV0dXJuIGluZGV4ID4gbWF4SW5kZXggPyBtYXhJbmRleCA6IGluZGV4IDwgMCA/IE1hdGgubWF4KG1heEluZGV4ICsgaW5kZXggKyAxLCAwKSA6IGluZGV4O1xuICB9XG5cbiAgLyoqXG4gICAqIE1vdmUgYXJyYXkgaXRlbSB0byBhbm90aGVyIGluZGV4LlxuICAgKlxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICAgKiBAcGFyYW0ge051bWJlcn0gZnJvbUluZGV4XG4gICAqICAgLSBJbmRleCAocG9zaXRpdmUgb3IgbmVnYXRpdmUpIG9mIHRoZSBpdGVtIHRoYXQgd2lsbCBiZSBtb3ZlZC5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IHRvSW5kZXhcbiAgICogICAtIEluZGV4IChwb3NpdGl2ZSBvciBuZWdhdGl2ZSkgd2hlcmUgdGhlIGl0ZW0gc2hvdWxkIGJlIG1vdmVkIHRvLlxuICAgKi9cbiAgZnVuY3Rpb24gYXJyYXlNb3ZlKGFycmF5LCBmcm9tSW5kZXgsIHRvSW5kZXgpIHtcbiAgICAvLyBNYWtlIHN1cmUgdGhlIGFycmF5IGhhcyB0d28gb3IgbW9yZSBpdGVtcy5cbiAgICBpZiAoYXJyYXkubGVuZ3RoIDwgMikgcmV0dXJuO1xuXG4gICAgLy8gTm9ybWFsaXplIHRoZSBpbmRpY2VzLlxuICAgIHZhciBmcm9tID0gbm9ybWFsaXplQXJyYXlJbmRleChhcnJheSwgZnJvbUluZGV4KTtcbiAgICB2YXIgdG8gPSBub3JtYWxpemVBcnJheUluZGV4KGFycmF5LCB0b0luZGV4KTtcblxuICAgIC8vIEFkZCB0YXJnZXQgaXRlbSB0byB0aGUgbmV3IHBvc2l0aW9uLlxuICAgIGlmIChmcm9tICE9PSB0bykge1xuICAgICAgYXJyYXkuc3BsaWNlKHRvLCAwLCBhcnJheS5zcGxpY2UoZnJvbSwgMSlbMF0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTd2FwIGFycmF5IGl0ZW1zLlxuICAgKlxuICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXhcbiAgICogICAtIEluZGV4IChwb3NpdGl2ZSBvciBuZWdhdGl2ZSkgb2YgdGhlIGl0ZW0gdGhhdCB3aWxsIGJlIHN3YXBwZWQuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB3aXRoSW5kZXhcbiAgICogICAtIEluZGV4IChwb3NpdGl2ZSBvciBuZWdhdGl2ZSkgb2YgdGhlIG90aGVyIGl0ZW0gdGhhdCB3aWxsIGJlIHN3YXBwZWQuXG4gICAqL1xuICBmdW5jdGlvbiBhcnJheVN3YXAoYXJyYXksIGluZGV4LCB3aXRoSW5kZXgpIHtcbiAgICAvLyBNYWtlIHN1cmUgdGhlIGFycmF5IGhhcyB0d28gb3IgbW9yZSBpdGVtcy5cbiAgICBpZiAoYXJyYXkubGVuZ3RoIDwgMikgcmV0dXJuO1xuXG4gICAgLy8gTm9ybWFsaXplIHRoZSBpbmRpY2VzLlxuICAgIHZhciBpbmRleEEgPSBub3JtYWxpemVBcnJheUluZGV4KGFycmF5LCBpbmRleCk7XG4gICAgdmFyIGluZGV4QiA9IG5vcm1hbGl6ZUFycmF5SW5kZXgoYXJyYXksIHdpdGhJbmRleCk7XG4gICAgdmFyIHRlbXA7XG5cbiAgICAvLyBTd2FwIHRoZSBpdGVtcy5cbiAgICBpZiAoaW5kZXhBICE9PSBpbmRleEIpIHtcbiAgICAgIHRlbXAgPSBhcnJheVtpbmRleEFdO1xuICAgICAgYXJyYXlbaW5kZXhBXSA9IGFycmF5W2luZGV4Ql07XG4gICAgICBhcnJheVtpbmRleEJdID0gdGVtcDtcbiAgICB9XG4gIH1cblxuICB2YXIgYWN0aW9uQ2FuY2VsID0gJ2NhbmNlbCc7XG4gIHZhciBhY3Rpb25GaW5pc2ggPSAnZmluaXNoJztcbiAgdmFyIGRlYm91bmNlVGljayA9ICdkZWJvdW5jZSc7XG4gIHZhciBkZWJvdW5jZUlkID0gMDtcblxuICAvKipcbiAgICogUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuICAgKiBiZSB0cmlnZ2VyZWQuIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciBpdCBzdG9wcyBiZWluZyBjYWxsZWQgZm9yXG4gICAqIE4gbWlsbGlzZWNvbmRzLiBUaGUgcmV0dXJuZWQgZnVuY3Rpb24gYWNjZXB0cyBvbmUgYXJndW1lbnQgd2hpY2gsIHdoZW5cbiAgICogYmVpbmcgXCJmaW5pc2hcIiwgY2FsbHMgdGhlIGRlYm91bmNlIGZ1bmN0aW9uIGltbWVkaWF0ZWx5IGlmIGl0IGlzIGN1cnJlbnRseVxuICAgKiB3YWl0aW5nIHRvIGJlIGNhbGxlZCwgYW5kIHdoZW4gYmVpbmcgXCJjYW5jZWxcIiBjYW5jZWxzIHRoZSBjdXJyZW50bHkgcXVldWVkXG4gICAqIGZ1bmN0aW9uIGNhbGwuXG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB3YWl0XG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn1cbiAgICovXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZuLCB3YWl0KSB7XG4gICAgdmFyIHRpbWVvdXQ7XG4gICAgdmFyIHRpY2tlcklkID0gKytkZWJvdW5jZUlkICsgZGVib3VuY2VUaWNrO1xuXG4gICAgaWYgKHdhaXQgPiAwKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oYWN0aW9uKSB7XG4gICAgICAgIGlmICh0aW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aW1lb3V0ID0gd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICB0aWNrZXIuY2FuY2VsKHRpY2tlcklkKTtcbiAgICAgICAgICBpZiAoYWN0aW9uID09PSBhY3Rpb25GaW5pc2gpIGZuKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aW9uICE9PSBhY3Rpb25DYW5jZWwgJiYgYWN0aW9uICE9PSBhY3Rpb25GaW5pc2gpIHtcbiAgICAgICAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGlja2VyLmFkZCh0aWNrZXJJZCwgZm4sIG51bGwsIHRydWUpO1xuICAgICAgICAgIH0sIHdhaXQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbihhY3Rpb24pIHtcbiAgICAgIGlmIChhY3Rpb24gIT09IGFjdGlvbkNhbmNlbCkgZm4oKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSBpZiBlbGVtZW50IGlzIHRyYW5zZm9ybWVkLCBmYWxzZSBpZiBub3QuIEluIHByYWN0aWNlIHRoZVxuICAgKiBlbGVtZW50J3MgZGlzcGxheSB2YWx1ZSBtdXN0IGJlIGFueXRoaW5nIGVsc2UgdGhhbiBcIm5vbmVcIiBvciBcImlubGluZVwiIGFzXG4gICAqIHdlbGwgYXMgaGF2ZSBhIHZhbGlkIHRyYW5zZm9ybSB2YWx1ZSBhcHBsaWVkIGluIG9yZGVyIHRvIGJlIGNvdW50ZWQgYXMgYVxuICAgKiB0cmFuc2Zvcm1lZCBlbGVtZW50LlxuICAgKlxuICAgKiBCb3Jyb3dlZCBmcm9tIE1lenIgKHYwLjYuMSk6XG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9uaWtsYXNyYW1vL21lenIvYmxvYi8wLjYuMS9tZXpyLmpzI0w2NjFcbiAgICpcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGlzVHJhbnNmb3JtZWQoZWxlbWVudCkge1xuICAgIHZhciB0cmFuc2Zvcm0gPSBnZXRTdHlsZShlbGVtZW50LCAndHJhbnNmb3JtJyk7XG4gICAgaWYgKCF0cmFuc2Zvcm0gfHwgdHJhbnNmb3JtID09PSAnbm9uZScpIHJldHVybiBmYWxzZTtcblxuICAgIHZhciBkaXNwbGF5ID0gZ2V0U3R5bGUoZWxlbWVudCwgJ2Rpc3BsYXknKTtcbiAgICBpZiAoZGlzcGxheSA9PT0gJ2lubGluZScgfHwgZGlzcGxheSA9PT0gJ25vbmUnKSByZXR1cm4gZmFsc2U7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGFic29sdXRlIHBvc2l0aW9uZWQgZWxlbWVudCdzIGNvbnRhaW5pbmcgYmxvY2ssIHdoaWNoIGlzXG4gICAqIGNvbnNpZGVyZWQgdG8gYmUgdGhlIGNsb3Nlc3QgYW5jZXN0b3IgZWxlbWVudCB0aGF0IHRoZSB0YXJnZXQgZWxlbWVudCdzXG4gICAqIHBvc2l0aW9uaW5nIGlzIHJlbGF0aXZlIHRvLiBEaXNjbGFpbWVyOiB0aGlzIG9ubHkgd29ya3MgYXMgaW50ZW5kZWQgZm9yXG4gICAqIGFic29sdXRlIHBvc2l0aW9uZWQgZWxlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5jbHVkZVNlbGY9ZmFsc2VdXG4gICAqICAgLSBXaGVuIHRoaXMgaXMgc2V0IHRvIHRydWUgdGhlIGNvbnRhaW5pbmcgYmxvY2sgY2hlY2tpbmcgaXMgc3RhcnRlZCBmcm9tXG4gICAqICAgICB0aGUgcHJvdmlkZWQgZWxlbWVudC4gT3RoZXJ3aXNlIHRoZSBjaGVja2luZyBpcyBzdGFydGVkIGZyb20gdGhlXG4gICAqICAgICBwcm92aWRlZCBlbGVtZW50J3MgcGFyZW50IGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHsoRG9jdW1lbnR8RWxlbWVudCl9XG4gICAqL1xuICBmdW5jdGlvbiBnZXRDb250YWluaW5nQmxvY2soZWxlbWVudCwgaW5jbHVkZVNlbGYpIHtcbiAgICAvLyBBcyBsb25nIGFzIHRoZSBjb250YWluaW5nIGJsb2NrIGlzIGFuIGVsZW1lbnQsIHN0YXRpYyBhbmQgbm90XG4gICAgLy8gdHJhbnNmb3JtZWQsIHRyeSB0byBnZXQgdGhlIGVsZW1lbnQncyBwYXJlbnQgZWxlbWVudCBhbmQgZmFsbGJhY2sgdG9cbiAgICAvLyBkb2N1bWVudC4gaHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3JhbW8vbWV6ci9ibG9iLzAuNi4xL21lenIuanMjTDMzOVxuICAgIHZhciBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDtcbiAgICB2YXIgcmV0ID0gKGluY2x1ZGVTZWxmID8gZWxlbWVudCA6IGVsZW1lbnQucGFyZW50RWxlbWVudCkgfHwgZG9jdW1lbnQ7XG4gICAgd2hpbGUgKHJldCAmJiByZXQgIT09IGRvY3VtZW50ICYmIGdldFN0eWxlKHJldCwgJ3Bvc2l0aW9uJykgPT09ICdzdGF0aWMnICYmICFpc1RyYW5zZm9ybWVkKHJldCkpIHtcbiAgICAgIHJldCA9IHJldC5wYXJlbnRFbGVtZW50IHx8IGRvY3VtZW50O1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbXB1dGVkIHZhbHVlIG9mIGFuIGVsZW1lbnQncyBzdHlsZSBwcm9wZXJ0eSB0cmFuc2Zvcm1lZCBpbnRvXG4gICAqIGEgZmxvYXQgdmFsdWUuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHlsZVxuICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0U3R5bGVBc0Zsb2F0KGVsLCBzdHlsZSkge1xuICAgIHJldHVybiBwYXJzZUZsb2F0KGdldFN0eWxlKGVsLCBzdHlsZSkpIHx8IDA7XG4gIH1cblxuICB2YXIgb2Zmc2V0QSA9IHt9O1xuICB2YXIgb2Zmc2V0QiA9IHt9O1xuICB2YXIgb2Zmc2V0RGlmZiA9IHt9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50J3MgZG9jdW1lbnQgb2Zmc2V0LCB3aGljaCBpbiBwcmFjdGljZSBtZWFucyB0aGUgdmVydGljYWxcbiAgICogYW5kIGhvcml6b250YWwgZGlzdGFuY2UgYmV0d2VlbiB0aGUgZWxlbWVudCdzIG5vcnRod2VzdCBjb3JuZXIgYW5kIHRoZVxuICAgKiBkb2N1bWVudCdzIG5vcnRod2VzdCBjb3JuZXIuIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGFsd2F5cyByZXR1cm5zIHRoZSBzYW1lXG4gICAqIG9iamVjdCBzbyBiZSBzdXJlIHRvIHJlYWQgdGhlIGRhdGEgZnJvbSBpdCBpbnN0ZWFkIHVzaW5nIGl0IGFzIGEgcmVmZXJlbmNlLlxuICAgKlxuICAgKiBAcGFyYW0geyhEb2N1bWVudHxFbGVtZW50fFdpbmRvdyl9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvZmZzZXREYXRhXVxuICAgKiAgIC0gT3B0aW9uYWwgZGF0YSBvYmplY3Qgd2hlcmUgdGhlIG9mZnNldCBkYXRhIHdpbGwgYmUgaW5zZXJ0ZWQgdG8uIElmIG5vdFxuICAgKiAgICAgcHJvdmlkZWQgYSBuZXcgb2JqZWN0IHdpbGwgYmUgY3JlYXRlZCBmb3IgdGhlIHJldHVybiBkYXRhLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0T2Zmc2V0KGVsZW1lbnQsIG9mZnNldERhdGEpIHtcbiAgICB2YXIgcmV0ID0gb2Zmc2V0RGF0YSB8fCB7fTtcbiAgICB2YXIgcmVjdDtcblxuICAgIC8vIFNldCB1cCByZXR1cm4gZGF0YS5cbiAgICByZXQubGVmdCA9IDA7XG4gICAgcmV0LnRvcCA9IDA7XG5cbiAgICAvLyBEb2N1bWVudCdzIG9mZnNldHMgYXJlIGFsd2F5cyAwLlxuICAgIGlmIChlbGVtZW50ID09PSBkb2N1bWVudCkgcmV0dXJuIHJldDtcblxuICAgIC8vIEFkZCB2aWV3cG9ydCBzY3JvbGwgbGVmdC90b3AgdG8gdGhlIHJlc3BlY3RpdmUgb2Zmc2V0cy5cbiAgICByZXQubGVmdCA9IHdpbmRvdy5wYWdlWE9mZnNldCB8fCAwO1xuICAgIHJldC50b3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgMDtcblxuICAgIC8vIFdpbmRvdydzIG9mZnNldHMgYXJlIHRoZSB2aWV3cG9ydCBzY3JvbGwgbGVmdC90b3AgdmFsdWVzLlxuICAgIGlmIChlbGVtZW50LnNlbGYgPT09IHdpbmRvdy5zZWxmKSByZXR1cm4gcmV0O1xuXG4gICAgLy8gQWRkIGVsZW1lbnQncyBjbGllbnQgcmVjdHMgdG8gdGhlIG9mZnNldHMuXG4gICAgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcmV0LmxlZnQgKz0gcmVjdC5sZWZ0O1xuICAgIHJldC50b3AgKz0gcmVjdC50b3A7XG5cbiAgICAvLyBFeGNsdWRlIGVsZW1lbnQncyBib3JkZXJzIGZyb20gdGhlIG9mZnNldC5cbiAgICByZXQubGVmdCArPSBnZXRTdHlsZUFzRmxvYXQoZWxlbWVudCwgJ2JvcmRlci1sZWZ0LXdpZHRoJyk7XG4gICAgcmV0LnRvcCArPSBnZXRTdHlsZUFzRmxvYXQoZWxlbWVudCwgJ2JvcmRlci10b3Atd2lkdGgnKTtcblxuICAgIHJldHVybiByZXQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSBvZmZzZXQgZGlmZmVyZW5jZSB0d28gZWxlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1BXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1CXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NvbXBhcmVDb250YWluaW5nQmxvY2tzPWZhbHNlXVxuICAgKiAgIC0gV2hlbiB0aGlzIGlzIHNldCB0byB0cnVlIHRoZSBjb250YWluaW5nIGJsb2NrcyBvZiB0aGUgcHJvdmlkZWQgZWxlbWVudHNcbiAgICogICAgIHdpbGwgYmUgdXNlZCBmb3IgY2FsY3VsYXRpbmcgdGhlIGRpZmZlcmVuY2UuIE90aGVyd2lzZSB0aGUgcHJvdmlkZWRcbiAgICogICAgIGVsZW1lbnRzIHdpbGwgYmUgY29tcGFyZWQgZGlyZWN0bHkuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAqL1xuICBmdW5jdGlvbiBnZXRPZmZzZXREaWZmKGVsZW1BLCBlbGVtQiwgY29tcGFyZUNvbnRhaW5pbmdCbG9ja3MpIHtcbiAgICBvZmZzZXREaWZmLmxlZnQgPSAwO1xuICAgIG9mZnNldERpZmYudG9wID0gMDtcblxuICAgIC8vIElmIGVsZW1lbnRzIGFyZSBzYW1lIGxldCdzIHJldHVybiBlYXJseS5cbiAgICBpZiAoZWxlbUEgPT09IGVsZW1CKSByZXR1cm4gb2Zmc2V0RGlmZjtcblxuICAgIC8vIENvbXBhcmUgY29udGFpbmluZyBibG9ja3MgaWYgbmVjZXNzYXJ5LlxuICAgIGlmIChjb21wYXJlQ29udGFpbmluZ0Jsb2Nrcykge1xuICAgICAgZWxlbUEgPSBnZXRDb250YWluaW5nQmxvY2soZWxlbUEsIHRydWUpO1xuICAgICAgZWxlbUIgPSBnZXRDb250YWluaW5nQmxvY2soZWxlbUIsIHRydWUpO1xuXG4gICAgICAvLyBJZiBjb250YWluaW5nIGJsb2NrcyBhcmUgaWRlbnRpY2FsLCBsZXQncyByZXR1cm4gZWFybHkuXG4gICAgICBpZiAoZWxlbUEgPT09IGVsZW1CKSByZXR1cm4gb2Zmc2V0RGlmZjtcbiAgICB9XG5cbiAgICAvLyBGaW5hbGx5LCBsZXQncyBjYWxjdWxhdGUgdGhlIG9mZnNldCBkaWZmLlxuICAgIGdldE9mZnNldChlbGVtQSwgb2Zmc2V0QSk7XG4gICAgZ2V0T2Zmc2V0KGVsZW1CLCBvZmZzZXRCKTtcbiAgICBvZmZzZXREaWZmLmxlZnQgPSBvZmZzZXRCLmxlZnQgLSBvZmZzZXRBLmxlZnQ7XG4gICAgb2Zmc2V0RGlmZi50b3AgPSBvZmZzZXRCLnRvcCAtIG9mZnNldEEudG9wO1xuXG4gICAgcmV0dXJuIG9mZnNldERpZmY7XG4gIH1cblxuICB2YXIgc3R5bGVPdmVyZmxvdyA9ICdvdmVyZmxvdyc7XG4gIHZhciBzdHlsZU92ZXJmbG93WCA9ICdvdmVyZmxvdy14JztcbiAgdmFyIHN0eWxlT3ZlcmZsb3dZID0gJ292ZXJmbG93LXknO1xuICB2YXIgb3ZlcmZsb3dBdXRvID0gJ2F1dG8nO1xuICB2YXIgb3ZlcmZsb3dTY3JvbGwgPSAnc2Nyb2xsJztcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYW4gZWxlbWVudCBpcyBzY3JvbGxhYmxlLlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgKi9cbiAgZnVuY3Rpb24gaXNTY3JvbGxhYmxlKGVsZW1lbnQpIHtcbiAgICB2YXIgb3ZlcmZsb3cgPSBnZXRTdHlsZShlbGVtZW50LCBzdHlsZU92ZXJmbG93KTtcbiAgICBpZiAob3ZlcmZsb3cgPT09IG92ZXJmbG93QXV0byB8fCBvdmVyZmxvdyA9PT0gb3ZlcmZsb3dTY3JvbGwpIHJldHVybiB0cnVlO1xuXG4gICAgb3ZlcmZsb3cgPSBnZXRTdHlsZShlbGVtZW50LCBzdHlsZU92ZXJmbG93WCk7XG4gICAgaWYgKG92ZXJmbG93ID09PSBvdmVyZmxvd0F1dG8gfHwgb3ZlcmZsb3cgPT09IG92ZXJmbG93U2Nyb2xsKSByZXR1cm4gdHJ1ZTtcblxuICAgIG92ZXJmbG93ID0gZ2V0U3R5bGUoZWxlbWVudCwgc3R5bGVPdmVyZmxvd1kpO1xuICAgIGlmIChvdmVyZmxvdyA9PT0gb3ZlcmZsb3dBdXRvIHx8IG92ZXJmbG93ID09PSBvdmVyZmxvd1Njcm9sbCkgcmV0dXJuIHRydWU7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdCBlbGVtZW50J3MgYW5jZXN0b3JzIHRoYXQgYXJlIHBvdGVudGlhbGx5IHNjcm9sbGFibGUgZWxlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5jbHVkZVNlbGY9ZmFsc2VdXG4gICAqIEBwYXJhbSB7QXJyYXl9IFtkYXRhXVxuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqL1xuICBmdW5jdGlvbiBnZXRTY3JvbGxhYmxlQW5jZXN0b3JzKGVsZW1lbnQsIGluY2x1ZGVTZWxmLCBkYXRhKSB7XG4gICAgdmFyIHJldCA9IGRhdGEgfHwgW107XG4gICAgdmFyIHBhcmVudCA9IGluY2x1ZGVTZWxmID8gZWxlbWVudCA6IGVsZW1lbnQucGFyZW50Tm9kZTtcblxuICAgIC8vIEZpbmQgc2Nyb2xsIHBhcmVudHMuXG4gICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IGRvY3VtZW50KSB7XG4gICAgICAvLyBJZiBlbGVtZW50IGlzIGluc2lkZSBTaGFkb3dET00gbGV0J3MgZ2V0IGl0J3MgaG9zdCBub2RlIGZyb20gdGhlIHJlYWxcbiAgICAgIC8vIERPTSBhbmQgY29udGludWUgbG9vcGluZy5cbiAgICAgIGlmIChwYXJlbnQuZ2V0Um9vdE5vZGUgJiYgcGFyZW50IGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCkge1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQuZ2V0Um9vdE5vZGUoKS5ob3N0O1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgZWxlbWVudCBpcyBzY3JvbGxhYmxlIGxldCdzIGFkZCBpdCB0byB0aGUgc2Nyb2xsYWJsZSBsaXN0LlxuICAgICAgaWYgKGlzU2Nyb2xsYWJsZShwYXJlbnQpKSB7XG4gICAgICAgIHJldC5wdXNoKHBhcmVudCk7XG4gICAgICB9XG5cbiAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyBhZGQgd2luZG93IHRvIHRoZSByZXN1bHRzLlxuICAgIHJldC5wdXNoKHdpbmRvdyk7XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG5cbiAgdmFyIHRyYW5zbGF0ZVZhbHVlID0ge307XG4gIHZhciB0cmFuc2Zvcm1TdHlsZSQyID0gJ3RyYW5zZm9ybSc7XG4gIHZhciB0cmFuc2Zvcm1Ob25lID0gJ25vbmUnO1xuICB2YXIgcnhNYXQzZCA9IC9ebWF0cml4M2QvO1xuICB2YXIgcnhNYXRUeCA9IC8oW14sXSosKXs0fS87XG4gIHZhciByeE1hdDNkVHggPSAvKFteLF0qLCl7MTJ9LztcbiAgdmFyIHJ4TmV4dEl0ZW0gPSAvW14sXSosLztcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZWxlbWVudCdzIGNvbXB1dGVkIHRyYW5zbGF0ZVggYW5kIHRyYW5zbGF0ZVkgdmFsdWVzIGFzIGEgZmxvYXRzLlxuICAgKiBUaGUgcmV0dXJuZWQgb2JqZWN0IGlzIGFsd2F5cyB0aGUgc2FtZSBvYmplY3QgYW5kIHVwZGF0ZWQgZXZlcnkgdGltZSB0aGlzXG4gICAqIGZ1bmN0aW9uIGlzIGNhbGxlZC5cbiAgICpcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VHJhbnNsYXRlKGVsZW1lbnQpIHtcbiAgICB0cmFuc2xhdGVWYWx1ZS54ID0gMDtcbiAgICB0cmFuc2xhdGVWYWx1ZS55ID0gMDtcblxuICAgIHZhciB0cmFuc2Zvcm0gPSBnZXRTdHlsZShlbGVtZW50LCB0cmFuc2Zvcm1TdHlsZSQyKTtcbiAgICBpZiAoIXRyYW5zZm9ybSB8fCB0cmFuc2Zvcm0gPT09IHRyYW5zZm9ybU5vbmUpIHtcbiAgICAgIHJldHVybiB0cmFuc2xhdGVWYWx1ZTtcbiAgICB9XG5cbiAgICAvLyBUcmFuc2Zvcm0gc3R5bGUgY2FuIGJlIGluIGVpdGhlciBtYXRyaXgzZCguLi4pIG9yIG1hdHJpeCguLi4pLlxuICAgIHZhciBpc01hdDNkID0gcnhNYXQzZC50ZXN0KHRyYW5zZm9ybSk7XG4gICAgdmFyIHRYID0gdHJhbnNmb3JtLnJlcGxhY2UoaXNNYXQzZCA/IHJ4TWF0M2RUeCA6IHJ4TWF0VHgsICcnKTtcbiAgICB2YXIgdFkgPSB0WC5yZXBsYWNlKHJ4TmV4dEl0ZW0sICcnKTtcblxuICAgIHRyYW5zbGF0ZVZhbHVlLnggPSBwYXJzZUZsb2F0KHRYKSB8fCAwO1xuICAgIHRyYW5zbGF0ZVZhbHVlLnkgPSBwYXJzZUZsb2F0KHRZKSB8fCAwO1xuXG4gICAgcmV0dXJuIHRyYW5zbGF0ZVZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zZm9ybSB0cmFuc2xhdGVYIGFuZCB0cmFuc2xhdGVZIHZhbHVlIGludG8gQ1NTIHRyYW5zZm9ybSBzdHlsZVxuICAgKiBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgKiBAcGFyYW0ge051bWJlcn0geVxuICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VHJhbnNsYXRlU3RyaW5nKHgsIHkpIHtcbiAgICByZXR1cm4gJ3RyYW5zbGF0ZVgoJyArIHggKyAncHgpIHRyYW5zbGF0ZVkoJyArIHkgKyAncHgpJztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgY2xhc3MgZnJvbSBhbiBlbGVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWVcbiAgICovXG4gIGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdCkge1xuICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlbGVtZW50TWF0Y2hlcyhlbGVtZW50LCAnLicgKyBjbGFzc05hbWUpKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gKCcgJyArIGVsZW1lbnQuY2xhc3NOYW1lICsgJyAnKVxuICAgICAgICAgIC5yZXBsYWNlKCcgJyArIGNsYXNzTmFtZSArICcgJywgJyAnKVxuICAgICAgICAgIC50cmltKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gRHJhZyBzdGFydCBwcmVkaWNhdGUgc3RhdGVzLlxuICB2YXIgc3RhcnRQcmVkaWNhdGVJbmFjdGl2ZSA9IDA7XG4gIHZhciBzdGFydFByZWRpY2F0ZVBlbmRpbmcgPSAxO1xuICB2YXIgc3RhcnRQcmVkaWNhdGVSZXNvbHZlZCA9IDI7XG4gIHZhciBzdGFydFByZWRpY2F0ZVJlamVjdGVkID0gMztcblxuICAvKipcbiAgICogQmluZCB0b3VjaCBpbnRlcmFjdGlvbiB0byBhbiBpdGVtLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqL1xuICBmdW5jdGlvbiBJdGVtRHJhZyhpdGVtKSB7XG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gaXRlbS5nZXRHcmlkKCk7XG4gICAgdmFyIHNldHRpbmdzID0gZ3JpZC5fc2V0dGluZ3M7XG5cbiAgICB0aGlzLl9pdGVtID0gaXRlbTtcbiAgICB0aGlzLl9ncmlkSWQgPSBncmlkLl9pZDtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuX2lzTWlncmF0aW5nID0gZmFsc2U7XG5cbiAgICAvLyBTdGFydCBwcmVkaWNhdGUgZGF0YS5cbiAgICB0aGlzLl9zdGFydFByZWRpY2F0ZSA9IGlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1N0YXJ0UHJlZGljYXRlKVxuICAgICAgPyBzZXR0aW5ncy5kcmFnU3RhcnRQcmVkaWNhdGVcbiAgICAgIDogSXRlbURyYWcuZGVmYXVsdFN0YXJ0UHJlZGljYXRlO1xuICAgIHRoaXMuX3N0YXJ0UHJlZGljYXRlU3RhdGUgPSBzdGFydFByZWRpY2F0ZUluYWN0aXZlO1xuICAgIHRoaXMuX3N0YXJ0UHJlZGljYXRlUmVzdWx0ID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gRGF0YSBmb3IgZHJhZyBzb3J0IHByZWRpY2F0ZSBoZXVyaXN0aWNzLlxuICAgIHRoaXMuX2hCbG9ja2VkSW5kZXggPSBudWxsO1xuICAgIHRoaXMuX2hYMSA9IDA7XG4gICAgdGhpcy5faFgyID0gMDtcbiAgICB0aGlzLl9oWTEgPSAwO1xuICAgIHRoaXMuX2hZMiA9IDA7XG5cbiAgICAvLyBTZXR1cCBpdGVtJ3MgaW5pdGlhbCBkcmFnIGRhdGEuXG4gICAgdGhpcy5fcmVzZXQoKTtcblxuICAgIC8vIEJpbmQgdGhlIG1ldGhvZHMgdGhhdCBuZWVkcyBiaW5kaW5nLlxuICAgIHRoaXMuX3ByZVN0YXJ0Q2hlY2sgPSB0aGlzLl9wcmVTdGFydENoZWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fcHJlRW5kQ2hlY2sgPSB0aGlzLl9wcmVFbmRDaGVjay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uU2Nyb2xsID0gdGhpcy5fb25TY3JvbGwuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9wcmVwYXJlTW92ZSA9IHRoaXMuX3ByZXBhcmVNb3ZlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fYXBwbHlNb3ZlID0gdGhpcy5fYXBwbHlNb3ZlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fcHJlcGFyZVNjcm9sbCA9IHRoaXMuX3ByZXBhcmVTY3JvbGwuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9hcHBseVNjcm9sbCA9IHRoaXMuX2FwcGx5U2Nyb2xsLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fY2hlY2tPdmVybGFwID0gdGhpcy5fY2hlY2tPdmVybGFwLmJpbmQodGhpcyk7XG5cbiAgICAvLyBDcmVhdGUgZGVib3VuY2Ugb3ZlcmxhcCBjaGVja2VyIGZ1bmN0aW9uLlxuICAgIHZhciBzb3J0SW50ZXJ2YWwgPSBzZXR0aW5ncy5kcmFnU29ydEhldXJpc3RpY3Muc29ydEludGVydmFsO1xuICAgIHRoaXMuX2NoZWNrT3ZlcmxhcERlYm91bmNlID0gZGVib3VuY2UodGhpcy5fY2hlY2tPdmVybGFwLCBzb3J0SW50ZXJ2YWwpO1xuXG4gICAgLy8gSW5pdCBkcmFnZ2VyLlxuICAgIHRoaXMuX2RyYWdnZXIgPSBuZXcgRHJhZ2dlcihlbGVtZW50LCBzZXR0aW5ncy5kcmFnQ3NzUHJvcHMpO1xuICAgIHRoaXMuX2RyYWdnZXIub24oJ3N0YXJ0JywgdGhpcy5fcHJlU3RhcnRDaGVjayk7XG4gICAgdGhpcy5fZHJhZ2dlci5vbignbW92ZScsIHRoaXMuX3ByZVN0YXJ0Q2hlY2spO1xuICAgIHRoaXMuX2RyYWdnZXIub24oJ2NhbmNlbCcsIHRoaXMuX3ByZUVuZENoZWNrKTtcbiAgICB0aGlzLl9kcmFnZ2VyLm9uKCdlbmQnLCB0aGlzLl9wcmVFbmRDaGVjayk7XG4gIH1cblxuICAvKipcbiAgICogUHVibGljIHN0YXRpYyBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogRGVmYXVsdCBkcmFnIHN0YXJ0IHByZWRpY2F0ZSBoYW5kbGVyIHRoYXQgaGFuZGxlcyBhbmNob3IgZWxlbWVudHNcbiAgICogZ3JhY2VmdWxseS4gVGhlIHJldHVybiB2YWx1ZSBvZiB0aGlzIGZ1bmN0aW9uIGRlZmluZXMgaWYgdGhlIGRyYWcgaXNcbiAgICogc3RhcnRlZCwgcmVqZWN0ZWQgb3IgcGVuZGluZy4gV2hlbiB0cnVlIGlzIHJldHVybmVkIHRoZSBkcmFnZ2luZyBpcyBzdGFydGVkXG4gICAqIGFuZCB3aGVuIGZhbHNlIGlzIHJldHVybmVkIHRoZSBkcmFnZ2luZyBpcyByZWplY3RlZC4gSWYgbm90aGluZyBpcyByZXR1cm5lZFxuICAgKiB0aGUgcHJlZGljYXRlIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IGRyYWcgbW92ZW1lbnQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnXG4gICAqIEBwYXJhbSB7SXRlbX0gaXRlbVxuICAgKiBAcGFyYW0ge0RyYWdnZXJFdmVudH0gZXZlbnRcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiAgIC0gQW4gb3B0aW9uYWwgb3B0aW9ucyBvYmplY3Qgd2hpY2ggY2FuIGJlIHVzZWQgdG8gcGFzcyB0aGUgcHJlZGljYXRlXG4gICAqICAgICBpdCdzIG9wdGlvbnMgbWFudWFsbHkuIEJ5IGRlZmF1bHQgdGhlIHByZWRpY2F0ZSByZXRyaWV2ZXMgdGhlIG9wdGlvbnNcbiAgICogICAgIGZyb20gdGhlIGdyaWQncyBzZXR0aW5ncy5cbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBJdGVtRHJhZy5kZWZhdWx0U3RhcnRQcmVkaWNhdGUgPSBmdW5jdGlvbihpdGVtLCBldmVudCwgb3B0aW9ucykge1xuICAgIHZhciBkcmFnID0gaXRlbS5fZHJhZztcbiAgICB2YXIgcHJlZGljYXRlID0gZHJhZy5fc3RhcnRQcmVkaWNhdGVEYXRhIHx8IGRyYWcuX3NldHVwU3RhcnRQcmVkaWNhdGUob3B0aW9ucyk7XG5cbiAgICAvLyBGaW5hbCBldmVudCBsb2dpYy4gQXQgdGhpcyBzdGFnZSByZXR1cm4gdmFsdWUgZG9lcyBub3QgbWF0dGVyIGFueW1vcmUsXG4gICAgLy8gdGhlIHByZWRpY2F0ZSBpcyBlaXRoZXIgcmVzb2x2ZWQgb3IgaXQncyBub3QgYW5kIHRoZXJlJ3Mgbm90aGluZyB0byBkb1xuICAgIC8vIGFib3V0IGl0LiBIZXJlIHdlIGp1c3QgcmVzZXQgZGF0YSBhbmQgaWYgdGhlIGl0ZW0gZWxlbWVudCBpcyBhIGxpbmtcbiAgICAvLyB3ZSBmb2xsb3cgaXQgKGlmIHRoZXJlIGhhcyBvbmx5IGJlZW4gc2xpZ2h0IG1vdmVtZW50KS5cbiAgICBpZiAoZXZlbnQuaXNGaW5hbCkge1xuICAgICAgZHJhZy5fZmluaXNoU3RhcnRQcmVkaWNhdGUoZXZlbnQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEZpbmQgYW5kIHN0b3JlIHRoZSBoYW5kbGUgZWxlbWVudCBzbyB3ZSBjYW4gY2hlY2sgbGF0ZXIgb24gaWYgdGhlXG4gICAgLy8gY3Vyc29yIGlzIHdpdGhpbiB0aGUgaGFuZGxlLiBJZiB3ZSBoYXZlIGEgaGFuZGxlIHNlbGVjdG9yIGxldCdzIGZpbmRcbiAgICAvLyB0aGUgY29ycmVzcG9uZGluZyBlbGVtZW50LiBPdGhlcndpc2UgbGV0J3MgdXNlIHRoZSBpdGVtIGVsZW1lbnQgYXMgdGhlXG4gICAgLy8gaGFuZGxlLlxuICAgIGlmICghcHJlZGljYXRlLmhhbmRsZUVsZW1lbnQpIHtcbiAgICAgIHByZWRpY2F0ZS5oYW5kbGVFbGVtZW50ID0gZHJhZy5fZ2V0U3RhcnRQcmVkaWNhdGVIYW5kbGUoZXZlbnQpO1xuICAgICAgaWYgKCFwcmVkaWNhdGUuaGFuZGxlRWxlbWVudCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIElmIGRlbGF5IGlzIGRlZmluZWQgbGV0J3Mga2VlcCB0cmFjayBvZiB0aGUgbGF0ZXN0IGV2ZW50IGFuZCBpbml0aWF0ZVxuICAgIC8vIGRlbGF5IGlmIGl0IGhhcyBub3QgYmVlbiBkb25lIHlldC5cbiAgICBpZiAocHJlZGljYXRlLmRlbGF5KSB7XG4gICAgICBwcmVkaWNhdGUuZXZlbnQgPSBldmVudDtcbiAgICAgIGlmICghcHJlZGljYXRlLmRlbGF5VGltZXIpIHtcbiAgICAgICAgcHJlZGljYXRlLmRlbGF5VGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBwcmVkaWNhdGUuZGVsYXkgPSAwO1xuICAgICAgICAgIGlmIChkcmFnLl9yZXNvbHZlU3RhcnRQcmVkaWNhdGUocHJlZGljYXRlLmV2ZW50KSkge1xuICAgICAgICAgICAgZHJhZy5fZm9yY2VSZXNvbHZlU3RhcnRQcmVkaWNhdGUocHJlZGljYXRlLmV2ZW50KTtcbiAgICAgICAgICAgIGRyYWcuX3Jlc2V0U3RhcnRQcmVkaWNhdGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHByZWRpY2F0ZS5kZWxheSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRyYWcuX3Jlc29sdmVTdGFydFByZWRpY2F0ZShldmVudCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgZHJhZyBzb3J0IHByZWRpY2F0ZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLnRocmVzaG9sZD01MF1cbiAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmFjdGlvbj0nbW92ZSddXG4gICAqIEByZXR1cm5zIHsoQm9vbGVhbnxEcmFnU29ydENvbW1hbmQpfVxuICAgKiAgIC0gUmV0dXJucyBmYWxzZSBpZiBubyB2YWxpZCBpbmRleCB3YXMgZm91bmQuIE90aGVyd2lzZSByZXR1cm5zIGRyYWcgc29ydFxuICAgKiAgICAgY29tbWFuZC5cbiAgICovXG4gIEl0ZW1EcmFnLmRlZmF1bHRTb3J0UHJlZGljYXRlID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBpdGVtUmVjdCA9IHt9O1xuICAgIHZhciB0YXJnZXRSZWN0ID0ge307XG4gICAgdmFyIHJldHVybkRhdGEgPSB7fTtcbiAgICB2YXIgcm9vdEdyaWRBcnJheSA9IFtdO1xuXG4gICAgZnVuY3Rpb24gZ2V0VGFyZ2V0R3JpZChpdGVtLCByb290R3JpZCwgdGhyZXNob2xkKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gbnVsbDtcbiAgICAgIHZhciBkcmFnU29ydCA9IHJvb3RHcmlkLl9zZXR0aW5ncy5kcmFnU29ydDtcbiAgICAgIHZhciBiZXN0U2NvcmUgPSAtMTtcbiAgICAgIHZhciBncmlkU2NvcmU7XG4gICAgICB2YXIgZ3JpZHM7XG4gICAgICB2YXIgZ3JpZDtcbiAgICAgIHZhciBpO1xuXG4gICAgICAvLyBHZXQgcG90ZW50aWFsIHRhcmdldCBncmlkcy5cbiAgICAgIGlmIChkcmFnU29ydCA9PT0gdHJ1ZSkge1xuICAgICAgICByb290R3JpZEFycmF5WzBdID0gcm9vdEdyaWQ7XG4gICAgICAgIGdyaWRzID0gcm9vdEdyaWRBcnJheTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdyaWRzID0gZHJhZ1NvcnQuY2FsbChyb290R3JpZCwgaXRlbSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gZ3JpZHMuXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZ3JpZHMpKSByZXR1cm4gdGFyZ2V0O1xuXG4gICAgICAvLyBMb29wIHRocm91Z2ggdGhlIGdyaWRzIGFuZCBnZXQgdGhlIGJlc3QgbWF0Y2guXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgZ3JpZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZ3JpZCA9IGdyaWRzW2ldO1xuXG4gICAgICAgIC8vIEZpbHRlciBvdXQgYWxsIGRlc3Ryb3llZCBncmlkcy5cbiAgICAgICAgaWYgKGdyaWQuX2lzRGVzdHJveWVkKSBjb250aW51ZTtcblxuICAgICAgICAvLyBXZSBuZWVkIHRvIHVwZGF0ZSB0aGUgZ3JpZCdzIG9mZnNldHMgYW5kIGRpbWVuc2lvbnMgc2luY2UgdGhleSBtaWdodFxuICAgICAgICAvLyBoYXZlIGNoYW5nZWQgKGUuZyBkdXJpbmcgc2Nyb2xsaW5nKS5cbiAgICAgICAgZ3JpZC5fdXBkYXRlQm91bmRpbmdSZWN0KCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaG93IG11Y2ggZHJhZ2dlZCBlbGVtZW50IG92ZXJsYXBzIHRoZSBjb250YWluZXIgZWxlbWVudC5cbiAgICAgICAgdGFyZ2V0UmVjdC53aWR0aCA9IGdyaWQuX3dpZHRoO1xuICAgICAgICB0YXJnZXRSZWN0LmhlaWdodCA9IGdyaWQuX2hlaWdodDtcbiAgICAgICAgdGFyZ2V0UmVjdC5sZWZ0ID0gZ3JpZC5fbGVmdDtcbiAgICAgICAgdGFyZ2V0UmVjdC50b3AgPSBncmlkLl90b3A7XG4gICAgICAgIGdyaWRTY29yZSA9IGdldFJlY3RPdmVybGFwU2NvcmUoaXRlbVJlY3QsIHRhcmdldFJlY3QpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoaXMgZ3JpZCBpcyB0aGUgYmVzdCBtYXRjaCBzbyBmYXIuXG4gICAgICAgIGlmIChncmlkU2NvcmUgPiB0aHJlc2hvbGQgJiYgZ3JpZFNjb3JlID4gYmVzdFNjb3JlKSB7XG4gICAgICAgICAgYmVzdFNjb3JlID0gZ3JpZFNjb3JlO1xuICAgICAgICAgIHRhcmdldCA9IGdyaWQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQWx3YXlzIHJlc2V0IHJvb3QgZ3JpZCBhcnJheS5cbiAgICAgIHJvb3RHcmlkQXJyYXkubGVuZ3RoID0gMDtcblxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oaXRlbSwgb3B0aW9ucykge1xuICAgICAgdmFyIGRyYWcgPSBpdGVtLl9kcmFnO1xuICAgICAgdmFyIHJvb3RHcmlkID0gZHJhZy5fZ2V0R3JpZCgpO1xuXG4gICAgICAvLyBHZXQgZHJhZyBzb3J0IHByZWRpY2F0ZSBzZXR0aW5ncy5cbiAgICAgIHZhciBzb3J0VGhyZXNob2xkID0gb3B0aW9ucyAmJiB0eXBlb2Ygb3B0aW9ucy50aHJlc2hvbGQgPT09ICdudW1iZXInID8gb3B0aW9ucy50aHJlc2hvbGQgOiA1MDtcbiAgICAgIHZhciBzb3J0QWN0aW9uID0gb3B0aW9ucyAmJiBvcHRpb25zLmFjdGlvbiA9PT0gYWN0aW9uU3dhcCA/IGFjdGlvblN3YXAgOiBhY3Rpb25Nb3ZlO1xuXG4gICAgICAvLyBQb3B1bGF0ZSBpdGVtIHJlY3QgZGF0YS5cbiAgICAgIGl0ZW1SZWN0LndpZHRoID0gaXRlbS5fd2lkdGg7XG4gICAgICBpdGVtUmVjdC5oZWlnaHQgPSBpdGVtLl9oZWlnaHQ7XG4gICAgICBpdGVtUmVjdC5sZWZ0ID0gZHJhZy5fZWxlbWVudENsaWVudFg7XG4gICAgICBpdGVtUmVjdC50b3AgPSBkcmFnLl9lbGVtZW50Q2xpZW50WTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB0YXJnZXQgZ3JpZC5cbiAgICAgIHZhciBncmlkID0gZ2V0VGFyZ2V0R3JpZChpdGVtLCByb290R3JpZCwgc29ydFRocmVzaG9sZCk7XG5cbiAgICAgIC8vIFJldHVybiBlYXJseSBpZiB3ZSBmb3VuZCBubyBncmlkIGNvbnRhaW5lciBlbGVtZW50IHRoYXQgb3ZlcmxhcHMgdGhlXG4gICAgICAvLyBkcmFnZ2VkIGl0ZW0gZW5vdWdoLlxuICAgICAgaWYgKCFncmlkKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIHZhciBncmlkT2Zmc2V0TGVmdCA9IDA7XG4gICAgICB2YXIgZ3JpZE9mZnNldFRvcCA9IDA7XG4gICAgICB2YXIgbWF0Y2hTY29yZSA9IC0xO1xuICAgICAgdmFyIG1hdGNoSW5kZXg7XG4gICAgICB2YXIgaGFzVmFsaWRUYXJnZXRzO1xuICAgICAgdmFyIHRhcmdldDtcbiAgICAgIHZhciBzY29yZTtcbiAgICAgIHZhciBpO1xuXG4gICAgICAvLyBJZiBpdGVtIGlzIG1vdmVkIHdpdGhpbiBpdCdzIG9yaWdpbmF0aW5nIGdyaWQgYWRqdXN0IGl0ZW0ncyBsZWZ0IGFuZFxuICAgICAgLy8gdG9wIHByb3BzLiBPdGhlcndpc2UgaWYgaXRlbSBpcyBtb3ZlZCB0by93aXRoaW4gYW5vdGhlciBncmlkIGdldCB0aGVcbiAgICAgIC8vIGNvbnRhaW5lciBlbGVtZW50J3Mgb2Zmc2V0IChmcm9tIHRoZSBlbGVtZW50J3MgY29udGVudCBlZGdlKS5cbiAgICAgIGlmIChncmlkID09PSByb290R3JpZCkge1xuICAgICAgICBpdGVtUmVjdC5sZWZ0ID0gZHJhZy5fZ3JpZFggKyBpdGVtLl9tYXJnaW5MZWZ0O1xuICAgICAgICBpdGVtUmVjdC50b3AgPSBkcmFnLl9ncmlkWSArIGl0ZW0uX21hcmdpblRvcDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdyaWQuX3VwZGF0ZUJvcmRlcnMoMSwgMCwgMSwgMCk7XG4gICAgICAgIGdyaWRPZmZzZXRMZWZ0ID0gZ3JpZC5fbGVmdCArIGdyaWQuX2JvcmRlckxlZnQ7XG4gICAgICAgIGdyaWRPZmZzZXRUb3AgPSBncmlkLl90b3AgKyBncmlkLl9ib3JkZXJUb3A7XG4gICAgICB9XG5cbiAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgdGFyZ2V0IGdyaWQgaXRlbXMgYW5kIHRyeSB0byBmaW5kIHRoZSBiZXN0IG1hdGNoLlxuICAgICAgZm9yIChpID0gMDsgaSA8IGdyaWQuX2l0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRhcmdldCA9IGdyaWQuX2l0ZW1zW2ldO1xuXG4gICAgICAgIC8vIElmIHRoZSB0YXJnZXQgaXRlbSBpcyBub3QgYWN0aXZlIG9yIHRoZSB0YXJnZXQgaXRlbSBpcyB0aGUgZHJhZ2dlZFxuICAgICAgICAvLyBpdGVtIGxldCdzIHNraXAgdG8gdGhlIG5leHQgaXRlbS5cbiAgICAgICAgaWYgKCF0YXJnZXQuX2lzQWN0aXZlIHx8IHRhcmdldCA9PT0gaXRlbSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTWFyayB0aGUgZ3JpZCBhcyBoYXZpbmcgdmFsaWQgdGFyZ2V0IGl0ZW1zLlxuICAgICAgICBoYXNWYWxpZFRhcmdldHMgPSB0cnVlO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgdGFyZ2V0J3Mgb3ZlcmxhcCBzY29yZSB3aXRoIHRoZSBkcmFnZ2VkIGl0ZW0uXG4gICAgICAgIHRhcmdldFJlY3Qud2lkdGggPSB0YXJnZXQuX3dpZHRoO1xuICAgICAgICB0YXJnZXRSZWN0LmhlaWdodCA9IHRhcmdldC5faGVpZ2h0O1xuICAgICAgICB0YXJnZXRSZWN0LmxlZnQgPSB0YXJnZXQuX2xlZnQgKyB0YXJnZXQuX21hcmdpbkxlZnQgKyBncmlkT2Zmc2V0TGVmdDtcbiAgICAgICAgdGFyZ2V0UmVjdC50b3AgPSB0YXJnZXQuX3RvcCArIHRhcmdldC5fbWFyZ2luVG9wICsgZ3JpZE9mZnNldFRvcDtcbiAgICAgICAgc2NvcmUgPSBnZXRSZWN0T3ZlcmxhcFNjb3JlKGl0ZW1SZWN0LCB0YXJnZXRSZWN0KTtcblxuICAgICAgICAvLyBVcGRhdGUgYmVzdCBtYXRjaCBpbmRleCBhbmQgc2NvcmUgaWYgdGhlIHRhcmdldCdzIG92ZXJsYXAgc2NvcmUgd2l0aFxuICAgICAgICAvLyB0aGUgZHJhZ2dlZCBpdGVtIGlzIGhpZ2hlciB0aGFuIHRoZSBjdXJyZW50IGJlc3QgbWF0Y2ggc2NvcmUuXG4gICAgICAgIGlmIChzY29yZSA+IG1hdGNoU2NvcmUpIHtcbiAgICAgICAgICBtYXRjaEluZGV4ID0gaTtcbiAgICAgICAgICBtYXRjaFNjb3JlID0gc2NvcmU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gdmFsaWQgbWF0Y2ggYW5kIHRoZSBpdGVtIGlzIGJlaW5nIG1vdmVkIGludG8gYW5vdGhlclxuICAgICAgLy8gZ3JpZC5cbiAgICAgIGlmIChtYXRjaFNjb3JlIDwgc29ydFRocmVzaG9sZCAmJiBpdGVtLmdldEdyaWQoKSAhPT0gZ3JpZCkge1xuICAgICAgICBtYXRjaEluZGV4ID0gaGFzVmFsaWRUYXJnZXRzID8gLTEgOiAwO1xuICAgICAgICBtYXRjaFNjb3JlID0gSW5maW5pdHk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSBiZXN0IG1hdGNoIG92ZXJsYXBzIGVub3VnaCB0byBqdXN0aWZ5IGEgcGxhY2VtZW50IHN3aXRjaC5cbiAgICAgIGlmIChtYXRjaFNjb3JlID49IHNvcnRUaHJlc2hvbGQpIHtcbiAgICAgICAgcmV0dXJuRGF0YS5ncmlkID0gZ3JpZDtcbiAgICAgICAgcmV0dXJuRGF0YS5pbmRleCA9IG1hdGNoSW5kZXg7XG4gICAgICAgIHJldHVybkRhdGEuYWN0aW9uID0gc29ydEFjdGlvbjtcbiAgICAgICAgcmV0dXJuIHJldHVybkRhdGE7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBBYm9ydCBkcmFnZ2luZyBhbmQgcmVzZXQgZHJhZyBkYXRhLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZy5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0l0ZW1EcmFnfVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gdGhpcy5fZ2V0R3JpZCgpO1xuXG4gICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkgcmV0dXJuIHRoaXM7XG5cbiAgICAvLyBJZiB0aGUgaXRlbSBpcyBiZWluZyBkcm9wcGVkIGludG8gYW5vdGhlciBncmlkLCBmaW5pc2ggaXQgdXAgYW5kIHJldHVyblxuICAgIC8vIGltbWVkaWF0ZWx5LlxuICAgIGlmICh0aGlzLl9pc01pZ3JhdGluZykge1xuICAgICAgdGhpcy5fZmluaXNoTWlncmF0aW9uKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBDYW5jZWwgcXVldWVkIG1vdmUgYW5kIHNjcm9sbCB0aWNrcy5cbiAgICBjYW5jZWxNb3ZlVGljayhpdGVtLl9pZCk7XG4gICAgY2FuY2VsU2Nyb2xsVGljayhpdGVtLl9pZCk7XG5cbiAgICAvLyBSZW1vdmUgc2Nyb2xsIGxpc3RlbmVycy5cbiAgICB0aGlzLl91bmJpbmRTY3JvbGxMaXN0ZW5lcnMoKTtcblxuICAgIC8vIENhbmNlbCBvdmVybGFwIGNoZWNrLlxuICAgIHRoaXMuX2NoZWNrT3ZlcmxhcERlYm91bmNlKCdjYW5jZWwnKTtcblxuICAgIC8vIEFwcGVuZCBpdGVtIGVsZW1lbnQgdG8gdGhlIGNvbnRhaW5lciBpZiBpdCdzIG5vdCBpdCdzIGNoaWxkLiBBbHNvIG1ha2VcbiAgICAvLyBzdXJlIHRoZSB0cmFuc2xhdGUgdmFsdWVzIGFyZSBhZGp1c3RlZCB0byBhY2NvdW50IGZvciB0aGUgRE9NIHNoaWZ0LlxuICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUgIT09IGdyaWQuX2VsZW1lbnQpIHtcbiAgICAgIGdyaWQuX2VsZW1lbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICBlbGVtZW50LnN0eWxlW3RyYW5zZm9ybVByb3BdID0gZ2V0VHJhbnNsYXRlU3RyaW5nKHRoaXMuX2dyaWRYLCB0aGlzLl9ncmlkWSk7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGRyYWdnaW5nIGNsYXNzLlxuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIGdyaWQuX3NldHRpbmdzLml0ZW1EcmFnZ2luZ0NsYXNzKTtcblxuICAgIC8vIFJlc2V0IGRyYWcgZGF0YS5cbiAgICB0aGlzLl9yZXNldCgpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIERlc3Ryb3kgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7SXRlbURyYWd9XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG4gICAgdGhpcy5zdG9wKCk7XG4gICAgdGhpcy5fZHJhZ2dlci5kZXN0cm95KCk7XG4gICAgdGhpcy5faXNEZXN0cm95ZWQgPSB0cnVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcml2YXRlIHByb3RvdHlwZSBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIEdldCBHcmlkIGluc3RhbmNlLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHs/R3JpZH1cbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fZ2V0R3JpZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBncmlkSW5zdGFuY2VzW3RoaXMuX2dyaWRJZF0gfHwgbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogU2V0dXAvcmVzZXQgZHJhZyBkYXRhLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX3Jlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gSXMgaXRlbSBiZWluZyBkcmFnZ2VkP1xuICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XG5cbiAgICAvLyBUaGUgZHJhZ2dlZCBpdGVtJ3MgY29udGFpbmVyIGVsZW1lbnQuXG4gICAgdGhpcy5fY29udGFpbmVyID0gbnVsbDtcblxuICAgIC8vIFRoZSBkcmFnZ2VkIGl0ZW0ncyBjb250YWluaW5nIGJsb2NrLlxuICAgIHRoaXMuX2NvbnRhaW5pbmdCbG9jayA9IG51bGw7XG5cbiAgICAvLyBEcmFnL3Njcm9sbCBldmVudCBkYXRhLlxuICAgIHRoaXMuX2RyYWdFdmVudCA9IG51bGw7XG4gICAgdGhpcy5fc2Nyb2xsRXZlbnQgPSBudWxsO1xuXG4gICAgLy8gQWxsIHRoZSBlbGVtZW50cyB3aGljaCBuZWVkIHRvIGJlIGxpc3RlbmVkIGZvciBzY3JvbGwgZXZlbnRzIGR1cmluZ1xuICAgIC8vIGRyYWdnaW5nLlxuICAgIHRoaXMuX3Njcm9sbGVycyA9IFtdO1xuXG4gICAgLy8gVGhlIGN1cnJlbnQgdHJhbnNsYXRlWC90cmFuc2xhdGVZIHBvc2l0aW9uLlxuICAgIHRoaXMuX2xlZnQgPSAwO1xuICAgIHRoaXMuX3RvcCA9IDA7XG5cbiAgICAvLyBEcmFnZ2VkIGVsZW1lbnQncyBjdXJyZW50IHBvc2l0aW9uIHdpdGhpbiB0aGUgZ3JpZC5cbiAgICB0aGlzLl9ncmlkWCA9IDA7XG4gICAgdGhpcy5fZ3JpZFkgPSAwO1xuXG4gICAgLy8gRHJhZ2dlZCBlbGVtZW50J3MgY3VycmVudCBvZmZzZXQgZnJvbSB3aW5kb3cncyBub3J0aHdlc3QgY29ybmVyLiBEb2VzXG4gICAgLy8gbm90IGFjY291bnQgZm9yIGVsZW1lbnQncyBtYXJnaW5zLlxuICAgIHRoaXMuX2VsZW1lbnRDbGllbnRYID0gMDtcbiAgICB0aGlzLl9lbGVtZW50Q2xpZW50WSA9IDA7XG5cbiAgICAvLyBPZmZzZXQgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBkcmFnZ2VkIGVsZW1lbnQncyB0ZW1wb3JhcnkgZHJhZ1xuICAgIC8vIGNvbnRhaW5lciBhbmQgaXQncyBvcmlnaW5hbCBjb250YWluZXIuXG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSAwO1xuICAgIHRoaXMuX2NvbnRhaW5lckRpZmZZID0gMDtcbiAgfTtcblxuICAvKipcbiAgICogQmluZCBkcmFnIHNjcm9sbCBoYW5kbGVycyB0byBhbGwgc2Nyb2xsYWJsZSBhbmNlc3RvciBlbGVtZW50cyBvZiB0aGVcbiAgICogZHJhZ2dlZCBlbGVtZW50IGFuZCB0aGUgZHJhZyBjb250YWluZXIgZWxlbWVudC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9iaW5kU2Nyb2xsTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGdyaWRDb250YWluZXIgPSB0aGlzLl9nZXRHcmlkKCkuX2VsZW1lbnQ7XG4gICAgdmFyIGRyYWdDb250YWluZXIgPSB0aGlzLl9jb250YWluZXI7XG4gICAgdmFyIHNjcm9sbGVycyA9IHRoaXMuX3Njcm9sbGVycztcbiAgICB2YXIgZ3JpZFNjcm9sbGVycztcbiAgICB2YXIgaTtcblxuICAgIC8vIEdldCBkcmFnZ2VkIGVsZW1lbnQncyBzY3JvbGxpbmcgcGFyZW50cy5cbiAgICBzY3JvbGxlcnMubGVuZ3RoID0gMDtcbiAgICBnZXRTY3JvbGxhYmxlQW5jZXN0b3JzKHRoaXMuX2l0ZW0uX2VsZW1lbnQsIGZhbHNlLCBzY3JvbGxlcnMpO1xuXG4gICAgLy8gSWYgZHJhZyBjb250YWluZXIgaXMgZGVmaW5lZCBhbmQgaXQncyBub3QgdGhlIHNhbWUgZWxlbWVudCBhcyBncmlkXG4gICAgLy8gY29udGFpbmVyIHRoZW4gd2UgbmVlZCB0byBhZGQgdGhlIGdyaWQgY29udGFpbmVyIGFuZCBpdCdzIHNjcm9sbCBwYXJlbnRzXG4gICAgLy8gdG8gdGhlIGVsZW1lbnRzIHdoaWNoIGFyZSBnb2luZyB0byBiZSBsaXN0ZW5lciBmb3Igc2Nyb2xsIGV2ZW50cy5cbiAgICBpZiAoZHJhZ0NvbnRhaW5lciAhPT0gZ3JpZENvbnRhaW5lcikge1xuICAgICAgZ3JpZFNjcm9sbGVycyA9IFtdO1xuICAgICAgZ2V0U2Nyb2xsYWJsZUFuY2VzdG9ycyhncmlkQ29udGFpbmVyLCB0cnVlLCBncmlkU2Nyb2xsZXJzKTtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBncmlkU2Nyb2xsZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChzY3JvbGxlcnMuaW5kZXhPZihncmlkU2Nyb2xsZXJzW2ldKSA8IDApIHtcbiAgICAgICAgICBzY3JvbGxlcnMucHVzaChncmlkU2Nyb2xsZXJzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJpbmQgc2Nyb2xsIGxpc3RlbmVycy5cbiAgICBmb3IgKGkgPSAwOyBpIDwgc2Nyb2xsZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzY3JvbGxlcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5fb25TY3JvbGwpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVW5iaW5kIGN1cnJlbnRseSBib3VuZCBkcmFnIHNjcm9sbCBoYW5kbGVycyBmcm9tIGFsbCBzY3JvbGxhYmxlIGFuY2VzdG9yXG4gICAqIGVsZW1lbnRzIG9mIHRoZSBkcmFnZ2VkIGVsZW1lbnQgYW5kIHRoZSBkcmFnIGNvbnRhaW5lciBlbGVtZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX3VuYmluZFNjcm9sbExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzY3JvbGxlcnMgPSB0aGlzLl9zY3JvbGxlcnM7XG4gICAgdmFyIGk7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgc2Nyb2xsZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzY3JvbGxlcnNbaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5fb25TY3JvbGwpO1xuICAgIH1cblxuICAgIHNjcm9sbGVycy5sZW5ndGggPSAwO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXR1cCBkZWZhdWx0IHN0YXJ0IHByZWRpY2F0ZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX3NldHVwU3RhcnRQcmVkaWNhdGUgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIGNvbmZpZyA9IG9wdGlvbnMgfHwgdGhpcy5fZ2V0R3JpZCgpLl9zZXR0aW5ncy5kcmFnU3RhcnRQcmVkaWNhdGUgfHwgMDtcbiAgICByZXR1cm4gKHRoaXMuX3N0YXJ0UHJlZGljYXRlRGF0YSA9IHtcbiAgICAgIGRpc3RhbmNlOiBNYXRoLmFicyhjb25maWcuZGlzdGFuY2UpIHx8IDAsXG4gICAgICBkZWxheTogTWF0aC5tYXgoY29uZmlnLmRlbGF5LCAwKSB8fCAwLFxuICAgICAgaGFuZGxlOiB0eXBlb2YgY29uZmlnLmhhbmRsZSA9PT0gJ3N0cmluZycgPyBjb25maWcuaGFuZGxlIDogZmFsc2VcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogU2V0dXAgZGVmYXVsdCBzdGFydCBwcmVkaWNhdGUgaGFuZGxlLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RHJhZ2dlckV2ZW50fSBldmVudFxuICAgKiBAcmV0dXJucyB7P0hUTUxFbGVtZW50fVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9nZXRTdGFydFByZWRpY2F0ZUhhbmRsZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIHByZWRpY2F0ZSA9IHRoaXMuX3N0YXJ0UHJlZGljYXRlRGF0YTtcbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2l0ZW0uX2VsZW1lbnQ7XG4gICAgdmFyIGhhbmRsZUVsZW1lbnQgPSBlbGVtZW50O1xuXG4gICAgLy8gTm8gaGFuZGxlLCBubyBoYXNzbGUgLT4gbGV0J3MgdXNlIHRoZSBpdGVtIGVsZW1lbnQgYXMgdGhlIGhhbmRsZS5cbiAgICBpZiAoIXByZWRpY2F0ZS5oYW5kbGUpIHJldHVybiBoYW5kbGVFbGVtZW50O1xuXG4gICAgLy8gSWYgdGhlcmUgaXMgYSBzcGVjaWZpYyBwcmVkaWNhdGUgaGFuZGxlIGRlZmluZWQsIGxldCdzIHRyeSB0byBnZXQgaXQuXG4gICAgaGFuZGxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcbiAgICB3aGlsZSAoaGFuZGxlRWxlbWVudCAmJiAhZWxlbWVudE1hdGNoZXMoaGFuZGxlRWxlbWVudCwgcHJlZGljYXRlLmhhbmRsZSkpIHtcbiAgICAgIGhhbmRsZUVsZW1lbnQgPSBoYW5kbGVFbGVtZW50ICE9PSBlbGVtZW50ID8gaGFuZGxlRWxlbWVudC5wYXJlbnRFbGVtZW50IDogbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGhhbmRsZUVsZW1lbnQgfHwgbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogVW5iaW5kIGN1cnJlbnRseSBib3VuZCBkcmFnIHNjcm9sbCBoYW5kbGVycyBmcm9tIGFsbCBzY3JvbGxhYmxlIGFuY2VzdG9yXG4gICAqIGVsZW1lbnRzIG9mIHRoZSBkcmFnZ2VkIGVsZW1lbnQgYW5kIHRoZSBkcmFnIGNvbnRhaW5lciBlbGVtZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RHJhZ2dlckV2ZW50fSBldmVudFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fcmVzb2x2ZVN0YXJ0UHJlZGljYXRlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgcHJlZGljYXRlID0gdGhpcy5fc3RhcnRQcmVkaWNhdGVEYXRhO1xuXG4gICAgLy8gSWYgdGhlIG1vdmVkIGRpc3RhbmNlIGlzIHNtYWxsZXIgdGhhbiB0aGUgdGhyZXNob2xkIGRpc3RhbmNlIG9yIHRoZXJlIGlzXG4gICAgLy8gc29tZSBkZWxheSBsZWZ0LCBpZ25vcmUgdGhpcyBwcmVkaWNhdGUgY3ljbGUuXG4gICAgaWYgKGV2ZW50LmRpc3RhbmNlIDwgcHJlZGljYXRlLmRpc3RhbmNlIHx8IHByZWRpY2F0ZS5kZWxheSkgcmV0dXJuO1xuXG4gICAgLy8gR2V0IGhhbmRsZSByZWN0IGRhdGEuXG4gICAgdmFyIGhhbmRsZVJlY3QgPSBwcmVkaWNhdGUuaGFuZGxlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB2YXIgaGFuZGxlTGVmdCA9IGhhbmRsZVJlY3QubGVmdCArICh3aW5kb3cucGFnZVhPZmZzZXQgfHwgMCk7XG4gICAgdmFyIGhhbmRsZVRvcCA9IGhhbmRsZVJlY3QudG9wICsgKHdpbmRvdy5wYWdlWU9mZnNldCB8fCAwKTtcbiAgICB2YXIgaGFuZGxlV2lkdGggPSBoYW5kbGVSZWN0LndpZHRoO1xuICAgIHZhciBoYW5kbGVIZWlnaHQgPSBoYW5kbGVSZWN0LmhlaWdodDtcblxuICAgIC8vIFJlc2V0IHByZWRpY2F0ZSBkYXRhLlxuICAgIHRoaXMuX3Jlc2V0U3RhcnRQcmVkaWNhdGUoKTtcblxuICAgIC8vIElmIHRoZSBjdXJzb3IgaXMgc3RpbGwgd2l0aGluIHRoZSBoYW5kbGUgbGV0J3Mgc3RhcnQgdGhlIGRyYWcuXG4gICAgcmV0dXJuIChcbiAgICAgIGhhbmRsZVdpZHRoICYmXG4gICAgICBoYW5kbGVIZWlnaHQgJiZcbiAgICAgIGV2ZW50LnBhZ2VYID49IGhhbmRsZUxlZnQgJiZcbiAgICAgIGV2ZW50LnBhZ2VYIDwgaGFuZGxlTGVmdCArIGhhbmRsZVdpZHRoICYmXG4gICAgICBldmVudC5wYWdlWSA+PSBoYW5kbGVUb3AgJiZcbiAgICAgIGV2ZW50LnBhZ2VZIDwgaGFuZGxlVG9wICsgaGFuZGxlSGVpZ2h0XG4gICAgKTtcbiAgfTtcblxuICAvKipcbiAgICogRm9yY2VmdWxseSByZXNvbHZlIGRyYWcgc3RhcnQgcHJlZGljYXRlLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RHJhZ2dlckV2ZW50fSBldmVudFxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9mb3JjZVJlc29sdmVTdGFydFByZWRpY2F0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLl9pc0Rlc3Ryb3llZCAmJiB0aGlzLl9zdGFydFByZWRpY2F0ZVN0YXRlID09PSBzdGFydFByZWRpY2F0ZVBlbmRpbmcpIHtcbiAgICAgIHRoaXMuX3N0YXJ0UHJlZGljYXRlU3RhdGUgPSBzdGFydFByZWRpY2F0ZVJlc29sdmVkO1xuICAgICAgdGhpcy5fb25TdGFydChldmVudCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBGaW5hbGl6ZSBzdGFydCBwcmVkaWNhdGUuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZy5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtEcmFnZ2VyRXZlbnR9IGV2ZW50XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX2ZpbmlzaFN0YXJ0UHJlZGljYXRlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2l0ZW0uX2VsZW1lbnQ7XG5cbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgY2xpY2sgKHZlcnkgc3ViamVjdGl2ZSBoZXVyaXN0aWNzKS5cbiAgICB2YXIgaXNDbGljayA9IE1hdGguYWJzKGV2ZW50LmRlbHRhWCkgPCAyICYmIE1hdGguYWJzKGV2ZW50LmRlbHRhWSkgPCAyICYmIGV2ZW50LmRlbHRhVGltZSA8IDIwMDtcblxuICAgIC8vIFJlc2V0IHByZWRpY2F0ZS5cbiAgICB0aGlzLl9yZXNldFN0YXJ0UHJlZGljYXRlKCk7XG5cbiAgICAvLyBJZiB0aGUgZ2VzdHVyZSBjYW4gYmUgaW50ZXJwcmV0ZWQgYXMgY2xpY2sgbGV0J3MgdHJ5IHRvIG9wZW4gdGhlIGVsZW1lbnQnc1xuICAgIC8vIGhyZWYgdXJsIChpZiBpdCBpcyBhbiBhbmNob3IgZWxlbWVudCkuXG4gICAgaWYgKGlzQ2xpY2spIG9wZW5BbmNob3JIcmVmKGVsZW1lbnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXNldCBkcmFnIHNvcnQgaGV1cmlzdGljcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0RyYWdnZXJFdmVudH0gZXZlbnRcbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fcmVzZXRIZXVyaXN0aWNzID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB0aGlzLl9oQmxvY2tlZEluZGV4ID0gbnVsbDtcbiAgICB0aGlzLl9oWDEgPSB0aGlzLl9oWDIgPSBldmVudC5jbGllbnRYO1xuICAgIHRoaXMuX2hZMSA9IHRoaXMuX2hZMiA9IGV2ZW50LmNsaWVudFk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJ1biBoZXVyaXN0aWNzIGFuZCByZXR1cm4gdHJ1ZSBpZiBvdmVybGFwIGNoZWNrIGNhbiBiZSBwZXJmb3JtZWQsIGFuZCBmYWxzZVxuICAgKiBpZiBpdCBjYW4gbm90LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RHJhZ2dlckV2ZW50fSBldmVudFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fY2hlY2tIZXVyaXN0aWNzID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgc2V0dGluZ3MgPSB0aGlzLl9nZXRHcmlkKCkuX3NldHRpbmdzLmRyYWdTb3J0SGV1cmlzdGljcztcbiAgICB2YXIgbWluRGlzdCA9IHNldHRpbmdzLm1pbkRyYWdEaXN0YW5jZTtcblxuICAgIC8vIFNraXAgaGV1cmlzdGljcyBpZiBub3QgbmVlZGVkLlxuICAgIGlmIChtaW5EaXN0IDw9IDApIHtcbiAgICAgIHRoaXMuX2hCbG9ja2VkSW5kZXggPSBudWxsO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgdmFyIHggPSBldmVudC5jbGllbnRYO1xuICAgIHZhciB5ID0gZXZlbnQuY2xpZW50WTtcbiAgICB2YXIgZGlmZlggPSB4IC0gdGhpcy5faFgyO1xuICAgIHZhciBkaWZmWSA9IHkgLSB0aGlzLl9oWTI7XG5cbiAgICAvLyBJZiB3ZSBjYW4ndCBkbyBwcm9wZXIgYm91bmNlIGJhY2sgY2hlY2sgbWFrZSBzdXJlIHRoYXQgdGhlIGJsb2NrZWQgaW5kZXhcbiAgICAvLyBpcyBub3Qgc2V0LlxuICAgIHZhciBjYW5DaGVja0JvdW5jZUJhY2sgPSBtaW5EaXN0ID4gMyAmJiBzZXR0aW5ncy5taW5Cb3VuY2VCYWNrQW5nbGUgPiAwO1xuICAgIGlmICghY2FuQ2hlY2tCb3VuY2VCYWNrKSB7XG4gICAgICB0aGlzLl9oQmxvY2tlZEluZGV4ID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoTWF0aC5hYnMoZGlmZlgpID4gbWluRGlzdCB8fCBNYXRoLmFicyhkaWZmWSkgPiBtaW5EaXN0KSB7XG4gICAgICAvLyBSZXNldCBibG9ja2VkIGluZGV4IGlmIGFuZ2xlIGNoYW5nZWQgZW5vdWdoLiBUaGlzIGNoZWNrIHJlcXVpcmVzIGFcbiAgICAgIC8vIG1pbmltdW0gdmFsdWUgb2YgMyBmb3IgbWluRHJhZ0Rpc3RhbmNlIHRvIGZ1bmN0aW9uIHByb3Blcmx5LlxuICAgICAgaWYgKGNhbkNoZWNrQm91bmNlQmFjaykge1xuICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKGRpZmZYLCBkaWZmWSk7XG4gICAgICAgIHZhciBwcmV2QW5nbGUgPSBNYXRoLmF0YW4yKHRoaXMuX2hYMiAtIHRoaXMuX2hYMSwgdGhpcy5faFkyIC0gdGhpcy5faFkxKTtcbiAgICAgICAgdmFyIGRlbHRhQW5nbGUgPSBNYXRoLmF0YW4yKE1hdGguc2luKGFuZ2xlIC0gcHJldkFuZ2xlKSwgTWF0aC5jb3MoYW5nbGUgLSBwcmV2QW5nbGUpKTtcbiAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhQW5nbGUpID4gc2V0dGluZ3MubWluQm91bmNlQmFja0FuZ2xlKSB7XG4gICAgICAgICAgdGhpcy5faEJsb2NrZWRJbmRleCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIHBvaW50cy5cbiAgICAgIHRoaXMuX2hYMSA9IHRoaXMuX2hYMjtcbiAgICAgIHRoaXMuX2hZMSA9IHRoaXMuX2hZMjtcbiAgICAgIHRoaXMuX2hYMiA9IHg7XG4gICAgICB0aGlzLl9oWTIgPSB5O1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlc2V0IGZvciBkZWZhdWx0IGRyYWcgc3RhcnQgcHJlZGljYXRlIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX3Jlc2V0U3RhcnRQcmVkaWNhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcHJlZGljYXRlID0gdGhpcy5fc3RhcnRQcmVkaWNhdGVEYXRhO1xuICAgIGlmIChwcmVkaWNhdGUpIHtcbiAgICAgIGlmIChwcmVkaWNhdGUuZGVsYXlUaW1lcikge1xuICAgICAgICBwcmVkaWNhdGUuZGVsYXlUaW1lciA9IHdpbmRvdy5jbGVhclRpbWVvdXQocHJlZGljYXRlLmRlbGF5VGltZXIpO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3RhcnRQcmVkaWNhdGVEYXRhID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIChkdXJpbmcgZHJhZykgaWYgYW4gaXRlbSBpcyBvdmVybGFwcGluZyBvdGhlciBpdGVtcyBhbmQgYmFzZWQgb25cbiAgICogdGhlIGNvbmZpZ3VyYXRpb24gbGF5b3V0IHRoZSBpdGVtcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9jaGVja092ZXJsYXAgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuX2lzQWN0aXZlKSByZXR1cm47XG5cbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIHNldHRpbmdzID0gdGhpcy5fZ2V0R3JpZCgpLl9zZXR0aW5ncztcbiAgICB2YXIgcmVzdWx0O1xuICAgIHZhciBjdXJyZW50R3JpZDtcbiAgICB2YXIgY3VycmVudEluZGV4O1xuICAgIHZhciB0YXJnZXRHcmlkO1xuICAgIHZhciB0YXJnZXRJbmRleDtcbiAgICB2YXIgc29ydEFjdGlvbjtcbiAgICB2YXIgaXNNaWdyYXRpb247XG5cbiAgICAvLyBHZXQgb3ZlcmxhcCBjaGVjayByZXN1bHQuXG4gICAgaWYgKGlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1NvcnRQcmVkaWNhdGUpKSB7XG4gICAgICByZXN1bHQgPSBzZXR0aW5ncy5kcmFnU29ydFByZWRpY2F0ZShpdGVtLCB0aGlzLl9kcmFnRXZlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSBJdGVtRHJhZy5kZWZhdWx0U29ydFByZWRpY2F0ZShpdGVtLCBzZXR0aW5ncy5kcmFnU29ydFByZWRpY2F0ZSk7XG4gICAgfVxuXG4gICAgLy8gTGV0J3MgbWFrZSBzdXJlIHRoZSByZXN1bHQgb2JqZWN0IGhhcyBhIHZhbGlkIGluZGV4IGJlZm9yZSBnb2luZyBmdXJ0aGVyLlxuICAgIGlmICghcmVzdWx0IHx8IHR5cGVvZiByZXN1bHQuaW5kZXggIT09ICdudW1iZXInKSByZXR1cm47XG5cbiAgICBjdXJyZW50R3JpZCA9IGl0ZW0uZ2V0R3JpZCgpO1xuICAgIHRhcmdldEdyaWQgPSByZXN1bHQuZ3JpZCB8fCBjdXJyZW50R3JpZDtcbiAgICBpc01pZ3JhdGlvbiA9IGN1cnJlbnRHcmlkICE9PSB0YXJnZXRHcmlkO1xuICAgIGN1cnJlbnRJbmRleCA9IGN1cnJlbnRHcmlkLl9pdGVtcy5pbmRleE9mKGl0ZW0pO1xuICAgIHRhcmdldEluZGV4ID0gbm9ybWFsaXplQXJyYXlJbmRleCh0YXJnZXRHcmlkLl9pdGVtcywgcmVzdWx0LmluZGV4LCBpc01pZ3JhdGlvbik7XG4gICAgc29ydEFjdGlvbiA9IHJlc3VsdC5hY3Rpb24gPT09IGFjdGlvblN3YXAgPyBhY3Rpb25Td2FwIDogYWN0aW9uTW92ZTtcblxuICAgIC8vIFByZXZlbnQgcG9zaXRpb24gYm91bmNlLlxuICAgIGlmICghaXNNaWdyYXRpb24gJiYgdGFyZ2V0SW5kZXggPT09IHRoaXMuX2hCbG9ja2VkSW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgaXRlbSB3YXMgbW92ZWQgd2l0aGluIGl0J3MgY3VycmVudCBncmlkLlxuICAgIGlmICghaXNNaWdyYXRpb24pIHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgdGFyZ2V0IGluZGV4IGlzIG5vdCB0aGUgY3VycmVudCBpbmRleC5cbiAgICAgIGlmIChjdXJyZW50SW5kZXggIT09IHRhcmdldEluZGV4KSB7XG4gICAgICAgIHRoaXMuX2hCbG9ja2VkSW5kZXggPSBjdXJyZW50SW5kZXg7XG5cbiAgICAgICAgLy8gRG8gdGhlIHNvcnQuXG4gICAgICAgIChzb3J0QWN0aW9uID09PSBhY3Rpb25Td2FwID8gYXJyYXlTd2FwIDogYXJyYXlNb3ZlKShcbiAgICAgICAgICBjdXJyZW50R3JpZC5faXRlbXMsXG4gICAgICAgICAgY3VycmVudEluZGV4LFxuICAgICAgICAgIHRhcmdldEluZGV4XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gRW1pdCBtb3ZlIGV2ZW50LlxuICAgICAgICBpZiAoY3VycmVudEdyaWQuX2hhc0xpc3RlbmVycyhldmVudE1vdmUpKSB7XG4gICAgICAgICAgY3VycmVudEdyaWQuX2VtaXQoZXZlbnRNb3ZlLCB7XG4gICAgICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICAgICAgZnJvbUluZGV4OiBjdXJyZW50SW5kZXgsXG4gICAgICAgICAgICB0b0luZGV4OiB0YXJnZXRJbmRleCxcbiAgICAgICAgICAgIGFjdGlvbjogc29ydEFjdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTGF5b3V0IHRoZSBncmlkLlxuICAgICAgICBjdXJyZW50R3JpZC5sYXlvdXQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgaXRlbSB3YXMgbW92ZWQgdG8gYW5vdGhlciBncmlkLlxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5faEJsb2NrZWRJbmRleCA9IG51bGw7XG5cbiAgICAgIC8vIEVtaXQgYmVmb3JlU2VuZCBldmVudC5cbiAgICAgIGlmIChjdXJyZW50R3JpZC5faGFzTGlzdGVuZXJzKGV2ZW50QmVmb3JlU2VuZCkpIHtcbiAgICAgICAgY3VycmVudEdyaWQuX2VtaXQoZXZlbnRCZWZvcmVTZW5kLCB7XG4gICAgICAgICAgaXRlbTogaXRlbSxcbiAgICAgICAgICBmcm9tR3JpZDogY3VycmVudEdyaWQsXG4gICAgICAgICAgZnJvbUluZGV4OiBjdXJyZW50SW5kZXgsXG4gICAgICAgICAgdG9HcmlkOiB0YXJnZXRHcmlkLFxuICAgICAgICAgIHRvSW5kZXg6IHRhcmdldEluZGV4XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBFbWl0IGJlZm9yZVJlY2VpdmUgZXZlbnQuXG4gICAgICBpZiAodGFyZ2V0R3JpZC5faGFzTGlzdGVuZXJzKGV2ZW50QmVmb3JlUmVjZWl2ZSkpIHtcbiAgICAgICAgdGFyZ2V0R3JpZC5fZW1pdChldmVudEJlZm9yZVJlY2VpdmUsIHtcbiAgICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICAgIGZyb21HcmlkOiBjdXJyZW50R3JpZCxcbiAgICAgICAgICBmcm9tSW5kZXg6IGN1cnJlbnRJbmRleCxcbiAgICAgICAgICB0b0dyaWQ6IHRhcmdldEdyaWQsXG4gICAgICAgICAgdG9JbmRleDogdGFyZ2V0SW5kZXhcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBpdGVtJ3MgZ3JpZCBpZCByZWZlcmVuY2UuXG4gICAgICBpdGVtLl9ncmlkSWQgPSB0YXJnZXRHcmlkLl9pZDtcblxuICAgICAgLy8gVXBkYXRlIGRyYWcgaW5zdGFuY2UncyBtaWdyYXRpbmcgaW5kaWNhdG9yLlxuICAgICAgdGhpcy5faXNNaWdyYXRpbmcgPSBpdGVtLl9ncmlkSWQgIT09IHRoaXMuX2dyaWRJZDtcblxuICAgICAgLy8gTW92ZSBpdGVtIGluc3RhbmNlIGZyb20gY3VycmVudCBncmlkIHRvIHRhcmdldCBncmlkLlxuICAgICAgY3VycmVudEdyaWQuX2l0ZW1zLnNwbGljZShjdXJyZW50SW5kZXgsIDEpO1xuICAgICAgYXJyYXlJbnNlcnQodGFyZ2V0R3JpZC5faXRlbXMsIGl0ZW0sIHRhcmdldEluZGV4KTtcblxuICAgICAgLy8gU2V0IHNvcnQgZGF0YSBhcyBudWxsLCB3aGljaCBpcyBhbiBpbmRpY2F0b3IgZm9yIHRoZSBpdGVtIGNvbXBhcmlzb25cbiAgICAgIC8vIGZ1bmN0aW9uIHRoYXQgdGhlIHNvcnQgZGF0YSBvZiB0aGlzIHNwZWNpZmljIGl0ZW0gc2hvdWxkIGJlIGZldGNoZWRcbiAgICAgIC8vIGxhemlseS5cbiAgICAgIGl0ZW0uX3NvcnREYXRhID0gbnVsbDtcblxuICAgICAgLy8gRW1pdCBzZW5kIGV2ZW50LlxuICAgICAgaWYgKGN1cnJlbnRHcmlkLl9oYXNMaXN0ZW5lcnMoZXZlbnRTZW5kKSkge1xuICAgICAgICBjdXJyZW50R3JpZC5fZW1pdChldmVudFNlbmQsIHtcbiAgICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICAgIGZyb21HcmlkOiBjdXJyZW50R3JpZCxcbiAgICAgICAgICBmcm9tSW5kZXg6IGN1cnJlbnRJbmRleCxcbiAgICAgICAgICB0b0dyaWQ6IHRhcmdldEdyaWQsXG4gICAgICAgICAgdG9JbmRleDogdGFyZ2V0SW5kZXhcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEVtaXQgcmVjZWl2ZSBldmVudC5cbiAgICAgIGlmICh0YXJnZXRHcmlkLl9oYXNMaXN0ZW5lcnMoZXZlbnRSZWNlaXZlKSkge1xuICAgICAgICB0YXJnZXRHcmlkLl9lbWl0KGV2ZW50UmVjZWl2ZSwge1xuICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgZnJvbUdyaWQ6IGN1cnJlbnRHcmlkLFxuICAgICAgICAgIGZyb21JbmRleDogY3VycmVudEluZGV4LFxuICAgICAgICAgIHRvR3JpZDogdGFyZ2V0R3JpZCxcbiAgICAgICAgICB0b0luZGV4OiB0YXJnZXRJbmRleFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gTGF5b3V0IGJvdGggZ3JpZHMuXG4gICAgICBjdXJyZW50R3JpZC5sYXlvdXQoKTtcbiAgICAgIHRhcmdldEdyaWQubGF5b3V0KCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBJZiBpdGVtIGlzIGRyYWdnZWQgaW50byBhbm90aGVyIGdyaWQsIGZpbmlzaCB0aGUgbWlncmF0aW9uIHByb2Nlc3NcbiAgICogZ3JhY2VmdWxseS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9maW5pc2hNaWdyYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIHJlbGVhc2UgPSBpdGVtLl9yZWxlYXNlO1xuICAgIHZhciBlbGVtZW50ID0gaXRlbS5fZWxlbWVudDtcbiAgICB2YXIgaXNBY3RpdmUgPSBpdGVtLl9pc0FjdGl2ZTtcbiAgICB2YXIgdGFyZ2V0R3JpZCA9IGl0ZW0uZ2V0R3JpZCgpO1xuICAgIHZhciB0YXJnZXRHcmlkRWxlbWVudCA9IHRhcmdldEdyaWQuX2VsZW1lbnQ7XG4gICAgdmFyIHRhcmdldFNldHRpbmdzID0gdGFyZ2V0R3JpZC5fc2V0dGluZ3M7XG4gICAgdmFyIHRhcmdldENvbnRhaW5lciA9IHRhcmdldFNldHRpbmdzLmRyYWdDb250YWluZXIgfHwgdGFyZ2V0R3JpZEVsZW1lbnQ7XG4gICAgdmFyIGN1cnJlbnRTZXR0aW5ncyA9IHRoaXMuX2dldEdyaWQoKS5fc2V0dGluZ3M7XG4gICAgdmFyIGN1cnJlbnRDb250YWluZXIgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgdmFyIHRyYW5zbGF0ZTtcbiAgICB2YXIgb2Zmc2V0RGlmZjtcblxuICAgIC8vIERlc3Ryb3kgY3VycmVudCBkcmFnLiBOb3RlIHRoYXQgd2UgbmVlZCB0byBzZXQgdGhlIG1pZ3JhdGluZyBmbGFnIHRvXG4gICAgLy8gZmFsc2UgZmlyc3QsIGJlY2F1c2Ugb3RoZXJ3aXNlIHdlIGNyZWF0ZSBhbiBpbmZpbml0ZSBsb29wIGJldHdlZW4gdGhpc1xuICAgIC8vIGFuZCB0aGUgZHJhZy5zdG9wKCkgbWV0aG9kLlxuICAgIHRoaXMuX2lzTWlncmF0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5kZXN0cm95KCk7XG5cbiAgICAvLyBSZW1vdmUgY3VycmVudCBjbGFzc25hbWVzLlxuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIGN1cnJlbnRTZXR0aW5ncy5pdGVtQ2xhc3MpO1xuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIGN1cnJlbnRTZXR0aW5ncy5pdGVtVmlzaWJsZUNsYXNzKTtcbiAgICByZW1vdmVDbGFzcyhlbGVtZW50LCBjdXJyZW50U2V0dGluZ3MuaXRlbUhpZGRlbkNsYXNzKTtcblxuICAgIC8vIEFkZCBuZXcgY2xhc3NuYW1lcy5cbiAgICBhZGRDbGFzcyhlbGVtZW50LCB0YXJnZXRTZXR0aW5ncy5pdGVtQ2xhc3MpO1xuICAgIGFkZENsYXNzKGVsZW1lbnQsIGlzQWN0aXZlID8gdGFyZ2V0U2V0dGluZ3MuaXRlbVZpc2libGVDbGFzcyA6IHRhcmdldFNldHRpbmdzLml0ZW1IaWRkZW5DbGFzcyk7XG5cbiAgICAvLyBNb3ZlIHRoZSBpdGVtIGluc2lkZSB0aGUgdGFyZ2V0IGNvbnRhaW5lciBpZiBpdCdzIGRpZmZlcmVudCB0aGFuIHRoZVxuICAgIC8vIGN1cnJlbnQgY29udGFpbmVyLlxuICAgIGlmICh0YXJnZXRDb250YWluZXIgIT09IGN1cnJlbnRDb250YWluZXIpIHtcbiAgICAgIHRhcmdldENvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgIG9mZnNldERpZmYgPSBnZXRPZmZzZXREaWZmKGN1cnJlbnRDb250YWluZXIsIHRhcmdldENvbnRhaW5lciwgdHJ1ZSk7XG4gICAgICB0cmFuc2xhdGUgPSBnZXRUcmFuc2xhdGUoZWxlbWVudCk7XG4gICAgICB0cmFuc2xhdGUueCAtPSBvZmZzZXREaWZmLmxlZnQ7XG4gICAgICB0cmFuc2xhdGUueSAtPSBvZmZzZXREaWZmLnRvcDtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgaXRlbSdzIGNhY2hlZCBkaW1lbnNpb25zIGFuZCBzb3J0IGRhdGEuXG4gICAgaXRlbS5fcmVmcmVzaERpbWVuc2lvbnMoKTtcbiAgICBpdGVtLl9yZWZyZXNoU29ydERhdGEoKTtcblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgb2Zmc2V0IGRpZmZlcmVuY2UgYmV0d2VlbiB0YXJnZXQncyBkcmFnIGNvbnRhaW5lciAoaWYgYW55KVxuICAgIC8vIGFuZCBhY3R1YWwgZ3JpZCBjb250YWluZXIgZWxlbWVudC4gV2Ugc2F2ZSBpdCBsYXRlciBmb3IgdGhlIHJlbGVhc2VcbiAgICAvLyBwcm9jZXNzLlxuICAgIG9mZnNldERpZmYgPSBnZXRPZmZzZXREaWZmKHRhcmdldENvbnRhaW5lciwgdGFyZ2V0R3JpZEVsZW1lbnQsIHRydWUpO1xuICAgIHJlbGVhc2UuX2NvbnRhaW5lckRpZmZYID0gb2Zmc2V0RGlmZi5sZWZ0O1xuICAgIHJlbGVhc2UuX2NvbnRhaW5lckRpZmZZID0gb2Zmc2V0RGlmZi50b3A7XG5cbiAgICAvLyBSZWNyZWF0ZSBpdGVtJ3MgZHJhZyBoYW5kbGVyLlxuICAgIGl0ZW0uX2RyYWcgPSB0YXJnZXRTZXR0aW5ncy5kcmFnRW5hYmxlZCA/IG5ldyBJdGVtRHJhZyhpdGVtKSA6IG51bGw7XG5cbiAgICAvLyBBZGp1c3QgdGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIGVsZW1lbnQgaWYgaXQgd2FzIG1vdmVkIGZyb20gYSBjb250YWluZXJcbiAgICAvLyB0byBhbm90aGVyLlxuICAgIGlmICh0YXJnZXRDb250YWluZXIgIT09IGN1cnJlbnRDb250YWluZXIpIHtcbiAgICAgIGVsZW1lbnQuc3R5bGVbdHJhbnNmb3JtUHJvcF0gPSBnZXRUcmFuc2xhdGVTdHJpbmcodHJhbnNsYXRlLngsIHRyYW5zbGF0ZS55KTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgY2hpbGQgZWxlbWVudCdzIHN0eWxlcyB0byByZWZsZWN0IHRoZSBjdXJyZW50IHZpc2liaWxpdHkgc3RhdGUuXG4gICAgaXRlbS5fY2hpbGQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xuICAgIHNldFN0eWxlcyhpdGVtLl9jaGlsZCwgaXNBY3RpdmUgPyB0YXJnZXRTZXR0aW5ncy52aXNpYmxlU3R5bGVzIDogdGFyZ2V0U2V0dGluZ3MuaGlkZGVuU3R5bGVzKTtcblxuICAgIC8vIFN0YXJ0IHRoZSByZWxlYXNlLlxuICAgIHJlbGVhc2Uuc3RhcnQoKTtcbiAgfTtcblxuICAvKipcbiAgICogRHJhZyBwcmUtc3RhcnQgaGFuZGxlci5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0RyYWdnZXJFdmVudH0gZXZlbnRcbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fcHJlU3RhcnRDaGVjayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgLy8gTGV0J3MgYWN0aXZhdGUgZHJhZyBzdGFydCBwcmVkaWNhdGUgc3RhdGUuXG4gICAgaWYgKHRoaXMuX3N0YXJ0UHJlZGljYXRlU3RhdGUgPT09IHN0YXJ0UHJlZGljYXRlSW5hY3RpdmUpIHtcbiAgICAgIHRoaXMuX3N0YXJ0UHJlZGljYXRlU3RhdGUgPSBzdGFydFByZWRpY2F0ZVBlbmRpbmc7XG4gICAgfVxuXG4gICAgLy8gSWYgcHJlZGljYXRlIGlzIHBlbmRpbmcgdHJ5IHRvIHJlc29sdmUgaXQuXG4gICAgaWYgKHRoaXMuX3N0YXJ0UHJlZGljYXRlU3RhdGUgPT09IHN0YXJ0UHJlZGljYXRlUGVuZGluZykge1xuICAgICAgdGhpcy5fc3RhcnRQcmVkaWNhdGVSZXN1bHQgPSB0aGlzLl9zdGFydFByZWRpY2F0ZSh0aGlzLl9pdGVtLCBldmVudCk7XG4gICAgICBpZiAodGhpcy5fc3RhcnRQcmVkaWNhdGVSZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5fc3RhcnRQcmVkaWNhdGVTdGF0ZSA9IHN0YXJ0UHJlZGljYXRlUmVzb2x2ZWQ7XG4gICAgICAgIHRoaXMuX29uU3RhcnQoZXZlbnQpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9zdGFydFByZWRpY2F0ZVJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5fc3RhcnRQcmVkaWNhdGVTdGF0ZSA9IHN0YXJ0UHJlZGljYXRlUmVqZWN0ZWQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlIGlmIHByZWRpY2F0ZSBpcyByZXNvbHZlZCBhbmQgZHJhZyBpcyBhY3RpdmUsIG1vdmUgdGhlIGl0ZW0uXG4gICAgZWxzZSBpZiAodGhpcy5fc3RhcnRQcmVkaWNhdGVTdGF0ZSA9PT0gc3RhcnRQcmVkaWNhdGVSZXNvbHZlZCAmJiB0aGlzLl9pc0FjdGl2ZSkge1xuICAgICAgdGhpcy5fb25Nb3ZlKGV2ZW50KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIERyYWcgcHJlLWVuZCBoYW5kbGVyLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RHJhZ2dlckV2ZW50fSBldmVudFxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9wcmVFbmRDaGVjayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgLy8gQ2hlY2sgaWYgdGhlIHN0YXJ0IHByZWRpY2F0ZSB3YXMgcmVzb2x2ZWQgZHVyaW5nIGRyYWcuXG4gICAgdmFyIGlzUmVzb2x2ZWQgPSB0aGlzLl9zdGFydFByZWRpY2F0ZVN0YXRlID09PSBzdGFydFByZWRpY2F0ZVJlc29sdmVkO1xuXG4gICAgLy8gRG8gZmluYWwgcHJlZGljYXRlIGNoZWNrIHRvIGFsbG93IHVzZXIgdG8gdW5iaW5kIHN0dWZmIGZvciB0aGUgY3VycmVudFxuICAgIC8vIGRyYWcgcHJvY2VkdXJlIHdpdGhpbiB0aGUgcHJlZGljYXRlIGNhbGxiYWNrLiBUaGUgcmV0dXJuIHZhbHVlIG9mIHRoaXNcbiAgICAvLyBjaGVjayB3aWxsIGhhdmUgbm8gZWZmZWN0IHRvIHRoZSBzdGF0ZSBvZiB0aGUgcHJlZGljYXRlLlxuICAgIHRoaXMuX3N0YXJ0UHJlZGljYXRlKHRoaXMuX2l0ZW0sIGV2ZW50KTtcblxuICAgIC8vIFJlc2V0IHN0YXJ0IHByZWRpY2F0ZSBzdGF0ZS5cbiAgICB0aGlzLl9zdGFydFByZWRpY2F0ZVN0YXRlID0gc3RhcnRQcmVkaWNhdGVJbmFjdGl2ZTtcblxuICAgIC8vIElmIHByZWRpY2F0ZSBpcyByZXNvbHZlZCBhbmQgZHJhZ2dpbmcgaXMgYWN0aXZlLCBjYWxsIHRoZSBlbmQgaGFuZGxlci5cbiAgICBpZiAoaXNSZXNvbHZlZCAmJiB0aGlzLl9pc0FjdGl2ZSkgdGhpcy5fb25FbmQoZXZlbnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEcmFnIHN0YXJ0IGhhbmRsZXIuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZy5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtEcmFnZ2VyRXZlbnR9IGV2ZW50XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX29uU3RhcnQgPSBmdW5jdGlvbihldmVudCkge1xuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcblxuICAgIC8vIElmIGl0ZW0gaXMgbm90IGFjdGl2ZSwgZG9uJ3Qgc3RhcnQgdGhlIGRyYWcuXG4gICAgaWYgKCFpdGVtLl9pc0FjdGl2ZSkgcmV0dXJuO1xuXG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gdGhpcy5fZ2V0R3JpZCgpO1xuICAgIHZhciBzZXR0aW5ncyA9IGdyaWQuX3NldHRpbmdzO1xuICAgIHZhciByZWxlYXNlID0gaXRlbS5fcmVsZWFzZTtcbiAgICB2YXIgbWlncmF0ZSA9IGl0ZW0uX21pZ3JhdGU7XG4gICAgdmFyIGdyaWRDb250YWluZXIgPSBncmlkLl9lbGVtZW50O1xuICAgIHZhciBkcmFnQ29udGFpbmVyID0gc2V0dGluZ3MuZHJhZ0NvbnRhaW5lciB8fCBncmlkQ29udGFpbmVyO1xuICAgIHZhciBjb250YWluaW5nQmxvY2sgPSBnZXRDb250YWluaW5nQmxvY2soZHJhZ0NvbnRhaW5lciwgdHJ1ZSk7XG4gICAgdmFyIHRyYW5zbGF0ZSA9IGdldFRyYW5zbGF0ZShlbGVtZW50KTtcbiAgICB2YXIgY3VycmVudExlZnQgPSB0cmFuc2xhdGUueDtcbiAgICB2YXIgY3VycmVudFRvcCA9IHRyYW5zbGF0ZS55O1xuICAgIHZhciBlbGVtZW50UmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIGhhc0RyYWdDb250YWluZXIgPSBkcmFnQ29udGFpbmVyICE9PSBncmlkQ29udGFpbmVyO1xuICAgIHZhciBvZmZzZXREaWZmO1xuXG4gICAgLy8gUmVzZXQgaGV1cmlzdGljcyBkYXRhLlxuICAgIHRoaXMuX3Jlc2V0SGV1cmlzdGljcyhldmVudCk7XG5cbiAgICAvLyBJZiBncmlkIGNvbnRhaW5lciBpcyBub3QgdGhlIGRyYWcgY29udGFpbmVyLCB3ZSBuZWVkIHRvIGNhbGN1bGF0ZSB0aGVcbiAgICAvLyBvZmZzZXQgZGlmZmVyZW5jZSBiZXR3ZWVuIGdyaWQgY29udGFpbmVyIGFuZCBkcmFnIGNvbnRhaW5lcidzIGNvbnRhaW5pbmdcbiAgICAvLyBlbGVtZW50LlxuICAgIGlmIChoYXNEcmFnQ29udGFpbmVyKSB7XG4gICAgICBvZmZzZXREaWZmID0gZ2V0T2Zmc2V0RGlmZihjb250YWluaW5nQmxvY2ssIGdyaWRDb250YWluZXIpO1xuICAgIH1cblxuICAgIC8vIFN0b3AgY3VycmVudCBwb3NpdGlvbmluZyBhbmltYXRpb24uXG4gICAgaWYgKGl0ZW0uaXNQb3NpdGlvbmluZygpKSB7XG4gICAgICBpdGVtLl9sYXlvdXQuc3RvcCh0cnVlLCB7IHRyYW5zZm9ybTogZ2V0VHJhbnNsYXRlU3RyaW5nKGN1cnJlbnRMZWZ0LCBjdXJyZW50VG9wKSB9KTtcbiAgICB9XG5cbiAgICAvLyBTdG9wIGN1cnJlbnQgbWlncmF0aW9uIGFuaW1hdGlvbi5cbiAgICBpZiAobWlncmF0ZS5faXNBY3RpdmUpIHtcbiAgICAgIGN1cnJlbnRMZWZ0IC09IG1pZ3JhdGUuX2NvbnRhaW5lckRpZmZYO1xuICAgICAgY3VycmVudFRvcCAtPSBtaWdyYXRlLl9jb250YWluZXJEaWZmWTtcbiAgICAgIG1pZ3JhdGUuc3RvcCh0cnVlLCB7IHRyYW5zZm9ybTogZ2V0VHJhbnNsYXRlU3RyaW5nKGN1cnJlbnRMZWZ0LCBjdXJyZW50VG9wKSB9KTtcbiAgICB9XG5cbiAgICAvLyBJZiBpdGVtIGlzIGJlaW5nIHJlbGVhc2VkIHJlc2V0IHJlbGVhc2UgZGF0YS5cbiAgICBpZiAoaXRlbS5pc1JlbGVhc2luZygpKSByZWxlYXNlLl9yZXNldCgpO1xuXG4gICAgLy8gU2V0dXAgZHJhZyBkYXRhLlxuICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLl9kcmFnRXZlbnQgPSBldmVudDtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkcmFnQ29udGFpbmVyO1xuICAgIHRoaXMuX2NvbnRhaW5pbmdCbG9jayA9IGNvbnRhaW5pbmdCbG9jaztcbiAgICB0aGlzLl9lbGVtZW50Q2xpZW50WCA9IGVsZW1lbnRSZWN0LmxlZnQ7XG4gICAgdGhpcy5fZWxlbWVudENsaWVudFkgPSBlbGVtZW50UmVjdC50b3A7XG4gICAgdGhpcy5fbGVmdCA9IHRoaXMuX2dyaWRYID0gY3VycmVudExlZnQ7XG4gICAgdGhpcy5fdG9wID0gdGhpcy5fZ3JpZFkgPSBjdXJyZW50VG9wO1xuXG4gICAgLy8gQ3JlYXRlIHBsYWNlaG9sZGVyIChpZiBuZWNlc3NhcnkpLlxuICAgIGlmIChzZXR0aW5ncy5kcmFnUGxhY2Vob2xkZXIuZW5hYmxlZCkge1xuICAgICAgaXRlbS5fZHJhZ1BsYWNlaG9sZGVyLmNyZWF0ZSgpO1xuICAgIH1cblxuICAgIC8vIEVtaXQgZHJhZ0luaXQgZXZlbnQuXG4gICAgZ3JpZC5fZW1pdChldmVudERyYWdJbml0LCBpdGVtLCBldmVudCk7XG5cbiAgICAvLyBJZiBhIHNwZWNpZmljIGRyYWcgY29udGFpbmVyIGlzIHNldCBhbmQgaXQgaXMgZGlmZmVyZW50IGZyb20gdGhlXG4gICAgLy8gZ3JpZCdzIGNvbnRhaW5lciBlbGVtZW50IHdlIG5lZWQgdG8gY2FzdCBzb21lIGV4dHJhIHNwZWxscy5cbiAgICBpZiAoaGFzRHJhZ0NvbnRhaW5lcikge1xuICAgICAgLy8gU3RvcmUgdGhlIGNvbnRhaW5lciBvZmZzZXQgZGlmZnMgdG8gZHJhZyBkYXRhLlxuICAgICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSBvZmZzZXREaWZmLmxlZnQ7XG4gICAgICB0aGlzLl9jb250YWluZXJEaWZmWSA9IG9mZnNldERpZmYudG9wO1xuXG4gICAgICAvLyBJZiB0aGUgZHJhZ2dlZCBlbGVtZW50IGlzIGEgY2hpbGQgb2YgdGhlIGRyYWcgY29udGFpbmVyIGFsbCB3ZSBuZWVkIHRvXG4gICAgICAvLyBkbyBpcyBzZXR1cCB0aGUgcmVsYXRpdmUgZHJhZyBwb3NpdGlvbiBkYXRhLlxuICAgICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSA9PT0gZHJhZ0NvbnRhaW5lcikge1xuICAgICAgICB0aGlzLl9ncmlkWCA9IGN1cnJlbnRMZWZ0IC0gdGhpcy5fY29udGFpbmVyRGlmZlg7XG4gICAgICAgIHRoaXMuX2dyaWRZID0gY3VycmVudFRvcCAtIHRoaXMuX2NvbnRhaW5lckRpZmZZO1xuICAgICAgfVxuXG4gICAgICAvLyBPdGhlcndpc2Ugd2UgbmVlZCB0byBhcHBlbmQgdGhlIGVsZW1lbnQgaW5zaWRlIHRoZSBjb3JyZWN0IGNvbnRhaW5lcixcbiAgICAgIC8vIHNldHVwIHRoZSBhY3R1YWwgZHJhZyBwb3NpdGlvbiBkYXRhIGFuZCBhZGp1c3QgdGhlIGVsZW1lbnQncyB0cmFuc2xhdGVcbiAgICAgIC8vIHZhbHVlcyB0byBhY2NvdW50IGZvciB0aGUgRE9NIHBvc2l0aW9uIHNoaWZ0LlxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX2xlZnQgPSBjdXJyZW50TGVmdCArIHRoaXMuX2NvbnRhaW5lckRpZmZYO1xuICAgICAgICB0aGlzLl90b3AgPSBjdXJyZW50VG9wICsgdGhpcy5fY29udGFpbmVyRGlmZlk7XG4gICAgICAgIGRyYWdDb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnQuc3R5bGVbdHJhbnNmb3JtUHJvcF0gPSBnZXRUcmFuc2xhdGVTdHJpbmcodGhpcy5fbGVmdCwgdGhpcy5fdG9wKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXQgZHJhZyBjbGFzcyBhbmQgYmluZCBzY3JvbGxlcnMuXG4gICAgYWRkQ2xhc3MoZWxlbWVudCwgc2V0dGluZ3MuaXRlbURyYWdnaW5nQ2xhc3MpO1xuICAgIHRoaXMuX2JpbmRTY3JvbGxMaXN0ZW5lcnMoKTtcblxuICAgIC8vIEVtaXQgZHJhZ1N0YXJ0IGV2ZW50LlxuICAgIGdyaWQuX2VtaXQoZXZlbnREcmFnU3RhcnQsIGl0ZW0sIGV2ZW50KTtcbiAgfTtcblxuICAvKipcbiAgICogRHJhZyBtb3ZlIGhhbmRsZXIuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZy5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtEcmFnZ2VyRXZlbnR9IGV2ZW50XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX29uTW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuXG4gICAgLy8gSWYgaXRlbSBpcyBub3QgYWN0aXZlLCByZXNldCBkcmFnLlxuICAgIGlmICghaXRlbS5faXNBY3RpdmUpIHtcbiAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzZXR0aW5ncyA9IHRoaXMuX2dldEdyaWQoKS5fc2V0dGluZ3M7XG4gICAgdmFyIGF4aXMgPSBzZXR0aW5ncy5kcmFnQXhpcztcblxuICAgIC8vIFVwZGF0ZSBob3Jpem9udGFsIHBvc2l0aW9uIGRhdGEuXG4gICAgaWYgKGF4aXMgIT09ICd5Jykge1xuICAgICAgdmFyIHhEaWZmID0gZXZlbnQuY2xpZW50WCAtIHRoaXMuX2RyYWdFdmVudC5jbGllbnRYO1xuICAgICAgdGhpcy5fbGVmdCArPSB4RGlmZjtcbiAgICAgIHRoaXMuX2dyaWRYICs9IHhEaWZmO1xuICAgICAgdGhpcy5fZWxlbWVudENsaWVudFggKz0geERpZmY7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHZlcnRpY2FsIHBvc2l0aW9uIGRhdGEuXG4gICAgaWYgKGF4aXMgIT09ICd4Jykge1xuICAgICAgdmFyIHlEaWZmID0gZXZlbnQuY2xpZW50WSAtIHRoaXMuX2RyYWdFdmVudC5jbGllbnRZO1xuICAgICAgdGhpcy5fdG9wICs9IHlEaWZmO1xuICAgICAgdGhpcy5fZ3JpZFkgKz0geURpZmY7XG4gICAgICB0aGlzLl9lbGVtZW50Q2xpZW50WSArPSB5RGlmZjtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgZXZlbnQgZGF0YS5cbiAgICB0aGlzLl9kcmFnRXZlbnQgPSBldmVudDtcblxuICAgIC8vIERvIG1vdmUgcHJlcGFyZS9hcHBseSBoYW5kbGluZyBpbiB0aGUgbmV4dCB0aWNrLlxuICAgIGFkZE1vdmVUaWNrKGl0ZW0uX2lkLCB0aGlzLl9wcmVwYXJlTW92ZSwgdGhpcy5fYXBwbHlNb3ZlKTtcbiAgfTtcblxuICAvKipcbiAgICogUHJlcGFyZSBkcmFnZ2VkIGl0ZW0gZm9yIG1vdmluZy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9wcmVwYXJlTW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8vIERvIG5vdGhpbmcgaWYgaXRlbSBpcyBub3QgYWN0aXZlLlxuICAgIGlmICghdGhpcy5faXRlbS5faXNBY3RpdmUpIHJldHVybjtcblxuICAgIC8vIElmIGRyYWcgc29ydCBpcyBlbmFibGVkIC0+IGNoZWNrIG92ZXJsYXAuXG4gICAgaWYgKHRoaXMuX2dldEdyaWQoKS5fc2V0dGluZ3MuZHJhZ1NvcnQpIHtcbiAgICAgIGlmICh0aGlzLl9jaGVja0hldXJpc3RpY3ModGhpcy5fZHJhZ0V2ZW50KSkge1xuICAgICAgICB0aGlzLl9jaGVja092ZXJsYXBEZWJvdW5jZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQXBwbHkgbW92ZW1lbnQgdG8gZHJhZ2dlZCBpdGVtLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX2FwcGx5TW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcblxuICAgIC8vIERvIG5vdGhpbmcgaWYgaXRlbSBpcyBub3QgYWN0aXZlLlxuICAgIGlmICghaXRlbS5faXNBY3RpdmUpIHJldHVybjtcblxuICAgIC8vIFVwZGF0ZSBlbGVtZW50J3MgdHJhbnNsYXRlWC9ZIHZhbHVlcy5cbiAgICBpdGVtLl9lbGVtZW50LnN0eWxlW3RyYW5zZm9ybVByb3BdID0gZ2V0VHJhbnNsYXRlU3RyaW5nKHRoaXMuX2xlZnQsIHRoaXMuX3RvcCk7XG5cbiAgICAvLyBFbWl0IGRyYWdNb3ZlIGV2ZW50LlxuICAgIHRoaXMuX2dldEdyaWQoKS5fZW1pdChldmVudERyYWdNb3ZlLCBpdGVtLCB0aGlzLl9kcmFnRXZlbnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEcmFnIHNjcm9sbCBoYW5kbGVyLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWcucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XG4gICAqL1xuICBJdGVtRHJhZy5wcm90b3R5cGUuX29uU2Nyb2xsID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG5cbiAgICAvLyBJZiBpdGVtIGlzIG5vdCBhY3RpdmUsIHJlc2V0IGRyYWcuXG4gICAgaWYgKCFpdGVtLl9pc0FjdGl2ZSkge1xuICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGxhc3Qgc2Nyb2xsIGV2ZW50LlxuICAgIHRoaXMuX3Njcm9sbEV2ZW50ID0gZXZlbnQ7XG5cbiAgICAvLyBEbyBzY3JvbGwgcHJlcGFyZS9hcHBseSBoYW5kbGluZyBpbiB0aGUgbmV4dCB0aWNrLlxuICAgIGFkZFNjcm9sbFRpY2soaXRlbS5faWQsIHRoaXMuX3ByZXBhcmVTY3JvbGwsIHRoaXMuX2FwcGx5U2Nyb2xsKTtcbiAgfTtcblxuICAvKipcbiAgICogUHJlcGFyZSBkcmFnZ2VkIGl0ZW0gZm9yIHNjcm9sbGluZy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWcucHJvdG90eXBlLl9wcmVwYXJlU2Nyb2xsID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuXG4gICAgLy8gSWYgaXRlbSBpcyBub3QgYWN0aXZlIGRvIG5vdGhpbmcuXG4gICAgaWYgKCFpdGVtLl9pc0FjdGl2ZSkgcmV0dXJuO1xuXG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gdGhpcy5fZ2V0R3JpZCgpO1xuICAgIHZhciBzZXR0aW5ncyA9IGdyaWQuX3NldHRpbmdzO1xuICAgIHZhciBheGlzID0gc2V0dGluZ3MuZHJhZ0F4aXM7XG4gICAgdmFyIGdyaWRDb250YWluZXIgPSBncmlkLl9lbGVtZW50O1xuICAgIHZhciBvZmZzZXREaWZmO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGVsZW1lbnQncyByZWN0IGFuZCB4L3kgZGlmZi5cbiAgICB2YXIgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIHhEaWZmID0gdGhpcy5fZWxlbWVudENsaWVudFggLSByZWN0LmxlZnQ7XG4gICAgdmFyIHlEaWZmID0gdGhpcy5fZWxlbWVudENsaWVudFkgLSByZWN0LnRvcDtcblxuICAgIC8vIFVwZGF0ZSBjb250YWluZXIgZGlmZi5cbiAgICBpZiAodGhpcy5fY29udGFpbmVyICE9PSBncmlkQ29udGFpbmVyKSB7XG4gICAgICBvZmZzZXREaWZmID0gZ2V0T2Zmc2V0RGlmZih0aGlzLl9jb250YWluaW5nQmxvY2ssIGdyaWRDb250YWluZXIpO1xuICAgICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSBvZmZzZXREaWZmLmxlZnQ7XG4gICAgICB0aGlzLl9jb250YWluZXJEaWZmWSA9IG9mZnNldERpZmYudG9wO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBob3Jpem9udGFsIHBvc2l0aW9uIGRhdGEuXG4gICAgaWYgKGF4aXMgIT09ICd5Jykge1xuICAgICAgdGhpcy5fbGVmdCArPSB4RGlmZjtcbiAgICAgIHRoaXMuX2dyaWRYID0gdGhpcy5fbGVmdCAtIHRoaXMuX2NvbnRhaW5lckRpZmZYO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB2ZXJ0aWNhbCBwb3NpdGlvbiBkYXRhLlxuICAgIGlmIChheGlzICE9PSAneCcpIHtcbiAgICAgIHRoaXMuX3RvcCArPSB5RGlmZjtcbiAgICAgIHRoaXMuX2dyaWRZID0gdGhpcy5fdG9wIC0gdGhpcy5fY29udGFpbmVyRGlmZlk7XG4gICAgfVxuXG4gICAgLy8gT3ZlcmxhcCBoYW5kbGluZy5cbiAgICBpZiAoc2V0dGluZ3MuZHJhZ1NvcnQpIHRoaXMuX2NoZWNrT3ZlcmxhcERlYm91bmNlKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEFwcGx5IHNjcm9sbCB0byBkcmFnZ2VkIGl0ZW0uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZy5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fYXBwbHlTY3JvbGwgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG5cbiAgICAvLyBJZiBpdGVtIGlzIG5vdCBhY3RpdmUgZG8gbm90aGluZy5cbiAgICBpZiAoIWl0ZW0uX2lzQWN0aXZlKSByZXR1cm47XG5cbiAgICAvLyBVcGRhdGUgZWxlbWVudCdzIHRyYW5zbGF0ZVgvWSB2YWx1ZXMuXG4gICAgaXRlbS5fZWxlbWVudC5zdHlsZVt0cmFuc2Zvcm1Qcm9wXSA9IGdldFRyYW5zbGF0ZVN0cmluZyh0aGlzLl9sZWZ0LCB0aGlzLl90b3ApO1xuXG4gICAgLy8gRW1pdCBkcmFnU2Nyb2xsIGV2ZW50LlxuICAgIHRoaXMuX2dldEdyaWQoKS5fZW1pdChldmVudERyYWdTY3JvbGwsIGl0ZW0sIHRoaXMuX3Njcm9sbEV2ZW50KTtcbiAgfTtcblxuICAvKipcbiAgICogRHJhZyBlbmQgaGFuZGxlci5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0RyYWdnZXJFdmVudH0gZXZlbnRcbiAgICovXG4gIEl0ZW1EcmFnLnByb3RvdHlwZS5fb25FbmQgPSBmdW5jdGlvbihldmVudCkge1xuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgZWxlbWVudCA9IGl0ZW0uX2VsZW1lbnQ7XG4gICAgdmFyIGdyaWQgPSB0aGlzLl9nZXRHcmlkKCk7XG4gICAgdmFyIHNldHRpbmdzID0gZ3JpZC5fc2V0dGluZ3M7XG4gICAgdmFyIHJlbGVhc2UgPSBpdGVtLl9yZWxlYXNlO1xuXG4gICAgLy8gSWYgaXRlbSBpcyBub3QgYWN0aXZlLCByZXNldCBkcmFnLlxuICAgIGlmICghaXRlbS5faXNBY3RpdmUpIHtcbiAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENhbmNlbCBxdWV1ZWQgbW92ZSBhbmQgc2Nyb2xsIHRpY2tzLlxuICAgIGNhbmNlbE1vdmVUaWNrKGl0ZW0uX2lkKTtcbiAgICBjYW5jZWxTY3JvbGxUaWNrKGl0ZW0uX2lkKTtcblxuICAgIC8vIEZpbmlzaCBjdXJyZW50bHkgcXVldWVkIG92ZXJsYXAgY2hlY2suXG4gICAgc2V0dGluZ3MuZHJhZ1NvcnQgJiYgdGhpcy5fY2hlY2tPdmVybGFwRGVib3VuY2UoJ2ZpbmlzaCcpO1xuXG4gICAgLy8gUmVtb3ZlIHNjcm9sbCBsaXN0ZW5lcnMuXG4gICAgdGhpcy5fdW5iaW5kU2Nyb2xsTGlzdGVuZXJzKCk7XG5cbiAgICAvLyBTZXR1cCByZWxlYXNlIGRhdGEuXG4gICAgcmVsZWFzZS5fY29udGFpbmVyRGlmZlggPSB0aGlzLl9jb250YWluZXJEaWZmWDtcbiAgICByZWxlYXNlLl9jb250YWluZXJEaWZmWSA9IHRoaXMuX2NvbnRhaW5lckRpZmZZO1xuXG4gICAgLy8gUmVzZXQgZHJhZyBkYXRhLlxuICAgIHRoaXMuX3Jlc2V0KCk7XG5cbiAgICAvLyBSZW1vdmUgZHJhZyBjbGFzcyBuYW1lIGZyb20gZWxlbWVudC5cbiAgICByZW1vdmVDbGFzcyhlbGVtZW50LCBzZXR0aW5ncy5pdGVtRHJhZ2dpbmdDbGFzcyk7XG5cbiAgICAvLyBFbWl0IGRyYWdFbmQgZXZlbnQuXG4gICAgZ3JpZC5fZW1pdChldmVudERyYWdFbmQsIGl0ZW0sIGV2ZW50KTtcblxuICAgIC8vIEZpbmlzaCB1cCB0aGUgbWlncmF0aW9uIHByb2Nlc3Mgb3Igc3RhcnQgdGhlIHJlbGVhc2UgcHJvY2Vzcy5cbiAgICB0aGlzLl9pc01pZ3JhdGluZyA/IHRoaXMuX2ZpbmlzaE1pZ3JhdGlvbigpIDogcmVsZWFzZS5zdGFydCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcml2YXRlIGhlbHBlcnNcbiAgICogKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgaG93IG1hbnkgcGVyY2VudCB0aGUgaW50ZXJzZWN0aW9uIGFyZWEgb2YgdHdvIHJlY3RhbmdsZXMgaXMgZnJvbVxuICAgKiB0aGUgbWF4aW11bSBwb3RlbnRpYWwgaW50ZXJzZWN0aW9uIGFyZWEgYmV0d2VlbiB0aGUgcmVjdGFuZ2xlcy5cbiAgICpcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGFcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGJcbiAgICogQHJldHVybnMge051bWJlcn1cbiAgICogICAtIEEgbnVtYmVyIGJldHdlZW4gMC0xMDAuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRSZWN0T3ZlcmxhcFNjb3JlKGEsIGIpIHtcbiAgICAvLyBSZXR1cm4gMCBpbW1lZGlhdGVseSBpZiB0aGUgcmVjdGFuZ2xlcyBkbyBub3Qgb3ZlcmxhcC5cbiAgICBpZiAoXG4gICAgICBhLmxlZnQgKyBhLndpZHRoIDw9IGIubGVmdCB8fFxuICAgICAgYi5sZWZ0ICsgYi53aWR0aCA8PSBhLmxlZnQgfHxcbiAgICAgIGEudG9wICsgYS5oZWlnaHQgPD0gYi50b3AgfHxcbiAgICAgIGIudG9wICsgYi5oZWlnaHQgPD0gYS50b3BcbiAgICApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBpbnRlcnNlY3Rpb24gYXJlYSdzIHdpZHRoLCBoZWlnaHQsIG1heCBoZWlnaHQgYW5kIG1heCB3aWR0aC5cbiAgICB2YXIgd2lkdGggPSBNYXRoLm1pbihhLmxlZnQgKyBhLndpZHRoLCBiLmxlZnQgKyBiLndpZHRoKSAtIE1hdGgubWF4KGEubGVmdCwgYi5sZWZ0KTtcbiAgICB2YXIgaGVpZ2h0ID0gTWF0aC5taW4oYS50b3AgKyBhLmhlaWdodCwgYi50b3AgKyBiLmhlaWdodCkgLSBNYXRoLm1heChhLnRvcCwgYi50b3ApO1xuICAgIHZhciBtYXhXaWR0aCA9IE1hdGgubWluKGEud2lkdGgsIGIud2lkdGgpO1xuICAgIHZhciBtYXhIZWlnaHQgPSBNYXRoLm1pbihhLmhlaWdodCwgYi5oZWlnaHQpO1xuXG4gICAgcmV0dXJuICgod2lkdGggKiBoZWlnaHQpIC8gKG1heFdpZHRoICogbWF4SGVpZ2h0KSkgKiAxMDA7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYW4gZWxlbWVudCBpcyBhbiBhbmNob3IgZWxlbWVudCBhbmQgb3BlbiB0aGUgaHJlZiB1cmwgaWYgcG9zc2libGUuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICovXG4gIGZ1bmN0aW9uIG9wZW5BbmNob3JIcmVmKGVsZW1lbnQpIHtcbiAgICAvLyBNYWtlIHN1cmUgdGhlIGVsZW1lbnQgaXMgYW5jaG9yIGVsZW1lbnQuXG4gICAgaWYgKGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnYScpIHJldHVybjtcblxuICAgIC8vIEdldCBocmVmIGFuZCBtYWtlIHN1cmUgaXQgZXhpc3RzLlxuICAgIHZhciBocmVmID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcbiAgICBpZiAoIWhyZWYpIHJldHVybjtcblxuICAgIC8vIEZpbmFsbHkgbGV0J3MgbmF2aWdhdGUgdG8gdGhlIGxpbmsgaHJlZi5cbiAgICB2YXIgdGFyZ2V0ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhcmdldCcpO1xuICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0ICE9PSAnX3NlbGYnKSB7XG4gICAgICB3aW5kb3cub3BlbihocmVmLCB0YXJnZXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGhyZWY7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERyYWcgcGxhY2Vob2xkZXIuXG4gICAqXG4gICAqIEBjbGFzc1xuICAgKiBAcGFyYW0ge0l0ZW19IGl0ZW1cbiAgICovXG4gIGZ1bmN0aW9uIEl0ZW1EcmFnUGxhY2Vob2xkZXIoaXRlbSkge1xuICAgIHRoaXMuX2l0ZW0gPSBpdGVtO1xuICAgIHRoaXMuX2FuaW1hdGUgPSBuZXcgSXRlbUFuaW1hdGUoKTtcbiAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcbiAgICB0aGlzLl9jbGFzc05hbWUgPSAnJztcbiAgICB0aGlzLl9kaWRNaWdyYXRlID0gZmFsc2U7XG4gICAgdGhpcy5fcmVzZXRBZnRlckxheW91dCA9IGZhbHNlO1xuICAgIHRoaXMuX2N1cnJlbnRMZWZ0ID0gMDtcbiAgICB0aGlzLl9jdXJyZW50VG9wID0gMDtcbiAgICB0aGlzLl9uZXh0TGVmdCA9IDA7XG4gICAgdGhpcy5fbmV4dFRvcCA9IDA7XG5cbiAgICAvLyBCaW5kIGFuaW1hdGlvbiBoYW5kbGVycy5cbiAgICB0aGlzLl9zZXR1cEFuaW1hdGlvbiA9IHRoaXMuX3NldHVwQW5pbWF0aW9uLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fc3RhcnRBbmltYXRpb24gPSB0aGlzLl9zdGFydEFuaW1hdGlvbi5iaW5kKHRoaXMpO1xuXG4gICAgLy8gQmluZCBldmVudCBoYW5kbGVycy5cbiAgICB0aGlzLl9vbkxheW91dFN0YXJ0ID0gdGhpcy5fb25MYXlvdXRTdGFydC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uTGF5b3V0RW5kID0gdGhpcy5fb25MYXlvdXRFbmQuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vblJlbGVhc2VFbmQgPSB0aGlzLl9vblJlbGVhc2VFbmQuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbk1pZ3JhdGUgPSB0aGlzLl9vbk1pZ3JhdGUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIHByb3RvdHlwZSBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIE1vdmUgcGxhY2Vob2xkZXIgdG8gYSBuZXcgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZ1BsYWNlaG9sZGVyLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGUuX29uTGF5b3V0U3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIGdyaWQgPSBpdGVtLmdldEdyaWQoKTtcblxuICAgIC8vIEZpbmQgb3V0IHRoZSBpdGVtJ3MgbmV3ICh1bmFwcGxpZWQpIGxlZnQgYW5kIHRvcCBwb3NpdGlvbi5cbiAgICB2YXIgaXRlbUluZGV4ID0gZ3JpZC5faXRlbXMuaW5kZXhPZihpdGVtKTtcbiAgICB2YXIgbmV4dExlZnQgPSBncmlkLl9sYXlvdXQuc2xvdHNbaXRlbUluZGV4ICogMl07XG4gICAgdmFyIG5leHRUb3AgPSBncmlkLl9sYXlvdXQuc2xvdHNbaXRlbUluZGV4ICogMiArIDFdO1xuXG4gICAgLy8gSWYgaXRlbSdzIHBvc2l0aW9uIGRpZCBub3QgY2hhbmdlIGFuZCB0aGUgaXRlbSBkaWQgbm90IG1pZ3JhdGUgd2UgY2FuXG4gICAgLy8gc2FmZWx5IHNraXAgbGF5b3V0LlxuICAgIGlmICghdGhpcy5fZGlkTWlncmF0ZSAmJiBpdGVtLl9sZWZ0ID09PSBuZXh0TGVmdCAmJiBpdGVtLl90b3AgPT09IG5leHRUb3ApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTbG90cyBkYXRhIGlzIGNhbGN1bGF0ZWQgd2l0aCBpdGVtIG1hcmdpbnMgYWRkZWQgdG8gdGhlbSBzbyB3ZSBuZWVkIHRvIGFkZFxuICAgIC8vIGl0ZW0ncyBsZWZ0IGFuZCB0b3AgbWFyZ2luIHRvIHRoZSBzbG90IGRhdGEgdG8gZ2V0IHRoZSBwbGFjZWhvbGRlcidzXG4gICAgLy8gbmV4dCBwb3NpdGlvbi5cbiAgICBuZXh0TGVmdCArPSBpdGVtLl9tYXJnaW5MZWZ0O1xuICAgIG5leHRUb3AgKz0gaXRlbS5fbWFyZ2luVG9wO1xuXG4gICAgLy8gSnVzdCBzbmFwIHRvIG5ldyBwb3NpdGlvbiB3aXRob3V0IGFueSBhbmltYXRpb25zIGlmIG5vIGFuaW1hdGlvbiBpc1xuICAgIC8vIHJlcXVpcmVkIG9yIGlmIHBsYWNlaG9sZGVyIG1vdmVzIGJldHdlZW4gZ3JpZHMuXG4gICAgdmFyIGFuaW1FbmFibGVkID0gZ3JpZC5fc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLmR1cmF0aW9uID4gMDtcbiAgICBpZiAoIWFuaW1FbmFibGVkIHx8IHRoaXMuX2RpZE1pZ3JhdGUpIHtcbiAgICAgIC8vIENhbmNlbCBwb3RlbnRpYWwgKHF1ZXVlZCkgbGF5b3V0IHRpY2suXG4gICAgICBjYW5jZWxQbGFjZWhvbGRlclRpY2soaXRlbS5faWQpO1xuXG4gICAgICAvLyBTbmFwIHBsYWNlaG9sZGVyIHRvIGNvcnJlY3QgcG9zaXRpb24uXG4gICAgICB2YXIgdGFyZ2V0U3R5bGVzID0geyB0cmFuc2Zvcm06IGdldFRyYW5zbGF0ZVN0cmluZyhuZXh0TGVmdCwgbmV4dFRvcCkgfTtcbiAgICAgIGlmICh0aGlzLl9hbmltYXRlLmlzQW5pbWF0aW5nKCkpIHtcbiAgICAgICAgdGhpcy5fYW5pbWF0ZS5zdG9wKHRhcmdldFN0eWxlcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRTdHlsZXModGhpcy5fZWxlbWVudCwgdGFyZ2V0U3R5bGVzKTtcbiAgICAgIH1cblxuICAgICAgLy8gTW92ZSBwbGFjZWhvbGRlciBpbnNpZGUgY29ycmVjdCBjb250YWluZXIgYWZ0ZXIgbWlncmF0aW9uLlxuICAgICAgaWYgKHRoaXMuX2RpZE1pZ3JhdGUpIHtcbiAgICAgICAgZ3JpZC5nZXRFbGVtZW50KCkuYXBwZW5kQ2hpbGQodGhpcy5fZWxlbWVudCk7XG4gICAgICAgIHRoaXMuX2RpZE1pZ3JhdGUgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IHRoZSBwbGFjZWhvbGRlcidzIGxheW91dCBhbmltYXRpb24gaW4gdGhlIG5leHQgdGljay4gV2UgZG8gdGhpcyB0b1xuICAgIC8vIGF2b2lkIGxheW91dCB0aHJhc2hpbmcuXG4gICAgdGhpcy5fbmV4dExlZnQgPSBuZXh0TGVmdDtcbiAgICB0aGlzLl9uZXh0VG9wID0gbmV4dFRvcDtcbiAgICBhZGRQbGFjZWhvbGRlclRpY2soaXRlbS5faWQsIHRoaXMuX3NldHVwQW5pbWF0aW9uLCB0aGlzLl9zdGFydEFuaW1hdGlvbik7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByZXBhcmUgcGxhY2Vob2xkZXIgZm9yIGxheW91dCBhbmltYXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZ1BsYWNlaG9sZGVyLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGUuX3NldHVwQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHJldHVybjtcblxuICAgIHZhciB0cmFuc2xhdGUgPSBnZXRUcmFuc2xhdGUodGhpcy5fZWxlbWVudCk7XG4gICAgdGhpcy5fY3VycmVudExlZnQgPSB0cmFuc2xhdGUueDtcbiAgICB0aGlzLl9jdXJyZW50VG9wID0gdHJhbnNsYXRlLnk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGxheW91dCBhbmltYXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZ1BsYWNlaG9sZGVyLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGUuX3N0YXJ0QW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHJldHVybjtcblxuICAgIHZhciBhbmltYXRpb24gPSB0aGlzLl9hbmltYXRlO1xuICAgIHZhciBjdXJyZW50TGVmdCA9IHRoaXMuX2N1cnJlbnRMZWZ0O1xuICAgIHZhciBjdXJyZW50VG9wID0gdGhpcy5fY3VycmVudFRvcDtcbiAgICB2YXIgbmV4dExlZnQgPSB0aGlzLl9uZXh0TGVmdDtcbiAgICB2YXIgbmV4dFRvcCA9IHRoaXMuX25leHRUb3A7XG4gICAgdmFyIHRhcmdldFN0eWxlcyA9IHsgdHJhbnNmb3JtOiBnZXRUcmFuc2xhdGVTdHJpbmcobmV4dExlZnQsIG5leHRUb3ApIH07XG5cbiAgICAvLyBJZiBwbGFjZWhvbGRlciBpcyBhbHJlYWR5IGluIGNvcnJlY3QgcG9zaXRpb24gbGV0J3MganVzdCBzdG9wIGFuaW1hdGlvblxuICAgIC8vIGFuZCBiZSBkb25lIHdpdGggaXQuXG4gICAgaWYgKGN1cnJlbnRMZWZ0ID09PSBuZXh0TGVmdCAmJiBjdXJyZW50VG9wID09PSBuZXh0VG9wKSB7XG4gICAgICBpZiAoYW5pbWF0aW9uLmlzQW5pbWF0aW5nKCkpIGFuaW1hdGlvbi5zdG9wKHRhcmdldFN0eWxlcyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlIGxldCdzIHN0YXJ0IHRoZSBhbmltYXRpb24uXG4gICAgdmFyIHNldHRpbmdzID0gdGhpcy5faXRlbS5nZXRHcmlkKCkuX3NldHRpbmdzLmRyYWdQbGFjZWhvbGRlcjtcbiAgICB2YXIgY3VycmVudFN0eWxlcyA9IHsgdHJhbnNmb3JtOiBnZXRUcmFuc2xhdGVTdHJpbmcoY3VycmVudExlZnQsIGN1cnJlbnRUb3ApIH07XG4gICAgYW5pbWF0aW9uLnN0YXJ0KGN1cnJlbnRTdHlsZXMsIHRhcmdldFN0eWxlcywge1xuICAgICAgZHVyYXRpb246IHNldHRpbmdzLmR1cmF0aW9uLFxuICAgICAgZWFzaW5nOiBzZXR0aW5ncy5lYXNpbmcsXG4gICAgICBvbkZpbmlzaDogdGhpcy5fb25MYXlvdXRFbmRcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogTGF5b3V0IGVuZCBoYW5kbGVyLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLl9vbkxheW91dEVuZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9yZXNldEFmdGVyTGF5b3V0KSB7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBEcmFnIGVuZCBoYW5kbGVyLiBUaGlzIGhhbmRsZXIgaXMgY2FsbGVkIHdoZW4gZHJhZ1JlbGVhc2VFbmQgZXZlbnQgaXNcbiAgICogZW1pdHRlZCBhbmQgcmVjZWl2ZXMgdGhlIGV2ZW50IGRhdGEgYXMgaXQncyBhcmd1bWVudC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7SXRlbX0gaXRlbVxuICAgKi9cbiAgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGUuX29uUmVsZWFzZUVuZCA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpZiAoaXRlbS5faWQgPT09IHRoaXMuX2l0ZW0uX2lkKSB7XG4gICAgICAvLyBJZiB0aGUgcGxhY2Vob2xkZXIgaXMgbm90IGFuaW1hdGluZyBhbnltb3JlIHdlIGNhbiBzYWZlbHkgcmVzZXQgaXQuXG4gICAgICBpZiAoIXRoaXMuX2FuaW1hdGUuaXNBbmltYXRpbmcoKSkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgdGhlIHBsYWNlaG9sZGVyIGl0ZW0gaXMgc3RpbGwgYW5pbWF0aW5nIGhlcmUsIGxldCdzIHdhaXQgZm9yIGl0IHRvXG4gICAgICAvLyBmaW5pc2ggaXQncyBhbmltYXRpb24uXG4gICAgICB0aGlzLl9yZXNldEFmdGVyTGF5b3V0ID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIE1pZ3JhdGlvbiBzdGFydCBoYW5kbGVyLiBUaGlzIGhhbmRsZXIgaXMgY2FsbGVkIHdoZW4gYmVmb3JlU2VuZCBldmVudCBpc1xuICAgKiBlbWl0dGVkIGFuZCByZWNlaXZlcyB0aGUgZXZlbnQgZGF0YSBhcyBpdCdzIGFyZ3VtZW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICogQHBhcmFtIHtJdGVtfSBkYXRhLml0ZW1cbiAgICogQHBhcmFtIHtHcmlkfSBkYXRhLmZyb21HcmlkXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLmZyb21JbmRleFxuICAgKiBAcGFyYW0ge0dyaWR9IGRhdGEudG9HcmlkXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLnRvSW5kZXhcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLl9vbk1pZ3JhdGUgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBtYXRjaGluZyBpdGVtLlxuICAgIGlmIChkYXRhLml0ZW0gIT09IHRoaXMuX2l0ZW0pIHJldHVybjtcblxuICAgIHZhciBncmlkID0gdGhpcy5faXRlbS5nZXRHcmlkKCk7XG4gICAgdmFyIG5leHRHcmlkID0gZGF0YS50b0dyaWQ7XG5cbiAgICAvLyBVbmJpbmQgbGlzdGVuZXJzIGZyb20gY3VycmVudCBncmlkLlxuICAgIGdyaWQub2ZmKGV2ZW50RHJhZ1JlbGVhc2VFbmQsIHRoaXMuX29uUmVsZWFzZUVuZCk7XG4gICAgZ3JpZC5vZmYoZXZlbnRMYXlvdXRTdGFydCwgdGhpcy5fb25MYXlvdXRTdGFydCk7XG4gICAgZ3JpZC5vZmYoZXZlbnRCZWZvcmVTZW5kLCB0aGlzLl9vbk1pZ3JhdGUpO1xuXG4gICAgLy8gQmluZCBsaXN0ZW5lcnMgdG8gdGhlIG5leHQgZ3JpZC5cbiAgICBuZXh0R3JpZC5vbihldmVudERyYWdSZWxlYXNlRW5kLCB0aGlzLl9vblJlbGVhc2VFbmQpO1xuICAgIG5leHRHcmlkLm9uKGV2ZW50TGF5b3V0U3RhcnQsIHRoaXMuX29uTGF5b3V0U3RhcnQpO1xuICAgIG5leHRHcmlkLm9uKGV2ZW50QmVmb3JlU2VuZCwgdGhpcy5fb25NaWdyYXRlKTtcblxuICAgIC8vIE1hcmsgdGhlIGl0ZW0gYXMgbWlncmF0ZWQuXG4gICAgdGhpcy5fZGlkTWlncmF0ZSA9IHRydWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIENyZWF0ZSBwbGFjZWhvbGRlci4gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgd3JpdGVzIHRvIERPTSBhbmQgZG9lcyBub3RcbiAgICogcmVhZCBhbnl0aGluZyBmcm9tIERPTSBzbyBpdCBzaG91bGQgbm90IGNhdXNlIGFueSBhZGRpdGlvbmFsIGxheW91dFxuICAgKiB0aHJhc2hpbmcgd2hlbiBpdCdzIGNhbGxlZCBhdCB0aGUgZW5kIG9mIHRoZSBkcmFnIHN0YXJ0IHByb2NlZHVyZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8vIElmIHdlIGFscmVhZHkgaGF2ZSBwbGFjZWhvbGRlciBzZXQgdXAgd2UgY2FuIHNraXAgdGhlIGluaXRpYXRpb24gbG9naWMuXG4gICAgaWYgKHRoaXMuaXNBY3RpdmUoKSkge1xuICAgICAgdGhpcy5fcmVzZXRBZnRlckxheW91dCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgZ3JpZCA9IGl0ZW0uZ2V0R3JpZCgpO1xuICAgIHZhciBzZXR0aW5ncyA9IGdyaWQuX3NldHRpbmdzO1xuICAgIHZhciBhbmltYXRpb24gPSB0aGlzLl9hbmltYXRlO1xuXG4gICAgLy8gQ3JlYXRlIHBsYWNlaG9sZGVyIGVsZW1lbnQuXG4gICAgdmFyIGVsZW1lbnQ7XG4gICAgaWYgKGlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLmNyZWF0ZUVsZW1lbnQpKSB7XG4gICAgICBlbGVtZW50ID0gc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLmNyZWF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgfVxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuXG4gICAgLy8gVXBkYXRlIGVsZW1lbnQgdG8gYW5pbWF0aW9uIGluc3RhbmNlLlxuICAgIGFuaW1hdGlvbi5fZWxlbWVudCA9IGVsZW1lbnQ7XG5cbiAgICAvLyBBZGQgcGxhY2Vob2xkZXIgY2xhc3MgdG8gdGhlIHBsYWNlaG9sZGVyIGVsZW1lbnQuXG4gICAgdGhpcy5fY2xhc3NOYW1lID0gc2V0dGluZ3MuaXRlbVBsYWNlaG9sZGVyQ2xhc3MgfHwgJyc7XG4gICAgaWYgKHRoaXMuX2NsYXNzTmFtZSkge1xuICAgICAgYWRkQ2xhc3MoZWxlbWVudCwgdGhpcy5fY2xhc3NOYW1lKTtcbiAgICB9XG5cbiAgICAvLyBQb3NpdGlvbiB0aGUgcGxhY2Vob2xkZXIgaXRlbSBjb3JyZWN0bHkuXG4gICAgdmFyIGxlZnQgPSBpdGVtLl9sZWZ0ICsgaXRlbS5fbWFyZ2luTGVmdDtcbiAgICB2YXIgdG9wID0gaXRlbS5fdG9wICsgaXRlbS5fbWFyZ2luVG9wO1xuICAgIHNldFN0eWxlcyhlbGVtZW50LCB7XG4gICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICBsZWZ0OiAnMCcsXG4gICAgICB0b3A6ICcwJyxcbiAgICAgIHdpZHRoOiBpdGVtLl93aWR0aCArICdweCcsXG4gICAgICBoZWlnaHQ6IGl0ZW0uX2hlaWdodCArICdweCcsXG4gICAgICB0cmFuc2Zvcm06IGdldFRyYW5zbGF0ZVN0cmluZyhsZWZ0LCB0b3ApXG4gICAgfSk7XG5cbiAgICAvLyBCaW5kIGV2ZW50IGxpc3RlbmVycy5cbiAgICBncmlkLm9uKGV2ZW50TGF5b3V0U3RhcnQsIHRoaXMuX29uTGF5b3V0U3RhcnQpO1xuICAgIGdyaWQub24oZXZlbnREcmFnUmVsZWFzZUVuZCwgdGhpcy5fb25SZWxlYXNlRW5kKTtcbiAgICBncmlkLm9uKGV2ZW50QmVmb3JlU2VuZCwgdGhpcy5fb25NaWdyYXRlKTtcblxuICAgIC8vIG9uQ3JlYXRlIGhvb2suXG4gICAgaWYgKGlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLm9uQ3JlYXRlKSkge1xuICAgICAgc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLm9uQ3JlYXRlKGl0ZW0sIGVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8vIEluc2VydCB0aGUgcGxhY2Vob2xkZXIgZWxlbWVudCB0byB0aGUgZ3JpZC5cbiAgICBncmlkLmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgfTtcblxuICAvKipcbiAgICogUmVzZXQgcGxhY2Vob2xkZXIgZGF0YS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHJldHVybjtcblxuICAgIHZhciBlbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIGdyaWQgPSBpdGVtLmdldEdyaWQoKTtcbiAgICB2YXIgc2V0dGluZ3MgPSBncmlkLl9zZXR0aW5ncztcbiAgICB2YXIgYW5pbWF0aW9uID0gdGhpcy5fYW5pbWF0ZTtcblxuICAgIC8vIFJlc2V0IGZsYWcuXG4gICAgdGhpcy5fcmVzZXRBZnRlckxheW91dCA9IGZhbHNlO1xuXG4gICAgLy8gQ2FuY2VsIHBvdGVudGlhbCAocXVldWVkKSBsYXlvdXQgdGljay5cbiAgICBjYW5jZWxQbGFjZWhvbGRlclRpY2soaXRlbS5faWQpO1xuXG4gICAgLy8gUmVzZXQgYW5pbWF0aW9uIGluc3RhbmNlLlxuICAgIGFuaW1hdGlvbi5zdG9wKCk7XG4gICAgYW5pbWF0aW9uLl9lbGVtZW50ID0gbnVsbDtcblxuICAgIC8vIFVuYmluZCBldmVudCBsaXN0ZW5lcnMuXG4gICAgZ3JpZC5vZmYoZXZlbnREcmFnUmVsZWFzZUVuZCwgdGhpcy5fb25SZWxlYXNlRW5kKTtcbiAgICBncmlkLm9mZihldmVudExheW91dFN0YXJ0LCB0aGlzLl9vbkxheW91dFN0YXJ0KTtcbiAgICBncmlkLm9mZihldmVudEJlZm9yZVNlbmQsIHRoaXMuX29uTWlncmF0ZSk7XG5cbiAgICAvLyBSZW1vdmUgcGxhY2Vob2xkZXIgY2xhc3MgZnJvbSB0aGUgcGxhY2Vob2xkZXIgZWxlbWVudC5cbiAgICBpZiAodGhpcy5fY2xhc3NOYW1lKSB7XG4gICAgICByZW1vdmVDbGFzcyhlbGVtZW50LCB0aGlzLl9jbGFzc05hbWUpO1xuICAgICAgdGhpcy5fY2xhc3NOYW1lID0gJyc7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGVsZW1lbnQuXG4gICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuXG4gICAgLy8gb25SZW1vdmUgaG9vay4gTm90ZSB0aGF0IGhlcmUgd2UgdXNlIHRoZSBjdXJyZW50IGdyaWQncyBvblJlbW92ZSBjYWxsYmFja1xuICAgIC8vIHNvIGlmIHRoZSBpdGVtIGhhcyBtaWdyYXRlZCBkdXJpbmcgZHJhZyB0aGUgb25SZW1vdmUgbWV0aG9kIHdpbGwgbm90IGJlXG4gICAgLy8gdGhlIG9yaWdpbmF0aW5nIGdyaWQncyBtZXRob2QuXG4gICAgaWYgKGlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLm9uUmVtb3ZlKSkge1xuICAgICAgc2V0dGluZ3MuZHJhZ1BsYWNlaG9sZGVyLm9uUmVtb3ZlKGl0ZW0sIGVsZW1lbnQpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVXBkYXRlIHBsYWNlaG9sZGVyJ3MgZGltZW5zaW9ucy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoXG4gICAqIEBwYXJhbSB7aGVpZ2h0fSBoZWlnaHRcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLnVwZGF0ZURpbWVuc2lvbnMgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgaWYgKHRoaXMuaXNBY3RpdmUoKSkge1xuICAgICAgc2V0U3R5bGVzKHRoaXMuX2VsZW1lbnQsIHtcbiAgICAgICAgd2lkdGg6IHdpZHRoICsgJ3B4JyxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQgKyAncHgnXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHBsYWNlaG9sZGVyIGlzIGN1cnJlbnRseSBhY3RpdmUgKHZpc2libGUpLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtRHJhZ1BsYWNlaG9sZGVyLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEhdGhpcy5fZWxlbWVudDtcbiAgfTtcblxuICAvKipcbiAgICogRGVzdHJveSBwbGFjZWhvbGRlciBpbnN0YW5jZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbURyYWdQbGFjZWhvbGRlci5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1EcmFnUGxhY2Vob2xkZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJlc2V0KCk7XG4gICAgdGhpcy5fYW5pbWF0ZS5kZXN0cm95KCk7XG4gICAgdGhpcy5faXRlbSA9IHRoaXMuX2FuaW1hdGUgPSBudWxsO1xuICB9O1xuXG4gIC8qKlxuICAgKiBRdWV1ZSBjb25zdHJ1Y3Rvci5cbiAgICpcbiAgICogQGNsYXNzXG4gICAqL1xuICBmdW5jdGlvbiBRdWV1ZSgpIHtcbiAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogUHVibGljIHByb3RvdHlwZSBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogQWRkIGNhbGxiYWNrIHRvIHRoZSBxdWV1ZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgUXVldWUucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAqIEByZXR1cm5zIHtRdWV1ZX1cbiAgICovXG4gIFF1ZXVlLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG4gICAgdGhpcy5fcXVldWUucHVzaChjYWxsYmFjayk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgcXVldWUgY2FsbGJhY2tzIGFuZCByZXNldCB0aGUgcXVldWUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIFF1ZXVlLnByb3RvdHlwZVxuICAgKiBAcGFyYW0geyp9IGFyZzFcbiAgICogQHBhcmFtIHsqfSBhcmcyXG4gICAqIEByZXR1cm5zIHtRdWV1ZX1cbiAgICovXG4gIFF1ZXVlLnByb3RvdHlwZS5mbHVzaCA9IGZ1bmN0aW9uKGFyZzEsIGFyZzIpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIHF1ZXVlID0gdGhpcy5fcXVldWU7XG4gICAgdmFyIGxlbmd0aCA9IHF1ZXVlLmxlbmd0aDtcbiAgICB2YXIgaTtcblxuICAgIC8vIFF1aXQgZWFybHkgaWYgdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICAgIGlmICghbGVuZ3RoKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBzaW5nbGVDYWxsYmFjayA9IGxlbmd0aCA9PT0gMTtcbiAgICB2YXIgc25hcHNob3QgPSBzaW5nbGVDYWxsYmFjayA/IHF1ZXVlWzBdIDogcXVldWUuc2xpY2UoMCk7XG5cbiAgICAvLyBSZXNldCBxdWV1ZS5cbiAgICBxdWV1ZS5sZW5ndGggPSAwO1xuXG4gICAgLy8gSWYgd2Ugb25seSBoYXZlIGEgc2luZ2xlIGNhbGxiYWNrIGxldCdzIGp1c3QgY2FsbCBpdC5cbiAgICBpZiAoc2luZ2xlQ2FsbGJhY2spIHtcbiAgICAgIHNuYXBzaG90KGFyZzEsIGFyZzIpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLy8gSWYgd2UgaGF2ZSBtdWx0aXBsZSBjYWxsYmFja3MsIGxldCdzIHByb2Nlc3MgdGhlbS5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHNuYXBzaG90W2ldKGFyZzEsIGFyZzIpO1xuICAgICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogRGVzdHJveSBRdWV1ZSBpbnN0YW5jZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgUXVldWUucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtRdWV1ZX1cbiAgICovXG4gIFF1ZXVlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdHJ1ZTtcbiAgICB0aGlzLl9xdWV1ZS5sZW5ndGggPSAwO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIExheW91dCBtYW5hZ2VyIGZvciBJdGVtIGluc3RhbmNlLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqL1xuICBmdW5jdGlvbiBJdGVtTGF5b3V0KGl0ZW0pIHtcbiAgICB0aGlzLl9pdGVtID0gaXRlbTtcbiAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gZmFsc2U7XG4gICAgdGhpcy5faXNJbnRlcnJ1cHRlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2N1cnJlbnRTdHlsZXMgPSB7fTtcbiAgICB0aGlzLl90YXJnZXRTdHlsZXMgPSB7fTtcbiAgICB0aGlzLl9jdXJyZW50TGVmdCA9IDA7XG4gICAgdGhpcy5fY3VycmVudFRvcCA9IDA7XG4gICAgdGhpcy5fb2Zmc2V0TGVmdCA9IDA7XG4gICAgdGhpcy5fb2Zmc2V0VG9wID0gMDtcbiAgICB0aGlzLl9za2lwTmV4dEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgIHRoaXMuX2FuaW1hdGVPcHRpb25zID0ge1xuICAgICAgb25GaW5pc2g6IHRoaXMuX2ZpbmlzaC5iaW5kKHRoaXMpXG4gICAgfTtcbiAgICB0aGlzLl9xdWV1ZSA9IG5ldyBRdWV1ZSgpO1xuXG4gICAgLy8gQmluZCBhbmltYXRpb24gaGFuZGxlcnMgYW5kIGZpbmlzaCBtZXRob2QuXG4gICAgdGhpcy5fc2V0dXBBbmltYXRpb24gPSB0aGlzLl9zZXR1cEFuaW1hdGlvbi5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX3N0YXJ0QW5pbWF0aW9uID0gdGhpcy5fc3RhcnRBbmltYXRpb24uYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdGFydCBpdGVtIGxheW91dCBiYXNlZCBvbiBpdCdzIGN1cnJlbnQgZGF0YS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbUxheW91dC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5zdGFudD1mYWxzZV1cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uRmluaXNoXVxuICAgKiBAcmV0dXJucyB7SXRlbUxheW91dH1cbiAgICovXG4gIEl0ZW1MYXlvdXQucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oaW5zdGFudCwgb25GaW5pc2gpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgZWxlbWVudCA9IGl0ZW0uX2VsZW1lbnQ7XG4gICAgdmFyIHJlbGVhc2UgPSBpdGVtLl9yZWxlYXNlO1xuICAgIHZhciBncmlkU2V0dGluZ3MgPSBpdGVtLmdldEdyaWQoKS5fc2V0dGluZ3M7XG4gICAgdmFyIGlzUG9zaXRpb25pbmcgPSB0aGlzLl9pc0FjdGl2ZTtcbiAgICB2YXIgaXNKdXN0UmVsZWFzZWQgPSByZWxlYXNlLl9pc0FjdGl2ZSAmJiByZWxlYXNlLl9pc1Bvc2l0aW9uaW5nU3RhcnRlZCA9PT0gZmFsc2U7XG4gICAgdmFyIGFuaW1EdXJhdGlvbiA9IGlzSnVzdFJlbGVhc2VkXG4gICAgICA/IGdyaWRTZXR0aW5ncy5kcmFnUmVsZWFzZUR1cmF0aW9uXG4gICAgICA6IGdyaWRTZXR0aW5ncy5sYXlvdXREdXJhdGlvbjtcbiAgICB2YXIgYW5pbUVhc2luZyA9IGlzSnVzdFJlbGVhc2VkID8gZ3JpZFNldHRpbmdzLmRyYWdSZWxlYXNlRWFzaW5nIDogZ3JpZFNldHRpbmdzLmxheW91dEVhc2luZztcbiAgICB2YXIgYW5pbUVuYWJsZWQgPSAhaW5zdGFudCAmJiAhdGhpcy5fc2tpcE5leHRBbmltYXRpb24gJiYgYW5pbUR1cmF0aW9uID4gMDtcbiAgICB2YXIgaXNBbmltYXRpbmc7XG5cbiAgICAvLyBJZiB0aGUgaXRlbSBpcyBjdXJyZW50bHkgcG9zaXRpb25pbmcgcHJvY2VzcyBjdXJyZW50IGxheW91dCBjYWxsYmFja1xuICAgIC8vIHF1ZXVlIHdpdGggaW50ZXJydXB0ZWQgZmxhZyBvbi5cbiAgICBpZiAoaXNQb3NpdGlvbmluZykgdGhpcy5fcXVldWUuZmx1c2godHJ1ZSwgaXRlbSk7XG5cbiAgICAvLyBNYXJrIHJlbGVhc2UgcG9zaXRpb25pbmcgYXMgc3RhcnRlZC5cbiAgICBpZiAoaXNKdXN0UmVsZWFzZWQpIHJlbGVhc2UuX2lzUG9zaXRpb25pbmdTdGFydGVkID0gdHJ1ZTtcblxuICAgIC8vIFB1c2ggdGhlIGNhbGxiYWNrIHRvIHRoZSBjYWxsYmFjayBxdWV1ZS5cbiAgICBpZiAoaXNGdW5jdGlvbihvbkZpbmlzaCkpIHRoaXMuX3F1ZXVlLmFkZChvbkZpbmlzaCk7XG5cbiAgICAvLyBJZiBubyBhbmltYXRpb25zIGFyZSBuZWVkZWQsIGVhc3kgcGVhc3khXG4gICAgaWYgKCFhbmltRW5hYmxlZCkge1xuICAgICAgdGhpcy5fdXBkYXRlT2Zmc2V0cygpO1xuICAgICAgdGhpcy5fdXBkYXRlVGFyZ2V0U3R5bGVzKCk7XG4gICAgICBpc0FuaW1hdGluZyA9IGl0ZW0uX2FuaW1hdGUuaXNBbmltYXRpbmcoKTtcbiAgICAgIHRoaXMuc3RvcChmYWxzZSwgdGhpcy5fdGFyZ2V0U3R5bGVzKTtcbiAgICAgICFpc0FuaW1hdGluZyAmJiBzZXRTdHlsZXMoZWxlbWVudCwgdGhpcy5fdGFyZ2V0U3R5bGVzKTtcbiAgICAgIHRoaXMuX3NraXBOZXh0QW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICByZXR1cm4gdGhpcy5fZmluaXNoKCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGl0ZW0gYWN0aXZlIGFuZCBzdG9yZSBzb21lIGRhdGEgZm9yIHRoZSBhbmltYXRpb24gdGhhdCBpcyBhYm91dCB0byBiZVxuICAgIC8vIHRyaWdnZXJlZC5cbiAgICB0aGlzLl9pc0FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fYW5pbWF0ZU9wdGlvbnMuZWFzaW5nID0gYW5pbUVhc2luZztcbiAgICB0aGlzLl9hbmltYXRlT3B0aW9ucy5kdXJhdGlvbiA9IGFuaW1EdXJhdGlvbjtcbiAgICB0aGlzLl9pc0ludGVycnVwdGVkID0gaXNQb3NpdGlvbmluZztcblxuICAgIC8vIFN0YXJ0IHRoZSBpdGVtJ3MgbGF5b3V0IGFuaW1hdGlvbiBpbiB0aGUgbmV4dCB0aWNrLlxuICAgIGFkZExheW91dFRpY2soaXRlbS5faWQsIHRoaXMuX3NldHVwQW5pbWF0aW9uLCB0aGlzLl9zdGFydEFuaW1hdGlvbik7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogU3RvcCBpdGVtJ3MgcG9zaXRpb24gYW5pbWF0aW9uIGlmIGl0IGlzIGN1cnJlbnRseSBhbmltYXRpbmcuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1MYXlvdXQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3Byb2Nlc3NDYWxsYmFja1F1ZXVlPWZhbHNlXVxuICAgKiBAcGFyYW0ge09iamVjdH0gW3RhcmdldFN0eWxlc11cbiAgICogQHJldHVybnMge0l0ZW1MYXlvdXR9XG4gICAqL1xuICBJdGVtTGF5b3V0LnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24ocHJvY2Vzc0NhbGxiYWNrUXVldWUsIHRhcmdldFN0eWxlcykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCB8fCAhdGhpcy5faXNBY3RpdmUpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuXG4gICAgLy8gQ2FuY2VsIGFuaW1hdGlvbiBpbml0LlxuICAgIGNhbmNlbExheW91dFRpY2soaXRlbS5faWQpO1xuXG4gICAgLy8gU3RvcCBhbmltYXRpb24uXG4gICAgaXRlbS5fYW5pbWF0ZS5zdG9wKHRhcmdldFN0eWxlcyk7XG5cbiAgICAvLyBSZW1vdmUgcG9zaXRpb25pbmcgY2xhc3MuXG4gICAgcmVtb3ZlQ2xhc3MoaXRlbS5fZWxlbWVudCwgaXRlbS5nZXRHcmlkKCkuX3NldHRpbmdzLml0ZW1Qb3NpdGlvbmluZ0NsYXNzKTtcblxuICAgIC8vIFJlc2V0IGFjdGl2ZSBzdGF0ZS5cbiAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlO1xuXG4gICAgLy8gUHJvY2VzcyBjYWxsYmFjayBxdWV1ZSBpZiBuZWVkZWQuXG4gICAgaWYgKHByb2Nlc3NDYWxsYmFja1F1ZXVlKSB0aGlzLl9xdWV1ZS5mbHVzaCh0cnVlLCBpdGVtKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBpbnN0YW5jZSBhbmQgc3RvcCBjdXJyZW50IGFuaW1hdGlvbiBpZiBpdCBpcyBydW5uaW5nLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtTGF5b3V0LnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7SXRlbUxheW91dH1cbiAgICovXG4gIEl0ZW1MYXlvdXQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuICAgIHRoaXMuc3RvcCh0cnVlLCB7fSk7XG4gICAgdGhpcy5fcXVldWUuZGVzdHJveSgpO1xuICAgIHRoaXMuX2l0ZW0gPSB0aGlzLl9jdXJyZW50U3R5bGVzID0gdGhpcy5fdGFyZ2V0U3R5bGVzID0gdGhpcy5fYW5pbWF0ZU9wdGlvbnMgPSBudWxsO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogUHJpdmF0ZSBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgYW5kIHVwZGF0ZSBpdGVtJ3MgY3VycmVudCBsYXlvdXQgb2Zmc2V0IGRhdGEuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtTGF5b3V0LnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbUxheW91dC5wcm90b3R5cGUuX3VwZGF0ZU9mZnNldHMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgbWlncmF0ZSA9IGl0ZW0uX21pZ3JhdGU7XG4gICAgdmFyIHJlbGVhc2UgPSBpdGVtLl9yZWxlYXNlO1xuXG4gICAgdGhpcy5fb2Zmc2V0TGVmdCA9IHJlbGVhc2UuX2lzQWN0aXZlXG4gICAgICA/IHJlbGVhc2UuX2NvbnRhaW5lckRpZmZYXG4gICAgICA6IG1pZ3JhdGUuX2lzQWN0aXZlXG4gICAgICA/IG1pZ3JhdGUuX2NvbnRhaW5lckRpZmZYXG4gICAgICA6IDA7XG5cbiAgICB0aGlzLl9vZmZzZXRUb3AgPSByZWxlYXNlLl9pc0FjdGl2ZVxuICAgICAgPyByZWxlYXNlLl9jb250YWluZXJEaWZmWVxuICAgICAgOiBtaWdyYXRlLl9pc0FjdGl2ZVxuICAgICAgPyBtaWdyYXRlLl9jb250YWluZXJEaWZmWVxuICAgICAgOiAwO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgYW5kIHVwZGF0ZSBpdGVtJ3MgbGF5b3V0IHRhcmdldCBzdHlsZXMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtTGF5b3V0LnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbUxheW91dC5wcm90b3R5cGUuX3VwZGF0ZVRhcmdldFN0eWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuO1xuICAgIHRoaXMuX3RhcmdldFN0eWxlcy50cmFuc2Zvcm0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoXG4gICAgICB0aGlzLl9pdGVtLl9sZWZ0ICsgdGhpcy5fb2Zmc2V0TGVmdCxcbiAgICAgIHRoaXMuX2l0ZW0uX3RvcCArIHRoaXMuX29mZnNldFRvcFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEZpbmlzaCBpdGVtIGxheW91dCBwcm9jZWR1cmUuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtTGF5b3V0LnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbUxheW91dC5wcm90b3R5cGUuX2ZpbmlzaCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuO1xuXG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuICAgIHZhciBtaWdyYXRlID0gaXRlbS5fbWlncmF0ZTtcbiAgICB2YXIgcmVsZWFzZSA9IGl0ZW0uX3JlbGVhc2U7XG5cbiAgICAvLyBNYXJrIHRoZSBpdGVtIGFzIGluYWN0aXZlIGFuZCByZW1vdmUgcG9zaXRpb25pbmcgY2xhc3Nlcy5cbiAgICBpZiAodGhpcy5faXNBY3RpdmUpIHtcbiAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XG4gICAgICByZW1vdmVDbGFzcyhpdGVtLl9lbGVtZW50LCBpdGVtLmdldEdyaWQoKS5fc2V0dGluZ3MuaXRlbVBvc2l0aW9uaW5nQ2xhc3MpO1xuICAgIH1cblxuICAgIC8vIEZpbmlzaCB1cCByZWxlYXNlIGFuZCBtaWdyYXRpb24uXG4gICAgaWYgKHJlbGVhc2UuX2lzQWN0aXZlKSByZWxlYXNlLnN0b3AoKTtcbiAgICBpZiAobWlncmF0ZS5faXNBY3RpdmUpIG1pZ3JhdGUuc3RvcCgpO1xuXG4gICAgLy8gUHJvY2VzcyB0aGUgY2FsbGJhY2sgcXVldWUuXG4gICAgdGhpcy5fcXVldWUuZmx1c2goZmFsc2UsIGl0ZW0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcmVwYXJlIGl0ZW0gZm9yIGxheW91dCBhbmltYXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtTGF5b3V0LnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbUxheW91dC5wcm90b3R5cGUuX3NldHVwQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRyYW5zbGF0ZSA9IGdldFRyYW5zbGF0ZSh0aGlzLl9pdGVtLl9lbGVtZW50KTtcbiAgICB0aGlzLl9jdXJyZW50TGVmdCA9IHRyYW5zbGF0ZS54O1xuICAgIHRoaXMuX2N1cnJlbnRUb3AgPSB0cmFuc2xhdGUueTtcbiAgfTtcblxuICAvKipcbiAgICogU3RhcnQgbGF5b3V0IGFuaW1hdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1MYXlvdXQucHJvdG90eXBlXG4gICAqL1xuICBJdGVtTGF5b3V0LnByb3RvdHlwZS5fc3RhcnRBbmltYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIHNldHRpbmdzID0gaXRlbS5nZXRHcmlkKCkuX3NldHRpbmdzO1xuXG4gICAgLy8gTGV0J3MgdXBkYXRlIHRoZSBvZmZzZXQgZGF0YSBhbmQgdGFyZ2V0IHN0eWxlcy5cbiAgICB0aGlzLl91cGRhdGVPZmZzZXRzKCk7XG4gICAgdGhpcy5fdXBkYXRlVGFyZ2V0U3R5bGVzKCk7XG5cbiAgICAvLyBJZiB0aGUgaXRlbSBpcyBhbHJlYWR5IGluIGNvcnJlY3QgcG9zaXRpb24gbGV0J3MgcXVpdCBlYXJseS5cbiAgICBpZiAoXG4gICAgICBpdGVtLl9sZWZ0ID09PSB0aGlzLl9jdXJyZW50TGVmdCAtIHRoaXMuX29mZnNldExlZnQgJiZcbiAgICAgIGl0ZW0uX3RvcCA9PT0gdGhpcy5fY3VycmVudFRvcCAtIHRoaXMuX29mZnNldFRvcFxuICAgICkge1xuICAgICAgaWYgKHRoaXMuX2lzSW50ZXJydXB0ZWQpIHRoaXMuc3RvcChmYWxzZSwgdGhpcy5fdGFyZ2V0U3R5bGVzKTtcbiAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XG4gICAgICB0aGlzLl9maW5pc2goKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgaXRlbSdzIHBvc2l0aW9uaW5nIGNsYXNzIGlmIG5lZWRlZC5cbiAgICBpZiAoIXRoaXMuX2lzSW50ZXJydXB0ZWQpIHtcbiAgICAgIGFkZENsYXNzKGl0ZW0uX2VsZW1lbnQsIHNldHRpbmdzLml0ZW1Qb3NpdGlvbmluZ0NsYXNzKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBzdHlsZXMgZm9yIGFuaW1hdGlvbi5cbiAgICB0aGlzLl9jdXJyZW50U3R5bGVzLnRyYW5zZm9ybSA9IGdldFRyYW5zbGF0ZVN0cmluZyh0aGlzLl9jdXJyZW50TGVmdCwgdGhpcy5fY3VycmVudFRvcCk7XG5cbiAgICAvLyBBbmltYXRlLlxuICAgIGl0ZW0uX2FuaW1hdGUuc3RhcnQodGhpcy5fY3VycmVudFN0eWxlcywgdGhpcy5fdGFyZ2V0U3R5bGVzLCB0aGlzLl9hbmltYXRlT3B0aW9ucyk7XG4gIH07XG5cbiAgdmFyIHRlbXBTdHlsZXMgPSB7fTtcblxuICAvKipcbiAgICogVGhlIG1pZ3JhdGUgcHJvY2VzcyBoYW5kbGVyIGNvbnN0cnVjdG9yLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqL1xuICBmdW5jdGlvbiBJdGVtTWlncmF0ZShpdGVtKSB7XG4gICAgLy8gUHJpdmF0ZSBwcm9wcy5cbiAgICB0aGlzLl9pdGVtID0gaXRlbTtcbiAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gZmFsc2U7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZmFsc2U7XG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSAwO1xuICAgIHRoaXMuX2NvbnRhaW5lckRpZmZZID0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgbWlncmF0ZSBwcm9jZXNzIG9mIGFuIGl0ZW0uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1NaWdyYXRlLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWR9IHRhcmdldEdyaWRcbiAgICogQHBhcmFtIHtHcmlkU2luZ2xlSXRlbVF1ZXJ5fSBwb3NpdGlvblxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBbY29udGFpbmVyXVxuICAgKiBAcmV0dXJucyB7SXRlbU1pZ3JhdGV9XG4gICAqL1xuICBJdGVtTWlncmF0ZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbih0YXJnZXRHcmlkLCBwb3NpdGlvbiwgY29udGFpbmVyKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgZWxlbWVudCA9IGl0ZW0uX2VsZW1lbnQ7XG4gICAgdmFyIGlzVmlzaWJsZSA9IGl0ZW0uaXNWaXNpYmxlKCk7XG4gICAgdmFyIGdyaWQgPSBpdGVtLmdldEdyaWQoKTtcbiAgICB2YXIgc2V0dGluZ3MgPSBncmlkLl9zZXR0aW5ncztcbiAgICB2YXIgdGFyZ2V0U2V0dGluZ3MgPSB0YXJnZXRHcmlkLl9zZXR0aW5ncztcbiAgICB2YXIgdGFyZ2V0RWxlbWVudCA9IHRhcmdldEdyaWQuX2VsZW1lbnQ7XG4gICAgdmFyIHRhcmdldEl0ZW1zID0gdGFyZ2V0R3JpZC5faXRlbXM7XG4gICAgdmFyIGN1cnJlbnRJbmRleCA9IGdyaWQuX2l0ZW1zLmluZGV4T2YoaXRlbSk7XG4gICAgdmFyIHRhcmdldENvbnRhaW5lciA9IGNvbnRhaW5lciB8fCB3aW5kb3cuZG9jdW1lbnQuYm9keTtcbiAgICB2YXIgdGFyZ2V0SW5kZXg7XG4gICAgdmFyIHRhcmdldEl0ZW07XG4gICAgdmFyIGN1cnJlbnRDb250YWluZXI7XG4gICAgdmFyIG9mZnNldERpZmY7XG4gICAgdmFyIGNvbnRhaW5lckRpZmY7XG4gICAgdmFyIHRyYW5zbGF0ZTtcbiAgICB2YXIgdHJhbnNsYXRlWDtcbiAgICB2YXIgdHJhbnNsYXRlWTtcblxuICAgIC8vIEdldCB0YXJnZXQgaW5kZXguXG4gICAgaWYgKHR5cGVvZiBwb3NpdGlvbiA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRhcmdldEluZGV4ID0gbm9ybWFsaXplQXJyYXlJbmRleCh0YXJnZXRJdGVtcywgcG9zaXRpb24sIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YXJnZXRJdGVtID0gdGFyZ2V0R3JpZC5fZ2V0SXRlbShwb3NpdGlvbik7XG4gICAgICAvKiogQHRvZG8gQ29uc2lkZXIgdGhyb3dpbmcgYW4gZXJyb3IgaGVyZSBpbnN0ZWFkIG9mIHNpbGVudGx5IGZhaWxpbmcuICovXG4gICAgICBpZiAoIXRhcmdldEl0ZW0pIHJldHVybiB0aGlzO1xuICAgICAgdGFyZ2V0SW5kZXggPSB0YXJnZXRJdGVtcy5pbmRleE9mKHRhcmdldEl0ZW0pO1xuICAgIH1cblxuICAgIC8vIEdldCBjdXJyZW50IHRyYW5zbGF0ZVggYW5kIHRyYW5zbGF0ZVkgdmFsdWVzIGlmIG5lZWRlZC5cbiAgICBpZiAoaXRlbS5pc1Bvc2l0aW9uaW5nKCkgfHwgdGhpcy5faXNBY3RpdmUgfHwgaXRlbS5pc1JlbGVhc2luZygpKSB7XG4gICAgICB0cmFuc2xhdGUgPSBnZXRUcmFuc2xhdGUoZWxlbWVudCk7XG4gICAgICB0cmFuc2xhdGVYID0gdHJhbnNsYXRlLng7XG4gICAgICB0cmFuc2xhdGVZID0gdHJhbnNsYXRlLnk7XG4gICAgfVxuXG4gICAgLy8gQWJvcnQgY3VycmVudCBwb3NpdGlvbmluZy5cbiAgICBpZiAoaXRlbS5pc1Bvc2l0aW9uaW5nKCkpIHtcbiAgICAgIGl0ZW0uX2xheW91dC5zdG9wKHRydWUsIHsgdHJhbnNmb3JtOiBnZXRUcmFuc2xhdGVTdHJpbmcodHJhbnNsYXRlWCwgdHJhbnNsYXRlWSkgfSk7XG4gICAgfVxuXG4gICAgLy8gQWJvcnQgY3VycmVudCBtaWdyYXRpb24uXG4gICAgaWYgKHRoaXMuX2lzQWN0aXZlKSB7XG4gICAgICB0cmFuc2xhdGVYIC09IHRoaXMuX2NvbnRhaW5lckRpZmZYO1xuICAgICAgdHJhbnNsYXRlWSAtPSB0aGlzLl9jb250YWluZXJEaWZmWTtcbiAgICAgIHRoaXMuc3RvcCh0cnVlLCB7IHRyYW5zZm9ybTogZ2V0VHJhbnNsYXRlU3RyaW5nKHRyYW5zbGF0ZVgsIHRyYW5zbGF0ZVkpIH0pO1xuICAgIH1cblxuICAgIC8vIEFib3J0IGN1cnJlbnQgcmVsZWFzZS5cbiAgICBpZiAoaXRlbS5pc1JlbGVhc2luZygpKSB7XG4gICAgICB0cmFuc2xhdGVYIC09IGl0ZW0uX3JlbGVhc2UuX2NvbnRhaW5lckRpZmZYO1xuICAgICAgdHJhbnNsYXRlWSAtPSBpdGVtLl9yZWxlYXNlLl9jb250YWluZXJEaWZmWTtcbiAgICAgIGl0ZW0uX3JlbGVhc2Uuc3RvcCh0cnVlLCB7IHRyYW5zZm9ybTogZ2V0VHJhbnNsYXRlU3RyaW5nKHRyYW5zbGF0ZVgsIHRyYW5zbGF0ZVkpIH0pO1xuICAgIH1cblxuICAgIC8vIFN0b3AgY3VycmVudCB2aXNpYmlsaXR5IGFuaW1hdGlvbnMuXG4gICAgaXRlbS5fdmlzaWJpbGl0eS5fc3RvcEFuaW1hdGlvbigpO1xuXG4gICAgLy8gRGVzdHJveSBjdXJyZW50IGRyYWcuXG4gICAgaWYgKGl0ZW0uX2RyYWcpIGl0ZW0uX2RyYWcuZGVzdHJveSgpO1xuXG4gICAgLy8gUHJvY2VzcyBjdXJyZW50IHZpc2liaWxpdHkgYW5pbWF0aW9uIHF1ZXVlLlxuICAgIGl0ZW0uX3Zpc2liaWxpdHkuX3F1ZXVlLmZsdXNoKHRydWUsIGl0ZW0pO1xuXG4gICAgLy8gRW1pdCBiZWZvcmVTZW5kIGV2ZW50LlxuICAgIGlmIChncmlkLl9oYXNMaXN0ZW5lcnMoZXZlbnRCZWZvcmVTZW5kKSkge1xuICAgICAgZ3JpZC5fZW1pdChldmVudEJlZm9yZVNlbmQsIHtcbiAgICAgICAgaXRlbTogaXRlbSxcbiAgICAgICAgZnJvbUdyaWQ6IGdyaWQsXG4gICAgICAgIGZyb21JbmRleDogY3VycmVudEluZGV4LFxuICAgICAgICB0b0dyaWQ6IHRhcmdldEdyaWQsXG4gICAgICAgIHRvSW5kZXg6IHRhcmdldEluZGV4XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFbWl0IGJlZm9yZVJlY2VpdmUgZXZlbnQuXG4gICAgaWYgKHRhcmdldEdyaWQuX2hhc0xpc3RlbmVycyhldmVudEJlZm9yZVJlY2VpdmUpKSB7XG4gICAgICB0YXJnZXRHcmlkLl9lbWl0KGV2ZW50QmVmb3JlUmVjZWl2ZSwge1xuICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICBmcm9tR3JpZDogZ3JpZCxcbiAgICAgICAgZnJvbUluZGV4OiBjdXJyZW50SW5kZXgsXG4gICAgICAgIHRvR3JpZDogdGFyZ2V0R3JpZCxcbiAgICAgICAgdG9JbmRleDogdGFyZ2V0SW5kZXhcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBjdXJyZW50IGNsYXNzbmFtZXMuXG4gICAgcmVtb3ZlQ2xhc3MoZWxlbWVudCwgc2V0dGluZ3MuaXRlbUNsYXNzKTtcbiAgICByZW1vdmVDbGFzcyhlbGVtZW50LCBzZXR0aW5ncy5pdGVtVmlzaWJsZUNsYXNzKTtcbiAgICByZW1vdmVDbGFzcyhlbGVtZW50LCBzZXR0aW5ncy5pdGVtSGlkZGVuQ2xhc3MpO1xuXG4gICAgLy8gQWRkIG5ldyBjbGFzc25hbWVzLlxuICAgIGFkZENsYXNzKGVsZW1lbnQsIHRhcmdldFNldHRpbmdzLml0ZW1DbGFzcyk7XG4gICAgYWRkQ2xhc3MoZWxlbWVudCwgaXNWaXNpYmxlID8gdGFyZ2V0U2V0dGluZ3MuaXRlbVZpc2libGVDbGFzcyA6IHRhcmdldFNldHRpbmdzLml0ZW1IaWRkZW5DbGFzcyk7XG5cbiAgICAvLyBNb3ZlIGl0ZW0gaW5zdGFuY2UgZnJvbSBjdXJyZW50IGdyaWQgdG8gdGFyZ2V0IGdyaWQuXG4gICAgZ3JpZC5faXRlbXMuc3BsaWNlKGN1cnJlbnRJbmRleCwgMSk7XG4gICAgYXJyYXlJbnNlcnQodGFyZ2V0SXRlbXMsIGl0ZW0sIHRhcmdldEluZGV4KTtcblxuICAgIC8vIFVwZGF0ZSBpdGVtJ3MgZ3JpZCBpZCByZWZlcmVuY2UuXG4gICAgaXRlbS5fZ3JpZElkID0gdGFyZ2V0R3JpZC5faWQ7XG5cbiAgICAvLyBHZXQgY3VycmVudCBjb250YWluZXIuXG4gICAgY3VycmVudENvbnRhaW5lciA9IGVsZW1lbnQucGFyZW50Tm9kZTtcblxuICAgIC8vIE1vdmUgdGhlIGl0ZW0gaW5zaWRlIHRoZSB0YXJnZXQgY29udGFpbmVyIGlmIGl0J3MgZGlmZmVyZW50IHRoYW4gdGhlXG4gICAgLy8gY3VycmVudCBjb250YWluZXIuXG4gICAgaWYgKHRhcmdldENvbnRhaW5lciAhPT0gY3VycmVudENvbnRhaW5lcikge1xuICAgICAgdGFyZ2V0Q29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgb2Zmc2V0RGlmZiA9IGdldE9mZnNldERpZmYodGFyZ2V0Q29udGFpbmVyLCBjdXJyZW50Q29udGFpbmVyLCB0cnVlKTtcbiAgICAgIGlmICghdHJhbnNsYXRlKSB7XG4gICAgICAgIHRyYW5zbGF0ZSA9IGdldFRyYW5zbGF0ZShlbGVtZW50KTtcbiAgICAgICAgdHJhbnNsYXRlWCA9IHRyYW5zbGF0ZS54O1xuICAgICAgICB0cmFuc2xhdGVZID0gdHJhbnNsYXRlLnk7XG4gICAgICB9XG4gICAgICBlbGVtZW50LnN0eWxlW3RyYW5zZm9ybVByb3BdID0gZ2V0VHJhbnNsYXRlU3RyaW5nKFxuICAgICAgICB0cmFuc2xhdGVYICsgb2Zmc2V0RGlmZi5sZWZ0LFxuICAgICAgICB0cmFuc2xhdGVZICsgb2Zmc2V0RGlmZi50b3BcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGNoaWxkIGVsZW1lbnQncyBzdHlsZXMgdG8gcmVmbGVjdCB0aGUgY3VycmVudCB2aXNpYmlsaXR5IHN0YXRlLlxuICAgIGl0ZW0uX2NoaWxkLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICBzZXRTdHlsZXMoaXRlbS5fY2hpbGQsIGlzVmlzaWJsZSA/IHRhcmdldFNldHRpbmdzLnZpc2libGVTdHlsZXMgOiB0YXJnZXRTZXR0aW5ncy5oaWRkZW5TdHlsZXMpO1xuXG4gICAgLy8gVXBkYXRlIGRpc3BsYXkgc3R5bGUuXG4gICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gaXNWaXNpYmxlID8gJ2Jsb2NrJyA6ICdoaWRkZW4nO1xuXG4gICAgLy8gR2V0IG9mZnNldCBkaWZmIGZvciB0aGUgbWlncmF0aW9uIGRhdGEuXG4gICAgY29udGFpbmVyRGlmZiA9IGdldE9mZnNldERpZmYodGFyZ2V0Q29udGFpbmVyLCB0YXJnZXRFbGVtZW50LCB0cnVlKTtcblxuICAgIC8vIFVwZGF0ZSBpdGVtJ3MgY2FjaGVkIGRpbWVuc2lvbnMgYW5kIHNvcnQgZGF0YS5cbiAgICBpdGVtLl9yZWZyZXNoRGltZW5zaW9ucygpO1xuICAgIGl0ZW0uX3JlZnJlc2hTb3J0RGF0YSgpO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyBkcmFnIGhhbmRsZXIuXG4gICAgaXRlbS5fZHJhZyA9IHRhcmdldFNldHRpbmdzLmRyYWdFbmFibGVkID8gbmV3IEl0ZW1EcmFnKGl0ZW0pIDogbnVsbDtcblxuICAgIC8vIFNldHVwIG1pZ3JhdGlvbiBkYXRhLlxuICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLl9jb250YWluZXIgPSB0YXJnZXRDb250YWluZXI7XG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSBjb250YWluZXJEaWZmLmxlZnQ7XG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlkgPSBjb250YWluZXJEaWZmLnRvcDtcblxuICAgIC8vIEVtaXQgc2VuZCBldmVudC5cbiAgICBpZiAoZ3JpZC5faGFzTGlzdGVuZXJzKGV2ZW50U2VuZCkpIHtcbiAgICAgIGdyaWQuX2VtaXQoZXZlbnRTZW5kLCB7XG4gICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgIGZyb21HcmlkOiBncmlkLFxuICAgICAgICBmcm9tSW5kZXg6IGN1cnJlbnRJbmRleCxcbiAgICAgICAgdG9HcmlkOiB0YXJnZXRHcmlkLFxuICAgICAgICB0b0luZGV4OiB0YXJnZXRJbmRleFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRW1pdCByZWNlaXZlIGV2ZW50LlxuICAgIGlmICh0YXJnZXRHcmlkLl9oYXNMaXN0ZW5lcnMoZXZlbnRSZWNlaXZlKSkge1xuICAgICAgdGFyZ2V0R3JpZC5fZW1pdChldmVudFJlY2VpdmUsIHtcbiAgICAgICAgaXRlbTogaXRlbSxcbiAgICAgICAgZnJvbUdyaWQ6IGdyaWQsXG4gICAgICAgIGZyb21JbmRleDogY3VycmVudEluZGV4LFxuICAgICAgICB0b0dyaWQ6IHRhcmdldEdyaWQsXG4gICAgICAgIHRvSW5kZXg6IHRhcmdldEluZGV4XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogRW5kIHRoZSBtaWdyYXRlIHByb2Nlc3Mgb2YgYW4gaXRlbS4gVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gYWJvcnQgYW5cbiAgICogb25nb2luZyBtaWdyYXRlIHByb2Nlc3MgKGFuaW1hdGlvbikgb3IgZmluaXNoIHRoZSBtaWdyYXRlIHByb2Nlc3MuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1NaWdyYXRlLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFthYm9ydD1mYWxzZV1cbiAgICogIC0gU2hvdWxkIHRoZSBtaWdyYXRpb24gYmUgYWJvcnRlZD9cbiAgICogQHBhcmFtIHtPYmplY3R9IFtjdXJyZW50U3R5bGVzXVxuICAgKiAgLSBPcHRpb25hbCBjdXJyZW50IHRyYW5zbGF0ZVggYW5kIHRyYW5zbGF0ZVkgc3R5bGVzLlxuICAgKiBAcmV0dXJucyB7SXRlbU1pZ3JhdGV9XG4gICAqL1xuICBJdGVtTWlncmF0ZS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKGFib3J0LCBjdXJyZW50U3R5bGVzKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkIHx8ICF0aGlzLl9pc0FjdGl2ZSkgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gaXRlbS5nZXRHcmlkKCk7XG4gICAgdmFyIGdyaWRFbGVtZW50ID0gZ3JpZC5fZWxlbWVudDtcbiAgICB2YXIgdHJhbnNsYXRlO1xuXG4gICAgaWYgKHRoaXMuX2NvbnRhaW5lciAhPT0gZ3JpZEVsZW1lbnQpIHtcbiAgICAgIGlmICghY3VycmVudFN0eWxlcykge1xuICAgICAgICBpZiAoYWJvcnQpIHtcbiAgICAgICAgICB0cmFuc2xhdGUgPSBnZXRUcmFuc2xhdGUoZWxlbWVudCk7XG4gICAgICAgICAgdGVtcFN0eWxlcy50cmFuc2Zvcm0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoXG4gICAgICAgICAgICB0cmFuc2xhdGUueCAtIHRoaXMuX2NvbnRhaW5lckRpZmZYLFxuICAgICAgICAgICAgdHJhbnNsYXRlLnkgLSB0aGlzLl9jb250YWluZXJEaWZmWVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGVtcFN0eWxlcy50cmFuc2Zvcm0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoaXRlbS5fbGVmdCwgaXRlbS5fdG9wKTtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50U3R5bGVzID0gdGVtcFN0eWxlcztcbiAgICAgIH1cbiAgICAgIGdyaWRFbGVtZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgc2V0U3R5bGVzKGVsZW1lbnQsIGN1cnJlbnRTdHlsZXMpO1xuICAgIH1cblxuICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5fY29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLl9jb250YWluZXJEaWZmWCA9IDA7XG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlkgPSAwO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIERlc3Ryb3kgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1NaWdyYXRlLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7SXRlbU1pZ3JhdGV9XG4gICAqL1xuICBJdGVtTWlncmF0ZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG4gICAgdGhpcy5zdG9wKHRydWUpO1xuICAgIHRoaXMuX2l0ZW0gPSBudWxsO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICB2YXIgdGVtcFN0eWxlcyQxID0ge307XG5cbiAgLyoqXG4gICAqIFRoZSByZWxlYXNlIHByb2Nlc3MgaGFuZGxlciBjb25zdHJ1Y3Rvci4gQWx0aG91Z2ggdGhpcyBtaWdodCBzZWVtIGFzIHByb3BlclxuICAgKiBmaXQgZm9yIHRoZSBkcmFnIHByb2Nlc3MgdGhpcyBuZWVkcyB0byBiZSBzZXBhcmF0ZWQgaW50byBpdCdzIG93biBsb2dpY1xuICAgKiBiZWNhdXNlIHRoZXJlIG1pZ2h0IGJlIGEgc2NlbmFyaW8gd2hlcmUgZHJhZyBpcyBkaXNhYmxlZCwgYnV0IHRoZSByZWxlYXNlXG4gICAqIHByb2Nlc3Mgc3RpbGwgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgKGRyYWdnaW5nIGZyb20gYSBncmlkIHRvIGFub3RoZXIpLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqL1xuICBmdW5jdGlvbiBJdGVtUmVsZWFzZShpdGVtKSB7XG4gICAgdGhpcy5faXRlbSA9IGl0ZW07XG4gICAgdGhpcy5faXNBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuX2lzUG9zaXRpb25pbmdTdGFydGVkID0gZmFsc2U7XG4gICAgdGhpcy5fY29udGFpbmVyRGlmZlggPSAwO1xuICAgIHRoaXMuX2NvbnRhaW5lckRpZmZZID0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgcmVsZWFzZSBwcm9jZXNzIG9mIGFuIGl0ZW0uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1SZWxlYXNlLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7SXRlbVJlbGVhc2V9XG4gICAqL1xuICBJdGVtUmVsZWFzZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgdGhpcy5faXNBY3RpdmUpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuICAgIHZhciBncmlkID0gaXRlbS5nZXRHcmlkKCk7XG5cbiAgICAvLyBGbGFnIHJlbGVhc2UgYXMgYWN0aXZlLlxuICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZTtcblxuICAgIC8vIEFkZCByZWxlYXNlIGNsYXNzIG5hbWUgdG8gdGhlIHJlbGVhc2VkIGVsZW1lbnQuXG4gICAgYWRkQ2xhc3MoaXRlbS5fZWxlbWVudCwgZ3JpZC5fc2V0dGluZ3MuaXRlbVJlbGVhc2luZ0NsYXNzKTtcblxuICAgIC8vIEVtaXQgZHJhZ1JlbGVhc2VTdGFydCBldmVudC5cbiAgICBncmlkLl9lbWl0KGV2ZW50RHJhZ1JlbGVhc2VTdGFydCwgaXRlbSk7XG5cbiAgICAvLyBQb3NpdGlvbiB0aGUgcmVsZWFzZWQgaXRlbS5cbiAgICBpdGVtLl9sYXlvdXQuc3RhcnQoZmFsc2UpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEVuZCB0aGUgcmVsZWFzZSBwcm9jZXNzIG9mIGFuIGl0ZW0uIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIHRvIGFib3J0IGFuXG4gICAqIG9uZ29pbmcgcmVsZWFzZSBwcm9jZXNzIChhbmltYXRpb24pIG9yIGZpbmlzaCB0aGUgcmVsZWFzZSBwcm9jZXNzLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtUmVsZWFzZS5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtCb29sZWFufSBbYWJvcnQ9ZmFsc2VdXG4gICAqICAtIFNob3VsZCB0aGUgcmVsZWFzZSBiZSBhYm9ydGVkPyBXaGVuIHRydWUsIHRoZSByZWxlYXNlIGVuZCBldmVudCB3b24ndCBiZVxuICAgKiAgICBlbWl0dGVkLiBTZXQgdG8gdHJ1ZSBvbmx5IHdoZW4geW91IG5lZWQgdG8gYWJvcnQgdGhlIHJlbGVhc2UgcHJvY2Vzc1xuICAgKiAgICB3aGlsZSB0aGUgaXRlbSBpcyBhbmltYXRpbmcgdG8gaXQncyBwb3NpdGlvbi5cbiAgICogQHBhcmFtIHtPYmplY3R9IFtjdXJyZW50U3R5bGVzXVxuICAgKiAgLSBPcHRpb25hbCBjdXJyZW50IHRyYW5zbGF0ZVggYW5kIHRyYW5zbGF0ZVkgc3R5bGVzLlxuICAgKiBAcmV0dXJucyB7SXRlbVJlbGVhc2V9XG4gICAqL1xuICBJdGVtUmVsZWFzZS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKGFib3J0LCBjdXJyZW50U3R5bGVzKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkIHx8ICF0aGlzLl9pc0FjdGl2ZSkgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBncmlkID0gaXRlbS5nZXRHcmlkKCk7XG4gICAgdmFyIGNvbnRhaW5lciA9IGdyaWQuX2VsZW1lbnQ7XG4gICAgdmFyIHRyYW5zbGF0ZTtcblxuICAgIC8vIFJlc2V0IGRhdGEgYW5kIHJlbW92ZSByZWxlYXNpbmcgY2xhc3MgbmFtZSBmcm9tIHRoZSBlbGVtZW50LlxuICAgIHRoaXMuX3Jlc2V0KCk7XG5cbiAgICAvLyBJZiB0aGUgcmVsZWFzZWQgZWxlbWVudCBpcyBvdXRzaWRlIHRoZSBncmlkJ3MgY29udGFpbmVyIGVsZW1lbnQgcHV0IGl0XG4gICAgLy8gYmFjayB0aGVyZSBhbmQgYWRqdXN0IHBvc2l0aW9uIGFjY29yZGluZ2x5LlxuICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUgIT09IGNvbnRhaW5lcikge1xuICAgICAgaWYgKCFjdXJyZW50U3R5bGVzKSB7XG4gICAgICAgIGlmIChhYm9ydCkge1xuICAgICAgICAgIHRyYW5zbGF0ZSA9IGdldFRyYW5zbGF0ZShlbGVtZW50KTtcbiAgICAgICAgICB0ZW1wU3R5bGVzJDEudHJhbnNmb3JtID0gZ2V0VHJhbnNsYXRlU3RyaW5nKFxuICAgICAgICAgICAgdHJhbnNsYXRlLnggLSB0aGlzLl9jb250YWluZXJEaWZmWCxcbiAgICAgICAgICAgIHRyYW5zbGF0ZS55IC0gdGhpcy5fY29udGFpbmVyRGlmZllcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRlbXBTdHlsZXMkMS50cmFuc2Zvcm0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoaXRlbS5fbGVmdCwgaXRlbS5fdG9wKTtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50U3R5bGVzID0gdGVtcFN0eWxlcyQxO1xuICAgICAgfVxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgc2V0U3R5bGVzKGVsZW1lbnQsIGN1cnJlbnRTdHlsZXMpO1xuICAgIH1cblxuICAgIC8vIEVtaXQgZHJhZ1JlbGVhc2VFbmQgZXZlbnQuXG4gICAgaWYgKCFhYm9ydCkgZ3JpZC5fZW1pdChldmVudERyYWdSZWxlYXNlRW5kLCBpdGVtKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IGluc3RhbmNlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtUmVsZWFzZS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0l0ZW1SZWxlYXNlfVxuICAgKi9cbiAgSXRlbVJlbGVhc2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuICAgIHRoaXMuc3RvcCh0cnVlKTtcbiAgICB0aGlzLl9pdGVtID0gbnVsbDtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IHRydWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogUmVzZXQgcHVibGljIGRhdGEgYW5kIHJlbW92ZSByZWxlYXNpbmcgY2xhc3MuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtUmVsZWFzZS5wcm90b3R5cGVcbiAgICovXG4gIEl0ZW1SZWxlYXNlLnByb3RvdHlwZS5fcmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgdGhpcy5faXNBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLl9pc1Bvc2l0aW9uaW5nU3RhcnRlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2NvbnRhaW5lckRpZmZYID0gMDtcbiAgICB0aGlzLl9jb250YWluZXJEaWZmWSA9IDA7XG4gICAgcmVtb3ZlQ2xhc3MoaXRlbS5fZWxlbWVudCwgaXRlbS5nZXRHcmlkKCkuX3NldHRpbmdzLml0ZW1SZWxlYXNpbmdDbGFzcyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHZhbHVlcyBvZiB0aGUgcHJvdmlkZWQgc3R5bGVzIGRlZmluaXRpb24gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzdHlsZXNcbiAgICogQHJldHVybiB7T2JqZWN0fVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0Q3VycmVudFN0eWxlcyhlbGVtZW50LCBzdHlsZXMpIHtcbiAgICB2YXIgY3VycmVudCA9IHt9O1xuICAgIGZvciAodmFyIHByb3AgaW4gc3R5bGVzKSB7XG4gICAgICBjdXJyZW50W3Byb3BdID0gZ2V0U3R5bGUoZWxlbWVudCwgZ2V0U3R5bGVOYW1lKHByb3ApKTtcbiAgICB9XG4gICAgcmV0dXJuIGN1cnJlbnQ7XG4gIH1cblxuICAvKipcbiAgICogVmlzaWJpbGl0eSBtYW5hZ2VyIGZvciBJdGVtIGluc3RhbmNlLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqL1xuICBmdW5jdGlvbiBJdGVtVmlzaWJpbGl0eShpdGVtKSB7XG4gICAgdmFyIGlzQWN0aXZlID0gaXRlbS5faXNBY3RpdmU7XG4gICAgdmFyIGVsZW1lbnQgPSBpdGVtLl9lbGVtZW50O1xuICAgIHZhciBzZXR0aW5ncyA9IGl0ZW0uZ2V0R3JpZCgpLl9zZXR0aW5ncztcblxuICAgIHRoaXMuX2l0ZW0gPSBpdGVtO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gZmFsc2U7XG5cbiAgICAvLyBTZXQgdXAgdmlzaWJpbGl0eSBzdGF0ZXMuXG4gICAgdGhpcy5faXNIaWRkZW4gPSAhaXNBY3RpdmU7XG4gICAgdGhpcy5faXNIaWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLl9pc1Nob3dpbmcgPSBmYWxzZTtcblxuICAgIC8vIENhbGxiYWNrIHF1ZXVlLlxuICAgIHRoaXMuX3F1ZXVlID0gbmV3IFF1ZXVlKCk7XG5cbiAgICAvLyBCaW5kIHNob3cvaGlkZSBmaW5pc2hlcnMuXG4gICAgdGhpcy5fZmluaXNoU2hvdyA9IHRoaXMuX2ZpbmlzaFNob3cuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9maW5pc2hIaWRlID0gdGhpcy5fZmluaXNoSGlkZS5iaW5kKHRoaXMpO1xuXG4gICAgLy8gRm9yY2UgaXRlbSB0byBiZSBlaXRoZXIgdmlzaWJsZSBvciBoaWRkZW4gb24gaW5pdC5cbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBpc0FjdGl2ZSA/ICdibG9jaycgOiAnbm9uZSc7XG5cbiAgICAvLyBTZXQgdmlzaWJsZS9oaWRkZW4gY2xhc3MuXG4gICAgYWRkQ2xhc3MoZWxlbWVudCwgaXNBY3RpdmUgPyBzZXR0aW5ncy5pdGVtVmlzaWJsZUNsYXNzIDogc2V0dGluZ3MuaXRlbUhpZGRlbkNsYXNzKTtcblxuICAgIC8vIFNldCBpbml0aWFsIHN0eWxlcyBmb3IgdGhlIGNoaWxkIGVsZW1lbnQuXG4gICAgc2V0U3R5bGVzKGl0ZW0uX2NoaWxkLCBpc0FjdGl2ZSA/IHNldHRpbmdzLnZpc2libGVTdHlsZXMgOiBzZXR0aW5ncy5oaWRkZW5TdHlsZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIFNob3cgaXRlbS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbVZpc2liaWxpdHkucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5zdGFudFxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25GaW5pc2hdXG4gICAqIEByZXR1cm5zIHtJdGVtVmlzaWJpbGl0eX1cbiAgICovXG4gIEl0ZW1WaXNpYmlsaXR5LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oaW5zdGFudCwgb25GaW5pc2gpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuICAgIHZhciBlbGVtZW50ID0gaXRlbS5fZWxlbWVudDtcbiAgICB2YXIgcXVldWUgPSB0aGlzLl9xdWV1ZTtcbiAgICB2YXIgY2FsbGJhY2sgPSBpc0Z1bmN0aW9uKG9uRmluaXNoKSA/IG9uRmluaXNoIDogbnVsbDtcbiAgICB2YXIgZ3JpZCA9IGl0ZW0uZ2V0R3JpZCgpO1xuICAgIHZhciBzZXR0aW5ncyA9IGdyaWQuX3NldHRpbmdzO1xuXG4gICAgLy8gSWYgaXRlbSBpcyB2aXNpYmxlIGNhbGwgdGhlIGNhbGxiYWNrIGFuZCBiZSBkb25lIHdpdGggaXQuXG4gICAgaWYgKCF0aGlzLl9pc1Nob3dpbmcgJiYgIXRoaXMuX2lzSGlkZGVuKSB7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhmYWxzZSwgaXRlbSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBJZiBpdGVtIGlzIHNob3dpbmcgYW5kIGRvZXMgbm90IG5lZWQgdG8gYmUgc2hvd24gaW5zdGFudGx5LCBsZXQncyBqdXN0XG4gICAgLy8gcHVzaCBjYWxsYmFjayB0byB0aGUgY2FsbGJhY2sgcXVldWUgYW5kIGJlIGRvbmUgd2l0aCBpdC5cbiAgICBpZiAodGhpcy5faXNTaG93aW5nICYmICFpbnN0YW50KSB7XG4gICAgICBjYWxsYmFjayAmJiBxdWV1ZS5hZGQoY2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGl0ZW0gaXMgaGlkaW5nIG9yIGhpZGRlbiBwcm9jZXNzIHRoZSBjdXJyZW50IHZpc2liaWxpdHkgY2FsbGJhY2tcbiAgICAvLyBxdWV1ZSB3aXRoIHRoZSBpbnRlcnJ1cHRlZCBmbGFnIGFjdGl2ZSwgdXBkYXRlIGNsYXNzZXMgYW5kIHNldCBkaXNwbGF5XG4gICAgLy8gdG8gYmxvY2sgaWYgbmVjZXNzYXJ5LlxuICAgIGlmICghdGhpcy5faXNTaG93aW5nKSB7XG4gICAgICBxdWV1ZS5mbHVzaCh0cnVlLCBpdGVtKTtcbiAgICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1IaWRkZW5DbGFzcyk7XG4gICAgICBhZGRDbGFzcyhlbGVtZW50LCBzZXR0aW5ncy5pdGVtVmlzaWJsZUNsYXNzKTtcbiAgICAgIGlmICghdGhpcy5faXNIaWRpbmcpIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgfVxuXG4gICAgLy8gUHVzaCBjYWxsYmFjayB0byB0aGUgY2FsbGJhY2sgcXVldWUuXG4gICAgY2FsbGJhY2sgJiYgcXVldWUuYWRkKGNhbGxiYWNrKTtcblxuICAgIC8vIFVwZGF0ZSB2aXNpYmlsaXR5IHN0YXRlcy5cbiAgICBpdGVtLl9pc0FjdGl2ZSA9IHRoaXMuX2lzU2hvd2luZyA9IHRydWU7XG4gICAgdGhpcy5faXNIaWRpbmcgPSB0aGlzLl9pc0hpZGRlbiA9IGZhbHNlO1xuXG4gICAgLy8gRmluYWxseSBsZXQncyBzdGFydCBzaG93IGFuaW1hdGlvbi5cbiAgICB0aGlzLl9zdGFydEFuaW1hdGlvbih0cnVlLCBpbnN0YW50LCB0aGlzLl9maW5pc2hTaG93KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIaWRlIGl0ZW0uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW1WaXNpYmlsaXR5LnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IGluc3RhbnRcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uRmluaXNoXVxuICAgKiBAcmV0dXJucyB7SXRlbVZpc2liaWxpdHl9XG4gICAqL1xuICBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKGluc3RhbnQsIG9uRmluaXNoKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgZWxlbWVudCA9IGl0ZW0uX2VsZW1lbnQ7XG4gICAgdmFyIHF1ZXVlID0gdGhpcy5fcXVldWU7XG4gICAgdmFyIGNhbGxiYWNrID0gaXNGdW5jdGlvbihvbkZpbmlzaCkgPyBvbkZpbmlzaCA6IG51bGw7XG4gICAgdmFyIGdyaWQgPSBpdGVtLmdldEdyaWQoKTtcbiAgICB2YXIgc2V0dGluZ3MgPSBncmlkLl9zZXR0aW5ncztcblxuICAgIC8vIElmIGl0ZW0gaXMgYWxyZWFkeSBoaWRkZW4gY2FsbCB0aGUgY2FsbGJhY2sgYW5kIGJlIGRvbmUgd2l0aCBpdC5cbiAgICBpZiAoIXRoaXMuX2lzSGlkaW5nICYmIHRoaXMuX2lzSGlkZGVuKSB7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhmYWxzZSwgaXRlbSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBJZiBpdGVtIGlzIGhpZGluZyBhbmQgZG9lcyBub3QgbmVlZCB0byBiZSBoaWRkZW4gaW5zdGFudGx5LCBsZXQncyBqdXN0XG4gICAgLy8gcHVzaCBjYWxsYmFjayB0byB0aGUgY2FsbGJhY2sgcXVldWUgYW5kIGJlIGRvbmUgd2l0aCBpdC5cbiAgICBpZiAodGhpcy5faXNIaWRpbmcgJiYgIWluc3RhbnQpIHtcbiAgICAgIGNhbGxiYWNrICYmIHF1ZXVlLmFkZChjYWxsYmFjayk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgaXRlbSBpcyBzaG93aW5nIG9yIHZpc2libGUgcHJvY2VzcyB0aGUgY3VycmVudCB2aXNpYmlsaXR5IGNhbGxiYWNrXG4gICAgLy8gcXVldWUgd2l0aCB0aGUgaW50ZXJydXB0ZWQgZmxhZyBhY3RpdmUsIHVwZGF0ZSBjbGFzc2VzIGFuZCBzZXQgZGlzcGxheVxuICAgIC8vIHRvIGJsb2NrIGlmIG5lY2Vzc2FyeS5cbiAgICBpZiAoIXRoaXMuX2lzSGlkaW5nKSB7XG4gICAgICBxdWV1ZS5mbHVzaCh0cnVlLCBpdGVtKTtcbiAgICAgIGFkZENsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1IaWRkZW5DbGFzcyk7XG4gICAgICByZW1vdmVDbGFzcyhlbGVtZW50LCBzZXR0aW5ncy5pdGVtVmlzaWJsZUNsYXNzKTtcbiAgICB9XG5cbiAgICAvLyBQdXNoIGNhbGxiYWNrIHRvIHRoZSBjYWxsYmFjayBxdWV1ZS5cbiAgICBjYWxsYmFjayAmJiBxdWV1ZS5hZGQoY2FsbGJhY2spO1xuXG4gICAgLy8gVXBkYXRlIHZpc2liaWxpdHkgc3RhdGVzLlxuICAgIHRoaXMuX2lzSGlkZGVuID0gdGhpcy5faXNIaWRpbmcgPSB0cnVlO1xuICAgIGl0ZW0uX2lzQWN0aXZlID0gdGhpcy5faXNTaG93aW5nID0gZmFsc2U7XG5cbiAgICAvLyBGaW5hbGx5IGxldCdzIHN0YXJ0IGhpZGUgYW5pbWF0aW9uLlxuICAgIHRoaXMuX3N0YXJ0QW5pbWF0aW9uKGZhbHNlLCBpbnN0YW50LCB0aGlzLl9maW5pc2hIaWRlKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBpbnN0YW5jZSBhbmQgc3RvcCBjdXJyZW50IGFuaW1hdGlvbiBpZiBpdCBpcyBydW5uaW5nLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0l0ZW1WaXNpYmlsaXR5fVxuICAgKi9cbiAgSXRlbVZpc2liaWxpdHkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIGl0ZW0gPSB0aGlzLl9pdGVtO1xuICAgIHZhciBlbGVtZW50ID0gaXRlbS5fZWxlbWVudDtcbiAgICB2YXIgZ3JpZCA9IGl0ZW0uZ2V0R3JpZCgpO1xuICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHZhciBzZXR0aW5ncyA9IGdyaWQuX3NldHRpbmdzO1xuXG4gICAgLy8gU3RvcCB2aXNpYmlsaXR5IGFuaW1hdGlvbi5cbiAgICB0aGlzLl9zdG9wQW5pbWF0aW9uKHt9KTtcblxuICAgIC8vIEZpcmUgYWxsIHVuY29tcGxldGVkIGNhbGxiYWNrcyB3aXRoIGludGVycnVwdGVkIGZsYWcgYW5kIGRlc3Ryb3kgdGhlIHF1ZXVlLlxuICAgIHF1ZXVlLmZsdXNoKHRydWUsIGl0ZW0pLmRlc3Ryb3koKTtcblxuICAgIC8vIFJlbW92ZSB2aXNpYmxlL2hpZGRlbiBjbGFzc2VzLlxuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1WaXNpYmxlQ2xhc3MpO1xuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1IaWRkZW5DbGFzcyk7XG5cbiAgICAvLyBSZXNldCBzdGF0ZS5cbiAgICB0aGlzLl9pdGVtID0gbnVsbDtcbiAgICB0aGlzLl9pc0hpZGluZyA9IHRoaXMuX2lzU2hvd2luZyA9IGZhbHNlO1xuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdGhpcy5faXNIaWRkZW4gPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogU3RhcnQgdmlzaWJpbGl0eSBhbmltYXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtCb29sZWFufSB0b1Zpc2libGVcbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW5zdGFudF1cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uRmluaXNoXVxuICAgKi9cbiAgSXRlbVZpc2liaWxpdHkucHJvdG90eXBlLl9zdGFydEFuaW1hdGlvbiA9IGZ1bmN0aW9uKHRvVmlzaWJsZSwgaW5zdGFudCwgb25GaW5pc2gpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcblxuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB2YXIgc2V0dGluZ3MgPSBpdGVtLmdldEdyaWQoKS5fc2V0dGluZ3M7XG4gICAgdmFyIHRhcmdldFN0eWxlcyA9IHRvVmlzaWJsZSA/IHNldHRpbmdzLnZpc2libGVTdHlsZXMgOiBzZXR0aW5ncy5oaWRkZW5TdHlsZXM7XG4gICAgdmFyIGR1cmF0aW9uID0gcGFyc2VJbnQodG9WaXNpYmxlID8gc2V0dGluZ3Muc2hvd0R1cmF0aW9uIDogc2V0dGluZ3MuaGlkZUR1cmF0aW9uKSB8fCAwO1xuICAgIHZhciBlYXNpbmcgPSAodG9WaXNpYmxlID8gc2V0dGluZ3Muc2hvd0Vhc2luZyA6IHNldHRpbmdzLmhpZGVFYXNpbmcpIHx8ICdlYXNlJztcbiAgICB2YXIgaXNJbnN0YW50ID0gaW5zdGFudCB8fCBkdXJhdGlvbiA8PSAwO1xuICAgIHZhciBjdXJyZW50U3R5bGVzO1xuXG4gICAgLy8gTm8gdGFyZ2V0IHN0eWxlcz8gTGV0J3MgcXVpdCBlYXJseS5cbiAgICBpZiAoIXRhcmdldFN0eWxlcykge1xuICAgICAgb25GaW5pc2ggJiYgb25GaW5pc2goKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDYW5jZWwgcXVldWVkIHZpc2liaWxpdHkgdGljay5cbiAgICBjYW5jZWxWaXNpYmlsaXR5VGljayhpdGVtLl9pZCk7XG5cbiAgICAvLyBJZiB3ZSBuZWVkIHRvIGFwcGx5IHRoZSBzdHlsZXMgaW5zdGFudGx5IHdpdGhvdXQgYW5pbWF0aW9uLlxuICAgIGlmIChpc0luc3RhbnQpIHtcbiAgICAgIGlmIChpdGVtLl9hbmltYXRlQ2hpbGQuaXNBbmltYXRpbmcoKSkge1xuICAgICAgICBpdGVtLl9hbmltYXRlQ2hpbGQuc3RvcCh0YXJnZXRTdHlsZXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0U3R5bGVzKGl0ZW0uX2NoaWxkLCB0YXJnZXRTdHlsZXMpO1xuICAgICAgfVxuICAgICAgb25GaW5pc2ggJiYgb25GaW5pc2goKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTdGFydCB0aGUgYW5pbWF0aW9uIGluIHRoZSBuZXh0IHRpY2sgKHRvIGF2b2lkIGxheW91dCB0aHJhc2hpbmcpLlxuICAgIGFkZFZpc2liaWxpdHlUaWNrKFxuICAgICAgaXRlbS5faWQsXG4gICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgY3VycmVudFN0eWxlcyA9IGdldEN1cnJlbnRTdHlsZXMoaXRlbS5fY2hpbGQsIHRhcmdldFN0eWxlcyk7XG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIGl0ZW0uX2FuaW1hdGVDaGlsZC5zdGFydChjdXJyZW50U3R5bGVzLCB0YXJnZXRTdHlsZXMsIHtcbiAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sXG4gICAgICAgICAgZWFzaW5nOiBlYXNpbmcsXG4gICAgICAgICAgb25GaW5pc2g6IG9uRmluaXNoXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFN0b3AgdmlzaWJpbGl0eSBhbmltYXRpb24uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtPYmplY3R9IFt0YXJnZXRTdHlsZXNdXG4gICAqL1xuICBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGUuX3N0b3BBbmltYXRpb24gPSBmdW5jdGlvbih0YXJnZXRTdHlsZXMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX2l0ZW07XG4gICAgY2FuY2VsVmlzaWJpbGl0eVRpY2soaXRlbS5faWQpO1xuICAgIGl0ZW0uX2FuaW1hdGVDaGlsZC5zdG9wKHRhcmdldFN0eWxlcyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEZpbmlzaCBzaG93IHByb2NlZHVyZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW1WaXNpYmlsaXR5LnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbVZpc2liaWxpdHkucHJvdG90eXBlLl9maW5pc2hTaG93ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzSGlkZGVuKSByZXR1cm47XG4gICAgdGhpcy5faXNTaG93aW5nID0gZmFsc2U7XG4gICAgdGhpcy5fcXVldWUuZmx1c2goZmFsc2UsIHRoaXMuX2l0ZW0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBGaW5pc2ggaGlkZSBwcm9jZWR1cmUuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtVmlzaWJpbGl0eS5wcm90b3R5cGVcbiAgICovXG4gIHZhciBmaW5pc2hTdHlsZXMgPSB7fTtcbiAgSXRlbVZpc2liaWxpdHkucHJvdG90eXBlLl9maW5pc2hIaWRlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLl9pc0hpZGRlbikgcmV0dXJuO1xuICAgIHZhciBpdGVtID0gdGhpcy5faXRlbTtcbiAgICB0aGlzLl9pc0hpZGluZyA9IGZhbHNlO1xuICAgIGZpbmlzaFN0eWxlcy50cmFuc2Zvcm0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoMCwgMCk7XG4gICAgaXRlbS5fbGF5b3V0LnN0b3AodHJ1ZSwgZmluaXNoU3R5bGVzKTtcbiAgICBpdGVtLl9lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgdGhpcy5fcXVldWUuZmx1c2goZmFsc2UsIGl0ZW0pO1xuICB9O1xuXG4gIHZhciBpZCA9IDA7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSB1bmlxdWUgbnVtZXJpYyBpZCAoaW5jcmVtZW50cyBhIGJhc2UgdmFsdWUgb24gZXZlcnkgY2FsbCkuXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBmdW5jdGlvbiBjcmVhdGVVaWQoKSB7XG4gICAgcmV0dXJuICsraWQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBJdGVtIGluc3RhbmNlIGZvciBhIEdyaWQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBjbGFzc1xuICAgKiBAcGFyYW0ge0dyaWR9IGdyaWRcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc0FjdGl2ZV1cbiAgICovXG4gIGZ1bmN0aW9uIEl0ZW0oZ3JpZCwgZWxlbWVudCwgaXNBY3RpdmUpIHtcbiAgICB2YXIgc2V0dGluZ3MgPSBncmlkLl9zZXR0aW5ncztcblxuICAgIC8vIENyZWF0ZSBpbnN0YW5jZSBpZC5cbiAgICB0aGlzLl9pZCA9IGNyZWF0ZVVpZCgpO1xuXG4gICAgLy8gUmVmZXJlbmNlIHRvIGNvbm5lY3RlZCBHcmlkIGluc3RhbmNlJ3MgaWQuXG4gICAgdGhpcy5fZ3JpZElkID0gZ3JpZC5faWQ7XG5cbiAgICAvLyBEZXN0cm95ZWQgZmxhZy5cbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IGZhbHNlO1xuXG4gICAgLy8gU2V0IHVwIGluaXRpYWwgcG9zaXRpb25zLlxuICAgIHRoaXMuX2xlZnQgPSAwO1xuICAgIHRoaXMuX3RvcCA9IDA7XG5cbiAgICAvLyBUaGUgZWxlbWVudHMuXG4gICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5fY2hpbGQgPSBlbGVtZW50LmNoaWxkcmVuWzBdO1xuXG4gICAgLy8gSWYgdGhlIHByb3ZpZGVkIGl0ZW0gZWxlbWVudCBpcyBub3QgYSBkaXJlY3QgY2hpbGQgb2YgdGhlIGdyaWQgY29udGFpbmVyXG4gICAgLy8gZWxlbWVudCwgYXBwZW5kIGl0IHRvIHRoZSBncmlkIGNvbnRhaW5lci5cbiAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlICE9PSBncmlkLl9lbGVtZW50KSB7XG4gICAgICBncmlkLl9lbGVtZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8vIFNldCBpdGVtIGNsYXNzLlxuICAgIGFkZENsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1DbGFzcyk7XG5cbiAgICAvLyBJZiBpc0FjdGl2ZSBpcyBub3QgZGVmaW5lZCwgbGV0J3MgdHJ5IHRvIGF1dG8tZGV0ZWN0IGl0LlxuICAgIGlmICh0eXBlb2YgaXNBY3RpdmUgIT09ICdib29sZWFuJykge1xuICAgICAgaXNBY3RpdmUgPSBnZXRTdHlsZShlbGVtZW50LCAnZGlzcGxheScpICE9PSAnbm9uZSc7XG4gICAgfVxuXG4gICAgLy8gU2V0IHVwIGFjdGl2ZSBzdGF0ZSAoZGVmaW5lcyBpZiB0aGUgaXRlbSBpcyBjb25zaWRlcmVkIHBhcnQgb2YgdGhlIGxheW91dFxuICAgIC8vIG9yIG5vdCkuXG4gICAgdGhpcy5faXNBY3RpdmUgPSBpc0FjdGl2ZTtcblxuICAgIC8vIFNldCBlbGVtZW50J3MgaW5pdGlhbCBwb3NpdGlvbiBzdHlsZXMuXG4gICAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gJzAnO1xuICAgIGVsZW1lbnQuc3R5bGUudG9wID0gJzAnO1xuICAgIGVsZW1lbnQuc3R5bGVbdHJhbnNmb3JtUHJvcF0gPSBnZXRUcmFuc2xhdGVTdHJpbmcoMCwgMCk7XG5cbiAgICAvLyBJbml0aWF0ZSBpdGVtJ3MgYW5pbWF0aW9uIGNvbnRyb2xsZXJzLlxuICAgIHRoaXMuX2FuaW1hdGUgPSBuZXcgSXRlbUFuaW1hdGUoZWxlbWVudCk7XG4gICAgdGhpcy5fYW5pbWF0ZUNoaWxkID0gbmV3IEl0ZW1BbmltYXRlKHRoaXMuX2NoaWxkKTtcblxuICAgIC8vIFNldHVwIHZpc2liaWxpdHkgaGFuZGxlci5cbiAgICB0aGlzLl92aXNpYmlsaXR5ID0gbmV3IEl0ZW1WaXNpYmlsaXR5KHRoaXMpO1xuXG4gICAgLy8gU2V0IHVwIGxheW91dCBoYW5kbGVyLlxuICAgIHRoaXMuX2xheW91dCA9IG5ldyBJdGVtTGF5b3V0KHRoaXMpO1xuXG4gICAgLy8gU2V0IHVwIG1pZ3JhdGlvbiBoYW5kbGVyIGRhdGEuXG4gICAgdGhpcy5fbWlncmF0ZSA9IG5ldyBJdGVtTWlncmF0ZSh0aGlzKTtcblxuICAgIC8vIFNldCB1cCByZWxlYXNlIGhhbmRsZXIuIE5vdGUgdGhhdCBhbHRob3VnaCB0aGlzIGlzIGZ1bGx5IGxpbmtlZCB0byBkcmFnZ2luZ1xuICAgIC8vIHRoaXMgc3RpbGwgbmVlZHMgdG8gYmUgYWx3YXlzIGluc3RhbnRpYXRlZCB0byBoYW5kbGUgbWlncmF0aW9uIHNjZW5hcmlvc1xuICAgIC8vIGNvcnJlY3RseS5cbiAgICB0aGlzLl9yZWxlYXNlID0gbmV3IEl0ZW1SZWxlYXNlKHRoaXMpO1xuXG4gICAgLy8gU2V0IHVwIGRyYWcgcGxhY2Vob2xkZXIgaGFuZGxlci4gTm90ZSB0aGF0IGFsdGhvdWdoIHRoaXMgaXMgZnVsbHkgbGlua2VkIHRvXG4gICAgLy8gZHJhZ2dpbmcgdGhpcyBzdGlsbCBuZWVkcyB0byBiZSBhbHdheXMgaW5zdGFudGlhdGVkIHRvIGhhbmRsZSBtaWdyYXRpb25cbiAgICAvLyBzY2VuYXJpb3MgY29ycmVjdGx5LlxuICAgIHRoaXMuX2RyYWdQbGFjZWhvbGRlciA9IG5ldyBJdGVtRHJhZ1BsYWNlaG9sZGVyKHRoaXMpO1xuXG4gICAgLy8gU2V0IHVwIGRyYWcgaGFuZGxlci5cbiAgICB0aGlzLl9kcmFnID0gc2V0dGluZ3MuZHJhZ0VuYWJsZWQgPyBuZXcgSXRlbURyYWcodGhpcykgOiBudWxsO1xuXG4gICAgLy8gU2V0IHVwIHRoZSBpbml0aWFsIGRpbWVuc2lvbnMgYW5kIHNvcnQgZGF0YS5cbiAgICB0aGlzLl9yZWZyZXNoRGltZW5zaW9ucygpO1xuICAgIHRoaXMuX3JlZnJlc2hTb3J0RGF0YSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFB1YmxpYyBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaW5zdGFuY2UgZ3JpZCByZWZlcmVuY2UuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuZ2V0R3JpZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBncmlkSW5zdGFuY2VzW3RoaXMuX2dyaWRJZF07XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaW5zdGFuY2UgZWxlbWVudC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0hUTUxFbGVtZW50fVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgaW5zdGFuY2UgZWxlbWVudCdzIGNhY2hlZCB3aWR0aC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge051bWJlcn1cbiAgICovXG4gIEl0ZW0ucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dpZHRoO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgaW5zdGFuY2UgZWxlbWVudCdzIGNhY2hlZCBoZWlnaHQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBJdGVtLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgaW5zdGFuY2UgZWxlbWVudCdzIGNhY2hlZCBtYXJnaW5zLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgKiAgIC0gVGhlIHJldHVybmVkIG9iamVjdCBjb250YWlucyBsZWZ0LCByaWdodCwgdG9wIGFuZCBib3R0b20gcHJvcGVydGllc1xuICAgKiAgICAgd2hpY2ggaW5kaWNhdGUgdGhlIGl0ZW0gZWxlbWVudCdzIGNhY2hlZCBtYXJnaW5zLlxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuZ2V0TWFyZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IHRoaXMuX21hcmdpbkxlZnQsXG4gICAgICByaWdodDogdGhpcy5fbWFyZ2luUmlnaHQsXG4gICAgICB0b3A6IHRoaXMuX21hcmdpblRvcCxcbiAgICAgIGJvdHRvbTogdGhpcy5fbWFyZ2luQm90dG9tXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IGluc3RhbmNlIGVsZW1lbnQncyBjYWNoZWQgcG9zaXRpb24uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAqICAgLSBUaGUgcmV0dXJuZWQgb2JqZWN0IGNvbnRhaW5zIGxlZnQgYW5kIHRvcCBwcm9wZXJ0aWVzIHdoaWNoIGluZGljYXRlIHRoZVxuICAgKiAgICAgaXRlbSBlbGVtZW50J3MgY2FjaGVkIHBvc2l0aW9uIGluIHRoZSBncmlkLlxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogdGhpcy5fbGVmdCxcbiAgICAgIHRvcDogdGhpcy5fdG9wXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogSXMgdGhlIGl0ZW0gYWN0aXZlP1xuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW0ucHJvdG90eXBlLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzQWN0aXZlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJcyB0aGUgaXRlbSB2aXNpYmxlP1xuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW0ucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhIXRoaXMuX3Zpc2liaWxpdHkgJiYgIXRoaXMuX3Zpc2liaWxpdHkuX2lzSGlkZGVuO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJcyB0aGUgaXRlbSBiZWluZyBhbmltYXRlZCB0byB2aXNpYmxlP1xuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEl0ZW0ucHJvdG90eXBlLmlzU2hvd2luZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhISh0aGlzLl92aXNpYmlsaXR5ICYmIHRoaXMuX3Zpc2liaWxpdHkuX2lzU2hvd2luZyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIElzIHRoZSBpdGVtIGJlaW5nIGFuaW1hdGVkIHRvIGhpZGRlbj9cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBJdGVtLnByb3RvdHlwZS5pc0hpZGluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhISh0aGlzLl92aXNpYmlsaXR5ICYmIHRoaXMuX3Zpc2liaWxpdHkuX2lzSGlkaW5nKTtcbiAgfTtcblxuICAvKipcbiAgICogSXMgdGhlIGl0ZW0gcG9zaXRpb25pbmc/XG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuaXNQb3NpdGlvbmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhISh0aGlzLl9sYXlvdXQgJiYgdGhpcy5fbGF5b3V0Ll9pc0FjdGl2ZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIElzIHRoZSBpdGVtIGJlaW5nIGRyYWdnZWQ/XG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuaXNEcmFnZ2luZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhISh0aGlzLl9kcmFnICYmIHRoaXMuX2RyYWcuX2lzQWN0aXZlKTtcbiAgfTtcblxuICAvKipcbiAgICogSXMgdGhlIGl0ZW0gYmVpbmcgcmVsZWFzZWQ/XG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuaXNSZWxlYXNpbmcgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gISEodGhpcy5fcmVsZWFzZSAmJiB0aGlzLl9yZWxlYXNlLl9pc0FjdGl2ZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIElzIHRoZSBpdGVtIGRlc3Ryb3llZD9cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgSXRlbS5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBJdGVtLnByb3RvdHlwZS5pc0Rlc3Ryb3llZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0Rlc3Ryb3llZDtcbiAgfTtcblxuICAvKipcbiAgICogUHJpdmF0ZSBwcm90b3R5cGUgbWV0aG9kc1xuICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZWNhbGN1bGF0ZSBpdGVtJ3MgZGltZW5zaW9ucy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEl0ZW0ucHJvdG90eXBlXG4gICAqL1xuICBJdGVtLnByb3RvdHlwZS5fcmVmcmVzaERpbWVuc2lvbnMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgdGhpcy5fdmlzaWJpbGl0eS5faXNIaWRkZW4pIHJldHVybjtcblxuICAgIHZhciBlbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcbiAgICB2YXIgZHJhZ1BsYWNlaG9sZGVyID0gdGhpcy5fZHJhZ1BsYWNlaG9sZGVyO1xuICAgIHZhciByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIC8vIENhbGN1bGF0ZSB3aWR0aCBhbmQgaGVpZ2h0LlxuICAgIHRoaXMuX3dpZHRoID0gcmVjdC53aWR0aDtcbiAgICB0aGlzLl9oZWlnaHQgPSByZWN0LmhlaWdodDtcblxuICAgIC8vIENhbGN1bGF0ZSBtYXJnaW5zIChpZ25vcmUgbmVnYXRpdmUgbWFyZ2lucykuXG4gICAgdGhpcy5fbWFyZ2luTGVmdCA9IE1hdGgubWF4KDAsIGdldFN0eWxlQXNGbG9hdChlbGVtZW50LCAnbWFyZ2luLWxlZnQnKSk7XG4gICAgdGhpcy5fbWFyZ2luUmlnaHQgPSBNYXRoLm1heCgwLCBnZXRTdHlsZUFzRmxvYXQoZWxlbWVudCwgJ21hcmdpbi1yaWdodCcpKTtcbiAgICB0aGlzLl9tYXJnaW5Ub3AgPSBNYXRoLm1heCgwLCBnZXRTdHlsZUFzRmxvYXQoZWxlbWVudCwgJ21hcmdpbi10b3AnKSk7XG4gICAgdGhpcy5fbWFyZ2luQm90dG9tID0gTWF0aC5tYXgoMCwgZ2V0U3R5bGVBc0Zsb2F0KGVsZW1lbnQsICdtYXJnaW4tYm90dG9tJykpO1xuXG4gICAgLy8gS2VlcCBkcmFnIHBsYWNlaG9sZGVyJ3MgZGltZW5zaW9ucyBzeW5jZWQgd2l0aCB0aGUgaXRlbSdzLlxuICAgIGlmIChkcmFnUGxhY2Vob2xkZXIpIHtcbiAgICAgIGRyYWdQbGFjZWhvbGRlci51cGRhdGVEaW1lbnNpb25zKHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogRmV0Y2ggYW5kIHN0b3JlIGl0ZW0ncyBzb3J0IGRhdGEuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuX3JlZnJlc2hTb3J0RGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuO1xuXG4gICAgdmFyIGRhdGEgPSAodGhpcy5fc29ydERhdGEgPSB7fSk7XG4gICAgdmFyIGdldHRlcnMgPSB0aGlzLmdldEdyaWQoKS5fc2V0dGluZ3Muc29ydERhdGE7XG4gICAgdmFyIHByb3A7XG5cbiAgICBmb3IgKHByb3AgaW4gZ2V0dGVycykge1xuICAgICAgZGF0YVtwcm9wXSA9IGdldHRlcnNbcHJvcF0odGhpcywgdGhpcy5fZWxlbWVudCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IGl0ZW0gaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBJdGVtLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtyZW1vdmVFbGVtZW50PWZhbHNlXVxuICAgKi9cbiAgSXRlbS5wcm90b3R5cGUuX2Rlc3Ryb3kgPSBmdW5jdGlvbihyZW1vdmVFbGVtZW50KSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm47XG5cbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQ7XG4gICAgdmFyIGdyaWQgPSB0aGlzLmdldEdyaWQoKTtcbiAgICB2YXIgc2V0dGluZ3MgPSBncmlkLl9zZXR0aW5ncztcbiAgICB2YXIgaW5kZXggPSBncmlkLl9pdGVtcy5pbmRleE9mKHRoaXMpO1xuXG4gICAgLy8gRGVzdHJveSBoYW5kbGVycy5cbiAgICB0aGlzLl9yZWxlYXNlLmRlc3Ryb3koKTtcbiAgICB0aGlzLl9taWdyYXRlLmRlc3Ryb3koKTtcbiAgICB0aGlzLl9sYXlvdXQuZGVzdHJveSgpO1xuICAgIHRoaXMuX3Zpc2liaWxpdHkuZGVzdHJveSgpO1xuICAgIHRoaXMuX2FuaW1hdGUuZGVzdHJveSgpO1xuICAgIHRoaXMuX2FuaW1hdGVDaGlsZC5kZXN0cm95KCk7XG4gICAgdGhpcy5fZHJhZ1BsYWNlaG9sZGVyLmRlc3Ryb3koKTtcbiAgICB0aGlzLl9kcmFnICYmIHRoaXMuX2RyYWcuZGVzdHJveSgpO1xuXG4gICAgLy8gUmVtb3ZlIGFsbCBpbmxpbmUgc3R5bGVzLlxuICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xuICAgIHRoaXMuX2NoaWxkLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcblxuICAgIC8vIFJlbW92ZSBpdGVtIGNsYXNzLlxuICAgIHJlbW92ZUNsYXNzKGVsZW1lbnQsIHNldHRpbmdzLml0ZW1DbGFzcyk7XG5cbiAgICAvLyBSZW1vdmUgaXRlbSBmcm9tIEdyaWQgaW5zdGFuY2UgaWYgaXQgc3RpbGwgZXhpc3RzIHRoZXJlLlxuICAgIGluZGV4ID4gLTEgJiYgZ3JpZC5faXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgIC8vIFJlbW92ZSBlbGVtZW50IGZyb20gRE9NLlxuICAgIHJlbW92ZUVsZW1lbnQgJiYgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXG4gICAgLy8gUmVzZXQgc3RhdGUuXG4gICAgdGhpcy5faXNBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLl9pc0Rlc3Ryb3llZCA9IHRydWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgaXMgdGhlIGRlZmF1bHQgbGF5b3V0IGFsZ29yaXRobSBmb3IgTXV1cmkuIEJhc2VkIG9uIE1BWFJFQ1RTIGFwcHJvYWNoXG4gICAqIGFzIGRlc2NyaWJlZCBieSBKdWtrYSBKeWzDpG5raSBpbiBoaXMgc3VydmV5OiBcIkEgVGhvdXNhbmQgV2F5cyB0byBQYWNrIHRoZVxuICAgKiBCaW4gLSBBIFByYWN0aWNhbCBBcHByb2FjaCB0byBUd28tRGltZW5zaW9uYWwgUmVjdGFuZ2xlIEJpbiBQYWNraW5nLlwiLlxuICAgKlxuICAgKiBAY2xhc3NcbiAgICovXG4gIGZ1bmN0aW9uIFBhY2tlcigpIHtcbiAgICB0aGlzLl9zbG90cyA9IFtdO1xuICAgIHRoaXMuX3Nsb3RTaXplcyA9IFtdO1xuICAgIHRoaXMuX2ZyZWVTbG90cyA9IFtdO1xuICAgIHRoaXMuX25ld1Nsb3RzID0gW107XG4gICAgdGhpcy5fcmVjdEl0ZW0gPSB7fTtcbiAgICB0aGlzLl9yZWN0U3RvcmUgPSBbXTtcbiAgICB0aGlzLl9yZWN0SWQgPSAwO1xuXG4gICAgLy8gVGhlIGxheW91dCByZXR1cm4gZGF0YSwgd2hpY2ggd2lsbCBiZSBwb3B1bGF0ZWQgaW4gZ2V0TGF5b3V0LlxuICAgIHRoaXMuX2xheW91dCA9IHtcbiAgICAgIHNsb3RzOiBudWxsLFxuICAgICAgc2V0V2lkdGg6IGZhbHNlLFxuICAgICAgc2V0SGVpZ2h0OiBmYWxzZSxcbiAgICAgIHdpZHRoOiBmYWxzZSxcbiAgICAgIGhlaWdodDogZmFsc2VcbiAgICB9O1xuXG4gICAgLy8gQmluZCBzb3J0IGhhbmRsZXJzLlxuICAgIHRoaXMuX3NvcnRSZWN0c0xlZnRUb3AgPSB0aGlzLl9zb3J0UmVjdHNMZWZ0VG9wLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fc29ydFJlY3RzVG9wTGVmdCA9IHRoaXMuX3NvcnRSZWN0c1RvcExlZnQuYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBQYWNrZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7SXRlbVtdfSBpdGVtc1xuICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodFxuICAgKiBAcGFyYW0ge051bWJlcltdfSBbc2xvdHNdXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5maWxsR2Fwcz1mYWxzZV1cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5ob3Jpem9udGFsPWZhbHNlXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmFsaWduUmlnaHQ9ZmFsc2VdXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuYWxpZ25Cb3R0b209ZmFsc2VdXG4gICAqIEByZXR1cm5zIHtMYXlvdXREYXRhfVxuICAgKi9cbiAgUGFja2VyLnByb3RvdHlwZS5nZXRMYXlvdXQgPSBmdW5jdGlvbihpdGVtcywgd2lkdGgsIGhlaWdodCwgc2xvdHMsIG9wdGlvbnMpIHtcbiAgICB2YXIgbGF5b3V0ID0gdGhpcy5fbGF5b3V0O1xuICAgIHZhciBmaWxsR2FwcyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5maWxsR2Fwcyk7XG4gICAgdmFyIGlzSG9yaXpvbnRhbCA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5ob3Jpem9udGFsKTtcbiAgICB2YXIgYWxpZ25SaWdodCA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5hbGlnblJpZ2h0KTtcbiAgICB2YXIgYWxpZ25Cb3R0b20gPSAhIShvcHRpb25zICYmIG9wdGlvbnMuYWxpZ25Cb3R0b20pO1xuICAgIHZhciByb3VuZGluZyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5yb3VuZGluZyk7XG4gICAgdmFyIHNsb3RTaXplcyA9IHRoaXMuX3Nsb3RTaXplcztcbiAgICB2YXIgaTtcblxuICAgIC8vIFJlc2V0IGxheW91dCBkYXRhLlxuICAgIGxheW91dC5zbG90cyA9IHNsb3RzID8gc2xvdHMgOiB0aGlzLl9zbG90cztcbiAgICBsYXlvdXQud2lkdGggPSBpc0hvcml6b250YWwgPyAwIDogcm91bmRpbmcgPyBNYXRoLnJvdW5kKHdpZHRoKSA6IHdpZHRoO1xuICAgIGxheW91dC5oZWlnaHQgPSAhaXNIb3Jpem9udGFsID8gMCA6IHJvdW5kaW5nID8gTWF0aC5yb3VuZChoZWlnaHQpIDogaGVpZ2h0O1xuICAgIGxheW91dC5zZXRXaWR0aCA9IGlzSG9yaXpvbnRhbDtcbiAgICBsYXlvdXQuc2V0SGVpZ2h0ID0gIWlzSG9yaXpvbnRhbDtcblxuICAgIC8vIE1ha2Ugc3VyZSBzbG90cyBhbmQgc2xvdCBzaXplIGFycmF5cyBhcmUgcmVzZXQuXG4gICAgbGF5b3V0LnNsb3RzLmxlbmd0aCA9IDA7XG4gICAgc2xvdFNpemVzLmxlbmd0aCA9IDA7XG5cbiAgICAvLyBObyBuZWVkIHRvIGdvIGZ1cnRoZXIgaWYgaXRlbXMgZG8gbm90IGV4aXN0LlxuICAgIGlmICghaXRlbXMubGVuZ3RoKSByZXR1cm4gbGF5b3V0O1xuXG4gICAgLy8gRmluZCBzbG90cyBmb3IgaXRlbXMuXG4gICAgZm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLl9hZGRTbG90KGl0ZW1zW2ldLCBpc0hvcml6b250YWwsIGZpbGxHYXBzLCByb3VuZGluZywgYWxpZ25SaWdodCB8fCBhbGlnbkJvdHRvbSk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGFsaWdubWVudCBpcyBzZXQgdG8gcmlnaHQgd2UgbmVlZCB0byBhZGp1c3QgdGhlIHJlc3VsdHMuXG4gICAgaWYgKGFsaWduUmlnaHQpIHtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBsYXlvdXQuc2xvdHMubGVuZ3RoOyBpID0gaSArIDIpIHtcbiAgICAgICAgbGF5b3V0LnNsb3RzW2ldID0gbGF5b3V0LndpZHRoIC0gKGxheW91dC5zbG90c1tpXSArIHNsb3RTaXplc1tpXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGFsaWdubWVudCBpcyBzZXQgdG8gYm90dG9tIHdlIG5lZWQgdG8gYWRqdXN0IHRoZSByZXN1bHRzLlxuICAgIGlmIChhbGlnbkJvdHRvbSkge1xuICAgICAgZm9yIChpID0gMTsgaSA8IGxheW91dC5zbG90cy5sZW5ndGg7IGkgPSBpICsgMikge1xuICAgICAgICBsYXlvdXQuc2xvdHNbaV0gPSBsYXlvdXQuaGVpZ2h0IC0gKGxheW91dC5zbG90c1tpXSArIHNsb3RTaXplc1tpXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgc2xvdHMgYXJyYXlzIGFuZCByZWN0IGlkLlxuICAgIHNsb3RTaXplcy5sZW5ndGggPSAwO1xuICAgIHRoaXMuX2ZyZWVTbG90cy5sZW5ndGggPSAwO1xuICAgIHRoaXMuX25ld1Nsb3RzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5fcmVjdElkID0gMDtcblxuICAgIHJldHVybiBsYXlvdXQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBwb3NpdGlvbiBmb3IgdGhlIGxheW91dCBpdGVtLiBSZXR1cm5zIHRoZSBsZWZ0IGFuZCB0b3AgcG9zaXRpb25cbiAgICogb2YgdGhlIGl0ZW0gaW4gcGl4ZWxzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgUGFja2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0l0ZW19IGl0ZW1cbiAgICogQHBhcmFtIHtCb29sZWFufSBpc0hvcml6b250YWxcbiAgICogQHBhcmFtIHtCb29sZWFufSBmaWxsR2Fwc1xuICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJvdW5kaW5nXG4gICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICovXG4gIFBhY2tlci5wcm90b3R5cGUuX2FkZFNsb3QgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVwcyA9IDAuMDAxO1xuICAgIHZhciBpdGVtU2xvdCA9IHt9O1xuICAgIHJldHVybiBmdW5jdGlvbihpdGVtLCBpc0hvcml6b250YWwsIGZpbGxHYXBzLCByb3VuZGluZywgdHJhY2tTaXplKSB7XG4gICAgICB2YXIgbGF5b3V0ID0gdGhpcy5fbGF5b3V0O1xuICAgICAgdmFyIGZyZWVTbG90cyA9IHRoaXMuX2ZyZWVTbG90cztcbiAgICAgIHZhciBuZXdTbG90cyA9IHRoaXMuX25ld1Nsb3RzO1xuICAgICAgdmFyIHJlY3Q7XG4gICAgICB2YXIgcmVjdElkO1xuICAgICAgdmFyIHBvdGVudGlhbFNsb3RzO1xuICAgICAgdmFyIGlnbm9yZUN1cnJlbnRTbG90cztcbiAgICAgIHZhciBpO1xuICAgICAgdmFyIGlpO1xuXG4gICAgICAvLyBSZXNldCBuZXcgc2xvdHMuXG4gICAgICBuZXdTbG90cy5sZW5ndGggPSAwO1xuXG4gICAgICAvLyBTZXQgaXRlbSBzbG90IGluaXRpYWwgZGF0YS5cbiAgICAgIGl0ZW1TbG90LmxlZnQgPSBudWxsO1xuICAgICAgaXRlbVNsb3QudG9wID0gbnVsbDtcbiAgICAgIGl0ZW1TbG90LndpZHRoID0gaXRlbS5fd2lkdGggKyBpdGVtLl9tYXJnaW5MZWZ0ICsgaXRlbS5fbWFyZ2luUmlnaHQ7XG4gICAgICBpdGVtU2xvdC5oZWlnaHQgPSBpdGVtLl9oZWlnaHQgKyBpdGVtLl9tYXJnaW5Ub3AgKyBpdGVtLl9tYXJnaW5Cb3R0b207XG5cbiAgICAgIC8vIFJvdW5kIGl0ZW0gc2xvdCB3aWR0aCBhbmQgaGVpZ2h0IGlmIG5lZWRlZC5cbiAgICAgIGlmIChyb3VuZGluZykge1xuICAgICAgICBpdGVtU2xvdC53aWR0aCA9IE1hdGgucm91bmQoaXRlbVNsb3Qud2lkdGgpO1xuICAgICAgICBpdGVtU2xvdC5oZWlnaHQgPSBNYXRoLnJvdW5kKGl0ZW1TbG90LmhlaWdodCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRyeSB0byBmaW5kIGEgc2xvdCBmb3IgdGhlIGl0ZW0uXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgZnJlZVNsb3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJlY3RJZCA9IGZyZWVTbG90c1tpXTtcbiAgICAgICAgaWYgKCFyZWN0SWQpIGNvbnRpbnVlO1xuICAgICAgICByZWN0ID0gdGhpcy5fZ2V0UmVjdChyZWN0SWQpO1xuICAgICAgICBpZiAoaXRlbVNsb3Qud2lkdGggPD0gcmVjdC53aWR0aCArIGVwcyAmJiBpdGVtU2xvdC5oZWlnaHQgPD0gcmVjdC5oZWlnaHQgKyBlcHMpIHtcbiAgICAgICAgICBpdGVtU2xvdC5sZWZ0ID0gcmVjdC5sZWZ0O1xuICAgICAgICAgIGl0ZW1TbG90LnRvcCA9IHJlY3QudG9wO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIElmIG5vIHNsb3Qgd2FzIGZvdW5kIGZvciB0aGUgaXRlbS5cbiAgICAgIGlmIChpdGVtU2xvdC5sZWZ0ID09PSBudWxsKSB7XG4gICAgICAgIC8vIFBvc2l0aW9uIHRoZSBpdGVtIGluIHRvIHRoZSBib3R0b20gbGVmdCAodmVydGljYWwgbW9kZSkgb3IgdG9wIHJpZ2h0XG4gICAgICAgIC8vIChob3Jpem9udGFsIG1vZGUpIG9mIHRoZSBncmlkLlxuICAgICAgICBpdGVtU2xvdC5sZWZ0ID0gIWlzSG9yaXpvbnRhbCA/IDAgOiBsYXlvdXQud2lkdGg7XG4gICAgICAgIGl0ZW1TbG90LnRvcCA9ICFpc0hvcml6b250YWwgPyBsYXlvdXQuaGVpZ2h0IDogMDtcblxuICAgICAgICAvLyBJZiBnYXBzIGRvbid0IG5lZWQgZmlsbGluZyBkbyBub3QgYWRkIGFueSBjdXJyZW50IHNsb3RzIHRvIHRoZSBuZXdcbiAgICAgICAgLy8gc2xvdHMgYXJyYXkuXG4gICAgICAgIGlmICghZmlsbEdhcHMpIHtcbiAgICAgICAgICBpZ25vcmVDdXJyZW50U2xvdHMgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEluIHZlcnRpY2FsIG1vZGUsIGlmIHRoZSBpdGVtJ3MgYm90dG9tIG92ZXJsYXBzIHRoZSBncmlkJ3MgYm90dG9tLlxuICAgICAgaWYgKCFpc0hvcml6b250YWwgJiYgaXRlbVNsb3QudG9wICsgaXRlbVNsb3QuaGVpZ2h0ID4gbGF5b3V0LmhlaWdodCkge1xuICAgICAgICAvLyBJZiBpdGVtIGlzIG5vdCBhbGlnbmVkIHRvIHRoZSBsZWZ0IGVkZ2UsIGNyZWF0ZSBhIG5ldyBzbG90LlxuICAgICAgICBpZiAoaXRlbVNsb3QubGVmdCA+IDApIHtcbiAgICAgICAgICBuZXdTbG90cy5wdXNoKHRoaXMuX2FkZFJlY3QoMCwgbGF5b3V0LmhlaWdodCwgaXRlbVNsb3QubGVmdCwgSW5maW5pdHkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGl0ZW0gaXMgbm90IGFsaWduZWQgdG8gdGhlIHJpZ2h0IGVkZ2UsIGNyZWF0ZSBhIG5ldyBzbG90LlxuICAgICAgICBpZiAoaXRlbVNsb3QubGVmdCArIGl0ZW1TbG90LndpZHRoIDwgbGF5b3V0LndpZHRoKSB7XG4gICAgICAgICAgbmV3U2xvdHMucHVzaChcbiAgICAgICAgICAgIHRoaXMuX2FkZFJlY3QoXG4gICAgICAgICAgICAgIGl0ZW1TbG90LmxlZnQgKyBpdGVtU2xvdC53aWR0aCxcbiAgICAgICAgICAgICAgbGF5b3V0LmhlaWdodCxcbiAgICAgICAgICAgICAgbGF5b3V0LndpZHRoIC0gaXRlbVNsb3QubGVmdCAtIGl0ZW1TbG90LndpZHRoLFxuICAgICAgICAgICAgICBJbmZpbml0eVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgZ3JpZCBoZWlnaHQuXG4gICAgICAgIGxheW91dC5oZWlnaHQgPSBpdGVtU2xvdC50b3AgKyBpdGVtU2xvdC5oZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIC8vIEluIGhvcml6b250YWwgbW9kZSwgaWYgdGhlIGl0ZW0ncyByaWdodCBvdmVybGFwcyB0aGUgZ3JpZCdzIHJpZ2h0IGVkZ2UuXG4gICAgICBpZiAoaXNIb3Jpem9udGFsICYmIGl0ZW1TbG90LmxlZnQgKyBpdGVtU2xvdC53aWR0aCA+IGxheW91dC53aWR0aCkge1xuICAgICAgICAvLyBJZiBpdGVtIGlzIG5vdCBhbGlnbmVkIHRvIHRoZSB0b3AsIGNyZWF0ZSBhIG5ldyBzbG90LlxuICAgICAgICBpZiAoaXRlbVNsb3QudG9wID4gMCkge1xuICAgICAgICAgIG5ld1Nsb3RzLnB1c2godGhpcy5fYWRkUmVjdChsYXlvdXQud2lkdGgsIDAsIEluZmluaXR5LCBpdGVtU2xvdC50b3ApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGl0ZW0gaXMgbm90IGFsaWduZWQgdG8gdGhlIGJvdHRvbSwgY3JlYXRlIGEgbmV3IHNsb3QuXG4gICAgICAgIGlmIChpdGVtU2xvdC50b3AgKyBpdGVtU2xvdC5oZWlnaHQgPCBsYXlvdXQuaGVpZ2h0KSB7XG4gICAgICAgICAgbmV3U2xvdHMucHVzaChcbiAgICAgICAgICAgIHRoaXMuX2FkZFJlY3QoXG4gICAgICAgICAgICAgIGxheW91dC53aWR0aCxcbiAgICAgICAgICAgICAgaXRlbVNsb3QudG9wICsgaXRlbVNsb3QuaGVpZ2h0LFxuICAgICAgICAgICAgICBJbmZpbml0eSxcbiAgICAgICAgICAgICAgbGF5b3V0LmhlaWdodCAtIGl0ZW1TbG90LnRvcCAtIGl0ZW1TbG90LmhlaWdodFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgZ3JpZCB3aWR0aC5cbiAgICAgICAgbGF5b3V0LndpZHRoID0gaXRlbVNsb3QubGVmdCArIGl0ZW1TbG90LndpZHRoO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbiB1cCB0aGUgY3VycmVudCBzbG90cyBtYWtpbmcgc3VyZSB0aGVyZSBhcmUgbm8gb2xkIHNsb3RzIHRoYXRcbiAgICAgIC8vIG92ZXJsYXAgd2l0aCB0aGUgaXRlbS4gSWYgYW4gb2xkIHNsb3Qgb3ZlcmxhcHMgd2l0aCB0aGUgaXRlbSwgc3BsaXQgaXRcbiAgICAgIC8vIGludG8gc21hbGxlciBzbG90cyBpZiBuZWNlc3NhcnkuXG4gICAgICBmb3IgKGkgPSBmaWxsR2FwcyA/IDAgOiBpZ25vcmVDdXJyZW50U2xvdHMgPyBmcmVlU2xvdHMubGVuZ3RoIDogaTsgaSA8IGZyZWVTbG90cy5sZW5ndGg7IGkrKykge1xuICAgICAgICByZWN0SWQgPSBmcmVlU2xvdHNbaV07XG4gICAgICAgIGlmICghcmVjdElkKSBjb250aW51ZTtcbiAgICAgICAgcmVjdCA9IHRoaXMuX2dldFJlY3QocmVjdElkKTtcbiAgICAgICAgcG90ZW50aWFsU2xvdHMgPSB0aGlzLl9zcGxpdFJlY3QocmVjdCwgaXRlbVNsb3QpO1xuICAgICAgICBmb3IgKGlpID0gMDsgaWkgPCBwb3RlbnRpYWxTbG90cy5sZW5ndGg7IGlpKyspIHtcbiAgICAgICAgICByZWN0SWQgPSBwb3RlbnRpYWxTbG90c1tpaV07XG4gICAgICAgICAgcmVjdCA9IHRoaXMuX2dldFJlY3QocmVjdElkKTtcbiAgICAgICAgICAvLyBMZXQncyBtYWtlIHN1cmUgaGVyZSB0aGF0IHdlIGhhdmUgYSBiaWcgZW5vdWdoIHNsb3RcbiAgICAgICAgICAvLyAod2lkdGgvaGVpZ2h0ID4gMC40OXB4KSBhbmQgYWxzbyBsZXQncyBtYWtlIHN1cmUgdGhhdCB0aGUgc2xvdCBpc1xuICAgICAgICAgIC8vIHdpdGhpbiB0aGUgYm91bmRhcmllcyBvZiB0aGUgZ3JpZC5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICByZWN0LndpZHRoID4gMC40OSAmJlxuICAgICAgICAgICAgcmVjdC5oZWlnaHQgPiAwLjQ5ICYmXG4gICAgICAgICAgICAoKCFpc0hvcml6b250YWwgJiYgcmVjdC50b3AgPCBsYXlvdXQuaGVpZ2h0KSB8fFxuICAgICAgICAgICAgICAoaXNIb3Jpem9udGFsICYmIHJlY3QubGVmdCA8IGxheW91dC53aWR0aCkpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBuZXdTbG90cy5wdXNoKHJlY3RJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNhbml0aXplIG5ldyBzbG90cy5cbiAgICAgIGlmIChuZXdTbG90cy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5fcHVyZ2VSZWN0cyhuZXdTbG90cykuc29ydChcbiAgICAgICAgICBpc0hvcml6b250YWwgPyB0aGlzLl9zb3J0UmVjdHNMZWZ0VG9wIDogdGhpcy5fc29ydFJlY3RzVG9wTGVmdFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgbGF5b3V0IHdpZHRoL2hlaWdodC5cbiAgICAgIGlmIChpc0hvcml6b250YWwpIHtcbiAgICAgICAgbGF5b3V0LndpZHRoID0gTWF0aC5tYXgobGF5b3V0LndpZHRoLCBpdGVtU2xvdC5sZWZ0ICsgaXRlbVNsb3Qud2lkdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGF5b3V0LmhlaWdodCA9IE1hdGgubWF4KGxheW91dC5oZWlnaHQsIGl0ZW1TbG90LnRvcCArIGl0ZW1TbG90LmhlaWdodCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBpdGVtIHNsb3QgZGF0YSB0byBsYXlvdXQgc2xvdHMgKGFuZCBzdG9yZSB0aGUgc2xvdCBzaXplIGZvciBsYXRlclxuICAgICAgLy8gdXNhZ2UgdG9vIGlmIG5lY2Vzc2FyeSkuXG4gICAgICBsYXlvdXQuc2xvdHMucHVzaChpdGVtU2xvdC5sZWZ0LCBpdGVtU2xvdC50b3ApO1xuICAgICAgaWYgKHRyYWNrU2l6ZSkgdGhpcy5fc2xvdFNpemVzLnB1c2goaXRlbVNsb3Qud2lkdGgsIGl0ZW1TbG90LmhlaWdodCk7XG5cbiAgICAgIC8vIEZyZWUvbmV3IHNsb3RzIHN3aXRjaGVyb28hXG4gICAgICB0aGlzLl9mcmVlU2xvdHMgPSBuZXdTbG90cztcbiAgICAgIHRoaXMuX25ld1Nsb3RzID0gZnJlZVNsb3RzO1xuICAgIH07XG4gIH0pKCk7XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyByZWN0YW5nbGUgdG8gdGhlIHJlY3RhbmdsZSBzdG9yZS4gUmV0dXJucyB0aGUgaWQgb2YgdGhlIG5ld1xuICAgKiByZWN0YW5nbGUuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBQYWNrZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsZWZ0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0b3BcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHRcbiAgICogQHJldHVybnMge1JlY3RJZH1cbiAgICovXG4gIFBhY2tlci5wcm90b3R5cGUuX2FkZFJlY3QgPSBmdW5jdGlvbihsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICB2YXIgcmVjdElkID0gKyt0aGlzLl9yZWN0SWQ7XG4gICAgdmFyIHJlY3RTdG9yZSA9IHRoaXMuX3JlY3RTdG9yZTtcblxuICAgIHJlY3RTdG9yZVtyZWN0SWRdID0gbGVmdCB8fCAwO1xuICAgIHJlY3RTdG9yZVsrK3RoaXMuX3JlY3RJZF0gPSB0b3AgfHwgMDtcbiAgICByZWN0U3RvcmVbKyt0aGlzLl9yZWN0SWRdID0gd2lkdGggfHwgMDtcbiAgICByZWN0U3RvcmVbKyt0aGlzLl9yZWN0SWRdID0gaGVpZ2h0IHx8IDA7XG5cbiAgICByZXR1cm4gcmVjdElkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgcmVjdGFuZ2xlIGRhdGEgZnJvbSB0aGUgcmVjdGFuZ2xlIHN0b3JlIGJ5IGlkLiBPcHRpb25hbGx5IHlvdSBjYW5cbiAgICogcHJvdmlkZSBhIHRhcmdldCBvYmplY3Qgd2hlcmUgdGhlIHJlY3RhbmdsZSBkYXRhIHdpbGwgYmUgd3JpdHRlbiBpbi4gQnlcbiAgICogZGVmYXVsdCBhbiBpbnRlcm5hbCBvYmplY3QgaXMgcmV1c2VkIGFzIGEgdGFyZ2V0IG9iamVjdC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIFBhY2tlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtSZWN0SWR9IGlkXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XVxuICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgKi9cbiAgUGFja2VyLnByb3RvdHlwZS5fZ2V0UmVjdCA9IGZ1bmN0aW9uKGlkLCB0YXJnZXQpIHtcbiAgICB2YXIgcmVjdEl0ZW0gPSB0YXJnZXQgPyB0YXJnZXQgOiB0aGlzLl9yZWN0SXRlbTtcbiAgICB2YXIgcmVjdFN0b3JlID0gdGhpcy5fcmVjdFN0b3JlO1xuXG4gICAgcmVjdEl0ZW0ubGVmdCA9IHJlY3RTdG9yZVtpZF0gfHwgMDtcbiAgICByZWN0SXRlbS50b3AgPSByZWN0U3RvcmVbKytpZF0gfHwgMDtcbiAgICByZWN0SXRlbS53aWR0aCA9IHJlY3RTdG9yZVsrK2lkXSB8fCAwO1xuICAgIHJlY3RJdGVtLmhlaWdodCA9IHJlY3RTdG9yZVsrK2lkXSB8fCAwO1xuXG4gICAgcmV0dXJuIHJlY3RJdGVtO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQdW5jaCBhIGhvbGUgaW50byBhIHJlY3RhbmdsZSBhbmQgc3BsaXQgdGhlIHJlbWFpbmluZyBhcmVhIGludG8gc21hbGxlclxuICAgKiByZWN0YW5nbGVzICg0IGF0IG1heCkuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBQYWNrZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7UmVjdGFuZ2xlfSByZWN0XG4gICAqIEBwYXJhbSB7UmVjdGFuZ2xlfSBob2xlXG4gICAqIEByZXR1cm5zIHtSZWN0SWRbXX1cbiAgICovXG4gIFBhY2tlci5wcm90b3R5cGUuX3NwbGl0UmVjdCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHJldHVybiBmdW5jdGlvbihyZWN0LCBob2xlKSB7XG4gICAgICAvLyBSZXNldCBvbGQgcmVzdWx0cy5cbiAgICAgIHJlc3VsdHMubGVuZ3RoID0gMDtcblxuICAgICAgLy8gSWYgdGhlIHJlY3QgZG9lcyBub3Qgb3ZlcmxhcCB3aXRoIHRoZSBob2xlIGFkZCByZWN0IHRvIHRoZSByZXR1cm4gZGF0YVxuICAgICAgLy8gYXMgaXMuXG4gICAgICBpZiAoIXRoaXMuX2RvUmVjdHNPdmVybGFwKHJlY3QsIGhvbGUpKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh0aGlzLl9hZGRSZWN0KHJlY3QubGVmdCwgcmVjdC50b3AsIHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0KSk7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgfVxuXG4gICAgICAvLyBMZWZ0IHNwbGl0LlxuICAgICAgaWYgKHJlY3QubGVmdCA8IGhvbGUubGVmdCkge1xuICAgICAgICByZXN1bHRzLnB1c2godGhpcy5fYWRkUmVjdChyZWN0LmxlZnQsIHJlY3QudG9wLCBob2xlLmxlZnQgLSByZWN0LmxlZnQsIHJlY3QuaGVpZ2h0KSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJpZ2h0IHNwbGl0LlxuICAgICAgaWYgKHJlY3QubGVmdCArIHJlY3Qud2lkdGggPiBob2xlLmxlZnQgKyBob2xlLndpZHRoKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAgICB0aGlzLl9hZGRSZWN0KFxuICAgICAgICAgICAgaG9sZS5sZWZ0ICsgaG9sZS53aWR0aCxcbiAgICAgICAgICAgIHJlY3QudG9wLFxuICAgICAgICAgICAgcmVjdC5sZWZ0ICsgcmVjdC53aWR0aCAtIChob2xlLmxlZnQgKyBob2xlLndpZHRoKSxcbiAgICAgICAgICAgIHJlY3QuaGVpZ2h0XG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBUb3Agc3BsaXQuXG4gICAgICBpZiAocmVjdC50b3AgPCBob2xlLnRvcCkge1xuICAgICAgICByZXN1bHRzLnB1c2godGhpcy5fYWRkUmVjdChyZWN0LmxlZnQsIHJlY3QudG9wLCByZWN0LndpZHRoLCBob2xlLnRvcCAtIHJlY3QudG9wKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEJvdHRvbSBzcGxpdC5cbiAgICAgIGlmIChyZWN0LnRvcCArIHJlY3QuaGVpZ2h0ID4gaG9sZS50b3AgKyBob2xlLmhlaWdodCkge1xuICAgICAgICByZXN1bHRzLnB1c2goXG4gICAgICAgICAgdGhpcy5fYWRkUmVjdChcbiAgICAgICAgICAgIHJlY3QubGVmdCxcbiAgICAgICAgICAgIGhvbGUudG9wICsgaG9sZS5oZWlnaHQsXG4gICAgICAgICAgICByZWN0LndpZHRoLFxuICAgICAgICAgICAgcmVjdC50b3AgKyByZWN0LmhlaWdodCAtIChob2xlLnRvcCArIGhvbGUuaGVpZ2h0KVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfTtcbiAgfSkoKTtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgdHdvIHJlY3RhbmdsZXMgb3ZlcmxhcC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIFBhY2tlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGFcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGJcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBQYWNrZXIucHJvdG90eXBlLl9kb1JlY3RzT3ZlcmxhcCA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICByZXR1cm4gIShcbiAgICAgIGEubGVmdCArIGEud2lkdGggPD0gYi5sZWZ0IHx8XG4gICAgICBiLmxlZnQgKyBiLndpZHRoIDw9IGEubGVmdCB8fFxuICAgICAgYS50b3AgKyBhLmhlaWdodCA8PSBiLnRvcCB8fFxuICAgICAgYi50b3AgKyBiLmhlaWdodCA8PSBhLnRvcFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgcmVjdGFuZ2xlIGlzIGZ1bGx5IHdpdGhpbiBhbm90aGVyIHJlY3RhbmdsZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIFBhY2tlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGFcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IGJcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBQYWNrZXIucHJvdG90eXBlLl9pc1JlY3RXaXRoaW5SZWN0ID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHJldHVybiAoXG4gICAgICBhLmxlZnQgPj0gYi5sZWZ0ICYmXG4gICAgICBhLnRvcCA+PSBiLnRvcCAmJlxuICAgICAgYS5sZWZ0ICsgYS53aWR0aCA8PSBiLmxlZnQgKyBiLndpZHRoICYmXG4gICAgICBhLnRvcCArIGEuaGVpZ2h0IDw9IGIudG9wICsgYi5oZWlnaHRcbiAgICApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBMb29wcyB0aHJvdWdoIGFuIGFycmF5IG9mIHJlY3RhbmdsZSBpZHMgYW5kIHJlc2V0cyBhbGwgdGhhdCBhcmUgZnVsbHlcbiAgICogd2l0aGluIGFub3RoZXIgcmVjdGFuZ2xlIGluIHRoZSBhcnJheS4gUmVzZXR0aW5nIGluIHRoaXMgY2FzZSBtZWFucyB0aGF0XG4gICAqIHRoZSByZWN0YW5nbGUgaWQgdmFsdWUgaXMgcmVwbGFjZWQgd2l0aCB6ZXJvLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgUGFja2VyLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1JlY3RJZFtdfSByZWN0SWRzXG4gICAqIEByZXR1cm5zIHtSZWN0SWRbXX1cbiAgICovXG4gIFBhY2tlci5wcm90b3R5cGUuX3B1cmdlUmVjdHMgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJlY3RBID0ge307XG4gICAgdmFyIHJlY3RCID0ge307XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHJlY3RJZHMpIHtcbiAgICAgIHZhciBpID0gcmVjdElkcy5sZW5ndGg7XG4gICAgICB2YXIgaWk7XG5cbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgaWkgPSByZWN0SWRzLmxlbmd0aDtcbiAgICAgICAgaWYgKCFyZWN0SWRzW2ldKSBjb250aW51ZTtcbiAgICAgICAgdGhpcy5fZ2V0UmVjdChyZWN0SWRzW2ldLCByZWN0QSk7XG4gICAgICAgIHdoaWxlIChpaS0tKSB7XG4gICAgICAgICAgaWYgKCFyZWN0SWRzW2lpXSB8fCBpID09PSBpaSkgY29udGludWU7XG4gICAgICAgICAgaWYgKHRoaXMuX2lzUmVjdFdpdGhpblJlY3QocmVjdEEsIHRoaXMuX2dldFJlY3QocmVjdElkc1tpaV0sIHJlY3RCKSkpIHtcbiAgICAgICAgICAgIHJlY3RJZHNbaV0gPSAwO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZWN0SWRzO1xuICAgIH07XG4gIH0pKCk7XG5cbiAgLyoqXG4gICAqIFNvcnQgcmVjdGFuZ2xlcyB3aXRoIHRvcC1sZWZ0IGdyYXZpdHkuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBQYWNrZXIucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7UmVjdElkfSBhSWRcbiAgICogQHBhcmFtIHtSZWN0SWR9IGJJZFxuICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgKi9cbiAgUGFja2VyLnByb3RvdHlwZS5fc29ydFJlY3RzVG9wTGVmdCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVjdEEgPSB7fTtcbiAgICB2YXIgcmVjdEIgPSB7fTtcbiAgICByZXR1cm4gZnVuY3Rpb24oYUlkLCBiSWQpIHtcbiAgICAgIHRoaXMuX2dldFJlY3QoYUlkLCByZWN0QSk7XG4gICAgICB0aGlzLl9nZXRSZWN0KGJJZCwgcmVjdEIpO1xuICAgICAgLy8gcHJldHRpZXItaWdub3JlXG4gICAgICByZXR1cm4gcmVjdEEudG9wIDwgcmVjdEIudG9wID8gLTEgOlxuICAgICAgICAgICAgIHJlY3RBLnRvcCA+IHJlY3RCLnRvcCA/IDEgOlxuICAgICAgICAgICAgIHJlY3RBLmxlZnQgPCByZWN0Qi5sZWZ0ID8gLTEgOlxuICAgICAgICAgICAgIHJlY3RBLmxlZnQgPiByZWN0Qi5sZWZ0ID8gMSA6IDA7XG4gICAgfTtcbiAgfSkoKTtcblxuICAvKipcbiAgICogU29ydCByZWN0YW5nbGVzIHdpdGggbGVmdC10b3AgZ3Jhdml0eS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIFBhY2tlci5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtSZWN0SWR9IGFJZFxuICAgKiBAcGFyYW0ge1JlY3RJZH0gYklkXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBQYWNrZXIucHJvdG90eXBlLl9zb3J0UmVjdHNMZWZ0VG9wID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciByZWN0QSA9IHt9O1xuICAgIHZhciByZWN0QiA9IHt9O1xuICAgIHJldHVybiBmdW5jdGlvbihhSWQsIGJJZCkge1xuICAgICAgdGhpcy5fZ2V0UmVjdChhSWQsIHJlY3RBKTtcbiAgICAgIHRoaXMuX2dldFJlY3QoYklkLCByZWN0Qik7XG4gICAgICAvLyBwcmV0dGllci1pZ25vcmVcbiAgICAgIHJldHVybiByZWN0QS5sZWZ0IDwgcmVjdEIubGVmdCA/IC0xIDpcbiAgICAgICAgICAgICByZWN0QS5sZWZ0ID4gcmVjdEIubGVmdCA/IDEgOlxuICAgICAgICAgICAgIHJlY3RBLnRvcCA8IHJlY3RCLnRvcCA/IC0xIDpcbiAgICAgICAgICAgICByZWN0QS50b3AgPiByZWN0Qi50b3AgPyAxIDogMDtcbiAgICB9O1xuICB9KSgpO1xuXG4gIHZhciBodG1sQ29sbGVjdGlvblR5cGUgPSAnW29iamVjdCBIVE1MQ29sbGVjdGlvbl0nO1xuICB2YXIgbm9kZUxpc3RUeXBlID0gJ1tvYmplY3QgTm9kZUxpc3RdJztcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhIG5vZGUgbGlzdFxuICAgKlxuICAgKiBAcGFyYW0geyp9IHZhbFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIGZ1bmN0aW9uIGlzTm9kZUxpc3QodmFsKSB7XG4gICAgdmFyIHR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKTtcbiAgICByZXR1cm4gdHlwZSA9PT0gaHRtbENvbGxlY3Rpb25UeXBlIHx8IHR5cGUgPT09IG5vZGVMaXN0VHlwZTtcbiAgfVxuXG4gIHZhciBvYmplY3RUeXBlID0gJ29iamVjdCc7XG4gIHZhciBvYmplY3RUb1N0cmluZ1R5cGUgPSAnW29iamVjdCBPYmplY3RdJztcbiAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhIHBsYWluIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIHsqfSB2YWxcbiAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAqL1xuICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbCkge1xuICAgIHJldHVybiB0eXBlb2YgdmFsID09PSBvYmplY3RUeXBlICYmIHRvU3RyaW5nLmNhbGwodmFsKSA9PT0gb2JqZWN0VG9TdHJpbmdUeXBlO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGEgdmFsdWUgdG8gYW4gYXJyYXkgb3IgY2xvbmVzIGFuIGFycmF5LlxuICAgKlxuICAgKiBAcGFyYW0geyp9IHRhcmdldFxuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqL1xuICBmdW5jdGlvbiB0b0FycmF5KHRhcmdldCkge1xuICAgIHJldHVybiBpc05vZGVMaXN0KHRhcmdldCkgPyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0YXJnZXQpIDogQXJyYXkucHJvdG90eXBlLmNvbmNhdCh0YXJnZXQpO1xuICB9XG5cbiAgdmFyIHBhY2tlciA9IG5ldyBQYWNrZXIoKTtcbiAgdmFyIG5vb3AgPSBmdW5jdGlvbigpIHt9O1xuXG4gIHZhciBudW1iZXJUeXBlJDEgPSAnbnVtYmVyJztcbiAgdmFyIHN0cmluZ1R5cGUgPSAnc3RyaW5nJztcbiAgdmFyIGluc3RhbnRMYXlvdXQgPSAnaW5zdGFudCc7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgR3JpZCBpbnN0YW5jZS5cbiAgICpcbiAgICogQGNsYXNzXG4gICAqIEBwYXJhbSB7KEhUTUxFbGVtZW50fFN0cmluZyl9IGVsZW1lbnRcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0gez8oSFRNTEVsZW1lbnRbXXxOb2RlTGlzdHxTdHJpbmcpfSBbb3B0aW9ucy5pdGVtc11cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLnNob3dEdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5zaG93RWFzaW5nPVwiZWFzZVwiXVxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMudmlzaWJsZVN0eWxlc11cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmhpZGVEdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5oaWRlRWFzaW5nPVwiZWFzZVwiXVxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuaGlkZGVuU3R5bGVzXVxuICAgKiBAcGFyYW0geyhGdW5jdGlvbnxPYmplY3QpfSBbb3B0aW9ucy5sYXlvdXRdXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMubGF5b3V0LmZpbGxHYXBzPWZhbHNlXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmxheW91dC5ob3Jpem9udGFsPWZhbHNlXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmxheW91dC5hbGlnblJpZ2h0PWZhbHNlXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmxheW91dC5hbGlnbkJvdHRvbT1mYWxzZV1cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5sYXlvdXQucm91bmRpbmc9dHJ1ZV1cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxOdW1iZXIpfSBbb3B0aW9ucy5sYXlvdXRPblJlc2l6ZT0xMDBdXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMubGF5b3V0T25Jbml0PXRydWVdXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5sYXlvdXREdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5sYXlvdXRFYXNpbmc9XCJlYXNlXCJdXG4gICAqIEBwYXJhbSB7P09iamVjdH0gW29wdGlvbnMuc29ydERhdGE9bnVsbF1cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5kcmFnRW5hYmxlZD1mYWxzZV1cbiAgICogQHBhcmFtIHs/SHRtbEVsZW1lbnR9IFtvcHRpb25zLmRyYWdDb250YWluZXI9bnVsbF1cbiAgICogQHBhcmFtIHs/RnVuY3Rpb259IFtvcHRpb25zLmRyYWdTdGFydFByZWRpY2F0ZV1cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmRyYWdTdGFydFByZWRpY2F0ZS5kaXN0YW5jZT0wXVxuICAgKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuZHJhZ1N0YXJ0UHJlZGljYXRlLmRlbGF5PTBdXG4gICAqIEBwYXJhbSB7KEJvb2xlYW58U3RyaW5nKX0gW29wdGlvbnMuZHJhZ1N0YXJ0UHJlZGljYXRlLmhhbmRsZT1mYWxzZV1cbiAgICogQHBhcmFtIHs/U3RyaW5nfSBbb3B0aW9ucy5kcmFnQXhpc11cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxGdW5jdGlvbil9IFtvcHRpb25zLmRyYWdTb3J0PXRydWVdXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5kcmFnU29ydEhldXJpc3RpY3NdXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5kcmFnU29ydEhldXJpc3RpY3Muc29ydEludGVydmFsPTEwMF1cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmRyYWdTb3J0SGV1cmlzdGljcy5taW5EcmFnRGlzdGFuY2U9MTBdXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5kcmFnU29ydEhldXJpc3RpY3MubWluQm91bmNlQmFja0FuZ2xlPTFdXG4gICAqIEBwYXJhbSB7KEZ1bmN0aW9ufE9iamVjdCl9IFtvcHRpb25zLmRyYWdTb3J0UHJlZGljYXRlXVxuICAgKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuZHJhZ1NvcnRQcmVkaWNhdGUudGhyZXNob2xkPTUwXVxuICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuZHJhZ1NvcnRQcmVkaWNhdGUuYWN0aW9uPVwibW92ZVwiXVxuICAgKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuZHJhZ1JlbGVhc2VEdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5kcmFnUmVsZWFzZUVhc2luZz1cImVhc2VcIl1cbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmRyYWdDc3NQcm9wc11cbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmRyYWdQbGFjZWhvbGRlcl1cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5kcmFnUGxhY2Vob2xkZXIuZW5hYmxlZD1mYWxzZV1cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmRyYWdQbGFjZWhvbGRlci5kdXJhdGlvbj0zMDBdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5kcmFnUGxhY2Vob2xkZXIuZWFzaW5nPVwiZWFzZVwiXVxuICAgKiBAcGFyYW0gez9GdW5jdGlvbn0gW29wdGlvbnMuZHJhZ1BsYWNlaG9sZGVyLmNyZWF0ZUVsZW1lbnQ9bnVsbF1cbiAgICogQHBhcmFtIHs/RnVuY3Rpb259IFtvcHRpb25zLmRyYWdQbGFjZWhvbGRlci5vbkNyZWF0ZT1udWxsXVxuICAgKiBAcGFyYW0gez9GdW5jdGlvbn0gW29wdGlvbnMuZHJhZ1BsYWNlaG9sZGVyLm9uUmVtb3ZlPW51bGxdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5jb250YWluZXJDbGFzcz1cIm11dXJpXCJdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pdGVtQ2xhc3M9XCJtdXVyaS1pdGVtXCJdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pdGVtVmlzaWJsZUNsYXNzPVwibXV1cmktaXRlbS12aXNpYmxlXCJdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pdGVtSGlkZGVuQ2xhc3M9XCJtdXVyaS1pdGVtLWhpZGRlblwiXVxuICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuaXRlbVBvc2l0aW9uaW5nQ2xhc3M9XCJtdXVyaS1pdGVtLXBvc2l0aW9uaW5nXCJdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pdGVtRHJhZ2dpbmdDbGFzcz1cIm11dXJpLWl0ZW0tZHJhZ2dpbmdcIl1cbiAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLml0ZW1SZWxlYXNpbmdDbGFzcz1cIm11dXJpLWl0ZW0tcmVsZWFzaW5nXCJdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pdGVtUGxhY2Vob2xkZXJDbGFzcz1cIm11dXJpLWl0ZW0tcGxhY2Vob2xkZXJcIl1cbiAgICovXG5cbiAgZnVuY3Rpb24gR3JpZChlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgdmFyIGluc3QgPSB0aGlzO1xuICAgIHZhciBzZXR0aW5ncztcbiAgICB2YXIgaXRlbXM7XG4gICAgdmFyIGxheW91dE9uUmVzaXplO1xuXG4gICAgLy8gQWxsb3cgcGFzc2luZyBlbGVtZW50IGFzIHNlbGVjdG9yIHN0cmluZy4gU3RvcmUgZWxlbWVudCBmb3IgaW5zdGFuY2UuXG4gICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQgPVxuICAgICAgdHlwZW9mIGVsZW1lbnQgPT09IHN0cmluZ1R5cGUgPyB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KSA6IGVsZW1lbnQ7XG5cbiAgICAvLyBUaHJvdyBhbiBlcnJvciBpZiB0aGUgY29udGFpbmVyIGVsZW1lbnQgaXMgbm90IGJvZHkgZWxlbWVudCBvciBkb2VzIG5vdFxuICAgIC8vIGV4aXN0IHdpdGhpbiB0aGUgYm9keSBlbGVtZW50LlxuICAgIHZhciBpc0VsZW1lbnRJbkRvbSA9IGVsZW1lbnQuZ2V0Um9vdE5vZGVcbiAgICAgID8gZWxlbWVudC5nZXRSb290Tm9kZSh7IGNvbXBvc2VkOiB0cnVlIH0pID09PSBkb2N1bWVudFxuICAgICAgOiB3aW5kb3cuZG9jdW1lbnQuYm9keS5jb250YWlucyhlbGVtZW50KTtcbiAgICBpZiAoIWlzRWxlbWVudEluRG9tIHx8IGVsZW1lbnQgPT09IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ29udGFpbmVyIGVsZW1lbnQgbXVzdCBiZSBhbiBleGlzdGluZyBET00gZWxlbWVudCcpO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBpbnN0YW5jZSBzZXR0aW5ncyBieSBtZXJnaW5nIHRoZSBvcHRpb25zIHdpdGggZGVmYXVsdCBvcHRpb25zLlxuICAgIHNldHRpbmdzID0gdGhpcy5fc2V0dGluZ3MgPSBtZXJnZVNldHRpbmdzKEdyaWQuZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgLy8gU2FuaXRpemUgZHJhZ1NvcnQgc2V0dGluZy5cbiAgICBpZiAoIWlzRnVuY3Rpb24oc2V0dGluZ3MuZHJhZ1NvcnQpKSB7XG4gICAgICBzZXR0aW5ncy5kcmFnU29ydCA9ICEhc2V0dGluZ3MuZHJhZ1NvcnQ7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGluc3RhbmNlIGlkIGFuZCBzdG9yZSBpdCB0byB0aGUgZ3JpZCBpbnN0YW5jZXMgY29sbGVjdGlvbi5cbiAgICB0aGlzLl9pZCA9IGNyZWF0ZVVpZCgpO1xuICAgIGdyaWRJbnN0YW5jZXNbdGhpcy5faWRdID0gaW5zdDtcblxuICAgIC8vIERlc3Ryb3llZCBmbGFnLlxuICAgIHRoaXMuX2lzRGVzdHJveWVkID0gZmFsc2U7XG5cbiAgICAvLyBUaGUgbGF5b3V0IG9iamVjdCAobXV0YXRlZCBvbiBldmVyeSBsYXlvdXQpLlxuICAgIHRoaXMuX2xheW91dCA9IHtcbiAgICAgIGlkOiAwLFxuICAgICAgaXRlbXM6IFtdLFxuICAgICAgc2xvdHM6IFtdLFxuICAgICAgc2V0V2lkdGg6IGZhbHNlLFxuICAgICAgc2V0SGVpZ2h0OiBmYWxzZSxcbiAgICAgIHdpZHRoOiAwLFxuICAgICAgaGVpZ2h0OiAwXG4gICAgfTtcblxuICAgIC8vIENyZWF0ZSBwcml2YXRlIEVtaXR0ZXIgaW5zdGFuY2UuXG4gICAgdGhpcy5fZW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7XG5cbiAgICAvLyBBZGQgY29udGFpbmVyIGVsZW1lbnQncyBjbGFzcyBuYW1lLlxuICAgIGFkZENsYXNzKGVsZW1lbnQsIHNldHRpbmdzLmNvbnRhaW5lckNsYXNzKTtcblxuICAgIC8vIENyZWF0ZSBpbml0aWFsIGl0ZW1zLlxuICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgaXRlbXMgPSBzZXR0aW5ncy5pdGVtcztcbiAgICBpZiAodHlwZW9mIGl0ZW1zID09PSBzdHJpbmdUeXBlKSB7XG4gICAgICB0b0FycmF5KGVsZW1lbnQuY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24oaXRlbUVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGl0ZW1zID09PSAnKicgfHwgZWxlbWVudE1hdGNoZXMoaXRlbUVsZW1lbnQsIGl0ZW1zKSkge1xuICAgICAgICAgIGluc3QuX2l0ZW1zLnB1c2gobmV3IEl0ZW0oaW5zdCwgaXRlbUVsZW1lbnQpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGl0ZW1zKSB8fCBpc05vZGVMaXN0KGl0ZW1zKSkge1xuICAgICAgdGhpcy5faXRlbXMgPSB0b0FycmF5KGl0ZW1zKS5tYXAoZnVuY3Rpb24oaXRlbUVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJdGVtKGluc3QsIGl0ZW1FbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIElmIGxheW91dE9uUmVzaXplIG9wdGlvbiBpcyBhIHZhbGlkIG51bWJlciBzYW5pdGl6ZSBpdCBhbmQgYmluZCB0aGUgcmVzaXplXG4gICAgLy8gaGFuZGxlci5cbiAgICBsYXlvdXRPblJlc2l6ZSA9IHNldHRpbmdzLmxheW91dE9uUmVzaXplO1xuICAgIGlmICh0eXBlb2YgbGF5b3V0T25SZXNpemUgIT09IG51bWJlclR5cGUkMSkge1xuICAgICAgbGF5b3V0T25SZXNpemUgPSBsYXlvdXRPblJlc2l6ZSA9PT0gdHJ1ZSA/IDAgOiAtMTtcbiAgICB9XG4gICAgaWYgKGxheW91dE9uUmVzaXplID49IDApIHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAncmVzaXplJyxcbiAgICAgICAgKGluc3QuX3Jlc2l6ZUhhbmRsZXIgPSBkZWJvdW5jZShmdW5jdGlvbigpIHtcbiAgICAgICAgICBpbnN0LnJlZnJlc2hJdGVtcygpLmxheW91dCgpO1xuICAgICAgICB9LCBsYXlvdXRPblJlc2l6ZSkpXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIExheW91dCBvbiBpbml0IGlmIG5lY2Vzc2FyeS5cbiAgICBpZiAoc2V0dGluZ3MubGF5b3V0T25Jbml0KSB7XG4gICAgICB0aGlzLmxheW91dCh0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHVibGljIHByb3BlcnRpZXNcbiAgICogKioqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIEBzZWUgSXRlbVxuICAgKi9cbiAgR3JpZC5JdGVtID0gSXRlbTtcblxuICAvKipcbiAgICogQHNlZSBJdGVtTGF5b3V0XG4gICAqL1xuICBHcmlkLkl0ZW1MYXlvdXQgPSBJdGVtTGF5b3V0O1xuXG4gIC8qKlxuICAgKiBAc2VlIEl0ZW1WaXNpYmlsaXR5XG4gICAqL1xuICBHcmlkLkl0ZW1WaXNpYmlsaXR5ID0gSXRlbVZpc2liaWxpdHk7XG5cbiAgLyoqXG4gICAqIEBzZWUgSXRlbU1pZ3JhdGVcbiAgICovXG4gIEdyaWQuSXRlbU1pZ3JhdGUgPSBJdGVtTWlncmF0ZTtcblxuICAvKipcbiAgICogQHNlZSBJdGVtQW5pbWF0ZVxuICAgKi9cbiAgR3JpZC5JdGVtQW5pbWF0ZSA9IEl0ZW1BbmltYXRlO1xuXG4gIC8qKlxuICAgKiBAc2VlIEl0ZW1EcmFnXG4gICAqL1xuICBHcmlkLkl0ZW1EcmFnID0gSXRlbURyYWc7XG5cbiAgLyoqXG4gICAqIEBzZWUgSXRlbVJlbGVhc2VcbiAgICovXG4gIEdyaWQuSXRlbVJlbGVhc2UgPSBJdGVtUmVsZWFzZTtcblxuICAvKipcbiAgICogQHNlZSBJdGVtRHJhZ1BsYWNlaG9sZGVyXG4gICAqL1xuICBHcmlkLkl0ZW1EcmFnUGxhY2Vob2xkZXIgPSBJdGVtRHJhZ1BsYWNlaG9sZGVyO1xuXG4gIC8qKlxuICAgKiBAc2VlIEVtaXR0ZXJcbiAgICovXG4gIEdyaWQuRW1pdHRlciA9IEVtaXR0ZXI7XG5cbiAgLyoqXG4gICAqIEBzZWUgRHJhZ2dlclxuICAgKi9cbiAgR3JpZC5EcmFnZ2VyID0gRHJhZ2dlcjtcblxuICAvKipcbiAgICogQHNlZSBQYWNrZXJcbiAgICovXG4gIEdyaWQuUGFja2VyID0gUGFja2VyO1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IG9wdGlvbnMgZm9yIEdyaWQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEdyaWRcbiAgICovXG4gIEdyaWQuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgLy8gSXRlbSBlbGVtZW50c1xuICAgIGl0ZW1zOiAnKicsXG5cbiAgICAvLyBEZWZhdWx0IHNob3cgYW5pbWF0aW9uXG4gICAgc2hvd0R1cmF0aW9uOiAzMDAsXG4gICAgc2hvd0Vhc2luZzogJ2Vhc2UnLFxuXG4gICAgLy8gRGVmYXVsdCBoaWRlIGFuaW1hdGlvblxuICAgIGhpZGVEdXJhdGlvbjogMzAwLFxuICAgIGhpZGVFYXNpbmc6ICdlYXNlJyxcblxuICAgIC8vIEl0ZW0ncyB2aXNpYmxlL2hpZGRlbiBzdGF0ZSBzdHlsZXNcbiAgICB2aXNpYmxlU3R5bGVzOiB7XG4gICAgICBvcGFjaXR5OiAnMScsXG4gICAgICB0cmFuc2Zvcm06ICdzY2FsZSgxKSdcbiAgICB9LFxuICAgIGhpZGRlblN0eWxlczoge1xuICAgICAgb3BhY2l0eTogJzAnLFxuICAgICAgdHJhbnNmb3JtOiAnc2NhbGUoMC41KSdcbiAgICB9LFxuXG4gICAgLy8gTGF5b3V0XG4gICAgbGF5b3V0OiB7XG4gICAgICBmaWxsR2FwczogZmFsc2UsXG4gICAgICBob3Jpem9udGFsOiBmYWxzZSxcbiAgICAgIGFsaWduUmlnaHQ6IGZhbHNlLFxuICAgICAgYWxpZ25Cb3R0b206IGZhbHNlLFxuICAgICAgcm91bmRpbmc6IHRydWVcbiAgICB9LFxuICAgIGxheW91dE9uUmVzaXplOiAxMDAsXG4gICAgbGF5b3V0T25Jbml0OiB0cnVlLFxuICAgIGxheW91dER1cmF0aW9uOiAzMDAsXG4gICAgbGF5b3V0RWFzaW5nOiAnZWFzZScsXG5cbiAgICAvLyBTb3J0aW5nXG4gICAgc29ydERhdGE6IG51bGwsXG5cbiAgICAvLyBEcmFnICYgRHJvcFxuICAgIGRyYWdFbmFibGVkOiBmYWxzZSxcbiAgICBkcmFnQ29udGFpbmVyOiBudWxsLFxuICAgIGRyYWdTdGFydFByZWRpY2F0ZToge1xuICAgICAgZGlzdGFuY2U6IDAsXG4gICAgICBkZWxheTogMCxcbiAgICAgIGhhbmRsZTogZmFsc2VcbiAgICB9LFxuICAgIGRyYWdBeGlzOiBudWxsLFxuICAgIGRyYWdTb3J0OiB0cnVlLFxuICAgIGRyYWdTb3J0SGV1cmlzdGljczoge1xuICAgICAgc29ydEludGVydmFsOiAxMDAsXG4gICAgICBtaW5EcmFnRGlzdGFuY2U6IDEwLFxuICAgICAgbWluQm91bmNlQmFja0FuZ2xlOiAxXG4gICAgfSxcbiAgICBkcmFnU29ydFByZWRpY2F0ZToge1xuICAgICAgdGhyZXNob2xkOiA1MCxcbiAgICAgIGFjdGlvbjogYWN0aW9uTW92ZVxuICAgIH0sXG4gICAgZHJhZ1JlbGVhc2VEdXJhdGlvbjogMzAwLFxuICAgIGRyYWdSZWxlYXNlRWFzaW5nOiAnZWFzZScsXG4gICAgZHJhZ0Nzc1Byb3BzOiB7XG4gICAgICB0b3VjaEFjdGlvbjogJ25vbmUnLFxuICAgICAgdXNlclNlbGVjdDogJ25vbmUnLFxuICAgICAgdXNlckRyYWc6ICdub25lJyxcbiAgICAgIHRhcEhpZ2hsaWdodENvbG9yOiAncmdiYSgwLCAwLCAwLCAwKScsXG4gICAgICB0b3VjaENhbGxvdXQ6ICdub25lJyxcbiAgICAgIGNvbnRlbnRab29taW5nOiAnbm9uZSdcbiAgICB9LFxuICAgIGRyYWdQbGFjZWhvbGRlcjoge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBkdXJhdGlvbjogMzAwLFxuICAgICAgZWFzaW5nOiAnZWFzZScsXG4gICAgICBjcmVhdGVFbGVtZW50OiBudWxsLFxuICAgICAgb25DcmVhdGU6IG51bGwsXG4gICAgICBvblJlbW92ZTogbnVsbFxuICAgIH0sXG5cbiAgICAvLyBDbGFzc25hbWVzXG4gICAgY29udGFpbmVyQ2xhc3M6ICdtdXVyaScsXG4gICAgaXRlbUNsYXNzOiAnbXV1cmktaXRlbScsXG4gICAgaXRlbVZpc2libGVDbGFzczogJ211dXJpLWl0ZW0tc2hvd24nLFxuICAgIGl0ZW1IaWRkZW5DbGFzczogJ211dXJpLWl0ZW0taGlkZGVuJyxcbiAgICBpdGVtUG9zaXRpb25pbmdDbGFzczogJ211dXJpLWl0ZW0tcG9zaXRpb25pbmcnLFxuICAgIGl0ZW1EcmFnZ2luZ0NsYXNzOiAnbXV1cmktaXRlbS1kcmFnZ2luZycsXG4gICAgaXRlbVJlbGVhc2luZ0NsYXNzOiAnbXV1cmktaXRlbS1yZWxlYXNpbmcnLFxuICAgIGl0ZW1QbGFjZWhvbGRlckNsYXNzOiAnbXV1cmktaXRlbS1wbGFjZWhvbGRlcidcbiAgfTtcblxuICAvKipcbiAgICogUHVibGljIHByb3RvdHlwZSBtZXRob2RzXG4gICAqICoqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogQmluZCBhbiBldmVudCBsaXN0ZW5lci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUub24gPSBmdW5jdGlvbihldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLl9lbWl0dGVyLm9uKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFVuYmluZCBhbiBldmVudCBsaXN0ZW5lci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5fZW1pdHRlci5vZmYoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogR2V0IHRoZSBjb250YWluZXIgZWxlbWVudC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHJldHVybnMge0hUTUxFbGVtZW50fVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGl0ZW1zLiBPcHRpb25hbGx5IHlvdSBjYW4gcHJvdmlkZSBzcGVjaWZpYyB0YXJnZXRzIChlbGVtZW50cyBhbmRcbiAgICogaW5kaWNlcykuIE5vdGUgdGhhdCB0aGUgcmV0dXJuZWQgYXJyYXkgaXMgbm90IHRoZSBzYW1lIG9iamVjdCB1c2VkIGJ5IHRoZVxuICAgKiBpbnN0YW5jZSBzbyBtb2RpZnlpbmcgaXQgd2lsbCBub3QgYWZmZWN0IGluc3RhbmNlJ3MgaXRlbXMuIEFsbCBpdGVtcyB0aGF0XG4gICAqIGFyZSBub3QgZm91bmQgYXJlIG9taXR0ZWQgZnJvbSB0aGUgcmV0dXJuZWQgYXJyYXkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7R3JpZE11bHRpSXRlbVF1ZXJ5fSBbdGFyZ2V0c11cbiAgICogQHJldHVybnMge0l0ZW1bXX1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLmdldEl0ZW1zID0gZnVuY3Rpb24odGFyZ2V0cykge1xuICAgIC8vIFJldHVybiBhbGwgaXRlbXMgaW1tZWRpYXRlbHkgaWYgbm8gdGFyZ2V0cyB3ZXJlIHByb3ZpZGVkIG9yIGlmIHRoZVxuICAgIC8vIGluc3RhbmNlIGlzIGRlc3Ryb3llZC5cbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgKCF0YXJnZXRzICYmIHRhcmdldHMgIT09IDApKSB7XG4gICAgICByZXR1cm4gdGhpcy5faXRlbXMuc2xpY2UoMCk7XG4gICAgfVxuXG4gICAgdmFyIHJldCA9IFtdO1xuICAgIHZhciB0YXJnZXRJdGVtcyA9IHRvQXJyYXkodGFyZ2V0cyk7XG4gICAgdmFyIGl0ZW07XG4gICAgdmFyIGk7XG5cbiAgICAvLyBJZiB0YXJnZXQgaXRlbXMgYXJlIGRlZmluZWQgcmV0dXJuIGZpbHRlcmVkIHJlc3VsdHMuXG4gICAgZm9yIChpID0gMDsgaSA8IHRhcmdldEl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpdGVtID0gdGhpcy5fZ2V0SXRlbSh0YXJnZXRJdGVtc1tpXSk7XG4gICAgICBpdGVtICYmIHJldC5wdXNoKGl0ZW0pO1xuICAgIH1cblxuICAgIHJldHVybiByZXQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY2FjaGVkIGRpbWVuc2lvbnMgb2YgdGhlIGluc3RhbmNlJ3MgaXRlbXMuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7R3JpZE11bHRpSXRlbVF1ZXJ5fSBbaXRlbXNdXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUucmVmcmVzaEl0ZW1zID0gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIHRhcmdldHMgPSB0aGlzLmdldEl0ZW1zKGl0ZW1zKTtcbiAgICB2YXIgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0YXJnZXRzW2ldLl9yZWZyZXNoRGltZW5zaW9ucygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHNvcnQgZGF0YSBvZiB0aGUgaW5zdGFuY2UncyBpdGVtcy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtHcmlkTXVsdGlJdGVtUXVlcnl9IFtpdGVtc11cbiAgICogQHJldHVybnMge0dyaWR9XG4gICAqL1xuICBHcmlkLnByb3RvdHlwZS5yZWZyZXNoU29ydERhdGEgPSBmdW5jdGlvbihpdGVtcykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0SXRlbXMgPSB0aGlzLmdldEl0ZW1zKGl0ZW1zKTtcbiAgICB2YXIgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCB0YXJnZXRJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGFyZ2V0SXRlbXNbaV0uX3JlZnJlc2hTb3J0RGF0YSgpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTeW5jaHJvbml6ZSB0aGUgaXRlbSBlbGVtZW50cyB0byBtYXRjaCB0aGUgb3JkZXIgb2YgdGhlIGl0ZW1zIGluIHRoZSBET00uXG4gICAqIFRoaXMgY29tZXMgaGFuZHkgaWYgeW91IG5lZWQgdG8ga2VlcCB0aGUgRE9NIHN0cnVjdHVyZSBtYXRjaGVkIHdpdGggdGhlXG4gICAqIG9yZGVyIG9mIHRoZSBpdGVtcy4gTm90ZSB0aGF0IGlmIGFuIGl0ZW0ncyBlbGVtZW50IGlzIG5vdCBjdXJyZW50bHkgYSBjaGlsZFxuICAgKiBvZiB0aGUgY29udGFpbmVyIGVsZW1lbnQgKGlmIGl0IGlzIGRyYWdnZWQgZm9yIGV4YW1wbGUpIGl0IGlzIGlnbm9yZWQgYW5kXG4gICAqIGxlZnQgdW50b3VjaGVkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7R3JpZH1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLnN5bmNocm9uaXplID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9lbGVtZW50O1xuICAgIHZhciBpdGVtcyA9IHRoaXMuX2l0ZW1zO1xuICAgIHZhciBmcmFnbWVudDtcbiAgICB2YXIgZWxlbWVudDtcbiAgICB2YXIgaTtcblxuICAgIC8vIEFwcGVuZCBhbGwgZWxlbWVudHMgaW4gb3JkZXIgdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50LlxuICAgIGlmIChpdGVtcy5sZW5ndGgpIHtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBlbGVtZW50ID0gaXRlbXNbaV0uX2VsZW1lbnQ7XG4gICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUgPT09IGNvbnRhaW5lcikge1xuICAgICAgICAgIGZyYWdtZW50ID0gZnJhZ21lbnQgfHwgd2luZG93LmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZnJhZ21lbnQpIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgfVxuXG4gICAgLy8gRW1pdCBzeW5jaHJvbml6ZSBldmVudC5cbiAgICB0aGlzLl9lbWl0KGV2ZW50U3luY2hyb25pemUpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBhbmQgYXBwbHkgaXRlbSBwb3NpdGlvbnMuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2luc3RhbnQ9ZmFsc2VdXG4gICAqIEBwYXJhbSB7TGF5b3V0Q2FsbGJhY2t9IFtvbkZpbmlzaF1cbiAgICogQHJldHVybnMge0dyaWR9XG4gICAqL1xuICBHcmlkLnByb3RvdHlwZS5sYXlvdXQgPSBmdW5jdGlvbihpbnN0YW50LCBvbkZpbmlzaCkge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaW5zdCA9IHRoaXM7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuICAgIHZhciBsYXlvdXQgPSB0aGlzLl91cGRhdGVMYXlvdXQoKTtcbiAgICB2YXIgbGF5b3V0SWQgPSBsYXlvdXQuaWQ7XG4gICAgdmFyIGl0ZW1zTGVuZ3RoID0gbGF5b3V0Lml0ZW1zLmxlbmd0aDtcbiAgICB2YXIgY291bnRlciA9IGl0ZW1zTGVuZ3RoO1xuICAgIHZhciBpc0JvcmRlckJveDtcbiAgICB2YXIgaXRlbTtcbiAgICB2YXIgaTtcblxuICAgIC8vIFRoZSBmaW5pc2ggZnVuY3Rpb24sIHdoaWNoIHdpbGwgYmUgdXNlZCBmb3IgY2hlY2tpbmcgaWYgYWxsIHRoZSBpdGVtc1xuICAgIC8vIGhhdmUgbGFpZCBvdXQgeWV0LiBBZnRlciBhbGwgaXRlbXMgaGF2ZSBmaW5pc2hlZCB0aGVpciBhbmltYXRpb25zIGNhbGxcbiAgICAvLyBjYWxsYmFjayBhbmQgZW1pdCBsYXlvdXRFbmQgZXZlbnQuIE9ubHkgZW1pdCBsYXlvdXRFbmQgZXZlbnQgaWYgdGhlcmVcbiAgICAvLyBoYXNuJ3QgYmVlbiBhIG5ldyBsYXlvdXQgY2FsbCBkdXJpbmcgdGhpcyBsYXlvdXQuXG4gICAgZnVuY3Rpb24gdHJ5RmluaXNoKCkge1xuICAgICAgaWYgKC0tY291bnRlciA+IDApIHJldHVybjtcblxuICAgICAgdmFyIGhhc0xheW91dENoYW5nZWQgPSBpbnN0Ll9sYXlvdXQuaWQgIT09IGxheW91dElkO1xuICAgICAgdmFyIGNhbGxiYWNrID0gaXNGdW5jdGlvbihpbnN0YW50KSA/IGluc3RhbnQgOiBvbkZpbmlzaDtcblxuICAgICAgaWYgKGlzRnVuY3Rpb24oY2FsbGJhY2spKSB7XG4gICAgICAgIGNhbGxiYWNrKGhhc0xheW91dENoYW5nZWQsIGxheW91dC5pdGVtcy5zbGljZSgwKSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzTGF5b3V0Q2hhbmdlZCAmJiBpbnN0Ll9oYXNMaXN0ZW5lcnMoZXZlbnRMYXlvdXRFbmQpKSB7XG4gICAgICAgIGluc3QuX2VtaXQoZXZlbnRMYXlvdXRFbmQsIGxheW91dC5pdGVtcy5zbGljZSgwKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgZ3JpZCdzIHdpZHRoIG9yIGhlaWdodCB3YXMgbW9kaWZpZWQsIHdlIG5lZWQgdG8gdXBkYXRlIGl0J3MgY2FjaGVkXG4gICAgLy8gZGltZW5zaW9ucy4gQWxzbyBrZWVwIGluIG1pbmQgdGhhdCBncmlkJ3MgY2FjaGVkIHdpZHRoL2hlaWdodCBzaG91bGRcbiAgICAvLyBhbHdheXMgZXF1YWwgdG8gd2hhdCBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIHdvdWxkIHJldHVybiwgc29cbiAgICAvLyB0aGVyZWZvcmUgd2UgbmVlZCB0byBhZGQgdGhlIGdyaWQgZWxlbWVudCdzIGJvcmRlcnMgdG8gdGhlIGRpbWVuc2lvbnMgaWZcbiAgICAvLyBpdCdzIGJveC1zaXppbmcgaXMgYm9yZGVyLWJveC4gTm90ZSB0aGF0IHdlIHN1cHBvcnQgcHJvdmlkaW5nIHRoZVxuICAgIC8vIGRpbWVuc2lvbnMgYXMgYSBzdHJpbmcgaGVyZSB0b28gc28gdGhhdCBvbmUgY2FuIGRlZmluZSB0aGUgdW5pdCBvZiB0aGVcbiAgICAvLyBkaW1lbnNpb25zLCBpbiB3aGljaCBjYXNlIHdlIGRvbid0IGRvIHRoZSBib3JkZXItYm94IGNoZWNrLlxuICAgIGlmIChcbiAgICAgIChsYXlvdXQuc2V0SGVpZ2h0ICYmIHR5cGVvZiBsYXlvdXQuaGVpZ2h0ID09PSBudW1iZXJUeXBlJDEpIHx8XG4gICAgICAobGF5b3V0LnNldFdpZHRoICYmIHR5cGVvZiBsYXlvdXQud2lkdGggPT09IG51bWJlclR5cGUkMSlcbiAgICApIHtcbiAgICAgIGlzQm9yZGVyQm94ID0gZ2V0U3R5bGUoZWxlbWVudCwgJ2JveC1zaXppbmcnKSA9PT0gJ2JvcmRlci1ib3gnO1xuICAgIH1cbiAgICBpZiAobGF5b3V0LnNldEhlaWdodCkge1xuICAgICAgaWYgKHR5cGVvZiBsYXlvdXQuaGVpZ2h0ID09PSBudW1iZXJUeXBlJDEpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPVxuICAgICAgICAgIChpc0JvcmRlckJveCA/IGxheW91dC5oZWlnaHQgKyB0aGlzLl9ib3JkZXJUb3AgKyB0aGlzLl9ib3JkZXJCb3R0b20gOiBsYXlvdXQuaGVpZ2h0KSArICdweCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9IGxheW91dC5oZWlnaHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsYXlvdXQuc2V0V2lkdGgpIHtcbiAgICAgIGlmICh0eXBlb2YgbGF5b3V0LndpZHRoID09PSBudW1iZXJUeXBlJDEpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9XG4gICAgICAgICAgKGlzQm9yZGVyQm94ID8gbGF5b3V0LndpZHRoICsgdGhpcy5fYm9yZGVyTGVmdCArIHRoaXMuX2JvcmRlclJpZ2h0IDogbGF5b3V0LndpZHRoKSArICdweCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gbGF5b3V0LndpZHRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVtaXQgbGF5b3V0U3RhcnQgZXZlbnQuIE5vdGUgdGhhdCB0aGlzIGlzIGludGVudGlvbmFsbHkgZW1pdHRlZCBhZnRlciB0aGVcbiAgICAvLyBjb250YWluZXIgZWxlbWVudCdzIGRpbWVuc2lvbnMgYXJlIHNldCwgYmVjYXVzZSBvdGhlcndpc2UgdGhlcmUgd291bGQgYmVcbiAgICAvLyBubyBob29rIGZvciByZWFjdGluZyB0byBjb250YWluZXIgZGltZW5zaW9uIGNoYW5nZXMuXG4gICAgaWYgKHRoaXMuX2hhc0xpc3RlbmVycyhldmVudExheW91dFN0YXJ0KSkge1xuICAgICAgdGhpcy5fZW1pdChldmVudExheW91dFN0YXJ0LCBsYXlvdXQuaXRlbXMuc2xpY2UoMCkpO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlIGFyZSBubyBpdGVtcyBsZXQncyBmaW5pc2ggcXVpY2tseS5cbiAgICBpZiAoIWl0ZW1zTGVuZ3RoKSB7XG4gICAgICB0cnlGaW5pc2goKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlIGFyZSBpdGVtcyBsZXQncyBwb3NpdGlvbiB0aGVtLlxuICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtc0xlbmd0aDsgaSsrKSB7XG4gICAgICBpdGVtID0gbGF5b3V0Lml0ZW1zW2ldO1xuICAgICAgaWYgKCFpdGVtKSBjb250aW51ZTtcblxuICAgICAgLy8gVXBkYXRlIGl0ZW0ncyBwb3NpdGlvbi5cbiAgICAgIGl0ZW0uX2xlZnQgPSBsYXlvdXQuc2xvdHNbaSAqIDJdO1xuICAgICAgaXRlbS5fdG9wID0gbGF5b3V0LnNsb3RzW2kgKiAyICsgMV07XG5cbiAgICAgIC8vIExheW91dCBpdGVtIGlmIGl0IGlzIG5vdCBkcmFnZ2VkLlxuICAgICAgaXRlbS5pc0RyYWdnaW5nKCkgPyB0cnlGaW5pc2goKSA6IGl0ZW0uX2xheW91dC5zdGFydChpbnN0YW50ID09PSB0cnVlLCB0cnlGaW5pc2gpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBBZGQgbmV3IGl0ZW1zIGJ5IHByb3ZpZGluZyB0aGUgZWxlbWVudHMgeW91IHdpc2ggdG8gYWRkIHRvIHRoZSBpbnN0YW5jZSBhbmRcbiAgICogb3B0aW9uYWxseSBwcm92aWRlIHRoZSBpbmRleCB3aGVyZSB5b3Ugd2FudCB0aGUgaXRlbXMgdG8gYmUgaW5zZXJ0ZWQgaW50by5cbiAgICogQWxsIGVsZW1lbnRzIHRoYXQgYXJlIG5vdCBhbHJlYWR5IGNoaWxkcmVuIG9mIHRoZSBjb250YWluZXIgZWxlbWVudCB3aWxsIGJlXG4gICAqIGF1dG9tYXRpY2FsbHkgYXBwZW5kZWQgdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50LiBJZiBhbiBlbGVtZW50IGhhcyBpdCdzIENTU1xuICAgKiBkaXNwbGF5IHByb3BlcnR5IHNldCB0byBcIm5vbmVcIiBpdCB3aWxsIGJlIG1hcmtlZCBhcyBpbmFjdGl2ZSBkdXJpbmcgdGhlXG4gICAqIGluaXRpYXRpb24gcHJvY2Vzcy4gQXMgbG9uZyBhcyB0aGUgaXRlbSBpcyBpbmFjdGl2ZSBpdCB3aWxsIG5vdCBiZSBwYXJ0IG9mXG4gICAqIHRoZSBsYXlvdXQsIGJ1dCBpdCB3aWxsIHJldGFpbiBpdCdzIGluZGV4LiBZb3UgY2FuIGFjdGl2YXRlIGl0ZW1zIGF0IGFueVxuICAgKiBwb2ludCB3aXRoIGdyaWQuc2hvdygpIG1ldGhvZC4gVGhpcyBtZXRob2Qgd2lsbCBhdXRvbWF0aWNhbGx5IGNhbGxcbiAgICogZ3JpZC5sYXlvdXQoKSBpZiBvbmUgb3IgbW9yZSBvZiB0aGUgYWRkZWQgZWxlbWVudHMgYXJlIHZpc2libGUuIElmIG9ubHlcbiAgICogaGlkZGVuIGl0ZW1zIGFyZSBhZGRlZCBubyBsYXlvdXQgd2lsbCBiZSBjYWxsZWQuIEFsbCB0aGUgbmV3IHZpc2libGUgaXRlbXNcbiAgICogYXJlIHBvc2l0aW9uZWQgd2l0aG91dCBhbmltYXRpb24gZHVyaW5nIHRoZWlyIGZpcnN0IGxheW91dC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHsoSFRNTEVsZW1lbnR8SFRNTEVsZW1lbnRbXSl9IGVsZW1lbnRzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmluZGV4PS0xXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmlzQWN0aXZlXVxuICAgKiBAcGFyYW0geyhCb29sZWFufExheW91dENhbGxiYWNrfFN0cmluZyl9IFtvcHRpb25zLmxheW91dD10cnVlXVxuICAgKiBAcmV0dXJucyB7SXRlbVtdfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oZWxlbWVudHMsIG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgIWVsZW1lbnRzKSByZXR1cm4gW107XG5cbiAgICB2YXIgbmV3SXRlbXMgPSB0b0FycmF5KGVsZW1lbnRzKTtcbiAgICBpZiAoIW5ld0l0ZW1zLmxlbmd0aCkgcmV0dXJuIG5ld0l0ZW1zO1xuXG4gICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IDA7XG4gICAgdmFyIGxheW91dCA9IG9wdHMubGF5b3V0ID8gb3B0cy5sYXlvdXQgOiBvcHRzLmxheW91dCA9PT0gdW5kZWZpbmVkO1xuICAgIHZhciBpdGVtcyA9IHRoaXMuX2l0ZW1zO1xuICAgIHZhciBuZWVkc0xheW91dCA9IGZhbHNlO1xuICAgIHZhciBpdGVtO1xuICAgIHZhciBpO1xuXG4gICAgLy8gTWFwIHByb3ZpZGVkIGVsZW1lbnRzIGludG8gbmV3IGdyaWQgaXRlbXMuXG4gICAgZm9yIChpID0gMDsgaSA8IG5ld0l0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpdGVtID0gbmV3IEl0ZW0odGhpcywgbmV3SXRlbXNbaV0sIG9wdHMuaXNBY3RpdmUpO1xuICAgICAgbmV3SXRlbXNbaV0gPSBpdGVtO1xuXG4gICAgICAvLyBJZiB0aGUgaXRlbSB0byBiZSBhZGRlZCBpcyBhY3RpdmUsIHdlIG5lZWQgdG8gZG8gYSBsYXlvdXQuIEFsc28sIHdlXG4gICAgICAvLyBuZWVkIHRvIG1hcmsgdGhlIGl0ZW0gd2l0aCB0aGUgc2tpcE5leHRBbmltYXRpb24gZmxhZyB0byBtYWtlIGl0XG4gICAgICAvLyBwb3NpdGlvbiBpbnN0YW50bHkgKHdpdGhvdXQgYW5pbWF0aW9uKSBkdXJpbmcgdGhlIG5leHQgbGF5b3V0LiBXaXRob3V0XG4gICAgICAvLyB0aGUgaGFjayB0aGUgaXRlbSB3b3VsZCBhbmltYXRlIHRvIGl0J3MgbmV3IHBvc2l0aW9uIGZyb20gdGhlIG5vcnRod2VzdFxuICAgICAgLy8gY29ybmVyIG9mIHRoZSBncmlkLCB3aGljaCBmZWVscyBhIGJpdCBidWdneSAoaW1obykuXG4gICAgICBpZiAoaXRlbS5faXNBY3RpdmUpIHtcbiAgICAgICAgbmVlZHNMYXlvdXQgPSB0cnVlO1xuICAgICAgICBpdGVtLl9sYXlvdXQuX3NraXBOZXh0QW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgdGhlIG5ldyBpdGVtcyB0byB0aGUgaXRlbXMgY29sbGVjdGlvbiB0byBjb3JyZWN0IGluZGV4LlxuICAgIGFycmF5SW5zZXJ0KGl0ZW1zLCBuZXdJdGVtcywgb3B0cy5pbmRleCk7XG5cbiAgICAvLyBFbWl0IGFkZCBldmVudC5cbiAgICBpZiAodGhpcy5faGFzTGlzdGVuZXJzKGV2ZW50QWRkKSkge1xuICAgICAgdGhpcy5fZW1pdChldmVudEFkZCwgbmV3SXRlbXMuc2xpY2UoMCkpO1xuICAgIH1cblxuICAgIC8vIElmIGxheW91dCBpcyBuZWVkZWQuXG4gICAgaWYgKG5lZWRzTGF5b3V0ICYmIGxheW91dCkge1xuICAgICAgdGhpcy5sYXlvdXQobGF5b3V0ID09PSBpbnN0YW50TGF5b3V0LCBpc0Z1bmN0aW9uKGxheW91dCkgPyBsYXlvdXQgOiB1bmRlZmluZWQpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdJdGVtcztcbiAgfTtcblxuICAvKipcbiAgICogUmVtb3ZlIGl0ZW1zIGZyb20gdGhlIGluc3RhbmNlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWRNdWx0aUl0ZW1RdWVyeX0gaXRlbXNcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnJlbW92ZUVsZW1lbnRzPWZhbHNlXVxuICAgKiBAcGFyYW0geyhCb29sZWFufExheW91dENhbGxiYWNrfFN0cmluZyl9IFtvcHRpb25zLmxheW91dD10cnVlXVxuICAgKiBAcmV0dXJucyB7SXRlbVtdfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaXRlbXMsIG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IDA7XG4gICAgdmFyIGxheW91dCA9IG9wdHMubGF5b3V0ID8gb3B0cy5sYXlvdXQgOiBvcHRzLmxheW91dCA9PT0gdW5kZWZpbmVkO1xuICAgIHZhciBuZWVkc0xheW91dCA9IGZhbHNlO1xuICAgIHZhciBhbGxJdGVtcyA9IHRoaXMuZ2V0SXRlbXMoKTtcbiAgICB2YXIgdGFyZ2V0SXRlbXMgPSB0aGlzLmdldEl0ZW1zKGl0ZW1zKTtcbiAgICB2YXIgaW5kaWNlcyA9IFtdO1xuICAgIHZhciBpdGVtO1xuICAgIHZhciBpO1xuXG4gICAgLy8gUmVtb3ZlIHRoZSBpbmRpdmlkdWFsIGl0ZW1zLlxuICAgIGZvciAoaSA9IDA7IGkgPCB0YXJnZXRJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgaXRlbSA9IHRhcmdldEl0ZW1zW2ldO1xuICAgICAgaW5kaWNlcy5wdXNoKGFsbEl0ZW1zLmluZGV4T2YoaXRlbSkpO1xuICAgICAgaWYgKGl0ZW0uX2lzQWN0aXZlKSBuZWVkc0xheW91dCA9IHRydWU7XG4gICAgICBpdGVtLl9kZXN0cm95KG9wdHMucmVtb3ZlRWxlbWVudHMpO1xuICAgIH1cblxuICAgIC8vIEVtaXQgcmVtb3ZlIGV2ZW50LlxuICAgIGlmICh0aGlzLl9oYXNMaXN0ZW5lcnMoZXZlbnRSZW1vdmUpKSB7XG4gICAgICB0aGlzLl9lbWl0KGV2ZW50UmVtb3ZlLCB0YXJnZXRJdGVtcy5zbGljZSgwKSwgaW5kaWNlcyk7XG4gICAgfVxuXG4gICAgLy8gSWYgbGF5b3V0IGlzIG5lZWRlZC5cbiAgICBpZiAobmVlZHNMYXlvdXQgJiYgbGF5b3V0KSB7XG4gICAgICB0aGlzLmxheW91dChsYXlvdXQgPT09IGluc3RhbnRMYXlvdXQsIGlzRnVuY3Rpb24obGF5b3V0KSA/IGxheW91dCA6IHVuZGVmaW5lZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldEl0ZW1zO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTaG93IGluc3RhbmNlIGl0ZW1zLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWRNdWx0aUl0ZW1RdWVyeX0gaXRlbXNcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmluc3RhbnQ9ZmFsc2VdXG4gICAqIEBwYXJhbSB7U2hvd0NhbGxiYWNrfSBbb3B0aW9ucy5vbkZpbmlzaF1cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxMYXlvdXRDYWxsYmFja3xTdHJpbmcpfSBbb3B0aW9ucy5sYXlvdXQ9dHJ1ZV1cbiAgICogQHJldHVybnMge0dyaWR9XG4gICAqL1xuICBHcmlkLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oaXRlbXMsIG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybiB0aGlzO1xuICAgIHRoaXMuX3NldEl0ZW1zVmlzaWJpbGl0eShpdGVtcywgdHJ1ZSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhpZGUgaW5zdGFuY2UgaXRlbXMuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7R3JpZE11bHRpSXRlbVF1ZXJ5fSBpdGVtc1xuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaW5zdGFudD1mYWxzZV1cbiAgICogQHBhcmFtIHtIaWRlQ2FsbGJhY2t9IFtvcHRpb25zLm9uRmluaXNoXVxuICAgKiBAcGFyYW0geyhCb29sZWFufExheW91dENhbGxiYWNrfFN0cmluZyl9IFtvcHRpb25zLmxheW91dD10cnVlXVxuICAgKiBAcmV0dXJucyB7R3JpZH1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbihpdGVtcywgb3B0aW9ucykge1xuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCkgcmV0dXJuIHRoaXM7XG4gICAgdGhpcy5fc2V0SXRlbXNWaXNpYmlsaXR5KGl0ZW1zLCBmYWxzZSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEZpbHRlciBpdGVtcy4gRXhwZWN0cyBhdCBsZWFzdCBvbmUgYXJndW1lbnQsIGEgcHJlZGljYXRlLCB3aGljaCBzaG91bGQgYmVcbiAgICogZWl0aGVyIGEgZnVuY3Rpb24gb3IgYSBzdHJpbmcuIFRoZSBwcmVkaWNhdGUgY2FsbGJhY2sgaXMgZXhlY3V0ZWQgZm9yIGV2ZXJ5XG4gICAqIGl0ZW0gaW4gdGhlIGluc3RhbmNlLiBJZiB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBwcmVkaWNhdGUgaXMgdHJ1dGh5IHRoZVxuICAgKiBpdGVtIGluIHF1ZXN0aW9uIHdpbGwgYmUgc2hvd24gYW5kIG90aGVyd2lzZSBoaWRkZW4uIFRoZSBwcmVkaWNhdGUgY2FsbGJhY2tcbiAgICogcmVjZWl2ZXMgdGhlIGl0ZW0gaW5zdGFuY2UgYXMgaXQncyBhcmd1bWVudC4gSWYgdGhlIHByZWRpY2F0ZSBpcyBhIHN0cmluZ1xuICAgKiBpdCBpcyBjb25zaWRlcmVkIHRvIGJlIGEgc2VsZWN0b3IgYW5kIGl0IGlzIGNoZWNrZWQgYWdhaW5zdCBldmVyeSBpdGVtXG4gICAqIGVsZW1lbnQgaW4gdGhlIGluc3RhbmNlIHdpdGggdGhlIG5hdGl2ZSBlbGVtZW50Lm1hdGNoZXMoKSBtZXRob2QuIEFsbCB0aGVcbiAgICogbWF0Y2hpbmcgaXRlbXMgd2lsbCBiZSBzaG93biBhbmQgb3RoZXJzIGhpZGRlbi5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHsoRnVuY3Rpb258U3RyaW5nKX0gcHJlZGljYXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5pbnN0YW50PWZhbHNlXVxuICAgKiBAcGFyYW0ge0ZpbHRlckNhbGxiYWNrfSBbb3B0aW9ucy5vbkZpbmlzaF1cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxMYXlvdXRDYWxsYmFja3xTdHJpbmcpfSBbb3B0aW9ucy5sYXlvdXQ9dHJ1ZV1cbiAgICogQHJldHVybnMge0dyaWR9XG4gICAqL1xuICBHcmlkLnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbihwcmVkaWNhdGUsIG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgIXRoaXMuX2l0ZW1zLmxlbmd0aCkgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaXRlbXNUb1Nob3cgPSBbXTtcbiAgICB2YXIgaXRlbXNUb0hpZGUgPSBbXTtcbiAgICB2YXIgaXNQcmVkaWNhdGVTdHJpbmcgPSB0eXBlb2YgcHJlZGljYXRlID09PSBzdHJpbmdUeXBlO1xuICAgIHZhciBpc1ByZWRpY2F0ZUZuID0gaXNGdW5jdGlvbihwcmVkaWNhdGUpO1xuICAgIHZhciBvcHRzID0gb3B0aW9ucyB8fCAwO1xuICAgIHZhciBpc0luc3RhbnQgPSBvcHRzLmluc3RhbnQgPT09IHRydWU7XG4gICAgdmFyIGxheW91dCA9IG9wdHMubGF5b3V0ID8gb3B0cy5sYXlvdXQgOiBvcHRzLmxheW91dCA9PT0gdW5kZWZpbmVkO1xuICAgIHZhciBvbkZpbmlzaCA9IGlzRnVuY3Rpb24ob3B0cy5vbkZpbmlzaCkgPyBvcHRzLm9uRmluaXNoIDogbnVsbDtcbiAgICB2YXIgdHJ5RmluaXNoQ291bnRlciA9IC0xO1xuICAgIHZhciB0cnlGaW5pc2ggPSBub29wO1xuICAgIHZhciBpdGVtO1xuICAgIHZhciBpO1xuXG4gICAgLy8gSWYgd2UgaGF2ZSBvbkZpbmlzaCBjYWxsYmFjaywgbGV0J3MgY3JlYXRlIHByb3BlciB0cnlGaW5pc2ggY2FsbGJhY2suXG4gICAgaWYgKG9uRmluaXNoKSB7XG4gICAgICB0cnlGaW5pc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgKyt0cnlGaW5pc2hDb3VudGVyICYmIG9uRmluaXNoKGl0ZW1zVG9TaG93LnNsaWNlKDApLCBpdGVtc1RvSGlkZS5zbGljZSgwKSk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIHdoaWNoIGl0ZW1zIG5lZWQgdG8gYmUgc2hvd24gYW5kIHdoaWNoIGhpZGRlbi5cbiAgICBpZiAoaXNQcmVkaWNhdGVGbiB8fCBpc1ByZWRpY2F0ZVN0cmluZykge1xuICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuX2l0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtc1tpXTtcbiAgICAgICAgaWYgKGlzUHJlZGljYXRlRm4gPyBwcmVkaWNhdGUoaXRlbSkgOiBlbGVtZW50TWF0Y2hlcyhpdGVtLl9lbGVtZW50LCBwcmVkaWNhdGUpKSB7XG4gICAgICAgICAgaXRlbXNUb1Nob3cucHVzaChpdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtc1RvSGlkZS5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2hvdyBpdGVtcyB0aGF0IG5lZWQgdG8gYmUgc2hvd24uXG4gICAgaWYgKGl0ZW1zVG9TaG93Lmxlbmd0aCkge1xuICAgICAgdGhpcy5zaG93KGl0ZW1zVG9TaG93LCB7XG4gICAgICAgIGluc3RhbnQ6IGlzSW5zdGFudCxcbiAgICAgICAgb25GaW5pc2g6IHRyeUZpbmlzaCxcbiAgICAgICAgbGF5b3V0OiBmYWxzZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyeUZpbmlzaCgpO1xuICAgIH1cblxuICAgIC8vIEhpZGUgaXRlbXMgdGhhdCBuZWVkIHRvIGJlIGhpZGRlbi5cbiAgICBpZiAoaXRlbXNUb0hpZGUubGVuZ3RoKSB7XG4gICAgICB0aGlzLmhpZGUoaXRlbXNUb0hpZGUsIHtcbiAgICAgICAgaW5zdGFudDogaXNJbnN0YW50LFxuICAgICAgICBvbkZpbmlzaDogdHJ5RmluaXNoLFxuICAgICAgICBsYXlvdXQ6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5RmluaXNoKCk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlcmUgYXJlIGFueSBpdGVtcyB0byBmaWx0ZXIuXG4gICAgaWYgKGl0ZW1zVG9TaG93Lmxlbmd0aCB8fCBpdGVtc1RvSGlkZS5sZW5ndGgpIHtcbiAgICAgIC8vIEVtaXQgZmlsdGVyIGV2ZW50LlxuICAgICAgaWYgKHRoaXMuX2hhc0xpc3RlbmVycyhldmVudEZpbHRlcikpIHtcbiAgICAgICAgdGhpcy5fZW1pdChldmVudEZpbHRlciwgaXRlbXNUb1Nob3cuc2xpY2UoMCksIGl0ZW1zVG9IaWRlLnNsaWNlKDApKTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgbGF5b3V0IGlzIG5lZWRlZC5cbiAgICAgIGlmIChsYXlvdXQpIHtcbiAgICAgICAgdGhpcy5sYXlvdXQobGF5b3V0ID09PSBpbnN0YW50TGF5b3V0LCBpc0Z1bmN0aW9uKGxheW91dCkgPyBsYXlvdXQgOiB1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTb3J0IGl0ZW1zLiBUaGVyZSBhcmUgdGhyZWUgd2F5cyB0byBzb3J0IHRoZSBpdGVtcy4gVGhlIGZpcnN0IGlzIHNpbXBseSBieVxuICAgKiBwcm92aWRpbmcgYSBmdW5jdGlvbiBhcyB0aGUgY29tcGFyZXIgd2hpY2ggd29ya3MgaWRlbnRpY2FsbHkgdG8gbmF0aXZlXG4gICAqIGFycmF5IHNvcnQuIEFsdGVybmF0aXZlbHkgeW91IGNhbiBzb3J0IGJ5IHRoZSBzb3J0IGRhdGEgeW91IGhhdmUgcHJvdmlkZWRcbiAgICogaW4gdGhlIGluc3RhbmNlJ3Mgb3B0aW9ucy4gSnVzdCBwcm92aWRlIHRoZSBzb3J0IGRhdGEga2V5KHMpIGFzIGEgc3RyaW5nXG4gICAqIChzZXBhcmF0ZWQgYnkgc3BhY2UpIGFuZCB0aGUgaXRlbXMgd2lsbCBiZSBzb3J0ZWQgYmFzZWQgb24gdGhlIHByb3ZpZGVkXG4gICAqIHNvcnQgZGF0YSBrZXlzLiBMYXN0bHkgeW91IGhhdmUgdGhlIG9wcG9ydHVuaXR5IHRvIHByb3ZpZGUgYSBwcmVzb3J0ZWRcbiAgICogYXJyYXkgb2YgaXRlbXMgd2hpY2ggd2lsbCBiZSB1c2VkIHRvIHN5bmMgdGhlIGludGVybmFsIGl0ZW1zIGFycmF5IGluIHRoZVxuICAgKiBzYW1lIG9yZGVyLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0geyhGdW5jdGlvbnxJdGVtW118U3RyaW5nfFN0cmluZ1tdKX0gY29tcGFyZXJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmRlc2NlbmRpbmc9ZmFsc2VdXG4gICAqIEBwYXJhbSB7KEJvb2xlYW58TGF5b3V0Q2FsbGJhY2t8U3RyaW5nKX0gW29wdGlvbnMubGF5b3V0PXRydWVdXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuc29ydCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgc29ydENvbXBhcmVyO1xuICAgIHZhciBpc0Rlc2NlbmRpbmc7XG4gICAgdmFyIG9yaWdJdGVtcztcbiAgICB2YXIgaW5kZXhNYXA7XG5cbiAgICBmdW5jdGlvbiBwYXJzZUNyaXRlcmlhKGRhdGEpIHtcbiAgICAgIHJldHVybiBkYXRhXG4gICAgICAgIC50cmltKClcbiAgICAgICAgLnNwbGl0KCcgJylcbiAgICAgICAgLm1hcChmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICByZXR1cm4gdmFsLnNwbGl0KCc6Jyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEluZGV4TWFwKGl0ZW1zKSB7XG4gICAgICB2YXIgcmV0ID0ge307XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJldFtpdGVtc1tpXS5faWRdID0gaTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29tcGFyZUluZGljZXMoaXRlbUEsIGl0ZW1CKSB7XG4gICAgICB2YXIgaW5kZXhBID0gaW5kZXhNYXBbaXRlbUEuX2lkXTtcbiAgICAgIHZhciBpbmRleEIgPSBpbmRleE1hcFtpdGVtQi5faWRdO1xuICAgICAgcmV0dXJuIGlzRGVzY2VuZGluZyA/IGluZGV4QiAtIGluZGV4QSA6IGluZGV4QSAtIGluZGV4QjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWZhdWx0Q29tcGFyZXIoYSwgYikge1xuICAgICAgdmFyIHJlc3VsdCA9IDA7XG4gICAgICB2YXIgY3JpdGVyaWFOYW1lO1xuICAgICAgdmFyIGNyaXRlcmlhT3JkZXI7XG4gICAgICB2YXIgdmFsQTtcbiAgICAgIHZhciB2YWxCO1xuXG4gICAgICAvLyBMb29wIHRocm91Z2ggdGhlIGxpc3Qgb2Ygc29ydCBjcml0ZXJpYS5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc29ydENvbXBhcmVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIEdldCB0aGUgY3JpdGVyaWEgbmFtZSwgd2hpY2ggc2hvdWxkIG1hdGNoIGFuIGl0ZW0ncyBzb3J0IGRhdGEga2V5LlxuICAgICAgICBjcml0ZXJpYU5hbWUgPSBzb3J0Q29tcGFyZXJbaV1bMF07XG4gICAgICAgIGNyaXRlcmlhT3JkZXIgPSBzb3J0Q29tcGFyZXJbaV1bMV07XG5cbiAgICAgICAgLy8gR2V0IGl0ZW1zJyBjYWNoZWQgc29ydCB2YWx1ZXMgZm9yIHRoZSBjcml0ZXJpYS4gSWYgdGhlIGl0ZW0gaGFzIG5vIHNvcnRcbiAgICAgICAgLy8gZGF0YSBsZXQncyB1cGRhdGUgdGhlIGl0ZW1zIHNvcnQgZGF0YSAodGhpcyBpcyBhIGxhenkgbG9hZCBtZWNoYW5pc20pLlxuICAgICAgICB2YWxBID0gKGEuX3NvcnREYXRhID8gYSA6IGEuX3JlZnJlc2hTb3J0RGF0YSgpKS5fc29ydERhdGFbY3JpdGVyaWFOYW1lXTtcbiAgICAgICAgdmFsQiA9IChiLl9zb3J0RGF0YSA/IGIgOiBiLl9yZWZyZXNoU29ydERhdGEoKSkuX3NvcnREYXRhW2NyaXRlcmlhTmFtZV07XG5cbiAgICAgICAgLy8gU29ydCB0aGUgaXRlbXMgaW4gZGVzY2VuZGluZyBvcmRlciBpZiBkZWZpbmVkIHNvIGV4cGxpY2l0bHkuIE90aGVyd2lzZVxuICAgICAgICAvLyBzb3J0IGl0ZW1zIGluIGFzY2VuZGluZyBvcmRlci5cbiAgICAgICAgaWYgKGNyaXRlcmlhT3JkZXIgPT09ICdkZXNjJyB8fCAoIWNyaXRlcmlhT3JkZXIgJiYgaXNEZXNjZW5kaW5nKSkge1xuICAgICAgICAgIHJlc3VsdCA9IHZhbEIgPCB2YWxBID8gLTEgOiB2YWxCID4gdmFsQSA/IDEgOiAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdCA9IHZhbEEgPCB2YWxCID8gLTEgOiB2YWxBID4gdmFsQiA/IDEgOiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgd2UgaGF2ZSAtMSBvciAxIGFzIHRoZSByZXR1cm4gdmFsdWUsIGxldCdzIHJldHVybiBpdCBpbW1lZGlhdGVseS5cbiAgICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgdmFsdWVzIGFyZSBlcXVhbCBsZXQncyBjb21wYXJlIHRoZSBpdGVtIGluZGljZXMgdG8gbWFrZSBzdXJlIHdlXG4gICAgICAvLyBoYXZlIGEgc3RhYmxlIHNvcnQuXG4gICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICBpZiAoIWluZGV4TWFwKSBpbmRleE1hcCA9IGdldEluZGV4TWFwKG9yaWdJdGVtcyk7XG4gICAgICAgIHJlc3VsdCA9IGNvbXBhcmVJbmRpY2VzKGEsIGIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjdXN0b21Db21wYXJlcihhLCBiKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gc29ydENvbXBhcmVyKGEsIGIpO1xuICAgICAgLy8gSWYgZGVzY2VuZGluZyBsZXQncyBpbnZlcnQgdGhlIHJlc3VsdCB2YWx1ZS5cbiAgICAgIGlmIChpc0Rlc2NlbmRpbmcgJiYgcmVzdWx0KSByZXN1bHQgPSAtcmVzdWx0O1xuICAgICAgLy8gSWYgd2UgaGF2ZSBhIHZhbGlkIHJlc3VsdCAobm90IHplcm8pIGxldCdzIHJldHVybiBpdCByaWdodCBhd2F5LlxuICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgICAgIC8vIElmIHJlc3VsdCBpcyB6ZXJvIGxldCdzIGNvbXBhcmUgdGhlIGl0ZW0gaW5kaWNlcyB0byBtYWtlIHN1cmUgd2UgaGF2ZSBhXG4gICAgICAvLyBzdGFibGUgc29ydC5cbiAgICAgIGlmICghaW5kZXhNYXApIGluZGV4TWFwID0gZ2V0SW5kZXhNYXAob3JpZ0l0ZW1zKTtcbiAgICAgIHJldHVybiBjb21wYXJlSW5kaWNlcyhhLCBiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oY29tcGFyZXIsIG9wdGlvbnMpIHtcbiAgICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCB8fCB0aGlzLl9pdGVtcy5sZW5ndGggPCAyKSByZXR1cm4gdGhpcztcblxuICAgICAgdmFyIGl0ZW1zID0gdGhpcy5faXRlbXM7XG4gICAgICB2YXIgb3B0cyA9IG9wdGlvbnMgfHwgMDtcbiAgICAgIHZhciBsYXlvdXQgPSBvcHRzLmxheW91dCA/IG9wdHMubGF5b3V0IDogb3B0cy5sYXlvdXQgPT09IHVuZGVmaW5lZDtcbiAgICAgIHZhciBpO1xuXG4gICAgICAvLyBTZXR1cCBwYXJlbnQgc2NvcGUgZGF0YS5cbiAgICAgIHNvcnRDb21wYXJlciA9IGNvbXBhcmVyO1xuICAgICAgaXNEZXNjZW5kaW5nID0gISFvcHRzLmRlc2NlbmRpbmc7XG4gICAgICBvcmlnSXRlbXMgPSBpdGVtcy5zbGljZSgwKTtcbiAgICAgIGluZGV4TWFwID0gbnVsbDtcblxuICAgICAgLy8gSWYgZnVuY3Rpb24gaXMgcHJvdmlkZWQgZG8gYSBuYXRpdmUgYXJyYXkgc29ydC5cbiAgICAgIGlmIChpc0Z1bmN0aW9uKHNvcnRDb21wYXJlcikpIHtcbiAgICAgICAgaXRlbXMuc29ydChjdXN0b21Db21wYXJlcik7XG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UgaWYgd2UgZ290IGEgc3RyaW5nLCBsZXQncyBzb3J0IGJ5IHRoZSBzb3J0IGRhdGEgYXMgcHJvdmlkZWQgaW5cbiAgICAgIC8vIHRoZSBpbnN0YW5jZSdzIG9wdGlvbnMuXG4gICAgICBlbHNlIGlmICh0eXBlb2Ygc29ydENvbXBhcmVyID09PSBzdHJpbmdUeXBlKSB7XG4gICAgICAgIHNvcnRDb21wYXJlciA9IHBhcnNlQ3JpdGVyaWEoY29tcGFyZXIpO1xuICAgICAgICBpdGVtcy5zb3J0KGRlZmF1bHRDb21wYXJlcik7XG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UgaWYgd2UgZ290IGFuIGFycmF5LCBsZXQncyBhc3N1bWUgaXQncyBhIHByZXNvcnRlZCBhcnJheSBvZiB0aGVcbiAgICAgIC8vIGl0ZW1zIGFuZCBvcmRlciB0aGUgaXRlbXMgYmFzZWQgb24gaXQuXG4gICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNvcnRDb21wYXJlcikpIHtcbiAgICAgICAgaWYgKHNvcnRDb21wYXJlci5sZW5ndGggIT09IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWycgKyBuYW1lc3BhY2UgKyAnXSBzb3J0IHJlZmVyZW5jZSBpdGVtcyBkbyBub3QgbWF0Y2ggd2l0aCBncmlkIGl0ZW1zLicpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChzb3J0Q29tcGFyZXIuaW5kZXhPZihpdGVtc1tpXSkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1snICsgbmFtZXNwYWNlICsgJ10gc29ydCByZWZlcmVuY2UgaXRlbXMgZG8gbm90IG1hdGNoIHdpdGggZ3JpZCBpdGVtcy4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXNbaV0gPSBzb3J0Q29tcGFyZXJbaV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzRGVzY2VuZGluZykgaXRlbXMucmV2ZXJzZSgpO1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlIGxldCdzIGp1c3Qgc2tpcCBpdCwgbm90aGluZyB3ZSBjYW4gZG8gaGVyZS5cbiAgICAgIGVsc2Uge1xuICAgICAgICAvKiogQHRvZG8gTWF5YmUgdGhyb3cgYW4gZXJyb3IgaGVyZT8gKi9cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIC8vIEVtaXQgc29ydCBldmVudC5cbiAgICAgIGlmICh0aGlzLl9oYXNMaXN0ZW5lcnMoZXZlbnRTb3J0KSkge1xuICAgICAgICB0aGlzLl9lbWl0KGV2ZW50U29ydCwgaXRlbXMuc2xpY2UoMCksIG9yaWdJdGVtcyk7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGxheW91dCBpcyBuZWVkZWQuXG4gICAgICBpZiAobGF5b3V0KSB7XG4gICAgICAgIHRoaXMubGF5b3V0KGxheW91dCA9PT0gaW5zdGFudExheW91dCwgaXNGdW5jdGlvbihsYXlvdXQpID8gbGF5b3V0IDogdW5kZWZpbmVkKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgfSkoKTtcblxuICAvKipcbiAgICogTW92ZSBpdGVtIHRvIGFub3RoZXIgaW5kZXggb3IgaW4gcGxhY2Ugb2YgYW5vdGhlciBpdGVtLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWRTaW5nbGVJdGVtUXVlcnl9IGl0ZW1cbiAgICogQHBhcmFtIHtHcmlkU2luZ2xlSXRlbVF1ZXJ5fSBwb3NpdGlvblxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5hY3Rpb249XCJtb3ZlXCJdXG4gICAqICAgLSBBY2NlcHRzIGVpdGhlciBcIm1vdmVcIiBvciBcInN3YXBcIi5cbiAgICogICAtIFwibW92ZVwiIG1vdmVzIHRoZSBpdGVtIGluIHBsYWNlIG9mIHRoZSBvdGhlciBpdGVtLlxuICAgKiAgIC0gXCJzd2FwXCIgc3dhcHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtcy5cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxMYXlvdXRDYWxsYmFja3xTdHJpbmcpfSBbb3B0aW9ucy5sYXlvdXQ9dHJ1ZV1cbiAgICogQHJldHVybnMge0dyaWR9XG4gICAqL1xuICBHcmlkLnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24oaXRlbSwgcG9zaXRpb24sIG9wdGlvbnMpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQgfHwgdGhpcy5faXRlbXMubGVuZ3RoIDwgMikgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaXRlbXMgPSB0aGlzLl9pdGVtcztcbiAgICB2YXIgb3B0cyA9IG9wdGlvbnMgfHwgMDtcbiAgICB2YXIgbGF5b3V0ID0gb3B0cy5sYXlvdXQgPyBvcHRzLmxheW91dCA6IG9wdHMubGF5b3V0ID09PSB1bmRlZmluZWQ7XG4gICAgdmFyIGlzU3dhcCA9IG9wdHMuYWN0aW9uID09PSBhY3Rpb25Td2FwO1xuICAgIHZhciBhY3Rpb24gPSBpc1N3YXAgPyBhY3Rpb25Td2FwIDogYWN0aW9uTW92ZTtcbiAgICB2YXIgZnJvbUl0ZW0gPSB0aGlzLl9nZXRJdGVtKGl0ZW0pO1xuICAgIHZhciB0b0l0ZW0gPSB0aGlzLl9nZXRJdGVtKHBvc2l0aW9uKTtcbiAgICB2YXIgZnJvbUluZGV4O1xuICAgIHZhciB0b0luZGV4O1xuXG4gICAgLy8gTWFrZSBzdXJlIHRoZSBpdGVtcyBleGlzdCBhbmQgYXJlIG5vdCB0aGUgc2FtZS5cbiAgICBpZiAoZnJvbUl0ZW0gJiYgdG9JdGVtICYmIGZyb21JdGVtICE9PSB0b0l0ZW0pIHtcbiAgICAgIC8vIEdldCB0aGUgaW5kaWNlcyBvZiB0aGUgaXRlbXMuXG4gICAgICBmcm9tSW5kZXggPSBpdGVtcy5pbmRleE9mKGZyb21JdGVtKTtcbiAgICAgIHRvSW5kZXggPSBpdGVtcy5pbmRleE9mKHRvSXRlbSk7XG5cbiAgICAgIC8vIERvIHRoZSBtb3ZlL3N3YXAuXG4gICAgICBpZiAoaXNTd2FwKSB7XG4gICAgICAgIGFycmF5U3dhcChpdGVtcywgZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFycmF5TW92ZShpdGVtcywgZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICAgIH1cblxuICAgICAgLy8gRW1pdCBtb3ZlIGV2ZW50LlxuICAgICAgaWYgKHRoaXMuX2hhc0xpc3RlbmVycyhldmVudE1vdmUpKSB7XG4gICAgICAgIHRoaXMuX2VtaXQoZXZlbnRNb3ZlLCB7XG4gICAgICAgICAgaXRlbTogZnJvbUl0ZW0sXG4gICAgICAgICAgZnJvbUluZGV4OiBmcm9tSW5kZXgsXG4gICAgICAgICAgdG9JbmRleDogdG9JbmRleCxcbiAgICAgICAgICBhY3Rpb246IGFjdGlvblxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgbGF5b3V0IGlzIG5lZWRlZC5cbiAgICAgIGlmIChsYXlvdXQpIHtcbiAgICAgICAgdGhpcy5sYXlvdXQobGF5b3V0ID09PSBpbnN0YW50TGF5b3V0LCBpc0Z1bmN0aW9uKGxheW91dCkgPyBsYXlvdXQgOiB1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZW5kIGl0ZW0gdG8gYW5vdGhlciBHcmlkIGluc3RhbmNlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWRTaW5nbGVJdGVtUXVlcnl9IGl0ZW1cbiAgICogQHBhcmFtIHtHcmlkfSBncmlkXG4gICAqIEBwYXJhbSB7R3JpZFNpbmdsZUl0ZW1RdWVyeX0gcG9zaXRpb25cbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBbb3B0aW9ucy5hcHBlbmRUbz1kb2N1bWVudC5ib2R5XVxuICAgKiBAcGFyYW0geyhCb29sZWFufExheW91dENhbGxiYWNrfFN0cmluZyl9IFtvcHRpb25zLmxheW91dFNlbmRlcj10cnVlXVxuICAgKiBAcGFyYW0geyhCb29sZWFufExheW91dENhbGxiYWNrfFN0cmluZyl9IFtvcHRpb25zLmxheW91dFJlY2VpdmVyPXRydWVdXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKGl0ZW0sIGdyaWQsIHBvc2l0aW9uLCBvcHRpb25zKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkIHx8IGdyaWQuX2lzRGVzdHJveWVkIHx8IHRoaXMgPT09IGdyaWQpIHJldHVybiB0aGlzO1xuXG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSB2YWxpZCB0YXJnZXQgaXRlbS5cbiAgICBpdGVtID0gdGhpcy5fZ2V0SXRlbShpdGVtKTtcbiAgICBpZiAoIWl0ZW0pIHJldHVybiB0aGlzO1xuXG4gICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IDA7XG4gICAgdmFyIGNvbnRhaW5lciA9IG9wdHMuYXBwZW5kVG8gfHwgd2luZG93LmRvY3VtZW50LmJvZHk7XG4gICAgdmFyIGxheW91dFNlbmRlciA9IG9wdHMubGF5b3V0U2VuZGVyID8gb3B0cy5sYXlvdXRTZW5kZXIgOiBvcHRzLmxheW91dFNlbmRlciA9PT0gdW5kZWZpbmVkO1xuICAgIHZhciBsYXlvdXRSZWNlaXZlciA9IG9wdHMubGF5b3V0UmVjZWl2ZXJcbiAgICAgID8gb3B0cy5sYXlvdXRSZWNlaXZlclxuICAgICAgOiBvcHRzLmxheW91dFJlY2VpdmVyID09PSB1bmRlZmluZWQ7XG5cbiAgICAvLyBTdGFydCB0aGUgbWlncmF0aW9uIHByb2Nlc3MuXG4gICAgaXRlbS5fbWlncmF0ZS5zdGFydChncmlkLCBwb3NpdGlvbiwgY29udGFpbmVyKTtcblxuICAgIC8vIElmIG1pZ3JhdGlvbiB3YXMgc3RhcnRlZCBzdWNjZXNzZnVsbHkgYW5kIHRoZSBpdGVtIGlzIGFjdGl2ZSwgbGV0J3MgbGF5b3V0XG4gICAgLy8gdGhlIGdyaWRzLlxuICAgIGlmIChpdGVtLl9taWdyYXRlLl9pc0FjdGl2ZSAmJiBpdGVtLl9pc0FjdGl2ZSkge1xuICAgICAgaWYgKGxheW91dFNlbmRlcikge1xuICAgICAgICB0aGlzLmxheW91dChcbiAgICAgICAgICBsYXlvdXRTZW5kZXIgPT09IGluc3RhbnRMYXlvdXQsXG4gICAgICAgICAgaXNGdW5jdGlvbihsYXlvdXRTZW5kZXIpID8gbGF5b3V0U2VuZGVyIDogdW5kZWZpbmVkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAobGF5b3V0UmVjZWl2ZXIpIHtcbiAgICAgICAgZ3JpZC5sYXlvdXQoXG4gICAgICAgICAgbGF5b3V0UmVjZWl2ZXIgPT09IGluc3RhbnRMYXlvdXQsXG4gICAgICAgICAgaXNGdW5jdGlvbihsYXlvdXRSZWNlaXZlcikgPyBsYXlvdXRSZWNlaXZlciA6IHVuZGVmaW5lZFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBpbnN0YW5jZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtCb29sZWFufSBbcmVtb3ZlRWxlbWVudHM9ZmFsc2VdXG4gICAqIEByZXR1cm5zIHtHcmlkfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKHJlbW92ZUVsZW1lbnRzKSB7XG4gICAgaWYgKHRoaXMuX2lzRGVzdHJveWVkKSByZXR1cm4gdGhpcztcblxuICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9lbGVtZW50O1xuICAgIHZhciBpdGVtcyA9IHRoaXMuX2l0ZW1zLnNsaWNlKDApO1xuICAgIHZhciBpO1xuXG4gICAgLy8gVW5iaW5kIHdpbmRvdyByZXNpemUgZXZlbnQgbGlzdGVuZXIuXG4gICAgaWYgKHRoaXMuX3Jlc2l6ZUhhbmRsZXIpIHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9yZXNpemVIYW5kbGVyKTtcbiAgICB9XG5cbiAgICAvLyBEZXN0cm95IGl0ZW1zLlxuICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgaXRlbXNbaV0uX2Rlc3Ryb3kocmVtb3ZlRWxlbWVudHMpO1xuICAgIH1cblxuICAgIC8vIFJlc3RvcmUgY29udGFpbmVyLlxuICAgIHJlbW92ZUNsYXNzKGNvbnRhaW5lciwgdGhpcy5fc2V0dGluZ3MuY29udGFpbmVyQ2xhc3MpO1xuICAgIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAnJztcbiAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSAnJztcblxuICAgIC8vIEVtaXQgZGVzdHJveSBldmVudCBhbmQgdW5iaW5kIGFsbCBldmVudHMuXG4gICAgdGhpcy5fZW1pdChldmVudERlc3Ryb3kpO1xuICAgIHRoaXMuX2VtaXR0ZXIuZGVzdHJveSgpO1xuXG4gICAgLy8gUmVtb3ZlIHJlZmVyZW5jZSBmcm9tIHRoZSBncmlkIGluc3RhbmNlcyBjb2xsZWN0aW9uLlxuICAgIGdyaWRJbnN0YW5jZXNbdGhpcy5faWRdID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gRmxhZyBpbnN0YW5jZSBhcyBkZXN0cm95ZWQuXG4gICAgdGhpcy5faXNEZXN0cm95ZWQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgcHJvdG90eXBlIG1ldGhvZHNcbiAgICogKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKi9cblxuICAvKipcbiAgICogR2V0IGluc3RhbmNlJ3MgaXRlbSBieSBlbGVtZW50IG9yIGJ5IGluZGV4LiBUYXJnZXQgY2FuIGFsc28gYmUgYW4gSXRlbVxuICAgKiBpbnN0YW5jZSBpbiB3aGljaCBjYXNlIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRoZSBpdGVtIGlmIGl0IGV4aXN0cyB3aXRoaW5cbiAgICogcmVsYXRlZCBHcmlkIGluc3RhbmNlLiBJZiBub3RoaW5nIGlzIGZvdW5kIHdpdGggdGhlIHByb3ZpZGVkIHRhcmdldCwgbnVsbFxuICAgKiBpcyByZXR1cm5lZC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7R3JpZFNpbmdsZUl0ZW1RdWVyeX0gW3RhcmdldF1cbiAgICogQHJldHVybnMgez9JdGVtfVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuX2dldEl0ZW0gPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAvLyBJZiBubyB0YXJnZXQgaXMgc3BlY2lmaWVkIG9yIHRoZSBpbnN0YW5jZSBpcyBkZXN0cm95ZWQsIHJldHVybiBudWxsLlxuICAgIGlmICh0aGlzLl9pc0Rlc3Ryb3llZCB8fCAoIXRhcmdldCAmJiB0YXJnZXQgIT09IDApKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBJZiB0YXJnZXQgaXMgbnVtYmVyIHJldHVybiB0aGUgaXRlbSBpbiB0aGF0IGluZGV4LiBJZiB0aGUgbnVtYmVyIGlzIGxvd2VyXG4gICAgLy8gdGhhbiB6ZXJvIGxvb2sgZm9yIHRoZSBpdGVtIHN0YXJ0aW5nIGZyb20gdGhlIGVuZCBvZiB0aGUgaXRlbXMgYXJyYXkuIEZvclxuICAgIC8vIGV4YW1wbGUgLTEgZm9yIHRoZSBsYXN0IGl0ZW0sIC0yIGZvciB0aGUgc2Vjb25kIGxhc3QgaXRlbSwgZXRjLlxuICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSBudW1iZXJUeXBlJDEpIHtcbiAgICAgIHJldHVybiB0aGlzLl9pdGVtc1t0YXJnZXQgPiAtMSA/IHRhcmdldCA6IHRoaXMuX2l0ZW1zLmxlbmd0aCArIHRhcmdldF0gfHwgbnVsbDtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGUgdGFyZ2V0IGlzIGFuIGluc3RhbmNlIG9mIEl0ZW0gcmV0dXJuIGl0IGlmIGl0IGlzIGF0dGFjaGVkIHRvIHRoaXNcbiAgICAvLyBHcmlkIGluc3RhbmNlLCBvdGhlcndpc2UgcmV0dXJuIG51bGwuXG4gICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEl0ZW0pIHtcbiAgICAgIHJldHVybiB0YXJnZXQuX2dyaWRJZCA9PT0gdGhpcy5faWQgPyB0YXJnZXQgOiBudWxsO1xuICAgIH1cblxuICAgIC8vIEluIG90aGVyIGNhc2VzIGxldCdzIGFzc3VtZSB0aGF0IHRoZSB0YXJnZXQgaXMgYW4gZWxlbWVudCwgc28gbGV0J3MgdHJ5XG4gICAgLy8gdG8gZmluZCBhbiBpdGVtIHRoYXQgbWF0Y2hlcyB0aGUgZWxlbWVudCBhbmQgcmV0dXJuIGl0LiBJZiBpdGVtIGlzIG5vdFxuICAgIC8vIGZvdW5kIHJldHVybiBudWxsLlxuICAgIC8qKiBAdG9kbyBUaGlzIGNvdWxkIGJlIG1hZGUgYSBsb3QgZmFzdGVyIGJ5IHVzaW5nIE1hcC9XZWFrTWFwIG9mIGVsZW1lbnRzLiAqL1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5faXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLl9pdGVtc1tpXS5fZWxlbWVudCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtc1tpXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogUmVjYWxjdWxhdGVzIGFuZCB1cGRhdGVzIGluc3RhbmNlJ3MgbGF5b3V0IGRhdGEuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcmV0dXJucyB7TGF5b3V0RGF0YX1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl91cGRhdGVMYXlvdXQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbGF5b3V0ID0gdGhpcy5fbGF5b3V0O1xuICAgIHZhciBzZXR0aW5ncyA9IHRoaXMuX3NldHRpbmdzLmxheW91dDtcbiAgICB2YXIgd2lkdGg7XG4gICAgdmFyIGhlaWdodDtcbiAgICB2YXIgbmV3TGF5b3V0O1xuICAgIHZhciBpO1xuXG4gICAgLy8gTGV0J3MgaW5jcmVtZW50IGxheW91dCBpZC5cbiAgICArK2xheW91dC5pZDtcblxuICAgIC8vIExldCdzIHVwZGF0ZSBsYXlvdXQgaXRlbXNcbiAgICBsYXlvdXQuaXRlbXMubGVuZ3RoID0gMDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5faXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLl9pdGVtc1tpXS5faXNBY3RpdmUpIGxheW91dC5pdGVtcy5wdXNoKHRoaXMuX2l0ZW1zW2ldKTtcbiAgICB9XG5cbiAgICAvLyBMZXQncyBtYWtlIHN1cmUgd2UgaGF2ZSB0aGUgY29ycmVjdCBjb250YWluZXIgZGltZW5zaW9ucy5cbiAgICB0aGlzLl9yZWZyZXNoRGltZW5zaW9ucygpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGNvbnRhaW5lciB3aWR0aCBhbmQgaGVpZ2h0ICh3aXRob3V0IGJvcmRlcnMpLlxuICAgIHdpZHRoID0gdGhpcy5fd2lkdGggLSB0aGlzLl9ib3JkZXJMZWZ0IC0gdGhpcy5fYm9yZGVyUmlnaHQ7XG4gICAgaGVpZ2h0ID0gdGhpcy5faGVpZ2h0IC0gdGhpcy5fYm9yZGVyVG9wIC0gdGhpcy5fYm9yZGVyQm90dG9tO1xuXG4gICAgLy8gQ2FsY3VsYXRlIG5ldyBsYXlvdXQuXG4gICAgaWYgKGlzRnVuY3Rpb24oc2V0dGluZ3MpKSB7XG4gICAgICBuZXdMYXlvdXQgPSBzZXR0aW5ncyhsYXlvdXQuaXRlbXMsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdMYXlvdXQgPSBwYWNrZXIuZ2V0TGF5b3V0KGxheW91dC5pdGVtcywgd2lkdGgsIGhlaWdodCwgbGF5b3V0LnNsb3RzLCBzZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgLy8gTGV0J3MgdXBkYXRlIHRoZSBncmlkJ3MgbGF5b3V0LlxuICAgIGxheW91dC5zbG90cyA9IG5ld0xheW91dC5zbG90cztcbiAgICBsYXlvdXQuc2V0V2lkdGggPSBCb29sZWFuKG5ld0xheW91dC5zZXRXaWR0aCk7XG4gICAgbGF5b3V0LnNldEhlaWdodCA9IEJvb2xlYW4obmV3TGF5b3V0LnNldEhlaWdodCk7XG4gICAgbGF5b3V0LndpZHRoID0gbmV3TGF5b3V0LndpZHRoO1xuICAgIGxheW91dC5oZWlnaHQgPSBuZXdMYXlvdXQuaGVpZ2h0O1xuXG4gICAgcmV0dXJuIGxheW91dDtcbiAgfTtcblxuICAvKipcbiAgICogRW1pdCBhIGdyaWQgZXZlbnQuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnRcbiAgICogQHBhcmFtIHsuLi4qfSBbYXJnXVxuICAgKi9cbiAgR3JpZC5wcm90b3R5cGUuX2VtaXQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHJldHVybjtcbiAgICB0aGlzLl9lbWl0dGVyLmVtaXQuYXBwbHkodGhpcy5fZW1pdHRlciwgYXJndW1lbnRzKTtcbiAgfTtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBldmVudHMgbGlzdGVuZXJzIGZvciBhbiBldmVudC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1lbWJlcm9mIEdyaWQucHJvdG90eXBlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudFxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl9oYXNMaXN0ZW5lcnMgPSBmdW5jdGlvbihldmVudCkge1xuICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9lbWl0dGVyLl9ldmVudHNbZXZlbnRdO1xuICAgIHJldHVybiAhIShsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzLmxlbmd0aCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBjb250YWluZXIncyB3aWR0aCwgaGVpZ2h0IGFuZCBvZmZzZXRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl91cGRhdGVCb3VuZGluZ1JlY3QgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQ7XG4gICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHRoaXMuX3dpZHRoID0gcmVjdC53aWR0aDtcbiAgICB0aGlzLl9oZWlnaHQgPSByZWN0LmhlaWdodDtcbiAgICB0aGlzLl9sZWZ0ID0gcmVjdC5sZWZ0O1xuICAgIHRoaXMuX3RvcCA9IHJlY3QudG9wO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29udGFpbmVyJ3MgYm9yZGVyIHNpemVzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICogQHBhcmFtIHtCb29sZWFufSBsZWZ0XG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmlnaHRcbiAgICogQHBhcmFtIHtCb29sZWFufSB0b3BcbiAgICogQHBhcmFtIHtCb29sZWFufSBib3R0b21cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl91cGRhdGVCb3JkZXJzID0gZnVuY3Rpb24obGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tKSB7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuICAgIGlmIChsZWZ0KSB0aGlzLl9ib3JkZXJMZWZ0ID0gZ2V0U3R5bGVBc0Zsb2F0KGVsZW1lbnQsICdib3JkZXItbGVmdC13aWR0aCcpO1xuICAgIGlmIChyaWdodCkgdGhpcy5fYm9yZGVyUmlnaHQgPSBnZXRTdHlsZUFzRmxvYXQoZWxlbWVudCwgJ2JvcmRlci1yaWdodC13aWR0aCcpO1xuICAgIGlmICh0b3ApIHRoaXMuX2JvcmRlclRvcCA9IGdldFN0eWxlQXNGbG9hdChlbGVtZW50LCAnYm9yZGVyLXRvcC13aWR0aCcpO1xuICAgIGlmIChib3R0b20pIHRoaXMuX2JvcmRlckJvdHRvbSA9IGdldFN0eWxlQXNGbG9hdChlbGVtZW50LCAnYm9yZGVyLWJvdHRvbS13aWR0aCcpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZWZyZXNoIGFsbCBvZiBjb250YWluZXIncyBpbnRlcm5hbCBkaW1lbnNpb25zIGFuZCBvZmZzZXRzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWVtYmVyb2YgR3JpZC5wcm90b3R5cGVcbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl9yZWZyZXNoRGltZW5zaW9ucyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3VwZGF0ZUJvdW5kaW5nUmVjdCgpO1xuICAgIHRoaXMuX3VwZGF0ZUJvcmRlcnMoMSwgMSwgMSwgMSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNob3cgb3IgaGlkZSBHcmlkIGluc3RhbmNlJ3MgaXRlbXMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZW1iZXJvZiBHcmlkLnByb3RvdHlwZVxuICAgKiBAcGFyYW0ge0dyaWRNdWx0aUl0ZW1RdWVyeX0gaXRlbXNcbiAgICogQHBhcmFtIHtCb29sZWFufSB0b1Zpc2libGVcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmluc3RhbnQ9ZmFsc2VdXG4gICAqIEBwYXJhbSB7KFNob3dDYWxsYmFja3xIaWRlQ2FsbGJhY2spfSBbb3B0aW9ucy5vbkZpbmlzaF1cbiAgICogQHBhcmFtIHsoQm9vbGVhbnxMYXlvdXRDYWxsYmFja3xTdHJpbmcpfSBbb3B0aW9ucy5sYXlvdXQ9dHJ1ZV1cbiAgICovXG4gIEdyaWQucHJvdG90eXBlLl9zZXRJdGVtc1Zpc2liaWxpdHkgPSBmdW5jdGlvbihpdGVtcywgdG9WaXNpYmxlLCBvcHRpb25zKSB7XG4gICAgdmFyIGdyaWQgPSB0aGlzO1xuICAgIHZhciB0YXJnZXRJdGVtcyA9IHRoaXMuZ2V0SXRlbXMoaXRlbXMpO1xuICAgIHZhciBvcHRzID0gb3B0aW9ucyB8fCAwO1xuICAgIHZhciBpc0luc3RhbnQgPSBvcHRzLmluc3RhbnQgPT09IHRydWU7XG4gICAgdmFyIGNhbGxiYWNrID0gb3B0cy5vbkZpbmlzaDtcbiAgICB2YXIgbGF5b3V0ID0gb3B0cy5sYXlvdXQgPyBvcHRzLmxheW91dCA6IG9wdHMubGF5b3V0ID09PSB1bmRlZmluZWQ7XG4gICAgdmFyIGNvdW50ZXIgPSB0YXJnZXRJdGVtcy5sZW5ndGg7XG4gICAgdmFyIHN0YXJ0RXZlbnQgPSB0b1Zpc2libGUgPyBldmVudFNob3dTdGFydCA6IGV2ZW50SGlkZVN0YXJ0O1xuICAgIHZhciBlbmRFdmVudCA9IHRvVmlzaWJsZSA/IGV2ZW50U2hvd0VuZCA6IGV2ZW50SGlkZUVuZDtcbiAgICB2YXIgbWV0aG9kID0gdG9WaXNpYmxlID8gJ3Nob3cnIDogJ2hpZGUnO1xuICAgIHZhciBuZWVkc0xheW91dCA9IGZhbHNlO1xuICAgIHZhciBjb21wbGV0ZWRJdGVtcyA9IFtdO1xuICAgIHZhciBoaWRkZW5JdGVtcyA9IFtdO1xuICAgIHZhciBpdGVtO1xuICAgIHZhciBpO1xuXG4gICAgLy8gSWYgdGhlcmUgYXJlIG5vIGl0ZW1zIGNhbGwgdGhlIGNhbGxiYWNrLCBidXQgZG9uJ3QgZW1pdCBhbnkgZXZlbnRzLlxuICAgIGlmICghY291bnRlcikge1xuICAgICAgaWYgKGlzRnVuY3Rpb24oY2FsbGJhY2spKSBjYWxsYmFjayh0YXJnZXRJdGVtcyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRW1pdCBzaG93U3RhcnQvaGlkZVN0YXJ0IGV2ZW50LlxuICAgIGlmICh0aGlzLl9oYXNMaXN0ZW5lcnMoc3RhcnRFdmVudCkpIHtcbiAgICAgIHRoaXMuX2VtaXQoc3RhcnRFdmVudCwgdGFyZ2V0SXRlbXMuc2xpY2UoMCkpO1xuICAgIH1cblxuICAgIC8vIFNob3cvaGlkZSBpdGVtcy5cbiAgICBmb3IgKGkgPSAwOyBpIDwgdGFyZ2V0SXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGl0ZW0gPSB0YXJnZXRJdGVtc1tpXTtcblxuICAgICAgLy8gSWYgaW5hY3RpdmUgaXRlbSBpcyBzaG93biBvciBhY3RpdmUgaXRlbSBpcyBoaWRkZW4gd2UgbmVlZCB0byBkb1xuICAgICAgLy8gbGF5b3V0LlxuICAgICAgaWYgKCh0b1Zpc2libGUgJiYgIWl0ZW0uX2lzQWN0aXZlKSB8fCAoIXRvVmlzaWJsZSAmJiBpdGVtLl9pc0FjdGl2ZSkpIHtcbiAgICAgICAgbmVlZHNMYXlvdXQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBpbmFjdGl2ZSBpdGVtIGlzIHNob3duIHdlIGFsc28gbmVlZCB0byBkbyBhIGxpdHRsZSBoYWNrIHRvIG1ha2UgdGhlXG4gICAgICAvLyBpdGVtIG5vdCBhbmltYXRlIGl0J3MgbmV4dCBwb3NpdGlvbmluZyAobGF5b3V0KS5cbiAgICAgIGlmICh0b1Zpc2libGUgJiYgIWl0ZW0uX2lzQWN0aXZlKSB7XG4gICAgICAgIGl0ZW0uX2xheW91dC5fc2tpcE5leHRBbmltYXRpb24gPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBhIGhpZGRlbiBpdGVtIGlzIGJlaW5nIHNob3duIHdlIG5lZWQgdG8gcmVmcmVzaCB0aGUgaXRlbSdzXG4gICAgICAvLyBkaW1lbnNpb25zLlxuICAgICAgaWYgKHRvVmlzaWJsZSAmJiBpdGVtLl92aXNpYmlsaXR5Ll9pc0hpZGRlbikge1xuICAgICAgICBoaWRkZW5JdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTaG93L2hpZGUgdGhlIGl0ZW0uXG4gICAgICBpdGVtLl92aXNpYmlsaXR5W21ldGhvZF0oaXNJbnN0YW50LCBmdW5jdGlvbihpbnRlcnJ1cHRlZCwgaXRlbSkge1xuICAgICAgICAvLyBJZiB0aGUgY3VycmVudCBpdGVtJ3MgYW5pbWF0aW9uIHdhcyBub3QgaW50ZXJydXB0ZWQgYWRkIGl0IHRvIHRoZVxuICAgICAgICAvLyBjb21wbGV0ZWRJdGVtcyBhcnJheS5cbiAgICAgICAgaWYgKCFpbnRlcnJ1cHRlZCkgY29tcGxldGVkSXRlbXMucHVzaChpdGVtKTtcblxuICAgICAgICAvLyBJZiBhbGwgaXRlbXMgaGF2ZSBmaW5pc2hlZCB0aGVpciBhbmltYXRpb25zIGNhbGwgdGhlIGNhbGxiYWNrXG4gICAgICAgIC8vIGFuZCBlbWl0IHNob3dFbmQvaGlkZUVuZCBldmVudC5cbiAgICAgICAgaWYgKC0tY291bnRlciA8IDEpIHtcbiAgICAgICAgICBpZiAoaXNGdW5jdGlvbihjYWxsYmFjaykpIGNhbGxiYWNrKGNvbXBsZXRlZEl0ZW1zLnNsaWNlKDApKTtcbiAgICAgICAgICBpZiAoZ3JpZC5faGFzTGlzdGVuZXJzKGVuZEV2ZW50KSkgZ3JpZC5fZW1pdChlbmRFdmVudCwgY29tcGxldGVkSXRlbXMuc2xpY2UoMCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZWZyZXNoIGhpZGRlbiBpdGVtcy5cbiAgICBpZiAoaGlkZGVuSXRlbXMubGVuZ3RoKSB0aGlzLnJlZnJlc2hJdGVtcyhoaWRkZW5JdGVtcyk7XG5cbiAgICAvLyBMYXlvdXQgaWYgbmVlZGVkLlxuICAgIGlmIChuZWVkc0xheW91dCAmJiBsYXlvdXQpIHtcbiAgICAgIHRoaXMubGF5b3V0KGxheW91dCA9PT0gaW5zdGFudExheW91dCwgaXNGdW5jdGlvbihsYXlvdXQpID8gbGF5b3V0IDogdW5kZWZpbmVkKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgaGVscGVyc1xuICAgKiAqKioqKioqKioqKioqKipcbiAgICovXG5cbiAgLyoqXG4gICAqIE1lcmdlIGRlZmF1bHQgc2V0dGluZ3Mgd2l0aCB1c2VyIHNldHRpbmdzLiBUaGUgcmV0dXJuZWQgb2JqZWN0IGlzIGEgbmV3XG4gICAqIG9iamVjdCB3aXRoIG1lcmdlZCB2YWx1ZXMuIFRoZSBtZXJnaW5nIGlzIGEgZGVlcCBtZXJnZSBtZWFuaW5nIHRoYXQgYWxsXG4gICAqIG9iamVjdHMgYW5kIGFycmF5cyB3aXRoaW4gdGhlIHByb3ZpZGVkIHNldHRpbmdzIG9iamVjdHMgd2lsbCBiZSBhbHNvIG1lcmdlZFxuICAgKiBzbyB0aGF0IG1vZGlmeWluZyB0aGUgdmFsdWVzIG9mIHRoZSBzZXR0aW5ncyBvYmplY3Qgd2lsbCBoYXZlIG5vIGVmZmVjdCBvblxuICAgKiB0aGUgcmV0dXJuZWQgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gZGVmYXVsdFNldHRpbmdzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbdXNlclNldHRpbmdzXVxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGEgbmV3IG9iamVjdC5cbiAgICovXG4gIGZ1bmN0aW9uIG1lcmdlU2V0dGluZ3MoZGVmYXVsdFNldHRpbmdzLCB1c2VyU2V0dGluZ3MpIHtcbiAgICAvLyBDcmVhdGUgYSBmcmVzaCBjb3B5IG9mIGRlZmF1bHQgc2V0dGluZ3MuXG4gICAgdmFyIHJldCA9IG1lcmdlT2JqZWN0cyh7fSwgZGVmYXVsdFNldHRpbmdzKTtcblxuICAgIC8vIE1lcmdlIHVzZXIgc2V0dGluZ3MgdG8gZGVmYXVsdCBzZXR0aW5ncy5cbiAgICBpZiAodXNlclNldHRpbmdzKSB7XG4gICAgICByZXQgPSBtZXJnZU9iamVjdHMocmV0LCB1c2VyU2V0dGluZ3MpO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSB2aXNpYmxlL2hpZGRlbiBzdHlsZXMgbWFudWFsbHkgc28gdGhhdCB0aGUgd2hvbGUgb2JqZWN0IGlzXG4gICAgLy8gb3ZlcnJpZGRlbiBpbnN0ZWFkIG9mIHRoZSBwcm9wcy5cbiAgICByZXQudmlzaWJsZVN0eWxlcyA9ICh1c2VyU2V0dGluZ3MgfHwgMCkudmlzaWJsZVN0eWxlcyB8fCAoZGVmYXVsdFNldHRpbmdzIHx8IDApLnZpc2libGVTdHlsZXM7XG4gICAgcmV0LmhpZGRlblN0eWxlcyA9ICh1c2VyU2V0dGluZ3MgfHwgMCkuaGlkZGVuU3R5bGVzIHx8IChkZWZhdWx0U2V0dGluZ3MgfHwgMCkuaGlkZGVuU3R5bGVzO1xuXG4gICAgcmV0dXJuIHJldDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXJnZSB0d28gb2JqZWN0cyByZWN1cnNpdmVseSAoZGVlcCBtZXJnZSkuIFRoZSBzb3VyY2Ugb2JqZWN0J3MgcHJvcGVydGllc1xuICAgKiBhcmUgbWVyZ2VkIHRvIHRoZSB0YXJnZXQgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0XG4gICAqICAgLSBUaGUgdGFyZ2V0IG9iamVjdC5cbiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZVxuICAgKiAgIC0gVGhlIHNvdXJjZSBvYmplY3QuXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIHRhcmdldCBvYmplY3QuXG4gICAqL1xuICBmdW5jdGlvbiBtZXJnZU9iamVjdHModGFyZ2V0LCBzb3VyY2UpIHtcbiAgICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7XG4gICAgdmFyIGxlbmd0aCA9IHNvdXJjZUtleXMubGVuZ3RoO1xuICAgIHZhciBpc1NvdXJjZU9iamVjdDtcbiAgICB2YXIgcHJvcE5hbWU7XG4gICAgdmFyIGk7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHByb3BOYW1lID0gc291cmNlS2V5c1tpXTtcbiAgICAgIGlzU291cmNlT2JqZWN0ID0gaXNQbGFpbk9iamVjdChzb3VyY2VbcHJvcE5hbWVdKTtcblxuICAgICAgLy8gSWYgdGFyZ2V0IGFuZCBzb3VyY2UgdmFsdWVzIGFyZSBib3RoIG9iamVjdHMsIG1lcmdlIHRoZSBvYmplY3RzIGFuZFxuICAgICAgLy8gYXNzaWduIHRoZSBtZXJnZWQgdmFsdWUgdG8gdGhlIHRhcmdldCBwcm9wZXJ0eS5cbiAgICAgIGlmIChpc1BsYWluT2JqZWN0KHRhcmdldFtwcm9wTmFtZV0pICYmIGlzU291cmNlT2JqZWN0KSB7XG4gICAgICAgIHRhcmdldFtwcm9wTmFtZV0gPSBtZXJnZU9iamVjdHMobWVyZ2VPYmplY3RzKHt9LCB0YXJnZXRbcHJvcE5hbWVdKSwgc291cmNlW3Byb3BOYW1lXSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBzb3VyY2UncyB2YWx1ZSBpcyBvYmplY3QgYW5kIHRhcmdldCdzIGlzIG5vdCBsZXQncyBjbG9uZSB0aGUgb2JqZWN0IGFzXG4gICAgICAvLyB0aGUgdGFyZ2V0J3MgdmFsdWUuXG4gICAgICBpZiAoaXNTb3VyY2VPYmplY3QpIHtcbiAgICAgICAgdGFyZ2V0W3Byb3BOYW1lXSA9IG1lcmdlT2JqZWN0cyh7fSwgc291cmNlW3Byb3BOYW1lXSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBzb3VyY2UncyB2YWx1ZSBpcyBhbiBhcnJheSBsZXQncyBjbG9uZSB0aGUgYXJyYXkgYXMgdGhlIHRhcmdldCdzXG4gICAgICAvLyB2YWx1ZS5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZVtwcm9wTmFtZV0pKSB7XG4gICAgICAgIHRhcmdldFtwcm9wTmFtZV0gPSBzb3VyY2VbcHJvcE5hbWVdLnNsaWNlKDApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gSW4gYWxsIG90aGVyIGNhc2VzIGxldCdzIGp1c3QgZGlyZWN0bHkgYXNzaWduIHRoZSBzb3VyY2UncyB2YWx1ZSBhcyB0aGVcbiAgICAgIC8vIHRhcmdldCdzIHZhbHVlLlxuICAgICAgdGFyZ2V0W3Byb3BOYW1lXSA9IHNvdXJjZVtwcm9wTmFtZV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIHJldHVybiBHcmlkO1xuXG59KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vbXV1cmkvZGlzdC9tdXVyaS5qc1xuLy8gbW9kdWxlIGlkID0gMjdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwidmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG4vKiBUYWJ1bGF0b3IgdjQuNi4xIChjKSBPbGl2ZXIgRm9sa2VyZCAqL1xuXG47KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcblx0aWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdGRlZmluZShmYWN0b3J5KTtcblx0fSBlbHNlIHtcblx0XHRnbG9iYWwuVGFidWxhdG9yID0gZmFjdG9yeSgpO1xuXHR9XG59KSh0aGlzLCBmdW5jdGlvbiAoKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maW5kSW5kZXhcblxuXG5cdGlmICghQXJyYXkucHJvdG90eXBlLmZpbmRJbmRleCkge1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgJ2ZpbmRJbmRleCcsIHtcblxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHByZWRpY2F0ZSkge1xuXG5cdFx0XHRcdC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXG5cblxuXHRcdFx0XHRpZiAodGhpcyA9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgbyA9IE9iamVjdCh0aGlzKTtcblxuXHRcdFx0XHQvLyAyLiBMZXQgbGVuIGJlID8gVG9MZW5ndGgoPyBHZXQoTywgXCJsZW5ndGhcIikpLlxuXG5cblx0XHRcdFx0dmFyIGxlbiA9IG8ubGVuZ3RoID4+PiAwO1xuXG5cdFx0XHRcdC8vIDMuIElmIElzQ2FsbGFibGUocHJlZGljYXRlKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxuXG5cblx0XHRcdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzFdO1xuXG5cdFx0XHRcdC8vIDUuIExldCBrIGJlIDAuXG5cblxuXHRcdFx0XHR2YXIgayA9IDA7XG5cblx0XHRcdFx0Ly8gNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVuXG5cblxuXHRcdFx0XHR3aGlsZSAoayA8IGxlbikge1xuXG5cdFx0XHRcdFx0Ly8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXG5cblxuXHRcdFx0XHRcdC8vIGIuIExldCBrVmFsdWUgYmUgPyBHZXQoTywgUGspLlxuXG5cblx0XHRcdFx0XHQvLyBjLiBMZXQgdGVzdFJlc3VsdCBiZSBUb0Jvb2xlYW4oPyBDYWxsKHByZWRpY2F0ZSwgVCwgwqsga1ZhbHVlLCBrLCBPIMK7KSkuXG5cblxuXHRcdFx0XHRcdC8vIGQuIElmIHRlc3RSZXN1bHQgaXMgdHJ1ZSwgcmV0dXJuIGsuXG5cblxuXHRcdFx0XHRcdHZhciBrVmFsdWUgPSBvW2tdO1xuXG5cdFx0XHRcdFx0aWYgKHByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIGtWYWx1ZSwgaywgbykpIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGs7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gZS4gSW5jcmVhc2UgayBieSAxLlxuXG5cblx0XHRcdFx0XHRrKys7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyA3LiBSZXR1cm4gLTEuXG5cblxuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5maW5kXG5cblxuXHRpZiAoIUFycmF5LnByb3RvdHlwZS5maW5kKSB7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCAnZmluZCcsIHtcblxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHByZWRpY2F0ZSkge1xuXG5cdFx0XHRcdC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXG5cblxuXHRcdFx0XHRpZiAodGhpcyA9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgbyA9IE9iamVjdCh0aGlzKTtcblxuXHRcdFx0XHQvLyAyLiBMZXQgbGVuIGJlID8gVG9MZW5ndGgoPyBHZXQoTywgXCJsZW5ndGhcIikpLlxuXG5cblx0XHRcdFx0dmFyIGxlbiA9IG8ubGVuZ3RoID4+PiAwO1xuXG5cdFx0XHRcdC8vIDMuIElmIElzQ2FsbGFibGUocHJlZGljYXRlKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxuXG5cblx0XHRcdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzFdO1xuXG5cdFx0XHRcdC8vIDUuIExldCBrIGJlIDAuXG5cblxuXHRcdFx0XHR2YXIgayA9IDA7XG5cblx0XHRcdFx0Ly8gNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVuXG5cblxuXHRcdFx0XHR3aGlsZSAoayA8IGxlbikge1xuXG5cdFx0XHRcdFx0Ly8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXG5cblxuXHRcdFx0XHRcdC8vIGIuIExldCBrVmFsdWUgYmUgPyBHZXQoTywgUGspLlxuXG5cblx0XHRcdFx0XHQvLyBjLiBMZXQgdGVzdFJlc3VsdCBiZSBUb0Jvb2xlYW4oPyBDYWxsKHByZWRpY2F0ZSwgVCwgwqsga1ZhbHVlLCBrLCBPIMK7KSkuXG5cblxuXHRcdFx0XHRcdC8vIGQuIElmIHRlc3RSZXN1bHQgaXMgdHJ1ZSwgcmV0dXJuIGtWYWx1ZS5cblxuXG5cdFx0XHRcdFx0dmFyIGtWYWx1ZSA9IG9ba107XG5cblx0XHRcdFx0XHRpZiAocHJlZGljYXRlLmNhbGwodGhpc0FyZywga1ZhbHVlLCBrLCBvKSkge1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4ga1ZhbHVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIGUuIEluY3JlYXNlIGsgYnkgMS5cblxuXG5cdFx0XHRcdFx0aysrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gNy4gUmV0dXJuIHVuZGVmaW5lZC5cblxuXG5cdFx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdHZhciBDb2x1bW5NYW5hZ2VyID0gZnVuY3Rpb24gQ29sdW1uTWFuYWdlcih0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgcGFyZW50IHRhYmxlXG5cblxuXHRcdHRoaXMuYmxvY2tIb3pTY3JvbGxFdmVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5oZWFkZXJzRWxlbWVudCA9IHRoaXMuY3JlYXRlSGVhZGVyc0VsZW1lbnQoKTtcblxuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuY3JlYXRlSGVhZGVyRWxlbWVudCgpOyAvL2NvbnRhaW5pbmcgZWxlbWVudFxuXG5cblx0XHR0aGlzLnJvd01hbmFnZXIgPSBudWxsOyAvL2hvbGQgcm93IG1hbmFnZXIgb2JqZWN0XG5cblxuXHRcdHRoaXMuY29sdW1ucyA9IFtdOyAvLyBjb2x1bW4gZGVmaW5pdGlvbiBvYmplY3RcblxuXG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdOyAvL2NvbHVtbnMgYnkgaW5kZXhcblxuXG5cdFx0dGhpcy5jb2x1bW5zQnlGaWVsZCA9IHt9OyAvL2NvbHVtbnMgYnkgZmllbGRcblxuXG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblxuXHRcdHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5oZWFkZXJzRWxlbWVudCwgdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vIFNldHVwIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuY3JlYXRlSGVhZGVyc0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXJzXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmNyZWF0ZUhlYWRlckVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXJcIik7XG5cblx0XHRpZiAoIXRoaXMudGFibGUub3B0aW9ucy5oZWFkZXJWaXNpYmxlKSB7XG5cblx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItaGVhZGVyLWhpZGRlblwiKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZWw7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vc2Nyb2xsIGJvZHkgYWxvbmcgd2l0aCBoZWFkZXJcblxuXG5cdFx0Ly8gc2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgZnVuY3Rpb24oZSl7XG5cblxuXHRcdC8vIFx0aWYoIXNlbGYuYmxvY2tIb3pTY3JvbGxFdmVudCl7XG5cblxuXHRcdC8vIFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChzZWxmLmVsZW1lbnQuc2Nyb2xsTGVmdCk7XG5cblxuXHRcdC8vIFx0fVxuXG5cblx0XHQvLyB9KTtcblxuXHR9O1xuXG5cdC8vbGluayB0byByb3cgbWFuYWdlclxuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuc2V0Um93TWFuYWdlciA9IGZ1bmN0aW9uIChtYW5hZ2VyKSB7XG5cblx0XHR0aGlzLnJvd01hbmFnZXIgPSBtYW5hZ2VyO1xuXHR9O1xuXG5cdC8vcmV0dXJuIGNvbnRhaW5pbmcgZWxlbWVudFxuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQ7XG5cdH07XG5cblx0Ly9yZXR1cm4gaGVhZGVyIGNvbnRhaW5pbmcgZWxlbWVudFxuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0SGVhZGVyc0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5oZWFkZXJzRWxlbWVudDtcblx0fTtcblxuXHQvLyBDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS50ZW1wU2Nyb2xsQmxvY2sgPSBmdW5jdGlvbigpe1xuXG5cblx0Ly8gXHRjbGVhclRpbWVvdXQodGhpcy5ibG9ja0hvelNjcm9sbEV2ZW50KTtcblxuXG5cdC8vIFx0dGhpcy5ibG9ja0hvelNjcm9sbEV2ZW50ID0gc2V0VGltZW91dCgoKSA9PiB7dGhpcy5ibG9ja0hvelNjcm9sbEV2ZW50ID0gZmFsc2U7fSwgNTApO1xuXG5cblx0Ly8gfVxuXG5cblx0Ly9zY3JvbGwgaG9yaXpvbnRhbGx5IHRvIG1hdGNoIHRhYmxlIGJvZHlcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLnNjcm9sbEhvcml6b250YWwgPSBmdW5jdGlvbiAobGVmdCkge1xuXG5cdFx0dmFyIGhvekFkanVzdCA9IDAsXG5cdFx0ICAgIHNjcm9sbFdpZHRoID0gdGhpcy5lbGVtZW50LnNjcm9sbFdpZHRoIC0gdGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXG5cdFx0Ly8gdGhpcy50ZW1wU2Nyb2xsQmxvY2soKTtcblxuXG5cdFx0dGhpcy5lbGVtZW50LnNjcm9sbExlZnQgPSBsZWZ0O1xuXG5cdFx0Ly9hZGp1c3QgZm9yIHZlcnRpY2FsIHNjcm9sbGJhciBtb3ZpbmcgdGFibGUgd2hlbiBwcmVzZW50XG5cblxuXHRcdGlmIChsZWZ0ID4gc2Nyb2xsV2lkdGgpIHtcblxuXHRcdFx0aG96QWRqdXN0ID0gbGVmdCAtIHNjcm9sbFdpZHRoO1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IC1ob3pBZGp1c3QgKyBcInB4XCI7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSAwO1xuXHRcdH1cblxuXHRcdC8va2VlcCBmcm96ZW4gY29sdW1ucyBmaXhlZCBpbiBwb3NpdGlvblxuXG5cblx0XHQvL3RoaXMuX2NhbGNGcm96ZW5Db2x1bW5zUG9zKGhvekFkanVzdCArIDMpO1xuXG5cblx0XHR0aGlzLnNjcm9sbExlZnQgPSBsZWZ0O1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuQ29sdW1uc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5zY3JvbGxIb3Jpem9udGFsKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8gQ29sdW1uIFNldHVwIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZW5lcmF0ZUNvbHVtbnNGcm9tUm93RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHR2YXIgY29scyA9IFtdLFxuXHRcdCAgICByb3csXG5cdFx0ICAgIHNvcnRlcjtcblxuXHRcdGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XG5cblx0XHRcdHJvdyA9IGRhdGFbMF07XG5cblx0XHRcdGZvciAodmFyIGtleSBpbiByb3cpIHtcblxuXHRcdFx0XHR2YXIgY29sID0ge1xuXG5cdFx0XHRcdFx0ZmllbGQ6IGtleSxcblxuXHRcdFx0XHRcdHRpdGxlOiBrZXlcblxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHZhciB2YWx1ZSA9IHJvd1trZXldO1xuXG5cdFx0XHRcdHN3aXRjaCAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpIHtcblxuXHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblxuXHRcdFx0XHRcdFx0c29ydGVyID0gXCJzdHJpbmdcIjtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXG5cdFx0XHRcdFx0XHRzb3J0ZXIgPSBcImJvb2xlYW5cIjtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuXG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwiYXJyYXlcIjtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0c29ydGVyID0gXCJzdHJpbmdcIjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRkZWZhdWx0OlxuXG5cdFx0XHRcdFx0XHRpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSAhPT0gXCJcIikge1xuXG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwibnVtYmVyXCI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdGlmICh2YWx1ZS5tYXRjaCgvKCheWzAtOV0rW2Etel0rKXwoXlthLXpdK1swLTldKykpKyQvaSkpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwiYWxwaGFudW1cIjtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbC5zb3J0ZXIgPSBzb3J0ZXI7XG5cblx0XHRcdFx0Y29scy5wdXNoKGNvbCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zID0gY29scztcblxuXHRcdFx0dGhpcy5zZXRDb2x1bW5zKHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuc2V0Q29sdW1ucyA9IGZ1bmN0aW9uIChjb2xzLCByb3cpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHdoaWxlIChzZWxmLmhlYWRlcnNFbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdHNlbGYuaGVhZGVyc0VsZW1lbnQucmVtb3ZlQ2hpbGQoc2VsZi5oZWFkZXJzRWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9c2VsZi5jb2x1bW5zID0gW107XG5cblx0XHRzZWxmLmNvbHVtbnNCeUluZGV4ID0gW107XG5cblx0XHRzZWxmLmNvbHVtbnNCeUZpZWxkID0ge307XG5cblx0XHQvL3Jlc2V0IGZyb3plbiBjb2x1bW5zXG5cblxuXHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMucmVzZXQoKTtcblx0XHR9XG5cblx0XHRjb2xzLmZvckVhY2goZnVuY3Rpb24gKGRlZiwgaSkge1xuXG5cdFx0XHRzZWxmLl9hZGRDb2x1bW4oZGVmKTtcblx0XHR9KTtcblxuXHRcdHNlbGYuX3JlSW5kZXhDb2x1bW5zKCk7XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRzZWxmLnJlZHJhdyh0cnVlKTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5fYWRkQ29sdW1uID0gZnVuY3Rpb24gKGRlZmluaXRpb24sIGJlZm9yZSwgbmV4dFRvQ29sdW1uKSB7XG5cblx0XHR2YXIgY29sdW1uID0gbmV3IENvbHVtbihkZWZpbml0aW9uLCB0aGlzKSxcblx0XHQgICAgY29sRWwgPSBjb2x1bW4uZ2V0RWxlbWVudCgpLFxuXHRcdCAgICBpbmRleCA9IG5leHRUb0NvbHVtbiA/IHRoaXMuZmluZENvbHVtbkluZGV4KG5leHRUb0NvbHVtbikgOiBuZXh0VG9Db2x1bW47XG5cblx0XHRpZiAobmV4dFRvQ29sdW1uICYmIGluZGV4ID4gLTEpIHtcblxuXHRcdFx0dmFyIHBhcmVudEluZGV4ID0gdGhpcy5jb2x1bW5zLmluZGV4T2YobmV4dFRvQ29sdW1uLmdldFRvcENvbHVtbigpKTtcblxuXHRcdFx0dmFyIG5leHRFbCA9IG5leHRUb0NvbHVtbi5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGlmIChiZWZvcmUpIHtcblxuXHRcdFx0XHR0aGlzLmNvbHVtbnMuc3BsaWNlKHBhcmVudEluZGV4LCAwLCBjb2x1bW4pO1xuXG5cdFx0XHRcdG5leHRFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjb2xFbCwgbmV4dEVsKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5jb2x1bW5zLnNwbGljZShwYXJlbnRJbmRleCArIDEsIDAsIGNvbHVtbik7XG5cblx0XHRcdFx0bmV4dEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvbEVsLCBuZXh0RWwubmV4dFNpYmxpbmcpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChiZWZvcmUpIHtcblxuXHRcdFx0XHR0aGlzLmNvbHVtbnMudW5zaGlmdChjb2x1bW4pO1xuXG5cdFx0XHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQuaW5zZXJ0QmVmb3JlKGNvbHVtbi5nZXRFbGVtZW50KCksIHRoaXMuaGVhZGVyc0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuY29sdW1ucy5wdXNoKGNvbHVtbik7XG5cblx0XHRcdFx0dGhpcy5oZWFkZXJzRWxlbWVudC5hcHBlbmRDaGlsZChjb2x1bW4uZ2V0RWxlbWVudCgpKTtcblx0XHRcdH1cblxuXHRcdFx0Y29sdW1uLmNvbHVtblJlbmRlcmVkKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNvbHVtbjtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5yZWdpc3RlckNvbHVtbkZpZWxkID0gZnVuY3Rpb24gKGNvbCkge1xuXG5cdFx0aWYgKGNvbC5kZWZpbml0aW9uLmZpZWxkKSB7XG5cblx0XHRcdHRoaXMuY29sdW1uc0J5RmllbGRbY29sLmRlZmluaXRpb24uZmllbGRdID0gY29sO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5yZWdpc3RlckNvbHVtblBvc2l0aW9uID0gZnVuY3Rpb24gKGNvbCkge1xuXG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleC5wdXNoKGNvbCk7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuX3JlSW5kZXhDb2x1bW5zID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdO1xuXG5cdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRjb2x1bW4ucmVSZWdpc3RlclBvc2l0aW9uKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9lbnN1cmUgY29sdW1uIGhlYWRlcnMgdGFrZSB1cCB0aGUgY29ycmVjdCBhbW91bnQgb2Ygc3BhY2UgaW4gY29sdW1uIGdyb3Vwc1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuX3ZlcnRpY2FsQWxpZ25IZWFkZXJzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBtaW5IZWlnaHQgPSAwO1xuXG5cdFx0c2VsZi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHR2YXIgaGVpZ2h0O1xuXG5cdFx0XHRjb2x1bW4uY2xlYXJWZXJ0aWNhbEFsaWduKCk7XG5cblx0XHRcdGhlaWdodCA9IGNvbHVtbi5nZXRIZWlnaHQoKTtcblxuXHRcdFx0aWYgKGhlaWdodCA+IG1pbkhlaWdodCkge1xuXG5cdFx0XHRcdG1pbkhlaWdodCA9IGhlaWdodDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHNlbGYuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0Y29sdW1uLnZlcnRpY2FsQWxpZ24oc2VsZi50YWJsZS5vcHRpb25zLmNvbHVtbkhlYWRlclZlcnRBbGlnbiwgbWluSGVpZ2h0KTtcblx0XHR9KTtcblxuXHRcdHNlbGYucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIENvbHVtbiBEZXRhaWxzIC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5maW5kQ29sdW1uID0gZnVuY3Rpb24gKHN1YmplY3QpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmICgodHlwZW9mIHN1YmplY3QgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHN1YmplY3QpKSA9PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdGlmIChzdWJqZWN0IGluc3RhbmNlb2YgQ29sdW1uKSB7XG5cblx0XHRcdFx0Ly9zdWJqZWN0IGlzIGNvbHVtbiBlbGVtZW50XG5cblxuXHRcdFx0XHRyZXR1cm4gc3ViamVjdDtcblx0XHRcdH0gZWxzZSBpZiAoc3ViamVjdCBpbnN0YW5jZW9mIENvbHVtbkNvbXBvbmVudCkge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyBwdWJsaWMgY29sdW1uIGNvbXBvbmVudFxuXG5cblx0XHRcdFx0cmV0dXJuIHN1YmplY3QuX2dldFNlbGYoKSB8fCBmYWxzZTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHN1YmplY3QgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyBhIEhUTUwgZWxlbWVudCBvZiB0aGUgY29sdW1uIGhlYWRlclxuXG5cblx0XHRcdFx0dmFyIG1hdGNoID0gc2VsZi5jb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5lbGVtZW50ID09PSBzdWJqZWN0O1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Ly9zdWJqZWN0IHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBmaWVsZCBuYW1lIG9mIHRoZSBjb2x1bW5cblxuXG5cdFx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zQnlGaWVsZFtzdWJqZWN0XSB8fCBmYWxzZTtcblx0XHR9XG5cblx0XHQvL2NhdGNoIGFsbCBmb3IgYW55IG90aGVyIHR5cGUgb2YgaW5wdXRcblxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldENvbHVtbkJ5RmllbGQgPSBmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUZpZWxkW2ZpZWxkXTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRDb2x1bW5zQnlGaWVsZFJvb3QgPSBmdW5jdGlvbiAocm9vdCkge1xuXHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cblx0XHR2YXIgbWF0Y2hlcyA9IFtdO1xuXG5cdFx0T2JqZWN0LmtleXModGhpcy5jb2x1bW5zQnlGaWVsZCkuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdFx0dmFyIGZpZWxkUm9vdCA9IGZpZWxkLnNwbGl0KFwiLlwiKVswXTtcblxuXHRcdFx0aWYgKGZpZWxkUm9vdCA9PT0gcm9vdCkge1xuXG5cdFx0XHRcdG1hdGNoZXMucHVzaChfdGhpcy5jb2x1bW5zQnlGaWVsZFtmaWVsZF0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1hdGNoZXM7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0Q29sdW1uQnlJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuY29sdW1uc0J5SW5kZXhbaW5kZXhdO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldEZpcnN0VmlzaWJpbGVDb2x1bW4gPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMuY29sdW1uc0J5SW5kZXguZmluZEluZGV4KGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0cmV0dXJuIGNvbC52aXNpYmxlO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGluZGV4ID4gLTEgPyB0aGlzLmNvbHVtbnNCeUluZGV4W2luZGV4XSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldENvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmZpbmRDb2x1bW5JbmRleCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUluZGV4LmZpbmRJbmRleChmdW5jdGlvbiAoY29sKSB7XG5cblx0XHRcdHJldHVybiBjb2x1bW4gPT09IGNvbDtcblx0XHR9KTtcblx0fTtcblxuXHQvL3JldHVybiBhbGwgY29sdW1ucyB0aGF0IGFyZSBub3QgZ3JvdXBzXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRSZWFsQ29sdW1ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUluZGV4O1xuXHR9O1xuXG5cdC8vdHJhdmVycyBhY3Jvc3MgY29sdW1ucyBhbmQgY2FsbCBhY3Rpb25cblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLnRyYXZlcnNlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbiwgaSkge1xuXG5cdFx0XHRjYWxsYmFjayhjb2x1bW4sIGkpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdC8vZ2V0IGRlZmludGlvbnMgb2YgYWN0dWFsIGNvbHVtbnNcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldERlZmluaXRpb25zID0gZnVuY3Rpb24gKGFjdGl2ZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdHNlbGYuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGlmICghYWN0aXZlIHx8IGFjdGl2ZSAmJiBjb2x1bW4udmlzaWJsZSkge1xuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXREZWZpbml0aW9uKCkpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvL2dldCBmdWxsIG5lc3RlZCBkZWZpbml0aW9uIHRyZWVcblxuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldERlZmluaXRpb25UcmVlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdHNlbGYuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0b3V0cHV0LnB1c2goY29sdW1uLmdldERlZmluaXRpb24odHJ1ZSkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZXRDb21wb25lbnRzID0gZnVuY3Rpb24gKHN0cnVjdHVyZWQpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW10sXG5cdFx0ICAgIGNvbHVtbnMgPSBzdHJ1Y3R1cmVkID8gc2VsZi5jb2x1bW5zIDogc2VsZi5jb2x1bW5zQnlJbmRleDtcblxuXHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHdpZHRoID0gMDtcblxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGlmIChjb2x1bW4udmlzaWJsZSkge1xuXG5cdFx0XHRcdHdpZHRoICs9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHdpZHRoO1xuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLm1vdmVDb2x1bW4gPSBmdW5jdGlvbiAoZnJvbSwgdG8sIGFmdGVyKSB7XG5cblx0XHR0aGlzLm1vdmVDb2x1bW5BY3R1YWwoZnJvbSwgdG8sIGFmdGVyKTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdH1cblxuXHRcdHRvLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZnJvbS5lbGVtZW50LCB0by5lbGVtZW50KTtcblxuXHRcdGlmIChhZnRlcikge1xuXG5cdFx0XHR0by5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRvLmVsZW1lbnQsIGZyb20uZWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5fdmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWluaXRpYWxpemUoKTtcblx0fTtcblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5tb3ZlQ29sdW1uQWN0dWFsID0gZnVuY3Rpb24gKGZyb20sIHRvLCBhZnRlcikge1xuXG5cdFx0aWYgKGZyb20ucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0dGhpcy5fbW92ZUNvbHVtbkluQXJyYXkoZnJvbS5wYXJlbnQuY29sdW1ucywgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLl9tb3ZlQ29sdW1uSW5BcnJheSh0aGlzLmNvbHVtbnMsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0fVxuXG5cdFx0dGhpcy5fbW92ZUNvbHVtbkluQXJyYXkodGhpcy5jb2x1bW5zQnlJbmRleCwgZnJvbSwgdG8sIGFmdGVyLCB0cnVlKTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uTW92ZWQpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbk1vdmVkLmNhbGwodGhpcy50YWJsZSwgZnJvbS5nZXRDb21wb25lbnQoKSwgdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbXBvbmVudHMoKSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuY29sdW1ucykge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImNvbHVtbnNcIik7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLl9tb3ZlQ29sdW1uSW5BcnJheSA9IGZ1bmN0aW9uIChjb2x1bW5zLCBmcm9tLCB0bywgYWZ0ZXIsIHVwZGF0ZVJvd3MpIHtcblxuXHRcdHZhciBmcm9tSW5kZXggPSBjb2x1bW5zLmluZGV4T2YoZnJvbSksXG5cdFx0ICAgIHRvSW5kZXg7XG5cblx0XHRpZiAoZnJvbUluZGV4ID4gLTEpIHtcblxuXHRcdFx0Y29sdW1ucy5zcGxpY2UoZnJvbUluZGV4LCAxKTtcblxuXHRcdFx0dG9JbmRleCA9IGNvbHVtbnMuaW5kZXhPZih0byk7XG5cblx0XHRcdGlmICh0b0luZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRpZiAoYWZ0ZXIpIHtcblxuXHRcdFx0XHRcdHRvSW5kZXggPSB0b0luZGV4ICsgMTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0b0luZGV4ID0gZnJvbUluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRjb2x1bW5zLnNwbGljZSh0b0luZGV4LCAwLCBmcm9tKTtcblxuXHRcdFx0aWYgKHVwZGF0ZVJvd3MpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0XHRcdGlmIChyb3cuY2VsbHMubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRcdHZhciBjZWxsID0gcm93LmNlbGxzLnNwbGljZShmcm9tSW5kZXgsIDEpWzBdO1xuXG5cdFx0XHRcdFx0XHRyb3cuY2VsbHMuc3BsaWNlKHRvSW5kZXgsIDAsIGNlbGwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbk1hbmFnZXIucHJvdG90eXBlLnNjcm9sbFRvQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbiwgcG9zaXRpb24sIGlmVmlzaWJsZSkge1xuXHRcdHZhciBfdGhpczIgPSB0aGlzO1xuXG5cdFx0dmFyIGxlZnQgPSAwLFxuXHRcdCAgICBvZmZzZXQgPSAwLFxuXHRcdCAgICBhZGp1c3QgPSAwLFxuXHRcdCAgICBjb2xFbCA9IGNvbHVtbi5nZXRFbGVtZW50KCk7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAodHlwZW9mIHBvc2l0aW9uID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0cG9zaXRpb24gPSBfdGhpczIudGFibGUub3B0aW9ucy5zY3JvbGxUb0NvbHVtblBvc2l0aW9uO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGlmVmlzaWJsZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdGlmVmlzaWJsZSA9IF90aGlzMi50YWJsZS5vcHRpb25zLnNjcm9sbFRvQ29sdW1uSWZWaXNpYmxlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHQvL2FsaWduIHRvIGNvcnJlY3QgcG9zaXRpb25cblxuXG5cdFx0XHRcdHN3aXRjaCAocG9zaXRpb24pIHtcblxuXHRcdFx0XHRcdGNhc2UgXCJtaWRkbGVcIjpcblxuXHRcdFx0XHRcdGNhc2UgXCJjZW50ZXJcIjpcblxuXHRcdFx0XHRcdFx0YWRqdXN0ID0gLV90aGlzMi5lbGVtZW50LmNsaWVudFdpZHRoIC8gMjtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwicmlnaHRcIjpcblxuXHRcdFx0XHRcdFx0YWRqdXN0ID0gY29sRWwuY2xpZW50V2lkdGggLSBfdGhpczIuaGVhZGVyc0VsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2NoZWNrIGNvbHVtbiB2aXNpYmlsaXR5XG5cblxuXHRcdFx0XHRpZiAoIWlmVmlzaWJsZSkge1xuXG5cdFx0XHRcdFx0b2Zmc2V0ID0gY29sRWwub2Zmc2V0TGVmdDtcblxuXHRcdFx0XHRcdGlmIChvZmZzZXQgPiAwICYmIG9mZnNldCArIGNvbEVsLm9mZnNldFdpZHRoIDwgX3RoaXMyLmVsZW1lbnQuY2xpZW50V2lkdGgpIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vY2FsY3VsYXRlIHNjcm9sbCBwb3NpdGlvblxuXG5cblx0XHRcdFx0bGVmdCA9IGNvbEVsLm9mZnNldExlZnQgKyBfdGhpczIuZWxlbWVudC5zY3JvbGxMZWZ0ICsgYWRqdXN0O1xuXG5cdFx0XHRcdGxlZnQgPSBNYXRoLm1heChNYXRoLm1pbihsZWZ0LCBfdGhpczIudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFdpZHRoIC0gX3RoaXMyLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aCksIDApO1xuXG5cdFx0XHRcdF90aGlzMi50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cblx0XHRcdFx0X3RoaXMyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTY3JvbGwgRXJyb3IgLSBDb2x1bW4gbm90IHZpc2libGVcIik7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gQ29sdW1uIG5vdCB2aXNpYmxlXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gQ2VsbCBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5nZW5lcmF0ZUNlbGxzID0gZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIGNlbGxzID0gW107XG5cblx0XHRzZWxmLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRjZWxscy5wdXNoKGNvbHVtbi5nZW5lcmF0ZUNlbGwocm93KSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gY2VsbHM7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBDb2x1bW4gTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZ2V0RmxleEJhc2VXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgdG90YWxXaWR0aCA9IHNlbGYudGFibGUuZWxlbWVudC5jbGllbnRXaWR0aCxcblx0XHQgICAgLy90YWJsZSBlbGVtZW50IHdpZHRoXG5cblxuXHRcdGZpeGVkV2lkdGggPSAwO1xuXG5cdFx0Ly9hZGp1c3QgZm9yIHZlcnRpY2FsIHNjcm9sbGJhciBpZiBwcmVzZW50XG5cblxuXHRcdGlmIChzZWxmLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQgPiBzZWxmLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcblxuXHRcdFx0dG90YWxXaWR0aCAtPSBzZWxmLnJvd01hbmFnZXIuZWxlbWVudC5vZmZzZXRXaWR0aCAtIHNlbGYucm93TWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoO1xuXHRcdH1cblxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdHZhciB3aWR0aCwgbWluV2lkdGgsIGNvbFdpZHRoO1xuXG5cdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHR3aWR0aCA9IGNvbHVtbi5kZWZpbml0aW9uLndpZHRoIHx8IDA7XG5cblx0XHRcdFx0bWluV2lkdGggPSB0eXBlb2YgY29sdW1uLm1pbldpZHRoID09IFwidW5kZWZpbmVkXCIgPyBzZWxmLnRhYmxlLm9wdGlvbnMuY29sdW1uTWluV2lkdGggOiBwYXJzZUludChjb2x1bW4ubWluV2lkdGgpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygd2lkdGggPT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdFx0aWYgKHdpZHRoLmluZGV4T2YoXCIlXCIpID4gLTEpIHtcblxuXHRcdFx0XHRcdFx0Y29sV2lkdGggPSB0b3RhbFdpZHRoIC8gMTAwICogcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNvbFdpZHRoID0gd2lkdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmaXhlZFdpZHRoICs9IGNvbFdpZHRoID4gbWluV2lkdGggPyBjb2xXaWR0aCA6IG1pbldpZHRoO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGZpeGVkV2lkdGg7XG5cdH07XG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuYWRkQ29sdW1uID0gZnVuY3Rpb24gKGRlZmluaXRpb24sIGJlZm9yZSwgbmV4dFRvQ29sdW1uKSB7XG5cdFx0dmFyIF90aGlzMyA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gX3RoaXMzLl9hZGRDb2x1bW4oZGVmaW5pdGlvbiwgYmVmb3JlLCBuZXh0VG9Db2x1bW4pO1xuXG5cdFx0XHRfdGhpczMuX3JlSW5kZXhDb2x1bW5zKCk7XG5cblx0XHRcdGlmIChfdGhpczMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIF90aGlzMy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0X3RoaXMzLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5pbml0aWFsaXplKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfdGhpczMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblxuXHRcdFx0XHRfdGhpczMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMy5yZWRyYXcoKTtcblxuXHRcdFx0aWYgKF90aGlzMy50YWJsZS5tb2R1bGVzLmxheW91dC5nZXRNb2RlKCkgIT0gXCJmaXRDb2x1bW5zXCIpIHtcblxuXHRcdFx0XHRjb2x1bW4ucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdH1cblxuXHRcdFx0X3RoaXMzLl92ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXG5cdFx0XHRfdGhpczMudGFibGUucm93TWFuYWdlci5yZWluaXRpYWxpemUoKTtcblxuXHRcdFx0cmVzb2x2ZShjb2x1bW4pO1xuXHRcdH0pO1xuXHR9O1xuXG5cdC8vcmVtb3ZlIGNvbHVtbiBmcm9tIHN5c3RlbVxuXG5cblx0Q29sdW1uTWFuYWdlci5wcm90b3R5cGUuZGVyZWdpc3RlckNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdHZhciBmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpLFxuXHRcdCAgICBpbmRleDtcblxuXHRcdC8vcmVtb3ZlIGZyb20gZmllbGQgbGlzdFxuXG5cblx0XHRpZiAoZmllbGQpIHtcblxuXHRcdFx0ZGVsZXRlIHRoaXMuY29sdW1uc0J5RmllbGRbZmllbGRdO1xuXHRcdH1cblxuXHRcdC8vcmVtb3ZlIGZyb20gaW5kZXggbGlzdFxuXG5cblx0XHRpbmRleCA9IHRoaXMuY29sdW1uc0J5SW5kZXguaW5kZXhPZihjb2x1bW4pO1xuXG5cdFx0aWYgKGluZGV4ID4gLTEpIHtcblxuXHRcdFx0dGhpcy5jb2x1bW5zQnlJbmRleC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblxuXHRcdC8vcmVtb3ZlIGZyb20gY29sdW1uIGxpc3RcblxuXG5cdFx0aW5kZXggPSB0aGlzLmNvbHVtbnMuaW5kZXhPZihjb2x1bW4pO1xuXG5cdFx0aWYgKGluZGV4ID4gLTEpIHtcblxuXHRcdFx0dGhpcy5jb2x1bW5zLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5yZWRyYXcoKTtcblx0fTtcblxuXHQvL3JlZHJhdyBjb2x1bW5zXG5cblxuXHRDb2x1bW5NYW5hZ2VyLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdGlmIChmb3JjZSkge1xuXG5cdFx0XHRpZiAoVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZSh0aGlzLmVsZW1lbnQpKSB7XG5cblx0XHRcdFx0dGhpcy5fdmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlc2V0U2Nyb2xsKCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAoW1wiZml0Q29sdW1uc1wiLCBcImZpdERhdGFTdHJldGNoXCJdLmluZGV4T2YodGhpcy50YWJsZS5tb2R1bGVzLmxheW91dC5nZXRNb2RlKCkpID4gLTEpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmxheW91dC5sYXlvdXQoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMubGF5b3V0LmxheW91dCgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC51cGRhdGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0KCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0fVxuXG5cdFx0aWYgKGZvcmNlKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmNvbHVtbnMpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImNvbHVtbnNcIik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlZHJhdygpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMudGFibGUuZm9vdGVyTWFuYWdlci5yZWRyYXcoKTtcblx0fTtcblxuXHQvL3B1YmxpYyBjb2x1bW4gb2JqZWN0XG5cblx0dmFyIENvbHVtbkNvbXBvbmVudCA9IGZ1bmN0aW9uIENvbHVtbkNvbXBvbmVudChjb2x1bW4pIHtcblxuXHRcdHRoaXMuX2NvbHVtbiA9IGNvbHVtbjtcblxuXHRcdHRoaXMudHlwZSA9IFwiQ29sdW1uQ29tcG9uZW50XCI7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXRFbGVtZW50KCk7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXREZWZpbml0aW9uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXREZWZpbml0aW9uKCk7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5nZXRGaWVsZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0RmllbGQoKTtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLmdldENlbGxzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGxzID0gW107XG5cblx0XHR0aGlzLl9jb2x1bW4uY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRjZWxscy5wdXNoKGNlbGwuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNlbGxzO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0VmlzaWJpbGl0eSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4udmlzaWJsZTtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLmlzR3JvdXApIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Y29sdW1uLnNob3coKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbi5zaG93KCk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9jb2x1bW4uaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4uY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4uaGlkZSgpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLmhpZGUoKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0dGhpcy5oaWRlKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5zaG93KCk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5kZWxldGUoKTtcblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLmdldFN1YkNvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLmNvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdHRoaXMuX2NvbHVtbi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0UGFyZW50Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5wYXJlbnQgaW5zdGFuY2VvZiBDb2x1bW4gPyB0aGlzLl9jb2x1bW4ucGFyZW50LmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5fZ2V0U2VsZiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5zY3JvbGxUbyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxUb0NvbHVtbih0aGlzLl9jb2x1bW4pO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0VGFibGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnRhYmxlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuaGVhZGVyRmlsdGVyRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4udGFibGUubW9kdWxlcy5maWx0ZXIuc2V0SGVhZGVyRmlsdGVyRm9jdXModGhpcy5fY29sdW1uKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5yZWxvYWRIZWFkZXJGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4udGFibGUubW9kdWxlcy5maWx0ZXIucmVsb2FkSGVhZGVyRmlsdGVyKHRoaXMuX2NvbHVtbik7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0SGVhZGVyRmlsdGVyVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fY29sdW1uLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4udGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0SGVhZGVyRmlsdGVyVmFsdWUodGhpcy5fY29sdW1uKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ29tcG9uZW50LnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0aWYgKHRoaXMuX2NvbHVtbi50YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fY29sdW1uLnRhYmxlLm1vZHVsZXMuZmlsdGVyLnNldEhlYWRlckZpbHRlclZhbHVlKHRoaXMuX2NvbHVtbiwgdmFsdWUpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5Db21wb25lbnQucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAodG8sIGFmdGVyKSB7XG5cblx0XHR2YXIgdG9Db2x1bW4gPSB0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblxuXHRcdGlmICh0b0NvbHVtbikge1xuXG5cdFx0XHR0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uKHRoaXMuX2NvbHVtbiwgdG9Db2x1bW4sIGFmdGVyKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCB0b0NvbHVtbik7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0TmV4dENvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBuZXh0Q29sID0gdGhpcy5fY29sdW1uLm5leHRDb2x1bW4oKTtcblxuXHRcdHJldHVybiBuZXh0Q29sID8gbmV4dENvbC5nZXRDb21wb25lbnQoKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUuZ2V0UHJldkNvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBwcmV2Q29sID0gdGhpcy5fY29sdW1uLnByZXZDb2x1bW4oKTtcblxuXHRcdHJldHVybiBwcmV2Q29sID8gcHJldkNvbC5nZXRDb21wb25lbnQoKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbkNvbXBvbmVudC5wcm90b3R5cGUudXBkYXRlRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICh1cGRhdGVzKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnVwZGF0ZURlZmluaXRpb24odXBkYXRlcyk7XG5cdH07XG5cblx0dmFyIENvbHVtbiA9IGZ1bmN0aW9uIENvbHVtbihkZWYsIHBhcmVudCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dGhpcy50YWJsZSA9IHBhcmVudC50YWJsZTtcblxuXHRcdHRoaXMuZGVmaW5pdGlvbiA9IGRlZjsgLy9jb2x1bW4gZGVmaW5pdGlvblxuXG5cdFx0dGhpcy5wYXJlbnQgPSBwYXJlbnQ7IC8vaG9sZCBwYXJlbnQgb2JqZWN0XG5cblx0XHR0aGlzLnR5cGUgPSBcImNvbHVtblwiOyAvL3R5cGUgb2YgZWxlbWVudFxuXG5cdFx0dGhpcy5jb2x1bW5zID0gW107IC8vY2hpbGQgY29sdW1uc1xuXG5cdFx0dGhpcy5jZWxscyA9IFtdOyAvL2NlbGxzIGJvdW5kIHRvIHRoaXMgY29sdW1uXG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTsgLy9jb2x1bW4gaGVhZGVyIGVsZW1lbnRcblxuXHRcdHRoaXMuY29udGVudEVsZW1lbnQgPSBmYWxzZTtcblxuXHRcdHRoaXMudGl0bGVFbGVtZW50ID0gZmFsc2U7XG5cblx0XHR0aGlzLmdyb3VwRWxlbWVudCA9IHRoaXMuY3JlYXRlR3JvdXBFbGVtZW50KCk7IC8vY29sdW1uIGdyb3VwIGhvbGRlciBlbGVtZW50XG5cblx0XHR0aGlzLmlzR3JvdXAgPSBmYWxzZTtcblxuXHRcdHRoaXMudG9vbHRpcCA9IGZhbHNlOyAvL2hvbGQgY29sdW1uIHRvb2x0aXBcblxuXHRcdHRoaXMuaG96QWxpZ24gPSBcIlwiOyAvL2hvcml6b250YWwgdGV4dCBhbGlnbm1lbnRcblxuXHRcdHRoaXMudmVydEFsaWduID0gXCJcIjsgLy92ZXJ0IHRleHQgYWxpZ25tZW50XG5cblxuXHRcdC8vbXVsdGkgZGltZW5zaW9uYWwgZmlsZWQgaGFuZGxpbmdcblxuXHRcdHRoaXMuZmllbGQgPSBcIlwiO1xuXG5cdFx0dGhpcy5maWVsZFN0cnVjdHVyZSA9IFwiXCI7XG5cblx0XHR0aGlzLmdldEZpZWxkVmFsdWUgPSBcIlwiO1xuXG5cdFx0dGhpcy5zZXRGaWVsZFZhbHVlID0gXCJcIjtcblxuXHRcdHRoaXMudGl0bGVGb3JtYXR0ZXJSZW5kZXJlZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5zZXRGaWVsZCh0aGlzLmRlZmluaXRpb24uZmllbGQpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5pbnZhbGlkT3B0aW9uV2FybmluZ3MpIHtcblxuXHRcdFx0dGhpcy5jaGVja0RlZmluaXRpb24oKTtcblx0XHR9XG5cblx0XHR0aGlzLm1vZHVsZXMgPSB7fTsgLy9ob2xkIG1vZHVsZSB2YXJpYWJsZXM7XG5cblxuXHRcdHRoaXMuY2VsbEV2ZW50cyA9IHtcblxuXHRcdFx0Y2VsbENsaWNrOiBmYWxzZSxcblxuXHRcdFx0Y2VsbERibENsaWNrOiBmYWxzZSxcblxuXHRcdFx0Y2VsbENvbnRleHQ6IGZhbHNlLFxuXG5cdFx0XHRjZWxsVGFwOiBmYWxzZSxcblxuXHRcdFx0Y2VsbERibFRhcDogZmFsc2UsXG5cblx0XHRcdGNlbGxUYXBIb2xkOiBmYWxzZSxcblxuXHRcdFx0Y2VsbE1vdXNlRW50ZXI6IGZhbHNlLFxuXG5cdFx0XHRjZWxsTW91c2VMZWF2ZTogZmFsc2UsXG5cblx0XHRcdGNlbGxNb3VzZU92ZXI6IGZhbHNlLFxuXG5cdFx0XHRjZWxsTW91c2VPdXQ6IGZhbHNlLFxuXG5cdFx0XHRjZWxsTW91c2VNb3ZlOiBmYWxzZVxuXG5cdFx0fTtcblxuXHRcdHRoaXMud2lkdGggPSBudWxsOyAvL2NvbHVtbiB3aWR0aFxuXG5cdFx0dGhpcy53aWR0aFN0eWxlZCA9IFwiXCI7IC8vY29sdW1uIHdpZHRoIHByZXN0eWxlZCB0byBpbXByb3ZlIHJlbmRlciBlZmZpY2llbmN5XG5cblx0XHR0aGlzLm1pbldpZHRoID0gbnVsbDsgLy9jb2x1bW4gbWluaW11bSB3aWR0aFxuXG5cdFx0dGhpcy5taW5XaWR0aFN0eWxlZCA9IFwiXCI7IC8vY29sdW1uIG1pbmltdW0gcHJlc3R5bGVkIHRvIGltcHJvdmUgcmVuZGVyIGVmZmljaWVuY3lcblxuXHRcdHRoaXMud2lkdGhGaXhlZCA9IGZhbHNlOyAvL3VzZXIgaGFzIHNwZWNpZmllZCBhIHdpZHRoIGZvciB0aGlzIGNvbHVtblxuXG5cblx0XHR0aGlzLnZpc2libGUgPSB0cnVlOyAvL2RlZmF1bHQgdmlzaWJsZSBzdGF0ZVxuXG5cblx0XHR0aGlzLl9tYXBEZXByaWNhdGVkRnVuY3Rpb25hbGl0eSgpO1xuXG5cdFx0Ly9pbml0aWFsaXplIGNvbHVtblxuXG5cdFx0aWYgKGRlZi5jb2x1bW5zKSB7XG5cblx0XHRcdHRoaXMuaXNHcm91cCA9IHRydWU7XG5cblx0XHRcdGRlZi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGRlZiwgaSkge1xuXG5cdFx0XHRcdHZhciBuZXdDb2wgPSBuZXcgQ29sdW1uKGRlZiwgc2VsZik7XG5cblx0XHRcdFx0c2VsZi5hdHRhY2hDb2x1bW4obmV3Q29sKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLmNoZWNrQ29sdW1uVmlzaWJpbGl0eSgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHBhcmVudC5yZWdpc3RlckNvbHVtbkZpZWxkKHRoaXMpO1xuXHRcdH1cblxuXHRcdGlmIChkZWYucm93SGFuZGxlICYmIHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93cyAhPT0gZmFsc2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtb3ZlUm93XCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5tb3ZlUm93LnNldEhhbmRsZSh0cnVlKTtcblx0XHR9XG5cblx0XHR0aGlzLl9idWlsZEhlYWRlcigpO1xuXG5cdFx0dGhpcy5iaW5kTW9kdWxlQ29sdW1ucygpO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbFwiKTtcblxuXHRcdGVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJjb2x1bW5oZWFkZXJcIik7XG5cblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgXCJub25lXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY3JlYXRlR3JvdXBFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLWdyb3VwLWNvbHNcIik7XG5cblx0XHRyZXR1cm4gZWw7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5jaGVja0RlZmluaXRpb24gPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNCA9IHRoaXM7XG5cblx0XHRPYmplY3Qua2V5cyh0aGlzLmRlZmluaXRpb24pLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXG5cdFx0XHRpZiAoX3RoaXM0LmRlZmF1bHRPcHRpb25MaXN0LmluZGV4T2Yoa2V5KSA9PT0gLTEpIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJJbnZhbGlkIGNvbHVtbiBkZWZpbml0aW9uIG9wdGlvbiBpbiAnXCIgKyAoX3RoaXM0LmZpZWxkIHx8IF90aGlzNC5kZWZpbml0aW9uLnRpdGxlKSArIFwiJyBjb2x1bW46XCIsIGtleSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5zZXRGaWVsZCA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXG5cdFx0dGhpcy5maWVsZCA9IGZpZWxkO1xuXG5cdFx0dGhpcy5maWVsZFN0cnVjdHVyZSA9IGZpZWxkID8gdGhpcy50YWJsZS5vcHRpb25zLm5lc3RlZEZpZWxkU2VwYXJhdG9yID8gZmllbGQuc3BsaXQodGhpcy50YWJsZS5vcHRpb25zLm5lc3RlZEZpZWxkU2VwYXJhdG9yKSA6IFtmaWVsZF0gOiBbXTtcblxuXHRcdHRoaXMuZ2V0RmllbGRWYWx1ZSA9IHRoaXMuZmllbGRTdHJ1Y3R1cmUubGVuZ3RoID4gMSA/IHRoaXMuX2dldE5lc3RlZERhdGEgOiB0aGlzLl9nZXRGbGF0RGF0YTtcblxuXHRcdHRoaXMuc2V0RmllbGRWYWx1ZSA9IHRoaXMuZmllbGRTdHJ1Y3R1cmUubGVuZ3RoID4gMSA/IHRoaXMuX3NldE5lc3RlZERhdGEgOiB0aGlzLl9zZXRGbGF0RGF0YTtcblx0fTtcblxuXHQvL3JlZ2lzdGVyIGNvbHVtbiBwb3NpdGlvbiB3aXRoIGNvbHVtbiBtYW5hZ2VyXG5cblx0Q29sdW1uLnByb3RvdHlwZS5yZWdpc3RlckNvbHVtblBvc2l0aW9uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0dGhpcy5wYXJlbnQucmVnaXN0ZXJDb2x1bW5Qb3NpdGlvbihjb2x1bW4pO1xuXHR9O1xuXG5cdC8vcmVnaXN0ZXIgY29sdW1uIHBvc2l0aW9uIHdpdGggY29sdW1uIG1hbmFnZXJcblxuXHRDb2x1bW4ucHJvdG90eXBlLnJlZ2lzdGVyQ29sdW1uRmllbGQgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHR0aGlzLnBhcmVudC5yZWdpc3RlckNvbHVtbkZpZWxkKGNvbHVtbik7XG5cdH07XG5cblx0Ly90cmlnZ2VyIHBvc2l0aW9uIHJlZ2lzdHJhdGlvblxuXG5cdENvbHVtbi5wcm90b3R5cGUucmVSZWdpc3RlclBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Y29sdW1uLnJlUmVnaXN0ZXJQb3NpdGlvbigpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5yZWdpc3RlckNvbHVtblBvc2l0aW9uKHRoaXMpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9tYXBEZXByaWNhdGVkRnVuY3Rpb25hbGl0eSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0eXBlb2YgdGhpcy5kZWZpbml0aW9uLmhpZGVJbkh0bWwgIT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0dGhpcy5kZWZpbml0aW9uLmh0bWxPdXRwdXQgPSAhdGhpcy5kZWZpbml0aW9uLmhpZGVJbkh0bWw7XG5cblx0XHRcdGNvbnNvbGUud2FybihcImhpZGVJbkh0bWwgY29sdW1uIGRlZmluaXRpb24gcHJvcGVydHkgaXMgZGVwcmVjYXRlZCwgeW91IHNob3VsZCBub3cgdXNlIGh0bWxPdXRwdXRcIik7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiB0aGlzLmRlZmluaXRpb24uYWxpZ24gIT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0dGhpcy5kZWZpbml0aW9uLmhvekFsaWduID0gdGhpcy5kZWZpbml0aW9uLmFsaWduO1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJhbGlnbiBjb2x1bW4gZGVmaW5pdGlvbiBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgaG96QWxpZ25cIik7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuc2V0VG9vbHRpcCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZGVmID0gc2VsZi5kZWZpbml0aW9uO1xuXG5cdFx0Ly9zZXQgaGVhZGVyIHRvb2x0aXBzXG5cblx0XHR2YXIgdG9vbHRpcCA9IGRlZi5oZWFkZXJUb29sdGlwIHx8IGRlZi50b29sdGlwID09PSBmYWxzZSA/IGRlZi5oZWFkZXJUb29sdGlwIDogc2VsZi50YWJsZS5vcHRpb25zLnRvb2x0aXBzSGVhZGVyO1xuXG5cdFx0aWYgKHRvb2x0aXApIHtcblxuXHRcdFx0aWYgKHRvb2x0aXAgPT09IHRydWUpIHtcblxuXHRcdFx0XHRpZiAoZGVmLmZpZWxkKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImNvbHVtbnN8XCIgKyBkZWYuZmllbGQsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUgfHwgZGVmLnRpdGxlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHNlbGYuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBkZWYudGl0bGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgdG9vbHRpcCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0XHRcdHRvb2x0aXAgPSB0b29sdGlwKHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXG5cdFx0XHRcdFx0aWYgKHRvb2x0aXAgPT09IGZhbHNlKSB7XG5cblx0XHRcdFx0XHRcdHRvb2x0aXAgPSBcIlwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB0b29sdGlwKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgXCJcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYnVpbGQgaGVhZGVyIGVsZW1lbnRcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9idWlsZEhlYWRlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZGVmID0gc2VsZi5kZWZpbml0aW9uO1xuXG5cdFx0d2hpbGUgKHNlbGYuZWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRzZWxmLmVsZW1lbnQucmVtb3ZlQ2hpbGQoc2VsZi5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH1pZiAoZGVmLmhlYWRlclZlcnRpY2FsKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC12ZXJ0aWNhbFwiKTtcblxuXHRcdFx0aWYgKGRlZi5oZWFkZXJWZXJ0aWNhbCA9PT0gXCJmbGlwXCIpIHtcblxuXHRcdFx0XHRzZWxmLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtdmVydGljYWwtZmxpcFwiKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRzZWxmLmNvbnRlbnRFbGVtZW50ID0gc2VsZi5fYmluZEV2ZW50cygpO1xuXG5cdFx0c2VsZi5jb250ZW50RWxlbWVudCA9IHNlbGYuX2J1aWxkQ29sdW1uSGVhZGVyQ29udGVudCgpO1xuXG5cdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHNlbGYuY29udGVudEVsZW1lbnQpO1xuXG5cdFx0aWYgKHNlbGYuaXNHcm91cCkge1xuXG5cdFx0XHRzZWxmLl9idWlsZEdyb3VwSGVhZGVyKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0c2VsZi5fYnVpbGRDb2x1bW5IZWFkZXIoKTtcblx0XHR9XG5cblx0XHRzZWxmLnNldFRvb2x0aXAoKTtcblxuXHRcdC8vc2V0IHJlc2l6YWJsZSBoYW5kbGVzXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZUNvbHVtbnMgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJyZXNpemVDb2x1bW5zXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5yZXNpemVDb2x1bW5zLmluaXRpYWxpemVDb2x1bW4oXCJoZWFkZXJcIiwgc2VsZiwgc2VsZi5lbGVtZW50KTtcblx0XHR9XG5cblx0XHQvL3NldCByZXNpemFibGUgaGFuZGxlc1xuXG5cdFx0aWYgKGRlZi5oZWFkZXJGaWx0ZXIgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIikgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cblx0XHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyICE9PSBcInVuZGVmaW5lZFwiICYmIGRlZi5maWVsZCkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5zZXRIZWFkZXJGaWx0ZXJDb2x1bW5QbGFjZWhvbGRlcihkZWYuZmllbGQsIGRlZi5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlcik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5maWx0ZXIuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCByZXNpemFibGUgaGFuZGxlc1xuXG5cdFx0aWYgKHNlbGYudGFibGUubW9kRXhpc3RzKFwiZnJvemVuQ29sdW1uc1wiKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IG1vdmFibGUgY29sdW1uXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLm1vdmFibGVDb2x1bW5zICYmICFzZWxmLmlzR3JvdXAgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJtb3ZlQ29sdW1uXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5tb3ZlQ29sdW1uLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY2FsY3MgY29sdW1uXG5cblx0XHRpZiAoKGRlZi50b3BDYWxjIHx8IGRlZi5ib3R0b21DYWxjKSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vaGFuZGxlIHBlcnNpc3RlbmNlXG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiKSAmJiBzZWxmLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmNvbHVtbnMpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly91cGRhdGUgaGVhZGVyIHRvb2x0aXAgb24gbW91c2UgZW50ZXJcblxuXHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRzZWxmLnNldFRvb2x0aXAoKTtcblx0XHR9KTtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9iaW5kRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYgPSBzZWxmLmRlZmluaXRpb24sXG5cdFx0ICAgIGRibFRhcCxcblx0XHQgICAgdGFwSG9sZCxcblx0XHQgICAgdGFwO1xuXG5cdFx0Ly9zZXR1cCBoZWFkZXIgY2xpY2sgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlckNsaWNrID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGRlZi5oZWFkZXJDbGljayhlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlckRibENsaWNrID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGRlZi5oZWFkZXJEYmxDbGljayhlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlckNvbnRleHQgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0ZGVmLmhlYWRlckNvbnRleHQoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvL3NldHVwIGhlYWRlciB0YXAgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlclRhcCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHRhcCA9IHRydWU7XG5cdFx0XHR9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRpZiAodGFwKSB7XG5cblx0XHRcdFx0XHRkZWYuaGVhZGVyVGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFwID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5oZWFkZXJEYmxUYXAgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRpZiAoZGJsVGFwKSB7XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQoZGJsVGFwKTtcblxuXHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdFx0XHRkZWYuaGVhZGVyRGJsVGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXG5cdFx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXHRcdFx0XHRcdH0sIDMwMCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmhlYWRlclRhcEhvbGQgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0dGFwSG9sZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cblx0XHRcdFx0XHR0YXAgPSBmYWxzZTtcblxuXHRcdFx0XHRcdGRlZi5oZWFkZXJUYXBIb2xkKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gbnVsbDtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vc3RvcmUgY29sdW1uIGNlbGwgY2xpY2sgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxDbGljayA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxDbGljayA9IGRlZi5jZWxsQ2xpY2s7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbERibENsaWNrID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbERibENsaWNrID0gZGVmLmNlbGxEYmxDbGljaztcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsQ29udGV4dCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxDb250ZXh0ID0gZGVmLmNlbGxDb250ZXh0O1xuXHRcdH1cblxuXHRcdC8vc3RvcmUgY29sdW1uIG1vdXNlIGV2ZW50IGJpbmRpbmdzXG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsTW91c2VFbnRlciA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxNb3VzZUVudGVyID0gZGVmLmNlbGxNb3VzZUVudGVyO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxNb3VzZUxlYXZlID09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRzZWxmLmNlbGxFdmVudHMuY2VsbE1vdXNlTGVhdmUgPSBkZWYuY2VsbE1vdXNlTGVhdmU7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbE1vdXNlT3ZlciA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxNb3VzZU92ZXIgPSBkZWYuY2VsbE1vdXNlT3Zlcjtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsTW91c2VPdXQgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsTW91c2VPdXQgPSBkZWYuY2VsbE1vdXNlT3V0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxNb3VzZU1vdmUgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsTW91c2VNb3ZlID0gZGVmLmNlbGxNb3VzZU1vdmU7XG5cdFx0fVxuXG5cdFx0Ly9zZXR1cCBjb2x1bW4gY2VsbCB0YXAgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxUYXAgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsVGFwID0gZGVmLmNlbGxUYXA7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbERibFRhcCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxEYmxUYXAgPSBkZWYuY2VsbERibFRhcDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsVGFwSG9sZCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxUYXBIb2xkID0gZGVmLmNlbGxUYXBIb2xkO1xuXHRcdH1cblxuXHRcdC8vc2V0dXAgY29sdW1uIGNlbGwgZWRpdCBjYWxsYmFja3NcblxuXHRcdGlmICh0eXBlb2YgZGVmLmNlbGxFZGl0ZWQgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsRWRpdGVkID0gZGVmLmNlbGxFZGl0ZWQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBkZWYuY2VsbEVkaXRpbmcgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdHNlbGYuY2VsbEV2ZW50cy5jZWxsRWRpdGluZyA9IGRlZi5jZWxsRWRpdGluZztcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGRlZi5jZWxsRWRpdENhbmNlbGxlZCA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0c2VsZi5jZWxsRXZlbnRzLmNlbGxFZGl0Q2FuY2VsbGVkID0gZGVmLmNlbGxFZGl0Q2FuY2VsbGVkO1xuXHRcdH1cblx0fTtcblxuXHQvL2J1aWxkIGhlYWRlciBlbGVtZW50IGZvciBoZWFkZXJcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9idWlsZENvbHVtbkhlYWRlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZGVmID0gc2VsZi5kZWZpbml0aW9uLFxuXHRcdCAgICB0YWJsZSA9IHNlbGYudGFibGUsXG5cdFx0ICAgIHNvcnRhYmxlO1xuXG5cdFx0Ly9zZXQgY29sdW1uIHNvcnRlclxuXG5cdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcInNvcnRcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy5zb3J0LmluaXRpYWxpemVDb2x1bW4oc2VsZiwgc2VsZi5jb250ZW50RWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIGhlYWRlciBjb250ZXh0IG1lbnVcblxuXHRcdGlmICgoZGVmLmhlYWRlckNvbnRleHRNZW51IHx8IGRlZi5oZWFkZXJNZW51KSAmJiB0YWJsZS5tb2RFeGlzdHMoXCJtZW51XCIpKSB7XG5cblx0XHRcdHRhYmxlLm1vZHVsZXMubWVudS5pbml0aWFsaXplQ29sdW1uSGVhZGVyKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtbiBmb3JtYXR0ZXJcblxuXHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy5mb3JtYXQuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gZWRpdG9yXG5cblx0XHRpZiAodHlwZW9mIGRlZi5lZGl0b3IgIT0gXCJ1bmRlZmluZWRcIiAmJiB0YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cblx0XHRcdHRhYmxlLm1vZHVsZXMuZWRpdC5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtIHZhbGlkYXRvclxuXG5cdFx0aWYgKHR5cGVvZiBkZWYudmFsaWRhdG9yICE9IFwidW5kZWZpbmVkXCIgJiYgdGFibGUubW9kRXhpc3RzKFwidmFsaWRhdGVcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy52YWxpZGF0ZS5pbml0aWFsaXplQ29sdW1uKHNlbGYpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtbiBtdXRhdG9yXG5cblx0XHRpZiAodGFibGUubW9kRXhpc3RzKFwibXV0YXRvclwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLm11dGF0b3IuaW5pdGlhbGl6ZUNvbHVtbihzZWxmKTtcblx0XHR9XG5cblx0XHQvL3NldCBjb2x1bW4gYWNjZXNzb3JcblxuXHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJhY2Nlc3NvclwiKSkge1xuXG5cdFx0XHR0YWJsZS5tb2R1bGVzLmFjY2Vzc29yLmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgcmVzcG92aXZlTGF5b3V0XG5cblx0XHRpZiAoX3R5cGVvZih0YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQpICYmIHRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIikpIHtcblxuXHRcdFx0dGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmluaXRpYWxpemVDb2x1bW4oc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIHZpc2liaWxpdHlcblxuXHRcdGlmICh0eXBlb2YgZGVmLnZpc2libGUgIT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRpZiAoZGVmLnZpc2libGUpIHtcblxuXHRcdFx0XHRzZWxmLnNob3codHJ1ZSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHNlbGYuaGlkZSh0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvL2FzaWduIGFkZGl0aW9uYWwgY3NzIGNsYXNzZXMgdG8gY29sdW1uIGhlYWRlclxuXG5cdFx0aWYgKGRlZi5jc3NDbGFzcykge1xuXG5cdFx0XHR2YXIgY2xhc3NlTmFtZXMgPSBkZWYuY3NzQ2xhc3Muc3BsaXQoXCIgXCIpO1xuXG5cdFx0XHRjbGFzc2VOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChjbGFzc05hbWUpIHtcblxuXHRcdFx0XHRzZWxmLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGRlZi5maWVsZCkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWZpZWxkXCIsIGRlZi5maWVsZCk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgbWluIHdpZHRoIGlmIHByZXNlbnRcblxuXHRcdHNlbGYuc2V0TWluV2lkdGgodHlwZW9mIGRlZi5taW5XaWR0aCA9PSBcInVuZGVmaW5lZFwiID8gc2VsZi50YWJsZS5vcHRpb25zLmNvbHVtbk1pbldpZHRoIDogcGFyc2VJbnQoZGVmLm1pbldpZHRoKSk7XG5cblx0XHRzZWxmLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cblx0XHQvL3NldCB0b29sdGlwIGlmIHByZXNlbnRcblxuXHRcdHNlbGYudG9vbHRpcCA9IHNlbGYuZGVmaW5pdGlvbi50b29sdGlwIHx8IHNlbGYuZGVmaW5pdGlvbi50b29sdGlwID09PSBmYWxzZSA/IHNlbGYuZGVmaW5pdGlvbi50b29sdGlwIDogc2VsZi50YWJsZS5vcHRpb25zLnRvb2x0aXBzO1xuXG5cdFx0Ly9zZXQgb3Jpem9udGFsIHRleHQgYWxpZ25tZW50XG5cblx0XHRzZWxmLmhvekFsaWduID0gdHlwZW9mIHNlbGYuZGVmaW5pdGlvbi5ob3pBbGlnbiA9PSBcInVuZGVmaW5lZFwiID8gc2VsZi50YWJsZS5vcHRpb25zLmNlbGxIb3pBbGlnbiA6IHNlbGYuZGVmaW5pdGlvbi5ob3pBbGlnbjtcblxuXHRcdHNlbGYudmVydEFsaWduID0gdHlwZW9mIHNlbGYuZGVmaW5pdGlvbi52ZXJ0QWxpZ24gPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYudGFibGUub3B0aW9ucy5jZWxsVmVydEFsaWduIDogc2VsZi5kZWZpbml0aW9uLnZlcnRBbGlnbjtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9idWlsZENvbHVtbkhlYWRlckNvbnRlbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZGVmID0gc2VsZi5kZWZpbml0aW9uLFxuXHRcdCAgICB0YWJsZSA9IHNlbGYudGFibGU7XG5cblx0XHR2YXIgY29udGVudEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0Y29udGVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtY29udGVudFwiKTtcblxuXHRcdHRoaXMudGl0bGVFbGVtZW50ID0gdGhpcy5fYnVpbGRDb2x1bW5IZWFkZXJUaXRsZSgpO1xuXG5cdFx0Y29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50aXRsZUVsZW1lbnQpO1xuXG5cdFx0cmV0dXJuIGNvbnRlbnRFbGVtZW50O1xuXHR9O1xuXG5cdC8vYnVpbGQgdGl0bGUgZWxlbWVudCBvZiBjb2x1bW5cblxuXHRDb2x1bW4ucHJvdG90eXBlLl9idWlsZENvbHVtbkhlYWRlclRpdGxlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYgPSBzZWxmLmRlZmluaXRpb24sXG5cdFx0ICAgIHRhYmxlID0gc2VsZi50YWJsZSxcblx0XHQgICAgdGl0bGU7XG5cblx0XHR2YXIgdGl0bGVIb2xkZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdHRpdGxlSG9sZGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC10aXRsZVwiKTtcblxuXHRcdGlmIChkZWYuZWRpdGFibGVUaXRsZSkge1xuXG5cdFx0XHR2YXIgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuXG5cdFx0XHR0aXRsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10aXRsZS1lZGl0b3JcIik7XG5cblx0XHRcdHRpdGxlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0XHRcdHRpdGxlRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRpdGxlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRkZWYudGl0bGUgPSB0aXRsZUVsZW1lbnQudmFsdWU7XG5cblx0XHRcdFx0dGFibGUub3B0aW9ucy5jb2x1bW5UaXRsZUNoYW5nZWQuY2FsbChzZWxmLnRhYmxlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aXRsZUhvbGRlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGVFbGVtZW50KTtcblxuXHRcdFx0aWYgKGRlZi5maWVsZCkge1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImNvbHVtbnN8XCIgKyBkZWYuZmllbGQsIGZ1bmN0aW9uICh0ZXh0KSB7XG5cblx0XHRcdFx0XHR0aXRsZUVsZW1lbnQudmFsdWUgPSB0ZXh0IHx8IGRlZi50aXRsZSB8fCBcIiZuYnNwO1wiO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGl0bGVFbGVtZW50LnZhbHVlID0gZGVmLnRpdGxlIHx8IFwiJm5ic3A7XCI7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGRlZi5maWVsZCkge1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImNvbHVtbnN8XCIgKyBkZWYuZmllbGQsIGZ1bmN0aW9uICh0ZXh0KSB7XG5cblx0XHRcdFx0XHRzZWxmLl9mb3JtYXRDb2x1bW5IZWFkZXJUaXRsZSh0aXRsZUhvbGRlckVsZW1lbnQsIHRleHQgfHwgZGVmLnRpdGxlIHx8IFwiJm5ic3A7XCIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0c2VsZi5fZm9ybWF0Q29sdW1uSGVhZGVyVGl0bGUodGl0bGVIb2xkZXJFbGVtZW50LCBkZWYudGl0bGUgfHwgXCImbmJzcDtcIik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRpdGxlSG9sZGVyRWxlbWVudDtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9mb3JtYXRDb2x1bW5IZWFkZXJUaXRsZSA9IGZ1bmN0aW9uIChlbCwgdGl0bGUpIHtcblx0XHR2YXIgX3RoaXM1ID0gdGhpcztcblxuXHRcdHZhciBmb3JtYXR0ZXIsIGNvbnRlbnRzLCBwYXJhbXMsIG1vY2tDZWxsLCBvblJlbmRlcmVkO1xuXG5cdFx0aWYgKHRoaXMuZGVmaW5pdGlvbi50aXRsZUZvcm1hdHRlciAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSkge1xuXG5cdFx0XHRmb3JtYXR0ZXIgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZm9ybWF0LmdldEZvcm1hdHRlcih0aGlzLmRlZmluaXRpb24udGl0bGVGb3JtYXR0ZXIpO1xuXG5cdFx0XHRvblJlbmRlcmVkID0gZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjaykge1xuXG5cdFx0XHRcdF90aGlzNS50aXRsZUZvcm1hdHRlclJlbmRlcmVkID0gY2FsbGJhY2s7XG5cdFx0XHR9O1xuXG5cdFx0XHRtb2NrQ2VsbCA9IHtcblxuXHRcdFx0XHRnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gdGl0bGU7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0Z2V0RWxlbWVudDogZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHtcblxuXHRcdFx0XHRcdHJldHVybiBlbDtcblx0XHRcdFx0fVxuXG5cdFx0XHR9O1xuXG5cdFx0XHRwYXJhbXMgPSB0aGlzLmRlZmluaXRpb24udGl0bGVGb3JtYXR0ZXJQYXJhbXMgfHwge307XG5cblx0XHRcdHBhcmFtcyA9IHR5cGVvZiBwYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IHBhcmFtcygpIDogcGFyYW1zO1xuXG5cdFx0XHRjb250ZW50cyA9IGZvcm1hdHRlci5jYWxsKHRoaXMudGFibGUubW9kdWxlcy5mb3JtYXQsIG1vY2tDZWxsLCBwYXJhbXMsIG9uUmVuZGVyZWQpO1xuXG5cdFx0XHRzd2l0Y2ggKHR5cGVvZiBjb250ZW50cyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoY29udGVudHMpKSB7XG5cblx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXG5cdFx0XHRcdFx0aWYgKGNvbnRlbnRzIGluc3RhbmNlb2YgTm9kZSkge1xuXG5cdFx0XHRcdFx0XHRlbC5hcHBlbmRDaGlsZChjb250ZW50cyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gXCJcIjtcblxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRm9ybWF0IEVycm9yIC0gVGl0bGUgZm9ybWF0dGVyIGhhcyByZXR1cm5lZCBhIHR5cGUgb2Ygb2JqZWN0LCB0aGUgb25seSB2YWxpZCBmb3JtYXR0ZXIgb2JqZWN0IHJldHVybiBpcyBhbiBpbnN0YW5jZSBvZiBOb2RlLCB0aGUgZm9ybWF0dGVyIHJldHVybmVkOlwiLCBjb250ZW50cyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXG5cdFx0XHRcdGNhc2UgXCJudWxsXCI6XG5cblx0XHRcdFx0XHRlbC5pbm5lckhUTUwgPSBcIlwiO1xuXG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0ZGVmYXVsdDpcblxuXHRcdFx0XHRcdGVsLmlubmVySFRNTCA9IGNvbnRlbnRzO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0ZWwuaW5uZXJIVE1MID0gdGl0bGU7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYnVpbGQgaGVhZGVyIGVsZW1lbnQgZm9yIGNvbHVtbiBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2J1aWxkR3JvdXBIZWFkZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNiA9IHRoaXM7XG5cblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtZ3JvdXBcIik7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImNvbHVtbmdyb3VwXCIpO1xuXG5cdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdGl0bGVcIiwgdGhpcy5kZWZpbml0aW9uLnRpdGxlKTtcblxuXHRcdC8vYXNpZ24gYWRkaXRpb25hbCBjc3MgY2xhc3NlcyB0byBjb2x1bW4gaGVhZGVyXG5cblx0XHRpZiAodGhpcy5kZWZpbml0aW9uLmNzc0NsYXNzKSB7XG5cblx0XHRcdHZhciBjbGFzc2VOYW1lcyA9IHRoaXMuZGVmaW5pdGlvbi5jc3NDbGFzcy5zcGxpdChcIiBcIik7XG5cblx0XHRcdGNsYXNzZU5hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuXG5cdFx0XHRcdF90aGlzNi5lbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmdyb3VwRWxlbWVudCk7XG5cdH07XG5cblx0Ly9mbGF0IGZpZWxkIGxvb2t1cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2dldEZsYXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcblxuXHRcdHJldHVybiBkYXRhW3RoaXMuZmllbGRdO1xuXHR9O1xuXG5cdC8vbmVzdGVkIGZpZWxkIGxvb2t1cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX2dldE5lc3RlZERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXG5cdFx0dmFyIGRhdGFPYmogPSBkYXRhLFxuXHRcdCAgICBzdHJ1Y3R1cmUgPSB0aGlzLmZpZWxkU3RydWN0dXJlLFxuXHRcdCAgICBsZW5ndGggPSBzdHJ1Y3R1cmUubGVuZ3RoLFxuXHRcdCAgICBvdXRwdXQ7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cblx0XHRcdGRhdGFPYmogPSBkYXRhT2JqW3N0cnVjdHVyZVtpXV07XG5cblx0XHRcdG91dHB1dCA9IGRhdGFPYmo7XG5cblx0XHRcdGlmICghZGF0YU9iaikge1xuXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Ly9mbGF0IGZpZWxkIHNldFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX3NldEZsYXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHZhbHVlKSB7XG5cblx0XHRpZiAodGhpcy5maWVsZCkge1xuXG5cdFx0XHRkYXRhW3RoaXMuZmllbGRdID0gdmFsdWU7XG5cdFx0fVxuXHR9O1xuXG5cdC8vbmVzdGVkIGZpZWxkIHNldFxuXG5cdENvbHVtbi5wcm90b3R5cGUuX3NldE5lc3RlZERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdmFsdWUpIHtcblxuXHRcdHZhciBkYXRhT2JqID0gZGF0YSxcblx0XHQgICAgc3RydWN0dXJlID0gdGhpcy5maWVsZFN0cnVjdHVyZSxcblx0XHQgICAgbGVuZ3RoID0gc3RydWN0dXJlLmxlbmd0aDtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblxuXHRcdFx0aWYgKGkgPT0gbGVuZ3RoIC0gMSkge1xuXG5cdFx0XHRcdGRhdGFPYmpbc3RydWN0dXJlW2ldXSA9IHZhbHVlO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoIWRhdGFPYmpbc3RydWN0dXJlW2ldXSkge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0XHRkYXRhT2JqW3N0cnVjdHVyZVtpXV0gPSB7fTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkYXRhT2JqID0gZGF0YU9ialtzdHJ1Y3R1cmVbaV1dO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL2F0dGFjaCBjb2x1bW4gdG8gdGhpcyBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuYXR0YWNoQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuZ3JvdXBFbGVtZW50KSB7XG5cblx0XHRcdHNlbGYuY29sdW1ucy5wdXNoKGNvbHVtbik7XG5cblx0XHRcdHNlbGYuZ3JvdXBFbGVtZW50LmFwcGVuZENoaWxkKGNvbHVtbi5nZXRFbGVtZW50KCkpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBXYXJuaW5nIC0gQ29sdW1uIGJlaW5nIGF0dGFjaGVkIHRvIGFub3RoZXIgY29sdW1uIGluc3RlYWQgb2YgY29sdW1uIGdyb3VwXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL3ZlcnRpY2FsbHkgYWxpZ24gaGVhZGVyIGluIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUudmVydGljYWxBbGlnbiA9IGZ1bmN0aW9uIChhbGlnbm1lbnQsIGhlaWdodCkge1xuXG5cdFx0Ly9jYWxjdWxhdGUgaGVpZ2h0IG9mIGNvbHVtbiBoZWFkZXIgYW5kIGdyb3VwIGhvbGRlciBlbGVtZW50XG5cblx0XHR2YXIgcGFyZW50SGVpZ2h0ID0gdGhpcy5wYXJlbnQuaXNHcm91cCA/IHRoaXMucGFyZW50LmdldEdyb3VwRWxlbWVudCgpLmNsaWVudEhlaWdodCA6IGhlaWdodCB8fCB0aGlzLnBhcmVudC5nZXRIZWFkZXJzRWxlbWVudCgpLmNsaWVudEhlaWdodDtcblxuXHRcdC8vIHZhciBwYXJlbnRIZWlnaHQgPSB0aGlzLnBhcmVudC5pc0dyb3VwID8gdGhpcy5wYXJlbnQuZ2V0R3JvdXBFbGVtZW50KCkuY2xpZW50SGVpZ2h0IDogdGhpcy5wYXJlbnQuZ2V0SGVhZGVyc0VsZW1lbnQoKS5jbGllbnRIZWlnaHQ7XG5cblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBwYXJlbnRIZWlnaHQgKyBcInB4XCI7XG5cblx0XHRpZiAodGhpcy5pc0dyb3VwKSB7XG5cblx0XHRcdHRoaXMuZ3JvdXBFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IHBhcmVudEhlaWdodCAtIHRoaXMuY29udGVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgXCJweFwiO1xuXHRcdH1cblxuXHRcdC8vdmVydGljYWxseSBhbGlnbiBjZWxsIGNvbnRlbnRzXG5cblx0XHRpZiAoIXRoaXMuaXNHcm91cCAmJiBhbGlnbm1lbnQgIT09IFwidG9wXCIpIHtcblxuXHRcdFx0aWYgKGFsaWdubWVudCA9PT0gXCJib3R0b21cIikge1xuXG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCAtIHRoaXMuY29udGVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUucGFkZGluZ1RvcCA9ICh0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdGhpcy5jb250ZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIC8gMiArIFwicHhcIjtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGNvbHVtbi52ZXJ0aWNhbEFsaWduKGFsaWdubWVudCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9jbGVhciB2ZXJ0aWNhbCBhbGlnbm1lbmV0XG5cblx0Q29sdW1uLnByb3RvdHlwZS5jbGVhclZlcnRpY2FsQWxpZ24gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUucGFkZGluZ1RvcCA9IFwiXCI7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIlwiO1xuXG5cdFx0dGhpcy5ncm91cEVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJcIjtcblxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0Y29sdW1uLmNsZWFyVmVydGljYWxBbGlnbigpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuYmluZE1vZHVsZUNvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHQvL2NoZWNrIGlmIHJvd251bSBmb3JtYXR0ZXIgaXMgYmVpbmcgdXNlZCBvbiBhIGNvbHVtblxuXG5cdFx0aWYgKHRoaXMuZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPT0gXCJyb3dudW1cIikge1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93TnVtQ29sdW1uID0gdGhpcztcblx0XHR9XG5cdH07XG5cblx0Ly8vLyBSZXRyZWl2ZSBDb2x1bW4gSW5mb3JtYXRpb24gLy8vL1xuXG5cblx0Ly9yZXR1cm4gY29sdW1uIGhlYWRlciBlbGVtZW50XG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fTtcblxuXHQvL3JldHVybiBjb2x1bm0gZ3JvdXAgZWxlbWVudFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0R3JvdXBFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZ3JvdXBFbGVtZW50O1xuXHR9O1xuXG5cdC8vcmV0dXJuIGZpZWxkIG5hbWVcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuZmllbGQ7XG5cdH07XG5cblx0Ly9yZXR1cm4gdGhlIGZpcnN0IGNvbHVtbiBpbiBhIGdyb3VwXG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRGaXJzdENvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICghdGhpcy5pc0dyb3VwKSB7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmICh0aGlzLmNvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdFx0cmV0dXJuIHRoaXMuY29sdW1uc1swXS5nZXRGaXJzdENvbHVtbigpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmV0dXJuIHRoZSBsYXN0IGNvbHVtbiBpbiBhIGdyb3VwXG5cblx0Q29sdW1uLnByb3RvdHlwZS5nZXRMYXN0Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKCF0aGlzLmlzR3JvdXApIHtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHRoaXMuY29sdW1ucy5sZW5ndGgpIHtcblxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zW3RoaXMuY29sdW1ucy5sZW5ndGggLSAxXS5nZXRMYXN0Q29sdW1uKCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgaW4gYSBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0Q29sdW1ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnM7XG5cdH07XG5cblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgaW4gYSBncm91cFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscztcblx0fTtcblxuXHQvL3JldHJlaXZlIHRoZSB0b3AgY29sdW1uIGluIGEgZ3JvdXAgb2YgY29sdW1uc1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0VG9wQ29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMucGFyZW50LmdldFRvcENvbHVtbigpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiBjb2x1bW4gZGVmaW5pdGlvbiBvYmplY3RcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldERlZmluaXRpb24gPSBmdW5jdGlvbiAodXBkYXRlQnJhbmNoZXMpIHtcblxuXHRcdHZhciBjb2xEZWZzID0gW107XG5cblx0XHRpZiAodGhpcy5pc0dyb3VwICYmIHVwZGF0ZUJyYW5jaGVzKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2xEZWZzLnB1c2goY29sdW1uLmdldERlZmluaXRpb24odHJ1ZSkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuZGVmaW5pdGlvbi5jb2x1bW5zID0gY29sRGVmcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5kZWZpbml0aW9uO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEFjdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdENvbHVtbi5wcm90b3R5cGUuY2hlY2tDb2x1bW5WaXNpYmlsaXR5ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHZpc2libGUgPSBmYWxzZTtcblxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0dmlzaWJsZSA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAodmlzaWJsZSkge1xuXG5cdFx0XHR0aGlzLnNob3coKTtcblxuXHRcdFx0dGhpcy5wYXJlbnQudGFibGUub3B0aW9ucy5jb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIGZhbHNlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLmhpZGUoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9zaG93IGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChzaWxlbnQsIHJlc3BvbnNpdmVUb2dnbGUpIHtcblxuXHRcdGlmICghdGhpcy52aXNpYmxlKSB7XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRydWU7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuXHRcdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLnBhcmVudC5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0Y2VsbC5zaG93KCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKCF0aGlzLmlzR3JvdXAgJiYgdGhpcy53aWR0aCA9PT0gbnVsbCkge1xuXG5cdFx0XHRcdHRoaXMucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLl92ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5jb2x1bW5zKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXJlc3BvbnNpdmVUb2dnbGUgJiYgdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlQ29sdW1uVmlzaWJpbGl0eSh0aGlzLCB0aGlzLnZpc2libGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNpbGVudCkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5wYXJlbnQuaXNHcm91cCkge1xuXG5cdFx0XHRcdHRoaXMucGFyZW50Lm1hdGNoQ2hpbGRXaWR0aHMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9oaWRlIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uIChzaWxlbnQsIHJlc3BvbnNpdmVUb2dnbGUpIHtcblxuXHRcdGlmICh0aGlzLnZpc2libGUpIHtcblxuXHRcdFx0dGhpcy52aXNpYmxlID0gZmFsc2U7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5fdmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblxuXHRcdFx0aWYgKHRoaXMucGFyZW50LmlzR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLnBhcmVudC5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0Y2VsbC5oaWRlKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuY29sdW1ucykge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFyZXNwb25zaXZlVG9nZ2xlICYmIHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZUNvbHVtblZpc2liaWxpdHkodGhpcywgdGhpcy52aXNpYmxlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFzaWxlbnQpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uVmlzaWJpbGl0eUNoYW5nZWQuY2FsbCh0aGlzLnRhYmxlLCB0aGlzLmdldENvbXBvbmVudCgpLCBmYWxzZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnBhcmVudC5pc0dyb3VwKSB7XG5cblx0XHRcdFx0dGhpcy5wYXJlbnQubWF0Y2hDaGlsZFdpZHRocygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLm1hdGNoQ2hpbGRXaWR0aHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2hpbGRXaWR0aCA9IDA7XG5cblx0XHRpZiAodGhpcy5jb250ZW50RWxlbWVudCAmJiB0aGlzLmNvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHRcdGNoaWxkV2lkdGggKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmNvbnRlbnRFbGVtZW50LnN0eWxlLm1heFdpZHRoID0gY2hpbGRXaWR0aCAtIDEgKyBcInB4XCI7XG5cblx0XHRcdGlmICh0aGlzLnBhcmVudC5pc0dyb3VwKSB7XG5cblx0XHRcdFx0dGhpcy5wYXJlbnQubWF0Y2hDaGlsZFdpZHRocygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLnNldFdpZHRoID0gZnVuY3Rpb24gKHdpZHRoKSB7XG5cblx0XHR0aGlzLndpZHRoRml4ZWQgPSB0cnVlO1xuXG5cdFx0dGhpcy5zZXRXaWR0aEFjdHVhbCh3aWR0aCk7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5zZXRXaWR0aEFjdHVhbCA9IGZ1bmN0aW9uICh3aWR0aCkge1xuXG5cdFx0aWYgKGlzTmFOKHdpZHRoKSkge1xuXG5cdFx0XHR3aWR0aCA9IE1hdGguZmxvb3IodGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwICogcGFyc2VJbnQod2lkdGgpKTtcblx0XHR9XG5cblx0XHR3aWR0aCA9IE1hdGgubWF4KHRoaXMubWluV2lkdGgsIHdpZHRoKTtcblxuXHRcdHRoaXMud2lkdGggPSB3aWR0aDtcblxuXHRcdHRoaXMud2lkdGhTdHlsZWQgPSB3aWR0aCA/IHdpZHRoICsgXCJweFwiIDogXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGhTdHlsZWQ7XG5cblx0XHRpZiAoIXRoaXMuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0XHRjZWxsLnNldFdpZHRoKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYXJlbnQuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLnBhcmVudC5tYXRjaENoaWxkV2lkdGhzKCk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgcmVzaXphYmxlIGhhbmRsZXNcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0KCk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY2hlY2tDZWxsSGVpZ2h0cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3dzID0gW107XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0aWYgKGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0aWYgKGNlbGwucm93LmdldEVsZW1lbnQoKS5vZmZzZXRQYXJlbnQgIT09IG51bGwpIHtcblxuXHRcdFx0XHRcdHJvd3MucHVzaChjZWxsLnJvdyk7XG5cblx0XHRcdFx0XHRjZWxsLnJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy5jYWxjSGVpZ2h0KCk7XG5cdFx0fSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgd2lkdGggPSAwO1xuXG5cdFx0aWYgKHRoaXMuaXNHcm91cCkge1xuXG5cdFx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHR3aWR0aCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0d2lkdGggPSB0aGlzLndpZHRoO1xuXHRcdH1cblxuXHRcdHJldHVybiB3aWR0aDtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuc2V0TWluV2lkdGggPSBmdW5jdGlvbiAobWluV2lkdGgpIHtcblxuXHRcdHRoaXMubWluV2lkdGggPSBtaW5XaWR0aDtcblxuXHRcdHRoaXMubWluV2lkdGhTdHlsZWQgPSBtaW5XaWR0aCA/IG1pbldpZHRoICsgXCJweFwiIDogXCJcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMubWluV2lkdGhTdHlsZWQ7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbC5zZXRNaW5XaWR0aCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczcgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKF90aGlzNy5pc0dyb3VwKSB7XG5cblx0XHRcdFx0X3RoaXM3LmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0XHRjb2x1bW4uZGVsZXRlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgY2VsbENvdW50ID0gX3RoaXM3LmNlbGxzLmxlbmd0aDtcblxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjZWxsQ291bnQ7IGkrKykge1xuXG5cdFx0XHRcdF90aGlzNy5jZWxsc1swXS5kZWxldGUoKTtcblx0XHRcdH1cblxuXHRcdFx0X3RoaXM3LmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChfdGhpczcuZWxlbWVudCk7XG5cblx0XHRcdF90aGlzNy50YWJsZS5jb2x1bW5NYW5hZ2VyLmRlcmVnaXN0ZXJDb2x1bW4oX3RoaXM3KTtcblxuXHRcdFx0cmVzb2x2ZSgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuY29sdW1uUmVuZGVyZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50aXRsZUZvcm1hdHRlclJlbmRlcmVkKSB7XG5cblx0XHRcdHRoaXMudGl0bGVGb3JtYXR0ZXJSZW5kZXJlZCgpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIENlbGwgTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Ly9nZW5lcmF0ZSBjZWxsIGZvciB0aGlzIGNvbHVtblxuXG5cdENvbHVtbi5wcm90b3R5cGUuZ2VuZXJhdGVDZWxsID0gZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIGNlbGwgPSBuZXcgQ2VsbChzZWxmLCByb3cpO1xuXG5cdFx0dGhpcy5jZWxscy5wdXNoKGNlbGwpO1xuXG5cdFx0cmV0dXJuIGNlbGw7XG5cdH07XG5cblx0Q29sdW1uLnByb3RvdHlwZS5uZXh0Q29sdW1uID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW5JbmRleCh0aGlzKTtcblxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5fbmV4dFZpc2libGVDb2x1bW4oaW5kZXggKyAxKSA6IGZhbHNlO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUuX25leHRWaXNpYmxlQ29sdW1uID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5SW5kZXgoaW5kZXgpO1xuXG5cdFx0cmV0dXJuICFjb2x1bW4gfHwgY29sdW1uLnZpc2libGUgPyBjb2x1bW4gOiB0aGlzLl9uZXh0VmlzaWJsZUNvbHVtbihpbmRleCArIDEpO1xuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUucHJldkNvbHVtbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uSW5kZXgodGhpcyk7XG5cblx0XHRyZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMuX3ByZXZWaXNpYmxlQ29sdW1uKGluZGV4IC0gMSkgOiBmYWxzZTtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLl9wcmV2VmlzaWJsZUNvbHVtbiA9IGZ1bmN0aW9uIChpbmRleCkge1xuXG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUluZGV4KGluZGV4KTtcblxuXHRcdHJldHVybiAhY29sdW1uIHx8IGNvbHVtbi52aXNpYmxlID8gY29sdW1uIDogdGhpcy5fcHJldlZpc2libGVDb2x1bW4oaW5kZXggLSAxKTtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLnJlaW5pdGlhbGl6ZVdpZHRoID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cblx0XHR0aGlzLndpZHRoRml4ZWQgPSBmYWxzZTtcblxuXHRcdC8vc2V0IHdpZHRoIGlmIHByZXNlbnRcblxuXHRcdGlmICh0eXBlb2YgdGhpcy5kZWZpbml0aW9uLndpZHRoICE9PSBcInVuZGVmaW5lZFwiICYmICFmb3JjZSkge1xuXG5cdFx0XHR0aGlzLnNldFdpZHRoKHRoaXMuZGVmaW5pdGlvbi53aWR0aCk7XG5cdFx0fVxuXG5cdFx0Ly9oaWRlIGhlYWRlciBmaWx0ZXJzIHRvIHByZXZlbnQgdGhlbSBhbHRlcmluZyBjb2x1bW4gd2lkdGhcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZmlsdGVyLmhpZGVIZWFkZXJGaWx0ZXJFbGVtZW50cygpO1xuXHRcdH1cblxuXHRcdHRoaXMuZml0VG9EYXRhKCk7XG5cblx0XHQvL3Nob3cgaGVhZGVyIGZpbHRlcnMgYWdhaW4gYWZ0ZXIgbGF5b3V0IGlzIGNvbXBsZXRlXG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZpbHRlci5zaG93SGVhZGVyRmlsdGVyRWxlbWVudHMoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXQgY29sdW1uIHdpZHRoIHRvIG1heGltdW0gY2VsbCB3aWR0aFxuXG5cdENvbHVtbi5wcm90b3R5cGUuZml0VG9EYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKCF0aGlzLndpZHRoRml4ZWQpIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gXCJcIjtcblxuXHRcdFx0c2VsZi5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdFx0Y2VsbC5jbGVhcldpZHRoKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHR2YXIgbWF4V2lkdGggPSB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cblx0XHRpZiAoIXNlbGYud2lkdGggfHwgIXRoaXMud2lkdGhGaXhlZCkge1xuXG5cdFx0XHRzZWxmLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0XHR2YXIgd2lkdGggPSBjZWxsLmdldFdpZHRoKCk7XG5cblx0XHRcdFx0aWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcblxuXHRcdFx0XHRcdG1heFdpZHRoID0gd2lkdGg7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAobWF4V2lkdGgpIHtcblxuXHRcdFx0XHRzZWxmLnNldFdpZHRoQWN0dWFsKG1heFdpZHRoICsgMSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbi5wcm90b3R5cGUudXBkYXRlRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICh1cGRhdGVzKSB7XG5cdFx0dmFyIF90aGlzOCA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgZGVmaW5pdGlvbjtcblxuXHRcdFx0aWYgKCFfdGhpczguaXNHcm91cCkge1xuXG5cdFx0XHRcdGRlZmluaXRpb24gPSBPYmplY3QuYXNzaWduKHt9LCBfdGhpczguZ2V0RGVmaW5pdGlvbigpKTtcblxuXHRcdFx0XHRkZWZpbml0aW9uID0gT2JqZWN0LmFzc2lnbihkZWZpbml0aW9uLCB1cGRhdGVzKTtcblxuXHRcdFx0XHRfdGhpczgudGFibGUuY29sdW1uTWFuYWdlci5hZGRDb2x1bW4oZGVmaW5pdGlvbiwgZmFsc2UsIF90aGlzOCkudGhlbihmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0XHRpZiAoZGVmaW5pdGlvbi5maWVsZCA9PSBfdGhpczguZmllbGQpIHtcblxuXHRcdFx0XHRcdFx0X3RoaXM4LmZpZWxkID0gZmFsc2U7IC8vY2xlYWlyIGZpZWxkIG5hbWUgdG8gcHJldmVudCBkZWxldGlvbiBvZiBkdXBsaWNhdGUgY29sdW1uIGZyb20gYXJyYXlzXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X3RoaXM4LmRlbGV0ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0XHRyZXNvbHZlKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gVGhlIHVwZGF0ZURlZmludGlvbiBmdW5jdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSBvbiBjb2x1bW5zLCBub3QgY29sdW1uIGdyb3Vwc1wiKTtcblxuXHRcdFx0XHRyZWplY3QoXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gVGhlIHVwZGF0ZURlZmludGlvbiBmdW5jdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSBvbiBjb2x1bW5zLCBub3QgY29sdW1uIGdyb3Vwc1wiKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLmRlbGV0ZUNlbGwgPSBmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGNlbGwpO1xuXG5cdFx0aWYgKGluZGV4ID4gLTEpIHtcblxuXHRcdFx0dGhpcy5jZWxscy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW4ucHJvdG90eXBlLmRlZmF1bHRPcHRpb25MaXN0ID0gW1widGl0bGVcIiwgXCJmaWVsZFwiLCBcImNvbHVtbnNcIiwgXCJ2aXNpYmxlXCIsIFwiYWxpZ25cIiwgXCJob3pBbGlnblwiLCBcInZlcnRBbGlnblwiLCBcIndpZHRoXCIsIFwibWluV2lkdGhcIiwgXCJ3aWR0aEdyb3dcIiwgXCJ3aWR0aFNocmlua1wiLCBcInJlc2l6YWJsZVwiLCBcImZyb3plblwiLCBcInJlc3BvbnNpdmVcIiwgXCJ0b29sdGlwXCIsIFwiY3NzQ2xhc3NcIiwgXCJyb3dIYW5kbGVcIiwgXCJoaWRlSW5IdG1sXCIsIFwicHJpbnRcIiwgXCJodG1sT3V0cHV0XCIsIFwic29ydGVyXCIsIFwic29ydGVyUGFyYW1zXCIsIFwiZm9ybWF0dGVyXCIsIFwiZm9ybWF0dGVyUGFyYW1zXCIsIFwidmFyaWFibGVIZWlnaHRcIiwgXCJlZGl0YWJsZVwiLCBcImVkaXRvclwiLCBcImVkaXRvclBhcmFtc1wiLCBcInZhbGlkYXRvclwiLCBcIm11dGF0b3JcIiwgXCJtdXRhdG9yUGFyYW1zXCIsIFwibXV0YXRvckRhdGFcIiwgXCJtdXRhdG9yRGF0YVBhcmFtc1wiLCBcIm11dGF0b3JFZGl0XCIsIFwibXV0YXRvckVkaXRQYXJhbXNcIiwgXCJtdXRhdG9yQ2xpcGJvYXJkXCIsIFwibXV0YXRvckNsaXBib2FyZFBhcmFtc1wiLCBcImFjY2Vzc29yXCIsIFwiYWNjZXNzb3JQYXJhbXNcIiwgXCJhY2Nlc3NvckRhdGFcIiwgXCJhY2Nlc3NvckRhdGFQYXJhbXNcIiwgXCJhY2Nlc3NvckRvd25sb2FkXCIsIFwiYWNjZXNzb3JEb3dubG9hZFBhcmFtc1wiLCBcImFjY2Vzc29yQ2xpcGJvYXJkXCIsIFwiYWNjZXNzb3JDbGlwYm9hcmRQYXJhbXNcIiwgXCJhY2Nlc3NvclByaW50XCIsIFwiYWNjZXNzb3JQcmludFBhcmFtc1wiLCBcImFjY2Vzc29ySHRtbE91dHB1dFwiLCBcImFjY2Vzc29ySHRtbE91dHB1dFBhcmFtc1wiLCBcImNsaXBib2FyZFwiLCBcImRvd25sb2FkXCIsIFwiZG93bmxvYWRUaXRsZVwiLCBcInRvcENhbGNcIiwgXCJ0b3BDYWxjUGFyYW1zXCIsIFwidG9wQ2FsY0Zvcm1hdHRlclwiLCBcInRvcENhbGNGb3JtYXR0ZXJQYXJhbXNcIiwgXCJib3R0b21DYWxjXCIsIFwiYm90dG9tQ2FsY1BhcmFtc1wiLCBcImJvdHRvbUNhbGNGb3JtYXR0ZXJcIiwgXCJib3R0b21DYWxjRm9ybWF0dGVyUGFyYW1zXCIsIFwiY2VsbENsaWNrXCIsIFwiY2VsbERibENsaWNrXCIsIFwiY2VsbENvbnRleHRcIiwgXCJjZWxsVGFwXCIsIFwiY2VsbERibFRhcFwiLCBcImNlbGxUYXBIb2xkXCIsIFwiY2VsbE1vdXNlRW50ZXJcIiwgXCJjZWxsTW91c2VMZWF2ZVwiLCBcImNlbGxNb3VzZU92ZXJcIiwgXCJjZWxsTW91c2VPdXRcIiwgXCJjZWxsTW91c2VNb3ZlXCIsIFwiY2VsbEVkaXRpbmdcIiwgXCJjZWxsRWRpdGVkXCIsIFwiY2VsbEVkaXRDYW5jZWxsZWRcIiwgXCJoZWFkZXJTb3J0XCIsIFwiaGVhZGVyU29ydFN0YXJ0aW5nRGlyXCIsIFwiaGVhZGVyU29ydFRyaXN0YXRlXCIsIFwiaGVhZGVyQ2xpY2tcIiwgXCJoZWFkZXJEYmxDbGlja1wiLCBcImhlYWRlckNvbnRleHRcIiwgXCJoZWFkZXJUYXBcIiwgXCJoZWFkZXJEYmxUYXBcIiwgXCJoZWFkZXJUYXBIb2xkXCIsIFwiaGVhZGVyVG9vbHRpcFwiLCBcImhlYWRlclZlcnRpY2FsXCIsIFwiZWRpdGFibGVUaXRsZVwiLCBcInRpdGxlRm9ybWF0dGVyXCIsIFwidGl0bGVGb3JtYXR0ZXJQYXJhbXNcIiwgXCJoZWFkZXJGaWx0ZXJcIiwgXCJoZWFkZXJGaWx0ZXJQbGFjZWhvbGRlclwiLCBcImhlYWRlckZpbHRlclBhcmFtc1wiLCBcImhlYWRlckZpbHRlckVtcHR5Q2hlY2tcIiwgXCJoZWFkZXJGaWx0ZXJGdW5jXCIsIFwiaGVhZGVyRmlsdGVyRnVuY1BhcmFtc1wiLCBcImhlYWRlckZpbHRlckxpdmVGaWx0ZXJcIiwgXCJwcmludFwiLCBcImhlYWRlckNvbnRleHRNZW51XCIsIFwiaGVhZGVyTWVudVwiLCBcImNvbnRleHRNZW51XCIsIFwiZm9ybWF0dGVyUHJpbnRcIiwgXCJmb3JtYXR0ZXJQcmludFBhcmFtc1wiLCBcImZvcm1hdHRlckNsaXBib2FyZFwiLCBcImZvcm1hdHRlckNsaXBib2FyZFBhcmFtc1wiLCBcImZvcm1hdHRlckh0bWxPdXRwdXRcIiwgXCJmb3JtYXR0ZXJIdG1sT3V0cHV0UGFyYW1zXCJdO1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gRXZlbnQgQmluZGluZ3MgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vLy8vLy8vLy8vLy8vLy8gT2JqZWN0IEdlbmVyYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRDb2x1bW4ucHJvdG90eXBlLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiBuZXcgQ29sdW1uQ29tcG9uZW50KHRoaXMpO1xuXHR9O1xuXG5cdHZhciBSb3dNYW5hZ2VyID0gZnVuY3Rpb24gUm93TWFuYWdlcih0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVIb2xkZXJFbGVtZW50KCk7IC8vY29udGFpbmluZyBlbGVtZW50XG5cblx0XHR0aGlzLnRhYmxlRWxlbWVudCA9IHRoaXMuY3JlYXRlVGFibGVFbGVtZW50KCk7IC8vdGFibGUgZWxlbWVudFxuXG5cdFx0dGhpcy5oZWlnaHRGaXhlciA9IHRoaXMuY3JlYXRlVGFibGVFbGVtZW50KCk7IC8vdGFibGUgZWxlbWVudFxuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyID0gbnVsbDsgLy9ob2xkIGNvbHVtbiBtYW5hZ2VyIG9iamVjdFxuXG5cdFx0dGhpcy5oZWlnaHQgPSAwOyAvL2hvbGQgaGVpZ2h0IG9mIHRhYmxlIGVsZW1lbnRcblxuXG5cdFx0dGhpcy5maXJzdFJlbmRlciA9IGZhbHNlOyAvL2hhbmRsZSBmaXJzdCByZW5kZXJcblxuXHRcdHRoaXMucmVuZGVyTW9kZSA9IFwidmlydHVhbFwiOyAvL2N1cnJlbnQgcmVuZGVyaW5nIG1vZGVcblxuXHRcdHRoaXMuZml4ZWRIZWlnaHQgPSBmYWxzZTsgLy9jdXJyZW50IHJlbmRlcmluZyBtb2RlXG5cblxuXHRcdHRoaXMucm93cyA9IFtdOyAvL2hvbGQgcm93IGRhdGEgb2JqZWN0c1xuXG5cdFx0dGhpcy5hY3RpdmVSb3dzID0gW107IC8vcm93cyBjdXJyZW50bHkgYXZhaWxhYmxlIHRvIG9uIGRpc3BsYXkgaW4gdGhlIHRhYmxlXG5cblx0XHR0aGlzLmFjdGl2ZVJvd3NDb3VudCA9IDA7IC8vY291bnQgb2YgYWN0aXZlIHJvd3NcblxuXG5cdFx0dGhpcy5kaXNwbGF5Um93cyA9IFtdOyAvL3Jvd3MgY3VycmVudGx5IG9uIGRpc3BsYXkgaW4gdGhlIHRhYmxlXG5cblx0XHR0aGlzLmRpc3BsYXlSb3dzQ291bnQgPSAwOyAvL2NvdW50IG9mIGRpc3BsYXkgcm93c1xuXG5cblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cblx0XHR0aGlzLnNjcm9sbExlZnQgPSAwO1xuXG5cdFx0dGhpcy52RG9tUm93SGVpZ2h0ID0gMjA7IC8vYXBwcm94aW1hdGlvbiBvZiByb3cgaGVpZ2h0cyBmb3IgcGFkZGluZ1xuXG5cblx0XHR0aGlzLnZEb21Ub3AgPSAwOyAvL2hvbGQgcG9zaXRpb24gZm9yIGZpcnN0IHJlbmRlcmVkIHJvdyBpbiB0aGUgdmlydHVhbCBET01cblxuXHRcdHRoaXMudkRvbUJvdHRvbSA9IDA7IC8vaG9sZCBwb3NzaXRpb24gZm9yIGxhc3QgcmVuZGVyZWQgcm93IGluIHRoZSB2aXJ0dWFsIERPTVxuXG5cblx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgPSAwOyAvL2xhc3Qgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSB2RG9tIHRvcDtcblxuXHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSA9IDA7IC8vbGFzdCBzY3JvbGwgcG9zaXRpb24gb2YgdGhlIHZEb20gYm90dG9tO1xuXG5cblx0XHR0aGlzLnZEb21Ub3BQYWQgPSAwOyAvL2hvbGQgdmFsdWUgb2YgcGFkZGluZyBmb3IgdG9wIG9mIHZpcnR1YWwgRE9NXG5cblx0XHR0aGlzLnZEb21Cb3R0b21QYWQgPSAwOyAvL2hvbGQgdmFsdWUgb2YgcGFkZGluZyBmb3IgYm90dG9tIG9mIHZpcnR1YWwgRE9NXG5cblxuXHRcdHRoaXMudkRvbU1heFJlbmRlckNoYWluID0gOTA7IC8vdGhlIG1heGltdW0gbnVtYmVyIG9mIGRvbSBlbGVtZW50cyB0aGF0IGNhbiBiZSByZW5kZXJlZCBpbiAxIGdvXG5cblxuXHRcdHRoaXMudkRvbVdpbmRvd0J1ZmZlciA9IDA7IC8vd2luZG93IHJvdyBidWZmZXIgYmVmb3JlIHJlbW92aW5nIGVsZW1lbnRzLCB0byBzbW9vdGggc2Nyb2xsaW5nXG5cblxuXHRcdHRoaXMudkRvbVdpbmRvd01pblRvdGFsUm93cyA9IDIwOyAvL21pbmltdW0gbnVtYmVyIG9mIHJvd3MgdG8gYmUgZ2VuZXJhdGVkIGluIHZpcnR1YWwgZG9tIChwcmV2ZW50IGJ1ZmZlcmluZyBpc3N1ZXMgb24gdGFibGVzIHdpdGggdGFsbCByb3dzKVxuXG5cdFx0dGhpcy52RG9tV2luZG93TWluTWFyZ2luUm93cyA9IDU7IC8vbWluaW11bSBudW1iZXIgb2Ygcm93cyB0byBiZSBnZW5lcmF0ZWQgaW4gdmlydHVhbCBkb20gbWFyZ2luXG5cblxuXHRcdHRoaXMudkRvbVRvcE5ld1Jvd3MgPSBbXTsgLy9yb3dzIHRvIG5vcm1hbGl6ZSBhZnRlciBhcHBlbmRpbmcgdG8gb3B0aW1pemUgcmVuZGVyIHNwZWVkXG5cblx0XHR0aGlzLnZEb21Cb3R0b21OZXdSb3dzID0gW107IC8vcm93cyB0byBub3JtYWxpemUgYWZ0ZXIgYXBwZW5kaW5nIHRvIG9wdGltaXplIHJlbmRlciBzcGVlZFxuXG5cblx0XHR0aGlzLnJvd051bUNvbHVtbiA9IGZhbHNlOyAvL2hvbGQgY29sdW1uIGNvbXBvbmVudCBmb3Igcm93IG51bWJlciBjb2x1bW5cblxuXG5cdFx0dGhpcy5yZWRyYXdCbG9jayA9IGZhbHNlOyAvL3ByZXZlbnQgcmVkcmF3cyB0byBhbGxvdyBtdWx0aXBsZSBkYXRhIG1hbmlwdWxhdGlvbnMgYmVjb3JlIGNvbnRpbnVpbmdcblxuXHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0gZmFsc2U7IC8vc3RvcmUgbGF0ZXN0IHJlZHJhdyBmdW5jdGlvbiBjYWxscyBmb3Igd2hlbiByZWRyYXcgaXMgbmVlZGVkXG5cblx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVkZXJJblBvc2l0aW9uID0gZmFsc2U7IC8vc3RvcmUgbGF0ZXN0IHJlZHJhdyBmdW5jdGlvbiBjYWxscyBmb3Igd2hlbiByZWRyYXcgaXMgbmVlZGVkXG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmNyZWF0ZUhvbGRlckVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10YWJsZUhvbGRlclwiKTtcblxuXHRcdGVsLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIDApO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmNyZWF0ZVRhYmxlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRhYmxlXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdC8vcmV0dXJuIGNvbnRhaW5pbmcgZWxlbWVudFxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdC8vcmV0dXJuIHRhYmxlIGVsZW1lbnRcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRUYWJsZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy50YWJsZUVsZW1lbnQ7XG5cdH07XG5cblx0Ly9yZXR1cm4gcG9zaXRpb24gb2Ygcm93IGluIHRhYmxlXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0Um93UG9zaXRpb24gPSBmdW5jdGlvbiAocm93LCBhY3RpdmUpIHtcblxuXHRcdGlmIChhY3RpdmUpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuYWN0aXZlUm93cy5pbmRleE9mKHJvdyk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vbGluayB0byBjb2x1bW4gbWFuYWdlclxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnNldENvbHVtbk1hbmFnZXIgPSBmdW5jdGlvbiAobWFuYWdlcikge1xuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyID0gbWFuYWdlcjtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0c2VsZi5zZXRSZW5kZXJNb2RlKCk7XG5cblx0XHQvL2luaXRpYWxpemUgbWFuYWdlclxuXG5cdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHNlbGYudGFibGVFbGVtZW50KTtcblxuXHRcdHNlbGYuZmlyc3RSZW5kZXIgPSB0cnVlO1xuXG5cdFx0Ly9zY3JvbGwgaGVhZGVyIGFsb25nIHdpdGggdGFibGUgYm9keVxuXG5cdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHR2YXIgbGVmdCA9IHNlbGYuZWxlbWVudC5zY3JvbGxMZWZ0O1xuXG5cdFx0XHQvL2hhbmRsZSBob3Jpem9udGFsIHNjcm9sbGluZ1xuXG5cdFx0XHRpZiAoc2VsZi5zY3JvbGxMZWZ0ICE9IGxlZnQpIHtcblxuXHRcdFx0XHRzZWxmLmNvbHVtbk1hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5ncm91cFJvd3Muc2Nyb2xsSGVhZGVycyhsZWZ0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3Muc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnNjcm9sbExlZnQgPSBsZWZ0O1xuXHRcdH0pO1xuXG5cdFx0Ly9oYW5kbGUgdmlydHVhbCBkb20gc2Nyb2xsaW5nXG5cblx0XHRpZiAodGhpcy5yZW5kZXJNb2RlID09PSBcInZpcnR1YWxcIikge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0dmFyIHRvcCA9IHNlbGYuZWxlbWVudC5zY3JvbGxUb3A7XG5cblx0XHRcdFx0dmFyIGRpciA9IHNlbGYuc2Nyb2xsVG9wID4gdG9wO1xuXG5cdFx0XHRcdC8vaGFuZGxlIHZlcmljYWwgc2Nyb2xsaW5nXG5cblx0XHRcdFx0aWYgKHNlbGYuc2Nyb2xsVG9wICE9IHRvcCkge1xuXG5cdFx0XHRcdFx0c2VsZi5zY3JvbGxUb3AgPSB0b3A7XG5cblx0XHRcdFx0XHRzZWxmLnNjcm9sbFZlcnRpY2FsKGRpcik7XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWQgPT0gXCJzY3JvbGxcIikge1xuXG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuYWpheC5uZXh0UGFnZShzZWxmLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gc2VsZi5lbGVtZW50LmNsaWVudEhlaWdodCAtIHRvcCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnNjcm9sbFZlcnRpY2FsKHRvcCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRzZWxmLnNjcm9sbFRvcCA9IHRvcDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLyBSb3cgTWFuaXB1bGF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZmluZFJvdyA9IGZ1bmN0aW9uIChzdWJqZWN0KSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoKHR5cGVvZiBzdWJqZWN0ID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihzdWJqZWN0KSkgPT0gXCJvYmplY3RcIikge1xuXG5cdFx0XHRpZiAoc3ViamVjdCBpbnN0YW5jZW9mIFJvdykge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyByb3cgZWxlbWVudFxuXG5cdFx0XHRcdHJldHVybiBzdWJqZWN0O1xuXHRcdFx0fSBlbHNlIGlmIChzdWJqZWN0IGluc3RhbmNlb2YgUm93Q29tcG9uZW50KSB7XG5cblx0XHRcdFx0Ly9zdWJqZWN0IGlzIHB1YmxpYyByb3cgY29tcG9uZW50XG5cblx0XHRcdFx0cmV0dXJuIHN1YmplY3QuX2dldFNlbGYoKSB8fCBmYWxzZTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHN1YmplY3QgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuXG5cdFx0XHRcdC8vc3ViamVjdCBpcyBhIEhUTUwgZWxlbWVudCBvZiB0aGUgcm93XG5cblx0XHRcdFx0dmFyIG1hdGNoID0gc2VsZi5yb3dzLmZpbmQoZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRcdFx0cmV0dXJuIHJvdy5lbGVtZW50ID09PSBzdWJqZWN0O1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Ygc3ViamVjdCA9PSBcInVuZGVmaW5lZFwiIHx8IHN1YmplY3QgPT09IG51bGwpIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdC8vc3ViamVjdCBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgaW5kZXggb2YgdGhlIHJvd1xuXG5cdFx0XHR2YXIgX21hdGNoID0gc2VsZi5yb3dzLmZpbmQoZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRcdHJldHVybiByb3cuZGF0YVtzZWxmLnRhYmxlLm9wdGlvbnMuaW5kZXhdID09IHN1YmplY3Q7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIF9tYXRjaCB8fCBmYWxzZTtcblx0XHR9XG5cblx0XHQvL2NhdGNoIGFsbCBmb3IgYW55IG90aGVyIHR5cGUgb2YgaW5wdXRcblxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFJvd0Zyb21EYXRhT2JqZWN0ID0gZnVuY3Rpb24gKGRhdGEpIHtcblxuXHRcdHZhciBtYXRjaCA9IHRoaXMucm93cy5maW5kKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0cmV0dXJuIHJvdy5kYXRhID09PSBkYXRhO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1hdGNoIHx8IGZhbHNlO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldFJvd0Zyb21Qb3NpdGlvbiA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgYWN0aXZlKSB7XG5cblx0XHRpZiAoYWN0aXZlKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLmFjdGl2ZVJvd3NbcG9zaXRpb25dO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnJvd3NbcG9zaXRpb25dO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zY3JvbGxUb1JvdyA9IGZ1bmN0aW9uIChyb3csIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXM5ID0gdGhpcztcblxuXHRcdHZhciByb3dJbmRleCA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKS5pbmRleE9mKHJvdyksXG5cdFx0ICAgIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKSxcblx0XHQgICAgcm93VG9wLFxuXHRcdCAgICBvZmZzZXQgPSAwO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHJvd0luZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRpZiAodHlwZW9mIHBvc2l0aW9uID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0XHRwb3NpdGlvbiA9IF90aGlzOS50YWJsZS5vcHRpb25zLnNjcm9sbFRvUm93UG9zaXRpb247XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIGlmVmlzaWJsZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0aWZWaXNpYmxlID0gX3RoaXM5LnRhYmxlLm9wdGlvbnMuc2Nyb2xsVG9Sb3dJZlZpc2libGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocG9zaXRpb24gPT09IFwibmVhcmVzdFwiKSB7XG5cblx0XHRcdFx0XHRzd2l0Y2ggKF90aGlzOS5yZW5kZXJNb2RlKSB7XG5cblx0XHRcdFx0XHRcdGNhc2UgXCJjbGFzc2ljXCI6XG5cblx0XHRcdFx0XHRcdFx0cm93VG9wID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KHJvd0VsKS50b3A7XG5cblx0XHRcdFx0XHRcdFx0cG9zaXRpb24gPSBNYXRoLmFicyhfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgLSByb3dUb3ApID4gTWF0aC5hYnMoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wICsgX3RoaXM5LmVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gcm93VG9wKSA/IFwiYm90dG9tXCIgOiBcInRvcFwiO1xuXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwidmlydHVhbFwiOlxuXG5cdFx0XHRcdFx0XHRcdHBvc2l0aW9uID0gTWF0aC5hYnMoX3RoaXM5LnZEb21Ub3AgLSByb3dJbmRleCkgPiBNYXRoLmFicyhfdGhpczkudkRvbUJvdHRvbSAtIHJvd0luZGV4KSA/IFwiYm90dG9tXCIgOiBcInRvcFwiO1xuXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9jaGVjayByb3cgdmlzaWJpbGl0eVxuXG5cdFx0XHRcdGlmICghaWZWaXNpYmxlKSB7XG5cblx0XHRcdFx0XHRpZiAoVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZShyb3dFbCkpIHtcblxuXHRcdFx0XHRcdFx0b2Zmc2V0ID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KHJvd0VsKS50b3AgLSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQoX3RoaXM5LmVsZW1lbnQpLnRvcDtcblxuXHRcdFx0XHRcdFx0aWYgKG9mZnNldCA+IDAgJiYgb2Zmc2V0IDwgX3RoaXM5LmVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gcm93RWwub2Zmc2V0SGVpZ2h0KSB7XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vc2Nyb2xsIHRvIHJvd1xuXG5cdFx0XHRcdHN3aXRjaCAoX3RoaXM5LnJlbmRlck1vZGUpIHtcblxuXHRcdFx0XHRcdGNhc2UgXCJjbGFzc2ljXCI6XG5cblx0XHRcdFx0XHRcdF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCA9IFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChyb3dFbCkudG9wIC0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KF90aGlzOS5lbGVtZW50KS50b3AgKyBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3A7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInZpcnR1YWxcIjpcblxuXHRcdFx0XHRcdFx0X3RoaXM5Ll92aXJ0dWFsUmVuZGVyRmlsbChyb3dJbmRleCwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2FsaWduIHRvIGNvcnJlY3QgcG9zaXRpb25cblxuXHRcdFx0XHRzd2l0Y2ggKHBvc2l0aW9uKSB7XG5cblx0XHRcdFx0XHRjYXNlIFwibWlkZGxlXCI6XG5cblx0XHRcdFx0XHRjYXNlIFwiY2VudGVyXCI6XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczkuZWxlbWVudC5zY3JvbGxIZWlnaHQgLSBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgPT0gX3RoaXM5LmVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XG5cblx0XHRcdFx0XHRcdFx0X3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wID0gX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wICsgKHJvd0VsLm9mZnNldFRvcCAtIF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCkgLSAoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gcm93RWwub2Zmc2V0VG9wKSAvIDI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCA9IF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCAtIF90aGlzOS5lbGVtZW50LmNsaWVudEhlaWdodCAvIDI7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImJvdHRvbVwiOlxuXG5cdFx0XHRcdFx0XHRpZiAoX3RoaXM5LmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gX3RoaXM5LmVsZW1lbnQuc2Nyb2xsVG9wID09IF90aGlzOS5lbGVtZW50LmNsaWVudEhlaWdodCkge1xuXG5cdFx0XHRcdFx0XHRcdF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCA9IF90aGlzOS5lbGVtZW50LnNjcm9sbFRvcCAtIChfdGhpczkuZWxlbWVudC5zY3JvbGxIZWlnaHQgLSByb3dFbC5vZmZzZXRUb3ApICsgcm93RWwub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgPSBfdGhpczkuZWxlbWVudC5zY3JvbGxUb3AgLSBfdGhpczkuZWxlbWVudC5jbGllbnRIZWlnaHQgKyByb3dFbC5vZmZzZXRIZWlnaHQ7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlNjcm9sbCBFcnJvciAtIFJvdyBub3QgdmlzaWJsZVwiKTtcblxuXHRcdFx0XHRyZWplY3QoXCJTY3JvbGwgRXJyb3IgLSBSb3cgbm90IHZpc2libGVcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vIERhdGEgSGFuZGxpbmcgLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHJlbmRlckluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKSB7XG5cdFx0dmFyIF90aGlzMTAgPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHJlbmRlckluUG9zaXRpb24gJiYgX3RoaXMxMC5nZXREaXNwbGF5Um93cygpLmxlbmd0aCkge1xuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbikge1xuXG5cdFx0XHRcdFx0c2VsZi5fc2V0RGF0YUFjdHVhbChkYXRhLCB0cnVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdF90aGlzMTAucmVSZW5kZXJJblBvc2l0aW9uKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5fc2V0RGF0YUFjdHVhbChkYXRhKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoX3RoaXMxMC50YWJsZS5vcHRpb25zLmF1dG9Db2x1bW5zICYmIGNvbHVtbnNDaGFuZ2VkKSB7XG5cblx0XHRcdFx0XHRfdGhpczEwLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2VuZXJhdGVDb2x1bW5zRnJvbVJvd0RhdGEoZGF0YSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRfdGhpczEwLnJlc2V0U2Nyb2xsKCk7XG5cblx0XHRcdFx0X3RoaXMxMC5fc2V0RGF0YUFjdHVhbChkYXRhKTtcblx0XHRcdH1cblxuXHRcdFx0cmVzb2x2ZSgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLl9zZXREYXRhQWN0dWFsID0gZnVuY3Rpb24gKGRhdGEsIHJlbmRlckluUG9zaXRpb24pIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYudGFibGUub3B0aW9ucy5kYXRhTG9hZGluZy5jYWxsKHRoaXMudGFibGUsIGRhdGEpO1xuXG5cdFx0dGhpcy5fd2lwZUVsZW1lbnRzKCk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5oaXN0b3J5LmNsZWFyKCk7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwic2VsZWN0Um93XCIpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5jbGVhclNlbGVjdGlvbkRhdGEoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLndhdGNoRGF0YShkYXRhKTtcblx0XHRcdH1cblxuXHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChkZWYsIGkpIHtcblxuXHRcdFx0XHRpZiAoZGVmICYmICh0eXBlb2YgZGVmID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihkZWYpKSA9PT0gXCJvYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dmFyIHJvdyA9IG5ldyBSb3coZGVmLCBzZWxmKTtcblxuXHRcdFx0XHRcdHNlbGYucm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJEYXRhIExvYWRpbmcgV2FybmluZyAtIEludmFsaWQgcm93IGRhdGEgZGV0ZWN0ZWQgYW5kIGlnbm9yZWQsIGV4cGVjdGluZyBvYmplY3QgYnV0IHJlY2VpdmVkOlwiLCBkZWYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmRhdGFMb2FkZWQuY2FsbCh0aGlzLnRhYmxlLCBkYXRhKTtcblxuXHRcdFx0c2VsZi5yZWZyZXNoQWN0aXZlRGF0YShmYWxzZSwgZmFsc2UsIHJlbmRlckluUG9zaXRpb24pO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJEYXRhIExvYWRpbmcgRXJyb3IgLSBVbmFibGUgdG8gcHJvY2VzcyBkYXRhIGR1ZSB0byBpbnZhbGlkIGRhdGEgdHlwZSBcXG5FeHBlY3Rpbmc6IGFycmF5IFxcblJlY2VpdmVkOiBcIiwgdHlwZW9mIGRhdGEgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGRhdGEpLCBcIlxcbkRhdGE6ICAgICBcIiwgZGF0YSk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLl93aXBlRWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy53aXBlKCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy53aXBlKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5yb3dzID0gW107XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZGVsZXRlUm93ID0gZnVuY3Rpb24gKHJvdywgYmxvY2tSZWRyYXcpIHtcblxuXHRcdHZhciBhbGxJbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyksXG5cdFx0ICAgIGFjdGl2ZUluZGV4ID0gdGhpcy5hY3RpdmVSb3dzLmluZGV4T2Yocm93KTtcblxuXHRcdGlmIChhY3RpdmVJbmRleCA+IC0xKSB7XG5cblx0XHRcdHRoaXMuYWN0aXZlUm93cy5zcGxpY2UoYWN0aXZlSW5kZXgsIDEpO1xuXHRcdH1cblxuXHRcdGlmIChhbGxJbmRleCA+IC0xKSB7XG5cblx0XHRcdHRoaXMucm93cy5zcGxpY2UoYWxsSW5kZXgsIDEpO1xuXHRcdH1cblxuXHRcdHRoaXMuc2V0QWN0aXZlUm93cyh0aGlzLmFjdGl2ZVJvd3MpO1xuXG5cdFx0dGhpcy5kaXNwbGF5Um93SXRlcmF0b3IoZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0dmFyIGRpc3BsYXlJbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuXG5cdFx0XHRpZiAoZGlzcGxheUluZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRyb3dzLnNwbGljZShkaXNwbGF5SW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKCFibG9ja1JlZHJhdykge1xuXG5cdFx0XHR0aGlzLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdH1cblxuXHRcdHRoaXMucmVnZW5lcmF0ZVJvd051bWJlcnMoKTtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5yb3dEZWxldGVkLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKTtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5kYXRhRWRpdGVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5nZXREYXRhKCkpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH0gZWxzZSBpZiAodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEoZmFsc2UsIGZhbHNlLCB0cnVlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdFx0dGhpcy5yZWZyZXNoQWN0aXZlRGF0YShcInBhZ2VcIik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmFkZFJvdyA9IGZ1bmN0aW9uIChkYXRhLCBwb3MsIGluZGV4LCBibG9ja1JlZHJhdykge1xuXG5cdFx0dmFyIHJvdyA9IHRoaXMuYWRkUm93QWN0dWFsKGRhdGEsIHBvcywgaW5kZXgsIGJsb2NrUmVkcmF3KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImhpc3RvcnlcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmhpc3RvcnkuYWN0aW9uKFwicm93QWRkXCIsIHJvdywgeyBkYXRhOiBkYXRhLCBwb3M6IHBvcywgaW5kZXg6IGluZGV4IH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiByb3c7XG5cdH07XG5cblx0Ly9hZGQgbXVsdGlwbGUgcm93c1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmFkZFJvd3MgPSBmdW5jdGlvbiAoZGF0YSwgcG9zLCBpbmRleCkge1xuXHRcdHZhciBfdGhpczExID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbGVuZ3RoID0gMCxcblx0XHQgICAgcm93cyA9IFtdO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0cG9zID0gX3RoaXMxMS5maW5kQWRkUm93UG9zKHBvcyk7XG5cblx0XHRcdGlmICghQXJyYXkuaXNBcnJheShkYXRhKSkge1xuXG5cdFx0XHRcdGRhdGEgPSBbZGF0YV07XG5cdFx0XHR9XG5cblx0XHRcdGxlbmd0aCA9IGRhdGEubGVuZ3RoIC0gMTtcblxuXHRcdFx0aWYgKHR5cGVvZiBpbmRleCA9PSBcInVuZGVmaW5lZFwiICYmIHBvcyB8fCB0eXBlb2YgaW5kZXggIT09IFwidW5kZWZpbmVkXCIgJiYgIXBvcykge1xuXG5cdFx0XHRcdGRhdGEucmV2ZXJzZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGkpIHtcblxuXHRcdFx0XHR2YXIgcm93ID0gc2VsZi5hZGRSb3coaXRlbSwgcG9zLCBpbmRleCwgdHJ1ZSk7XG5cblx0XHRcdFx0cm93cy5wdXNoKHJvdyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKF90aGlzMTEudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIF90aGlzMTEudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdFx0X3RoaXMxMS50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0XHR9IGVsc2UgaWYgKF90aGlzMTEudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uICYmIF90aGlzMTEudGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRcdF90aGlzMTEucmVmcmVzaEFjdGl2ZURhdGEoZmFsc2UsIGZhbHNlLCB0cnVlKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0X3RoaXMxMS5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9yZWNhbGMgY29sdW1uIGNhbGN1bGF0aW9ucyBpZiBwcmVzZW50XG5cblx0XHRcdGlmIChfdGhpczExLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0X3RoaXMxMS50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyhfdGhpczExLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMTEucmVnZW5lcmF0ZVJvd051bWJlcnMoKTtcblxuXHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHR9KTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5maW5kQWRkUm93UG9zID0gZnVuY3Rpb24gKHBvcykge1xuXG5cdFx0aWYgKHR5cGVvZiBwb3MgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0cG9zID0gdGhpcy50YWJsZS5vcHRpb25zLmFkZFJvd1Bvcztcblx0XHR9XG5cblx0XHRpZiAocG9zID09PSBcInBvc1wiKSB7XG5cblx0XHRcdHBvcyA9IHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHBvcyA9PT0gXCJib3R0b21cIikge1xuXG5cdFx0XHRwb3MgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcG9zO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmFkZFJvd0FjdHVhbCA9IGZ1bmN0aW9uIChkYXRhLCBwb3MsIGluZGV4LCBibG9ja1JlZHJhdykge1xuXG5cdFx0dmFyIHJvdyA9IGRhdGEgaW5zdGFuY2VvZiBSb3cgPyBkYXRhIDogbmV3IFJvdyhkYXRhIHx8IHt9LCB0aGlzKSxcblx0XHQgICAgdG9wID0gdGhpcy5maW5kQWRkUm93UG9zKHBvcyksXG5cdFx0ICAgIGFsbEluZGV4ID0gLTEsXG5cdFx0ICAgIGFjdGl2ZUluZGV4LFxuXHRcdCAgICBkaXNwUm93cztcblxuXHRcdGlmICghaW5kZXggJiYgdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25BZGRSb3cgPT0gXCJwYWdlXCIpIHtcblxuXHRcdFx0ZGlzcFJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRcdGlmICh0b3ApIHtcblxuXHRcdFx0XHRpZiAoZGlzcFJvd3MubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRpbmRleCA9IGRpc3BSb3dzWzBdO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0aWYgKHRoaXMuYWN0aXZlUm93cy5sZW5ndGgpIHtcblxuXHRcdFx0XHRcdFx0aW5kZXggPSB0aGlzLmFjdGl2ZVJvd3NbdGhpcy5hY3RpdmVSb3dzLmxlbmd0aCAtIDFdO1xuXG5cdFx0XHRcdFx0XHR0b3AgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKGRpc3BSb3dzLmxlbmd0aCkge1xuXG5cdFx0XHRcdFx0aW5kZXggPSBkaXNwUm93c1tkaXNwUm93cy5sZW5ndGggLSAxXTtcblxuXHRcdFx0XHRcdHRvcCA9IGRpc3BSb3dzLmxlbmd0aCA8IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2VTaXplKCkgPyBmYWxzZSA6IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGluZGV4ICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdGluZGV4ID0gdGhpcy5maW5kUm93KGluZGV4KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5hc3NpZ25Sb3dUb0dyb3VwKHJvdyk7XG5cblx0XHRcdHZhciBncm91cFJvd3MgPSByb3cuZ2V0R3JvdXAoKS5yb3dzO1xuXG5cdFx0XHRpZiAoZ3JvdXBSb3dzLmxlbmd0aCA+IDEpIHtcblxuXHRcdFx0XHRpZiAoIWluZGV4IHx8IGluZGV4ICYmIGdyb3VwUm93cy5pbmRleE9mKGluZGV4KSA9PSAtMSkge1xuXG5cdFx0XHRcdFx0aWYgKHRvcCkge1xuXG5cdFx0XHRcdFx0XHRpZiAoZ3JvdXBSb3dzWzBdICE9PSByb3cpIHtcblxuXHRcdFx0XHRcdFx0XHRpbmRleCA9IGdyb3VwUm93c1swXTtcblxuXHRcdFx0XHRcdFx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheShyb3cuZ2V0R3JvdXAoKS5yb3dzLCByb3csIGluZGV4LCAhdG9wKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRpZiAoZ3JvdXBSb3dzW2dyb3VwUm93cy5sZW5ndGggLSAxXSAhPT0gcm93KSB7XG5cblx0XHRcdFx0XHRcdFx0aW5kZXggPSBncm91cFJvd3NbZ3JvdXBSb3dzLmxlbmd0aCAtIDFdO1xuXG5cdFx0XHRcdFx0XHRcdHRoaXMuX21vdmVSb3dJbkFycmF5KHJvdy5nZXRHcm91cCgpLnJvd3MsIHJvdywgaW5kZXgsICF0b3ApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHRoaXMuX21vdmVSb3dJbkFycmF5KHJvdy5nZXRHcm91cCgpLnJvd3MsIHJvdywgaW5kZXgsICF0b3ApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGluZGV4KSB7XG5cblx0XHRcdGFsbEluZGV4ID0gdGhpcy5yb3dzLmluZGV4T2YoaW5kZXgpO1xuXHRcdH1cblxuXHRcdGlmIChpbmRleCAmJiBhbGxJbmRleCA+IC0xKSB7XG5cblx0XHRcdGFjdGl2ZUluZGV4ID0gdGhpcy5hY3RpdmVSb3dzLmluZGV4T2YoaW5kZXgpO1xuXG5cdFx0XHR0aGlzLmRpc3BsYXlSb3dJdGVyYXRvcihmdW5jdGlvbiAocm93cykge1xuXG5cdFx0XHRcdHZhciBkaXNwbGF5SW5kZXggPSByb3dzLmluZGV4T2YoaW5kZXgpO1xuXG5cdFx0XHRcdGlmIChkaXNwbGF5SW5kZXggPiAtMSkge1xuXG5cdFx0XHRcdFx0cm93cy5zcGxpY2UodG9wID8gZGlzcGxheUluZGV4IDogZGlzcGxheUluZGV4ICsgMSwgMCwgcm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChhY3RpdmVJbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0dGhpcy5hY3RpdmVSb3dzLnNwbGljZSh0b3AgPyBhY3RpdmVJbmRleCA6IGFjdGl2ZUluZGV4ICsgMSwgMCwgcm93KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5yb3dzLnNwbGljZSh0b3AgPyBhbGxJbmRleCA6IGFsbEluZGV4ICsgMSwgMCwgcm93KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAodG9wKSB7XG5cblx0XHRcdFx0dGhpcy5kaXNwbGF5Um93SXRlcmF0b3IoZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHRcdHJvd3MudW5zaGlmdChyb3cpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHR0aGlzLmFjdGl2ZVJvd3MudW5zaGlmdChyb3cpO1xuXG5cdFx0XHRcdHRoaXMucm93cy51bnNoaWZ0KHJvdyk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuZGlzcGxheVJvd0l0ZXJhdG9yKGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGhpcy5hY3RpdmVSb3dzLnB1c2gocm93KTtcblxuXHRcdFx0XHR0aGlzLnJvd3MucHVzaChyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuc2V0QWN0aXZlUm93cyh0aGlzLmFjdGl2ZVJvd3MpO1xuXG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLnJvd0FkZGVkLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKTtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5kYXRhRWRpdGVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5nZXREYXRhKCkpO1xuXG5cdFx0aWYgKCFibG9ja1JlZHJhdykge1xuXG5cdFx0XHR0aGlzLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdH1cblxuXHRcdHJldHVybiByb3c7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUubW92ZVJvdyA9IGZ1bmN0aW9uIChmcm9tLCB0bywgYWZ0ZXIpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImhpc3RvcnlcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmhpc3RvcnkuYWN0aW9uKFwicm93TW92ZVwiLCBmcm9tLCB7IHBvc0Zyb206IHRoaXMuZ2V0Um93UG9zaXRpb24oZnJvbSksIHBvc1RvOiB0aGlzLmdldFJvd1Bvc2l0aW9uKHRvKSwgdG86IHRvLCBhZnRlcjogYWZ0ZXIgfSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5tb3ZlUm93QWN0dWFsKGZyb20sIHRvLCBhZnRlcik7XG5cblx0XHR0aGlzLnJlZ2VuZXJhdGVSb3dOdW1iZXJzKCk7XG5cblx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93TW92ZWQuY2FsbCh0aGlzLnRhYmxlLCBmcm9tLmdldENvbXBvbmVudCgpKTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5tb3ZlUm93QWN0dWFsID0gZnVuY3Rpb24gKGZyb20sIHRvLCBhZnRlcikge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dGhpcy5fbW92ZVJvd0luQXJyYXkodGhpcy5yb3dzLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXG5cdFx0dGhpcy5fbW92ZVJvd0luQXJyYXkodGhpcy5hY3RpdmVSb3dzLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXG5cdFx0dGhpcy5kaXNwbGF5Um93SXRlcmF0b3IoZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0c2VsZi5fbW92ZVJvd0luQXJyYXkocm93cywgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHR9KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHR2YXIgdG9Hcm91cCA9IHRvLmdldEdyb3VwKCk7XG5cblx0XHRcdHZhciBmcm9tR3JvdXAgPSBmcm9tLmdldEdyb3VwKCk7XG5cblx0XHRcdGlmICh0b0dyb3VwID09PSBmcm9tR3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLl9tb3ZlUm93SW5BcnJheSh0b0dyb3VwLnJvd3MsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChmcm9tR3JvdXApIHtcblxuXHRcdFx0XHRcdGZyb21Hcm91cC5yZW1vdmVSb3coZnJvbSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0b0dyb3VwLmluc2VydFJvdyhmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fbW92ZVJvd0luQXJyYXkgPSBmdW5jdGlvbiAocm93cywgZnJvbSwgdG8sIGFmdGVyKSB7XG5cblx0XHR2YXIgZnJvbUluZGV4LCB0b0luZGV4LCBzdGFydCwgZW5kO1xuXG5cdFx0aWYgKGZyb20gIT09IHRvKSB7XG5cblx0XHRcdGZyb21JbmRleCA9IHJvd3MuaW5kZXhPZihmcm9tKTtcblxuXHRcdFx0aWYgKGZyb21JbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0cm93cy5zcGxpY2UoZnJvbUluZGV4LCAxKTtcblxuXHRcdFx0XHR0b0luZGV4ID0gcm93cy5pbmRleE9mKHRvKTtcblxuXHRcdFx0XHRpZiAodG9JbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0XHRpZiAoYWZ0ZXIpIHtcblxuXHRcdFx0XHRcdFx0cm93cy5zcGxpY2UodG9JbmRleCArIDEsIDAsIGZyb20pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHJvd3Muc3BsaWNlKHRvSW5kZXgsIDAsIGZyb20pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHJvd3Muc3BsaWNlKGZyb21JbmRleCwgMCwgZnJvbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9yZXN0eWxlIHJvd3NcblxuXHRcdFx0aWYgKHJvd3MgPT09IHRoaXMuZ2V0RGlzcGxheVJvd3MoKSkge1xuXG5cdFx0XHRcdHN0YXJ0ID0gZnJvbUluZGV4IDwgdG9JbmRleCA/IGZyb21JbmRleCA6IHRvSW5kZXg7XG5cblx0XHRcdFx0ZW5kID0gdG9JbmRleCA+IGZyb21JbmRleCA/IHRvSW5kZXggOiBmcm9tSW5kZXggKyAxO1xuXG5cdFx0XHRcdGZvciAodmFyIGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xuXG5cdFx0XHRcdFx0aWYgKHJvd3NbaV0pIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zdHlsZVJvdyhyb3dzW2ldLCBpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuY2xlYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5zZXREYXRhKFtdKTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSb3dJbmRleCA9IGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdHJldHVybiB0aGlzLmZpbmRSb3dJbmRleChyb3csIHRoaXMucm93cyk7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0RGlzcGxheVJvd0luZGV4ID0gZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0dmFyIGluZGV4ID0gdGhpcy5nZXREaXNwbGF5Um93cygpLmluZGV4T2Yocm93KTtcblxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gaW5kZXggOiBmYWxzZTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5uZXh0RGlzcGxheVJvdyA9IGZ1bmN0aW9uIChyb3csIHJvd09ubHkpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMuZ2V0RGlzcGxheVJvd0luZGV4KHJvdyksXG5cdFx0ICAgIG5leHRSb3cgPSBmYWxzZTtcblxuXHRcdGlmIChpbmRleCAhPT0gZmFsc2UgJiYgaW5kZXggPCB0aGlzLmRpc3BsYXlSb3dzQ291bnQgLSAxKSB7XG5cblx0XHRcdG5leHRSb3cgPSB0aGlzLmdldERpc3BsYXlSb3dzKClbaW5kZXggKyAxXTtcblx0XHR9XG5cblx0XHRpZiAobmV4dFJvdyAmJiAoIShuZXh0Um93IGluc3RhbmNlb2YgUm93KSB8fCBuZXh0Um93LnR5cGUgIT0gXCJyb3dcIikpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubmV4dERpc3BsYXlSb3cobmV4dFJvdywgcm93T25seSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5leHRSb3c7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucHJldkRpc3BsYXlSb3cgPSBmdW5jdGlvbiAocm93LCByb3dPbmx5KSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLmdldERpc3BsYXlSb3dJbmRleChyb3cpLFxuXHRcdCAgICBwcmV2Um93ID0gZmFsc2U7XG5cblx0XHRpZiAoaW5kZXgpIHtcblxuXHRcdFx0cHJldlJvdyA9IHRoaXMuZ2V0RGlzcGxheVJvd3MoKVtpbmRleCAtIDFdO1xuXHRcdH1cblxuXHRcdGlmIChwcmV2Um93ICYmICghKHByZXZSb3cgaW5zdGFuY2VvZiBSb3cpIHx8IHByZXZSb3cudHlwZSAhPSBcInJvd1wiKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5wcmV2RGlzcGxheVJvdyhwcmV2Um93LCByb3dPbmx5KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcHJldlJvdztcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5maW5kUm93SW5kZXggPSBmdW5jdGlvbiAocm93LCBsaXN0KSB7XG5cblx0XHR2YXIgcm93SW5kZXg7XG5cblx0XHRyb3cgPSB0aGlzLmZpbmRSb3cocm93KTtcblxuXHRcdGlmIChyb3cpIHtcblxuXHRcdFx0cm93SW5kZXggPSBsaXN0LmluZGV4T2Yocm93KTtcblxuXHRcdFx0aWYgKHJvd0luZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRyZXR1cm4gcm93SW5kZXg7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAoYWN0aXZlLCB0cmFuc2Zvcm0pIHtcblxuXHRcdHZhciBvdXRwdXQgPSBbXSxcblx0XHQgICAgcm93cyA9IHRoaXMuZ2V0Um93cyhhY3RpdmUpO1xuXG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0aWYgKHJvdy50eXBlID09IFwicm93XCIpIHtcblxuXHRcdFx0XHRvdXRwdXQucHVzaChyb3cuZ2V0RGF0YSh0cmFuc2Zvcm0gfHwgXCJkYXRhXCIpKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0Q29tcG9uZW50cyA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdHZhciBvdXRwdXQgPSBbXSxcblx0XHQgICAgcm93cyA9IHRoaXMuZ2V0Um93cyhhY3RpdmUpO1xuXG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0b3V0cHV0LnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0RGF0YUNvdW50ID0gZnVuY3Rpb24gKGFjdGl2ZSkge1xuXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFJvd3MoYWN0aXZlKTtcblxuXHRcdHJldHVybiByb3dzLmxlbmd0aDtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fZ2VuUmVtb3RlUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXMxMiA9IHRoaXM7XG5cblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlLFxuXHRcdCAgICBvcHRpb25zID0gdGFibGUub3B0aW9ucyxcblx0XHQgICAgcGFyYW1zID0ge307XG5cblx0XHRpZiAodGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHQvL3NldCBzb3J0IGRhdGEgaWYgZGVmaW5lZFxuXG5cdFx0XHRpZiAob3B0aW9ucy5hamF4U29ydGluZykge1xuXG5cdFx0XHRcdHZhciBzb3J0ZXJzID0gdGhpcy50YWJsZS5tb2R1bGVzLnNvcnQuZ2V0U29ydCgpO1xuXG5cdFx0XHRcdHNvcnRlcnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXG5cdFx0XHRcdFx0ZGVsZXRlIGl0ZW0uY29sdW1uO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRwYXJhbXNbdGhpcy50YWJsZS5tb2R1bGVzLnBhZ2UucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMuc29ydGVyc10gPSBzb3J0ZXJzO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NldCBmaWx0ZXIgZGF0YSBpZiBkZWZpbmVkXG5cblx0XHRcdGlmIChvcHRpb25zLmFqYXhGaWx0ZXJpbmcpIHtcblxuXHRcdFx0XHR2YXIgZmlsdGVycyA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0RmlsdGVycyh0cnVlLCB0cnVlKTtcblxuXHRcdFx0XHRwYXJhbXNbdGhpcy50YWJsZS5tb2R1bGVzLnBhZ2UucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMuZmlsdGVyc10gPSBmaWx0ZXJzO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuYWpheC5zZXRQYXJhbXMocGFyYW1zLCB0cnVlKTtcblx0XHR9XG5cblx0XHR0YWJsZS5tb2R1bGVzLmFqYXguc2VuZFJlcXVlc3QoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRcdF90aGlzMTIuX3NldERhdGFBY3R1YWwoZGF0YSwgdHJ1ZSk7XG5cdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGUpIHt9KTtcblx0fTtcblxuXHQvL2Nob29zZSB0aGUgcGF0aCB0byByZWZyZXNoIGRhdGEgYWZ0ZXIgYSBmaWx0ZXIgdXBkYXRlXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZmlsdGVyUmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGUsXG5cdFx0ICAgIG9wdGlvbnMgPSB0YWJsZS5vcHRpb25zLFxuXHRcdCAgICBsZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0O1xuXG5cdFx0aWYgKG9wdGlvbnMuYWpheEZpbHRlcmluZykge1xuXG5cdFx0XHRpZiAob3B0aW9ucy5wYWdpbmF0aW9uID09IFwicmVtb3RlXCIgJiYgdGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5yZXNldCh0cnVlKTtcblxuXHRcdFx0XHR0YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0UGFnZSgxKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7XG5cdFx0XHR9IGVsc2UgaWYgKG9wdGlvbnMuYWpheFByb2dyZXNzaXZlTG9hZCkge1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMuYWpheC5sb2FkRGF0YSgpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Ly9hc3N1bWUgZGF0YSBpcyB1cmwsIG1ha2UgYWpheCBjYWxsIHRvIHVybCB0byBnZXQgZGF0YVxuXG5cdFx0XHRcdHRoaXMuX2dlblJlbW90ZVJlcXVlc3QoKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlZnJlc2hBY3RpdmVEYXRhKFwiZmlsdGVyXCIpO1xuXHRcdH1cblxuXHRcdHRoaXMuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0fTtcblxuXHQvL2Nob29zZSB0aGUgcGF0aCB0byByZWZyZXNoIGRhdGEgYWZ0ZXIgYSBzb3J0ZXIgdXBkYXRlXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc29ydGVyUmVmcmVzaCA9IGZ1bmN0aW9uIChsb2FkT3JpZ25hbERhdGEpIHtcblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGUsXG5cdFx0ICAgIG9wdGlvbnMgPSB0aGlzLnRhYmxlLm9wdGlvbnMsXG5cdFx0ICAgIGxlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XG5cblx0XHRpZiAob3B0aW9ucy5hamF4U29ydGluZykge1xuXG5cdFx0XHRpZiAoKG9wdGlvbnMucGFnaW5hdGlvbiA9PSBcInJlbW90ZVwiIHx8IG9wdGlvbnMucHJvZ3Jlc3NpdmVMb2FkKSAmJiB0YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5wYWdlLnJlc2V0KHRydWUpO1xuXG5cdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdH0gZWxzZSBpZiAob3B0aW9ucy5hamF4UHJvZ3Jlc3NpdmVMb2FkKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5hamF4LmxvYWREYXRhKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQvL2Fzc3VtZSBkYXRhIGlzIHVybCwgbWFrZSBhamF4IGNhbGwgdG8gdXJsIHRvIGdldCBkYXRhXG5cblx0XHRcdFx0dGhpcy5fZ2VuUmVtb3RlUmVxdWVzdCgpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEobG9hZE9yaWduYWxEYXRhID8gXCJmaWx0ZXJcIiA6IFwic29ydFwiKTtcblx0XHR9XG5cblx0XHR0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc2Nyb2xsSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChsZWZ0KSB7XG5cblx0XHR0aGlzLnNjcm9sbExlZnQgPSBsZWZ0O1xuXG5cdFx0dGhpcy5lbGVtZW50LnNjcm9sbExlZnQgPSBsZWZ0O1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3Muc2Nyb2xsSGVhZGVycyhsZWZ0KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3Muc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXQgYWN0aXZlIGRhdGEgc2V0XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucmVmcmVzaEFjdGl2ZURhdGEgPSBmdW5jdGlvbiAoc3RhZ2UsIHNraXBTdGFnZSwgcmVuZGVySW5Qb3NpdGlvbikge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICB0YWJsZSA9IHRoaXMudGFibGUsXG5cdFx0ICAgIGNhc2NhZGVPcmRlciA9IFtcImFsbFwiLCBcImZpbHRlclwiLCBcInNvcnRcIiwgXCJkaXNwbGF5XCIsIFwiZnJlZXplXCIsIFwiZ3JvdXBcIiwgXCJ0cmVlXCIsIFwicGFnZVwiXSxcblx0XHQgICAgZGlzcGxheUluZGV4O1xuXG5cdFx0aWYgKHRoaXMucmVkcmF3QmxvY2spIHtcblxuXHRcdFx0aWYgKCF0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZyB8fCBjYXNjYWRlT3JkZXIuaW5kZXhPZihzdGFnZSkgPCBjYXNjYWRlT3JkZXIuaW5kZXhPZih0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZy5zdGFnZSkpIHtcblxuXHRcdFx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZyA9IHtcblxuXHRcdFx0XHRcdHN0YWdlOiBzdGFnZSxcblxuXHRcdFx0XHRcdHNraXBTdGFnZTogc2tpcFN0YWdlLFxuXG5cdFx0XHRcdFx0cmVuZGVySW5Qb3NpdGlvbjogcmVuZGVySW5Qb3NpdGlvblxuXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuY2FuY2VsRWRpdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXN0YWdlKSB7XG5cblx0XHRcdFx0c3RhZ2UgPSBcImFsbFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICYmICF0YWJsZS5vcHRpb25zLnNlbGVjdGFibGVQZXJzaXN0ZW5jZSAmJiB0YWJsZS5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIikpIHtcblxuXHRcdFx0XHR0YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5kZXNlbGVjdFJvd3MoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9jYXNjYWRlIHRocm91Z2ggZGF0YSByZWZyZXNoIHN0YWdlc1xuXG5cdFx0XHRzd2l0Y2ggKHN0YWdlKSB7XG5cblx0XHRcdFx0Y2FzZSBcImFsbFwiOlxuXG5cdFx0XHRcdGNhc2UgXCJmaWx0ZXJcIjpcblxuXHRcdFx0XHRcdGlmICghc2tpcFN0YWdlKSB7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIikpIHtcblxuXHRcdFx0XHRcdFx0XHRzZWxmLnNldEFjdGl2ZVJvd3ModGFibGUubW9kdWxlcy5maWx0ZXIuZmlsdGVyKHNlbGYucm93cykpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRzZWxmLnNldEFjdGl2ZVJvd3Moc2VsZi5yb3dzLnNsaWNlKDApKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRza2lwU3RhZ2UgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0Y2FzZSBcInNvcnRcIjpcblxuXHRcdFx0XHRcdGlmICghc2tpcFN0YWdlKSB7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5tb2RFeGlzdHMoXCJzb3J0XCIpKSB7XG5cblx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5zb3J0LnNvcnQodGhpcy5hY3RpdmVSb3dzKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRza2lwU3RhZ2UgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvL3JlZ2VuZXJhdGUgcm93IG51bWJlcnMgZm9yIHJvdyBudW1iZXIgZm9ybWF0dGVyIGlmIGluIHVzZVxuXG5cdFx0XHRcdFx0dGhpcy5yZWdlbmVyYXRlUm93TnVtYmVycygpO1xuXG5cdFx0XHRcdC8vZ2VuZXJpYyBzdGFnZSB0byBhbGxvdyBmb3IgcGlwZWxpbmUgdHJpZ2dlciBhZnRlciB0aGUgZGF0YSBtYW5pcHVsYXRpb24gc3RhZ2VcblxuXHRcdFx0XHRjYXNlIFwiZGlzcGxheVwiOlxuXG5cdFx0XHRcdFx0dGhpcy5yZXNldERpc3BsYXlSb3dzKCk7XG5cblx0XHRcdFx0Y2FzZSBcImZyZWV6ZVwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiKSkge1xuXG5cdFx0XHRcdFx0XHRcdGlmICh0YWJsZS5tb2R1bGVzLmZyb3plblJvd3MuaXNGcm96ZW4oKSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCF0YWJsZS5tb2R1bGVzLmZyb3plblJvd3MuZ2V0RGlzcGxheUluZGV4KCkpIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5mcm96ZW5Sb3dzLnNldERpc3BsYXlJbmRleCh0aGlzLmdldE5leHREaXNwbGF5SW5kZXgoKSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gdGFibGUubW9kdWxlcy5mcm96ZW5Sb3dzLmdldERpc3BsYXlJbmRleCgpO1xuXG5cdFx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gc2VsZi5zZXREaXNwbGF5Um93cyh0YWJsZS5tb2R1bGVzLmZyb3plblJvd3MuZ2V0Um93cyh0aGlzLmdldERpc3BsYXlSb3dzKGRpc3BsYXlJbmRleCAtIDEpKSwgZGlzcGxheUluZGV4KTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChkaXNwbGF5SW5kZXggIT09IHRydWUpIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5mcm96ZW5Sb3dzLnNldERpc3BsYXlJbmRleChkaXNwbGF5SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNraXBTdGFnZSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRjYXNlIFwiZ3JvdXBcIjpcblxuXHRcdFx0XHRcdGlmICghc2tpcFN0YWdlKSB7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKCF0YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5nZXREaXNwbGF5SW5kZXgoKSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5ncm91cFJvd3Muc2V0RGlzcGxheUluZGV4KHRoaXMuZ2V0TmV4dERpc3BsYXlJbmRleCgpKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGRpc3BsYXlJbmRleCA9IHRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmdldERpc3BsYXlJbmRleCgpO1xuXG5cdFx0XHRcdFx0XHRcdGRpc3BsYXlJbmRleCA9IHNlbGYuc2V0RGlzcGxheVJvd3ModGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0Um93cyh0aGlzLmdldERpc3BsYXlSb3dzKGRpc3BsYXlJbmRleCAtIDEpKSwgZGlzcGxheUluZGV4KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZGlzcGxheUluZGV4ICE9PSB0cnVlKSB7XG5cblx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5zZXREaXNwbGF5SW5kZXgoZGlzcGxheUluZGV4KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNraXBTdGFnZSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRjYXNlIFwidHJlZVwiOlxuXG5cdFx0XHRcdFx0aWYgKCFza2lwU3RhZ2UpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgdGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZ2V0RGlzcGxheUluZGV4KCkpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuc2V0RGlzcGxheUluZGV4KHRoaXMuZ2V0TmV4dERpc3BsYXlJbmRleCgpKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGRpc3BsYXlJbmRleCA9IHRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZ2V0RGlzcGxheUluZGV4KCk7XG5cblx0XHRcdFx0XHRcdFx0ZGlzcGxheUluZGV4ID0gc2VsZi5zZXREaXNwbGF5Um93cyh0YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldFJvd3ModGhpcy5nZXREaXNwbGF5Um93cyhkaXNwbGF5SW5kZXggLSAxKSksIGRpc3BsYXlJbmRleCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGRpc3BsYXlJbmRleCAhPT0gdHJ1ZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5kYXRhVHJlZS5zZXREaXNwbGF5SW5kZXgoZGlzcGxheUluZGV4KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNraXBTdGFnZSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSAmJiAhcmVuZGVySW5Qb3NpdGlvbikge1xuXG5cdFx0XHRcdFx0XHRpZiAodGFibGUubW9kdWxlcy5wYWdlLmdldE1vZGUoKSA9PSBcImxvY2FsXCIpIHtcblxuXHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLnBhZ2UucmVzZXQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0Y2FzZSBcInBhZ2VcIjpcblxuXHRcdFx0XHRcdGlmICghc2tpcFN0YWdlKSB7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGFibGUubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRcdFx0XHRcdGlmICghdGFibGUubW9kdWxlcy5wYWdlLmdldERpc3BsYXlJbmRleCgpKSB7XG5cblx0XHRcdFx0XHRcdFx0XHR0YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0RGlzcGxheUluZGV4KHRoaXMuZ2V0TmV4dERpc3BsYXlJbmRleCgpKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGRpc3BsYXlJbmRleCA9IHRhYmxlLm1vZHVsZXMucGFnZS5nZXREaXNwbGF5SW5kZXgoKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAodGFibGUubW9kdWxlcy5wYWdlLmdldE1vZGUoKSA9PSBcImxvY2FsXCIpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHRhYmxlLm1vZHVsZXMucGFnZS5zZXRNYXhSb3dzKHRoaXMuZ2V0RGlzcGxheVJvd3MoZGlzcGxheUluZGV4IC0gMSkubGVuZ3RoKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGRpc3BsYXlJbmRleCA9IHNlbGYuc2V0RGlzcGxheVJvd3ModGFibGUubW9kdWxlcy5wYWdlLmdldFJvd3ModGhpcy5nZXREaXNwbGF5Um93cyhkaXNwbGF5SW5kZXggLSAxKSksIGRpc3BsYXlJbmRleCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGRpc3BsYXlJbmRleCAhPT0gdHJ1ZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dGFibGUubW9kdWxlcy5wYWdlLnNldERpc3BsYXlJbmRleChkaXNwbGF5SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2tpcFN0YWdlID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdGlmIChUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxWaXNpYmxlKHNlbGYuZWxlbWVudCkpIHtcblxuXHRcdFx0XHRpZiAocmVuZGVySW5Qb3NpdGlvbikge1xuXG5cdFx0XHRcdFx0c2VsZi5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHNlbGYucmVuZGVyVGFibGUoKTtcblxuXHRcdFx0XHRcdGlmICh0YWJsZS5vcHRpb25zLmxheW91dENvbHVtbnNPbk5ld0RhdGEpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlZHJhdyh0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0dGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGModGhpcy5hY3RpdmVSb3dzKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9yZWdlbmVyYXRlIHJvdyBudW1iZXJzIGZvciByb3cgbnVtYmVyIGZvcm1hdHRlciBpZiBpbiB1c2VcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZWdlbmVyYXRlUm93TnVtYmVycyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXMxMyA9IHRoaXM7XG5cblx0XHRpZiAodGhpcy5yb3dOdW1Db2x1bW4pIHtcblxuXHRcdFx0dGhpcy5hY3RpdmVSb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRcdHZhciBjZWxsID0gcm93LmdldENlbGwoX3RoaXMxMy5yb3dOdW1Db2x1bW4pO1xuXG5cdFx0XHRcdGlmIChjZWxsKSB7XG5cblx0XHRcdFx0XHRjZWxsLl9nZW5lcmF0ZUNvbnRlbnRzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zZXRBY3RpdmVSb3dzID0gZnVuY3Rpb24gKGFjdGl2ZVJvd3MpIHtcblxuXHRcdHRoaXMuYWN0aXZlUm93cyA9IGFjdGl2ZVJvd3M7XG5cblx0XHR0aGlzLmFjdGl2ZVJvd3NDb3VudCA9IHRoaXMuYWN0aXZlUm93cy5sZW5ndGg7XG5cdH07XG5cblx0Ly9yZXNldCBkaXNwbGF5IHJvd3MgYXJyYXlcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZXNldERpc3BsYXlSb3dzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5kaXNwbGF5Um93cyA9IFtdO1xuXG5cdFx0dGhpcy5kaXNwbGF5Um93cy5wdXNoKHRoaXMuYWN0aXZlUm93cy5zbGljZSgwKSk7XG5cblx0XHR0aGlzLmRpc3BsYXlSb3dzQ291bnQgPSB0aGlzLmRpc3BsYXlSb3dzWzBdLmxlbmd0aDtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plblJvd3NcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plblJvd3Muc2V0RGlzcGxheUluZGV4KDApO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLnNldERpc3BsYXlJbmRleCgwKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wYWdlLnNldERpc3BsYXlJbmRleCgwKTtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuZ2V0TmV4dERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmRpc3BsYXlSb3dzLmxlbmd0aDtcblx0fTtcblxuXHQvL3NldCBkaXNwbGF5IHJvdyBwaXBlbGluZSBkYXRhXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc2V0RGlzcGxheVJvd3MgPSBmdW5jdGlvbiAoZGlzcGxheVJvd3MsIGluZGV4KSB7XG5cblx0XHR2YXIgb3V0cHV0ID0gdHJ1ZTtcblxuXHRcdGlmIChpbmRleCAmJiB0eXBlb2YgdGhpcy5kaXNwbGF5Um93c1tpbmRleF0gIT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHR0aGlzLmRpc3BsYXlSb3dzW2luZGV4XSA9IGRpc3BsYXlSb3dzO1xuXG5cdFx0XHRvdXRwdXQgPSB0cnVlO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuZGlzcGxheVJvd3MucHVzaChkaXNwbGF5Um93cyk7XG5cblx0XHRcdG91dHB1dCA9IGluZGV4ID0gdGhpcy5kaXNwbGF5Um93cy5sZW5ndGggLSAxO1xuXHRcdH1cblxuXHRcdGlmIChpbmRleCA9PSB0aGlzLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDEpIHtcblxuXHRcdFx0dGhpcy5kaXNwbGF5Um93c0NvdW50ID0gdGhpcy5kaXNwbGF5Um93c1t0aGlzLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDFdLmxlbmd0aDtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmdldERpc3BsYXlSb3dzID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cblx0XHRpZiAodHlwZW9mIGluZGV4ID09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuZGlzcGxheVJvd3MubGVuZ3RoID8gdGhpcy5kaXNwbGF5Um93c1t0aGlzLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDFdIDogW107XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuZGlzcGxheVJvd3NbaW5kZXhdIHx8IFtdO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRWaXNpYmxlUm93cyA9IGZ1bmN0aW9uICh2aWV3YWJsZSkge1xuXG5cdFx0dmFyIHRvcEVkZ2UgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wLFxuXHRcdCAgICBib3R0b21FZGdlID0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCArIHRvcEVkZ2UsXG5cdFx0ICAgIHRvcEZvdW5kID0gZmFsc2UsXG5cdFx0ICAgIHRvcFJvdyA9IDAsXG5cdFx0ICAgIGJvdHRvbVJvdyA9IDAsXG5cdFx0ICAgIHJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRpZiAodmlld2FibGUpIHtcblxuXHRcdFx0dGhpcy5nZXREaXNwbGF5Um93cygpO1xuXG5cdFx0XHRmb3IgKHZhciBpID0gdGhpcy52RG9tVG9wOyBpIDw9IHRoaXMudkRvbUJvdHRvbTsgaSsrKSB7XG5cblx0XHRcdFx0aWYgKHJvd3NbaV0pIHtcblxuXHRcdFx0XHRcdGlmICghdG9wRm91bmQpIHtcblxuXHRcdFx0XHRcdFx0aWYgKHRvcEVkZ2UgLSByb3dzW2ldLmdldEVsZW1lbnQoKS5vZmZzZXRUb3AgPj0gMCkge1xuXG5cdFx0XHRcdFx0XHRcdHRvcFJvdyA9IGk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdHRvcEZvdW5kID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoYm90dG9tRWRnZSAtIHJvd3NbaV0uZ2V0RWxlbWVudCgpLm9mZnNldFRvcCA+PSAwKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRib3R0b21Sb3cgPSBpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRpZiAoYm90dG9tRWRnZSAtIHJvd3NbaV0uZ2V0RWxlbWVudCgpLm9mZnNldFRvcCA+PSAwKSB7XG5cblx0XHRcdFx0XHRcdFx0Ym90dG9tUm93ID0gaTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dG9wUm93ID0gdGhpcy52RG9tVG9wO1xuXG5cdFx0XHRib3R0b21Sb3cgPSB0aGlzLnZEb21Cb3R0b207XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJvd3Muc2xpY2UodG9wUm93LCBib3R0b21Sb3cgKyAxKTtcblx0fTtcblxuXHQvL3JlcGVhdCBhY3Rpb24gYWNjcm9zcyBkaXNwbGF5IHJvd3NcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5kaXNwbGF5Um93SXRlcmF0b3IgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcblxuXHRcdHRoaXMuZGlzcGxheVJvd3MuZm9yRWFjaChjYWxsYmFjayk7XG5cblx0XHR0aGlzLmRpc3BsYXlSb3dzQ291bnQgPSB0aGlzLmRpc3BsYXlSb3dzW3RoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0gMV0ubGVuZ3RoO1xuXHR9O1xuXG5cdC8vcmV0dXJuIG9ubHkgYWN0dWFsIHJvd3MgKG5vdCBncm91cCBoZWFkZXJzIGV0YylcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSb3dzID0gZnVuY3Rpb24gKGFjdGl2ZSkge1xuXG5cdFx0dmFyIHJvd3M7XG5cblx0XHRzd2l0Y2ggKGFjdGl2ZSkge1xuXG5cdFx0XHRjYXNlIFwiYWN0aXZlXCI6XG5cblx0XHRcdFx0cm93cyA9IHRoaXMuYWN0aXZlUm93cztcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImRpc3BsYXlcIjpcblxuXHRcdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJ2aXNpYmxlXCI6XG5cblx0XHRcdFx0cm93cyA9IHRoaXMuZ2V0VmlzaWJsZVJvd3ModHJ1ZSk7XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGRlZmF1bHQ6XG5cblx0XHRcdFx0cm93cyA9IHRoaXMucm93cztcblxuXHRcdH1cblxuXHRcdHJldHVybiByb3dzO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vIFRhYmxlIFJlbmRlcmluZyAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cblx0Ly90cmlnZ2VyIHJlcmVuZGVyIG9mIHRhYmxlIGluIGN1cnJlbnQgcG9zaXRpb25cblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZVJlbmRlckluUG9zaXRpb24gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcblxuXHRcdGlmICh0aGlzLmdldFJlbmRlck1vZGUoKSA9PSBcInZpcnR1YWxcIikge1xuXG5cdFx0XHRpZiAodGhpcy5yZWRyYXdCbG9jaykge1xuXG5cdFx0XHRcdGlmIChjYWxsYmFjaykge1xuXG5cdFx0XHRcdFx0Y2FsbGJhY2soKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHRoaXMucmVkcmF3QmxvY2tSZWRlckluUG9zaXRpb24gPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHZhciBzY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wO1xuXG5cdFx0XHRcdHZhciB0b3BSb3cgPSBmYWxzZTtcblxuXHRcdFx0XHR2YXIgdG9wT2Zmc2V0ID0gZmFsc2U7XG5cblx0XHRcdFx0dmFyIGxlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XG5cblx0XHRcdFx0dmFyIHJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRcdFx0Zm9yICh2YXIgaSA9IHRoaXMudkRvbVRvcDsgaSA8PSB0aGlzLnZEb21Cb3R0b207IGkrKykge1xuXG5cdFx0XHRcdFx0aWYgKHJvd3NbaV0pIHtcblxuXHRcdFx0XHRcdFx0dmFyIGRpZmYgPSBzY3JvbGxUb3AgLSByb3dzW2ldLmdldEVsZW1lbnQoKS5vZmZzZXRUb3A7XG5cblx0XHRcdFx0XHRcdGlmICh0b3BPZmZzZXQgPT09IGZhbHNlIHx8IE1hdGguYWJzKGRpZmYpIDwgdG9wT2Zmc2V0KSB7XG5cblx0XHRcdFx0XHRcdFx0dG9wT2Zmc2V0ID0gZGlmZjtcblxuXHRcdFx0XHRcdFx0XHR0b3BSb3cgPSBpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcblxuXHRcdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLl92aXJ0dWFsUmVuZGVyRmlsbCh0b3BSb3cgPT09IGZhbHNlID8gdGhpcy5kaXNwbGF5Um93c0NvdW50IC0gMSA6IHRvcFJvdywgdHJ1ZSwgdG9wT2Zmc2V0IHx8IDApO1xuXG5cdFx0XHRcdHRoaXMuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlbmRlclRhYmxlKCk7XG5cblx0XHRcdGlmIChjYWxsYmFjaykge1xuXG5cdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnNldFJlbmRlck1vZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnZpcnR1YWxEb20pIHtcblxuXHRcdFx0dGhpcy5yZW5kZXJNb2RlID0gXCJ2aXJ0dWFsXCI7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IHRoaXMudGFibGUub3B0aW9ucy5oZWlnaHQpIHtcblxuXHRcdFx0XHR0aGlzLmZpeGVkSGVpZ2h0ID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5maXhlZEhlaWdodCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMucmVuZGVyTW9kZSA9IFwiY2xhc3NpY1wiO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5nZXRSZW5kZXJNb2RlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMucmVuZGVyTW9kZTtcblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZW5kZXJUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5yZW5kZXJTdGFydGVkLmNhbGwodGhpcy50YWJsZSk7XG5cblx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcblxuXHRcdHN3aXRjaCAodGhpcy5yZW5kZXJNb2RlKSB7XG5cblx0XHRcdGNhc2UgXCJjbGFzc2ljXCI6XG5cblx0XHRcdFx0dGhpcy5fc2ltcGxlUmVuZGVyKCk7XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJ2aXJ0dWFsXCI6XG5cblx0XHRcdFx0dGhpcy5fdmlydHVhbFJlbmRlckZpbGwoKTtcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdH1cblxuXHRcdGlmICh0aGlzLmZpcnN0UmVuZGVyKSB7XG5cblx0XHRcdGlmICh0aGlzLmRpc3BsYXlSb3dzQ291bnQpIHtcblxuXHRcdFx0XHR0aGlzLmZpcnN0UmVuZGVyID0gZmFsc2U7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmxheW91dC5sYXlvdXQoKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy5yZW5kZXJFbXB0eVNjcm9sbCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMubGF5b3V0KCk7XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLmRpc3BsYXlSb3dzQ291bnQpIHtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlcikge1xuXG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlci5zZXRBdHRyaWJ1dGUoXCJ0YWJ1bGF0b3ItcmVuZGVyLW1vZGVcIiwgdGhpcy5yZW5kZXJNb2RlKTtcblxuXHRcdFx0XHR0aGlzLmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZCh0aGlzLnRhYmxlLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuXG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlci5zdHlsZS53aWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5yZW5kZXJDb21wbGV0ZS5jYWxsKHRoaXMudGFibGUpO1xuXHR9O1xuXG5cdC8vc2ltcGxlIHJlbmRlciBvbiBoZWlnaHRsZXNzIHRhYmxlXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX3NpbXBsZVJlbmRlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX2NsZWFyVmlydHVhbERvbSgpO1xuXG5cdFx0aWYgKHRoaXMuZGlzcGxheVJvd3NDb3VudCkge1xuXG5cdFx0XHR0aGlzLmNoZWNrQ2xhc3NpY01vZGVHcm91cEhlYWRlcldpZHRoKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5yZW5kZXJFbXB0eVNjcm9sbCgpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5jaGVja0NsYXNzaWNNb2RlR3JvdXBIZWFkZXJXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHRoaXMudGFibGVFbGVtZW50LFxuXHRcdCAgICBvbmx5R3JvdXBIZWFkZXJzID0gdHJ1ZTtcblxuXHRcdHNlbGYuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3csIGluZGV4KSB7XG5cblx0XHRcdHNlbGYuc3R5bGVSb3cocm93LCBpbmRleCk7XG5cblx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cblx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXG5cdFx0XHRpZiAocm93LnR5cGUgIT09IFwiZ3JvdXBcIikge1xuXG5cdFx0XHRcdG9ubHlHcm91cEhlYWRlcnMgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChvbmx5R3JvdXBIZWFkZXJzKSB7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0V2lkdGgoKSArIFwicHhcIjtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCJcIjtcblx0XHR9XG5cdH07XG5cblx0Ly9zaG93IHNjcm9sbGJhcnMgb24gZW1wdHkgdGFibGUgZGl2XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucmVuZGVyRW1wdHlTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyKSB7XG5cblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXG5cdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIjFweFwiO1xuXG5cdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX2NsZWFyVmlydHVhbERvbSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBlbGVtZW50ID0gdGhpcy50YWJsZUVsZW1lbnQ7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyICYmIHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlci5wYXJlbnROb2RlKSB7XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlcik7XG5cdFx0fVxuXG5cdFx0Ly8gZWxlbWVudC5jaGlsZHJlbi5kZXRhY2goKTtcblxuXHRcdHdoaWxlIChlbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9ZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gXCJcIjtcblxuXHRcdGVsZW1lbnQuc3R5bGUucGFkZGluZ0JvdHRvbSA9IFwiXCI7XG5cblx0XHRlbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCJcIjtcblxuXHRcdGVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJcIjtcblxuXHRcdGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG5cblx0XHRlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSBcIlwiO1xuXG5cdFx0dGhpcy5zY3JvbGxUb3AgPSAwO1xuXG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblxuXHRcdHRoaXMudkRvbVRvcCA9IDA7XG5cblx0XHR0aGlzLnZEb21Cb3R0b20gPSAwO1xuXG5cdFx0dGhpcy52RG9tVG9wUGFkID0gMDtcblxuXHRcdHRoaXMudkRvbUJvdHRvbVBhZCA9IDA7XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuc3R5bGVSb3cgPSBmdW5jdGlvbiAocm93LCBpbmRleCkge1xuXG5cdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdGlmIChpbmRleCAlIDIpIHtcblxuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3ctZXZlblwiKTtcblxuXHRcdFx0cm93RWwuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1yb3ctb2RkXCIpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJvd0VsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LW9kZFwiKTtcblxuXHRcdFx0cm93RWwuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1yb3ctZXZlblwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly9mdWxsIHZpcnR1YWwgcmVuZGVyXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX3ZpcnR1YWxSZW5kZXJGaWxsID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBmb3JjZU1vdmUsIG9mZnNldCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gc2VsZi50YWJsZUVsZW1lbnQsXG5cdFx0ICAgIGhvbGRlciA9IHNlbGYuZWxlbWVudCxcblx0XHQgICAgdG9wUGFkID0gMCxcblx0XHQgICAgcm93c0hlaWdodCA9IDAsXG5cdFx0ICAgIHRvcFBhZEhlaWdodCA9IDAsXG5cdFx0ICAgIGkgPSAwLFxuXHRcdCAgICBvbmx5R3JvdXBIZWFkZXJzID0gdHJ1ZSxcblx0XHQgICAgcm93cyA9IHNlbGYuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdHBvc2l0aW9uID0gcG9zaXRpb24gfHwgMDtcblxuXHRcdG9mZnNldCA9IG9mZnNldCB8fCAwO1xuXG5cdFx0aWYgKCFwb3NpdGlvbikge1xuXG5cdFx0XHRzZWxmLl9jbGVhclZpcnR1YWxEb20oKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR3aGlsZSAoZWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdH0gLy9jaGVjayBpZiBwb3NpdGlvbiBpcyB0b28gY2xvc2UgdG8gYm90dG9tIG9mIHRhYmxlXG5cblx0XHRcdHZhciBoZWlnaHRPY2N1cGllZCA9IChzZWxmLmRpc3BsYXlSb3dzQ291bnQgLSBwb3NpdGlvbiArIDEpICogc2VsZi52RG9tUm93SGVpZ2h0O1xuXG5cdFx0XHRpZiAoaGVpZ2h0T2NjdXBpZWQgPCBzZWxmLmhlaWdodCkge1xuXG5cdFx0XHRcdHBvc2l0aW9uIC09IE1hdGguY2VpbCgoc2VsZi5oZWlnaHQgLSBoZWlnaHRPY2N1cGllZCkgLyBzZWxmLnZEb21Sb3dIZWlnaHQpO1xuXG5cdFx0XHRcdGlmIChwb3NpdGlvbiA8IDApIHtcblxuXHRcdFx0XHRcdHBvc2l0aW9uID0gMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL2NhbGN1bGF0ZSBpbml0aWFsIHBhZFxuXG5cdFx0XHR0b3BQYWQgPSBNYXRoLm1pbihNYXRoLm1heChNYXRoLmZsb29yKHNlbGYudkRvbVdpbmRvd0J1ZmZlciAvIHNlbGYudkRvbVJvd0hlaWdodCksIHNlbGYudkRvbVdpbmRvd01pbk1hcmdpblJvd3MpLCBwb3NpdGlvbik7XG5cblx0XHRcdHBvc2l0aW9uIC09IHRvcFBhZDtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5kaXNwbGF5Um93c0NvdW50ICYmIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbFZpc2libGUoc2VsZi5lbGVtZW50KSkge1xuXG5cdFx0XHRzZWxmLnZEb21Ub3AgPSBwb3NpdGlvbjtcblxuXHRcdFx0c2VsZi52RG9tQm90dG9tID0gcG9zaXRpb24gLSAxO1xuXG5cdFx0XHR3aGlsZSAoKHJvd3NIZWlnaHQgPD0gc2VsZi5oZWlnaHQgKyBzZWxmLnZEb21XaW5kb3dCdWZmZXIgfHwgaSA8IHNlbGYudkRvbVdpbmRvd01pblRvdGFsUm93cykgJiYgc2VsZi52RG9tQm90dG9tIDwgc2VsZi5kaXNwbGF5Um93c0NvdW50IC0gMSkge1xuXG5cdFx0XHRcdHZhciBpbmRleCA9IHNlbGYudkRvbUJvdHRvbSArIDEsXG5cdFx0XHRcdCAgICByb3cgPSByb3dzW2luZGV4XSxcblx0XHRcdFx0ICAgIHJvd0hlaWdodCA9IDA7XG5cblx0XHRcdFx0c2VsZi5zdHlsZVJvdyhyb3csIGluZGV4KTtcblxuXHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHJvdy5nZXRFbGVtZW50KCkpO1xuXG5cdFx0XHRcdGlmICghcm93LmluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0XHRyb3cuaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGlmICghcm93LmhlaWdodEluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0XHRcdHJvdy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93SGVpZ2h0ID0gcm93LmdldEhlaWdodCgpO1xuXG5cdFx0XHRcdGlmIChpIDwgdG9wUGFkKSB7XG5cblx0XHRcdFx0XHR0b3BQYWRIZWlnaHQgKz0gcm93SGVpZ2h0O1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cm93c0hlaWdodCArPSByb3dIZWlnaHQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocm93SGVpZ2h0ID4gdGhpcy52RG9tV2luZG93QnVmZmVyKSB7XG5cblx0XHRcdFx0XHR0aGlzLnZEb21XaW5kb3dCdWZmZXIgPSByb3dIZWlnaHQgKiAyO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHJvdy50eXBlICE9PSBcImdyb3VwXCIpIHtcblxuXHRcdFx0XHRcdG9ubHlHcm91cEhlYWRlcnMgPSBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYudkRvbUJvdHRvbSsrO1xuXG5cdFx0XHRcdGkrKztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFwb3NpdGlvbikge1xuXG5cdFx0XHRcdHRoaXMudkRvbVRvcFBhZCA9IDA7XG5cblx0XHRcdFx0Ly9hZGp1c3Qgcm93aGVpZ2h0IHRvIG1hdGNoIGF2ZXJhZ2Ugb2YgcmVuZGVyZWQgZWxlbWVudHNcblxuXHRcdFx0XHRzZWxmLnZEb21Sb3dIZWlnaHQgPSBNYXRoLmZsb29yKChyb3dzSGVpZ2h0ICsgdG9wUGFkSGVpZ2h0KSAvIGkpO1xuXG5cdFx0XHRcdHNlbGYudkRvbUJvdHRvbVBhZCA9IHNlbGYudkRvbVJvd0hlaWdodCAqIChzZWxmLmRpc3BsYXlSb3dzQ291bnQgLSBzZWxmLnZEb21Cb3R0b20gLSAxKTtcblxuXHRcdFx0XHRzZWxmLnZEb21TY3JvbGxIZWlnaHQgPSB0b3BQYWRIZWlnaHQgKyByb3dzSGVpZ2h0ICsgc2VsZi52RG9tQm90dG9tUGFkIC0gc2VsZi5oZWlnaHQ7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHNlbGYudkRvbVRvcFBhZCA9ICFmb3JjZU1vdmUgPyBzZWxmLnNjcm9sbFRvcCAtIHRvcFBhZEhlaWdodCA6IHNlbGYudkRvbVJvd0hlaWdodCAqIHRoaXMudkRvbVRvcCArIG9mZnNldDtcblxuXHRcdFx0XHRzZWxmLnZEb21Cb3R0b21QYWQgPSBzZWxmLnZEb21Cb3R0b20gPT0gc2VsZi5kaXNwbGF5Um93c0NvdW50IC0gMSA/IDAgOiBNYXRoLm1heChzZWxmLnZEb21TY3JvbGxIZWlnaHQgLSBzZWxmLnZEb21Ub3BQYWQgLSByb3dzSGVpZ2h0IC0gdG9wUGFkSGVpZ2h0LCAwKTtcblx0XHRcdH1cblxuXHRcdFx0ZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gc2VsZi52RG9tVG9wUGFkICsgXCJweFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLnBhZGRpbmdCb3R0b20gPSBzZWxmLnZEb21Cb3R0b21QYWQgKyBcInB4XCI7XG5cblx0XHRcdGlmIChmb3JjZU1vdmUpIHtcblxuXHRcdFx0XHR0aGlzLnNjcm9sbFRvcCA9IHNlbGYudkRvbVRvcFBhZCArIHRvcFBhZEhlaWdodCArIG9mZnNldCAtICh0aGlzLmVsZW1lbnQuc2Nyb2xsV2lkdGggPiB0aGlzLmVsZW1lbnQuY2xpZW50V2lkdGggPyB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCA6IDApO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnNjcm9sbFRvcCA9IE1hdGgubWluKHRoaXMuc2Nyb2xsVG9wLCB0aGlzLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gdGhpcy5oZWlnaHQpO1xuXG5cdFx0XHQvL2FkanVzdCBmb3IgaG9yaXpvbnRhbCBzY3JvbGxiYXIgaWYgcHJlc2VudCAoYW5kIG5vdCBhdCB0b3Agb2YgdGFibGUpXG5cblx0XHRcdGlmICh0aGlzLmVsZW1lbnQuc2Nyb2xsV2lkdGggPiB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGggJiYgZm9yY2VNb3ZlKSB7XG5cblx0XHRcdFx0dGhpcy5zY3JvbGxUb3AgKz0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodCAtIHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQ7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc1RvcCA9IHRoaXMuc2Nyb2xsVG9wO1xuXG5cdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NCb3R0b20gPSB0aGlzLnNjcm9sbFRvcDtcblxuXHRcdFx0aG9sZGVyLnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbldpZHRoID0gb25seUdyb3VwSGVhZGVycyA/IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiIDogXCJcIjtcblxuXHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5ncm91cEJ5KSB7XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpICE9IFwiZml0RGF0YUZpbGxcIiAmJiBzZWxmLmRpc3BsYXlSb3dzQ291bnQgPT0gc2VsZi50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5jb3VudEdyb3VwcygpKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5yZW5kZXJFbXB0eVNjcm9sbCgpO1xuXHRcdH1cblxuXHRcdGlmICghdGhpcy5maXhlZEhlaWdodCkge1xuXG5cdFx0XHR0aGlzLmFkanVzdFRhYmxlU2l6ZSgpO1xuXHRcdH1cblx0fTtcblxuXHQvL2hhbmRsZSB2ZXJ0aWNhbCBzY3JvbGxpbmdcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5zY3JvbGxWZXJ0aWNhbCA9IGZ1bmN0aW9uIChkaXIpIHtcblxuXHRcdHZhciB0b3BEaWZmID0gdGhpcy5zY3JvbGxUb3AgLSB0aGlzLnZEb21TY3JvbGxQb3NUb3A7XG5cblx0XHR2YXIgYm90dG9tRGlmZiA9IHRoaXMuc2Nyb2xsVG9wIC0gdGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tO1xuXG5cdFx0dmFyIG1hcmdpbiA9IHRoaXMudkRvbVdpbmRvd0J1ZmZlciAqIDI7XG5cblx0XHRpZiAoLXRvcERpZmYgPiBtYXJnaW4gfHwgYm90dG9tRGlmZiA+IG1hcmdpbikge1xuXG5cdFx0XHQvL2lmIGJpZyBzY3JvbGwgcmVkcmF3IHRhYmxlO1xuXG5cdFx0XHR2YXIgbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblxuXHRcdFx0dGhpcy5fdmlydHVhbFJlbmRlckZpbGwoTWF0aC5mbG9vcih0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wIC8gdGhpcy5lbGVtZW50LnNjcm9sbEhlaWdodCAqIHRoaXMuZGlzcGxheVJvd3NDb3VudCkpO1xuXG5cdFx0XHR0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGRpcikge1xuXG5cdFx0XHRcdC8vc2Nyb2xsaW5nIHVwXG5cblx0XHRcdFx0aWYgKHRvcERpZmYgPCAwKSB7XG5cblx0XHRcdFx0XHR0aGlzLl9hZGRUb3BSb3coLXRvcERpZmYpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGJvdHRvbURpZmYgPCAwKSB7XG5cblx0XHRcdFx0XHQvL2hpZGUgYm90dG9tIHJvdyBpZiBuZWVkZWRcblxuXHRcdFx0XHRcdGlmICh0aGlzLnZEb21TY3JvbGxIZWlnaHQgLSB0aGlzLnNjcm9sbFRvcCA+IHRoaXMudkRvbVdpbmRvd0J1ZmZlcikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLl9yZW1vdmVCb3R0b21Sb3coLWJvdHRvbURpZmYpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQvL3Njcm9sbGluZyBkb3duXG5cblx0XHRcdFx0aWYgKHRvcERpZmYgPj0gMCkge1xuXG5cdFx0XHRcdFx0Ly9oaWRlIHRvcCByb3cgaWYgbmVlZGVkXG5cblx0XHRcdFx0XHRpZiAodGhpcy5zY3JvbGxUb3AgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5fcmVtb3ZlVG9wUm93KHRvcERpZmYpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChib3R0b21EaWZmID49IDApIHtcblxuXHRcdFx0XHRcdHRoaXMuX2FkZEJvdHRvbVJvdyhib3R0b21EaWZmKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fYWRkVG9wUm93ID0gZnVuY3Rpb24gKHRvcERpZmYpIHtcblx0XHR2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDtcblxuXG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0ICAgIHJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cblx0XHRpZiAodGhpcy52RG9tVG9wKSB7XG5cblx0XHRcdHZhciBpbmRleCA9IHRoaXMudkRvbVRvcCAtIDEsXG5cdFx0XHQgICAgdG9wUm93ID0gcm93c1tpbmRleF0sXG5cdFx0XHQgICAgdG9wUm93SGVpZ2h0ID0gdG9wUm93LmdldEhlaWdodCgpIHx8IHRoaXMudkRvbVJvd0hlaWdodDtcblxuXHRcdFx0Ly9oaWRlIHRvcCByb3cgaWYgbmVlZGVkXG5cblx0XHRcdGlmICh0b3BEaWZmID49IHRvcFJvd0hlaWdodCkge1xuXG5cdFx0XHRcdHRoaXMuc3R5bGVSb3codG9wUm93LCBpbmRleCk7XG5cblx0XHRcdFx0dGFibGUuaW5zZXJ0QmVmb3JlKHRvcFJvdy5nZXRFbGVtZW50KCksIHRhYmxlLmZpcnN0Q2hpbGQpO1xuXG5cdFx0XHRcdGlmICghdG9wUm93LmluaXRpYWxpemVkIHx8ICF0b3BSb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdHRoaXMudkRvbVRvcE5ld1Jvd3MucHVzaCh0b3BSb3cpO1xuXG5cdFx0XHRcdFx0aWYgKCF0b3BSb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpIHtcblxuXHRcdFx0XHRcdFx0dG9wUm93LmNsZWFyQ2VsbEhlaWdodCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRvcFJvdy5pbml0aWFsaXplKCk7XG5cblx0XHRcdFx0dGhpcy52RG9tVG9wUGFkIC09IHRvcFJvd0hlaWdodDtcblxuXHRcdFx0XHRpZiAodGhpcy52RG9tVG9wUGFkIDwgMCkge1xuXG5cdFx0XHRcdFx0dGhpcy52RG9tVG9wUGFkID0gaW5kZXggKiB0aGlzLnZEb21Sb3dIZWlnaHQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIWluZGV4KSB7XG5cblx0XHRcdFx0XHR0aGlzLnZEb21Ub3BQYWQgPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFibGUuc3R5bGUucGFkZGluZ1RvcCA9IHRoaXMudkRvbVRvcFBhZCArIFwicHhcIjtcblxuXHRcdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgLT0gdG9wUm93SGVpZ2h0O1xuXG5cdFx0XHRcdHRoaXMudkRvbVRvcC0tO1xuXHRcdFx0fVxuXG5cdFx0XHR0b3BEaWZmID0gLSh0aGlzLnNjcm9sbFRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc1RvcCk7XG5cblx0XHRcdGlmICh0b3BSb3cuZ2V0SGVpZ2h0KCkgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpIHtcblxuXHRcdFx0XHR0aGlzLnZEb21XaW5kb3dCdWZmZXIgPSB0b3BSb3cuZ2V0SGVpZ2h0KCkgKiAyO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaSA8IHRoaXMudkRvbU1heFJlbmRlckNoYWluICYmIHRoaXMudkRvbVRvcCAmJiB0b3BEaWZmID49IChyb3dzW3RoaXMudkRvbVRvcCAtIDFdLmdldEhlaWdodCgpIHx8IHRoaXMudkRvbVJvd0hlaWdodCkpIHtcblxuXHRcdFx0XHR0aGlzLl9hZGRUb3BSb3codG9wRGlmZiwgaSArIDEpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR0aGlzLl9xdWlja05vcm1hbGl6ZVJvd0hlaWdodCh0aGlzLnZEb21Ub3BOZXdSb3dzKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX3JlbW92ZVRvcFJvdyA9IGZ1bmN0aW9uICh0b3BEaWZmKSB7XG5cblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlRWxlbWVudCxcblx0XHQgICAgdG9wUm93ID0gdGhpcy5nZXREaXNwbGF5Um93cygpW3RoaXMudkRvbVRvcF0sXG5cdFx0ICAgIHRvcFJvd0hlaWdodCA9IHRvcFJvdy5nZXRIZWlnaHQoKSB8fCB0aGlzLnZEb21Sb3dIZWlnaHQ7XG5cblx0XHRpZiAodG9wRGlmZiA+PSB0b3BSb3dIZWlnaHQpIHtcblxuXHRcdFx0dmFyIHJvd0VsID0gdG9wUm93LmdldEVsZW1lbnQoKTtcblxuXHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cblx0XHRcdHRoaXMudkRvbVRvcFBhZCArPSB0b3BSb3dIZWlnaHQ7XG5cblx0XHRcdHRhYmxlLnN0eWxlLnBhZGRpbmdUb3AgPSB0aGlzLnZEb21Ub3BQYWQgKyBcInB4XCI7XG5cblx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc1RvcCArPSB0aGlzLnZEb21Ub3AgPyB0b3BSb3dIZWlnaHQgOiB0b3BSb3dIZWlnaHQgKyB0aGlzLnZEb21XaW5kb3dCdWZmZXI7XG5cblx0XHRcdHRoaXMudkRvbVRvcCsrO1xuXG5cdFx0XHR0b3BEaWZmID0gdGhpcy5zY3JvbGxUb3AgLSB0aGlzLnZEb21TY3JvbGxQb3NUb3A7XG5cblx0XHRcdHRoaXMuX3JlbW92ZVRvcFJvdyh0b3BEaWZmKTtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX2FkZEJvdHRvbVJvdyA9IGZ1bmN0aW9uIChib3R0b21EaWZmKSB7XG5cdFx0dmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7XG5cblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGVFbGVtZW50LFxuXHRcdCAgICByb3dzID0gdGhpcy5nZXREaXNwbGF5Um93cygpO1xuXG5cdFx0aWYgKHRoaXMudkRvbUJvdHRvbSA8IHRoaXMuZGlzcGxheVJvd3NDb3VudCAtIDEpIHtcblxuXHRcdFx0dmFyIGluZGV4ID0gdGhpcy52RG9tQm90dG9tICsgMSxcblx0XHRcdCAgICBib3R0b21Sb3cgPSByb3dzW2luZGV4XSxcblx0XHRcdCAgICBib3R0b21Sb3dIZWlnaHQgPSBib3R0b21Sb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXG5cdFx0XHQvL2hpZGUgYm90dG9tIHJvdyBpZiBuZWVkZWRcblxuXHRcdFx0aWYgKGJvdHRvbURpZmYgPj0gYm90dG9tUm93SGVpZ2h0KSB7XG5cblx0XHRcdFx0dGhpcy5zdHlsZVJvdyhib3R0b21Sb3csIGluZGV4KTtcblxuXHRcdFx0XHR0YWJsZS5hcHBlbmRDaGlsZChib3R0b21Sb3cuZ2V0RWxlbWVudCgpKTtcblxuXHRcdFx0XHRpZiAoIWJvdHRvbVJvdy5pbml0aWFsaXplZCB8fCAhYm90dG9tUm93LmhlaWdodEluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0XHR0aGlzLnZEb21Cb3R0b21OZXdSb3dzLnB1c2goYm90dG9tUm93KTtcblxuXHRcdFx0XHRcdGlmICghYm90dG9tUm93LmhlaWdodEluaXRpYWxpemVkKSB7XG5cblx0XHRcdFx0XHRcdGJvdHRvbVJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRib3R0b21Sb3cuaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHRcdHRoaXMudkRvbUJvdHRvbVBhZCAtPSBib3R0b21Sb3dIZWlnaHQ7XG5cblx0XHRcdFx0aWYgKHRoaXMudkRvbUJvdHRvbVBhZCA8IDAgfHwgaW5kZXggPT0gdGhpcy5kaXNwbGF5Um93c0NvdW50IC0gMSkge1xuXG5cdFx0XHRcdFx0dGhpcy52RG9tQm90dG9tUGFkID0gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRhYmxlLnN0eWxlLnBhZGRpbmdCb3R0b20gPSB0aGlzLnZEb21Cb3R0b21QYWQgKyBcInB4XCI7XG5cblx0XHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tICs9IGJvdHRvbVJvd0hlaWdodDtcblxuXHRcdFx0XHR0aGlzLnZEb21Cb3R0b20rKztcblx0XHRcdH1cblxuXHRcdFx0Ym90dG9tRGlmZiA9IHRoaXMuc2Nyb2xsVG9wIC0gdGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tO1xuXG5cdFx0XHRpZiAoYm90dG9tUm93LmdldEhlaWdodCgpID4gdGhpcy52RG9tV2luZG93QnVmZmVyKSB7XG5cblx0XHRcdFx0dGhpcy52RG9tV2luZG93QnVmZmVyID0gYm90dG9tUm93LmdldEhlaWdodCgpICogMjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGkgPCB0aGlzLnZEb21NYXhSZW5kZXJDaGFpbiAmJiB0aGlzLnZEb21Cb3R0b20gPCB0aGlzLmRpc3BsYXlSb3dzQ291bnQgLSAxICYmIGJvdHRvbURpZmYgPj0gKHJvd3NbdGhpcy52RG9tQm90dG9tICsgMV0uZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0KSkge1xuXG5cdFx0XHRcdHRoaXMuX2FkZEJvdHRvbVJvdyhib3R0b21EaWZmLCBpICsgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuX3F1aWNrTm9ybWFsaXplUm93SGVpZ2h0KHRoaXMudkRvbUJvdHRvbU5ld1Jvd3MpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5fcmVtb3ZlQm90dG9tUm93ID0gZnVuY3Rpb24gKGJvdHRvbURpZmYpIHtcblxuXHRcdHZhciB0YWJsZSA9IHRoaXMudGFibGVFbGVtZW50LFxuXHRcdCAgICBib3R0b21Sb3cgPSB0aGlzLmdldERpc3BsYXlSb3dzKClbdGhpcy52RG9tQm90dG9tXSxcblx0XHQgICAgYm90dG9tUm93SGVpZ2h0ID0gYm90dG9tUm93LmdldEhlaWdodCgpIHx8IHRoaXMudkRvbVJvd0hlaWdodDtcblxuXHRcdGlmIChib3R0b21EaWZmID49IGJvdHRvbVJvd0hlaWdodCkge1xuXG5cdFx0XHR2YXIgcm93RWwgPSBib3R0b21Sb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRpZiAocm93RWwucGFyZW50Tm9kZSkge1xuXG5cdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm93RWwpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnZEb21Cb3R0b21QYWQgKz0gYm90dG9tUm93SGVpZ2h0O1xuXG5cdFx0XHRpZiAodGhpcy52RG9tQm90dG9tUGFkIDwgMCkge1xuXG5cdFx0XHRcdHRoaXMudkRvbUJvdHRvbVBhZCA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdHRhYmxlLnN0eWxlLnBhZGRpbmdCb3R0b20gPSB0aGlzLnZEb21Cb3R0b21QYWQgKyBcInB4XCI7XG5cblx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSAtPSBib3R0b21Sb3dIZWlnaHQ7XG5cblx0XHRcdHRoaXMudkRvbUJvdHRvbS0tO1xuXG5cdFx0XHRib3R0b21EaWZmID0gLSh0aGlzLnNjcm9sbFRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSk7XG5cblx0XHRcdHRoaXMuX3JlbW92ZUJvdHRvbVJvdyhib3R0b21EaWZmKTtcblx0XHR9XG5cdH07XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuX3F1aWNrTm9ybWFsaXplUm93SGVpZ2h0ID0gZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdHJvdy5jYWxjSGVpZ2h0KCk7XG5cdFx0fSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdH0pO1xuXG5cdFx0cm93cy5sZW5ndGggPSAwO1xuXHR9O1xuXG5cdC8vbm9ybWFsaXplIGhlaWdodCBvZiBhY3RpdmUgcm93c1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLm5vcm1hbGl6ZUhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuYWN0aXZlUm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdFx0cm93Lm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdC8vYWRqdXN0IHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlIGhvbGRlciB0byBmaXQgaW4gdGhlIFRhYnVsYXRvciBlbGVtZW50XG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUuYWRqdXN0VGFibGVTaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGluaXRpYWxIZWlnaHQgPSB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0LFxuXHRcdCAgICBtb2RFeGlzdHM7XG5cblx0XHRpZiAodGhpcy5yZW5kZXJNb2RlID09PSBcInZpcnR1YWxcIikge1xuXG5cdFx0XHR2YXIgb3RoZXJIZWlnaHQgPSB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0RWxlbWVudCgpLm9mZnNldEhlaWdodCArICh0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIgJiYgIXRoaXMudGFibGUuZm9vdGVyTWFuYWdlci5leHRlcm5hbCA/IHRoaXMudGFibGUuZm9vdGVyTWFuYWdlci5nZXRFbGVtZW50KCkub2Zmc2V0SGVpZ2h0IDogMCk7XG5cblx0XHRcdGlmICh0aGlzLmZpeGVkSGVpZ2h0KSB7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IFwiY2FsYygxMDAlIC0gXCIgKyBvdGhlckhlaWdodCArIFwicHgpXCI7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IFwiY2FsYygxMDAlIC0gXCIgKyBvdGhlckhlaWdodCArIFwicHgpXCI7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLm1heEhlaWdodCA9IFwiY2FsYygxMDAlIC0gXCIgKyBvdGhlckhlaWdodCArIFwicHgpXCI7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuXG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gb3RoZXJIZWlnaHQgKyBcInB4XCI7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmhlaWdodCA9IHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQ7XG5cblx0XHRcdHRoaXMudkRvbVdpbmRvd0J1ZmZlciA9IHRoaXMudGFibGUub3B0aW9ucy52aXJ0dWFsRG9tQnVmZmVyIHx8IHRoaXMuaGVpZ2h0O1xuXG5cdFx0XHQvL2NoZWNrIGlmIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzaXplIHdoZW4gZGVhbGluZyB3aXRoIHZhcmlhYmxlIGhlaWdodCB0YWJsZXNcblxuXHRcdFx0aWYgKCF0aGlzLmZpeGVkSGVpZ2h0ICYmIGluaXRpYWxIZWlnaHQgIT0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCkge1xuXG5cdFx0XHRcdG1vZEV4aXN0cyA9IHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzaXplVGFibGVcIik7XG5cblx0XHRcdFx0aWYgKG1vZEV4aXN0cyAmJiAhdGhpcy50YWJsZS5tb2R1bGVzLnJlc2l6ZVRhYmxlLmF1dG9SZXNpemUgfHwgIW1vZEV4aXN0cykge1xuXG5cdFx0XHRcdFx0dGhpcy5yZWRyYXcoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3Jlbml0aWFsaXplIGFsbCByb3dzXG5cblx0Um93TWFuYWdlci5wcm90b3R5cGUucmVpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cucmVpbml0aWFsaXplKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9wcmV2ZW50IHRhYmxlIGZyb20gYmVpbmcgcmVkcmF3blxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLmJsb2NrUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5yZWRyYXdCbG9jayA9IHRydWU7XG5cblx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZyA9IGZhbHNlO1xuXHR9O1xuXG5cdC8vcmVzdG9yZSB0YWJsZSByZWRyYXdpbmdcblxuXHRSb3dNYW5hZ2VyLnByb3RvdHlwZS5yZXN0b3JlUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5yZWRyYXdCbG9jayA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnKSB7XG5cblx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEodGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuc3RhZ2UsIHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnLnNraXBTdGFnZSwgdGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcucmVuZGVySW5Qb3NpdGlvbik7XG5cblx0XHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHRoaXMucmVkcmF3QmxvY2tSZWRlckluUG9zaXRpb24pIHtcblxuXHRcdFx0XHR0aGlzLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMucmVkcmF3QmxvY2tSZWRlckluUG9zaXRpb24gPSBmYWxzZTtcblx0fTtcblxuXHQvL3JlZHJhdyB0YWJsZVxuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXG5cdFx0dmFyIHBvcyA9IDAsXG5cdFx0ICAgIGxlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XG5cblx0XHR0aGlzLmFkanVzdFRhYmxlU2l6ZSgpO1xuXG5cdFx0dGhpcy50YWJsZS50YWJsZVdpZHRoID0gdGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXG5cdFx0aWYgKCFmb3JjZSkge1xuXG5cdFx0XHRpZiAodGhpcy5yZW5kZXJNb2RlID09IFwiY2xhc3NpY1wiKSB7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KSB7XG5cblx0XHRcdFx0XHR0aGlzLnJlZnJlc2hBY3RpdmVEYXRhKFwiZ3JvdXBcIiwgZmFsc2UsIGZhbHNlKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHRoaXMuX3NpbXBsZVJlbmRlcigpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cblx0XHRcdFx0dGhpcy5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXRoaXMuZGlzcGxheVJvd3NDb3VudCkge1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcblxuXHRcdFx0XHRcdHRoaXMuZ2V0RWxlbWVudCgpLmFwcGVuZENoaWxkKHRoaXMudGFibGUub3B0aW9ucy5wbGFjZWhvbGRlcik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnJlbmRlclRhYmxlKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd01hbmFnZXIucHJvdG90eXBlLnJlc2V0U2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5lbGVtZW50LnNjcm9sbExlZnQgPSAwO1xuXG5cdFx0dGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IDA7XG5cblx0XHRpZiAodGhpcy50YWJsZS5icm93c2VyID09PSBcImllXCIpIHtcblxuXHRcdFx0dmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJFdmVudFwiKTtcblxuXHRcdFx0ZXZlbnQuaW5pdEV2ZW50KFwic2Nyb2xsXCIsIGZhbHNlLCB0cnVlKTtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnc2Nyb2xsJykpO1xuXHRcdH1cblx0fTtcblxuXHQvL3B1YmxpYyByb3cgb2JqZWN0XG5cblx0dmFyIFJvd0NvbXBvbmVudCA9IGZ1bmN0aW9uIFJvd0NvbXBvbmVudChyb3cpIHtcblxuXHRcdHRoaXMuX3JvdyA9IHJvdztcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LmdldERhdGEodHJhbnNmb3JtKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LmdldEVsZW1lbnQoKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldENlbGxzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGxzID0gW107XG5cblx0XHR0aGlzLl9yb3cuZ2V0Q2VsbHMoKS5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdGNlbGxzLnB1c2goY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gY2VsbHM7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRDZWxsID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXG5cdFx0dmFyIGNlbGwgPSB0aGlzLl9yb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXG5cdFx0cmV0dXJuIGNlbGwgPyBjZWxsLmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRJbmRleCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0RGF0YShcImRhdGFcIilbdGhpcy5fcm93LnRhYmxlLm9wdGlvbnMuaW5kZXhdO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoYWN0aXZlKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93UG9zaXRpb24odGhpcy5fcm93LCBhY3RpdmUpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy5kZWxldGUoKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnNjcm9sbFRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHRoaXMuX3Jvdyk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5wYWdlVG8gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fcm93LnRhYmxlLm1vZEV4aXN0cyhcInBhZ2VcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0UGFnZVRvUm93KHRoaXMuX3Jvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uICh0bywgYWZ0ZXIpIHtcblxuXHRcdHRoaXMuX3Jvdy5tb3ZlVG9Sb3codG8sIGFmdGVyKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LnVwZGF0ZURhdGEoZGF0YSk7XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5ub3JtYWxpemVIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLl9yb3cubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LnNlbGVjdFJvd3ModGhpcy5fcm93KTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmRlc2VsZWN0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LmRlc2VsZWN0Um93cyh0aGlzLl9yb3cpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUudG9nZ2xlU2VsZWN0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LnRvZ2dsZVJvdyh0aGlzLl9yb3cpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuaXNTZWxlY3RlZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9yb3cudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuaXNSb3dTZWxlY3RlZCh0aGlzLl9yb3cpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuX2dldFNlbGYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93O1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZnJlZXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Sb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLmZyb3plblJvd3MuZnJlZXplUm93KHRoaXMuX3Jvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUudW5mcmVlemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5fcm93LnRhYmxlLm1vZEV4aXN0cyhcImZyb3plblJvd3NcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZnJvemVuUm93cy51bmZyZWV6ZVJvdyh0aGlzLl9yb3cpO1xuXHRcdH1cblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnRyZWVDb2xsYXBzZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuY29sbGFwc2VSb3codGhpcy5fcm93KTtcblx0XHR9XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS50cmVlRXhwYW5kID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5kYXRhVHJlZS5leHBhbmRSb3codGhpcy5fcm93KTtcblx0XHR9XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS50cmVlVG9nZ2xlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLl9yb3cudGFibGUubW9kdWxlcy5kYXRhVHJlZS50b2dnbGVSb3codGhpcy5fcm93KTtcblx0XHR9XG5cdH07XG5cblx0Um93Q29tcG9uZW50LnByb3RvdHlwZS5nZXRUcmVlUGFyZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuX3Jvdy50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZ2V0VHJlZVBhcmVudCh0aGlzLl9yb3cpO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldFRyZWVDaGlsZHJlbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLl9yb3cudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldFRyZWVDaGlsZHJlbih0aGlzLl9yb3cpO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLnJlZm9ybWF0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy5yZWluaXRpYWxpemUoKTtcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldEdyb3VwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy5nZXRHcm91cCgpLmdldENvbXBvbmVudCgpO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0VGFibGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fcm93LnRhYmxlO1xuXHR9O1xuXG5cdFJvd0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0TmV4dFJvdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLl9yb3cubmV4dFJvdygpO1xuXG5cdFx0cmV0dXJuIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHJvdztcblx0fTtcblxuXHRSb3dDb21wb25lbnQucHJvdG90eXBlLmdldFByZXZSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgcm93ID0gdGhpcy5fcm93LnByZXZSb3coKTtcblxuXHRcdHJldHVybiByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiByb3c7XG5cdH07XG5cblx0dmFyIFJvdyA9IGZ1bmN0aW9uIFJvdyhkYXRhLCBwYXJlbnQpIHtcblx0XHR2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogXCJyb3dcIjtcblxuXG5cdFx0dGhpcy50YWJsZSA9IHBhcmVudC50YWJsZTtcblxuXHRcdHRoaXMucGFyZW50ID0gcGFyZW50O1xuXG5cdFx0dGhpcy5kYXRhID0ge307XG5cblx0XHR0aGlzLnR5cGUgPSB0eXBlOyAvL3R5cGUgb2YgZWxlbWVudFxuXG5cdFx0dGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVFbGVtZW50KCk7XG5cblx0XHR0aGlzLm1vZHVsZXMgPSB7fTsgLy9ob2xkIG1vZHVsZSB2YXJpYWJsZXM7XG5cblx0XHR0aGlzLmNlbGxzID0gW107XG5cblx0XHR0aGlzLmhlaWdodCA9IDA7IC8vaG9sZCBlbGVtZW50IGhlaWdodFxuXG5cdFx0dGhpcy5oZWlnaHRTdHlsZWQgPSBcIlwiOyAvL2hvbGQgZWxlbWVudCBoZWlnaHQgcHJlc3R5bGVkIHRvIGltcHJvdmUgcmVuZGVyIGVmZmljaWVuY3lcblxuXHRcdHRoaXMubWFudWFsSGVpZ2h0ID0gZmFsc2U7IC8vdXNlciBoYXMgbWFudWFsbHkgc2V0IHJvdyBoZWlnaHRcblxuXHRcdHRoaXMub3V0ZXJIZWlnaHQgPSAwOyAvL2hvbGRlIGxlbWVudHMgb3V0ZXIgaGVpZ2h0XG5cblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7IC8vZWxlbWVudCBoYXMgYmVlbiByZW5kZXJlZFxuXG5cdFx0dGhpcy5oZWlnaHRJbml0aWFsaXplZCA9IGZhbHNlOyAvL2VsZW1lbnQgaGFzIHJlc2l6ZWQgY2VsbHMgdG8gZml0XG5cblxuXHRcdHRoaXMuc2V0RGF0YShkYXRhKTtcblxuXHRcdHRoaXMuZ2VuZXJhdGVFbGVtZW50KCk7XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInJvd1wiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZGV0YWNoRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpIHtcblxuXHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHR9XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5nZW5lcmF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGRibFRhcCxcblx0XHQgICAgdGFwSG9sZCxcblx0XHQgICAgdGFwO1xuXG5cdFx0Ly9zZXQgcm93IHNlbGVjdGlvbiBjaGFyYWN0ZXJpc3RpY3NcblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSAhPT0gZmFsc2UgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5pbml0aWFsaXplUm93KHRoaXMpO1xuXHRcdH1cblxuXHRcdC8vc2V0dXAgbW92YWJsZSByb3dzXG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzICE9PSBmYWxzZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcIm1vdmVSb3dcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLm1vdmVSb3cuaW5pdGlhbGl6ZVJvdyh0aGlzKTtcblx0XHR9XG5cblx0XHQvL3NldHVwIGRhdGEgdHJlZVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5kYXRhVHJlZSAhPT0gZmFsc2UgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJkYXRhVHJlZVwiKSkge1xuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuaW5pdGlhbGl6ZVJvdyh0aGlzKTtcblx0XHR9XG5cblx0XHQvL3NldHVwIGNvbHVtbiBjb2xhcHNlIGNvbnRhaW5lclxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ID09PSBcImNvbGxhcHNlXCIgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmluaXRpYWxpemVSb3codGhpcyk7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgY29sdW1uIG1lbnVcblxuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucm93Q29udGV4dE1lbnUgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtZW51XCIpKSB7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5tZW51LmluaXRpYWxpemVSb3codGhpcyk7XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgcm93IGNsaWNrIGV2ZW50c1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dDbGljaykge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd0NsaWNrKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dEYmxDbGljaykge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd0RibENsaWNrKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dDb250ZXh0KSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93Q29udGV4dChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vaGFuZGxlIG1vdXNlIGV2ZW50c1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZUVudGVyKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZUVudGVyKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZUxlYXZlKSB7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZUxlYXZlKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZU92ZXIpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93TW91c2VPdmVyKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZU91dCkge1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd01vdXNlT3V0KGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dNb3VzZU1vdmUpIHtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93TW91c2VNb3ZlKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yb3dUYXApIHtcblxuXHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHRhcCA9IHRydWU7XG5cdFx0XHR9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRpZiAodGFwKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93VGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFwID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd0RibFRhcCkge1xuXG5cdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0aWYgKGRibFRhcCkge1xuXG5cdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRibFRhcCk7XG5cblx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd0RibFRhcChlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGRibFRhcCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQoZGJsVGFwKTtcblxuXHRcdFx0XHRcdFx0ZGJsVGFwID0gbnVsbDtcblx0XHRcdFx0XHR9LCAzMDApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJvd1RhcEhvbGQpIHtcblxuXHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cblx0XHRcdFx0XHR0YXBIb2xkID0gbnVsbDtcblxuXHRcdFx0XHRcdHRhcCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd1RhcEhvbGQoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2VuZXJhdGVDZWxscyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuY2VsbHMgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2VuZXJhdGVDZWxscyh0aGlzKTtcblx0fTtcblxuXHQvL2Z1bmN0aW9ucyB0byBzZXR1cCBvbiBmaXJzdCByZW5kZXJcblxuXHRSb3cucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmICghc2VsZi5pbml0aWFsaXplZCB8fCBmb3JjZSkge1xuXG5cdFx0XHRzZWxmLmRlbGV0ZUNlbGxzKCk7XG5cblx0XHRcdHdoaWxlIChzZWxmLmVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRzZWxmLmVsZW1lbnQucmVtb3ZlQ2hpbGQoc2VsZi5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0fSAvL2hhbmRsZSBmcm96ZW4gY2VsbHNcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZnJvemVuQ29sdW1uc1wiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxheW91dFJvdyh0aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5nZW5lcmF0ZUNlbGxzKCk7XG5cblx0XHRcdHNlbGYuY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkge1xuXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChjZWxsLmdldEVsZW1lbnQoKSk7XG5cblx0XHRcdFx0Y2VsbC5jZWxsUmVuZGVyZWQoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0XHRzZWxmLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NldHVwIG1vdmFibGUgcm93c1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUubGF5b3V0Um93KHRoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NldHVwIGNvbHVtbiBjb2xhcHNlIGNvbnRhaW5lclxuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgPT09IFwiY29sbGFwc2VcIiAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIikpIHtcblxuXHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5sYXlvdXRSb3codGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKSB7XG5cblx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcihzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgcmVzaXphYmxlIGhhbmRsZXNcblxuXHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5yZXNpemFibGVSb3dzICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwicmVzaXplUm93c1wiKSkge1xuXG5cdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5yZXNpemVSb3dzLmluaXRpYWxpemVSb3coc2VsZik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fTtcblxuXHRSb3cucHJvdG90eXBlLnJlaW5pdGlhbGl6ZUhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQub2Zmc2V0UGFyZW50ICE9PSBudWxsKSB7XG5cblx0XHRcdHRoaXMubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdH1cblx0fTtcblxuXHRSb3cucHJvdG90eXBlLnJlaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuXHRcdGlmICghdGhpcy5tYW51YWxIZWlnaHQpIHtcblxuXHRcdFx0dGhpcy5oZWlnaHQgPSAwO1xuXG5cdFx0XHR0aGlzLmhlaWdodFN0eWxlZCA9IFwiXCI7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuZWxlbWVudC5vZmZzZXRQYXJlbnQgIT09IG51bGwpIHtcblxuXHRcdFx0dGhpcy5pbml0aWFsaXplKHRydWUpO1xuXHRcdH1cblx0fTtcblxuXHQvL2dldCBoZWlnaHRzIHdoZW4gZG9pbmcgYnVsayByb3cgc3R5bGUgY2FsY3MgaW4gdmlydHVhbCBET01cblxuXHRSb3cucHJvdG90eXBlLmNhbGNIZWlnaHQgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHZhciBtYXhIZWlnaHQgPSAwLFxuXHRcdCAgICBtaW5IZWlnaHQgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlUm93cyA/IHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQgOiAwO1xuXG5cdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdHZhciBoZWlnaHQgPSBjZWxsLmdldEhlaWdodCgpO1xuXG5cdFx0XHRpZiAoaGVpZ2h0ID4gbWF4SGVpZ2h0KSB7XG5cblx0XHRcdFx0bWF4SGVpZ2h0ID0gaGVpZ2h0O1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKGZvcmNlKSB7XG5cblx0XHRcdHRoaXMuaGVpZ2h0ID0gTWF0aC5tYXgobWF4SGVpZ2h0LCBtaW5IZWlnaHQpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5tYW51YWxIZWlnaHQgPyB0aGlzLmhlaWdodCA6IE1hdGgubWF4KG1heEhlaWdodCwgbWluSGVpZ2h0KTtcblx0XHR9XG5cblx0XHR0aGlzLmhlaWdodFN0eWxlZCA9IHRoaXMuaGVpZ2h0ID8gdGhpcy5oZWlnaHQgKyBcInB4XCIgOiBcIlwiO1xuXG5cdFx0dGhpcy5vdXRlckhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cdH07XG5cblx0Ly9zZXQgb2YgY2VsbHNcblxuXHRSb3cucHJvdG90eXBlLnNldENlbGxIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0Y2VsbC5zZXRIZWlnaHQoKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuY2xlYXJDZWxsSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdGNlbGwuY2xlYXJIZWlnaHQoKTtcblx0XHR9KTtcblx0fTtcblxuXHQvL25vcm1hbGl6ZSB0aGUgaGVpZ2h0IG9mIGVsZW1lbnRzIGluIHRoZSByb3dcblxuXHRSb3cucHJvdG90eXBlLm5vcm1hbGl6ZUhlaWdodCA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXG5cdFx0aWYgKGZvcmNlKSB7XG5cblx0XHRcdHRoaXMuY2xlYXJDZWxsSGVpZ2h0KCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5jYWxjSGVpZ2h0KGZvcmNlKTtcblxuXHRcdHRoaXMuc2V0Q2VsbEhlaWdodCgpO1xuXHR9O1xuXG5cdC8vIFJvdy5wcm90b3R5cGUuc2V0SGVpZ2h0ID0gZnVuY3Rpb24oaGVpZ2h0KXtcblxuXHQvLyBcdHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG5cblx0Ly8gXHR0aGlzLnNldENlbGxIZWlnaHQoKTtcblxuXHQvLyB9O1xuXG5cblx0Ly9zZXQgaGVpZ2h0IG9mIHJvd3NcblxuXHRSb3cucHJvdG90eXBlLnNldEhlaWdodCA9IGZ1bmN0aW9uIChoZWlnaHQsIGZvcmNlKSB7XG5cblx0XHRpZiAodGhpcy5oZWlnaHQgIT0gaGVpZ2h0IHx8IGZvcmNlKSB7XG5cblx0XHRcdHRoaXMubWFudWFsSGVpZ2h0ID0gdHJ1ZTtcblxuXHRcdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cblx0XHRcdHRoaXMuaGVpZ2h0U3R5bGVkID0gaGVpZ2h0ID8gaGVpZ2h0ICsgXCJweFwiIDogXCJcIjtcblxuXHRcdFx0dGhpcy5zZXRDZWxsSGVpZ2h0KCk7XG5cblx0XHRcdC8vIHRoaXMub3V0ZXJIZWlnaHQgPSB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTtcblxuXHRcdFx0dGhpcy5vdXRlckhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmV0dXJuIHJvd3Mgb3V0ZXIgaGVpZ2h0XG5cblx0Um93LnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5vdXRlckhlaWdodDtcblx0fTtcblxuXHQvL3JldHVybiByb3dzIG91dGVyIFdpZHRoXG5cblx0Um93LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBDZWxsIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdFJvdy5wcm90b3R5cGUuZGVsZXRlQ2VsbCA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHR2YXIgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoY2VsbCk7XG5cblx0XHRpZiAoaW5kZXggPiAtMSkge1xuXG5cdFx0XHR0aGlzLmNlbGxzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gRGF0YSBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRSb3cucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwibXV0YXRvclwiKSkge1xuXG5cdFx0XHRkYXRhID0gdGhpcy50YWJsZS5tb2R1bGVzLm11dGF0b3IudHJhbnNmb3JtUm93KGRhdGEsIFwiZGF0YVwiKTtcblx0XHR9XG5cblx0XHR0aGlzLmRhdGEgPSBkYXRhO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlYWN0aXZlRGF0YS53YXRjaFJvdyh0aGlzKTtcblx0XHR9XG5cdH07XG5cblx0Ly91cGRhdGUgdGhlIHJvd3MgZGF0YVxuXG5cdFJvdy5wcm90b3R5cGUudXBkYXRlRGF0YSA9IGZ1bmN0aW9uICh1cGRhdGVkRGF0YSkge1xuXHRcdHZhciBfdGhpczE0ID0gdGhpcztcblxuXHRcdHZhciB2aXNpYmxlID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZSh0aGlzLmVsZW1lbnQpLFxuXHRcdCAgICB0ZW1wRGF0YSA9IHt9LFxuXHRcdCAgICBuZXdSb3dEYXRhO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHR5cGVvZiB1cGRhdGVkRGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdHVwZGF0ZWREYXRhID0gSlNPTi5wYXJzZSh1cGRhdGVkRGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfdGhpczE0LnRhYmxlLm9wdGlvbnMucmVhY3RpdmVEYXRhICYmIF90aGlzMTQudGFibGUubW9kRXhpc3RzKFwicmVhY3RpdmVEYXRhXCIsIHRydWUpKSB7XG5cblx0XHRcdFx0X3RoaXMxNC50YWJsZS5tb2R1bGVzLnJlYWN0aXZlRGF0YS5ibG9jaygpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL211dGF0ZSBpbmNvbW1pbmcgZGF0YSBpZiBuZWVkZWRcblxuXHRcdFx0aWYgKF90aGlzMTQudGFibGUubW9kRXhpc3RzKFwibXV0YXRvclwiKSkge1xuXG5cdFx0XHRcdHRlbXBEYXRhID0gT2JqZWN0LmFzc2lnbih0ZW1wRGF0YSwgX3RoaXMxNC5kYXRhKTtcblxuXHRcdFx0XHR0ZW1wRGF0YSA9IE9iamVjdC5hc3NpZ24odGVtcERhdGEsIHVwZGF0ZWREYXRhKTtcblxuXHRcdFx0XHRuZXdSb3dEYXRhID0gX3RoaXMxNC50YWJsZS5tb2R1bGVzLm11dGF0b3IudHJhbnNmb3JtUm93KHRlbXBEYXRhLCBcImRhdGFcIiwgdXBkYXRlZERhdGEpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRuZXdSb3dEYXRhID0gdXBkYXRlZERhdGE7XG5cdFx0XHR9XG5cblx0XHRcdC8vc2V0IGRhdGFcblxuXHRcdFx0Zm9yICh2YXIgYXR0cm5hbWUgaW4gbmV3Um93RGF0YSkge1xuXG5cdFx0XHRcdF90aGlzMTQuZGF0YVthdHRybmFtZV0gPSBuZXdSb3dEYXRhW2F0dHJuYW1lXTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF90aGlzMTQudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgX3RoaXMxNC50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRfdGhpczE0LnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLnVuYmxvY2soKTtcblx0XHRcdH1cblxuXHRcdFx0Ly91cGRhdGUgYWZmZWN0ZWQgY2VsbHMgb25seVxuXG5cdFx0XHRmb3IgKHZhciBhdHRybmFtZSBpbiB1cGRhdGVkRGF0YSkge1xuXG5cdFx0XHRcdHZhciBjb2x1bW5zID0gX3RoaXMxNC50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbnNCeUZpZWxkUm9vdChhdHRybmFtZSk7XG5cblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdHZhciBjZWxsID0gX3RoaXMxNC5nZXRDZWxsKGNvbHVtbi5nZXRGaWVsZCgpKTtcblxuXHRcdFx0XHRcdGlmIChjZWxsKSB7XG5cblx0XHRcdFx0XHRcdHZhciB2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKG5ld1Jvd0RhdGEpO1xuXG5cdFx0XHRcdFx0XHRpZiAoY2VsbC5nZXRWYWx1ZSgpICE9IHZhbHVlKSB7XG5cblx0XHRcdFx0XHRcdFx0Y2VsbC5zZXRWYWx1ZVByb2Nlc3NEYXRhKHZhbHVlKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAodmlzaWJsZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0Y2VsbC5jZWxsUmVuZGVyZWQoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vUGFydGlhbCByZWluaXRpYWxpemF0aW9uIGlmIHZpc2libGVcblxuXHRcdFx0aWYgKHZpc2libGUpIHtcblxuXHRcdFx0XHRfdGhpczE0Lm5vcm1hbGl6ZUhlaWdodCgpO1xuXG5cdFx0XHRcdGlmIChfdGhpczE0LnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKSB7XG5cblx0XHRcdFx0XHRfdGhpczE0LnRhYmxlLm9wdGlvbnMucm93Rm9ybWF0dGVyKF90aGlzMTQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdF90aGlzMTQuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuXHRcdFx0XHRfdGhpczE0LmhlaWdodCA9IDA7XG5cblx0XHRcdFx0X3RoaXMxNC5oZWlnaHRTdHlsZWQgPSBcIlwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX3RoaXMxNC50YWJsZS5vcHRpb25zLmRhdGFUcmVlICE9PSBmYWxzZSAmJiBfdGhpczE0LnRhYmxlLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIpICYmIF90aGlzMTQudGFibGUubW9kdWxlcy5kYXRhVHJlZS5yZWRyYXdOZWVkZWQodXBkYXRlZERhdGEpKSB7XG5cblx0XHRcdFx0X3RoaXMxNC50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmluaXRpYWxpemVSb3coX3RoaXMxNCk7XG5cblx0XHRcdFx0X3RoaXMxNC50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmxheW91dFJvdyhfdGhpczE0KTtcblxuXHRcdFx0XHRfdGhpczE0LnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJ0cmVlXCIsIGZhbHNlLCB0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0Ly90aGlzLnJlaW5pdGlhbGl6ZSgpO1xuXG5cblx0XHRcdF90aGlzMTQudGFibGUub3B0aW9ucy5yb3dVcGRhdGVkLmNhbGwoX3RoaXMxNC50YWJsZSwgX3RoaXMxNC5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRcdHJlc29sdmUoKTtcblx0XHR9KTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAodHJhbnNmb3JtKSB7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImFjY2Vzc29yXCIpKSB7XG5cblx0XHRcdFx0cmV0dXJuIHNlbGYudGFibGUubW9kdWxlcy5hY2Nlc3Nvci50cmFuc2Zvcm1Sb3coc2VsZi5kYXRhLCB0cmFuc2Zvcm0pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiB0aGlzLmRhdGE7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXG5cdFx0Y29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oY29sdW1uKTtcblxuXHRcdG1hdGNoID0gdGhpcy5jZWxscy5maW5kKGZ1bmN0aW9uIChjZWxsKSB7XG5cblx0XHRcdHJldHVybiBjZWxsLmNvbHVtbiA9PT0gY29sdW1uO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbEluZGV4ID0gZnVuY3Rpb24gKGZpbmRDZWxsKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscy5maW5kSW5kZXgoZnVuY3Rpb24gKGNlbGwpIHtcblxuXHRcdFx0cmV0dXJuIGNlbGwgPT09IGZpbmRDZWxsO1xuXHRcdH0pO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZmluZE5leHRFZGl0YWJsZUNlbGwgPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBuZXh0Q2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKGluZGV4IDwgdGhpcy5jZWxscy5sZW5ndGggLSAxKSB7XG5cblx0XHRcdGZvciAodmFyIGkgPSBpbmRleCArIDE7IGkgPCB0aGlzLmNlbGxzLmxlbmd0aDsgaSsrKSB7XG5cblx0XHRcdFx0dmFyIGNlbGwgPSB0aGlzLmNlbGxzW2ldO1xuXG5cdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQgJiYgVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsVmlzaWJsZShjZWxsLmdldEVsZW1lbnQoKSkpIHtcblxuXHRcdFx0XHRcdHZhciBhbGxvd0VkaXQgPSB0cnVlO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoYWxsb3dFZGl0KSB7XG5cblx0XHRcdFx0XHRcdG5leHRDZWxsID0gY2VsbDtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5leHRDZWxsO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZmluZFByZXZFZGl0YWJsZUNlbGwgPSBmdW5jdGlvbiAoaW5kZXgpIHtcblxuXHRcdHZhciBwcmV2Q2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKGluZGV4ID4gMCkge1xuXG5cdFx0XHRmb3IgKHZhciBpID0gaW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuXG5cdFx0XHRcdHZhciBjZWxsID0gdGhpcy5jZWxsc1tpXSxcblx0XHRcdFx0ICAgIGFsbG93RWRpdCA9IHRydWU7XG5cblx0XHRcdFx0aWYgKGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdCAmJiBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxWaXNpYmxlKGNlbGwuZ2V0RWxlbWVudCgpKSkge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2sgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoYWxsb3dFZGl0KSB7XG5cblx0XHRcdFx0XHRcdHByZXZDZWxsID0gY2VsbDtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHByZXZDZWxsO1xuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5jZWxscztcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLm5leHRSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLm5leHREaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXG5cdFx0cmV0dXJuIHJvdyB8fCBmYWxzZTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLnByZXZSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnByZXZEaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXG5cdFx0cmV0dXJuIHJvdyB8fCBmYWxzZTtcblx0fTtcblxuXHRSb3cucHJvdG90eXBlLm1vdmVUb1JvdyA9IGZ1bmN0aW9uICh0bywgYmVmb3JlKSB7XG5cblx0XHR2YXIgdG9Sb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyh0byk7XG5cblx0XHRpZiAodG9Sb3cpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwodGhpcywgdG9Sb3csICFiZWZvcmUpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJkaXNwbGF5XCIsIGZhbHNlLCB0cnVlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCB0byk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBBY3Rpb25zICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdFJvdy5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczE1ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBpbmRleCwgcm93cztcblxuXHRcdFx0aWYgKF90aGlzMTUudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIF90aGlzMTUudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSkge1xuXG5cdFx0XHRcdGlmIChfdGhpczE1LnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiBfdGhpczE1LnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHRcdFx0cm93cyA9IF90aGlzMTUuZ2V0R3JvdXAoKS5yb3dzO1xuXG5cdFx0XHRcdFx0aW5kZXggPSByb3dzLmluZGV4T2YoX3RoaXMxNSk7XG5cblx0XHRcdFx0XHRpZiAoaW5kZXgpIHtcblxuXHRcdFx0XHRcdFx0aW5kZXggPSByb3dzW2luZGV4IC0gMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0aW5kZXggPSBfdGhpczE1LnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93SW5kZXgoX3RoaXMxNSk7XG5cblx0XHRcdFx0XHRpZiAoaW5kZXgpIHtcblxuXHRcdFx0XHRcdFx0aW5kZXggPSBfdGhpczE1LnRhYmxlLnJvd01hbmFnZXIucm93c1tpbmRleCAtIDFdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdF90aGlzMTUudGFibGUubW9kdWxlcy5oaXN0b3J5LmFjdGlvbihcInJvd0RlbGV0ZVwiLCBfdGhpczE1LCB7IGRhdGE6IF90aGlzMTUuZ2V0RGF0YSgpLCBwb3M6ICFpbmRleCwgaW5kZXg6IGluZGV4IH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfdGhpczE1LmRlbGV0ZUFjdHVhbCgpO1xuXG5cdFx0XHRyZXNvbHZlKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Um93LnByb3RvdHlwZS5kZWxldGVBY3R1YWwgPSBmdW5jdGlvbiAoYmxvY2tSZWRyYXcpIHtcblxuXHRcdHZhciBpbmRleCA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRSb3dJbmRleCh0aGlzKTtcblxuXHRcdC8vZGVzZWxlY3Qgcm93IGlmIGl0IGlzIHNlbGVjdGVkXG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5fZGVzZWxlY3RSb3codGhpcywgdHJ1ZSk7XG5cdFx0fVxuXG5cdFx0Ly8gaWYodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpe1xuXG5cdFx0Ly8gXHR0aGlzLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuY29sbGFwc2VSb3codGhpcywgdHJ1ZSk7XG5cblx0XHQvLyB9XG5cblxuXHRcdC8vcmVtb3ZlIGFueSByZWFjdGl2ZSBkYXRhIHdhdGNoZXJzIGZyb20gcm93IG9iamVjdFxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHt9XG5cblx0XHQvLyB0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLnVud2F0Y2hSb3codGhpcyk7XG5cblx0XHQvL3JlbW92ZSBmcm9tIGdyb3VwXG5cblx0XHRpZiAodGhpcy5tb2R1bGVzLmdyb3VwKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5ncm91cC5yZW1vdmVSb3codGhpcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmRlbGV0ZVJvdyh0aGlzLCBibG9ja1JlZHJhdyk7XG5cblx0XHR0aGlzLmRlbGV0ZUNlbGxzKCk7XG5cblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHR0aGlzLmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGNSb3dHcm91cCh0aGlzKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUuZGVsZXRlQ2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2VsbENvdW50ID0gdGhpcy5jZWxscy5sZW5ndGg7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNlbGxDb3VudDsgaSsrKSB7XG5cblx0XHRcdHRoaXMuY2VsbHNbMF0uZGVsZXRlKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFJvdy5wcm90b3R5cGUud2lwZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZGVsZXRlQ2VsbHMoKTtcblxuXHRcdHdoaWxlICh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0dGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9dGhpcy5lbGVtZW50ID0gZmFsc2U7XG5cblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHRSb3cucHJvdG90eXBlLmdldEdyb3VwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5ncm91cCB8fCBmYWxzZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIE9iamVjdCBHZW5lcmF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cblx0Um93LnByb3RvdHlwZS5nZXRDb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gbmV3IFJvd0NvbXBvbmVudCh0aGlzKTtcblx0fTtcblxuXHQvL3B1YmxpYyByb3cgb2JqZWN0XG5cblx0dmFyIENlbGxDb21wb25lbnQgPSBmdW5jdGlvbiBDZWxsQ29tcG9uZW50KGNlbGwpIHtcblxuXHRcdHRoaXMuX2NlbGwgPSBjZWxsO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwuZ2V0VmFsdWUoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRPbGRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLmdldE9sZFZhbHVlKCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLmdldEVsZW1lbnQoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5yb3cuZ2V0Q29tcG9uZW50KCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLnJvdy5nZXREYXRhKCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuZ2V0RmllbGQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5jb2x1bW4uZ2V0RmllbGQoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRDb2x1bW4gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5jb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIG11dGF0ZSkge1xuXG5cdFx0aWYgKHR5cGVvZiBtdXRhdGUgPT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRtdXRhdGUgPSB0cnVlO1xuXHRcdH1cblxuXHRcdHRoaXMuX2NlbGwuc2V0VmFsdWUodmFsdWUsIG11dGF0ZSk7XG5cdH07XG5cblx0Q2VsbENvbXBvbmVudC5wcm90b3R5cGUucmVzdG9yZU9sZFZhbHVlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5fY2VsbC5zZXRWYWx1ZUFjdHVhbCh0aGlzLl9jZWxsLmdldE9sZFZhbHVlKCkpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmVkaXQgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLmVkaXQoZm9yY2UpO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLl9jZWxsLmNhbmNlbEVkaXQoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5uYXYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5uYXYoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5jaGVja0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX2NlbGwuY2hlY2tIZWlnaHQoKTtcblx0fTtcblxuXHRDZWxsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLl9jZWxsLnRhYmxlO1xuXHR9O1xuXG5cdENlbGxDb21wb25lbnQucHJvdG90eXBlLl9nZXRTZWxmID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMuX2NlbGw7XG5cdH07XG5cblx0dmFyIENlbGwgPSBmdW5jdGlvbiBDZWxsKGNvbHVtbiwgcm93KSB7XG5cblx0XHR0aGlzLnRhYmxlID0gY29sdW1uLnRhYmxlO1xuXG5cdFx0dGhpcy5jb2x1bW4gPSBjb2x1bW47XG5cblx0XHR0aGlzLnJvdyA9IHJvdztcblxuXHRcdHRoaXMuZWxlbWVudCA9IG51bGw7XG5cblx0XHR0aGlzLnZhbHVlID0gbnVsbDtcblxuXHRcdHRoaXMub2xkVmFsdWUgPSBudWxsO1xuXG5cdFx0dGhpcy5tb2R1bGVzID0ge307XG5cblx0XHR0aGlzLmhlaWdodCA9IG51bGw7XG5cblx0XHR0aGlzLndpZHRoID0gbnVsbDtcblxuXHRcdHRoaXMubWluV2lkdGggPSBudWxsO1xuXG5cdFx0dGhpcy5idWlsZCgpO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8gU2V0dXAgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL2dlbmVyYXRlIGVsZW1lbnRcblxuXHRDZWxsLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZ2VuZXJhdGVFbGVtZW50KCk7XG5cblx0XHR0aGlzLnNldFdpZHRoKCk7XG5cblx0XHR0aGlzLl9jb25maWd1cmVDZWxsKCk7XG5cblx0XHR0aGlzLnNldFZhbHVlQWN0dWFsKHRoaXMuY29sdW1uLmdldEZpZWxkVmFsdWUodGhpcy5yb3cuZGF0YSkpO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmdlbmVyYXRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9IFwidGFidWxhdG9yLWNlbGxcIjtcblxuXHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiZ3JpZGNlbGxcIik7XG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuX2NvbmZpZ3VyZUNlbGwgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNlbGxFdmVudHMgPSBzZWxmLmNvbHVtbi5jZWxsRXZlbnRzLFxuXHRcdCAgICBlbGVtZW50ID0gc2VsZi5lbGVtZW50LFxuXHRcdCAgICBmaWVsZCA9IHRoaXMuY29sdW1uLmdldEZpZWxkKCksXG5cdFx0ICAgIHZlcnRBbGlnbnMgPSB7XG5cblx0XHRcdHRvcDogXCJmbGV4LXN0YXJ0XCIsXG5cblx0XHRcdGJvdHRvbTogXCJmbGV4LWVuZFwiLFxuXG5cdFx0XHRtaWRkbGU6IFwiY2VudGVyXCJcblxuXHRcdH0sXG5cdFx0ICAgIGhvekFsaWducyA9IHtcblxuXHRcdFx0bGVmdDogXCJmbGV4LXN0YXJ0XCIsXG5cblx0XHRcdHJpZ2h0OiBcImZsZXgtZW5kXCIsXG5cblx0XHRcdGNlbnRlcjogXCJjZW50ZXJcIlxuXG5cdFx0fTtcblxuXHRcdC8vc2V0IHRleHQgYWxpZ25tZW50XG5cblx0XHRlbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9IHNlbGYuY29sdW1uLmhvekFsaWduO1xuXG5cdFx0aWYgKHNlbGYuY29sdW1uLnZlcnRBbGlnbikge1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1mbGV4XCI7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUuYWxpZ25JdGVtcyA9IHZlcnRBbGlnbnNbc2VsZi5jb2x1bW4udmVydEFsaWduXSB8fCBcIlwiO1xuXG5cdFx0XHRpZiAoc2VsZi5jb2x1bW4uaG96QWxpZ24pIHtcblxuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gaG96QWxpZ25zW3NlbGYuY29sdW1uLmhvekFsaWduXSB8fCBcIlwiO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChmaWVsZCkge1xuXG5cdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcInRhYnVsYXRvci1maWVsZFwiLCBmaWVsZCk7XG5cdFx0fVxuXG5cdFx0Ly9hZGQgY2xhc3MgdG8gY2VsbCBpZiBuZWVkZWRcblxuXHRcdGlmIChzZWxmLmNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzKSB7XG5cblx0XHRcdHZhciBjbGFzc05hbWVzID0gc2VsZi5jb2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcy5zcGxpdChcIiBcIik7XG5cblx0XHRcdGNsYXNzTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG5cblx0XHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvL3VwZGF0ZSB0b29sdGlwIG9uIG1vdXNlIGVudGVyXG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnRvb2x0aXBHZW5lcmF0aW9uTW9kZSA9PT0gXCJob3ZlclwiKSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzZWxmLl9nZW5lcmF0ZVRvb2x0aXAoKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHNlbGYuX2JpbmRDbGlja0V2ZW50cyhjZWxsRXZlbnRzKTtcblxuXHRcdHNlbGYuX2JpbmRUb3VjaEV2ZW50cyhjZWxsRXZlbnRzKTtcblxuXHRcdHNlbGYuX2JpbmRNb3VzZUV2ZW50cyhjZWxsRXZlbnRzKTtcblxuXHRcdGlmIChzZWxmLmNvbHVtbi5tb2R1bGVzLmVkaXQpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuYmluZEVkaXRvcihzZWxmKTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5jb2x1bW4uZGVmaW5pdGlvbi5yb3dIYW5kbGUgJiYgc2VsZi50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzICE9PSBmYWxzZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcIm1vdmVSb3dcIikpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLm1vdmVSb3cuaW5pdGlhbGl6ZUNlbGwoc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9oaWRlIGNlbGwgaWYgbm90IHZpc2libGVcblxuXHRcdGlmICghc2VsZi5jb2x1bW4udmlzaWJsZSkge1xuXG5cdFx0XHRzZWxmLmhpZGUoKTtcblx0XHR9XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuX2JpbmRDbGlja0V2ZW50cyA9IGZ1bmN0aW9uIChjZWxsRXZlbnRzKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQ7XG5cblx0XHQvL3NldCBldmVudCBiaW5kaW5nc1xuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbENsaWNrIHx8IHNlbGYudGFibGUub3B0aW9ucy5jZWxsQ2xpY2spIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsQ2xpY2spIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbENsaWNrLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbENsaWNrKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbENsaWNrLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbERibENsaWNrIHx8IHRoaXMudGFibGUub3B0aW9ucy5jZWxsRGJsQ2xpY2spIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsRGJsQ2xpY2spIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbERibENsaWNrLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbERibENsaWNrKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbERibENsaWNrLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Ly8gZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oZSl7XG5cblx0XHRcdC8vIGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0Ly8gdHJ5e1xuXG5cdFx0XHQvLyBcdGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsgLy8gSUVcblxuXHRcdFx0Ly8gXHRcdHZhciByYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cblx0XHRcdC8vIFx0XHRyYW5nZS5tb3ZlVG9FbGVtZW50VGV4dChzZWxmLmVsZW1lbnQpO1xuXG5cdFx0XHQvLyBcdFx0cmFuZ2Uuc2VsZWN0KCk7XG5cblx0XHRcdC8vIFx0fSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG5cblx0XHRcdC8vIFx0XHR2YXIgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuXG5cdFx0XHQvLyBcdFx0cmFuZ2Uuc2VsZWN0Tm9kZShzZWxmLmVsZW1lbnQpO1xuXG5cdFx0XHQvLyBcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuXG5cdFx0XHQvLyBcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLmFkZFJhbmdlKHJhbmdlKTtcblxuXHRcdFx0Ly8gXHR9XG5cblx0XHRcdC8vIH1jYXRjaChlKXt9XG5cblx0XHRcdC8vIH0pO1xuXG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbENvbnRleHQgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNlbGxDb250ZXh0KSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dmFyIGNvbXBvbmVudCA9IHNlbGYuZ2V0Q29tcG9uZW50KCk7XG5cblx0XHRcdFx0aWYgKGNlbGxFdmVudHMuY2VsbENvbnRleHQpIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbENvbnRleHQuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsQ29udGV4dCkge1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmNlbGxDb250ZXh0LmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLl9iaW5kTW91c2VFdmVudHMgPSBmdW5jdGlvbiAoY2VsbEV2ZW50cykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gc2VsZi5lbGVtZW50O1xuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlRW50ZXIgfHwgc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZUVudGVyKSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VFbnRlcikge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsTW91c2VFbnRlci5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZUVudGVyKSB7XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlRW50ZXIuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VMZWF2ZSB8fCBzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlTGVhdmUpIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZUxlYXZlKSB7XG5cblx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxNb3VzZUxlYXZlLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlTGVhdmUpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VMZWF2ZS5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZU92ZXIgfHwgc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZU92ZXIpIHtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dmFyIGNvbXBvbmVudCA9IHNlbGYuZ2V0Q29tcG9uZW50KCk7XG5cblx0XHRcdFx0aWYgKGNlbGxFdmVudHMuY2VsbE1vdXNlT3Zlcikge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsTW91c2VPdmVyLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbE1vdXNlT3Zlcikge1xuXG5cdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZU92ZXIuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VPdXQgfHwgc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZU91dCkge1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZU91dCkge1xuXG5cdFx0XHRcdFx0Y2VsbEV2ZW50cy5jZWxsTW91c2VPdXQuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VPdXQpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VPdXQuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsTW91c2VNb3ZlIHx8IHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VNb3ZlKSB7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxNb3VzZU1vdmUpIHtcblxuXHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbE1vdXNlTW92ZS5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNlbGxNb3VzZU1vdmUpIHtcblxuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsTW91c2VNb3ZlLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLl9iaW5kVG91Y2hFdmVudHMgPSBmdW5jdGlvbiAoY2VsbEV2ZW50cykge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gc2VsZi5lbGVtZW50LFxuXHRcdCAgICBkYmxUYXAsXG5cdFx0ICAgIHRhcEhvbGQsXG5cdFx0ICAgIHRhcDtcblxuXHRcdGlmIChjZWxsRXZlbnRzLmNlbGxUYXAgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNlbGxUYXApIHtcblxuXHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHR0YXAgPSB0cnVlO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGlmICh0YXApIHtcblxuXHRcdFx0XHRcdHZhciBjb21wb25lbnQgPSBzZWxmLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdFx0aWYgKGNlbGxFdmVudHMuY2VsbFRhcCkge1xuXG5cdFx0XHRcdFx0XHRjZWxsRXZlbnRzLmNlbGxUYXAuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbFRhcCkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbFRhcC5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFwID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsRGJsVGFwIHx8IHRoaXMudGFibGUub3B0aW9ucy5jZWxsRGJsVGFwKSB7XG5cblx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0aWYgKGRibFRhcCkge1xuXG5cdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRibFRhcCk7XG5cblx0XHRcdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRcdFx0dmFyIGNvbXBvbmVudCA9IHNlbGYuZ2V0Q29tcG9uZW50KCk7XG5cblx0XHRcdFx0XHRpZiAoY2VsbEV2ZW50cy5jZWxsRGJsVGFwKSB7XG5cblx0XHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbERibFRhcC5jYWxsKHNlbGYudGFibGUsIGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5jZWxsRGJsVGFwKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5jZWxsRGJsVGFwLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRkYmxUYXAgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRibFRhcCk7XG5cblx0XHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cdFx0XHRcdFx0fSwgMzAwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKGNlbGxFdmVudHMuY2VsbFRhcEhvbGQgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNlbGxUYXBIb2xkKSB7XG5cblx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdHRhcEhvbGQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXG5cdFx0XHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdFx0XHR2YXIgY29tcG9uZW50ID0gc2VsZi5nZXRDb21wb25lbnQoKTtcblxuXHRcdFx0XHRcdGlmIChjZWxsRXZlbnRzLmNlbGxUYXBIb2xkKSB7XG5cblx0XHRcdFx0XHRcdGNlbGxFdmVudHMuY2VsbFRhcEhvbGQuY2FsbChzZWxmLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbFRhcEhvbGQpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmNlbGxUYXBIb2xkLmNhbGwoc2VsZi50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblxuXHRcdFx0XHR0YXBIb2xkID0gbnVsbDtcblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHQvL2dlbmVyYXRlIGNlbGwgY29udGVudHNcblxuXHRDZWxsLnByb3RvdHlwZS5fZ2VuZXJhdGVDb250ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB2YWw7XG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikpIHtcblxuXHRcdFx0dmFsID0gdGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdC5mb3JtYXRWYWx1ZSh0aGlzKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR2YWwgPSB0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy52YWx1ZTtcblx0XHR9XG5cblx0XHRzd2l0Y2ggKHR5cGVvZiB2YWwgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbCkpIHtcblxuXHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXG5cdFx0XHRcdGlmICh2YWwgaW5zdGFuY2VvZiBOb2RlKSB7XG5cblx0XHRcdFx0XHQvL2NsZWFyIHByZXZpb3VzIGNlbGwgY29udGVudHNcblxuXHRcdFx0XHRcdHdoaWxlICh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0dGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHR9dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHZhbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcblxuXHRcdFx0XHRcdGlmICh2YWwgIT0gbnVsbCkge1xuXG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGb3JtYXQgRXJyb3IgLSBGb3JtYXR0ZXIgaGFzIHJldHVybmVkIGEgdHlwZSBvZiBvYmplY3QsIHRoZSBvbmx5IHZhbGlkIGZvcm1hdHRlciBvYmplY3QgcmV0dXJuIGlzIGFuIGluc3RhbmNlIG9mIE5vZGUsIHRoZSBmb3JtYXR0ZXIgcmV0dXJuZWQ6XCIsIHZhbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblxuXHRcdFx0Y2FzZSBcIm51bGxcIjpcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcblxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblxuXHRcdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gdmFsO1xuXG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmNlbGxSZW5kZXJlZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSAmJiB0aGlzLnRhYmxlLm1vZHVsZXMuZm9ybWF0LmNlbGxSZW5kZXJlZCkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZm9ybWF0LmNlbGxSZW5kZXJlZCh0aGlzKTtcblx0XHR9XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSB0b29sdGlwIHRleHRcblxuXHRDZWxsLnByb3RvdHlwZS5fZ2VuZXJhdGVUb29sdGlwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHRvb2x0aXAgPSB0aGlzLmNvbHVtbi50b29sdGlwO1xuXG5cdFx0aWYgKHRvb2x0aXApIHtcblxuXHRcdFx0aWYgKHRvb2x0aXAgPT09IHRydWUpIHtcblxuXHRcdFx0XHR0b29sdGlwID0gdGhpcy52YWx1ZTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIHRvb2x0aXAgPT0gXCJmdW5jdGlvblwiKSB7XG5cblx0XHRcdFx0dG9vbHRpcCA9IHRvb2x0aXAodGhpcy5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRcdFx0aWYgKHRvb2x0aXAgPT09IGZhbHNlKSB7XG5cblx0XHRcdFx0XHR0b29sdGlwID0gXCJcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIHRvb2x0aXAgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHR0b29sdGlwID0gXCJcIjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHRvb2x0aXApO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8gR2V0dGVycyAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdENlbGwucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMudmFsdWU7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuZ2V0T2xkVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5vbGRWYWx1ZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLyBBY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRDZWxsLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgbXV0YXRlKSB7XG5cblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuc2V0VmFsdWVQcm9jZXNzRGF0YSh2YWx1ZSwgbXV0YXRlKSxcblx0XHQgICAgY29tcG9uZW50O1xuXG5cdFx0aWYgKGNoYW5nZWQpIHtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5oaXN0b3J5LmFjdGlvbihcImNlbGxFZGl0XCIsIHRoaXMsIHsgb2xkVmFsdWU6IHRoaXMub2xkVmFsdWUsIG5ld1ZhbHVlOiB0aGlzLnZhbHVlIH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRjb21wb25lbnQgPSB0aGlzLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRpZiAodGhpcy5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsRWRpdGVkKSB7XG5cblx0XHRcdFx0dGhpcy5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsRWRpdGVkLmNhbGwodGhpcy50YWJsZSwgY29tcG9uZW50KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmNlbGxFZGl0ZWQuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUVkaXRlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMudGFibGUucm93TWFuYWdlci5nZXREYXRhKCkpO1xuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zZXRWYWx1ZVByb2Nlc3NEYXRhID0gZnVuY3Rpb24gKHZhbHVlLCBtdXRhdGUpIHtcblxuXHRcdHZhciBjaGFuZ2VkID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy52YWx1ZSAhPSB2YWx1ZSkge1xuXG5cdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblxuXHRcdFx0aWYgKG11dGF0ZSkge1xuXG5cdFx0XHRcdGlmICh0aGlzLmNvbHVtbi5tb2R1bGVzLm11dGF0ZSkge1xuXG5cdFx0XHRcdFx0dmFsdWUgPSB0aGlzLnRhYmxlLm1vZHVsZXMubXV0YXRvci50cmFuc2Zvcm1DZWxsKHRoaXMsIHZhbHVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuc2V0VmFsdWVBY3R1YWwodmFsdWUpO1xuXG5cdFx0aWYgKGNoYW5nZWQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRpZiAodGhpcy5jb2x1bW4uZGVmaW5pdGlvbi50b3BDYWxjIHx8IHRoaXMuY29sdW1uLmRlZmluaXRpb24uYm90dG9tQ2FsYykge1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXG5cdFx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyA9PSBcInRhYmxlXCIgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzID09IFwiYm90aFwiKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGNSb3dHcm91cCh0aGlzLnJvdyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gY2hhbmdlZDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zZXRWYWx1ZUFjdHVhbCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG5cdFx0dGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG5cblx0XHR0aGlzLnZhbHVlID0gdmFsdWU7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlYWN0aXZlRGF0YSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlYWN0aXZlRGF0YVwiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLmJsb2NrKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5jb2x1bW4uc2V0RmllbGRWYWx1ZSh0aGlzLnJvdy5kYXRhLCB2YWx1ZSk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlYWN0aXZlRGF0YSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlYWN0aXZlRGF0YVwiKSkge1xuXG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVhY3RpdmVEYXRhLnVuYmxvY2soKTtcblx0XHR9XG5cblx0XHR0aGlzLl9nZW5lcmF0ZUNvbnRlbnRzKCk7XG5cblx0XHR0aGlzLl9nZW5lcmF0ZVRvb2x0aXAoKTtcblxuXHRcdC8vc2V0IHJlc2l6YWJsZSBoYW5kbGVzXG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc2l6YWJsZUNvbHVtbnMgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNpemVDb2x1bW5zXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNpemVDb2x1bW5zLmluaXRpYWxpemVDb2x1bW4oXCJjZWxsXCIsIHRoaXMuY29sdW1uLCB0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdC8vc2V0IGNvbHVtbiBtZW51XG5cblx0XHRpZiAodGhpcy5jb2x1bW4uZGVmaW5pdGlvbi5jb250ZXh0TWVudSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcIm1lbnVcIikpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLm1lbnUuaW5pdGlhbGl6ZUNlbGwodGhpcyk7XG5cdFx0fVxuXG5cdFx0Ly9oYW5kbGUgZnJvemVuIGNlbGxzXG5cblx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxheW91dEVsZW1lbnQodGhpcy5lbGVtZW50LCB0aGlzLmNvbHVtbik7XG5cdFx0fVxuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLnNldFdpZHRoID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy53aWR0aCA9IHRoaXMuY29sdW1uLndpZHRoO1xuXG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gdGhpcy5jb2x1bW4ud2lkdGhTdHlsZWQ7XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuY2xlYXJXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMud2lkdGggPSBcIlwiO1xuXG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gXCJcIjtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLndpZHRoIHx8IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zZXRNaW5XaWR0aCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMubWluV2lkdGggPSB0aGlzLmNvbHVtbi5taW5XaWR0aDtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMuY29sdW1uLm1pbldpZHRoU3R5bGVkO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmNoZWNrSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0Ly8gdmFyIGhlaWdodCA9IHRoaXMuZWxlbWVudC5jc3MoXCJoZWlnaHRcIik7XG5cblx0XHR0aGlzLnJvdy5yZWluaXRpYWxpemVIZWlnaHQoKTtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5jbGVhckhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuXG5cdFx0dGhpcy5oZWlnaHQgPSBudWxsO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLnNldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5yb3cuaGVpZ2h0O1xuXG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IHRoaXMucm93LmhlaWdodFN0eWxlZDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5oZWlnaHQgfHwgdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHR9O1xuXG5cdENlbGwucHJvdG90eXBlLmVkaXQgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmVkaXRDZWxsKHRoaXMsIGZvcmNlKTtcblx0XHR9XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuY2FuY2VsRWRpdCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dmFyIGVkaXRpbmcgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5nZXRDdXJyZW50Q2VsbCgpO1xuXG5cdFx0XHRpZiAoZWRpdGluZyAmJiBlZGl0aW5nLl9nZXRTZWxmKCkgPT09IHRoaXMpIHtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jYW5jZWxFZGl0KCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNhbmNlbCBFZGl0b3IgRXJyb3IgLSBUaGlzIGNlbGwgaXMgbm90IGN1cnJlbnRseSBiZWluZyBlZGl0ZWQgXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDZWxsLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAoIXRoaXMudGFibGUucm93TWFuYWdlci5yZWRyYXdCbG9jaykge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5jb2x1bW4uZGVsZXRlQ2VsbCh0aGlzKTtcblxuXHRcdHRoaXMucm93LmRlbGV0ZUNlbGwodGhpcyk7XG5cblx0XHR0aGlzLmNhbGNzID0ge307XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBOYXZpZ2F0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRDZWxsLnByb3RvdHlwZS5uYXYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG5leHRDZWxsID0gZmFsc2UsXG5cdFx0ICAgIGluZGV4ID0gdGhpcy5yb3cuZ2V0Q2VsbEluZGV4KHRoaXMpO1xuXG5cdFx0cmV0dXJuIHtcblxuXHRcdFx0bmV4dDogZnVuY3Rpb24gbmV4dCgpIHtcblxuXHRcdFx0XHR2YXIgbmV4dENlbGwgPSB0aGlzLnJpZ2h0KCksXG5cdFx0XHRcdCAgICBuZXh0Um93O1xuXG5cdFx0XHRcdGlmICghbmV4dENlbGwpIHtcblxuXHRcdFx0XHRcdG5leHRSb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIubmV4dERpc3BsYXlSb3coc2VsZi5yb3csIHRydWUpO1xuXG5cdFx0XHRcdFx0aWYgKG5leHRSb3cpIHtcblxuXHRcdFx0XHRcdFx0bmV4dENlbGwgPSBuZXh0Um93LmZpbmROZXh0RWRpdGFibGVDZWxsKC0xKTtcblxuXHRcdFx0XHRcdFx0aWYgKG5leHRDZWxsKSB7XG5cblx0XHRcdFx0XHRcdFx0bmV4dENlbGwuZWRpdCgpO1xuXG5cdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSxcblxuXHRcdFx0cHJldjogZnVuY3Rpb24gcHJldigpIHtcblxuXHRcdFx0XHR2YXIgbmV4dENlbGwgPSB0aGlzLmxlZnQoKSxcblx0XHRcdFx0ICAgIHByZXZSb3c7XG5cblx0XHRcdFx0aWYgKCFuZXh0Q2VsbCkge1xuXG5cdFx0XHRcdFx0cHJldlJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhzZWxmLnJvdywgdHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAocHJldlJvdykge1xuXG5cdFx0XHRcdFx0XHRuZXh0Q2VsbCA9IHByZXZSb3cuZmluZFByZXZFZGl0YWJsZUNlbGwocHJldlJvdy5jZWxscy5sZW5ndGgpO1xuXG5cdFx0XHRcdFx0XHRpZiAobmV4dENlbGwpIHtcblxuXHRcdFx0XHRcdFx0XHRuZXh0Q2VsbC5lZGl0KCk7XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRsZWZ0OiBmdW5jdGlvbiBsZWZ0KCkge1xuXG5cdFx0XHRcdG5leHRDZWxsID0gc2VsZi5yb3cuZmluZFByZXZFZGl0YWJsZUNlbGwoaW5kZXgpO1xuXG5cdFx0XHRcdGlmIChuZXh0Q2VsbCkge1xuXG5cdFx0XHRcdFx0bmV4dENlbGwuZWRpdCgpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdHJpZ2h0OiBmdW5jdGlvbiByaWdodCgpIHtcblxuXHRcdFx0XHRuZXh0Q2VsbCA9IHNlbGYucm93LmZpbmROZXh0RWRpdGFibGVDZWxsKGluZGV4KTtcblxuXHRcdFx0XHRpZiAobmV4dENlbGwpIHtcblxuXHRcdFx0XHRcdG5leHRDZWxsLmVkaXQoKTtcblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHR1cDogZnVuY3Rpb24gdXAoKSB7XG5cblx0XHRcdFx0dmFyIG5leHRSb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIucHJldkRpc3BsYXlSb3coc2VsZi5yb3csIHRydWUpO1xuXG5cdFx0XHRcdGlmIChuZXh0Um93KSB7XG5cblx0XHRcdFx0XHRuZXh0Um93LmNlbGxzW2luZGV4XS5lZGl0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdGRvd246IGZ1bmN0aW9uIGRvd24oKSB7XG5cblx0XHRcdFx0dmFyIG5leHRSb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIubmV4dERpc3BsYXlSb3coc2VsZi5yb3csIHRydWUpO1xuXG5cdFx0XHRcdGlmIChuZXh0Um93KSB7XG5cblx0XHRcdFx0XHRuZXh0Um93LmNlbGxzW2luZGV4XS5lZGl0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdH07XG5cdH07XG5cblx0Q2VsbC5wcm90b3R5cGUuZ2V0SW5kZXggPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLnJvdy5nZXRDZWxsSW5kZXgodGhpcyk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLyBPYmplY3QgR2VuZXJhdGlvbiAvLy8vLy8vLy8vLy8vLy8vL1xuXG5cdENlbGwucHJvdG90eXBlLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiBuZXcgQ2VsbENvbXBvbmVudCh0aGlzKTtcblx0fTtcblxuXHR2YXIgRm9vdGVyTWFuYWdlciA9IGZ1bmN0aW9uIEZvb3Rlck1hbmFnZXIodGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblxuXHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTsgLy9jb250YWluaW5nIGVsZW1lbnRcblxuXHRcdHRoaXMuZXh0ZXJuYWwgPSBmYWxzZTtcblxuXHRcdHRoaXMubGlua3MgPSBbXTtcblxuXHRcdHRoaXMuX2luaXRpYWxpemUoKTtcblx0fTtcblxuXHRGb290ZXJNYW5hZ2VyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZm9vdGVyXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudCkge1xuXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpKSB7XG5cblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5mb290ZXJFbGVtZW50WzBdID09PSBcIjxcIikge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5leHRlcm5hbCA9IHRydWU7XG5cblx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cblx0XHRcdFx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudDtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChlbGVtZW50LCBwYXJlbnQpIHtcblxuXHRcdHRoaXMuYWN0aXZhdGUocGFyZW50KTtcblxuXHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChlbGVtZW50KTtcblxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0fTtcblxuXHRGb290ZXJNYW5hZ2VyLnByb3RvdHlwZS5wcmVwZW5kID0gZnVuY3Rpb24gKGVsZW1lbnQsIHBhcmVudCkge1xuXG5cdFx0dGhpcy5hY3RpdmF0ZShwYXJlbnQpO1xuXG5cdFx0dGhpcy5lbGVtZW50Lmluc2VydEJlZm9yZShlbGVtZW50LCB0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH07XG5cblx0Rm9vdGVyTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcblxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcblxuXHRcdHRoaXMuZGVhY3RpdmF0ZSgpO1xuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdGlmICghdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQgfHwgZm9yY2UpIHtcblxuXHRcdFx0aWYgKCF0aGlzLmV4dGVybmFsKSB7XG5cblx0XHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH07XG5cblx0Rm9vdGVyTWFuYWdlci5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAocGFyZW50KSB7XG5cblx0XHRpZiAoIXRoaXMuYWN0aXZlKSB7XG5cblx0XHRcdHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXHRcdFx0aWYgKCF0aGlzLmV4dGVybmFsKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZ2V0RWxlbWVudCgpKTtcblxuXHRcdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChwYXJlbnQpIHtcblxuXHRcdFx0dGhpcy5saW5rcy5wdXNoKHBhcmVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdEZvb3Rlck1hbmFnZXIucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMubGlua3MuZm9yRWFjaChmdW5jdGlvbiAobGluaykge1xuXG5cdFx0XHRsaW5rLmZvb3RlclJlZHJhdygpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdHZhciBUYWJ1bGF0b3IgPSBmdW5jdGlvbiBUYWJ1bGF0b3IoZWxlbWVudCwgb3B0aW9ucykge1xuXG5cdFx0dGhpcy5vcHRpb25zID0ge307XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIgPSBudWxsOyAvLyBob2xkIENvbHVtbiBNYW5hZ2VyXG5cblx0XHR0aGlzLnJvd01hbmFnZXIgPSBudWxsOyAvL2hvbGQgUm93IE1hbmFnZXJcblxuXHRcdHRoaXMuZm9vdGVyTWFuYWdlciA9IG51bGw7IC8vaG9sZGVyIEZvb3RlciBNYW5hZ2VyXG5cblx0XHR0aGlzLmJyb3dzZXIgPSBcIlwiOyAvL2hvbGQgY3VycmVudCBicm93c2VyIHR5cGVcblxuXHRcdHRoaXMuYnJvd3NlclNsb3cgPSBmYWxzZTsgLy9oYW5kbGUgcmVkdWNlZCBmdW5jdGlvbmFsaXR5IGZvciBzbG93ZXIgYnJvd3NlcnNcblxuXHRcdHRoaXMuYnJvd3Nlck1vYmlsZSA9IGZhbHNlOyAvL2NoZWNrIGlmIHJ1bm5pbmcgb24gbW9ibGUsIHByZXZlbnQgcmVzaXplIGNhbmNlbGxpbmcgZWRpdCBvbiBrZXlib2FyZCBhcHBlYXJlbmNlXG5cblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9OyAvL2hvbGQgYWxsIG1vZHVsZXMgYm91bmQgdG8gdGhpcyB0YWJsZVxuXG5cblx0XHR0aGlzLmluaXRpYWxpemVFbGVtZW50KGVsZW1lbnQpO1xuXG5cdFx0dGhpcy5pbml0aWFsaXplT3B0aW9ucyhvcHRpb25zIHx8IHt9KTtcblxuXHRcdHRoaXMuX2NyZWF0ZSgpO1xuXG5cdFx0VGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5yZWdpc3Rlcih0aGlzKTsgLy9yZWdpc3RlciB0YWJsZSBmb3IgaW5kZXJkZXZpY2UgY29tbXVuaWNhdGlvblxuXHR9O1xuXG5cdC8vZGVmYXVsdCBzZXR1cCBvcHRpb25zXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdGhlaWdodDogZmFsc2UsIC8vaGVpZ2h0IG9mIHRhYnVsYXRvclxuXG5cdFx0bWluSGVpZ2h0OiBmYWxzZSwgLy9taW5pbXVtIGhlaWdodCBvZiB0YWJ1bGF0b3JcblxuXHRcdG1heEhlaWdodDogZmFsc2UsIC8vbWF4aW11bSBoZWlnaHQgb2YgdGFidWxhdG9yXG5cblxuXHRcdGxheW91dDogXCJmaXREYXRhXCIsIC8vL2xheW91dCB0eXBlIFwiZml0Q29sdW1uc1wiIHwgXCJmaXREYXRhXCJcblxuXHRcdGxheW91dENvbHVtbnNPbk5ld0RhdGE6IGZhbHNlLCAvL3VwZGF0ZSBjb2x1bW4gd2lkdGhzIG9uIHNldERhdGFcblxuXG5cdFx0Y29sdW1uTWluV2lkdGg6IDQwLCAvL21pbmltdW0gZ2xvYmFsIHdpZHRoIGZvciBhIGNvbHVtblxuXG5cdFx0Y29sdW1uSGVhZGVyVmVydEFsaWduOiBcInRvcFwiLCAvL3ZlcnRpY2FsIGFsaWdubWVudCBvZiBjb2x1bW4gaGVhZGVyc1xuXG5cdFx0Y29sdW1uVmVydEFsaWduOiBmYWxzZSwgLy8gREVQUkVDQVRFRCAtIExlZnQgdG8gYWxsb3cgd2FybmluZ1xuXG5cblx0XHRyZXNpemFibGVDb2x1bW5zOiB0cnVlLCAvL3Jlc2l6YWJsZSBjb2x1bW5zXG5cblx0XHRyZXNpemFibGVSb3dzOiBmYWxzZSwgLy9yZXNpemFibGUgcm93c1xuXG5cdFx0YXV0b1Jlc2l6ZTogdHJ1ZSwgLy9hdXRvIHJlc2l6ZSB0YWJsZVxuXG5cblx0XHRjb2x1bW5zOiBbXSwgLy9zdG9yZSBmb3IgY29sdW0gaGVhZGVyIGluZm9cblxuXG5cdFx0Y2VsbEhvekFsaWduOiBcIlwiLCAvL2hvcml6b250YWwgYWxpZ24gY29sdW1uc1xuXG5cdFx0Y2VsbFZlcnRBbGlnbjogXCJcIiwgLy9jZXJ0aWNhbCBhbGlnbiBjb2x1bW5zXG5cblxuXHRcdGRhdGE6IFtdLCAvL2RlZmF1bHQgc3RhcnRpbmcgZGF0YVxuXG5cblx0XHRhdXRvQ29sdW1uczogZmFsc2UsIC8vYnVpbGQgY29sdW1ucyBmcm9tIGRhdGEgcm93IHN0cnVjdHVyZVxuXG5cblx0XHRyZWFjdGl2ZURhdGE6IGZhbHNlLCAvL2VuYWJsZSBkYXRhIHJlYWN0aXZpdHlcblxuXG5cdFx0bmVzdGVkRmllbGRTZXBhcmF0b3I6IFwiLlwiLCAvL3NlcGVyYXRwciBmb3IgbmVzdGVkIGRhdGFcblxuXG5cdFx0dG9vbHRpcHM6IGZhbHNlLCAvL1Rvb2wgdGlwIHZhbHVlXG5cblx0XHR0b29sdGlwc0hlYWRlcjogZmFsc2UsIC8vVG9vbCB0aXAgZm9yIGhlYWRlcnNcblxuXHRcdHRvb2x0aXBHZW5lcmF0aW9uTW9kZTogXCJsb2FkXCIsIC8vd2hlbiB0byBnZW5lcmF0ZSB0b29sdGlwc1xuXG5cblx0XHRpbml0aWFsU29ydDogZmFsc2UsIC8vaW5pdGlhbCBzb3J0aW5nIGNyaXRlcmlhXG5cblx0XHRpbml0aWFsRmlsdGVyOiBmYWxzZSwgLy9pbml0aWFsIGZpbHRlcmluZyBjcml0ZXJpYVxuXG5cdFx0aW5pdGlhbEhlYWRlckZpbHRlcjogZmFsc2UsIC8vaW5pdGlhbCBoZWFkZXIgZmlsdGVyaW5nIGNyaXRlcmlhXG5cblxuXHRcdGNvbHVtbkhlYWRlclNvcnRNdWx0aTogdHJ1ZSwgLy9tdWx0aXBsZSBvciBzaW5nbGUgY29sdW1uIHNvcnRpbmdcblxuXG5cdFx0c29ydE9yZGVyUmV2ZXJzZTogZmFsc2UsIC8vcmV2ZXJzZSBpbnRlcm5hbCBzb3J0IG9yZGVyaW5nXG5cblxuXHRcdGhlYWRlclNvcnQ6IHRydWUsIC8vc2V0IGRlZmF1bHQgZ2xvYmFsIGhlYWRlciBzb3J0XG5cblx0XHRoZWFkZXJTb3J0VHJpc3RhdGU6IGZhbHNlLCAvL3NldCBkZWZhdWx0IHRyaXN0YXRlIGhlYWRlciBzb3J0aW5nXG5cblxuXHRcdGZvb3RlckVsZW1lbnQ6IGZhbHNlLCAvL2hvbGQgZm9vdGVyIGVsZW1lbnRcblxuXG5cdFx0aW5kZXg6IFwiaWRcIiwgLy9maWxlZCBmb3Igcm93IGluZGV4XG5cblxuXHRcdGtleWJpbmRpbmdzOiBbXSwgLy9hcnJheSBmb3Iga2V5YmluZGluZ3NcblxuXG5cdFx0dGFiRW5kTmV3Um93OiBmYWxzZSwgLy9jcmVhdGUgbmV3IHJvdyB3aGVuIHRhYiB0byBlbmQgb2YgdGFibGVcblxuXG5cdFx0aW52YWxpZE9wdGlvbldhcm5pbmdzOiB0cnVlLCAvL2FsbG93IHRvZ2dsaW5nIG9mIGludmFsaWQgb3B0aW9uIHdhcm5pbmdzXG5cblxuXHRcdGNsaXBib2FyZDogZmFsc2UsIC8vZW5hYmxlIGNsaXBib2FyZFxuXG5cdFx0Y2xpcGJvYXJkQ29weVN0eWxlZDogdHJ1ZSwgLy9mb3JtYXR0ZWQgdGFibGUgZGF0YVxuXG5cdFx0Y2xpcGJvYXJkQ29weUNvbmZpZzogZmFsc2UsIC8vY2xpcGJvYXJkIGNvbmZpZ1xuXG5cdFx0Y2xpcGJvYXJkQ29weUZvcm1hdHRlcjogZmFsc2UsIC8vREVQUklDQVRFRCAtIFJFTU9WRSBpbiA1LjBcblxuXHRcdGNsaXBib2FyZENvcHlSb3dSYW5nZTogXCJhY3RpdmVcIiwgLy9yZXN0cmljdCBjbGlwYm9hcmQgdG8gdmlzaWJsZSByb3dzIG9ubHlcblxuXHRcdGNsaXBib2FyZFBhc3RlUGFyc2VyOiBcInRhYmxlXCIsIC8vY29udmVydCBwYXN0ZWQgY2xpcGJvYXJkIGRhdGEgdG8gcm93c1xuXG5cdFx0Y2xpcGJvYXJkUGFzdGVBY3Rpb246IFwiaW5zZXJ0XCIsIC8vaG93IHRvIGluc2VydCBwYXN0ZWQgZGF0YSBpbnRvIHRoZSB0YWJsZVxuXG5cblx0XHRjbGlwYm9hcmRDb3BpZWQ6IGZ1bmN0aW9uIGNsaXBib2FyZENvcGllZCgpIHt9LCAvL2RhdGEgaGFzIGJlZW4gY29waWVkIHRvIHRoZSBjbGlwYm9hcmRcblxuXHRcdGNsaXBib2FyZFBhc3RlZDogZnVuY3Rpb24gY2xpcGJvYXJkUGFzdGVkKCkge30sIC8vZGF0YSBoYXMgYmVlbiBwYXN0ZWQgaW50byB0aGUgdGFibGVcblxuXHRcdGNsaXBib2FyZFBhc3RlRXJyb3I6IGZ1bmN0aW9uIGNsaXBib2FyZFBhc3RlRXJyb3IoKSB7fSwgLy9kYXRhIGhhcyBub3Qgc3VjY2Vzc2Z1bGx5IGJlZW4gcGFzdGVkIGludG8gdGhlIHRhYmxlXG5cblxuXHRcdGRvd25sb2FkRGF0YUZvcm1hdHRlcjogZmFsc2UsIC8vZnVuY3Rpb24gdG8gbWFuaXB1bGF0ZSB0YWJsZSBkYXRhIGJlZm9yZSBpdCBpcyBkb3dubG9hZGVkXG5cblx0XHRkb3dubG9hZFJlYWR5OiBmdW5jdGlvbiBkb3dubG9hZFJlYWR5KGRhdGEsIGJsb2IpIHtcblx0XHRcdHJldHVybiBibG9iO1xuXHRcdH0sIC8vZnVuY3Rpb24gdG8gbWFuaXB1bGF0ZSBkb3dubG9hZCBkYXRhXG5cblx0XHRkb3dubG9hZENvbXBsZXRlOiBmYWxzZSwgLy9mdW5jdGlvbiB0byBtYW5pcHVsYXRlIGRvd25sb2FkIGRhdGFcblxuXHRcdGRvd25sb2FkQ29uZmlnOiBmYWxzZSwgLy9kb3dubG9hZCBjb25maWdcblxuXG5cdFx0ZGF0YVRyZWU6IGZhbHNlLCAvL2VuYWJsZSBkYXRhIHRyZWVcblxuXHRcdGRhdGFUcmVlRWxlbWVudENvbHVtbjogZmFsc2UsXG5cblx0XHRkYXRhVHJlZUJyYW5jaEVsZW1lbnQ6IHRydWUsIC8vc2hvdyBkYXRhIHRyZWUgYnJhbmNoIGVsZW1lbnRcblxuXHRcdGRhdGFUcmVlQ2hpbGRJbmRlbnQ6IDksIC8vZGF0YSB0cmVlIGNoaWxkIGluZGVudCBpbiBweFxuXG5cdFx0ZGF0YVRyZWVDaGlsZEZpZWxkOiBcIl9jaGlsZHJlblwiLCAvL2RhdGEgdHJlIGNvbHVtbiBmaWVsZCB0byBsb29rIGZvciBjaGlsZCByb3dzXG5cblx0XHRkYXRhVHJlZUNvbGxhcHNlRWxlbWVudDogZmFsc2UsIC8vZGF0YSB0cmVlIHJvdyBjb2xsYXBzZSBlbGVtZW50XG5cblx0XHRkYXRhVHJlZUV4cGFuZEVsZW1lbnQ6IGZhbHNlLCAvL2RhdGEgdHJlZSByb3cgZXhwYW5kIGVsZW1lbnRcblxuXHRcdGRhdGFUcmVlU3RhcnRFeHBhbmRlZDogZmFsc2UsXG5cblx0XHRkYXRhVHJlZVJvd0V4cGFuZGVkOiBmdW5jdGlvbiBkYXRhVHJlZVJvd0V4cGFuZGVkKCkge30sIC8vcm93IGhhcyBiZWVuIGV4cGFuZGVkXG5cblx0XHRkYXRhVHJlZVJvd0NvbGxhcHNlZDogZnVuY3Rpb24gZGF0YVRyZWVSb3dDb2xsYXBzZWQoKSB7fSwgLy9yb3cgaGFzIGJlZW4gY29sbGFwc2VkXG5cblx0XHRkYXRhVHJlZUNoaWxkQ29sdW1uQ2FsY3M6IGZhbHNlLCAvL2luY2x1ZGUgdmlzaWJsZSBkYXRhIHRyZWUgcm93cyBpbiBjb2x1bW4gY2FsY3VsYXRpb25zXG5cblx0XHRkYXRhVHJlZVNlbGVjdFByb3BhZ2F0ZTogZmFsc2UsIC8vc2VsZWNjdGluZyBhIHBhcmVudCByb3cgc2VsZWN0cyBpdHMgY2hpbGRyZW5cblxuXG5cdFx0cHJpbnRBc0h0bWw6IGZhbHNlLCAvL2VuYWJsZSBwcmludCBhcyBodG1sXG5cblx0XHRwcmludEZvcm1hdHRlcjogZmFsc2UsIC8vcHJpbnRpbmcgcGFnZSBmb3JtYXR0ZXJcblxuXHRcdHByaW50SGVhZGVyOiBmYWxzZSwgLy9wYWdlIGhlYWRlciBjb250ZW50c1xuXG5cdFx0cHJpbnRGb290ZXI6IGZhbHNlLCAvL3BhZ2UgZm9vdGVyIGNvbnRlbnRzXG5cblx0XHRwcmludENvcHlTdHlsZTogdHJ1ZSwgLy9ERVBSSUNBVEVEIC0gUkVNT1ZFIGluIDUuMFxuXG5cdFx0cHJpbnRTdHlsZWQ6IHRydWUsIC8vZW5hYmxlIHByaW50IGFzIGh0bWwgc3R5bGluZ1xuXG5cdFx0cHJpbnRWaXNpYmxlUm93czogdHJ1ZSwgLy9ERVBSSUNBVEVEIC0gUkVNT1ZFIGluIDUuMFxuXG5cdFx0cHJpbnRSb3dSYW5nZTogXCJ2aXNpYmxlXCIsIC8vcmVzdHJpY3QgcHJpbnQgdG8gdmlzaWJsZSByb3dzIG9ubHlcblxuXHRcdHByaW50Q29uZmlnOiB7fSwgLy9wcmludCBjb25maWcgb3B0aW9uc1xuXG5cblx0XHRhZGRSb3dQb3M6IFwiYm90dG9tXCIsIC8vcG9zaXRpb24gdG8gaW5zZXJ0IGJsYW5rIHJvd3MsIHRvcHxib3R0b21cblxuXG5cdFx0c2VsZWN0YWJsZTogXCJoaWdobGlnaHRcIiwgLy9oaWdobGlnaHQgcm93cyBvbiBob3ZlclxuXG5cdFx0c2VsZWN0YWJsZVJhbmdlTW9kZTogXCJkcmFnXCIsIC8vaGlnaGxpZ2h0IHJvd3Mgb24gaG92ZXJcblxuXHRcdHNlbGVjdGFibGVSb2xsaW5nU2VsZWN0aW9uOiB0cnVlLCAvL3JvbGwgc2VsZWN0aW9uIG9uY2UgbWF4aW11bSBudW1iZXIgb2Ygc2VsZWN0YWJsZSByb3dzIGlzIHJlYWNoZWRcblxuXHRcdHNlbGVjdGFibGVQZXJzaXN0ZW5jZTogdHJ1ZSwgLy8gbWFpbnRhaW4gc2VsZWN0aW9uIHdoZW4gdGFibGUgdmlldyBpcyB1cGRhdGVkXG5cblx0XHRzZWxlY3RhYmxlQ2hlY2s6IGZ1bmN0aW9uIHNlbGVjdGFibGVDaGVjayhkYXRhLCByb3cpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0sIC8vY2hlY2sgd2hlYXRoZXIgcm93IGlzIHNlbGVjdGFibGVcblxuXG5cdFx0aGVhZGVyRmlsdGVyTGl2ZUZpbHRlckRlbGF5OiAzMDAsIC8vZGVsYXkgYmVmb3JlIHVwZGF0aW5nIGNvbHVtbiBhZnRlciB1c2VyIHR5cGVzIGluIGhlYWRlciBmaWx0ZXJcblxuXHRcdGhlYWRlckZpbHRlclBsYWNlaG9sZGVyOiBmYWxzZSwgLy9wbGFjZWhvbGRlciB0ZXh0IHRvIGRpc3BsYXkgaW4gaGVhZGVyIGZpbHRlcnNcblxuXG5cdFx0aGVhZGVyVmlzaWJsZTogdHJ1ZSwgLy9oaWRlIGhlYWRlclxuXG5cblx0XHRoaXN0b3J5OiBmYWxzZSwgLy9lbmFibGUgZWRpdCBoaXN0b3J5XG5cblxuXHRcdGxvY2FsZTogZmFsc2UsIC8vY3VycmVudCBzeXN0ZW0gbGFuZ3VhZ2VcblxuXHRcdGxhbmdzOiB7fSxcblxuXHRcdHZpcnR1YWxEb206IHRydWUsIC8vZW5hYmxlIERPTSB2aXJ0dWFsaXphdGlvblxuXG5cdFx0dmlydHVhbERvbUJ1ZmZlcjogMCwgLy8gc2V0IHZpcnR1YWwgRE9NIGJ1ZmZlciBzaXplXG5cblxuXHRcdHBlcnNpc3RlbnRMYXlvdXQ6IGZhbHNlLCAvL0RFUFJJQ0FURUQgLSBSRU1PVkUgaW4gNS4wXG5cblx0XHRwZXJzaXN0ZW50U29ydDogZmFsc2UsIC8vREVQUklDQVRFRCAtIFJFTU9WRSBpbiA1LjBcblxuXHRcdHBlcnNpc3RlbnRGaWx0ZXI6IGZhbHNlLCAvL0RFUFJJQ0FURUQgLSBSRU1PVkUgaW4gNS4wXG5cblx0XHRwZXJzaXN0ZW5jZUlEOiBcIlwiLCAvL2tleSBmb3IgcGVyc2lzdGVudCBzdG9yYWdlXG5cblx0XHRwZXJzaXN0ZW5jZU1vZGU6IHRydWUsIC8vbW9kZSBmb3Igc3RvcmluZyBwZXJzaXN0ZW5jZSBpbmZvcm1hdGlvblxuXG5cdFx0cGVyc2lzdGVuY2VSZWFkZXJGdW5jOiBmYWxzZSwgLy9mdW5jdGlvbiBmb3IgaGFuZGxpbmcgcGVyc2lzdGVuY2UgZGF0YSByZWFkaW5nXG5cblx0XHRwZXJzaXN0ZW5jZVdyaXRlckZ1bmM6IGZhbHNlLCAvL2Z1bmN0aW9uIGZvciBoYW5kbGluZyBwZXJzaXN0ZW5jZSBkYXRhIHdyaXRpbmdcblxuXG5cdFx0cGVyc2lzdGVuY2U6IGZhbHNlLFxuXG5cdFx0cmVzcG9uc2l2ZUxheW91dDogZmFsc2UsIC8vcmVzcG9uc2l2ZSBsYXlvdXQgZmxhZ3NcblxuXHRcdHJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZVN0YXJ0T3BlbjogdHJ1ZSwgLy9zdGFydCBzaG93aW5nIGNvbGxhcHNlZCBkYXRhXG5cblx0XHRyZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VVc2VGb3JtYXR0ZXJzOiB0cnVlLCAvL3Jlc3BvbnNpdmUgbGF5b3V0IGNvbGxhcHNlIGZvcm1hdHRlclxuXG5cdFx0cmVzcG9uc2l2ZUxheW91dENvbGxhcHNlRm9ybWF0dGVyOiBmYWxzZSwgLy9yZXNwb25zaXZlIGxheW91dCBjb2xsYXBzZSBmb3JtYXR0ZXJcblxuXG5cdFx0cGFnaW5hdGlvbjogZmFsc2UsIC8vc2V0IHBhZ2luYXRpb24gdHlwZVxuXG5cdFx0cGFnaW5hdGlvblNpemU6IGZhbHNlLCAvL3NldCBudW1iZXIgb2Ygcm93cyB0byBhIHBhZ2VcblxuXHRcdHBhZ2luYXRpb25Jbml0aWFsUGFnZTogMSwgLy9pbml0YWlsIHBhZ2UgdG8gc2hvdyBvbiBsb2FkXG5cblx0XHRwYWdpbmF0aW9uQnV0dG9uQ291bnQ6IDUsIC8vIHNldCBjb3VudCBvZiBwYWdlIGJ1dHRvblxuXG5cdFx0cGFnaW5hdGlvblNpemVTZWxlY3RvcjogZmFsc2UsIC8vYWRkIHBhZ2luYXRpb24gc2l6ZSBzZWxlY3RvciBlbGVtZW50XG5cblx0XHRwYWdpbmF0aW9uRWxlbWVudDogZmFsc2UsIC8vZWxlbWVudCB0byBob2xkIHBhZ2luYXRpb24gbnVtYmVyc1xuXG5cdFx0cGFnaW5hdGlvbkRhdGFTZW50OiB7fSwgLy9wYWdpbmF0aW9uIGRhdGEgc2VudCB0byB0aGUgc2VydmVyXG5cblx0XHRwYWdpbmF0aW9uRGF0YVJlY2VpdmVkOiB7fSwgLy9wYWdpbmF0aW9uIGRhdGEgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyXG5cblx0XHRwYWdpbmF0aW9uQWRkUm93OiBcInBhZ2VcIiwgLy9hZGQgcm93cyBvbiB0YWJsZSBvciBwYWdlXG5cblxuXHRcdGFqYXhVUkw6IGZhbHNlLCAvL3VybCBmb3IgYWpheCBsb2FkaW5nXG5cblx0XHRhamF4VVJMR2VuZXJhdG9yOiBmYWxzZSxcblxuXHRcdGFqYXhQYXJhbXM6IHt9LCAvL3BhcmFtcyBmb3IgYWpheCBsb2FkaW5nXG5cblx0XHRhamF4Q29uZmlnOiBcImdldFwiLCAvL2FqYXggcmVxdWVzdCB0eXBlXG5cblx0XHRhamF4Q29udGVudFR5cGU6IFwiZm9ybVwiLCAvL2FqYXggcmVxdWVzdCB0eXBlXG5cblx0XHRhamF4UmVxdWVzdEZ1bmM6IGZhbHNlLCAvL3Byb21pc2UgZnVuY3Rpb25cblxuXHRcdGFqYXhMb2FkZXI6IHRydWUsIC8vc2hvdyBsb2FkZXJcblxuXHRcdGFqYXhMb2FkZXJMb2FkaW5nOiBmYWxzZSwgLy9sb2FkZXIgZWxlbWVudFxuXG5cdFx0YWpheExvYWRlckVycm9yOiBmYWxzZSwgLy9sb2FkZXIgZWxlbWVudFxuXG5cdFx0YWpheEZpbHRlcmluZzogZmFsc2UsXG5cblx0XHRhamF4U29ydGluZzogZmFsc2UsXG5cblx0XHRhamF4UHJvZ3Jlc3NpdmVMb2FkOiBmYWxzZSwgLy9wcm9ncmVzc2l2ZSBsb2FkaW5nXG5cblx0XHRhamF4UHJvZ3Jlc3NpdmVMb2FkRGVsYXk6IDAsIC8vZGVsYXkgYmV0d2VlbiByZXF1ZXN0c1xuXG5cdFx0YWpheFByb2dyZXNzaXZlTG9hZFNjcm9sbE1hcmdpbjogMCwgLy9tYXJnaW4gYmVmb3JlIHNjcm9sbCBiZWdpbnNcblxuXG5cdFx0Z3JvdXBCeTogZmFsc2UsIC8vZW5hYmxlIHRhYmxlIGdyb3VwaW5nIGFuZCBzZXQgZmllbGQgdG8gZ3JvdXAgYnlcblxuXHRcdGdyb3VwU3RhcnRPcGVuOiB0cnVlLCAvL3N0YXJ0aW5nIHN0YXRlIG9mIGdyb3VwXG5cblx0XHRncm91cFZhbHVlczogZmFsc2UsXG5cblx0XHRncm91cEhlYWRlcjogZmFsc2UsIC8vaGVhZGVyIGdlbmVyYXRpb24gZnVuY3Rpb25cblxuXG5cdFx0aHRtbE91dHB1dENvbmZpZzogZmFsc2UsIC8vaHRtbCBvdXR5cHUgY29uZmlnXG5cblxuXHRcdG1vdmFibGVDb2x1bW5zOiBmYWxzZSwgLy9lbmFibGUgbW92YWJsZSBjb2x1bW5zXG5cblxuXHRcdG1vdmFibGVSb3dzOiBmYWxzZSwgLy9lbmFibGUgbW92YWJsZSByb3dzXG5cblx0XHRtb3ZhYmxlUm93c0Nvbm5lY3RlZFRhYmxlczogZmFsc2UsIC8vdGFibGVzIGZvciBtb3ZhYmxlIHJvd3MgdG8gYmUgY29ubmVjdGVkIHRvXG5cblx0XHRtb3ZhYmxlUm93c1NlbmRlcjogZmFsc2UsXG5cblx0XHRtb3ZhYmxlUm93c1JlY2VpdmVyOiBcImluc2VydFwiLFxuXG5cdFx0bW92YWJsZVJvd3NTZW5kaW5nU3RhcnQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzU2VuZGluZ1N0YXJ0KCkge30sXG5cblx0XHRtb3ZhYmxlUm93c1NlbnQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzU2VudCgpIHt9LFxuXG5cdFx0bW92YWJsZVJvd3NTZW50RmFpbGVkOiBmdW5jdGlvbiBtb3ZhYmxlUm93c1NlbnRGYWlsZWQoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzU2VuZGluZ1N0b3A6IGZ1bmN0aW9uIG1vdmFibGVSb3dzU2VuZGluZ1N0b3AoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzUmVjZWl2aW5nU3RhcnQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzUmVjZWl2aW5nU3RhcnQoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzUmVjZWl2ZWQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzUmVjZWl2ZWQoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzUmVjZWl2ZWRGYWlsZWQ6IGZ1bmN0aW9uIG1vdmFibGVSb3dzUmVjZWl2ZWRGYWlsZWQoKSB7fSxcblxuXHRcdG1vdmFibGVSb3dzUmVjZWl2aW5nU3RvcDogZnVuY3Rpb24gbW92YWJsZVJvd3NSZWNlaXZpbmdTdG9wKCkge30sXG5cblx0XHRzY3JvbGxUb1Jvd1Bvc2l0aW9uOiBcInRvcFwiLFxuXG5cdFx0c2Nyb2xsVG9Sb3dJZlZpc2libGU6IHRydWUsXG5cblx0XHRzY3JvbGxUb0NvbHVtblBvc2l0aW9uOiBcImxlZnRcIixcblxuXHRcdHNjcm9sbFRvQ29sdW1uSWZWaXNpYmxlOiB0cnVlLFxuXG5cdFx0cm93Rm9ybWF0dGVyOiBmYWxzZSxcblxuXHRcdHJvd0Zvcm1hdHRlclByaW50OiBudWxsLFxuXG5cdFx0cm93Rm9ybWF0dGVyQ2xpcGJvYXJkOiBudWxsLFxuXG5cdFx0cm93Rm9ybWF0dGVySHRtbE91dHB1dDogbnVsbCxcblxuXHRcdHBsYWNlaG9sZGVyOiBmYWxzZSxcblxuXHRcdC8vdGFibGUgYnVpbGRpbmcgY2FsbGJhY2tzXG5cblx0XHR0YWJsZUJ1aWxkaW5nOiBmdW5jdGlvbiB0YWJsZUJ1aWxkaW5nKCkge30sXG5cblx0XHR0YWJsZUJ1aWx0OiBmdW5jdGlvbiB0YWJsZUJ1aWx0KCkge30sXG5cblx0XHQvL3JlbmRlciBjYWxsYmFja3NcblxuXHRcdHJlbmRlclN0YXJ0ZWQ6IGZ1bmN0aW9uIHJlbmRlclN0YXJ0ZWQoKSB7fSxcblxuXHRcdHJlbmRlckNvbXBsZXRlOiBmdW5jdGlvbiByZW5kZXJDb21wbGV0ZSgpIHt9LFxuXG5cdFx0Ly9yb3cgY2FsbGJhY2tzXG5cblx0XHRyb3dDbGljazogZmFsc2UsXG5cblx0XHRyb3dEYmxDbGljazogZmFsc2UsXG5cblx0XHRyb3dDb250ZXh0OiBmYWxzZSxcblxuXHRcdHJvd1RhcDogZmFsc2UsXG5cblx0XHRyb3dEYmxUYXA6IGZhbHNlLFxuXG5cdFx0cm93VGFwSG9sZDogZmFsc2UsXG5cblx0XHRyb3dNb3VzZUVudGVyOiBmYWxzZSxcblxuXHRcdHJvd01vdXNlTGVhdmU6IGZhbHNlLFxuXG5cdFx0cm93TW91c2VPdmVyOiBmYWxzZSxcblxuXHRcdHJvd01vdXNlT3V0OiBmYWxzZSxcblxuXHRcdHJvd01vdXNlTW92ZTogZmFsc2UsXG5cblx0XHRyb3dDb250ZXh0TWVudTogZmFsc2UsXG5cblx0XHRyb3dBZGRlZDogZnVuY3Rpb24gcm93QWRkZWQoKSB7fSxcblxuXHRcdHJvd0RlbGV0ZWQ6IGZ1bmN0aW9uIHJvd0RlbGV0ZWQoKSB7fSxcblxuXHRcdHJvd01vdmVkOiBmdW5jdGlvbiByb3dNb3ZlZCgpIHt9LFxuXG5cdFx0cm93VXBkYXRlZDogZnVuY3Rpb24gcm93VXBkYXRlZCgpIHt9LFxuXG5cdFx0cm93U2VsZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24gcm93U2VsZWN0aW9uQ2hhbmdlZCgpIHt9LFxuXG5cdFx0cm93U2VsZWN0ZWQ6IGZ1bmN0aW9uIHJvd1NlbGVjdGVkKCkge30sXG5cblx0XHRyb3dEZXNlbGVjdGVkOiBmdW5jdGlvbiByb3dEZXNlbGVjdGVkKCkge30sXG5cblx0XHRyb3dSZXNpemVkOiBmdW5jdGlvbiByb3dSZXNpemVkKCkge30sXG5cblx0XHQvL2NlbGwgY2FsbGJhY2tzXG5cblx0XHQvL3JvdyBjYWxsYmFja3NcblxuXHRcdGNlbGxDbGljazogZmFsc2UsXG5cblx0XHRjZWxsRGJsQ2xpY2s6IGZhbHNlLFxuXG5cdFx0Y2VsbENvbnRleHQ6IGZhbHNlLFxuXG5cdFx0Y2VsbFRhcDogZmFsc2UsXG5cblx0XHRjZWxsRGJsVGFwOiBmYWxzZSxcblxuXHRcdGNlbGxUYXBIb2xkOiBmYWxzZSxcblxuXHRcdGNlbGxNb3VzZUVudGVyOiBmYWxzZSxcblxuXHRcdGNlbGxNb3VzZUxlYXZlOiBmYWxzZSxcblxuXHRcdGNlbGxNb3VzZU92ZXI6IGZhbHNlLFxuXG5cdFx0Y2VsbE1vdXNlT3V0OiBmYWxzZSxcblxuXHRcdGNlbGxNb3VzZU1vdmU6IGZhbHNlLFxuXG5cdFx0Y2VsbEVkaXRpbmc6IGZ1bmN0aW9uIGNlbGxFZGl0aW5nKCkge30sXG5cblx0XHRjZWxsRWRpdGVkOiBmdW5jdGlvbiBjZWxsRWRpdGVkKCkge30sXG5cblx0XHRjZWxsRWRpdENhbmNlbGxlZDogZnVuY3Rpb24gY2VsbEVkaXRDYW5jZWxsZWQoKSB7fSxcblxuXHRcdC8vY29sdW1uIGNhbGxiYWNrc1xuXG5cdFx0Y29sdW1uTW92ZWQ6IGZhbHNlLFxuXG5cdFx0Y29sdW1uUmVzaXplZDogZnVuY3Rpb24gY29sdW1uUmVzaXplZCgpIHt9LFxuXG5cdFx0Y29sdW1uVGl0bGVDaGFuZ2VkOiBmdW5jdGlvbiBjb2x1bW5UaXRsZUNoYW5nZWQoKSB7fSxcblxuXHRcdGNvbHVtblZpc2liaWxpdHlDaGFuZ2VkOiBmdW5jdGlvbiBjb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZCgpIHt9LFxuXG5cdFx0Ly9IVE1MIGlwb3J0IGNhbGxiYWNrc1xuXG5cdFx0aHRtbEltcG9ydGluZzogZnVuY3Rpb24gaHRtbEltcG9ydGluZygpIHt9LFxuXG5cdFx0aHRtbEltcG9ydGVkOiBmdW5jdGlvbiBodG1sSW1wb3J0ZWQoKSB7fSxcblxuXHRcdC8vZGF0YSBjYWxsYmFja3NcblxuXHRcdGRhdGFMb2FkaW5nOiBmdW5jdGlvbiBkYXRhTG9hZGluZygpIHt9LFxuXG5cdFx0ZGF0YUxvYWRlZDogZnVuY3Rpb24gZGF0YUxvYWRlZCgpIHt9LFxuXG5cdFx0ZGF0YUVkaXRlZDogZnVuY3Rpb24gZGF0YUVkaXRlZCgpIHt9LFxuXG5cdFx0Ly9hamF4IGNhbGxiYWNrc1xuXG5cdFx0YWpheFJlcXVlc3Rpbmc6IGZ1bmN0aW9uIGFqYXhSZXF1ZXN0aW5nKCkge30sXG5cblx0XHRhamF4UmVzcG9uc2U6IGZhbHNlLFxuXG5cdFx0YWpheEVycm9yOiBmdW5jdGlvbiBhamF4RXJyb3IoKSB7fSxcblxuXHRcdC8vZmlsdGVyaW5nIGNhbGxiYWNrc1xuXG5cdFx0ZGF0YUZpbHRlcmluZzogZmFsc2UsXG5cblx0XHRkYXRhRmlsdGVyZWQ6IGZhbHNlLFxuXG5cdFx0Ly9zb3J0aW5nIGNhbGxiYWNrc1xuXG5cdFx0ZGF0YVNvcnRpbmc6IGZ1bmN0aW9uIGRhdGFTb3J0aW5nKCkge30sXG5cblx0XHRkYXRhU29ydGVkOiBmdW5jdGlvbiBkYXRhU29ydGVkKCkge30sXG5cblx0XHQvL2dyb3VwaW5nIGNhbGxiYWNrc1xuXG5cdFx0Z3JvdXBUb2dnbGVFbGVtZW50OiBcImFycm93XCIsXG5cblx0XHRncm91cENsb3NlZFNob3dDYWxjczogZmFsc2UsXG5cblx0XHRkYXRhR3JvdXBpbmc6IGZ1bmN0aW9uIGRhdGFHcm91cGluZygpIHt9LFxuXG5cdFx0ZGF0YUdyb3VwZWQ6IGZhbHNlLFxuXG5cdFx0Z3JvdXBWaXNpYmlsaXR5Q2hhbmdlZDogZnVuY3Rpb24gZ3JvdXBWaXNpYmlsaXR5Q2hhbmdlZCgpIHt9LFxuXG5cdFx0Z3JvdXBDbGljazogZmFsc2UsXG5cblx0XHRncm91cERibENsaWNrOiBmYWxzZSxcblxuXHRcdGdyb3VwQ29udGV4dDogZmFsc2UsXG5cblx0XHRncm91cFRhcDogZmFsc2UsXG5cblx0XHRncm91cERibFRhcDogZmFsc2UsXG5cblx0XHRncm91cFRhcEhvbGQ6IGZhbHNlLFxuXG5cdFx0Y29sdW1uQ2FsY3M6IHRydWUsXG5cblx0XHQvL3BhZ2luYXRpb24gY2FsbGJhY2tzXG5cblx0XHRwYWdlTG9hZGVkOiBmdW5jdGlvbiBwYWdlTG9hZGVkKCkge30sXG5cblx0XHQvL2xvY2FsaXphdGlvbiBjYWxsYmFja3NcblxuXHRcdGxvY2FsaXplZDogZnVuY3Rpb24gbG9jYWxpemVkKCkge30sXG5cblx0XHQvL3ZhbGlkYXRpb24gaGFzIGZhaWxlZFxuXG5cdFx0dmFsaWRhdGlvbkZhaWxlZDogZnVuY3Rpb24gdmFsaWRhdGlvbkZhaWxlZCgpIHt9LFxuXG5cdFx0Ly9oaXN0b3J5IGNhbGxiYWNrc1xuXG5cdFx0aGlzdG9yeVVuZG86IGZ1bmN0aW9uIGhpc3RvcnlVbmRvKCkge30sXG5cblx0XHRoaXN0b3J5UmVkbzogZnVuY3Rpb24gaGlzdG9yeVJlZG8oKSB7fSxcblxuXHRcdC8vc2Nyb2xsIGNhbGxiYWNrc1xuXG5cdFx0c2Nyb2xsSG9yaXpvbnRhbDogZnVuY3Rpb24gc2Nyb2xsSG9yaXpvbnRhbCgpIHt9LFxuXG5cdFx0c2Nyb2xsVmVydGljYWw6IGZ1bmN0aW9uIHNjcm9sbFZlcnRpY2FsKCkge31cblxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuaW5pdGlhbGl6ZU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXG5cdFx0Ly93YXJuIHVzZXIgaWYgb3B0aW9uIGlzIG5vdCBhdmFpbGFibGVcblxuXHRcdGlmIChvcHRpb25zLmludmFsaWRPcHRpb25XYXJuaW5ncyAhPT0gZmFsc2UpIHtcblxuXHRcdFx0Zm9yICh2YXIga2V5IGluIG9wdGlvbnMpIHtcblxuXHRcdFx0XHRpZiAodHlwZW9mIHRoaXMuZGVmYXVsdE9wdGlvbnNba2V5XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiSW52YWxpZCB0YWJsZSBjb25zdHJ1Y3RvciBvcHRpb246XCIsIGtleSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvL2Fzc2lnbiBvcHRpb25zIHRvIHRhYmxlXG5cblx0XHRmb3IgKHZhciBrZXkgaW4gdGhpcy5kZWZhdWx0T3B0aW9ucykge1xuXG5cdFx0XHRpZiAoa2V5IGluIG9wdGlvbnMpIHtcblxuXHRcdFx0XHR0aGlzLm9wdGlvbnNba2V5XSA9IG9wdGlvbnNba2V5XTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkodGhpcy5kZWZhdWx0T3B0aW9uc1trZXldKSkge1xuXG5cdFx0XHRcdFx0dGhpcy5vcHRpb25zW2tleV0gPSBbXTtcblx0XHRcdFx0fSBlbHNlIGlmIChfdHlwZW9mKHRoaXMuZGVmYXVsdE9wdGlvbnNba2V5XSkgPT09IFwib2JqZWN0XCIgJiYgdGhpcy5kZWZhdWx0T3B0aW9uc1trZXldICE9PSBudWxsKSB7XG5cblx0XHRcdFx0XHR0aGlzLm9wdGlvbnNba2V5XSA9IHt9O1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0dGhpcy5vcHRpb25zW2tleV0gPSB0aGlzLmRlZmF1bHRPcHRpb25zW2tleV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5pbml0aWFsaXplRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG5cblx0XHRpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZiBlbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCk7XG5cblx0XHRcdGlmICh0aGlzLmVsZW1lbnQpIHtcblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBDcmVhdGlvbiBFcnJvciAtIG5vIGVsZW1lbnQgZm91bmQgbWF0Y2hpbmcgc2VsZWN0b3I6IFwiLCBlbGVtZW50KTtcblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBDcmVhdGlvbiBFcnJvciAtIEludmFsaWQgZWxlbWVudCBwcm92aWRlZDpcIiwgZWxlbWVudCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9jb252ZXJ0IGRlcHJpY2F0ZWQgZnVuY3Rpb25hbGl0eSB0byBuZXcgZnVuY3Rpb25zXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5fbWFwRGVwcmljYXRlZEZ1bmN0aW9uYWxpdHkgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHQvL21hcCBkZXByaWNhdGVkIHBlcnNpc3RhbmNlIHNldHVwIG9wdGlvbnNcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGVyc2lzdGVudExheW91dCB8fCB0aGlzLm9wdGlvbnMucGVyc2lzdGVudFNvcnQgfHwgdGhpcy5vcHRpb25zLnBlcnNpc3RlbnRGaWx0ZXIpIHtcblxuXHRcdFx0aWYgKCF0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UpIHtcblxuXHRcdFx0XHR0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UgPSB7fTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5jbGlwYm9hcmRDb3B5SGVhZGVyICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5jb2x1bW5IZWFkZXJzID0gdGhpcy5vcHRpb25zLmNsaXBib2FyZENvcHlIZWFkZXI7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkRFUFJFQ0FUSU9OIFdBUk5JTkcgLSBjbGlwYm9hcmRDb3B5SGVhZGVyIG9wdGlvbiBoYXMgYmVlbiBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIHRoZSBjb2x1bW5IZWFkZXJzIHByb3BlcnR5IG9uIHRoZSBjbGlwYm9hcmRDb3B5Q29uZmlnIG9wdGlvblwiKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnByaW50VmlzaWJsZVJvd3MgIT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicHJpbnRWaXNpYmxlUm93cyBvcHRpb24gaXMgZGVwcmVjYXRlZCwgeW91IHNob3VsZCBub3cgdXNlIHRoZSBwcmludFJvd1JhbmdlIG9wdGlvblwiKTtcblxuXHRcdFx0dGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLnByaW50Um93UmFuZ2UgPSBcImFjdGl2ZVwiO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucHJpbnRDb3B5U3R5bGUgIT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicHJpbnRDb3B5U3R5bGUgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcHJpbnRTdHlsZWQgb3B0aW9uXCIpO1xuXG5cdFx0XHR0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UucHJpbnRTdHlsZWQgPSB0aGlzLm9wdGlvbnMucHJpbnRDb3B5U3R5bGU7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW50TGF5b3V0KSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRMYXlvdXQgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcGVyc2lzdGVuY2Ugb3B0aW9uXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICE9PSB0cnVlICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UuY29sdW1ucyA9PT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZS5jb2x1bW5zID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbnRTb3J0KSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRTb3J0IG9wdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGhlIHBlcnNpc3RlbmNlIG9wdGlvblwiKTtcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZSAhPT0gdHJ1ZSAmJiB0eXBlb2YgdGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLnNvcnQgPT09IFwidW5kZWZpbmVkXCIpIHtcblxuXHRcdFx0XHR0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2Uuc29ydCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW50RmlsdGVyKSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBlcnNpc3RlbnRGaWx0ZXIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHVzZSB0aGUgcGVyc2lzdGVuY2Ugb3B0aW9uXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICE9PSB0cnVlICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UuZmlsdGVyID09PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdFx0dGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlLmZpbHRlciA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5jb2x1bW5WZXJ0QWxpZ24pIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiY29sdW1uVmVydEFsaWduIG9wdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyB1c2UgdGhlIGNvbHVtbkhlYWRlclZlcnRBbGlnbiBvcHRpb25cIik7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5jb2x1bW5IZWFkZXJWZXJ0QWxpZ24gPSB0aGlzLm9wdGlvbnMuY29sdW1uVmVydEFsaWduO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9jbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblxuXHRcdGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG5cblx0XHRcdGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHtcblx0XHRcdFx0Ly8gQ2hyb21lXG5cblx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCk7XG5cdFx0XHR9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHtcblx0XHRcdFx0Ly8gRmlyZWZveFxuXG5cdFx0XHRcdHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuXHRcdFx0Ly8gSUU/XG5cblx0XHRcdGRvY3VtZW50LnNlbGVjdGlvbi5lbXB0eSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblx0fTtcblxuXHQvL2NvbmNyZWF0ZSB0YWJsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2NyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuX2NsZWFyT2JqZWN0UG9pbnRlcnMoKTtcblxuXHRcdHRoaXMuX21hcERlcHJpY2F0ZWRGdW5jdGlvbmFsaXR5KCk7XG5cblx0XHR0aGlzLmJpbmRNb2R1bGVzKCk7XG5cblx0XHRpZiAodGhpcy5lbGVtZW50LnRhZ05hbWUgPT09IFwiVEFCTEVcIikge1xuXG5cdFx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJodG1sVGFibGVJbXBvcnRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMuaHRtbFRhYmxlSW1wb3J0LnBhcnNlVGFibGUoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIgPSBuZXcgQ29sdW1uTWFuYWdlcih0aGlzKTtcblxuXHRcdHRoaXMucm93TWFuYWdlciA9IG5ldyBSb3dNYW5hZ2VyKHRoaXMpO1xuXG5cdFx0dGhpcy5mb290ZXJNYW5hZ2VyID0gbmV3IEZvb3Rlck1hbmFnZXIodGhpcyk7XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIuc2V0Um93TWFuYWdlcih0aGlzLnJvd01hbmFnZXIpO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnNldENvbHVtbk1hbmFnZXIodGhpcy5jb2x1bW5NYW5hZ2VyKTtcblxuXHRcdHRoaXMuX2J1aWxkRWxlbWVudCgpO1xuXG5cdFx0dGhpcy5fbG9hZEluaXRpYWxEYXRhKCk7XG5cdH07XG5cblx0Ly9jbGVhciBwb2ludGVycyB0byBvYmplY3RzIGluIGRlZmF1bHQgY29uZmlnIG9iamVjdFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2NsZWFyT2JqZWN0UG9pbnRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLm9wdGlvbnMuY29sdW1ucyA9IHRoaXMub3B0aW9ucy5jb2x1bW5zLnNsaWNlKDApO1xuXG5cdFx0aWYgKCF0aGlzLm9wdGlvbnMucmVhY3RpdmVEYXRhKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5kYXRhID0gdGhpcy5vcHRpb25zLmRhdGEuc2xpY2UoMCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYnVpbGQgdGFidWxhdG9yIGVsZW1lbnRcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9idWlsZEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzMTYgPSB0aGlzO1xuXG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsXG5cdFx0ICAgIG1vZCA9IHRoaXMubW9kdWxlcyxcblx0XHQgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuXHRcdG9wdGlvbnMudGFibGVCdWlsZGluZy5jYWxsKHRoaXMpO1xuXG5cdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yXCIpO1xuXG5cdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiZ3JpZFwiKTtcblxuXHRcdC8vZW1wdHkgZWxlbWVudFxuXG5cdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH0gLy9zZXQgdGFibGUgaGVpZ2h0XG5cblx0XHRpZiAob3B0aW9ucy5oZWlnaHQpIHtcblxuXHRcdFx0b3B0aW9ucy5oZWlnaHQgPSBpc05hTihvcHRpb25zLmhlaWdodCkgPyBvcHRpb25zLmhlaWdodCA6IG9wdGlvbnMuaGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuXHRcdH1cblxuXHRcdC8vc2V0IHRhYmxlIG1pbiBoZWlnaHRcblxuXHRcdGlmIChvcHRpb25zLm1pbkhlaWdodCAhPT0gZmFsc2UpIHtcblxuXHRcdFx0b3B0aW9ucy5taW5IZWlnaHQgPSBpc05hTihvcHRpb25zLm1pbkhlaWdodCkgPyBvcHRpb25zLm1pbkhlaWdodCA6IG9wdGlvbnMubWluSGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0O1xuXHRcdH1cblxuXHRcdC8vc2V0IHRhYmxlIG1heEhlaWdodFxuXG5cdFx0aWYgKG9wdGlvbnMubWF4SGVpZ2h0ICE9PSBmYWxzZSkge1xuXG5cdFx0XHRvcHRpb25zLm1heEhlaWdodCA9IGlzTmFOKG9wdGlvbnMubWF4SGVpZ2h0KSA/IG9wdGlvbnMubWF4SGVpZ2h0IDogb3B0aW9ucy5tYXhIZWlnaHQgKyBcInB4XCI7XG5cblx0XHRcdGVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gb3B0aW9ucy5tYXhIZWlnaHQ7XG5cdFx0fVxuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLmluaXRpYWxpemUoKTtcblxuXHRcdHRoaXMucm93TWFuYWdlci5pbml0aWFsaXplKCk7XG5cblx0XHR0aGlzLl9kZXRlY3RCcm93c2VyKCk7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJsYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0bW9kLmxheW91dC5pbml0aWFsaXplKG9wdGlvbnMubGF5b3V0KTtcblx0XHR9XG5cblx0XHQvL3NldCBsb2NhbGl6YXRpb25cblxuXHRcdGlmIChvcHRpb25zLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyICE9PSBmYWxzZSkge1xuXG5cdFx0XHRtb2QubG9jYWxpemUuc2V0SGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIob3B0aW9ucy5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlcik7XG5cdFx0fVxuXG5cdFx0Zm9yICh2YXIgbG9jYWxlIGluIG9wdGlvbnMubGFuZ3MpIHtcblxuXHRcdFx0bW9kLmxvY2FsaXplLmluc3RhbGxMYW5nKGxvY2FsZSwgb3B0aW9ucy5sYW5nc1tsb2NhbGVdKTtcblx0XHR9XG5cblx0XHRtb2QubG9jYWxpemUuc2V0TG9jYWxlKG9wdGlvbnMubG9jYWxlKTtcblxuXHRcdC8vY29uZmlndXJlIHBsYWNlaG9sZGVyIGVsZW1lbnRcblxuXHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5wbGFjZWhvbGRlciA9PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGxhY2Vob2xkZXJcIik7XG5cblx0XHRcdHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cblx0XHRcdHNwYW4uaW5uZXJIVE1MID0gb3B0aW9ucy5wbGFjZWhvbGRlcjtcblxuXHRcdFx0ZWwuYXBwZW5kQ2hpbGQoc3Bhbik7XG5cblx0XHRcdG9wdGlvbnMucGxhY2Vob2xkZXIgPSBlbDtcblx0XHR9XG5cblx0XHQvL2J1aWxkIHRhYmxlIGVsZW1lbnRzXG5cblx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkpO1xuXG5cdFx0ZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpKTtcblxuXHRcdGlmIChvcHRpb25zLmZvb3RlckVsZW1lbnQpIHtcblxuXHRcdFx0dGhpcy5mb290ZXJNYW5hZ2VyLmFjdGl2YXRlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QucGVyc2lzdGVuY2UuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5jb2x1bW5zKSB7XG5cblx0XHRcdG9wdGlvbnMuY29sdW1ucyA9IG1vZC5wZXJzaXN0ZW5jZS5sb2FkKFwiY29sdW1uc1wiLCBvcHRpb25zLmNvbHVtbnMpO1xuXHRcdH1cblxuXHRcdGlmIChvcHRpb25zLm1vdmFibGVSb3dzICYmIHRoaXMubW9kRXhpc3RzKFwibW92ZVJvd1wiKSkge1xuXG5cdFx0XHRtb2QubW92ZVJvdy5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMuYXV0b0NvbHVtbnMgJiYgdGhpcy5vcHRpb25zLmRhdGEpIHtcblxuXHRcdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLmdlbmVyYXRlQ29sdW1uc0Zyb21Sb3dEYXRhKHRoaXMub3B0aW9ucy5kYXRhKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRtb2QuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKG9wdGlvbnMuY29sdW1ucyk7XG5cblx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZSAmJiB0aGlzLm1vZEV4aXN0cyhcImRhdGFUcmVlXCIsIHRydWUpKSB7XG5cblx0XHRcdG1vZC5kYXRhVHJlZS5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZnJvemVuUm93c1wiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZnJvemVuUm93cy5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5zb3J0IHx8IG9wdGlvbnMuaW5pdGlhbFNvcnQpICYmIHRoaXMubW9kRXhpc3RzKFwic29ydFwiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgc29ydGVycyA9IFtdO1xuXG5cdFx0XHRpZiAob3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIG1vZC5wZXJzaXN0ZW5jZS5jb25maWcuc29ydCkge1xuXG5cdFx0XHRcdHNvcnRlcnMgPSBtb2QucGVyc2lzdGVuY2UubG9hZChcInNvcnRcIik7XG5cblx0XHRcdFx0aWYgKHNvcnRlcnMgPT09IGZhbHNlICYmIG9wdGlvbnMuaW5pdGlhbFNvcnQpIHtcblxuXHRcdFx0XHRcdHNvcnRlcnMgPSBvcHRpb25zLmluaXRpYWxTb3J0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9wdGlvbnMuaW5pdGlhbFNvcnQpIHtcblxuXHRcdFx0XHRzb3J0ZXJzID0gb3B0aW9ucy5pbml0aWFsU29ydDtcblx0XHRcdH1cblxuXHRcdFx0bW9kLnNvcnQuc2V0U29ydChzb3J0ZXJzKTtcblx0XHR9XG5cblx0XHRpZiAoKG9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiBtb2QucGVyc2lzdGVuY2UuY29uZmlnLmZpbHRlciB8fCBvcHRpb25zLmluaXRpYWxGaWx0ZXIpICYmIHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHZhciBmaWx0ZXJzID0gW107XG5cblx0XHRcdGlmIChvcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgbW9kLnBlcnNpc3RlbmNlLmNvbmZpZy5maWx0ZXIpIHtcblxuXHRcdFx0XHRmaWx0ZXJzID0gbW9kLnBlcnNpc3RlbmNlLmxvYWQoXCJmaWx0ZXJcIik7XG5cblx0XHRcdFx0aWYgKGZpbHRlcnMgPT09IGZhbHNlICYmIG9wdGlvbnMuaW5pdGlhbEZpbHRlcikge1xuXG5cdFx0XHRcdFx0ZmlsdGVycyA9IG9wdGlvbnMuaW5pdGlhbEZpbHRlcjtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvcHRpb25zLmluaXRpYWxGaWx0ZXIpIHtcblxuXHRcdFx0XHRmaWx0ZXJzID0gb3B0aW9ucy5pbml0aWFsRmlsdGVyO1xuXHRcdFx0fVxuXG5cdFx0XHRtb2QuZmlsdGVyLnNldEZpbHRlcihmaWx0ZXJzKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5pbml0aWFsSGVhZGVyRmlsdGVyICYmIHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdG9wdGlvbnMuaW5pdGlhbEhlYWRlckZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0dmFyIGNvbHVtbiA9IF90aGlzMTYuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGl0ZW0uZmllbGQpO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdG1vZC5maWx0ZXIuc2V0SGVhZGVyRmlsdGVyVmFsdWUoY29sdW1uLCBpdGVtLnZhbHVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGl0ZW0uZmllbGQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdG1vZC5hamF4LmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QucGFnZS5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHRtb2QuZ3JvdXBSb3dzLmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJrZXliaW5kaW5nc1wiKSkge1xuXG5cdFx0XHRtb2Qua2V5YmluZGluZ3MuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiKSkge1xuXG5cdFx0XHRtb2Quc2VsZWN0Um93LmNsZWFyU2VsZWN0aW9uRGF0YSh0cnVlKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5hdXRvUmVzaXplICYmIHRoaXMubW9kRXhpc3RzKFwicmVzaXplVGFibGVcIikpIHtcblxuXHRcdFx0bW9kLnJlc2l6ZVRhYmxlLmluaXRpYWxpemUoKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjbGlwYm9hcmRcIikpIHtcblxuXHRcdFx0bW9kLmNsaXBib2FyZC5pbml0aWFsaXplKCk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMucHJpbnRBc0h0bWwgJiYgdGhpcy5tb2RFeGlzdHMoXCJwcmludFwiKSkge1xuXG5cdFx0XHRtb2QucHJpbnQuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblxuXHRcdG9wdGlvbnMudGFibGVCdWlsdC5jYWxsKHRoaXMpO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuX2xvYWRJbml0aWFsRGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiAmJiBzZWxmLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2UucmVzZXQodHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiA9PSBcImxvY2FsXCIpIHtcblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLmRhdGEubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShzZWxmLm9wdGlvbnMuZGF0YSwgZmFsc2UsIHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0aWYgKChzZWxmLm9wdGlvbnMuYWpheFVSTCB8fCBzZWxmLm9wdGlvbnMuYWpheFVSTEdlbmVyYXRvcikgJiYgc2VsZi5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0XHRcdHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGZhbHNlLCB0cnVlKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHNlbGYub3B0aW9ucy5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UpIHtcblxuXHRcdFx0XHRcdFx0XHRcdHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2Uoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLnNldERhdGEoc2VsZi5vcHRpb25zLmRhdGEsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSkge1xuXG5cdFx0XHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2Uuc2V0UGFnZShzZWxmLm9wdGlvbnMucGFnaW5hdGlvbkluaXRpYWxQYWdlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLmFqYXhVUkwpIHtcblxuXHRcdFx0XHRcdHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2Uoc2VsZi5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZSkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLnNldERhdGEoW10sIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChzZWxmLm9wdGlvbnMuZGF0YS5sZW5ndGgpIHtcblxuXHRcdFx0XHRzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShzZWxmLm9wdGlvbnMuZGF0YSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmICgoc2VsZi5vcHRpb25zLmFqYXhVUkwgfHwgc2VsZi5vcHRpb25zLmFqYXhVUkxHZW5lcmF0b3IpICYmIHNlbGYubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHRcdFx0c2VsZi5tb2R1bGVzLmFqYXgubG9hZERhdGEoZmFsc2UsIHRydWUpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHNlbGYucm93TWFuYWdlci5zZXREYXRhKHNlbGYub3B0aW9ucy5kYXRhLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9kZWNvbnN0cnVjdG9yXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cblx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLmRlcmVnaXN0ZXIodGhpcyk7IC8vZGVyZWdpc3RlciB0YWJsZSBmcm9tIGluZGVyZGV2aWNlIGNvbW11bmljYXRpb25cblxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5yZWFjdGl2ZURhdGEgJiYgdGhpcy5tb2RFeGlzdHMoXCJyZWFjdGl2ZURhdGFcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnJlYWN0aXZlRGF0YS51bndhdGNoRGF0YSgpO1xuXHRcdH1cblxuXHRcdC8vY2xlYXIgcm93IGRhdGFcblxuXHRcdHRoaXMucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0XHRyb3cud2lwZSgpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnJvd3MgPSBbXTtcblxuXHRcdHRoaXMucm93TWFuYWdlci5hY3RpdmVSb3dzID0gW107XG5cblx0XHR0aGlzLnJvd01hbmFnZXIuZGlzcGxheVJvd3MgPSBbXTtcblxuXHRcdC8vY2xlYXIgZXZlbnQgYmluZGluZ3NcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMuYXV0b1Jlc2l6ZSAmJiB0aGlzLm1vZEV4aXN0cyhcInJlc2l6ZVRhYmxlXCIpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5yZXNpemVUYWJsZS5jbGVhckJpbmRpbmdzKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwia2V5YmluZGluZ3NcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmtleWJpbmRpbmdzLmNsZWFyQmluZGluZ3MoKTtcblx0XHR9XG5cblx0XHQvL2NsZWFyIERPTVxuXG5cdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH1lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3JcIik7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5fZGV0ZWN0QnJvd3NlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7XG5cblx0XHRpZiAodWEuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAtMSkge1xuXG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImllXCI7XG5cblx0XHRcdHRoaXMuYnJvd3NlclNsb3cgPSB0cnVlO1xuXHRcdH0gZWxzZSBpZiAodWEuaW5kZXhPZihcIkVkZ2VcIikgPiAtMSkge1xuXG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImVkZ2VcIjtcblxuXHRcdFx0dGhpcy5icm93c2VyU2xvdyA9IHRydWU7XG5cdFx0fSBlbHNlIGlmICh1YS5pbmRleE9mKFwiRmlyZWZveFwiKSA+IC0xKSB7XG5cblx0XHRcdHRoaXMuYnJvd3NlciA9IFwiZmlyZWZveFwiO1xuXG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5icm93c2VyID0gXCJvdGhlclwiO1xuXG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0dGhpcy5icm93c2VyTW9iaWxlID0gLyhhbmRyb2lkfGJiXFxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVxcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFxcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWlub3xhbmRyb2lkfGlwYWR8cGxheWJvb2t8c2lsay9pLnRlc3QodWEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXFwtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1xcLShufHUpfGM1NVxcL3xjYXBpfGNjd2F8Y2RtXFwtfGNlbGx8Y2h0bXxjbGRjfGNtZFxcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1xcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFxcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlxcLTV8Z1xcLW1vfGdvKFxcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcXC0obXxwfHQpfGhlaVxcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXFwtY3xodChjKFxcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XFwtfFxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcXC8pfGtsb258a3B0IHxrd2NcXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFxcLyhrfGx8dSl8NTB8NTR8XFwtW2Etd10pfGxpYnd8bHlueHxtMVxcLXd8bTNnYXxtNTBcXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXFwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFxcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblxcLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFxcLWd8cWFcXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFxcLVsyLTddfGlcXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XFwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXFwtfG9vfHBcXC0pfHNka1xcL3xzZShjKFxcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcXC18c2hhcnxzaWUoXFwtfG0pfHNrXFwtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXFwtfHZcXC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcXC18dGRnXFwtfHRlbChpfG0pfHRpbVxcLXx0XFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cXC18bTN8bTUpfHR4XFwtOXx1cChcXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcXC18eW91cnx6ZXRvfHp0ZVxcLS9pLnRlc3QodWEuc3Vic3RyKDAsIDQpKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8gRGF0YSBIYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vYmxvY2sgdGFibGUgcmVkcmF3aW5nXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5ibG9ja1JlZHJhdyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuYmxvY2tSZWRyYXcoKTtcblx0fTtcblxuXHQvL3Jlc3RvcmUgdGFibGUgcmVkcmF3aW5nXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZXN0b3JlUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMucm93TWFuYWdlci5yZXN0b3JlUmVkcmF3KCk7XG5cdH07XG5cblx0Ly9sb2NhbCBkYXRhIGZyb20gbG9jYWwgZmlsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0RGF0YUZyb21Mb2NhbEZpbGUgPSBmdW5jdGlvbiAoZXh0ZW5zaW9ucykge1xuXHRcdHZhciBfdGhpczE3ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuXG5cdFx0XHRpbnB1dC5hY2NlcHQgPSBleHRlbnNpb25zIHx8IFwiLmpzb24sYXBwbGljYXRpb24vanNvblwiO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0dmFyIGZpbGUgPSBpbnB1dC5maWxlc1swXSxcblx0XHRcdFx0ICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCksXG5cdFx0XHRcdCAgICBkYXRhO1xuXG5cdFx0XHRcdHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xuXG5cdFx0XHRcdHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0dHJ5IHtcblxuXHRcdFx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UocmVhZGVyLnJlc3VsdCk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZSkge1xuXG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWxlIExvYWQgRXJyb3IgLSBGaWxlIGNvbnRlbnRzIGlzIGludmFsaWQgSlNPTlwiLCBlKTtcblxuXHRcdFx0XHRcdFx0cmVqZWN0KGUpO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X3RoaXMxNy5fc2V0RGF0YShkYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cblx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0XHRyZXNvbHZlKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0cmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsZSBMb2FkIEVycm9yIC0gVW5hYmxlIHRvIHJlYWQgZmlsZVwiKTtcblxuXHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmNsaWNrKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9sb2FkIGRhdGFcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zLCBjb25maWcpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImFqYXhcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX3NldERhdGEoZGF0YSwgcGFyYW1zLCBjb25maWcsIGZhbHNlLCB0cnVlKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLl9zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHBhcmFtcywgY29uZmlnLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdGlmIChkYXRhLmluZGV4T2YoXCJ7XCIpID09IDAgfHwgZGF0YS5pbmRleE9mKFwiW1wiKSA9PSAwKSB7XG5cblx0XHRcdFx0Ly9kYXRhIGlzIGEganNvbiBlbmNvZGVkIHN0cmluZ1xuXG5cdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShKU09OLnBhcnNlKGRhdGEpLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChzZWxmLm1vZEV4aXN0cyhcImFqYXhcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRcdGlmIChwYXJhbXMpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5tb2R1bGVzLmFqYXguc2V0UGFyYW1zKHBhcmFtcyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKGNvbmZpZykge1xuXG5cdFx0XHRcdFx0XHRzZWxmLm1vZHVsZXMuYWpheC5zZXRDb25maWcoY29uZmlnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLm1vZHVsZXMuYWpheC5zZXRVcmwoZGF0YSk7XG5cblx0XHRcdFx0XHRpZiAoc2VsZi5vcHRpb25zLnBhZ2luYXRpb24gPT0gXCJyZW1vdGVcIiAmJiBzZWxmLm1vZEV4aXN0cyhcInBhZ2VcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5tb2R1bGVzLnBhZ2UucmVzZXQodHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRcdHJldHVybiBzZWxmLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdC8vYXNzdW1lIGRhdGEgaXMgdXJsLCBtYWtlIGFqYXggY2FsbCB0byB1cmwgdG8gZ2V0IGRhdGFcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdC8vYXN1bWUgZGF0YSBpcyBhbHJlYWR5IGFuIG9iamVjdFxuXG5cdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLCBpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vbm8gZGF0YSBwcm92aWRlZCwgY2hlY2sgaWYgYWpheFVSTCBpcyBwcmVzZW50O1xuXG5cdFx0XHRcdGlmIChzZWxmLm1vZEV4aXN0cyhcImFqYXhcIikgJiYgKHNlbGYubW9kdWxlcy5hamF4LmdldFVybCB8fCBzZWxmLm9wdGlvbnMuYWpheFVSTEdlbmVyYXRvcikpIHtcblxuXHRcdFx0XHRcdGlmIChzZWxmLm9wdGlvbnMucGFnaW5hdGlvbiA9PSBcInJlbW90ZVwiICYmIHNlbGYubW9kRXhpc3RzKFwicGFnZVwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdFx0XHRzZWxmLm1vZHVsZXMucGFnZS5yZXNldCh0cnVlLCB0cnVlKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5wYWdlLnNldFBhZ2UoMSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYubW9kdWxlcy5hamF4LmxvYWREYXRhKGluUG9zaXRpb24sIGNvbHVtbnNDaGFuZ2VkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHQvL2VtcHR5IGRhdGFcblxuXHRcdFx0XHRcdHJldHVybiBzZWxmLnJvd01hbmFnZXIuc2V0RGF0YShbXSwgaW5Qb3NpdGlvbiwgY29sdW1uc0NoYW5nZWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xlYXIgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuY2xlYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHR9XG5cblx0XHR0aGlzLnJvd01hbmFnZXIuY2xlYXJEYXRhKCk7XG5cdH07XG5cblx0Ly9nZXQgdGFibGUgZGF0YSBhcnJheVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdGlmIChhY3RpdmUgPT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicGFzc2luZyBhIGJvb2xlYW4gdG8gdGhlIGdldERhdGEgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZCwgeW91IHNob3VsZCBub3cgcGFzcyB0aGUgc3RyaW5nICdhY3RpdmUnXCIpO1xuXG5cdFx0XHRhY3RpdmUgPSBcImFjdGl2ZVwiO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0RGF0YShhY3RpdmUpO1xuXHR9O1xuXG5cdC8vZ2V0IHRhYmxlIGRhdGEgYXJyYXkgY291bnRcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldERhdGFDb3VudCA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblxuXHRcdGlmIChhY3RpdmUgPT09IHRydWUpIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwicGFzc2luZyBhIGJvb2xlYW4gdG8gdGhlIGdldERhdGFDb3VudCBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyBwYXNzIHRoZSBzdHJpbmcgJ2FjdGl2ZSdcIik7XG5cblx0XHRcdGFjdGl2ZSA9IFwiYWN0aXZlXCI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMucm93TWFuYWdlci5nZXREYXRhQ291bnQoYWN0aXZlKTtcblx0fTtcblxuXHQvL3NlYXJjaCBmb3Igc3BlY2lmaWMgcm93IGNvbXBvbmVudHNcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNlYXJjaFJvd3MgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5maWx0ZXIuc2VhcmNoKFwicm93c1wiLCBmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXHRcdH1cblx0fTtcblxuXHQvL3NlYXJjaCBmb3Igc3BlY2lmaWMgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2VhcmNoRGF0YSA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmZpbHRlci5zZWFyY2goXCJkYXRhXCIsIGZpZWxkLCB0eXBlLCB2YWx1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IHRhYmxlIGh0bWxcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEh0bWwgPSBmdW5jdGlvbiAodmlzaWJsZSwgc3R5bGUsIGNvbmZpZykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZXhwb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZXhwb3J0LmdldEh0bWwodmlzaWJsZSwgc3R5bGUsIGNvbmZpZyk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2V0IHByaW50IGh0bWxcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24gKHZpc2libGUsIHN0eWxlLCBjb25maWcpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInByaW50XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucHJpbnQucHJpbnRGdWxsc2NyZWVuKHZpc2libGUsIHN0eWxlLCBjb25maWcpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHJpZXZlIEFqYXggVVJMXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRBamF4VXJsID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmFqYXguZ2V0VXJsKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmVwbGFjZSBkYXRhLCBrZWVwaW5nIHRhYmxlIGluIHBvc2l0aW9uIHdpdGggc2FtZSBzb3J0XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZXBsYWNlRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCBwYXJhbXMsIGNvbmZpZykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiYWpheFwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fc2V0RGF0YShkYXRhLCBwYXJhbXMsIGNvbmZpZywgdHJ1ZSk7XG5cdH07XG5cblx0Ly91cGRhdGUgdGFibGUgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIF90aGlzMTggPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIHJlc3BvbnNlcyA9IDA7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAoX3RoaXMxOC5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0X3RoaXMxOC5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXG5cdFx0XHRcdFx0dmFyIHJvdyA9IHNlbGYucm93TWFuYWdlci5maW5kUm93KGl0ZW1bc2VsZi5vcHRpb25zLmluZGV4XSk7XG5cblx0XHRcdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0XHRyZXNwb25zZXMtLTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5hZGREYXRhID0gZnVuY3Rpb24gKGRhdGEsIHBvcywgaW5kZXgpIHtcblx0XHR2YXIgX3RoaXMxOSA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRpZiAoX3RoaXMxOS5tb2RFeGlzdHMoXCJhamF4XCIpKSB7XG5cblx0XHRcdFx0X3RoaXMxOS5tb2R1bGVzLmFqYXguYmxvY2tBY3RpdmVSZXF1ZXN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGF0YSkge1xuXG5cdFx0XHRcdF90aGlzMTkucm93TWFuYWdlci5hZGRSb3dzKGRhdGEsIHBvcywgaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0XHRcdG91dHB1dC5wdXNoKHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZXNvbHZlKG91dHB1dCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXG5cdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly91cGRhdGUgdGFibGUgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlT3JBZGREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcblx0XHR2YXIgX3RoaXMyMCA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd3MgPSBbXSxcblx0XHQgICAgcmVzcG9uc2VzID0gMDtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmIChfdGhpczIwLm1vZEV4aXN0cyhcImFqYXhcIikpIHtcblxuXHRcdFx0XHRfdGhpczIwLm1vZHVsZXMuYWpheC5ibG9ja0FjdGl2ZVJlcXVlc3QoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChkYXRhKSB7XG5cblx0XHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0XHR2YXIgcm93ID0gc2VsZi5yb3dNYW5hZ2VyLmZpbmRSb3coaXRlbVtzZWxmLm9wdGlvbnMuaW5kZXhdKTtcblxuXHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXG5cdFx0XHRcdFx0aWYgKHJvdykge1xuXG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdFx0XHRyZXNwb25zZXMtLTtcblxuXHRcdFx0XHRcdFx0XHRyb3dzLnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0c2VsZi5yb3dNYW5hZ2VyLmFkZFJvd3MoaXRlbSkudGhlbihmdW5jdGlvbiAobmV3Um93cykge1xuXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlcy0tO1xuXG5cdFx0XHRcdFx0XHRcdHJvd3MucHVzaChuZXdSb3dzWzBdLmdldENvbXBvbmVudCgpKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlc3BvbnNlcykge1xuXG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiVXBkYXRlIEVycm9yIC0gTm8gZGF0YSBwcm92aWRlZFwiKTtcblxuXHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vZ2V0IHJvdyBvYmplY3RcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvdyA9IGZ1bmN0aW9uIChpbmRleCkge1xuXG5cdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblxuXHRcdGlmIChyb3cpIHtcblxuXHRcdFx0cmV0dXJuIHJvdy5nZXRDb21wb25lbnQoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJGaW5kIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9nZXQgcm93IG9iamVjdFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0Um93RnJvbVBvc2l0aW9uID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBhY3RpdmUpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZ2V0Um93RnJvbVBvc2l0aW9uKHBvc2l0aW9uLCBhY3RpdmUpO1xuXG5cdFx0aWYgKHJvdykge1xuXG5cdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkZpbmQgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIHBvc2l0aW9uKTtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvL2RlbGV0ZSByb3cgZnJvbSB0YWJsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZGVsZXRlUm93ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dmFyIF90aGlzMjEgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSBfdGhpczIxLFxuXHRcdFx0ICAgIGNvdW50ID0gMCxcblx0XHRcdCAgICBzdWNjZXNzQ291bnQgPSAwLFxuXHRcdFx0ICAgIGZvdW5kUm93cyA9IFtdO1xuXG5cdFx0XHRmdW5jdGlvbiBkb25lQ2hlY2soKSB7XG5cblx0XHRcdFx0Y291bnQrKztcblxuXHRcdFx0XHRpZiAoY291bnQgPT0gaW5kZXgubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRpZiAoc3VjY2Vzc0NvdW50KSB7XG5cblx0XHRcdFx0XHRcdHNlbGYucm93TWFuYWdlci5yZVJlbmRlckluUG9zaXRpb24oKTtcblxuXHRcdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkoaW5kZXgpKSB7XG5cblx0XHRcdFx0aW5kZXggPSBbaW5kZXhdO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpbmQgbWF0Y2hpbmcgcm93c1xuXG5cdFx0XHRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0dmFyIHJvdyA9IF90aGlzMjEucm93TWFuYWdlci5maW5kUm93KGl0ZW0sIHRydWUpO1xuXG5cdFx0XHRcdGlmIChyb3cpIHtcblxuXHRcdFx0XHRcdGZvdW5kUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJEZWxldGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGl0ZW0pO1xuXG5cdFx0XHRcdFx0cmVqZWN0KFwiRGVsZXRlIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kXCIpO1xuXG5cdFx0XHRcdFx0ZG9uZUNoZWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvL3NvcnQgcm93cyBpbnRvIGNvcnJlY3Qgb3JkZXIgdG8gZW5zdXJlIHNtb290aCBkZWxldGUgZnJvbSB0YWJsZVxuXG5cdFx0XHRmb3VuZFJvd3Muc29ydChmdW5jdGlvbiAoYSwgYikge1xuXG5cdFx0XHRcdHJldHVybiBfdGhpczIxLnJvd01hbmFnZXIucm93cy5pbmRleE9mKGEpID4gX3RoaXMyMS5yb3dNYW5hZ2VyLnJvd3MuaW5kZXhPZihiKSA/IDEgOiAtMTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmb3VuZFJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cblx0XHRcdFx0cm93LmRlbGV0ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0c3VjY2Vzc0NvdW50Kys7XG5cblx0XHRcdFx0XHRkb25lQ2hlY2soKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0ZG9uZUNoZWNrKCk7XG5cblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHQvL2FkZCByb3cgdG8gdGFibGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmFkZFJvdyA9IGZ1bmN0aW9uIChkYXRhLCBwb3MsIGluZGV4KSB7XG5cdFx0dmFyIF90aGlzMjIgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdF90aGlzMjIucm93TWFuYWdlci5hZGRSb3dzKGRhdGEsIHBvcywgaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJvd3MpIHtcblxuXHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRpZiAoX3RoaXMyMi5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXG5cdFx0XHRcdFx0X3RoaXMyMi5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsYyhfdGhpczIyLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXNvbHZlKHJvd3NbMF0uZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH07XG5cblx0Ly91cGRhdGUgYSByb3cgaWYgaXQgZXhpdHN0cyBvdGhlcndpc2UgY3JlYXRlIGl0XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS51cGRhdGVPckFkZFJvdyA9IGZ1bmN0aW9uIChpbmRleCwgZGF0YSkge1xuXHRcdHZhciBfdGhpczIzID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciByb3cgPSBfdGhpczIzLnJvd01hbmFnZXIuZmluZFJvdyhpbmRleCk7XG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0cm93LnVwZGF0ZURhdGEoZGF0YSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRcdGlmIChfdGhpczIzLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRcdF90aGlzMjMubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMyMy5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRyb3cgPSBfdGhpczIzLnJvd01hbmFnZXIuYWRkUm93cyhkYXRhKS50aGVuKGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRcdFx0XHQvL3JlY2FsYyBjb2x1bW4gY2FsY3VsYXRpb25zIGlmIHByZXNlbnRcblxuXHRcdFx0XHRcdGlmIChfdGhpczIzLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRcdF90aGlzMjMubW9kdWxlcy5jb2x1bW5DYWxjcy5yZWNhbGMoX3RoaXMyMy5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUocm93c1swXS5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL3VwZGF0ZSByb3cgZGF0YVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlUm93ID0gZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7XG5cdFx0dmFyIF90aGlzMjQgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0dmFyIHJvdyA9IF90aGlzMjQucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblxuXHRcdFx0aWYgKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKSB7XG5cblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyb3cpIHtcblxuXHRcdFx0XHRyb3cudXBkYXRlRGF0YShkYXRhKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdHJlc29sdmUocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGluZGV4KTtcblxuXHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9zY3JvbGwgdG8gcm93IGluIERPTVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2Nyb2xsVG9Sb3cgPSBmdW5jdGlvbiAoaW5kZXgsIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXMyNSA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgcm93ID0gX3RoaXMyNS5yb3dNYW5hZ2VyLmZpbmRSb3coaW5kZXgpO1xuXG5cdFx0XHRpZiAocm93KSB7XG5cblx0XHRcdFx0X3RoaXMyNS5yb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHJvdywgcG9zaXRpb24sIGlmVmlzaWJsZSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubW92ZVJvdyA9IGZ1bmN0aW9uIChmcm9tLCB0bywgYWZ0ZXIpIHtcblxuXHRcdHZhciBmcm9tUm93ID0gdGhpcy5yb3dNYW5hZ2VyLmZpbmRSb3coZnJvbSk7XG5cblx0XHRpZiAoZnJvbVJvdykge1xuXG5cdFx0XHRmcm9tUm93Lm1vdmVUb1Jvdyh0bywgYWZ0ZXIpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGZyb20pO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAoYWN0aXZlKSB7XG5cblx0XHRpZiAoYWN0aXZlID09PSB0cnVlKSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInBhc3NpbmcgYSBib29sZWFuIHRvIHRoZSBnZXRSb3dzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgbm93IHBhc3MgdGhlIHN0cmluZyAnYWN0aXZlJ1wiKTtcblxuXHRcdFx0YWN0aXZlID0gXCJhY3RpdmVcIjtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5yb3dNYW5hZ2VyLmdldENvbXBvbmVudHMoYWN0aXZlKTtcblx0fTtcblxuXHQvL2dldCBwb3NpdGlvbiBvZiByb3cgaW4gdGFibGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFJvd1Bvc2l0aW9uID0gZnVuY3Rpb24gKGluZGV4LCBhY3RpdmUpIHtcblxuXHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZmluZFJvdyhpbmRleCk7XG5cblx0XHRpZiAocm93KSB7XG5cblx0XHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0Um93UG9zaXRpb24ocm93LCBhY3RpdmUpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIlBvc2l0aW9uIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9jb3B5IHRhYmxlIGRhdGEgdG8gY2xpcGJvYXJkXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jb3B5VG9DbGlwYm9hcmQgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImNsaXBib2FyZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuY2xpcGJvYXJkLmNvcHkoc2VsZWN0b3IpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gQ29sdW1uIEZ1bmN0aW9ucyAgLy8vLy8vLy8vLy8vLy8vXG5cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldENvbHVtbnMgPSBmdW5jdGlvbiAoZGVmaW5pdGlvbikge1xuXG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLnNldENvbHVtbnMoZGVmaW5pdGlvbik7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDb2x1bW5zID0gZnVuY3Rpb24gKHN0cnVjdHVyZWQpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0Q29tcG9uZW50cyhzdHJ1Y3R1cmVkKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldENvbHVtbiA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXG5cdFx0dmFyIGNvbCA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblxuXHRcdGlmIChjb2wpIHtcblxuXHRcdFx0cmV0dXJuIGNvbC5nZXRDb21wb25lbnQoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJGaW5kIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDb2x1bW5EZWZpbml0aW9ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0RGVmaW5pdGlvblRyZWUoKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldENvbHVtbkxheW91dCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2UucGFyc2VDb2x1bW5zKHRoaXMuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5zKCkpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldENvbHVtbkxheW91dCA9IGZ1bmN0aW9uIChsYXlvdXQpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKHRoaXMubW9kdWxlcy5wZXJzaXN0ZW5jZS5tZXJnZURlZmluaXRpb24odGhpcy5vcHRpb25zLmNvbHVtbnMsIGxheW91dCkpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zaG93Q29sdW1uID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0aWYgKGNvbHVtbikge1xuXG5cdFx0XHRjb2x1bW4uc2hvdygpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIFNob3cgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmhpZGVDb2x1bW4gPSBmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdHZhciBjb2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdGNvbHVtbi5oaWRlKCk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC51cGRhdGUoKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gSGlkZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudG9nZ2xlQ29sdW1uID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0aWYgKGNvbHVtbikge1xuXG5cdFx0XHRpZiAoY29sdW1uLnZpc2libGUpIHtcblxuXHRcdFx0XHRjb2x1bW4uaGlkZSgpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb2x1bW4uc2hvdygpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBWaXNpYmlsaXR5IFRvZ2dsZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuYWRkQ29sdW1uID0gZnVuY3Rpb24gKGRlZmluaXRpb24sIGJlZm9yZSwgZmllbGQpIHtcblx0XHR2YXIgX3RoaXMyNiA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gX3RoaXMyNi5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRfdGhpczI2LmNvbHVtbk1hbmFnZXIuYWRkQ29sdW1uKGRlZmluaXRpb24sIGJlZm9yZSwgY29sdW1uKS50aGVuKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRyZXNvbHZlKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmRlbGV0ZUNvbHVtbiA9IGZ1bmN0aW9uIChmaWVsZCkge1xuXHRcdHZhciBfdGhpczI3ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSBfdGhpczI3LmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4uZGVsZXRlKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIERlbGV0ZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudXBkYXRlQ29sdW1uRGVmaW5pdGlvbiA9IGZ1bmN0aW9uIChmaWVsZCwgZGVmaW5pdGlvbikge1xuXHRcdHZhciBfdGhpczI4ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciBjb2x1bW4gPSBfdGhpczI4LmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4udXBkYXRlRGVmaW5pdGlvbihkZWZpbml0aW9uKS50aGVuKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRcdHJlc29sdmUoY29sKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGZyb20sIHRvLCBhZnRlcikge1xuXG5cdFx0dmFyIGZyb21Db2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmcm9tKTtcblxuXHRcdHZhciB0b0NvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblxuXHRcdGlmIChmcm9tQ29sdW1uKSB7XG5cblx0XHRcdGlmICh0b0NvbHVtbikge1xuXG5cdFx0XHRcdHRoaXMuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uKGZyb21Db2x1bW4sIHRvQ29sdW1uLCBhZnRlcik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIHRvQ29sdW1uKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmcm9tKTtcblx0XHR9XG5cdH07XG5cblx0Ly9zY3JvbGwgdG8gY29sdW1uIGluIERPTVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2Nyb2xsVG9Db2x1bW4gPSBmdW5jdGlvbiAoZmllbGQsIHBvc2l0aW9uLCBpZlZpc2libGUpIHtcblx0XHR2YXIgX3RoaXMyOSA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gX3RoaXMyOS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdFx0X3RoaXMyOS5jb2x1bW5NYW5hZ2VyLnNjcm9sbFRvQ29sdW1uKGNvbHVtbiwgcG9zaXRpb24sIGlmVmlzaWJsZSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLyBMb2NhbGl6YXRpb24gRnVuY3Rpb25zICAvLy8vLy8vLy8vLy9cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldExvY2FsZSA9IGZ1bmN0aW9uIChsb2NhbGUpIHtcblxuXHRcdHRoaXMubW9kdWxlcy5sb2NhbGl6ZS5zZXRMb2NhbGUobG9jYWxlKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldExvY2FsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLm1vZHVsZXMubG9jYWxpemUuZ2V0TG9jYWxlKCk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRMYW5nID0gZnVuY3Rpb24gKGxvY2FsZSkge1xuXG5cdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5sb2NhbGl6ZS5nZXRMYW5nKGxvY2FsZSk7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vIEdlbmVyYWwgUHVibGljIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy9cblxuXG5cdC8vcmVkcmF3IGxpc3Qgd2l0aG91dCB1cGRhdGluZyBkYXRhXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoZm9yY2UpIHtcblxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5yZWRyYXcoZm9yY2UpO1xuXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZHJhdyhmb3JjZSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRIZWlnaHQgPSBmdW5jdGlvbiAoaGVpZ2h0KSB7XG5cblx0XHRpZiAodGhpcy5yb3dNYW5hZ2VyLnJlbmRlck1vZGUgIT09IFwiY2xhc3NpY1wiKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5oZWlnaHQgPSBpc05hTihoZWlnaHQpID8gaGVpZ2h0IDogaGVpZ2h0ICsgXCJweFwiO1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5vcHRpb25zLmhlaWdodDtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnNldFJlbmRlck1vZGUoKTtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZHJhdygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcInNldEhlaWdodCBmdW5jdGlvbiBpcyBub3QgYXZhaWxhYmxlIGluIGNsYXNzaWMgcmVuZGVyIG1vZGVcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBTb3J0aW5nIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL3RyaWdnZXIgc29ydFxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0U29ydCA9IGZ1bmN0aW9uIChzb3J0TGlzdCwgZGlyKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zb3J0LnNldFNvcnQoc29ydExpc3QsIGRpcik7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5zb3J0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0U29ydGVycyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNvcnRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5zb3J0LmdldFNvcnQoKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5jbGVhclNvcnQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzb3J0XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zb3J0LmNsZWFyKCk7XG5cblx0XHRcdHRoaXMucm93TWFuYWdlci5zb3J0ZXJSZWZyZXNoKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLyBGaWx0ZXJpbmcgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cdC8vc2V0IHN0YW5kYXJkIGZpbHRlcnNcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldEZpbHRlciA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLnNldEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXG5cdFx0XHR0aGlzLnJvd01hbmFnZXIuZmlsdGVyUmVmcmVzaCgpO1xuXHRcdH1cblx0fTtcblxuXHQvL2FkZCBmaWx0ZXIgdG8gYXJyYXlcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmFkZEZpbHRlciA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLmFkZEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXG5cdFx0XHR0aGlzLnJvd01hbmFnZXIuZmlsdGVyUmVmcmVzaCgpO1xuXHRcdH1cblx0fTtcblxuXHQvL2dldCBhbGwgZmlsdGVyc1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0RmlsdGVycyA9IGZ1bmN0aW9uIChhbGwpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmZpbHRlci5nZXRGaWx0ZXJzKGFsbCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0SGVhZGVyRmlsdGVyRm9jdXMgPSBmdW5jdGlvbiAoZmllbGQpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdFx0dGhpcy5tb2R1bGVzLmZpbHRlci5zZXRIZWFkZXJGaWx0ZXJGb2N1cyhjb2x1bW4pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEZvY3VzIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldEhlYWRlckZpbHRlclZhbHVlID0gZnVuY3Rpb24gKGZpZWxkKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblxuXHRcdFx0aWYgKGNvbHVtbikge1xuXG5cdFx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZmlsdGVyLmdldEhlYWRlckZpbHRlclZhbHVlKGNvbHVtbik7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJWYWx1ZSA9IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0XHRpZiAoY29sdW1uKSB7XG5cblx0XHRcdFx0dGhpcy5tb2R1bGVzLmZpbHRlci5zZXRIZWFkZXJGaWx0ZXJWYWx1ZShjb2x1bW4sIHZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRIZWFkZXJGaWx0ZXJzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZmlsdGVyLmdldEhlYWRlckZpbHRlcnMoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9yZW1vdmUgZmlsdGVyIGZyb20gYXJyYXlcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlbW92ZUZpbHRlciA9IGZ1bmN0aW9uIChmaWVsZCwgdHlwZSwgdmFsdWUpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImZpbHRlclwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZmlsdGVyLnJlbW92ZUZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXG5cdFx0XHR0aGlzLnJvd01hbmFnZXIuZmlsdGVyUmVmcmVzaCgpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIGZpbHRlcnNcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmNsZWFyRmlsdGVyID0gZnVuY3Rpb24gKGFsbCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZmlsdGVyXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5maWx0ZXIuY2xlYXJGaWx0ZXIoYWxsKTtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLmZpbHRlclJlZnJlc2goKTtcblx0XHR9XG5cdH07XG5cblx0Ly9jbGVhciBoZWFkZXIgZmlsdGVyc1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuY2xlYXJIZWFkZXJGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJmaWx0ZXJcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmZpbHRlci5jbGVhckhlYWRlckZpbHRlcigpO1xuXG5cdFx0XHR0aGlzLnJvd01hbmFnZXIuZmlsdGVyUmVmcmVzaCgpO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8gRmlsdGVyaW5nIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZWxlY3RSb3cgPSBmdW5jdGlvbiAocm93cykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwic2VsZWN0Um93XCIsIHRydWUpKSB7XG5cblx0XHRcdGlmIChyb3dzID09PSB0cnVlKSB7XG5cblx0XHRcdFx0Y29uc29sZS53YXJuKFwicGFzc2luZyBhIGJvb2xlYW4gdG8gdGhlIHNlbGVjdFJvd3NlbGVjdFJvdyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLCB5b3Ugc2hvdWxkIG5vdyBwYXNzIHRoZSBzdHJpbmcgJ2FjdGl2ZSdcIik7XG5cblx0XHRcdFx0cm93cyA9IFwiYWN0aXZlXCI7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zZWxlY3RSb3cuc2VsZWN0Um93cyhyb3dzKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kZXNlbGVjdFJvdyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJzZWxlY3RSb3dcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnNlbGVjdFJvdy5kZXNlbGVjdFJvd3Mocm93cyk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUudG9nZ2xlU2VsZWN0Um93ID0gZnVuY3Rpb24gKHJvdykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwic2VsZWN0Um93XCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5zZWxlY3RSb3cudG9nZ2xlUm93KHJvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0U2VsZWN0ZWRSb3dzID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwic2VsZWN0Um93XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuc2VsZWN0Um93LmdldFNlbGVjdGVkUm93cygpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmdldFNlbGVjdGVkRGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLnNlbGVjdFJvdy5nZXRTZWxlY3RlZERhdGEoKTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vIFBhZ2luYXRpb24gRnVuY3Rpb25zICAvLy8vLy8vLy8vLy9cblxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuc2V0TWF4UGFnZSA9IGZ1bmN0aW9uIChtYXgpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnBhZ2Uuc2V0TWF4UGFnZShtYXgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2UpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5wYWdlLnNldFBhZ2UocGFnZSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRQYWdlVG9Sb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIF90aGlzMzAgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0aWYgKF90aGlzMzAub3B0aW9ucy5wYWdpbmF0aW9uICYmIF90aGlzMzAubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRcdHJvdyA9IF90aGlzMzAucm93TWFuYWdlci5maW5kUm93KHJvdyk7XG5cblx0XHRcdFx0aWYgKHJvdykge1xuXG5cdFx0XHRcdFx0X3RoaXMzMC5tb2R1bGVzLnBhZ2Uuc2V0UGFnZVRvUm93KHJvdykudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRQYWdlU2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy5tb2RFeGlzdHMoXCJwYWdlXCIpKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5wYWdlLnNldFBhZ2VTaXplKHNpemUpO1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMucGFnZS5zZXRQYWdlKDEpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0UGFnZVNpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLnBhZ2luYXRpb24gJiYgdGhpcy5tb2RFeGlzdHMoXCJwYWdlXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMucGFnZS5nZXRQYWdlU2l6ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnByZXZpb3VzUGFnZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFnaW5hdGlvbiAmJiB0aGlzLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblxuXHRcdFx0dGhpcy5tb2R1bGVzLnBhZ2UucHJldmlvdXNQYWdlKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm5leHRQYWdlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMucGFnZS5uZXh0UGFnZSgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRQYWdlID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLnBhZ2UuZ2V0UGFnZSgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRQYWdlTWF4ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYWdpbmF0aW9uICYmIHRoaXMubW9kRXhpc3RzKFwicGFnZVwiKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLnBhZ2UuZ2V0UGFnZU1heCgpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8gR3JvdXBpbmcgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vL1xuXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRHcm91cEJ5ID0gZnVuY3Rpb24gKGdyb3Vwcykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5ncm91cEJ5ID0gZ3JvdXBzO1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZ3JvdXBSb3dzLmluaXRpYWxpemUoKTtcblxuXHRcdFx0dGhpcy5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwiZGlzcGxheVwiKTtcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuZ3JvdXApIHtcblxuXHRcdFx0XHR0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImdyb3VwXCIpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5zZXRHcm91cFN0YXJ0T3BlbiA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm9wdGlvbnMuZ3JvdXBTdGFydE9wZW4gPSB2YWx1ZXM7XG5cblx0XHRcdHRoaXMubW9kdWxlcy5ncm91cFJvd3MuaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmdyb3VwQnkpIHtcblxuXHRcdFx0XHR0aGlzLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJncm91cFwiKTtcblxuXHRcdFx0XHRpZiAodGhpcy5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5ncm91cCkge1xuXG5cdFx0XHRcdFx0dGhpcy5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJncm91cFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJHcm91cGluZyBVcGRhdGUgLSBjYW50IHJlZnJlc2ggdmlldywgbm8gZ3JvdXBzIGhhdmUgYmVlbiBzZXRcIik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnNldEdyb3VwSGVhZGVyID0gZnVuY3Rpb24gKHZhbHVlcykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHRoaXMub3B0aW9ucy5ncm91cEhlYWRlciA9IHZhbHVlcztcblxuXHRcdFx0dGhpcy5tb2R1bGVzLmdyb3VwUm93cy5pbml0aWFsaXplKCk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuZ3JvdXBCeSkge1xuXG5cdFx0XHRcdHRoaXMucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImdyb3VwXCIpO1xuXG5cdFx0XHRcdGlmICh0aGlzLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmdyb3VwKSB7XG5cblx0XHRcdFx0XHR0aGlzLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImdyb3VwXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkdyb3VwaW5nIFVwZGF0ZSAtIGNhbnQgcmVmcmVzaCB2aWV3LCBubyBncm91cHMgaGF2ZSBiZWVuIHNldFwiKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0R3JvdXBzID0gZnVuY3Rpb24gKHZhbHVlcykge1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZ3JvdXBSb3dzLmdldEdyb3Vwcyh0cnVlKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIGdldCBncm91cGVkIHRhYmxlIGRhdGEgaW4gdGhlIHNhbWUgZm9ybWF0IGFzIGdldERhdGEoKVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0R3JvdXBlZERhdGEgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJncm91cFJvd3NcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9ucy5ncm91cEJ5ID8gdGhpcy5tb2R1bGVzLmdyb3VwUm93cy5nZXRHcm91cGVkRGF0YSgpIDogdGhpcy5nZXREYXRhKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vIENvbHVtbiBDYWxjdWxhdGlvbiBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRDYWxjUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2V0UmVzdWx0cygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWNhbGMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjQWxsKHRoaXMucm93TWFuYWdlci5hY3RpdmVSb3dzKTtcblx0XHR9XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vIE5hdmlnYXRpb24gTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vL1xuXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5uYXZpZ2F0ZVByZXYgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMubW9kRXhpc3RzKFwiZWRpdFwiLCB0cnVlKSkge1xuXG5cdFx0XHRjZWxsID0gdGhpcy5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdGlmIChjZWxsKSB7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkucHJldigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm5hdmlnYXRlTmV4dCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS5uZXh0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubmF2aWdhdGVMZWZ0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0Y2VsbCA9IHRoaXMubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS5sZWZ0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubmF2aWdhdGVSaWdodCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkucmlnaHQoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5uYXZpZ2F0ZVVwID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdGlmICh0aGlzLm1vZEV4aXN0cyhcImVkaXRcIiwgdHJ1ZSkpIHtcblxuXHRcdFx0Y2VsbCA9IHRoaXMubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRyZXR1cm4gY2VsbC5uYXYoKS51cCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm5hdmlnYXRlRG93biA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBjZWxsID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJlZGl0XCIsIHRydWUpKSB7XG5cblx0XHRcdGNlbGwgPSB0aGlzLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0cmV0dXJuIGNlbGwubmF2KCkuZG93bigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gSGlzdG9yeSBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkudW5kbygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWRvID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkucmVkbygpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5nZXRIaXN0b3J5VW5kb1NpemUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy5tb2RFeGlzdHMoXCJoaXN0b3J5XCIsIHRydWUpKSB7XG5cblx0XHRcdHJldHVybiB0aGlzLm1vZHVsZXMuaGlzdG9yeS5nZXRIaXN0b3J5VW5kb1NpemUoKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZ2V0SGlzdG9yeVJlZG9TaXplID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMubW9kRXhpc3RzKFwiaGlzdG9yeVwiLCB0cnVlKSkge1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5tb2R1bGVzLmhpc3RvcnkuZ2V0SGlzdG9yeVJlZG9TaXplKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8gRG93bmxvYWQgTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vL1xuXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5kb3dubG9hZCA9IGZ1bmN0aW9uICh0eXBlLCBmaWxlbmFtZSwgb3B0aW9ucywgYWN0aXZlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJkb3dubG9hZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZG93bmxvYWQuZG93bmxvYWQodHlwZSwgZmlsZW5hbWUsIG9wdGlvbnMsIGFjdGl2ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuZG93bmxvYWRUb1RhYiA9IGZ1bmN0aW9uICh0eXBlLCBmaWxlbmFtZSwgb3B0aW9ucywgYWN0aXZlKSB7XG5cblx0XHRpZiAodGhpcy5tb2RFeGlzdHMoXCJkb3dubG9hZFwiLCB0cnVlKSkge1xuXG5cdFx0XHR0aGlzLm1vZHVsZXMuZG93bmxvYWQuZG93bmxvYWQodHlwZSwgZmlsZW5hbWUsIG9wdGlvbnMsIGFjdGl2ZSwgdHJ1ZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vLy8vLy8vLy8vIEludGVyIFRhYmxlIENvbW11bmljYXRpb25zIC8vLy8vLy8vLy8vXG5cblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnRhYmxlQ29tbXMgPSBmdW5jdGlvbiAodGFibGUsIG1vZHVsZSwgYWN0aW9uLCBkYXRhKSB7XG5cblx0XHR0aGlzLm1vZHVsZXMuY29tbXMucmVjZWl2ZSh0YWJsZSwgbW9kdWxlLCBhY3Rpb24sIGRhdGEpO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vIEV4dGVuc2lvbiBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vXG5cblxuXHQvL29iamVjdCB0byBob2xkIG1vZHVsZVxuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUubW9kdWxlQmluZGluZ3MgPSB7fTtcblxuXHQvL2V4dGVuZCBtb2R1bGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmV4dGVuZE1vZHVsZSA9IGZ1bmN0aW9uIChuYW1lLCBwcm9wZXJ0eSwgdmFsdWVzKSB7XG5cblx0XHRpZiAoVGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXSkge1xuXG5cdFx0XHR2YXIgc291cmNlID0gVGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXS5wcm90b3R5cGVbcHJvcGVydHldO1xuXG5cdFx0XHRpZiAoc291cmNlKSB7XG5cblx0XHRcdFx0aWYgKCh0eXBlb2YgdmFsdWVzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZXMpKSA9PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gdmFsdWVzKSB7XG5cblx0XHRcdFx0XHRcdHNvdXJjZVtrZXldID0gdmFsdWVzW2tleV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTW9kdWxlIEVycm9yIC0gSW52YWxpZCB2YWx1ZSB0eXBlLCBpdCBtdXN0IGJlIGFuIG9iamVjdFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJNb2R1bGUgRXJyb3IgLSBwcm9wZXJ0eSBkb2VzIG5vdCBleGlzdDpcIiwgcHJvcGVydHkpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGNvbnNvbGUud2FybihcIk1vZHVsZSBFcnJvciAtIG1vZHVsZSBkb2VzIG5vdCBleGlzdDpcIiwgbmFtZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vYWRkIG1vZHVsZSB0byB0YWJ1bGF0b3JcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlID0gZnVuY3Rpb24gKG5hbWUsIG1vZHVsZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0VGFidWxhdG9yLnByb3RvdHlwZS5tb2R1bGVCaW5kaW5nc1tuYW1lXSA9IG1vZHVsZTtcblx0fTtcblxuXHQvL2Vuc3VyZSB0aGF0IG1vZHVsZSBhcmUgYm91bmQgdG8gaW5zdGFudGlhdGVkIGZ1bmN0aW9uXG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5iaW5kTW9kdWxlcyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMubW9kdWxlcyA9IHt9O1xuXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBUYWJ1bGF0b3IucHJvdG90eXBlLm1vZHVsZUJpbmRpbmdzKSB7XG5cblx0XHRcdHRoaXMubW9kdWxlc1tuYW1lXSA9IG5ldyBUYWJ1bGF0b3IucHJvdG90eXBlLm1vZHVsZUJpbmRpbmdzW25hbWVdKHRoaXMpO1xuXHRcdH1cblx0fTtcblxuXHQvL0NoZWNrIGZvciBtb2R1bGVcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLm1vZEV4aXN0cyA9IGZ1bmN0aW9uIChwbHVnaW4sIHJlcXVpcmVkKSB7XG5cblx0XHRpZiAodGhpcy5tb2R1bGVzW3BsdWdpbl0pIHtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKHJlcXVpcmVkKSB7XG5cblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBNb2R1bGUgTm90IEluc3RhbGxlZDogXCIgKyBwbHVnaW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycyA9IHtcblxuXHRcdGVsVmlzaWJsZTogZnVuY3Rpb24gZWxWaXNpYmxlKGVsKSB7XG5cblx0XHRcdHJldHVybiAhKGVsLm9mZnNldFdpZHRoIDw9IDAgJiYgZWwub2Zmc2V0SGVpZ2h0IDw9IDApO1xuXHRcdH0sXG5cblx0XHRlbE9mZnNldDogZnVuY3Rpb24gZWxPZmZzZXQoZWwpIHtcblxuXHRcdFx0dmFyIGJveCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0XHRyZXR1cm4ge1xuXG5cdFx0XHRcdHRvcDogYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AsXG5cblx0XHRcdFx0bGVmdDogYm94LmxlZnQgKyB3aW5kb3cucGFnZVhPZmZzZXQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdFxuXG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHRkZWVwQ2xvbmU6IGZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHtcblxuXHRcdFx0dmFyIGNsb25lID0gQXJyYXkuaXNBcnJheShvYmopID8gW10gOiB7fTtcblxuXHRcdFx0Zm9yICh2YXIgaSBpbiBvYmopIHtcblxuXHRcdFx0XHRpZiAob2JqW2ldICE9IG51bGwgJiYgX3R5cGVvZihvYmpbaV0pID09PSBcIm9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHRpZiAob2JqW2ldIGluc3RhbmNlb2YgRGF0ZSkge1xuXG5cdFx0XHRcdFx0XHRjbG9uZVtpXSA9IG5ldyBEYXRlKG9ialtpXSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0Y2xvbmVbaV0gPSB0aGlzLmRlZXBDbG9uZShvYmpbaV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNsb25lW2ldID0gb2JqW2ldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjbG9uZTtcblx0XHR9XG5cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zID0ge1xuXG5cdFx0dGFibGVzOiBbXSxcblxuXHRcdHJlZ2lzdGVyOiBmdW5jdGlvbiByZWdpc3Rlcih0YWJsZSkge1xuXG5cdFx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5wdXNoKHRhYmxlKTtcblx0XHR9LFxuXG5cdFx0ZGVyZWdpc3RlcjogZnVuY3Rpb24gZGVyZWdpc3Rlcih0YWJsZSkge1xuXG5cdFx0XHR2YXIgaW5kZXggPSBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5pbmRleE9mKHRhYmxlKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblxuXHRcdFx0XHRUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRsb29rdXBUYWJsZTogZnVuY3Rpb24gbG9va3VwVGFibGUocXVlcnksIHNpbGVudCkge1xuXG5cdFx0XHR2YXIgcmVzdWx0cyA9IFtdLFxuXHRcdFx0ICAgIG1hdGNoZXMsXG5cdFx0XHQgICAgbWF0Y2g7XG5cblx0XHRcdGlmICh0eXBlb2YgcXVlcnkgPT09IFwic3RyaW5nXCIpIHtcblxuXHRcdFx0XHRtYXRjaGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChxdWVyeSk7XG5cblx0XHRcdFx0aWYgKG1hdGNoZXMubGVuZ3RoKSB7XG5cblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHtcblxuXHRcdFx0XHRcdFx0bWF0Y2ggPSBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLm1hdGNoRWxlbWVudChtYXRjaGVzW2ldKTtcblxuXHRcdFx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cblx0XHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKG1hdGNoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHF1ZXJ5IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgfHwgcXVlcnkgaW5zdGFuY2VvZiBUYWJ1bGF0b3IpIHtcblxuXHRcdFx0XHRtYXRjaCA9IFRhYnVsYXRvci5wcm90b3R5cGUuY29tbXMubWF0Y2hFbGVtZW50KHF1ZXJ5KTtcblxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcblxuXHRcdFx0XHRcdHJlc3VsdHMucHVzaChtYXRjaCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShxdWVyeSkpIHtcblxuXHRcdFx0XHRxdWVyeS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoVGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5sb29rdXBUYWJsZShpdGVtKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAoIXNpbGVudCkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiVGFibGUgQ29ubmVjdGlvbiBFcnJvciAtIEludmFsaWQgU2VsZWN0b3JcIiwgcXVlcnkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdH0sXG5cblx0XHRtYXRjaEVsZW1lbnQ6IGZ1bmN0aW9uIG1hdGNoRWxlbWVudChlbGVtZW50KSB7XG5cblx0XHRcdHJldHVybiBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLnRhYmxlcy5maW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuXG5cdFx0XHRcdHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgVGFidWxhdG9yID8gdGFibGUgPT09IGVsZW1lbnQgOiB0YWJsZS5lbGVtZW50ID09PSBlbGVtZW50O1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5maW5kVGFibGUgPSBmdW5jdGlvbiAocXVlcnkpIHtcblxuXHRcdHZhciByZXN1bHRzID0gVGFidWxhdG9yLnByb3RvdHlwZS5jb21tcy5sb29rdXBUYWJsZShxdWVyeSwgdHJ1ZSk7XG5cblx0XHRyZXR1cm4gQXJyYXkuaXNBcnJheShyZXN1bHRzKSAmJiAhcmVzdWx0cy5sZW5ndGggPyBmYWxzZSA6IHJlc3VsdHM7XG5cdH07XG5cblx0dmFyIExheW91dCA9IGZ1bmN0aW9uIExheW91dCh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXG5cdFx0dGhpcy5tb2RlID0gbnVsbDtcblx0fTtcblxuXHQvL2luaXRpYWxpemUgbGF5b3V0IHN5c3RlbVxuXG5cblx0TGF5b3V0LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGxheW91dCkge1xuXG5cdFx0aWYgKHRoaXMubW9kZXNbbGF5b3V0XSkge1xuXG5cdFx0XHR0aGlzLm1vZGUgPSBsYXlvdXQ7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiTGF5b3V0IEVycm9yIC0gaW52YWxpZCBtb2RlIHNldCwgZGVmYXVsdGluZyB0byAnZml0RGF0YScgOiBcIiArIGxheW91dCk7XG5cblx0XHRcdHRoaXMubW9kZSA9ICdmaXREYXRhJztcblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWxheW91dFwiLCB0aGlzLm1vZGUpO1xuXHR9O1xuXG5cdExheW91dC5wcm90b3R5cGUuZ2V0TW9kZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHJldHVybiB0aGlzLm1vZGU7XG5cdH07XG5cblx0Ly90cmlnZ2VyIHRhYmxlIGxheW91dFxuXG5cblx0TGF5b3V0LnByb3RvdHlwZS5sYXlvdXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHR0aGlzLm1vZGVzW3RoaXMubW9kZV0uY2FsbCh0aGlzLCB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXgpO1xuXHR9O1xuXG5cdC8vbGF5b3V0IHJlbmRlciBmdW5jdGlvbnNcblxuXG5cdExheW91dC5wcm90b3R5cGUubW9kZXMgPSB7XG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhIHRoZSBjb250YWluXG5cblxuXHRcdFwiZml0RGF0YVwiOiBmdW5jdGlvbiBmaXREYXRhKGNvbHVtbnMpIHtcblxuXHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRjb2x1bW4ucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8vcmVzaXplIGNvbHVtbnMgdG8gZml0IGRhdGEgdGhlIGNvbnRhaW4gYW5kIHN0cmV0Y2ggcm93IHRvIGZpbGwgdGFibGVcblxuXG5cdFx0XCJmaXREYXRhRmlsbFwiOiBmdW5jdGlvbiBmaXREYXRhRmlsbChjb2x1bW5zKSB7XG5cblx0XHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhIHRoZSBjb250YWluIGFuZCBzdHJldGNoIGxhc3QgY29sdW1uIHRvIGZpbGwgdGFibGVcblxuXG5cdFx0XCJmaXREYXRhU3RyZXRjaFwiOiBmdW5jdGlvbiBmaXREYXRhU3RyZXRjaChjb2x1bW5zKSB7XG5cdFx0XHR2YXIgX3RoaXMzMSA9IHRoaXM7XG5cblx0XHRcdHZhciBjb2xzV2lkdGggPSAwLFxuXHRcdFx0ICAgIHRhYmxlV2lkdGggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aCxcblx0XHRcdCAgICBnYXAgPSAwLFxuXHRcdFx0ICAgIGxhc3RDb2wgPSBmYWxzZTtcblxuXHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGkpIHtcblxuXHRcdFx0XHRpZiAoIWNvbHVtbi53aWR0aEZpeGVkKSB7XG5cblx0XHRcdFx0XHRjb2x1bW4ucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChfdGhpczMxLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCA/IGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUudmlzaWJsZSA6IGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHRsYXN0Q29sID0gY29sdW1uO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHRjb2xzV2lkdGggKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAobGFzdENvbCkge1xuXG5cdFx0XHRcdGdhcCA9IHRhYmxlV2lkdGggLSBjb2xzV2lkdGggKyBsYXN0Q29sLmdldFdpZHRoKCk7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSkge1xuXG5cdFx0XHRcdFx0bGFzdENvbC5zZXRXaWR0aCgwKTtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGdhcCA+IDApIHtcblxuXHRcdFx0XHRcdGxhc3RDb2wuc2V0V2lkdGgoZ2FwKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGxhc3RDb2wucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC51cGRhdGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdFxuXG5cblx0XHRcImZpdENvbHVtbnNcIjogZnVuY3Rpb24gZml0Q29sdW1ucyhjb2x1bW5zKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dmFyIHRvdGFsV2lkdGggPSBzZWxmLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7IC8vdGFibGUgZWxlbWVudCB3aWR0aFxuXG5cblx0XHRcdHZhciBmaXhlZFdpZHRoID0gMDsgLy90b3RhbCB3aWR0aCBvZiBjb2x1bW5zIHdpdGggYSBkZWZpbmVkIHdpZHRoXG5cblxuXHRcdFx0dmFyIGZsZXhXaWR0aCA9IDA7IC8vdG90YWwgd2lkdGggYXZhaWxhYmxlIHRvIGZsZXhpYmxlIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgZmxleEdyb3dVbml0cyA9IDA7IC8vdG90YWwgbnVtYmVyIG9mIHdpZHRoR3JvdyBibG9ja3MgYWNjcm9zcyBhbGwgY29sdW1uc1xuXG5cblx0XHRcdHZhciBmbGV4Q29sV2lkdGggPSAwOyAvL2Rlc2lyZWQgd2lkdGggb2YgZmxleGlibGUgY29sdW1uc1xuXG5cblx0XHRcdHZhciBmbGV4Q29sdW1ucyA9IFtdOyAvL2FycmF5IG9mIGZsZXhpYmxlIHdpZHRoIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgZml4ZWRTaHJpbmtDb2x1bW5zID0gW107IC8vYXJyYXkgb2YgZml4ZWQgd2lkdGggY29sdW1ucyB0aGF0IGNhbiBzaHJpbmtcblxuXG5cdFx0XHR2YXIgZmxleFNocmlua1VuaXRzID0gMDsgLy90b3RhbCBudW1iZXIgb2Ygd2lkdGhTaHJpbmsgYmxvY2tzIGFjY3Jvc3MgYWxsIGNvbHVtbnNcblxuXG5cdFx0XHR2YXIgb3ZlcmZsb3dXaWR0aCA9IDA7IC8vaG9yaXpvbnRhbCBvdmVyZmxvdyB3aWR0aFxuXG5cblx0XHRcdHZhciBnYXBGaWxsID0gMDsgLy9udW1iZXIgb2YgcGl4ZWxzIHRvIGJlIGFkZGVkIHRvIGZpbmFsIGNvbHVtbiB0byBjbG9zZSBhbmQgaGFsZiBwaXhlbCBnYXBzXG5cblxuXHRcdFx0ZnVuY3Rpb24gY2FsY1dpZHRoKHdpZHRoKSB7XG5cblx0XHRcdFx0dmFyIGNvbFdpZHRoO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygd2lkdGggPT0gXCJzdHJpbmdcIikge1xuXG5cdFx0XHRcdFx0aWYgKHdpZHRoLmluZGV4T2YoXCIlXCIpID4gLTEpIHtcblxuXHRcdFx0XHRcdFx0Y29sV2lkdGggPSB0b3RhbFdpZHRoIC8gMTAwICogcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gcGFyc2VJbnQod2lkdGgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGNvbFdpZHRoID0gd2lkdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY29sV2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdC8vZW5zdXJlIGNvbHVtbnMgcmVzaXplIHRvIHRha2UgdXAgdGhlIGNvcnJlY3QgYW1vdW50IG9mIHNwYWNlXG5cblxuXHRcdFx0ZnVuY3Rpb24gc2NhbGVDb2x1bW5zKGNvbHVtbnMsIGZyZWVTcGFjZSwgY29sV2lkdGgsIHNocmlua0NvbHMpIHtcblxuXHRcdFx0XHR2YXIgb3ZlcnNpemVDb2xzID0gW10sXG5cdFx0XHRcdCAgICBvdmVyc2l6ZVNwYWNlID0gMCxcblx0XHRcdFx0ICAgIHJlbWFpbmluZ1NwYWNlID0gMCxcblx0XHRcdFx0ICAgIG5leHRDb2xXaWR0aCA9IDAsXG5cdFx0XHRcdCAgICBnYXAgPSAwLFxuXHRcdFx0XHQgICAgY2hhbmdlVW5pdHMgPSAwLFxuXHRcdFx0XHQgICAgdW5kZXJzaXplQ29scyA9IFtdO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGNhbGNHcm93KGNvbCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGNvbFdpZHRoICogKGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aEdyb3cgfHwgMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBjYWxjU2hyaW5rKGNvbCkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGNhbGNXaWR0aChjb2wud2lkdGgpIC0gY29sV2lkdGggKiAoY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoU2hyaW5rIHx8IDApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wsIGkpIHtcblxuXHRcdFx0XHRcdHZhciB3aWR0aCA9IHNocmlua0NvbHMgPyBjYWxjU2hyaW5rKGNvbCkgOiBjYWxjR3Jvdyhjb2wpO1xuXG5cdFx0XHRcdFx0aWYgKGNvbC5jb2x1bW4ubWluV2lkdGggPj0gd2lkdGgpIHtcblxuXHRcdFx0XHRcdFx0b3ZlcnNpemVDb2xzLnB1c2goY29sKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHR1bmRlcnNpemVDb2xzLnB1c2goY29sKTtcblxuXHRcdFx0XHRcdFx0Y2hhbmdlVW5pdHMgKz0gc2hyaW5rQ29scyA/IGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayB8fCAxIDogY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoR3JvdyB8fCAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKG92ZXJzaXplQ29scy5sZW5ndGgpIHtcblxuXHRcdFx0XHRcdG92ZXJzaXplQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRcdFx0b3ZlcnNpemVTcGFjZSArPSBzaHJpbmtDb2xzID8gY29sLndpZHRoIC0gY29sLmNvbHVtbi5taW5XaWR0aCA6IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cblx0XHRcdFx0XHRcdGNvbC53aWR0aCA9IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZW1haW5pbmdTcGFjZSA9IGZyZWVTcGFjZSAtIG92ZXJzaXplU3BhY2U7XG5cblx0XHRcdFx0XHRuZXh0Q29sV2lkdGggPSBjaGFuZ2VVbml0cyA/IE1hdGguZmxvb3IocmVtYWluaW5nU3BhY2UgLyBjaGFuZ2VVbml0cykgOiByZW1haW5pbmdTcGFjZTtcblxuXHRcdFx0XHRcdGdhcCA9IHJlbWFpbmluZ1NwYWNlIC0gbmV4dENvbFdpZHRoICogY2hhbmdlVW5pdHM7XG5cblx0XHRcdFx0XHRnYXAgKz0gc2NhbGVDb2x1bW5zKHVuZGVyc2l6ZUNvbHMsIHJlbWFpbmluZ1NwYWNlLCBuZXh0Q29sV2lkdGgsIHNocmlua0NvbHMpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Z2FwID0gY2hhbmdlVW5pdHMgPyBmcmVlU3BhY2UgLSBNYXRoLmZsb29yKGZyZWVTcGFjZSAvIGNoYW5nZVVuaXRzKSAqIGNoYW5nZVVuaXRzIDogZnJlZVNwYWNlO1xuXG5cdFx0XHRcdFx0dW5kZXJzaXplQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblxuXHRcdFx0XHRcdFx0Y29sdW1uLndpZHRoID0gc2hyaW5rQ29scyA/IGNhbGNTaHJpbmsoY29sdW1uKSA6IGNhbGNHcm93KGNvbHVtbik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZ2FwO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJyZXNwb25zaXZlTGF5b3V0XCIsIHRydWUpKSB7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vYWRqdXN0IGZvciB2ZXJ0aWNhbCBzY3JvbGxiYXIgaWYgcHJlc2VudFxuXG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQgPiB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcblxuXHRcdFx0XHR0b3RhbFdpZHRoIC09IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50Lm9mZnNldFdpZHRoIC0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0dmFyIHdpZHRoLCBtaW5XaWR0aCwgY29sV2lkdGg7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi52aXNpYmxlKSB7XG5cblx0XHRcdFx0XHR3aWR0aCA9IGNvbHVtbi5kZWZpbml0aW9uLndpZHRoO1xuXG5cdFx0XHRcdFx0bWluV2lkdGggPSBwYXJzZUludChjb2x1bW4ubWluV2lkdGgpO1xuXG5cdFx0XHRcdFx0aWYgKHdpZHRoKSB7XG5cblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gY2FsY1dpZHRoKHdpZHRoKTtcblxuXHRcdFx0XHRcdFx0Zml4ZWRXaWR0aCArPSBjb2xXaWR0aCA+IG1pbldpZHRoID8gY29sV2lkdGggOiBtaW5XaWR0aDtcblxuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLndpZHRoU2hyaW5rKSB7XG5cblx0XHRcdFx0XHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zLnB1c2goe1xuXG5cdFx0XHRcdFx0XHRcdFx0Y29sdW1uOiBjb2x1bW4sXG5cblx0XHRcdFx0XHRcdFx0XHR3aWR0aDogY29sV2lkdGggPiBtaW5XaWR0aCA/IGNvbFdpZHRoIDogbWluV2lkdGhcblxuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRmbGV4U2hyaW5rVW5pdHMgKz0gY29sdW1uLmRlZmluaXRpb24ud2lkdGhTaHJpbms7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0ZmxleENvbHVtbnMucHVzaCh7XG5cblx0XHRcdFx0XHRcdFx0Y29sdW1uOiBjb2x1bW4sXG5cblx0XHRcdFx0XHRcdFx0d2lkdGg6IDBcblxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGZsZXhHcm93VW5pdHMgKz0gY29sdW1uLmRlZmluaXRpb24ud2lkdGhHcm93IHx8IDE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly9jYWxjdWxhdGUgYXZhaWxhYmxlIHNwYWNlXG5cblxuXHRcdFx0ZmxleFdpZHRoID0gdG90YWxXaWR0aCAtIGZpeGVkV2lkdGg7XG5cblx0XHRcdC8vY2FsY3VsYXRlIGNvcnJlY3QgY29sdW1uIHNpemVcblxuXG5cdFx0XHRmbGV4Q29sV2lkdGggPSBNYXRoLmZsb29yKGZsZXhXaWR0aCAvIGZsZXhHcm93VW5pdHMpO1xuXG5cdFx0XHQvL2dlbmVyYXRlIGNvbHVtbiB3aWR0aHNcblxuXG5cdFx0XHR2YXIgZ2FwRmlsbCA9IHNjYWxlQ29sdW1ucyhmbGV4Q29sdW1ucywgZmxleFdpZHRoLCBmbGV4Q29sV2lkdGgsIGZhbHNlKTtcblxuXHRcdFx0Ly9pbmNyZWFzZSB3aWR0aCBvZiBsYXN0IGNvbHVtbiB0byBhY2NvdW50IGZvciByb3VuZGluZyBlcnJvcnNcblxuXG5cdFx0XHRpZiAoZmxleENvbHVtbnMubGVuZ3RoICYmIGdhcEZpbGwgPiAwKSB7XG5cblx0XHRcdFx0ZmxleENvbHVtbnNbZmxleENvbHVtbnMubGVuZ3RoIC0gMV0ud2lkdGggKz0gK2dhcEZpbGw7XG5cdFx0XHR9XG5cblx0XHRcdC8vY2FjdWxhdGUgc3BhY2UgZm9yIGNvbHVtbnMgdG8gYmUgc2hydW5rIGludG9cblxuXG5cdFx0XHRmbGV4Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRmbGV4V2lkdGggLT0gY29sLndpZHRoO1xuXHRcdFx0fSk7XG5cblx0XHRcdG92ZXJmbG93V2lkdGggPSBNYXRoLmFicyhnYXBGaWxsKSArIGZsZXhXaWR0aDtcblxuXHRcdFx0Ly9zaHJpbmsgb3ZlcnNpemUgY29sdW1ucyBpZiB0aGVyZSBpcyBubyBhdmFpbGFibGUgc3BhY2VcblxuXG5cdFx0XHRpZiAob3ZlcmZsb3dXaWR0aCA+IDAgJiYgZmxleFNocmlua1VuaXRzKSB7XG5cblx0XHRcdFx0Z2FwRmlsbCA9IHNjYWxlQ29sdW1ucyhmaXhlZFNocmlua0NvbHVtbnMsIG92ZXJmbG93V2lkdGgsIE1hdGguZmxvb3Iob3ZlcmZsb3dXaWR0aCAvIGZsZXhTaHJpbmtVbml0cyksIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2RlY3JlYXNlIHdpZHRoIG9mIGxhc3QgY29sdW1uIHRvIGFjY291bnQgZm9yIHJvdW5kaW5nIGVycm9yc1xuXG5cblx0XHRcdGlmIChmaXhlZFNocmlua0NvbHVtbnMubGVuZ3RoKSB7XG5cblx0XHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zW2ZpeGVkU2hyaW5rQ29sdW1ucy5sZW5ndGggLSAxXS53aWR0aCAtPSBnYXBGaWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRmbGV4Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2wpIHtcblxuXHRcdFx0XHRjb2wuY29sdW1uLnNldFdpZHRoKGNvbC53aWR0aCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Zml4ZWRTaHJpbmtDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXG5cdFx0XHRcdGNvbC5jb2x1bW4uc2V0V2lkdGgoY29sLndpZHRoKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJsYXlvdXRcIiwgTGF5b3V0KTtcblxuXHR2YXIgTG9jYWxpemUgPSBmdW5jdGlvbiBMb2NhbGl6ZSh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXG5cdFx0dGhpcy5sb2NhbGUgPSBcImRlZmF1bHRcIjsgLy9jdXJyZW50IGxvY2FsZVxuXG5cdFx0dGhpcy5sYW5nID0gZmFsc2U7IC8vY3VycmVudCBsYW5ndWFnZVxuXG5cdFx0dGhpcy5iaW5kaW5ncyA9IHt9OyAvL3VwZGF0ZSBldmVudHMgdG8gY2FsbCB3aGVuIGxvY2FsZSBpcyBjaGFuZ2VkXG5cdH07XG5cblx0Ly9zZXQgaGVhZGVyIHBsYWNlaG9kZXJcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuc2V0SGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAocGxhY2Vob2xkZXIpIHtcblxuXHRcdHRoaXMubGFuZ3MuZGVmYXVsdC5oZWFkZXJGaWx0ZXJzLmRlZmF1bHQgPSBwbGFjZWhvbGRlcjtcblx0fTtcblxuXHQvL3NldCBoZWFkZXIgZmlsdGVyIHBsYWNlaG9sZGVyIGJ5IGNvbHVtblxuXG5cdExvY2FsaXplLnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJDb2x1bW5QbGFjZWhvbGRlciA9IGZ1bmN0aW9uIChjb2x1bW4sIHBsYWNlaG9sZGVyKSB7XG5cblx0XHR0aGlzLmxhbmdzLmRlZmF1bHQuaGVhZGVyRmlsdGVycy5jb2x1bW5zW2NvbHVtbl0gPSBwbGFjZWhvbGRlcjtcblxuXHRcdGlmICh0aGlzLmxhbmcgJiYgIXRoaXMubGFuZy5oZWFkZXJGaWx0ZXJzLmNvbHVtbnNbY29sdW1uXSkge1xuXG5cdFx0XHR0aGlzLmxhbmcuaGVhZGVyRmlsdGVycy5jb2x1bW5zW2NvbHVtbl0gPSBwbGFjZWhvbGRlcjtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXR1cCBhIGxhbmcgZGVzY3JpcHRpb24gb2JqZWN0XG5cblx0TG9jYWxpemUucHJvdG90eXBlLmluc3RhbGxMYW5nID0gZnVuY3Rpb24gKGxvY2FsZSwgbGFuZykge1xuXG5cdFx0aWYgKHRoaXMubGFuZ3NbbG9jYWxlXSkge1xuXG5cdFx0XHR0aGlzLl9zZXRMYW5nUHJvcCh0aGlzLmxhbmdzW2xvY2FsZV0sIGxhbmcpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMubGFuZ3NbbG9jYWxlXSA9IGxhbmc7XG5cdFx0fVxuXHR9O1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5fc2V0TGFuZ1Byb3AgPSBmdW5jdGlvbiAobGFuZywgdmFsdWVzKSB7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gdmFsdWVzKSB7XG5cblx0XHRcdGlmIChsYW5nW2tleV0gJiYgX3R5cGVvZihsYW5nW2tleV0pID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0XHR0aGlzLl9zZXRMYW5nUHJvcChsYW5nW2tleV0sIHZhbHVlc1trZXldKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0bGFuZ1trZXldID0gdmFsdWVzW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0IGN1cnJlbnQgbG9jYWxlXG5cblx0TG9jYWxpemUucHJvdG90eXBlLnNldExvY2FsZSA9IGZ1bmN0aW9uIChkZXNpcmVkTG9jYWxlKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRkZXNpcmVkTG9jYWxlID0gZGVzaXJlZExvY2FsZSB8fCBcImRlZmF1bHRcIjtcblxuXHRcdC8vZmlsbCBpbiBhbnkgbWF0Y2hpbmcgbGFuZ3VnZSB2YWx1ZXNcblxuXHRcdGZ1bmN0aW9uIHRyYXZlcnNlTGFuZyh0cmFucywgcGF0aCkge1xuXG5cdFx0XHRmb3IgKHZhciBwcm9wIGluIHRyYW5zKSB7XG5cblx0XHRcdFx0aWYgKF90eXBlb2YodHJhbnNbcHJvcF0pID09IFwib2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdGlmICghcGF0aFtwcm9wXSkge1xuXG5cdFx0XHRcdFx0XHRwYXRoW3Byb3BdID0ge307XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dHJhdmVyc2VMYW5nKHRyYW5zW3Byb3BdLCBwYXRoW3Byb3BdKTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHBhdGhbcHJvcF0gPSB0cmFuc1twcm9wXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vZGV0ZXJtaW5nIGNvcnJlY3QgbG9jYWxlIHRvIGxvYWRcblxuXHRcdGlmIChkZXNpcmVkTG9jYWxlID09PSB0cnVlICYmIG5hdmlnYXRvci5sYW5ndWFnZSkge1xuXG5cdFx0XHQvL2dldCBsb2NhbCBmcm9tIHN5c3RlbVxuXG5cdFx0XHRkZXNpcmVkTG9jYWxlID0gbmF2aWdhdG9yLmxhbmd1YWdlLnRvTG93ZXJDYXNlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKGRlc2lyZWRMb2NhbGUpIHtcblxuXHRcdFx0Ly9pZiBsb2NhbGUgaXMgbm90IHNldCwgY2hlY2sgZm9yIG1hdGNoaW5nIHRvcCBsZXZlbCBsb2NhbGUgZWxzZSB1c2UgZGVmYXVsdFxuXG5cdFx0XHRpZiAoIXNlbGYubGFuZ3NbZGVzaXJlZExvY2FsZV0pIHtcblxuXHRcdFx0XHR2YXIgcHJlZml4ID0gZGVzaXJlZExvY2FsZS5zcGxpdChcIi1cIilbMF07XG5cblx0XHRcdFx0aWYgKHNlbGYubGFuZ3NbcHJlZml4XSkge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gRXhhY3QgbWF0Y2hpbmcgbG9jYWxlIG5vdCBmb3VuZCwgdXNpbmcgY2xvc2VzdCBtYXRjaDogXCIsIGRlc2lyZWRMb2NhbGUsIHByZWZpeCk7XG5cblx0XHRcdFx0XHRkZXNpcmVkTG9jYWxlID0gcHJlZml4O1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxlIG5vdCBmb3VuZCwgdXNpbmcgZGVmYXVsdDogXCIsIGRlc2lyZWRMb2NhbGUpO1xuXG5cdFx0XHRcdFx0ZGVzaXJlZExvY2FsZSA9IFwiZGVmYXVsdFwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2VsZi5sb2NhbGUgPSBkZXNpcmVkTG9jYWxlO1xuXG5cdFx0Ly9sb2FkIGRlZmF1bHQgbGFuZyB0ZW1wbGF0ZVxuXG5cdFx0c2VsZi5sYW5nID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmRlZXBDbG9uZShzZWxmLmxhbmdzLmRlZmF1bHQgfHwge30pO1xuXG5cdFx0aWYgKGRlc2lyZWRMb2NhbGUgIT0gXCJkZWZhdWx0XCIpIHtcblxuXHRcdFx0dHJhdmVyc2VMYW5nKHNlbGYubGFuZ3NbZGVzaXJlZExvY2FsZV0sIHNlbGYubGFuZyk7XG5cdFx0fVxuXG5cdFx0c2VsZi50YWJsZS5vcHRpb25zLmxvY2FsaXplZC5jYWxsKHNlbGYudGFibGUsIHNlbGYubG9jYWxlLCBzZWxmLmxhbmcpO1xuXG5cdFx0c2VsZi5fZXhlY3V0ZUJpbmRpbmdzKCk7XG5cdH07XG5cblx0Ly9nZXQgY3VycmVudCBsb2NhbGVcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0TG9jYWxlID0gZnVuY3Rpb24gKGxvY2FsZSkge1xuXG5cdFx0cmV0dXJuIHNlbGYubG9jYWxlO1xuXHR9O1xuXG5cdC8vZ2V0IGxhbmcgb2JqZWN0IGZvciBnaXZlbiBsb2NhbCBvciBjdXJyZW50IGlmIG5vbmUgcHJvdmlkZWRcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0TGFuZyA9IGZ1bmN0aW9uIChsb2NhbGUpIHtcblxuXHRcdHJldHVybiBsb2NhbGUgPyB0aGlzLmxhbmdzW2xvY2FsZV0gOiB0aGlzLmxhbmc7XG5cdH07XG5cblx0Ly9nZXQgdGV4dCBmb3IgY3VycmVudCBsb2NhbGVcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChwYXRoLCB2YWx1ZSkge1xuXG5cdFx0dmFyIHBhdGggPSB2YWx1ZSA/IHBhdGggKyBcInxcIiArIHZhbHVlIDogcGF0aCxcblx0XHQgICAgcGF0aEFycmF5ID0gcGF0aC5zcGxpdChcInxcIiksXG5cdFx0ICAgIHRleHQgPSB0aGlzLl9nZXRMYW5nRWxlbWVudChwYXRoQXJyYXksIHRoaXMubG9jYWxlKTtcblxuXHRcdC8vIGlmKHRleHQgPT09IGZhbHNlKXtcblxuXHRcdC8vIFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxpemVkIHRleHQgbm90IGZvdW5kIGZvciBnaXZlbiBwYXRoOiBcIiwgcGF0aCk7XG5cblx0XHQvLyB9XG5cblxuXHRcdHJldHVybiB0ZXh0IHx8IFwiXCI7XG5cdH07XG5cblx0Ly90cmF2ZXJzZSBsYW5ncyBvYmplY3QgYW5kIGZpbmQgbG9jYWxpemVkIGNvcHlcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuX2dldExhbmdFbGVtZW50ID0gZnVuY3Rpb24gKHBhdGgsIGxvY2FsZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIHJvb3QgPSBzZWxmLmxhbmc7XG5cblx0XHRwYXRoLmZvckVhY2goZnVuY3Rpb24gKGxldmVsKSB7XG5cblx0XHRcdHZhciByb290UGF0aDtcblxuXHRcdFx0aWYgKHJvb3QpIHtcblxuXHRcdFx0XHRyb290UGF0aCA9IHJvb3RbbGV2ZWxdO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygcm9vdFBhdGggIT0gXCJ1bmRlZmluZWRcIikge1xuXG5cdFx0XHRcdFx0cm9vdCA9IHJvb3RQYXRoO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0cm9vdCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm9vdDtcblx0fTtcblxuXHQvL3NldCB1cGRhdGUgYmluZGluZ1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7XG5cblx0XHRpZiAoIXRoaXMuYmluZGluZ3NbcGF0aF0pIHtcblxuXHRcdFx0dGhpcy5iaW5kaW5nc1twYXRoXSA9IFtdO1xuXHRcdH1cblxuXHRcdHRoaXMuYmluZGluZ3NbcGF0aF0ucHVzaChjYWxsYmFjayk7XG5cblx0XHRjYWxsYmFjayh0aGlzLmdldFRleHQocGF0aCksIHRoaXMubGFuZyk7XG5cdH07XG5cblx0Ly9pdHRlcmF0ZSB0aHJvdWdoIGJpbmRpbmdzIGFuZCB0cmlnZ2VyIHVwZGF0ZXNcblxuXHRMb2NhbGl6ZS5wcm90b3R5cGUuX2V4ZWN1dGVCaW5kaW5ncyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKHBhdGgpIHtcblxuXHRcdFx0c2VsZi5iaW5kaW5nc1twYXRoXS5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7XG5cblx0XHRcdFx0YmluZGluZyhzZWxmLmdldFRleHQocGF0aCksIHNlbGYubGFuZyk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0Zm9yICh2YXIgcGF0aCBpbiBzZWxmLmJpbmRpbmdzKSB7XG5cdFx0XHRfbG9vcChwYXRoKTtcblx0XHR9XG5cdH07XG5cblx0Ly9Mb2NhbGl6ZWQgdGV4dCBsaXN0aW5nc1xuXG5cdExvY2FsaXplLnByb3RvdHlwZS5sYW5ncyA9IHtcblxuXHRcdFwiZGVmYXVsdFwiOiB7IC8vaG9sZCBkZWZhdWx0IGxvY2FsZSB0ZXh0XG5cblx0XHRcdFwiZ3JvdXBzXCI6IHtcblxuXHRcdFx0XHRcIml0ZW1cIjogXCJpdGVtXCIsXG5cblx0XHRcdFx0XCJpdGVtc1wiOiBcIml0ZW1zXCJcblxuXHRcdFx0fSxcblxuXHRcdFx0XCJjb2x1bW5zXCI6IHt9LFxuXG5cdFx0XHRcImFqYXhcIjoge1xuXG5cdFx0XHRcdFwibG9hZGluZ1wiOiBcIkxvYWRpbmdcIixcblxuXHRcdFx0XHRcImVycm9yXCI6IFwiRXJyb3JcIlxuXG5cdFx0XHR9LFxuXG5cdFx0XHRcInBhZ2luYXRpb25cIjoge1xuXG5cdFx0XHRcdFwicGFnZV9zaXplXCI6IFwiUGFnZSBTaXplXCIsXG5cblx0XHRcdFx0XCJmaXJzdFwiOiBcIkZpcnN0XCIsXG5cblx0XHRcdFx0XCJmaXJzdF90aXRsZVwiOiBcIkZpcnN0IFBhZ2VcIixcblxuXHRcdFx0XHRcImxhc3RcIjogXCJMYXN0XCIsXG5cblx0XHRcdFx0XCJsYXN0X3RpdGxlXCI6IFwiTGFzdCBQYWdlXCIsXG5cblx0XHRcdFx0XCJwcmV2XCI6IFwiUHJldlwiLFxuXG5cdFx0XHRcdFwicHJldl90aXRsZVwiOiBcIlByZXYgUGFnZVwiLFxuXG5cdFx0XHRcdFwibmV4dFwiOiBcIk5leHRcIixcblxuXHRcdFx0XHRcIm5leHRfdGl0bGVcIjogXCJOZXh0IFBhZ2VcIlxuXG5cdFx0XHR9LFxuXG5cdFx0XHRcImhlYWRlckZpbHRlcnNcIjoge1xuXG5cdFx0XHRcdFwiZGVmYXVsdFwiOiBcImZpbHRlciBjb2x1bW4uLi5cIixcblxuXHRcdFx0XHRcImNvbHVtbnNcIjoge31cblxuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImxvY2FsaXplXCIsIExvY2FsaXplKTtcblxuXHR2YXIgQ29tbXMgPSBmdW5jdGlvbiBDb21tcyh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXHR9O1xuXG5cdENvbW1zLnByb3RvdHlwZS5nZXRDb25uZWN0aW9ucyA9IGZ1bmN0aW9uIChzZWxlY3RvcnMpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgY29ubmVjdGlvbnMgPSBbXSxcblx0XHQgICAgY29ubmVjdGlvbjtcblxuXHRcdGNvbm5lY3Rpb24gPSBUYWJ1bGF0b3IucHJvdG90eXBlLmNvbW1zLmxvb2t1cFRhYmxlKHNlbGVjdG9ycyk7XG5cblx0XHRjb25uZWN0aW9uLmZvckVhY2goZnVuY3Rpb24gKGNvbikge1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZSAhPT0gY29uKSB7XG5cblx0XHRcdFx0Y29ubmVjdGlvbnMucHVzaChjb24pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNvbm5lY3Rpb25zO1xuXHR9O1xuXG5cdENvbW1zLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHNlbGVjdG9ycywgbW9kdWxlLCBhY3Rpb24sIGRhdGEpIHtcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgY29ubmVjdGlvbnMgPSB0aGlzLmdldENvbm5lY3Rpb25zKHNlbGVjdG9ycyk7XG5cblx0XHRjb25uZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb25uZWN0aW9uKSB7XG5cblx0XHRcdGNvbm5lY3Rpb24udGFibGVDb21tcyhzZWxmLnRhYmxlLmVsZW1lbnQsIG1vZHVsZSwgYWN0aW9uLCBkYXRhKTtcblx0XHR9KTtcblxuXHRcdGlmICghY29ubmVjdGlvbnMubGVuZ3RoICYmIHNlbGVjdG9ycykge1xuXG5cdFx0XHRjb25zb2xlLndhcm4oXCJUYWJsZSBDb25uZWN0aW9uIEVycm9yIC0gTm8gdGFibGVzIG1hdGNoaW5nIHNlbGVjdG9yIGZvdW5kXCIsIHNlbGVjdG9ycyk7XG5cdFx0fVxuXHR9O1xuXG5cdENvbW1zLnByb3RvdHlwZS5yZWNlaXZlID0gZnVuY3Rpb24gKHRhYmxlLCBtb2R1bGUsIGFjdGlvbiwgZGF0YSkge1xuXG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKG1vZHVsZSkpIHtcblxuXHRcdFx0cmV0dXJuIHRoaXMudGFibGUubW9kdWxlc1ttb2R1bGVdLmNvbW1zUmVjZWl2ZWQodGFibGUsIGFjdGlvbiwgZGF0YSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc29sZS53YXJuKFwiSW50ZXItdGFibGUgQ29tbXMgRXJyb3IgLSBubyBzdWNoIG1vZHVsZTpcIiwgbW9kdWxlKTtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImNvbW1zXCIsIENvbW1zKTtcblxuXHR2YXIgQWNjZXNzb3IgPSBmdW5jdGlvbiBBY2Nlc3Nvcih0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmFsbG93ZWRUeXBlcyA9IFtcIlwiLCBcImRhdGFcIiwgXCJkb3dubG9hZFwiLCBcImNsaXBib2FyZFwiLCBcInByaW50XCIsIFwiaHRtbE91dHB1dFwiXTsgLy9saXN0IG9mIGFjY2Vzc29yIHR5cGVzXG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBhY2Nlc3NvclxuXHRBY2Nlc3Nvci5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG1hdGNoID0gZmFsc2UsXG5cdFx0ICAgIGNvbmZpZyA9IHt9O1xuXG5cdFx0dGhpcy5hbGxvd2VkVHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkge1xuXHRcdFx0dmFyIGtleSA9IFwiYWNjZXNzb3JcIiArICh0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zbGljZSgxKSksXG5cdFx0XHQgICAgYWNjZXNzb3I7XG5cblx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbltrZXldKSB7XG5cdFx0XHRcdGFjY2Vzc29yID0gc2VsZi5sb29rdXBBY2Nlc3Nvcihjb2x1bW4uZGVmaW5pdGlvbltrZXldKTtcblxuXHRcdFx0XHRpZiAoYWNjZXNzb3IpIHtcblx0XHRcdFx0XHRtYXRjaCA9IHRydWU7XG5cblx0XHRcdFx0XHRjb25maWdba2V5XSA9IHtcblx0XHRcdFx0XHRcdGFjY2Vzc29yOiBhY2Nlc3Nvcixcblx0XHRcdFx0XHRcdHBhcmFtczogY29sdW1uLmRlZmluaXRpb25ba2V5ICsgXCJQYXJhbXNcIl0gfHwge31cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmFjY2Vzc29yID0gY29uZmlnO1xuXHRcdH1cblx0fTtcblxuXHRBY2Nlc3Nvci5wcm90b3R5cGUubG9va3VwQWNjZXNzb3IgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHR2YXIgYWNjZXNzb3IgPSBmYWxzZTtcblxuXHRcdC8vc2V0IGNvbHVtbiBhY2Nlc3NvclxuXHRcdHN3aXRjaCAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpIHtcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0aWYgKHRoaXMuYWNjZXNzb3JzW3ZhbHVlXSkge1xuXHRcdFx0XHRcdGFjY2Vzc29yID0gdGhpcy5hY2Nlc3NvcnNbdmFsdWVdO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkFjY2Vzc29yIEVycm9yIC0gTm8gc3VjaCBhY2Nlc3NvciBmb3VuZCwgaWdub3Jpbmc6IFwiLCB2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRhY2Nlc3NvciA9IHZhbHVlO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gYWNjZXNzb3I7XG5cdH07XG5cblx0Ly9hcHBseSBhY2Nlc3NvciB0byByb3dcblx0QWNjZXNzb3IucHJvdG90eXBlLnRyYW5zZm9ybVJvdyA9IGZ1bmN0aW9uIChkYXRhSW4sIHR5cGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGtleSA9IFwiYWNjZXNzb3JcIiArICh0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zbGljZSgxKSk7XG5cblx0XHQvL2Nsb25lIGRhdGEgb2JqZWN0IHdpdGggZGVlcCBjb3B5IHRvIGlzb2xhdGUgaW50ZXJuYWwgZGF0YSBmcm9tIHJldHVybmVkIHJlc3VsdFxuXHRcdHZhciBkYXRhID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmRlZXBDbG9uZShkYXRhSW4gfHwge30pO1xuXG5cdFx0c2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnRyYXZlcnNlKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciB2YWx1ZSwgYWNjZXNzb3IsIHBhcmFtcywgY29tcG9uZW50O1xuXG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuYWNjZXNzb3IpIHtcblxuXHRcdFx0XHRhY2Nlc3NvciA9IGNvbHVtbi5tb2R1bGVzLmFjY2Vzc29yW2tleV0gfHwgY29sdW1uLm1vZHVsZXMuYWNjZXNzb3IuYWNjZXNzb3IgfHwgZmFsc2U7XG5cblx0XHRcdFx0aWYgKGFjY2Vzc29yKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShkYXRhKTtcblxuXHRcdFx0XHRcdGlmICh2YWx1ZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRjb21wb25lbnQgPSBjb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgYWNjZXNzb3IucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBhY2Nlc3Nvci5wYXJhbXModmFsdWUsIGRhdGEsIHR5cGUsIGNvbXBvbmVudCkgOiBhY2Nlc3Nvci5wYXJhbXM7XG5cdFx0XHRcdFx0XHRjb2x1bW4uc2V0RmllbGRWYWx1ZShkYXRhLCBhY2Nlc3Nvci5hY2Nlc3Nvcih2YWx1ZSwgZGF0YSwgdHlwZSwgcGFyYW1zLCBjb21wb25lbnQpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBkYXRhO1xuXHR9LFxuXG5cdC8vZGVmYXVsdCBhY2Nlc3NvcnNcblx0QWNjZXNzb3IucHJvdG90eXBlLmFjY2Vzc29ycyA9IHt9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJhY2Nlc3NvclwiLCBBY2Nlc3Nvcik7XG5cdHZhciBBamF4ID0gZnVuY3Rpb24gQWpheCh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuY29uZmlnID0gZmFsc2U7IC8vaG9sZCBjb25maWcgb2JqZWN0IGZvciBhamF4IHJlcXVlc3Rcblx0XHR0aGlzLnVybCA9IFwiXCI7IC8vcmVxdWVzdCBVUkxcblx0XHR0aGlzLnVybEdlbmVyYXRvciA9IGZhbHNlO1xuXHRcdHRoaXMucGFyYW1zID0gZmFsc2U7IC8vcmVxdWVzdCBwYXJhbWV0ZXJzXG5cblx0XHR0aGlzLmxvYWRlckVsZW1lbnQgPSB0aGlzLmNyZWF0ZUxvYWRlckVsZW1lbnQoKTsgLy9sb2FkZXIgbWVzc2FnZSBkaXZcblx0XHR0aGlzLm1zZ0VsZW1lbnQgPSB0aGlzLmNyZWF0ZU1zZ0VsZW1lbnQoKTsgLy9tZXNzYWdlIGVsZW1lbnRcblx0XHR0aGlzLmxvYWRpbmdFbGVtZW50ID0gZmFsc2U7XG5cdFx0dGhpcy5lcnJvckVsZW1lbnQgPSBmYWxzZTtcblx0XHR0aGlzLmxvYWRlclByb21pc2UgPSBmYWxzZTtcblxuXHRcdHRoaXMucHJvZ3Jlc3NpdmVMb2FkID0gZmFsc2U7XG5cdFx0dGhpcy5sb2FkaW5nID0gZmFsc2U7XG5cblx0XHR0aGlzLnJlcXVlc3RPcmRlciA9IDA7IC8vcHJldmVudCByZXF1ZXN0cyBjb21taW5nIG91dCBvZiBzZXF1ZW5jZSBpZiBvdmVycmlkZGVuIGJ5IGFub3RoZXIgbG9hZCByZXF1ZXN0XG5cdH07XG5cblx0Ly9pbml0aWFsaXplIHNldHVwIG9wdGlvbnNcblx0QWpheC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgdGVtcGxhdGU7XG5cblx0XHR0aGlzLmxvYWRlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5tc2dFbGVtZW50KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlckxvYWRpbmcpIHtcblx0XHRcdGlmICh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXJMb2FkaW5nID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0dGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuXHRcdFx0XHR0ZW1wbGF0ZS5pbm5lckhUTUwgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlckxvYWRpbmcudHJpbSgpO1xuXHRcdFx0XHR0aGlzLmxvYWRpbmdFbGVtZW50ID0gdGVtcGxhdGUuY29udGVudC5maXJzdENoaWxkO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5sb2FkaW5nRWxlbWVudCA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyTG9hZGluZztcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmxvYWRlclByb21pc2UgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFJlcXVlc3RGdW5jIHx8IHRoaXMuZGVmYXVsdExvYWRlclByb21pc2U7XG5cblx0XHR0aGlzLnVybEdlbmVyYXRvciA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4VVJMR2VuZXJhdG9yIHx8IHRoaXMuZGVmYXVsdFVSTEdlbmVyYXRvcjtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlckVycm9yKSB7XG5cdFx0XHRpZiAodHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyRXJyb3IgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHR0ZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XG5cdFx0XHRcdHRlbXBsYXRlLmlubmVySFRNTCA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyRXJyb3IudHJpbSgpO1xuXHRcdFx0XHR0aGlzLmVycm9yRWxlbWVudCA9IHRlbXBsYXRlLmNvbnRlbnQuZmlyc3RDaGlsZDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuZXJyb3JFbGVtZW50ID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXJFcnJvcjtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmFqYXhQYXJhbXMpIHtcblx0XHRcdHRoaXMuc2V0UGFyYW1zKHRoaXMudGFibGUub3B0aW9ucy5hamF4UGFyYW1zKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmFqYXhDb25maWcpIHtcblx0XHRcdHRoaXMuc2V0Q29uZmlnKHRoaXMudGFibGUub3B0aW9ucy5hamF4Q29uZmlnKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmFqYXhVUkwpIHtcblx0XHRcdHRoaXMuc2V0VXJsKHRoaXMudGFibGUub3B0aW9ucy5hamF4VVJMKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWQpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbikge1xuXHRcdFx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiUHJvZ3Jlc3NpdmUgTG9hZCBFcnJvciAtIFBhZ2luYXRpb24gYW5kIHByb2dyZXNzaXZlIGxvYWQgY2Fubm90IGJlIHVzZWQgYXQgdGhlIHNhbWUgdGltZVwiKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBhZ2VcIikpIHtcblx0XHRcdFx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4UHJvZ3Jlc3NpdmVMb2FkO1xuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmluaXRpYWxpemVQcm9ncmVzc2l2ZSh0aGlzLnByb2dyZXNzaXZlTG9hZCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlBhZ2luYXRpb24gcGx1Z2luIGlzIHJlcXVpcmVkIGZvciBwcm9ncmVzc2l2ZSBhamF4IGxvYWRpbmdcIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuY3JlYXRlTG9hZGVyRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbG9hZGVyXCIpO1xuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5jcmVhdGVNc2dFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWxvYWRlci1tc2dcIik7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImFsZXJ0XCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdC8vc2V0IGFqYXggcGFyYW1zXG5cdEFqYXgucHJvdG90eXBlLnNldFBhcmFtcyA9IGZ1bmN0aW9uIChwYXJhbXMsIHVwZGF0ZSkge1xuXHRcdGlmICh1cGRhdGUpIHtcblx0XHRcdHRoaXMucGFyYW1zID0gdGhpcy5wYXJhbXMgfHwge307XG5cblx0XHRcdGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHtcblx0XHRcdFx0dGhpcy5wYXJhbXNba2V5XSA9IHBhcmFtc1trZXldO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnBhcmFtcyA9IHBhcmFtcztcblx0XHR9XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuZ2V0UGFyYW1zID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLnBhcmFtcyB8fCB7fTtcblx0fTtcblxuXHQvL2xvYWQgY29uZmlnIG9iamVjdFxuXHRBamF4LnByb3RvdHlwZS5zZXRDb25maWcgPSBmdW5jdGlvbiAoY29uZmlnKSB7XG5cdFx0dGhpcy5fbG9hZERlZmF1bHRDb25maWcoKTtcblxuXHRcdGlmICh0eXBlb2YgY29uZmlnID09IFwic3RyaW5nXCIpIHtcblx0XHRcdHRoaXMuY29uZmlnLm1ldGhvZCA9IGNvbmZpZztcblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9yICh2YXIga2V5IGluIGNvbmZpZykge1xuXHRcdFx0XHR0aGlzLmNvbmZpZ1trZXldID0gY29uZmlnW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vY3JlYXRlIGNvbmZpZyBvYmplY3QgZnJvbSBkZWZhdWx0XG5cdEFqYXgucHJvdG90eXBlLl9sb2FkRGVmYXVsdENvbmZpZyA9IGZ1bmN0aW9uIChmb3JjZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRpZiAoIXNlbGYuY29uZmlnIHx8IGZvcmNlKSB7XG5cblx0XHRcdHNlbGYuY29uZmlnID0ge307XG5cblx0XHRcdC8vbG9hZCBiYXNlIGNvbmZpZyBmcm9tIGRlZmF1bHRzXG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gc2VsZi5kZWZhdWx0Q29uZmlnKSB7XG5cdFx0XHRcdHNlbGYuY29uZmlnW2tleV0gPSBzZWxmLmRlZmF1bHRDb25maWdba2V5XTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9zZXQgcmVxdWVzdCB1cmxcblx0QWpheC5wcm90b3R5cGUuc2V0VXJsID0gZnVuY3Rpb24gKHVybCkge1xuXHRcdHRoaXMudXJsID0gdXJsO1xuXHR9O1xuXG5cdC8vZ2V0IHJlcXVlc3QgdXJsXG5cdEFqYXgucHJvdG90eXBlLmdldFVybCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy51cmw7XG5cdH07XG5cblx0Ly9sc3RhbmRhcmQgbG9hZGluZyBmdW5jdGlvblxuXHRBamF4LnByb3RvdHlwZS5sb2FkRGF0YSA9IGZ1bmN0aW9uIChpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmICh0aGlzLnByb2dyZXNzaXZlTG9hZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xvYWREYXRhUHJvZ3Jlc3NpdmUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2xvYWREYXRhU3RhbmRhcmQoaW5Qb3NpdGlvbiwgY29sdW1uc0NoYW5nZWQpO1xuXHRcdH1cblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5uZXh0UGFnZSA9IGZ1bmN0aW9uIChkaWZmKSB7XG5cdFx0dmFyIG1hcmdpbjtcblxuXHRcdGlmICghdGhpcy5sb2FkaW5nKSB7XG5cblx0XHRcdG1hcmdpbiA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4UHJvZ3Jlc3NpdmVMb2FkU2Nyb2xsTWFyZ2luIHx8IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuY2xpZW50SGVpZ2h0ICogMjtcblxuXHRcdFx0aWYgKGRpZmYgPCBtYXJnaW4pIHtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBhZ2UubmV4dFBhZ2UoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLmJsb2NrQWN0aXZlUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLnJlcXVlc3RPcmRlcisrO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLl9sb2FkRGF0YVByb2dyZXNzaXZlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5zZXREYXRhKFtdKTtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzLnBhZ2Uuc2V0UGFnZSgxKTtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5fbG9hZERhdGFTdGFuZGFyZCA9IGZ1bmN0aW9uIChpblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCkge1xuXHRcdHZhciBfdGhpczMyID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRfdGhpczMyLnNlbmRSZXF1ZXN0KGluUG9zaXRpb24pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0X3RoaXMzMi50YWJsZS5yb3dNYW5hZ2VyLnNldERhdGEoZGF0YSwgaW5Qb3NpdGlvbiwgY29sdW1uc0NoYW5nZWQpLnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRyZWplY3QoZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0cmVqZWN0KGUpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuZ2VuZXJhdGVQYXJhbXNMaXN0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWZpeCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHRwcmVmaXggPSBwcmVmaXggfHwgXCJcIjtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG5cdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGkpIHtcblx0XHRcdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdChzZWxmLmdlbmVyYXRlUGFyYW1zTGlzdChpdGVtLCBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIGkgKyBcIl1cIiA6IGkpKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAoKHR5cGVvZiBkYXRhID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihkYXRhKSkgPT09IFwib2JqZWN0XCIpIHtcblx0XHRcdGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG5cdFx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQoc2VsZi5nZW5lcmF0ZVBhcmFtc0xpc3QoZGF0YVtrZXldLCBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIGtleSArIFwiXVwiIDoga2V5KSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdG91dHB1dC5wdXNoKHsga2V5OiBwcmVmaXgsIHZhbHVlOiBkYXRhIH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuc2VyaWFsaXplUGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcykge1xuXHRcdHZhciBvdXRwdXQgPSB0aGlzLmdlbmVyYXRlUGFyYW1zTGlzdChwYXJhbXMpLFxuXHRcdCAgICBlbmNvZGVkID0gW107XG5cblx0XHRvdXRwdXQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0ZW5jb2RlZC5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChpdGVtLmtleSkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChpdGVtLnZhbHVlKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZW5jb2RlZC5qb2luKFwiJlwiKTtcblx0fTtcblxuXHQvL3NlbmQgYWpheCByZXF1ZXN0XG5cdEFqYXgucHJvdG90eXBlLnNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gKHNpbGVudCkge1xuXHRcdHZhciBfdGhpczMzID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgdXJsID0gc2VsZi51cmwsXG5cdFx0ICAgIHJlcXVlc3RObyxcblx0XHQgICAgZXNjLFxuXHRcdCAgICBxdWVyeTtcblxuXHRcdHNlbGYucmVxdWVzdE9yZGVyKys7XG5cdFx0cmVxdWVzdE5vID0gc2VsZi5yZXF1ZXN0T3JkZXI7XG5cblx0XHRzZWxmLl9sb2FkRGVmYXVsdENvbmZpZygpO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuYWpheFJlcXVlc3RpbmcuY2FsbChfdGhpczMzLnRhYmxlLCBzZWxmLnVybCwgc2VsZi5wYXJhbXMpICE9PSBmYWxzZSkge1xuXG5cdFx0XHRcdHNlbGYubG9hZGluZyA9IHRydWU7XG5cblx0XHRcdFx0aWYgKCFzaWxlbnQpIHtcblx0XHRcdFx0XHRzZWxmLnNob3dMb2FkZXIoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdF90aGlzMzMubG9hZGVyUHJvbWlzZSh1cmwsIHNlbGYuY29uZmlnLCBzZWxmLnBhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRcdGlmIChyZXF1ZXN0Tm8gPT09IHNlbGYucmVxdWVzdE9yZGVyKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmFqYXhSZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0XHRkYXRhID0gc2VsZi50YWJsZS5vcHRpb25zLmFqYXhSZXNwb25zZS5jYWxsKHNlbGYudGFibGUsIHNlbGYudXJsLCBzZWxmLnBhcmFtcywgZGF0YSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRzZWxmLmhpZGVMb2FkZXIoKTtcblx0XHRcdFx0XHRcdHNlbGYubG9hZGluZyA9IGZhbHNlO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJBamF4IFJlc3BvbnNlIEJsb2NrZWQgLSBBbiBhY3RpdmUgYWpheCByZXF1ZXN0IHdhcyBibG9ja2VkIGJ5IGFuIGF0dGVtcHQgdG8gY2hhbmdlIHRhYmxlIGRhdGEgd2hpbGUgdGhlIHJlcXVlc3Qgd2FzIGJlaW5nIG1hZGVcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiQWpheCBMb2FkIEVycm9yOiBcIiwgZXJyb3IpO1xuXHRcdFx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5hamF4RXJyb3IuY2FsbChzZWxmLnRhYmxlLCBlcnJvcik7XG5cblx0XHRcdFx0XHRzZWxmLnNob3dFcnJvcigpO1xuXG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmhpZGVMb2FkZXIoKTtcblx0XHRcdFx0XHR9LCAzMDAwKTtcblxuXHRcdFx0XHRcdHNlbGYubG9hZGluZyA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuc2hvd0xvYWRlciA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2hvdWxkTG9hZCA9IHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheExvYWRlciA9PT0gXCJmdW5jdGlvblwiID8gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhMb2FkZXIoKSA6IHRoaXMudGFibGUub3B0aW9ucy5hamF4TG9hZGVyO1xuXG5cdFx0aWYgKHNob3VsZExvYWQpIHtcblxuXHRcdFx0dGhpcy5oaWRlTG9hZGVyKCk7XG5cblx0XHRcdHdoaWxlICh0aGlzLm1zZ0VsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHR0aGlzLm1zZ0VsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5tc2dFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0fXRoaXMubXNnRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWVycm9yXCIpO1xuXHRcdFx0dGhpcy5tc2dFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbG9hZGluZ1wiKTtcblxuXHRcdFx0aWYgKHRoaXMubG9hZGluZ0VsZW1lbnQpIHtcblx0XHRcdFx0dGhpcy5tc2dFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMubG9hZGluZ0VsZW1lbnQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tc2dFbGVtZW50LmlubmVySFRNTCA9IHRoaXMudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5nZXRUZXh0KFwiYWpheHxsb2FkaW5nXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5sb2FkZXJFbGVtZW50KTtcblx0XHR9XG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuc2hvd0Vycm9yID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuaGlkZUxvYWRlcigpO1xuXG5cdFx0d2hpbGUgKHRoaXMubXNnRWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHR0aGlzLm1zZ0VsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5tc2dFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH10aGlzLm1zZ0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1sb2FkaW5nXCIpO1xuXHRcdHRoaXMubXNnRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWVycm9yXCIpO1xuXG5cdFx0aWYgKHRoaXMuZXJyb3JFbGVtZW50KSB7XG5cdFx0XHR0aGlzLm1zZ0VsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5lcnJvckVsZW1lbnQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLm1zZ0VsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmdldFRleHQoXCJhamF4fGVycm9yXCIpO1xuXHRcdH1cblxuXHRcdHRoaXMudGFibGUuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmxvYWRlckVsZW1lbnQpO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLmhpZGVMb2FkZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMubG9hZGVyRWxlbWVudC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLmxvYWRlckVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmxvYWRlckVsZW1lbnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL2RlZmF1bHQgYWpheCBjb25maWcgb2JqZWN0XG5cdEFqYXgucHJvdG90eXBlLmRlZmF1bHRDb25maWcgPSB7XG5cdFx0bWV0aG9kOiBcIkdFVFwiXG5cdH07XG5cblx0QWpheC5wcm90b3R5cGUuZGVmYXVsdFVSTEdlbmVyYXRvciA9IGZ1bmN0aW9uICh1cmwsIGNvbmZpZywgcGFyYW1zKSB7XG5cblx0XHRpZiAodXJsKSB7XG5cdFx0XHRpZiAocGFyYW1zICYmIE9iamVjdC5rZXlzKHBhcmFtcykubGVuZ3RoKSB7XG5cdFx0XHRcdGlmICghY29uZmlnLm1ldGhvZCB8fCBjb25maWcubWV0aG9kLnRvTG93ZXJDYXNlKCkgPT0gXCJnZXRcIikge1xuXHRcdFx0XHRcdGNvbmZpZy5tZXRob2QgPSBcImdldFwiO1xuXG5cdFx0XHRcdFx0dXJsICs9ICh1cmwuaW5jbHVkZXMoXCI/XCIpID8gXCImXCIgOiBcIj9cIikgKyB0aGlzLnNlcmlhbGl6ZVBhcmFtcyhwYXJhbXMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHVybDtcblx0fTtcblxuXHRBamF4LnByb3RvdHlwZS5kZWZhdWx0TG9hZGVyUHJvbWlzZSA9IGZ1bmN0aW9uICh1cmwsIGNvbmZpZywgcGFyYW1zKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb250ZW50VHlwZTtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdC8vc2V0IHVybFxuXHRcdFx0dXJsID0gc2VsZi51cmxHZW5lcmF0b3IodXJsLCBjb25maWcsIHBhcmFtcyk7XG5cblx0XHRcdC8vc2V0IGJvZHkgY29udGVudCBpZiBub3QgR0VUIHJlcXVlc3Rcblx0XHRcdGlmIChjb25maWcubWV0aG9kLnRvVXBwZXJDYXNlKCkgIT0gXCJHRVRcIikge1xuXHRcdFx0XHRjb250ZW50VHlwZSA9IF90eXBlb2Yoc2VsZi50YWJsZS5vcHRpb25zLmFqYXhDb250ZW50VHlwZSkgPT09IFwib2JqZWN0XCIgPyBzZWxmLnRhYmxlLm9wdGlvbnMuYWpheENvbnRlbnRUeXBlIDogc2VsZi5jb250ZW50VHlwZUZvcm1hdHRlcnNbc2VsZi50YWJsZS5vcHRpb25zLmFqYXhDb250ZW50VHlwZV07XG5cdFx0XHRcdGlmIChjb250ZW50VHlwZSkge1xuXG5cdFx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGNvbnRlbnRUeXBlLmhlYWRlcnMpIHtcblx0XHRcdFx0XHRcdGlmICghY29uZmlnLmhlYWRlcnMpIHtcblx0XHRcdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnMgPSB7fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb25maWcuaGVhZGVyc1trZXldID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRcdGNvbmZpZy5oZWFkZXJzW2tleV0gPSBjb250ZW50VHlwZS5oZWFkZXJzW2tleV07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y29uZmlnLmJvZHkgPSBjb250ZW50VHlwZS5ib2R5LmNhbGwoc2VsZiwgdXJsLCBjb25maWcsIHBhcmFtcyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQWpheCBFcnJvciAtIEludmFsaWQgYWpheENvbnRlbnRUeXBlIHZhbHVlOlwiLCBzZWxmLnRhYmxlLm9wdGlvbnMuYWpheENvbnRlbnRUeXBlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodXJsKSB7XG5cblx0XHRcdFx0Ly9jb25maWd1cmUgaGVhZGVyc1xuXHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5oZWFkZXJzID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnMgPSB7fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLmhlYWRlcnMuQWNjZXB0ID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnMuQWNjZXB0ID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5oZWFkZXJzW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdGNvbmZpZy5oZWFkZXJzW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSA9IFwiWE1MSHR0cFJlcXVlc3RcIjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLm1vZGUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRjb25maWcubW9kZSA9IFwiY29yc1wiO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbmZpZy5tb2RlID09IFwiY29yc1wiKSB7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5oZWFkZXJzW1wiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCJdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRjb25maWcuaGVhZGVyc1tcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiXSA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb25maWcuY3JlZGVudGlhbHMgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdGNvbmZpZy5jcmVkZW50aWFscyA9ICdzYW1lLW9yaWdpbic7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29uZmlnLmNyZWRlbnRpYWxzID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRjb25maWcuY3JlZGVudGlhbHMgPSAnaW5jbHVkZSc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9zZW5kIHJlcXVlc3Rcblx0XHRcdFx0ZmV0Y2godXJsLCBjb25maWcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLm9rKSB7XG5cdFx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0XHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkFqYXggTG9hZCBFcnJvciAtIEludmFsaWQgSlNPTiByZXR1cm5lZFwiLCBlcnJvcik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcIkFqYXggTG9hZCBFcnJvciAtIENvbm5lY3Rpb24gRXJyb3I6IFwiICsgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5zdGF0dXNUZXh0KTtcblx0XHRcdFx0XHRcdHJlamVjdChyZXNwb25zZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiQWpheCBMb2FkIEVycm9yIC0gQ29ubmVjdGlvbiBFcnJvcjogXCIsIGVycm9yKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkFqYXggTG9hZCBFcnJvciAtIE5vIFVSTCBTZXRcIik7XG5cdFx0XHRcdHJlc29sdmUoW10pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEFqYXgucHJvdG90eXBlLmNvbnRlbnRUeXBlRm9ybWF0dGVycyA9IHtcblx0XHRcImpzb25cIjoge1xuXHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG5cdFx0XHR9LFxuXHRcdFx0Ym9keTogZnVuY3Rpb24gYm9keSh1cmwsIGNvbmZpZywgcGFyYW1zKSB7XG5cdFx0XHRcdHJldHVybiBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0XCJmb3JtXCI6IHtcblx0XHRcdGhlYWRlcnM6IHt9LFxuXHRcdFx0Ym9keTogZnVuY3Rpb24gYm9keSh1cmwsIGNvbmZpZywgcGFyYW1zKSB7XG5cdFx0XHRcdHZhciBvdXRwdXQgPSB0aGlzLmdlbmVyYXRlUGFyYW1zTGlzdChwYXJhbXMpLFxuXHRcdFx0XHQgICAgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuXG5cdFx0XHRcdG91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0Zm9ybS5hcHBlbmQoaXRlbS5rZXksIGl0ZW0udmFsdWUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gZm9ybTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImFqYXhcIiwgQWpheCk7XG5cblx0dmFyIENvbHVtbkNhbGNzID0gZnVuY3Rpb24gQ29sdW1uQ2FsY3ModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy50b3BDYWxjcyA9IFtdO1xuXHRcdHRoaXMuYm90Q2FsY3MgPSBbXTtcblx0XHR0aGlzLmdlbkNvbHVtbiA9IGZhbHNlO1xuXHRcdHRoaXMudG9wRWxlbWVudCA9IHRoaXMuY3JlYXRlRWxlbWVudCgpO1xuXHRcdHRoaXMuYm90RWxlbWVudCA9IHRoaXMuY3JlYXRlRWxlbWVudCgpO1xuXHRcdHRoaXMudG9wUm93ID0gZmFsc2U7XG5cdFx0dGhpcy5ib3RSb3cgPSBmYWxzZTtcblx0XHR0aGlzLnRvcEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0dGhpcy5ib3RJbml0aWFsaXplZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5pbml0aWFsaXplKCk7XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNhbGNzLWhvbGRlclwiKTtcblx0XHRyZXR1cm4gZWw7XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5nZW5Db2x1bW4gPSBuZXcgQ29sdW1uKHsgZmllbGQ6IFwidmFsdWVcIiB9LCB0aGlzKTtcblx0fTtcblxuXHQvL2R1bW15IGZ1bmN0aW9ucyB0byBoYW5kbGUgYmVpbmcgbW9jayBjb2x1bW4gbWFuYWdlclxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUucmVnaXN0ZXJDb2x1bW5GaWVsZCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gY2FsY3Ncblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIGRlZiA9IGNvbHVtbi5kZWZpbml0aW9uO1xuXG5cdFx0dmFyIGNvbmZpZyA9IHtcblx0XHRcdHRvcENhbGNQYXJhbXM6IGRlZi50b3BDYWxjUGFyYW1zIHx8IHt9LFxuXHRcdFx0Ym90Q2FsY1BhcmFtczogZGVmLmJvdHRvbUNhbGNQYXJhbXMgfHwge31cblx0XHR9O1xuXG5cdFx0aWYgKGRlZi50b3BDYWxjKSB7XG5cblx0XHRcdHN3aXRjaCAoX3R5cGVvZihkZWYudG9wQ2FsYykpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGlmICh0aGlzLmNhbGN1bGF0aW9uc1tkZWYudG9wQ2FsY10pIHtcblx0XHRcdFx0XHRcdGNvbmZpZy50b3BDYWxjID0gdGhpcy5jYWxjdWxhdGlvbnNbZGVmLnRvcENhbGNdO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gQ2FsYyBFcnJvciAtIE5vIHN1Y2ggY2FsY3VsYXRpb24gZm91bmQsIGlnbm9yaW5nOiBcIiwgZGVmLnRvcENhbGMpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb25maWcudG9wQ2FsYyA9IGRlZi50b3BDYWxjO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHR9XG5cblx0XHRcdGlmIChjb25maWcudG9wQ2FsYykge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjcyA9IGNvbmZpZztcblx0XHRcdFx0dGhpcy50b3BDYWxjcy5wdXNoKGNvbHVtbik7XG5cblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcImdyb3VwXCIpIHtcblx0XHRcdFx0XHR0aGlzLmluaXRpYWxpemVUb3BSb3coKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChkZWYuYm90dG9tQ2FsYykge1xuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGRlZi5ib3R0b21DYWxjKSkge1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYgKHRoaXMuY2FsY3VsYXRpb25zW2RlZi5ib3R0b21DYWxjXSkge1xuXHRcdFx0XHRcdFx0Y29uZmlnLmJvdENhbGMgPSB0aGlzLmNhbGN1bGF0aW9uc1tkZWYuYm90dG9tQ2FsY107XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBDYWxjIEVycm9yIC0gTm8gc3VjaCBjYWxjdWxhdGlvbiBmb3VuZCwgaWdub3Jpbmc6IFwiLCBkZWYuYm90dG9tQ2FsYyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGNvbmZpZy5ib3RDYWxjID0gZGVmLmJvdHRvbUNhbGM7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbmZpZy5ib3RDYWxjKSB7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzID0gY29uZmlnO1xuXHRcdFx0XHR0aGlzLmJvdENhbGNzLnB1c2goY29sdW1uKTtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwiZ3JvdXBcIikge1xuXHRcdFx0XHRcdHRoaXMuaW5pdGlhbGl6ZUJvdHRvbVJvdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZW1vdmVDYWxjcyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY2hhbmdlZCA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMudG9wSW5pdGlhbGl6ZWQpIHtcblx0XHRcdHRoaXMudG9wSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9wRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMudG9wRWxlbWVudCk7XG5cdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0dGhpcy5ib3RJbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLnJlbW92ZSh0aGlzLmJvdEVsZW1lbnQpO1xuXHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZWQpIHtcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmluaXRpYWxpemVUb3BSb3cgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKCF0aGlzLnRvcEluaXRpYWxpemVkKSB7XG5cdFx0XHQvLyB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuaGVhZGVyc0VsZW1lbnQuYWZ0ZXIodGhpcy50b3BFbGVtZW50KTtcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkuaW5zZXJ0QmVmb3JlKHRoaXMudG9wRWxlbWVudCwgdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmhlYWRlcnNFbGVtZW50Lm5leHRTaWJsaW5nKTtcblx0XHRcdHRoaXMudG9wSW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaW5pdGlhbGl6ZUJvdHRvbVJvdyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoIXRoaXMuYm90SW5pdGlhbGl6ZWQpIHtcblx0XHRcdHRoaXMudGFibGUuZm9vdGVyTWFuYWdlci5wcmVwZW5kKHRoaXMuYm90RWxlbWVudCk7XG5cdFx0XHR0aGlzLmJvdEluaXRpYWxpemVkID0gdHJ1ZTtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnNjcm9sbEhvcml6b250YWwgPSBmdW5jdGlvbiAobGVmdCkge1xuXHRcdHZhciBob3pBZGp1c3QgPSAwLFxuXHRcdCAgICBzY3JvbGxXaWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkuc2Nyb2xsV2lkdGggLSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRpZiAodGhpcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0dGhpcy5ib3RSb3cuZ2V0RWxlbWVudCgpLnN0eWxlLm1hcmdpbkxlZnQgPSAtbGVmdCArIFwicHhcIjtcblx0XHR9XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnJlY2FsYyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIGRhdGEsIHJvdztcblxuXHRcdGlmICh0aGlzLnRvcEluaXRpYWxpemVkIHx8IHRoaXMuYm90SW5pdGlhbGl6ZWQpIHtcblx0XHRcdGRhdGEgPSB0aGlzLnJvd3NUb0RhdGEocm93cyk7XG5cblx0XHRcdGlmICh0aGlzLnRvcEluaXRpYWxpemVkKSB7XG5cdFx0XHRcdGlmICh0aGlzLnRvcFJvdykge1xuXHRcdFx0XHRcdHRoaXMudG9wUm93LmRlbGV0ZUNlbGxzKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyb3cgPSB0aGlzLmdlbmVyYXRlUm93KFwidG9wXCIsIHRoaXMucm93c1RvRGF0YShyb3dzKSk7XG5cdFx0XHRcdHRoaXMudG9wUm93ID0gcm93O1xuXHRcdFx0XHR3aGlsZSAodGhpcy50b3BFbGVtZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHR0aGlzLnRvcEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy50b3BFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR9dGhpcy50b3BFbGVtZW50LmFwcGVuZENoaWxkKHJvdy5nZXRFbGVtZW50KCkpO1xuXHRcdFx0XHRyb3cuaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuYm90SW5pdGlhbGl6ZWQpIHtcblx0XHRcdFx0aWYgKHRoaXMuYm90Um93KSB7XG5cdFx0XHRcdFx0dGhpcy5ib3RSb3cuZGVsZXRlQ2VsbHMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvdyA9IHRoaXMuZ2VuZXJhdGVSb3coXCJib3R0b21cIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0XHRcdFx0dGhpcy5ib3RSb3cgPSByb3c7XG5cdFx0XHRcdHdoaWxlICh0aGlzLmJvdEVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdHRoaXMuYm90RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmJvdEVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdH10aGlzLmJvdEVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cblx0XHRcdC8vc2V0IHJlc2l6YWJsZSBoYW5kbGVzXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmcm96ZW5Db2x1bW5zXCIpKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxheW91dCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUucmVjYWxjUm93R3JvdXAgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dGhpcy5yZWNhbGNHcm91cCh0aGlzLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmdldFJvd0dyb3VwKHJvdykpO1xuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZWNhbGNBbGwgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzMzQgPSB0aGlzO1xuXG5cdFx0aWYgKHRoaXMudG9wQ2FsY3MubGVuZ3RoIHx8IHRoaXMuYm90Q2FsY3MubGVuZ3RoKSB7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9PSBcImdyb3VwXCIpIHtcblx0XHRcdFx0dGhpcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9PSBcInRhYmxlXCIpIHtcblxuXHRcdFx0XHR2YXIgZ3JvdXBzID0gdGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0Q2hpbGRHcm91cHMoKTtcblxuXHRcdFx0XHRncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0XHRfdGhpczM0LnJlY2FsY0dyb3VwKGdyb3VwKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5yZWNhbGNHcm91cCA9IGZ1bmN0aW9uIChncm91cCkge1xuXHRcdHZhciBkYXRhLCByb3dEYXRhO1xuXG5cdFx0aWYgKGdyb3VwKSB7XG5cdFx0XHRpZiAoZ3JvdXAuY2FsY3MpIHtcblx0XHRcdFx0aWYgKGdyb3VwLmNhbGNzLmJvdHRvbSkge1xuXHRcdFx0XHRcdGRhdGEgPSB0aGlzLnJvd3NUb0RhdGEoZ3JvdXAucm93cyk7XG5cdFx0XHRcdFx0cm93RGF0YSA9IHRoaXMuZ2VuZXJhdGVSb3dEYXRhKFwiYm90dG9tXCIsIGRhdGEpO1xuXG5cdFx0XHRcdFx0Z3JvdXAuY2FsY3MuYm90dG9tLnVwZGF0ZURhdGEocm93RGF0YSk7XG5cdFx0XHRcdFx0Z3JvdXAuY2FsY3MuYm90dG9tLnJlaW5pdGlhbGl6ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGdyb3VwLmNhbGNzLnRvcCkge1xuXHRcdFx0XHRcdGRhdGEgPSB0aGlzLnJvd3NUb0RhdGEoZ3JvdXAucm93cyk7XG5cdFx0XHRcdFx0cm93RGF0YSA9IHRoaXMuZ2VuZXJhdGVSb3dEYXRhKFwidG9wXCIsIGRhdGEpO1xuXG5cdFx0XHRcdFx0Z3JvdXAuY2FsY3MudG9wLnVwZGF0ZURhdGEocm93RGF0YSk7XG5cdFx0XHRcdFx0Z3JvdXAuY2FsY3MudG9wLnJlaW5pdGlhbGl6ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vZ2VuZXJhdGUgdG9wIHN0YXRzIHJvd1xuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuZ2VuZXJhdGVUb3BSb3cgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHJldHVybiB0aGlzLmdlbmVyYXRlUm93KFwidG9wXCIsIHRoaXMucm93c1RvRGF0YShyb3dzKSk7XG5cdH07XG5cdC8vZ2VuZXJhdGUgYm90dG9tIHN0YXRzIHJvd1xuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuZ2VuZXJhdGVCb3R0b21Sb3cgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHJldHVybiB0aGlzLmdlbmVyYXRlUm93KFwiYm90dG9tXCIsIHRoaXMucm93c1RvRGF0YShyb3dzKSk7XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLnJvd3NUb0RhdGEgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHZhciBfdGhpczM1ID0gdGhpcztcblxuXHRcdHZhciBkYXRhID0gW107XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0ZGF0YS5wdXNoKHJvdy5nZXREYXRhKCkpO1xuXG5cdFx0XHRpZiAoX3RoaXMzNS50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIF90aGlzMzUudGFibGUub3B0aW9ucy5kYXRhVHJlZUNoaWxkQ29sdW1uQ2FsY3MpIHtcblx0XHRcdFx0aWYgKHJvdy5tb2R1bGVzLmRhdGFUcmVlLm9wZW4pIHtcblx0XHRcdFx0XHR2YXIgY2hpbGRyZW4gPSBfdGhpczM1LnJvd3NUb0RhdGEoX3RoaXMzNS50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldEZpbHRlcmVkVHJlZUNoaWxkcmVuKHJvdykpO1xuXHRcdFx0XHRcdGRhdGEgPSBkYXRhLmNvbmNhdChjaGlsZHJlbik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBkYXRhO1xuXHR9O1xuXG5cdC8vZ2VuZXJhdGUgc3RhdHMgcm93XG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5nZW5lcmF0ZVJvdyA9IGZ1bmN0aW9uIChwb3MsIGRhdGEpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd0RhdGEgPSB0aGlzLmdlbmVyYXRlUm93RGF0YShwb3MsIGRhdGEpLFxuXHRcdCAgICByb3c7XG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubXV0YXRvci5kaXNhYmxlKCk7XG5cdFx0fVxuXG5cdFx0cm93ID0gbmV3IFJvdyhyb3dEYXRhLCB0aGlzLCBcImNhbGNcIik7XG5cblx0XHRpZiAoc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubXV0YXRvci5lbmFibGUoKTtcblx0XHR9XG5cblx0XHRyb3cuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY2FsY3NcIiwgXCJ0YWJ1bGF0b3ItY2FsY3MtXCIgKyBwb3MpO1xuXG5cdFx0cm93LmdlbmVyYXRlQ2VsbHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRcdHZhciBjZWxscyA9IFtdO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdFx0Ly9zZXQgZmllbGQgbmFtZSBvZiBtb2NrIGNvbHVtblxuXHRcdFx0XHRzZWxmLmdlbkNvbHVtbi5zZXRGaWVsZChjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0XHRcdHNlbGYuZ2VuQ29sdW1uLmhvekFsaWduID0gY29sdW1uLmhvekFsaWduO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJcIl0gJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikpIHtcblxuXHRcdFx0XHRcdHNlbGYuZ2VuQ29sdW1uLm1vZHVsZXMuZm9ybWF0ID0ge1xuXHRcdFx0XHRcdFx0Zm9ybWF0dGVyOiBzZWxmLnRhYmxlLm1vZHVsZXMuZm9ybWF0LmdldEZvcm1hdHRlcihjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJcIl0pLFxuXHRcdFx0XHRcdFx0cGFyYW1zOiBjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJQYXJhbXNcIl1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYuZ2VuQ29sdW1uLm1vZHVsZXMuZm9ybWF0ID0ge1xuXHRcdFx0XHRcdFx0Zm9ybWF0dGVyOiBzZWxmLnRhYmxlLm1vZHVsZXMuZm9ybWF0LmdldEZvcm1hdHRlcihcInBsYWludGV4dFwiKSxcblx0XHRcdFx0XHRcdHBhcmFtczoge31cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9lbnN1cmUgY3NzIGNsYXNzIGRlZmludGlvbiBpcyByZXBsaWNhdGVkIHRvIGNhbGN1bGF0aW9uIGNlbGxcblx0XHRcdFx0c2VsZi5nZW5Db2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcyA9IGNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzO1xuXG5cdFx0XHRcdC8vZ2VuZXJhdGUgY2VsbCBhbmQgYXNzaWduIHRvIGNvcnJlY3QgY29sdW1uXG5cdFx0XHRcdHZhciBjZWxsID0gbmV3IENlbGwoc2VsZi5nZW5Db2x1bW4sIHJvdyk7XG5cdFx0XHRcdGNlbGwuY29sdW1uID0gY29sdW1uO1xuXHRcdFx0XHRjZWxsLnNldFdpZHRoKCk7XG5cblx0XHRcdFx0Y29sdW1uLmNlbGxzLnB1c2goY2VsbCk7XG5cdFx0XHRcdGNlbGxzLnB1c2goY2VsbCk7XG5cblx0XHRcdFx0aWYgKCFjb2x1bW4udmlzaWJsZSkge1xuXHRcdFx0XHRcdGNlbGwuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5jZWxscyA9IGNlbGxzO1xuXHRcdH07XG5cblx0XHRyZXR1cm4gcm93O1xuXHR9O1xuXG5cdC8vZ2VuZXJhdGUgc3RhdHMgcm93XG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5nZW5lcmF0ZVJvd0RhdGEgPSBmdW5jdGlvbiAocG9zLCBkYXRhKSB7XG5cdFx0dmFyIHJvd0RhdGEgPSB7fSxcblx0XHQgICAgY2FsY3MgPSBwb3MgPT0gXCJ0b3BcIiA/IHRoaXMudG9wQ2FsY3MgOiB0aGlzLmJvdENhbGNzLFxuXHRcdCAgICB0eXBlID0gcG9zID09IFwidG9wXCIgPyBcInRvcENhbGNcIiA6IFwiYm90Q2FsY1wiLFxuXHRcdCAgICBwYXJhbXMsXG5cdFx0ICAgIHBhcmFtS2V5O1xuXG5cdFx0Y2FsY3MuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHR2YXIgdmFsdWVzID0gW107XG5cblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjcyAmJiBjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjc1t0eXBlXSkge1xuXHRcdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHR2YWx1ZXMucHVzaChjb2x1bW4uZ2V0RmllbGRWYWx1ZShpdGVtKSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHBhcmFtS2V5ID0gdHlwZSArIFwiUGFyYW1zXCI7XG5cdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjc1twYXJhbUtleV0gPT09IFwiZnVuY3Rpb25cIiA/IGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzW3BhcmFtS2V5XSh2YWx1ZXMsIGRhdGEpIDogY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbcGFyYW1LZXldO1xuXG5cdFx0XHRcdGNvbHVtbi5zZXRGaWVsZFZhbHVlKHJvd0RhdGEsIGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzW3R5cGVdKHZhbHVlcywgZGF0YSwgcGFyYW1zKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm93RGF0YTtcblx0fTtcblxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuaGFzVG9wQ2FsY3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICEhdGhpcy50b3BDYWxjcy5sZW5ndGg7XG5cdH07XG5cblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmhhc0JvdHRvbUNhbGNzID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiAhIXRoaXMuYm90Q2FsY3MubGVuZ3RoO1xuXHR9O1xuXG5cdC8vaGFuZGxlIHRhYmxlIHJlZHJhd1xuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLnRvcFJvdykge1xuXHRcdFx0dGhpcy50b3BSb3cubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5ib3RSb3cpIHtcblx0XHRcdHRoaXMuYm90Um93Lm5vcm1hbGl6ZUhlaWdodCh0cnVlKTtcblx0XHR9XG5cdH07XG5cblx0Ly9yZXR1cm4gdGhlIGNhbGN1bGF0ZWRcblx0Q29sdW1uQ2FsY3MucHJvdG90eXBlLmdldFJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICByZXN1bHRzID0ge30sXG5cdFx0ICAgIGdyb3VwcztcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSkge1xuXHRcdFx0Z3JvdXBzID0gdGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5nZXRHcm91cHModHJ1ZSk7XG5cblx0XHRcdGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRyZXN1bHRzW2dyb3VwLmdldEtleSgpXSA9IHNlbGYuZ2V0R3JvdXBSZXN1bHRzKGdyb3VwKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHRzID0ge1xuXHRcdFx0XHR0b3A6IHRoaXMudG9wUm93ID8gdGhpcy50b3BSb3cuZ2V0RGF0YSgpIDoge30sXG5cdFx0XHRcdGJvdHRvbTogdGhpcy5ib3RSb3cgPyB0aGlzLmJvdFJvdy5nZXREYXRhKCkgOiB7fVxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0cztcblx0fTtcblxuXHQvL2dldCByZXN1bHRzIGZyb20gYSBncm91cFxuXHRDb2x1bW5DYWxjcy5wcm90b3R5cGUuZ2V0R3JvdXBSZXN1bHRzID0gZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBncm91cE9iaiA9IGdyb3VwLl9nZXRTZWxmKCksXG5cdFx0ICAgIHN1Ykdyb3VwcyA9IGdyb3VwLmdldFN1Ykdyb3VwcygpLFxuXHRcdCAgICBzdWJHcm91cFJlc3VsdHMgPSB7fSxcblx0XHQgICAgcmVzdWx0cyA9IHt9O1xuXG5cdFx0c3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKHN1Ymdyb3VwKSB7XG5cdFx0XHRzdWJHcm91cFJlc3VsdHNbc3ViZ3JvdXAuZ2V0S2V5KCldID0gc2VsZi5nZXRHcm91cFJlc3VsdHMoc3ViZ3JvdXApO1xuXHRcdH0pO1xuXG5cdFx0cmVzdWx0cyA9IHtcblx0XHRcdHRvcDogZ3JvdXBPYmouY2FsY3MudG9wID8gZ3JvdXBPYmouY2FsY3MudG9wLmdldERhdGEoKSA6IHt9LFxuXHRcdFx0Ym90dG9tOiBncm91cE9iai5jYWxjcy5ib3R0b20gPyBncm91cE9iai5jYWxjcy5ib3R0b20uZ2V0RGF0YSgpIDoge30sXG5cdFx0XHRncm91cHM6IHN1Ykdyb3VwUmVzdWx0c1xuXHRcdH07XG5cblx0XHRyZXR1cm4gcmVzdWx0cztcblx0fTtcblxuXHQvL2RlZmF1bHQgY2FsY3VsYXRpb25zXG5cdENvbHVtbkNhbGNzLnByb3RvdHlwZS5jYWxjdWxhdGlvbnMgPSB7XG5cdFx0XCJhdmdcIjogZnVuY3Rpb24gYXZnKHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcykge1xuXHRcdFx0dmFyIG91dHB1dCA9IDAsXG5cdFx0XHQgICAgcHJlY2lzaW9uID0gdHlwZW9mIGNhbGNQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gY2FsY1BhcmFtcy5wcmVjaXNpb24gOiAyO1xuXG5cdFx0XHRpZiAodmFsdWVzLmxlbmd0aCkge1xuXHRcdFx0XHRvdXRwdXQgPSB2YWx1ZXMucmVkdWNlKGZ1bmN0aW9uIChzdW0sIHZhbHVlKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHRcdFx0XHRcdHJldHVybiBzdW0gKyB2YWx1ZTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0b3V0cHV0ID0gb3V0cHV0IC8gdmFsdWVzLmxlbmd0aDtcblxuXHRcdFx0XHRvdXRwdXQgPSBwcmVjaXNpb24gIT09IGZhbHNlID8gb3V0cHV0LnRvRml4ZWQocHJlY2lzaW9uKSA6IG91dHB1dDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHBhcnNlRmxvYXQob3V0cHV0KS50b1N0cmluZygpO1xuXHRcdH0sXG5cdFx0XCJtYXhcIjogZnVuY3Rpb24gbWF4KHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcykge1xuXHRcdFx0dmFyIG91dHB1dCA9IG51bGwsXG5cdFx0XHQgICAgcHJlY2lzaW9uID0gdHlwZW9mIGNhbGNQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gY2FsY1BhcmFtcy5wcmVjaXNpb24gOiBmYWxzZTtcblxuXHRcdFx0dmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cblx0XHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXG5cdFx0XHRcdGlmICh2YWx1ZSA+IG91dHB1dCB8fCBvdXRwdXQgPT09IG51bGwpIHtcblx0XHRcdFx0XHRvdXRwdXQgPSB2YWx1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBvdXRwdXQgIT09IG51bGwgPyBwcmVjaXNpb24gIT09IGZhbHNlID8gb3V0cHV0LnRvRml4ZWQocHJlY2lzaW9uKSA6IG91dHB1dCA6IFwiXCI7XG5cdFx0fSxcblx0XHRcIm1pblwiOiBmdW5jdGlvbiBtaW4odmFsdWVzLCBkYXRhLCBjYWxjUGFyYW1zKSB7XG5cdFx0XHR2YXIgb3V0cHV0ID0gbnVsbCxcblx0XHRcdCAgICBwcmVjaXNpb24gPSB0eXBlb2YgY2FsY1BhcmFtcy5wcmVjaXNpb24gIT09IFwidW5kZWZpbmVkXCIgPyBjYWxjUGFyYW1zLnByZWNpc2lvbiA6IGZhbHNlO1xuXG5cdFx0XHR2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblxuXHRcdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cblx0XHRcdFx0aWYgKHZhbHVlIDwgb3V0cHV0IHx8IG91dHB1dCA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdG91dHB1dCA9IHZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIG91dHB1dCAhPT0gbnVsbCA/IHByZWNpc2lvbiAhPT0gZmFsc2UgPyBvdXRwdXQudG9GaXhlZChwcmVjaXNpb24pIDogb3V0cHV0IDogXCJcIjtcblx0XHR9LFxuXHRcdFwic3VtXCI6IGZ1bmN0aW9uIHN1bSh2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpIHtcblx0XHRcdHZhciBvdXRwdXQgPSAwLFxuXHRcdFx0ICAgIHByZWNpc2lvbiA9IHR5cGVvZiBjYWxjUGFyYW1zLnByZWNpc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiA/IGNhbGNQYXJhbXMucHJlY2lzaW9uIDogZmFsc2U7XG5cblx0XHRcdGlmICh2YWx1ZXMubGVuZ3RoKSB7XG5cdFx0XHRcdHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblxuXHRcdFx0XHRcdG91dHB1dCArPSAhaXNOYU4odmFsdWUpID8gTnVtYmVyKHZhbHVlKSA6IDA7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcHJlY2lzaW9uICE9PSBmYWxzZSA/IG91dHB1dC50b0ZpeGVkKHByZWNpc2lvbikgOiBvdXRwdXQ7XG5cdFx0fSxcblx0XHRcImNvbmNhdFwiOiBmdW5jdGlvbiBjb25jYXQodmFsdWVzLCBkYXRhLCBjYWxjUGFyYW1zKSB7XG5cdFx0XHR2YXIgb3V0cHV0ID0gMDtcblxuXHRcdFx0aWYgKHZhbHVlcy5sZW5ndGgpIHtcblx0XHRcdFx0b3V0cHV0ID0gdmFsdWVzLnJlZHVjZShmdW5jdGlvbiAoc3VtLCB2YWx1ZSkge1xuXHRcdFx0XHRcdHJldHVybiBTdHJpbmcoc3VtKSArIFN0cmluZyh2YWx1ZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdH0sXG5cdFx0XCJjb3VudFwiOiBmdW5jdGlvbiBjb3VudCh2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpIHtcblx0XHRcdHZhciBvdXRwdXQgPSAwO1xuXG5cdFx0XHRpZiAodmFsdWVzLmxlbmd0aCkge1xuXHRcdFx0XHR2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdG91dHB1dCsrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJjb2x1bW5DYWxjc1wiLCBDb2x1bW5DYWxjcyk7XG5cblx0dmFyIENsaXBib2FyZCA9IGZ1bmN0aW9uIENsaXBib2FyZCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblx0XHR0aGlzLm1vZGUgPSB0cnVlO1xuXG5cdFx0dGhpcy5wYXN0ZVBhcnNlciA9IGZ1bmN0aW9uICgpIHt9O1xuXHRcdHRoaXMucGFzdGVBY3Rpb24gPSBmdW5jdGlvbiAoKSB7fTtcblx0XHR0aGlzLmN1c3RvbVNlbGVjdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMucm93UmFuZ2UgPSBmYWxzZTtcblx0XHR0aGlzLmJsb2NrZWQgPSB0cnVlOyAvL2Jsb2NrIGNvcHkgYWN0aW9ucyBub3Qgb3JpZ2luYXRpbmcgZnJvbSB0aGlzIGNvbW1hbmRcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzMzYgPSB0aGlzO1xuXG5cdFx0dGhpcy5tb2RlID0gdGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZDtcblxuXHRcdHRoaXMucm93UmFuZ2UgPSB0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weVJvd1JhbmdlO1xuXG5cdFx0aWYgKHRoaXMubW9kZSA9PT0gdHJ1ZSB8fCB0aGlzLm1vZGUgPT09IFwiY29weVwiKSB7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvcHlcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFyIHBsYWluLCBodG1sO1xuXG5cdFx0XHRcdGlmICghX3RoaXMzNi5ibG9ja2VkKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0aWYgKF90aGlzMzYuY3VzdG9tU2VsZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRwbGFpbiA9IF90aGlzMzYuY3VzdG9tU2VsZWN0aW9uO1xuXG5cdFx0XHRcdFx0XHRpZiAoX3RoaXMzNi50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlGb3JtYXR0ZXIpIHtcblx0XHRcdFx0XHRcdFx0cGxhaW4gPSBfdGhpczM2LnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weUZvcm1hdHRlcihcInBsYWluXCIsIHBsYWluKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aHRtbCA9IF90aGlzMzYudGFibGUubW9kdWxlcy5leHBvcnQuZ2V0SHRtbChfdGhpczM2LnJvd1JhbmdlLCBfdGhpczM2LnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weVN0eWxlZCwgX3RoaXMzNi50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlDb25maWcsIFwiY2xpcGJvYXJkXCIpO1xuXHRcdFx0XHRcdFx0cGxhaW4gPSBodG1sID8gX3RoaXMzNi5nZW5lcmF0ZVBsYWluQ29udGVudChodG1sKSA6IFwiXCI7XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczM2LnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weUZvcm1hdHRlcikge1xuXHRcdFx0XHRcdFx0XHRwbGFpbiA9IF90aGlzMzYudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKFwicGxhaW5cIiwgcGxhaW4pO1xuXHRcdFx0XHRcdFx0XHRodG1sID0gX3RoaXMzNi50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlGb3JtYXR0ZXIoXCJodG1sXCIsIGh0bWwpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSAmJiB3aW5kb3cuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHR3aW5kb3cuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCdUZXh0JywgcGxhaW4pO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZS5jbGlwYm9hcmREYXRhICYmIGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHRlLmNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9wbGFpbicsIHBsYWluKTtcblx0XHRcdFx0XHRcdGlmIChodG1sKSB7XG5cdFx0XHRcdFx0XHRcdGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCd0ZXh0L2h0bWwnLCBodG1sKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2UgaWYgKGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKSB7XG5cdFx0XHRcdFx0XHRlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCd0ZXh0L3BsYWluJywgcGxhaW4pO1xuXHRcdFx0XHRcdFx0aWYgKGh0bWwpIHtcblx0XHRcdFx0XHRcdFx0ZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9odG1sJywgaHRtbCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X3RoaXMzNi50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcGllZC5jYWxsKF90aGlzMzYudGFibGUsIHBsYWluLCBodG1sKTtcblxuXHRcdFx0XHRcdF90aGlzMzYucmVzZXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubW9kZSA9PT0gdHJ1ZSB8fCB0aGlzLm1vZGUgPT09IFwicGFzdGVcIikge1xuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJwYXN0ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRfdGhpczM2LnBhc3RlKGUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5zZXRQYXN0ZVBhcnNlcih0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkUGFzdGVQYXJzZXIpO1xuXHRcdHRoaXMuc2V0UGFzdGVBY3Rpb24odGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZFBhc3RlQWN0aW9uKTtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHRcdHRoaXMub3JpZ2luYWxTZWxlY3Rpb25UZXh0ID0gXCJcIjtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLmdlbmVyYXRlUGxhaW5Db250ZW50ID0gZnVuY3Rpb24gKGh0bWwpIHtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHR2YXIgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRob2xkZXIuaW5uZXJIVE1MID0gaHRtbDtcblxuXHRcdHZhciB0YWJsZSA9IGhvbGRlci5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRhYmxlXCIpWzBdO1xuXHRcdHZhciByb3dzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0clwiKSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0dmFyIGhlYWRlcnMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChyb3cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0aFwiKSk7XG5cdFx0XHR2YXIgY2VsbHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChyb3cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0ZFwiKSk7XG5cblx0XHRcdGNlbGxzID0gY2VsbHMuY29uY2F0KGhlYWRlcnMpO1xuXG5cdFx0XHRjZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0XHRcdHZhciB2YWwgPSBjZWxsLmlubmVySFRNTDtcblxuXHRcdFx0XHR2YWwgPSB2YWwgPT0gXCImbmJzcDtcIiA/IFwiXCIgOiB2YWw7XG5cblx0XHRcdFx0cm93RGF0YS5wdXNoKHZhbCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0b3V0cHV0LnB1c2gocm93RGF0YS5qb2luKFwiXFx0XCIpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQuam9pbihcIlxcblwiKTtcblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAocmFuZ2UsIGludGVybmFsKSB7XG5cdFx0dmFyIHJhbmdlLCBzZWwsIHRleHRSYW5nZTtcblx0XHR0aGlzLmJsb2NrZWQgPSBmYWxzZTtcblx0XHR0aGlzLmN1c3RvbVNlbGVjdGlvbiA9IGZhbHNlO1xuXG5cdFx0aWYgKHRoaXMubW9kZSA9PT0gdHJ1ZSB8fCB0aGlzLm1vZGUgPT09IFwiY29weVwiKSB7XG5cblx0XHRcdHRoaXMucm93UmFuZ2UgPSByYW5nZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weVJvd1JhbmdlO1xuXG5cdFx0XHRpZiAodHlwZW9mIHdpbmRvdy5nZXRTZWxlY3Rpb24gIT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlUmFuZ2UgIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG5cdFx0XHRcdHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHRcdFx0XHRzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG5cblx0XHRcdFx0aWYgKHNlbC50b1N0cmluZygpICYmIGludGVybmFsKSB7XG5cdFx0XHRcdFx0dGhpcy5jdXN0b21TZWxlY3Rpb24gPSBzZWwudG9TdHJpbmcoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdFx0c2VsLmFkZFJhbmdlKHJhbmdlKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIGRvY3VtZW50LnNlbGVjdGlvbiAhPSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHRleHRSYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cdFx0XHRcdHRleHRSYW5nZS5tb3ZlVG9FbGVtZW50VGV4dCh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHRcdFx0XHR0ZXh0UmFuZ2Uuc2VsZWN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7XG5cblx0XHRcdGlmIChzZWwpIHtcblx0XHRcdFx0c2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL1BBU1RFIEVWRU5UIEhBTkRMSU5HXG5cblx0Q2xpcGJvYXJkLnByb3RvdHlwZS5zZXRQYXN0ZUFjdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcblxuXHRcdHN3aXRjaCAodHlwZW9mIGFjdGlvbiA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoYWN0aW9uKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHR0aGlzLnBhc3RlQWN0aW9uID0gdGhpcy5wYXN0ZUFjdGlvbnNbYWN0aW9uXTtcblxuXHRcdFx0XHRpZiAoIXRoaXMucGFzdGVBY3Rpb24pIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJDbGlwYm9hcmQgRXJyb3IgLSBObyBzdWNoIHBhc3RlIGFjdGlvbiBmb3VuZDpcIiwgYWN0aW9uKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVBY3Rpb24gPSBhY3Rpb247XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnNldFBhc3RlUGFyc2VyID0gZnVuY3Rpb24gKHBhcnNlcikge1xuXHRcdHN3aXRjaCAodHlwZW9mIHBhcnNlciA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YocGFyc2VyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHR0aGlzLnBhc3RlUGFyc2VyID0gdGhpcy5wYXN0ZVBhcnNlcnNbcGFyc2VyXTtcblxuXHRcdFx0XHRpZiAoIXRoaXMucGFzdGVQYXJzZXIpIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJDbGlwYm9hcmQgRXJyb3IgLSBObyBzdWNoIHBhc3RlIHBhcnNlciBmb3VuZDpcIiwgcGFyc2VyKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVQYXJzZXIgPSBwYXJzZXI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnBhc3RlID0gZnVuY3Rpb24gKGUpIHtcblx0XHR2YXIgZGF0YSwgcm93RGF0YSwgcm93cztcblxuXHRcdGlmICh0aGlzLmNoZWNrUGFzZU9yaWdpbihlKSkge1xuXG5cdFx0XHRkYXRhID0gdGhpcy5nZXRQYXN0ZURhdGEoZSk7XG5cblx0XHRcdHJvd0RhdGEgPSB0aGlzLnBhc3RlUGFyc2VyLmNhbGwodGhpcywgZGF0YSk7XG5cblx0XHRcdGlmIChyb3dEYXRhKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKSB7XG5cdFx0XHRcdFx0cm93RGF0YSA9IHRoaXMubXV0YXRlRGF0YShyb3dEYXRhKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvd3MgPSB0aGlzLnBhc3RlQWN0aW9uLmNhbGwodGhpcywgcm93RGF0YSk7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRQYXN0ZWQuY2FsbCh0aGlzLnRhYmxlLCBkYXRhLCByb3dEYXRhLCByb3dzKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRQYXN0ZUVycm9yLmNhbGwodGhpcy50YWJsZSwgZGF0YSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUubXV0YXRlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG5cdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRvdXRwdXQucHVzaChzZWxmLnRhYmxlLm1vZHVsZXMubXV0YXRvci50cmFuc2Zvcm1Sb3cocm93LCBcImNsaXBib2FyZFwiKSk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0b3V0cHV0ID0gZGF0YTtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdENsaXBib2FyZC5wcm90b3R5cGUuY2hlY2tQYXNlT3JpZ2luID0gZnVuY3Rpb24gKGUpIHtcblx0XHR2YXIgdmFsaWQgPSB0cnVlO1xuXG5cdFx0aWYgKGUudGFyZ2V0LnRhZ05hbWUgIT0gXCJESVZcIiB8fCB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkge1xuXHRcdFx0dmFsaWQgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsaWQ7XG5cdH07XG5cblx0Q2xpcGJvYXJkLnByb3RvdHlwZS5nZXRQYXN0ZURhdGEgPSBmdW5jdGlvbiAoZSkge1xuXHRcdHZhciBkYXRhO1xuXG5cdFx0aWYgKHdpbmRvdy5jbGlwYm9hcmREYXRhICYmIHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG5cdFx0fSBlbHNlIGlmIChlLmNsaXBib2FyZERhdGEgJiYgZS5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuXHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSBlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0Q2xpcGJvYXJkLnByb3RvdHlwZS5wYXN0ZVBhcnNlcnMgPSB7XG5cdFx0dGFibGU6IGZ1bmN0aW9uIHRhYmxlKGNsaXBib2FyZCkge1xuXHRcdFx0dmFyIGRhdGEgPSBbXSxcblx0XHRcdCAgICBzdWNjZXNzID0gZmFsc2UsXG5cdFx0XHQgICAgaGVhZGVyRmluZFN1Y2Nlc3MgPSB0cnVlLFxuXHRcdFx0ICAgIGNvbHVtbnMgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1ucyxcblx0XHRcdCAgICBjb2x1bW5NYXAgPSBbXSxcblx0XHRcdCAgICByb3dzID0gW107XG5cblx0XHRcdC8vZ2V0IGRhdGEgZnJvbSBjbGlwYm9hcmQgaW50byBhcnJheSBvZiBjb2x1bW5zIGFuZCByb3dzLlxuXHRcdFx0Y2xpcGJvYXJkID0gY2xpcGJvYXJkLnNwbGl0KFwiXFxuXCIpO1xuXG5cdFx0XHRjbGlwYm9hcmQuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdGRhdGEucHVzaChyb3cuc3BsaXQoXCJcXHRcIikpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChkYXRhLmxlbmd0aCAmJiAhKGRhdGEubGVuZ3RoID09PSAxICYmIGRhdGFbMF0ubGVuZ3RoIDwgMikpIHtcblx0XHRcdFx0c3VjY2VzcyA9IHRydWU7XG5cblx0XHRcdFx0Ly9jaGVjayBpZiBoZWFkZXJzIGFyZSBwcmVzZW50IGJ5IHRpdGxlXG5cdFx0XHRcdGRhdGFbMF0uZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0XHR2YXIgY29sdW1uID0gY29sdW1ucy5maW5kKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZSAmJiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSAmJiB2YWx1ZS50cmltKCkgJiYgY29sdW1uLmRlZmluaXRpb24udGl0bGUudHJpbSgpID09PSB2YWx1ZS50cmltKCk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0XHRjb2x1bW5NYXAucHVzaChjb2x1bW4pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRoZWFkZXJGaW5kU3VjY2VzcyA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly9jaGVjayBpZiBjb2x1bW4gaGVhZGVycyBhcmUgcHJlc2VudCBieSBmaWVsZFxuXHRcdFx0XHRpZiAoIWhlYWRlckZpbmRTdWNjZXNzKSB7XG5cdFx0XHRcdFx0aGVhZGVyRmluZFN1Y2Nlc3MgPSB0cnVlO1xuXHRcdFx0XHRcdGNvbHVtbk1hcCA9IFtdO1xuXG5cdFx0XHRcdFx0ZGF0YVswXS5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0dmFyIGNvbHVtbiA9IGNvbHVtbnMuZmluZChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZSAmJiBjb2x1bW4uZmllbGQgJiYgdmFsdWUudHJpbSgpICYmIGNvbHVtbi5maWVsZC50cmltKCkgPT09IHZhbHVlLnRyaW0oKTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0XHRcdGNvbHVtbk1hcC5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRoZWFkZXJGaW5kU3VjY2VzcyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0aWYgKCFoZWFkZXJGaW5kU3VjY2Vzcykge1xuXHRcdFx0XHRcdFx0Y29sdW1uTWFwID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vcmVtb3ZlIGhlYWRlciByb3cgaWYgZm91bmRcblx0XHRcdFx0aWYgKGhlYWRlckZpbmRTdWNjZXNzKSB7XG5cdFx0XHRcdFx0ZGF0YS5zaGlmdCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0dmFyIHJvdyA9IHt9O1xuXG5cdFx0XHRcdFx0aXRlbS5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgaSkge1xuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbk1hcFtpXSkge1xuXHRcdFx0XHRcdFx0XHRyb3dbY29sdW1uTWFwW2ldLmZpZWxkXSA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiByb3dzO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRDbGlwYm9hcmQucHJvdG90eXBlLnBhc3RlQWN0aW9ucyA9IHtcblx0XHRyZXBsYWNlOiBmdW5jdGlvbiByZXBsYWNlKHJvd3MpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLnNldERhdGEocm93cyk7XG5cdFx0fSxcblx0XHR1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShyb3dzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy50YWJsZS51cGRhdGVPckFkZERhdGEocm93cyk7XG5cdFx0fSxcblx0XHRpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydChyb3dzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5hZGREYXRhKHJvd3MpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiY2xpcGJvYXJkXCIsIENsaXBib2FyZCk7XG5cblx0dmFyIERhdGFUcmVlID0gZnVuY3Rpb24gRGF0YVRyZWUodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7XG5cdFx0dGhpcy5pbmRlbnQgPSAxMDtcblx0XHR0aGlzLmZpZWxkID0gXCJcIjtcblx0XHR0aGlzLmNvbGxhcHNlRWwgPSBudWxsO1xuXHRcdHRoaXMuZXhwYW5kRWwgPSBudWxsO1xuXHRcdHRoaXMuYnJhbmNoRWwgPSBudWxsO1xuXHRcdHRoaXMuZWxlbWVudEZpZWxkID0gZmFsc2U7XG5cblx0XHR0aGlzLnN0YXJ0T3BlbiA9IGZ1bmN0aW9uICgpIHt9O1xuXG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSAwO1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBkdW1teUVsID0gbnVsbCxcblx0XHQgICAgZmlyc3RDb2wgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Rmlyc3RWaXNpYmlsZUNvbHVtbigpLFxuXHRcdCAgICBvcHRpb25zID0gdGhpcy50YWJsZS5vcHRpb25zO1xuXG5cdFx0dGhpcy5maWVsZCA9IG9wdGlvbnMuZGF0YVRyZWVDaGlsZEZpZWxkO1xuXHRcdHRoaXMuaW5kZW50ID0gb3B0aW9ucy5kYXRhVHJlZUNoaWxkSW5kZW50O1xuXHRcdHRoaXMuZWxlbWVudEZpZWxkID0gb3B0aW9ucy5kYXRhVHJlZUVsZW1lbnRDb2x1bW4gfHwgKGZpcnN0Q29sID8gZmlyc3RDb2wuZmllbGQgOiBmYWxzZSk7XG5cblx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQpIHtcblxuXHRcdFx0aWYgKG9wdGlvbnMuZGF0YVRyZWVCcmFuY2hFbGVtZW50ID09PSB0cnVlKSB7XG5cdFx0XHRcdHRoaXMuYnJhbmNoRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHR0aGlzLmJyYW5jaEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZGF0YS10cmVlLWJyYW5jaFwiKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHRkdW1teUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHRkdW1teUVsLmlubmVySFRNTCA9IG9wdGlvbnMuZGF0YVRyZWVCcmFuY2hFbGVtZW50O1xuXHRcdFx0XHRcdHRoaXMuYnJhbmNoRWwgPSBkdW1teUVsLmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5icmFuY2hFbCA9IG9wdGlvbnMuZGF0YVRyZWVCcmFuY2hFbGVtZW50O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKG9wdGlvbnMuZGF0YVRyZWVDb2xsYXBzZUVsZW1lbnQpIHtcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5kYXRhVHJlZUNvbGxhcHNlRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRkdW1teUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0ZHVtbXlFbC5pbm5lckhUTUwgPSBvcHRpb25zLmRhdGFUcmVlQ29sbGFwc2VFbGVtZW50O1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwgPSBkdW1teUVsLmZpcnN0Q2hpbGQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwgPSBvcHRpb25zLmRhdGFUcmVlQ29sbGFwc2VFbGVtZW50O1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmNvbGxhcHNlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0dGhpcy5jb2xsYXBzZUVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2xcIik7XG5cdFx0XHR0aGlzLmNvbGxhcHNlRWwudGFiSW5kZXggPSAwO1xuXHRcdFx0dGhpcy5jb2xsYXBzZUVsLmlubmVySFRNTCA9IFwiPGRpdiBjbGFzcz0ndGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWNvbGxhcHNlJz48L2Rpdj5cIjtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5kYXRhVHJlZUV4cGFuZEVsZW1lbnQpIHtcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5kYXRhVHJlZUV4cGFuZEVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0ZHVtbXlFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdGR1bW15RWwuaW5uZXJIVE1MID0gb3B0aW9ucy5kYXRhVHJlZUV4cGFuZEVsZW1lbnQ7XG5cdFx0XHRcdHRoaXMuZXhwYW5kRWwgPSBkdW1teUVsLmZpcnN0Q2hpbGQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmV4cGFuZEVsID0gb3B0aW9ucy5kYXRhVHJlZUV4cGFuZEVsZW1lbnQ7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuZXhwYW5kRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0dGhpcy5leHBhbmRFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sXCIpO1xuXHRcdFx0dGhpcy5leHBhbmRFbC50YWJJbmRleCA9IDA7XG5cdFx0XHR0aGlzLmV4cGFuZEVsLmlubmVySFRNTCA9IFwiPGRpdiBjbGFzcz0ndGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWV4cGFuZCc+PC9kaXY+XCI7XG5cdFx0fVxuXG5cdFx0c3dpdGNoIChfdHlwZW9mKG9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkKSkge1xuXHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0dGhpcy5zdGFydE9wZW4gPSBmdW5jdGlvbiAocm93LCBpbmRleCkge1xuXHRcdFx0XHRcdHJldHVybiBvcHRpb25zLmRhdGFUcmVlU3RhcnRFeHBhbmRlZDtcblx0XHRcdFx0fTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHR0aGlzLnN0YXJ0T3BlbiA9IG9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhpcy5zdGFydE9wZW4gPSBmdW5jdGlvbiAocm93LCBpbmRleCkge1xuXHRcdFx0XHRcdHJldHVybiBvcHRpb25zLmRhdGFUcmVlU3RhcnRFeHBhbmRlZFtpbmRleF07XG5cdFx0XHRcdH07XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuaW5pdGlhbGl6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgY2hpbGRBcnJheSA9IHJvdy5nZXREYXRhKClbdGhpcy5maWVsZF07XG5cdFx0dmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5KGNoaWxkQXJyYXkpO1xuXG5cdFx0dmFyIGNoaWxkcmVuID0gaXNBcnJheSB8fCAhaXNBcnJheSAmJiAodHlwZW9mIGNoaWxkQXJyYXkgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNoaWxkQXJyYXkpKSA9PT0gXCJvYmplY3RcIiAmJiBjaGlsZEFycmF5ICE9PSBudWxsO1xuXG5cdFx0aWYgKCFjaGlsZHJlbiAmJiByb3cubW9kdWxlcy5kYXRhVHJlZSAmJiByb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbCkge1xuXHRcdFx0cm93Lm1vZHVsZXMuZGF0YVRyZWUuYnJhbmNoRWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbCk7XG5cdFx0fVxuXG5cdFx0aWYgKCFjaGlsZHJlbiAmJiByb3cubW9kdWxlcy5kYXRhVHJlZSAmJiByb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwpIHtcblx0XHRcdHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbCk7XG5cdFx0fVxuXG5cdFx0cm93Lm1vZHVsZXMuZGF0YVRyZWUgPSB7XG5cdFx0XHRpbmRleDogMCxcblx0XHRcdG9wZW46IGNoaWxkcmVuID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUgPyByb3cubW9kdWxlcy5kYXRhVHJlZS5vcGVuIDogdGhpcy5zdGFydE9wZW4ocm93LmdldENvbXBvbmVudCgpLCAwKSA6IGZhbHNlLFxuXHRcdFx0Y29udHJvbEVsOiByb3cubW9kdWxlcy5kYXRhVHJlZSAmJiBjaGlsZHJlbiA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbCA6IGZhbHNlLFxuXHRcdFx0YnJhbmNoRWw6IHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIGNoaWxkcmVuID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUuYnJhbmNoRWwgOiBmYWxzZSxcblx0XHRcdHBhcmVudDogZmFsc2UsXG5cdFx0XHRjaGlsZHJlbjogY2hpbGRyZW5cblx0XHR9O1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5sYXlvdXRSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGNlbGwgPSB0aGlzLmVsZW1lbnRGaWVsZCA/IHJvdy5nZXRDZWxsKHRoaXMuZWxlbWVudEZpZWxkKSA6IHJvdy5nZXRDZWxscygpWzBdLFxuXHRcdCAgICBlbCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdCAgICBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZTtcblxuXHRcdGlmIChjb25maWcuYnJhbmNoRWwpIHtcblx0XHRcdGNvbmZpZy5icmFuY2hFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbmZpZy5icmFuY2hFbCk7XG5cdFx0XHRjb25maWcuYnJhbmNoRWwgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRpZiAoY29uZmlnLmNvbnRyb2xFbCkge1xuXHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbmZpZy5jb250cm9sRWwpO1xuXHRcdFx0Y29uZmlnLmNvbnRyb2xFbCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdHRoaXMuZ2VuZXJhdGVDb250cm9sRWxlbWVudChyb3csIGVsKTtcblxuXHRcdHJvdy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdHJlZS1sZXZlbC1cIiArIGNvbmZpZy5pbmRleCk7XG5cblx0XHRpZiAoY29uZmlnLmluZGV4KSB7XG5cdFx0XHRpZiAodGhpcy5icmFuY2hFbCkge1xuXHRcdFx0XHRjb25maWcuYnJhbmNoRWwgPSB0aGlzLmJyYW5jaEVsLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0ZWwuaW5zZXJ0QmVmb3JlKGNvbmZpZy5icmFuY2hFbCwgZWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdGNvbmZpZy5icmFuY2hFbC5zdHlsZS5tYXJnaW5MZWZ0ID0gKGNvbmZpZy5icmFuY2hFbC5vZmZzZXRXaWR0aCArIGNvbmZpZy5icmFuY2hFbC5zdHlsZS5tYXJnaW5SaWdodCkgKiAoY29uZmlnLmluZGV4IC0gMSkgKyBjb25maWcuaW5kZXggKiB0aGlzLmluZGVudCArIFwicHhcIjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsLnN0eWxlLnBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctbGVmdCcpKSArIGNvbmZpZy5pbmRleCAqIHRoaXMuaW5kZW50ICsgXCJweFwiO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2VuZXJhdGVDb250cm9sRWxlbWVudCA9IGZ1bmN0aW9uIChyb3csIGVsKSB7XG5cdFx0dmFyIF90aGlzMzcgPSB0aGlzO1xuXG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdCAgICBlbCA9IGVsIHx8IHJvdy5nZXRDZWxscygpWzBdLmdldEVsZW1lbnQoKSxcblx0XHQgICAgb2xkQ29udHJvbCA9IGNvbmZpZy5jb250cm9sRWw7XG5cblx0XHRpZiAoY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSkge1xuXG5cdFx0XHRpZiAoY29uZmlnLm9wZW4pIHtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbCA9IHRoaXMuY29sbGFwc2VFbC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0XHRcdGNvbmZpZy5jb250cm9sRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRfdGhpczM3LmNvbGxhcHNlUm93KHJvdyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbCA9IHRoaXMuZXhwYW5kRWwuY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0XHRjb25maWcuY29udHJvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0X3RoaXMzNy5leHBhbmRSb3cocm93KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbmZpZy5jb250cm9sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChvbGRDb250cm9sICYmIG9sZENvbnRyb2wucGFyZW50Tm9kZSA9PT0gZWwpIHtcblx0XHRcdFx0b2xkQ29udHJvbC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjb25maWcuY29udHJvbEVsLCBvbGRDb250cm9sKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsLmluc2VydEJlZm9yZShjb25maWcuY29udHJvbEVsLCBlbC5maXJzdENoaWxkKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLnNldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xuXHRcdHRoaXMuZGlzcGxheUluZGV4ID0gaW5kZXg7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5SW5kZXg7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldFJvd3MgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHZhciBfdGhpczM4ID0gdGhpcztcblxuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93LCBpKSB7XG5cdFx0XHR2YXIgY29uZmlnLCBjaGlsZHJlbjtcblxuXHRcdFx0b3V0cHV0LnB1c2gocm93KTtcblxuXHRcdFx0aWYgKHJvdyBpbnN0YW5jZW9mIFJvdykge1xuXG5cdFx0XHRcdGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNoaWxkcmVuO1xuXG5cdFx0XHRcdGlmICghY29uZmlnLmluZGV4ICYmIGNvbmZpZy5jaGlsZHJlbiAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRjaGlsZHJlbiA9IF90aGlzMzguZ2V0Q2hpbGRyZW4ocm93KTtcblxuXHRcdFx0XHRcdGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG5cdFx0XHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldENoaWxkcmVuID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBfdGhpczM5ID0gdGhpcztcblxuXHRcdHZhciBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZSxcblx0XHQgICAgY2hpbGRyZW4gPSBbXSxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHRpZiAoY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSAmJiBjb25maWcub3Blbikge1xuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZy5jaGlsZHJlbikpIHtcblx0XHRcdFx0Y29uZmlnLmNoaWxkcmVuID0gdGhpcy5nZW5lcmF0ZUNoaWxkcmVuKHJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXHRcdFx0XHRjaGlsZHJlbiA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZmlsdGVyKGNvbmZpZy5jaGlsZHJlbik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjaGlsZHJlbiA9IGNvbmZpZy5jaGlsZHJlbjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwic29ydFwiKSkge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuc29ydC5zb3J0KGNoaWxkcmVuKTtcblx0XHRcdH1cblxuXHRcdFx0Y2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcblx0XHRcdFx0b3V0cHV0LnB1c2goY2hpbGQpO1xuXG5cdFx0XHRcdHZhciBzdWJDaGlsZHJlbiA9IF90aGlzMzkuZ2V0Q2hpbGRyZW4oY2hpbGQpO1xuXG5cdFx0XHRcdHN1YkNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKHN1Yikge1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHN1Yik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZ2VuZXJhdGVDaGlsZHJlbiA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgX3RoaXM0MCA9IHRoaXM7XG5cblx0XHR2YXIgY2hpbGRyZW4gPSBbXTtcblxuXHRcdHZhciBjaGlsZEFycmF5ID0gcm93LmdldERhdGEoKVt0aGlzLmZpZWxkXTtcblxuXHRcdGlmICghQXJyYXkuaXNBcnJheShjaGlsZEFycmF5KSkge1xuXHRcdFx0Y2hpbGRBcnJheSA9IFtjaGlsZEFycmF5XTtcblx0XHR9XG5cblx0XHRjaGlsZEFycmF5LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkRGF0YSkge1xuXHRcdFx0dmFyIGNoaWxkUm93ID0gbmV3IFJvdyhjaGlsZERhdGEgfHwge30sIF90aGlzNDAudGFibGUucm93TWFuYWdlcik7XG5cdFx0XHRjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4ID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXggKyAxO1xuXHRcdFx0Y2hpbGRSb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQgPSByb3c7XG5cdFx0XHRpZiAoY2hpbGRSb3cubW9kdWxlcy5kYXRhVHJlZS5jaGlsZHJlbikge1xuXHRcdFx0XHRjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLm9wZW4gPSBfdGhpczQwLnN0YXJ0T3BlbihjaGlsZFJvdy5nZXRDb21wb25lbnQoKSwgY2hpbGRSb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleCk7XG5cdFx0XHR9XG5cdFx0XHRjaGlsZHJlbi5wdXNoKGNoaWxkUm93KTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBjaGlsZHJlbjtcblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUuZXhwYW5kUm93ID0gZnVuY3Rpb24gKHJvdywgc2lsZW50KSB7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYgKGNvbmZpZy5jaGlsZHJlbiAhPT0gZmFsc2UpIHtcblx0XHRcdGNvbmZpZy5vcGVuID0gdHJ1ZTtcblxuXHRcdFx0cm93LnJlaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJ0cmVlXCIsIGZhbHNlLCB0cnVlKTtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlUm93RXhwYW5kZWQocm93LmdldENvbXBvbmVudCgpLCByb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleCk7XG5cdFx0fVxuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5jb2xsYXBzZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWU7XG5cblx0XHRpZiAoY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSkge1xuXHRcdFx0Y29uZmlnLm9wZW4gPSBmYWxzZTtcblxuXHRcdFx0cm93LnJlaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJ0cmVlXCIsIGZhbHNlLCB0cnVlKTtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlUm93Q29sbGFwc2VkKHJvdy5nZXRDb21wb25lbnQoKSwgcm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXgpO1xuXHRcdH1cblx0fTtcblxuXHREYXRhVHJlZS5wcm90b3R5cGUudG9nZ2xlUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZTtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKSB7XG5cdFx0XHRpZiAoY29uZmlnLm9wZW4pIHtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZVJvdyhyb3cpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5leHBhbmRSb3cocm93KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmdldFRyZWVQYXJlbnQgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0cmV0dXJuIHJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudCA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudC5nZXRDb21wb25lbnQoKSA6IGZhbHNlO1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZXRGaWx0ZXJlZFRyZWVDaGlsZHJlbiA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUsXG5cdFx0ICAgIG91dHB1dCA9IFtdLFxuXHRcdCAgICBjaGlsZHJlbjtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4pIHtcblxuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZy5jaGlsZHJlbikpIHtcblx0XHRcdFx0Y29uZmlnLmNoaWxkcmVuID0gdGhpcy5nZW5lcmF0ZUNoaWxkcmVuKHJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSkge1xuXHRcdFx0XHRjaGlsZHJlbiA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZmlsdGVyKGNvbmZpZy5jaGlsZHJlbik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjaGlsZHJlbiA9IGNvbmZpZy5jaGlsZHJlbjtcblx0XHRcdH1cblxuXHRcdFx0Y2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGRSb3cpIHtcblx0XHRcdFx0aWYgKGNoaWxkUm93IGluc3RhbmNlb2YgUm93KSB7XG5cdFx0XHRcdFx0b3V0cHV0LnB1c2goY2hpbGRSb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZXRUcmVlQ2hpbGRyZW4gPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGlmIChjb25maWcuY2hpbGRyZW4pIHtcblxuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZy5jaGlsZHJlbikpIHtcblx0XHRcdFx0Y29uZmlnLmNoaWxkcmVuID0gdGhpcy5nZW5lcmF0ZUNoaWxkcmVuKHJvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbmZpZy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZFJvdykge1xuXHRcdFx0XHRpZiAoY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cpIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZFJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0RGF0YVRyZWUucHJvdG90eXBlLmNoZWNrRm9yUmVzdHlsZSA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0aWYgKCFjZWxsLnJvdy5jZWxscy5pbmRleE9mKGNlbGwpKSB7XG5cdFx0XHRpZiAoY2VsbC5yb3cubW9kdWxlcy5kYXRhVHJlZS5jaGlsZHJlbiAhPT0gZmFsc2UpIHtcblx0XHRcdFx0Y2VsbC5yb3cucmVpbml0aWFsaXplKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5nZXRDaGlsZEZpZWxkID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmZpZWxkO1xuXHR9O1xuXG5cdERhdGFUcmVlLnByb3RvdHlwZS5yZWRyYXdOZWVkZWQgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdHJldHVybiAodGhpcy5maWVsZCA/IHR5cGVvZiBkYXRhW3RoaXMuZmllbGRdICE9PSBcInVuZGVmaW5lZFwiIDogZmFsc2UpIHx8ICh0aGlzLmVsZW1lbnRGaWVsZCA/IHR5cGVvZiBkYXRhW3RoaXMuZWxlbWVudEZpZWxkXSAhPT0gXCJ1bmRlZmluZWRcIiA6IGZhbHNlKTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZGF0YVRyZWVcIiwgRGF0YVRyZWUpO1xuXG5cdHZhciBEb3dubG9hZCA9IGZ1bmN0aW9uIERvd25sb2FkKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuZmllbGRzID0ge307IC8vaG9sZCBmaWxlZCBtdWx0aSBkaW1lbnNpb24gYXJyYXlzXG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdOyAvL2hvbGQgY29sdW1ucyBpbiB0aGVpciBvcmRlciBpbiB0aGUgdGFibGVcblx0XHR0aGlzLmNvbHVtbnNCeUZpZWxkID0ge307IC8vaG9sZCBjb2x1bW5zIHdpdGggbG9va3VwIGJ5IGZpZWxkIG5hbWVcblx0XHR0aGlzLmNvbmZpZyA9IHt9O1xuXHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cdH07XG5cblx0Ly90cmlnZ2VyIGZpbGUgZG93bmxvYWRcblx0RG93bmxvYWQucHJvdG90eXBlLmRvd25sb2FkID0gZnVuY3Rpb24gKHR5cGUsIGZpbGVuYW1lLCBvcHRpb25zLCBhY3RpdmUsIGludGVyY2VwdENhbGxiYWNrKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkb3dubG9hZEZ1bmMgPSBmYWxzZTtcblx0XHR0aGlzLnByb2Nlc3NDb25maWcoKTtcblx0XHR0aGlzLmFjdGl2ZSA9IGFjdGl2ZTtcblxuXHRcdGZ1bmN0aW9uIGJ1aWxkTGluayhkYXRhLCBtaW1lKSB7XG5cdFx0XHRpZiAoaW50ZXJjZXB0Q2FsbGJhY2spIHtcblx0XHRcdFx0aWYgKGludGVyY2VwdENhbGxiYWNrID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0c2VsZi50cmlnZ2VyRG93bmxvYWQoZGF0YSwgbWltZSwgdHlwZSwgZmlsZW5hbWUsIHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGludGVyY2VwdENhbGxiYWNrKGRhdGEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLnRyaWdnZXJEb3dubG9hZChkYXRhLCBtaW1lLCB0eXBlLCBmaWxlbmFtZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiB0eXBlID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0ZG93bmxvYWRGdW5jID0gdHlwZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHNlbGYuZG93bmxvYWRlcnNbdHlwZV0pIHtcblx0XHRcdFx0ZG93bmxvYWRGdW5jID0gc2VsZi5kb3dubG9hZGVyc1t0eXBlXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIEVycm9yIC0gTm8gc3VjaCBkb3dubG9hZCB0eXBlIGZvdW5kOiBcIiwgdHlwZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5wcm9jZXNzQ29sdW1ucygpO1xuXG5cdFx0aWYgKGRvd25sb2FkRnVuYykge1xuXHRcdFx0ZG93bmxvYWRGdW5jLmNhbGwodGhpcywgc2VsZi5wcm9jZXNzRGVmaW5pdGlvbnMoKSwgc2VsZi5wcm9jZXNzRGF0YShhY3RpdmUgfHwgXCJhY3RpdmVcIiksIG9wdGlvbnMgfHwge30sIGJ1aWxkTGluaywgdGhpcy5jb25maWcpO1xuXHRcdH1cblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUucHJvY2Vzc0NvbmZpZyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY29uZmlnID0geyAvL2Rvd25sb2FkIGNvbmZpZ1xuXHRcdFx0Y29sdW1uR3JvdXBzOiB0cnVlLFxuXHRcdFx0cm93R3JvdXBzOiB0cnVlLFxuXHRcdFx0Y29sdW1uQ2FsY3M6IHRydWUsXG5cdFx0XHRkYXRhVHJlZTogdHJ1ZVxuXHRcdH07XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkQ29uZmlnKSB7XG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gdGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkQ29uZmlnKSB7XG5cdFx0XHRcdGNvbmZpZ1trZXldID0gdGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkQ29uZmlnW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5jb25maWcucm93R3JvdXBzID0gY29uZmlnLnJvd0dyb3VwcyAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKTtcblxuXHRcdGlmIChjb25maWcuY29sdW1uR3JvdXBzICYmIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zLmxlbmd0aCAhPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXgubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLmNvbmZpZy5jb2x1bW5Hcm91cHMgPSB0cnVlO1xuXHRcdH1cblxuXHRcdGlmIChjb25maWcuY29sdW1uQ2FsY3MgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSkge1xuXHRcdFx0dGhpcy5jb25maWcuY29sdW1uQ2FsY3MgPSB0cnVlO1xuXHRcdH1cblxuXHRcdGlmIChjb25maWcuZGF0YVRyZWUgJiYgdGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblx0XHRcdHRoaXMuY29uZmlnLmRhdGFUcmVlID0gdHJ1ZTtcblx0XHR9XG5cdH07XG5cblx0RG93bmxvYWQucHJvdG90eXBlLnByb2Nlc3NDb2x1bW5zID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuY29sdW1uc0J5SW5kZXggPSBbXTtcblx0XHRzZWxmLmNvbHVtbnNCeUZpZWxkID0ge307XG5cblx0XHRzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cblx0XHRcdGlmIChjb2x1bW4uZmllbGQgJiYgY29sdW1uLmRlZmluaXRpb24uZG93bmxvYWQgIT09IGZhbHNlICYmIChjb2x1bW4udmlzaWJsZSB8fCAhY29sdW1uLnZpc2libGUgJiYgY29sdW1uLmRlZmluaXRpb24uZG93bmxvYWQpKSB7XG5cdFx0XHRcdHNlbGYuY29sdW1uc0J5SW5kZXgucHVzaChjb2x1bW4pO1xuXHRcdFx0XHRzZWxmLmNvbHVtbnNCeUZpZWxkW2NvbHVtbi5maWVsZF0gPSBjb2x1bW47XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0RG93bmxvYWQucHJvdG90eXBlLnByb2Nlc3NEZWZpbml0aW9ucyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHByb2Nlc3NlZERlZmluaXRpb25zID0gW107XG5cblx0XHRpZiAodGhpcy5jb25maWcuY29sdW1uR3JvdXBzKSB7XG5cdFx0XHRzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0dmFyIGNvbERhdGEgPSBzZWxmLnByb2Nlc3NDb2x1bW5Hcm91cChjb2x1bW4pO1xuXG5cdFx0XHRcdGlmIChjb2xEYXRhKSB7XG5cdFx0XHRcdFx0cHJvY2Vzc2VkRGVmaW5pdGlvbnMucHVzaChjb2xEYXRhKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRcdGlmIChjb2x1bW4uZG93bmxvYWQgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0Ly9pc29sYXRlIGRlZmluaXRvbiBmcm9tIGRlZmludGlvbiBvYmplY3Rcblx0XHRcdFx0XHRwcm9jZXNzZWREZWZpbml0aW9ucy5wdXNoKHNlbGYucHJvY2Vzc0RlZmluaXRpb24oY29sdW1uKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBwcm9jZXNzZWREZWZpbml0aW9ucztcblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUucHJvY2Vzc0NvbHVtbkdyb3VwID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBfdGhpczQxID0gdGhpcztcblxuXHRcdHZhciBzdWJHcm91cHMgPSBjb2x1bW4uY29sdW1ucyxcblx0XHQgICAgbWF4RGVwdGggPSAwO1xuXHRcdHZhciBwcm9jZXNzZWRDb2x1bW4gPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uKGNvbHVtbik7XG5cdFx0dmFyIGdyb3VwRGF0YSA9IHtcblx0XHRcdHR5cGU6IFwiZ3JvdXBcIixcblx0XHRcdHRpdGxlOiBwcm9jZXNzZWRDb2x1bW4udGl0bGUsXG5cdFx0XHRkZXB0aDogMVxuXHRcdH07XG5cblx0XHRpZiAoc3ViR3JvdXBzLmxlbmd0aCkge1xuXHRcdFx0Z3JvdXBEYXRhLnN1Ykdyb3VwcyA9IFtdO1xuXHRcdFx0Z3JvdXBEYXRhLndpZHRoID0gMDtcblxuXHRcdFx0c3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKHN1Ykdyb3VwKSB7XG5cdFx0XHRcdHZhciBzdWJHcm91cERhdGEgPSBfdGhpczQxLnByb2Nlc3NDb2x1bW5Hcm91cChzdWJHcm91cCk7XG5cblx0XHRcdFx0aWYgKHN1Ykdyb3VwRGF0YS5kZXB0aCA+IG1heERlcHRoKSB7XG5cdFx0XHRcdFx0bWF4RGVwdGggPSBzdWJHcm91cERhdGEuZGVwdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3ViR3JvdXBEYXRhKSB7XG5cdFx0XHRcdFx0Z3JvdXBEYXRhLndpZHRoICs9IHN1Ykdyb3VwRGF0YS53aWR0aDtcblx0XHRcdFx0XHRncm91cERhdGEuc3ViR3JvdXBzLnB1c2goc3ViR3JvdXBEYXRhKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGdyb3VwRGF0YS5kZXB0aCArPSBtYXhEZXB0aDtcblxuXHRcdFx0aWYgKCFncm91cERhdGEud2lkdGgpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoY29sdW1uLmZpZWxkICYmIGNvbHVtbi5kZWZpbml0aW9uLmRvd25sb2FkICE9PSBmYWxzZSAmJiAoY29sdW1uLnZpc2libGUgfHwgIWNvbHVtbi52aXNpYmxlICYmIGNvbHVtbi5kZWZpbml0aW9uLmRvd25sb2FkKSkge1xuXHRcdFx0XHRncm91cERhdGEud2lkdGggPSAxO1xuXHRcdFx0XHRncm91cERhdGEuZGVmaW5pdGlvbiA9IHByb2Nlc3NlZENvbHVtbjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZ3JvdXBEYXRhO1xuXHR9O1xuXG5cdERvd25sb2FkLnByb3RvdHlwZS5wcm9jZXNzRGVmaW5pdGlvbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgZGVmID0ge307XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gY29sdW1uLmRlZmluaXRpb24pIHtcblx0XHRcdGRlZltrZXldID0gY29sdW1uLmRlZmluaXRpb25ba2V5XTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmRvd25sb2FkVGl0bGUgIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0ZGVmLnRpdGxlID0gY29sdW1uLmRlZmluaXRpb24uZG93bmxvYWRUaXRsZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGVmO1xuXHR9O1xuXG5cdERvd25sb2FkLnByb3RvdHlwZS5wcm9jZXNzRGF0YSA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcblx0XHR2YXIgX3RoaXM0MiA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGRhdGEgPSBbXSxcblx0XHQgICAgZ3JvdXBzID0gW10sXG5cdFx0ICAgIHJvd3MgPSBmYWxzZSxcblx0XHQgICAgY2FsY3MgPSB7fTtcblxuXHRcdGlmICh0aGlzLmNvbmZpZy5yb3dHcm91cHMpIHtcblxuXHRcdFx0aWYgKGFjdGl2ZSA9PSBcInZpc2libGVcIikge1xuXG5cdFx0XHRcdHJvd3MgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cyhhY3RpdmUpO1xuXG5cdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0aWYgKHJvdy50eXBlID09IFwicm93XCIpIHtcblx0XHRcdFx0XHRcdHZhciBncm91cCA9IHJvdy5nZXRHcm91cCgpO1xuXG5cdFx0XHRcdFx0XHRpZiAoZ3JvdXBzLmluZGV4T2YoZ3JvdXApID09PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRncm91cHMucHVzaChncm91cCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdyb3VwcyA9IHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0R3JvdXBzKCk7XG5cdFx0XHR9XG5cblx0XHRcdGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRkYXRhLnB1c2goX3RoaXM0Mi5wcm9jZXNzR3JvdXBEYXRhKGdyb3VwLCByb3dzKSk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHRoaXMuY29uZmlnLmRhdGFUcmVlKSB7XG5cdFx0XHRcdGFjdGl2ZSA9IGFjdGl2ZSA9IFwiYWN0aXZlXCIgPyBcImRpc3BsYXlcIiA6IGFjdGl2ZTtcblx0XHRcdH1cblx0XHRcdGRhdGEgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGF0YShhY3RpdmUsIFwiZG93bmxvYWRcIik7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRjYWxjcyA9IHRoaXMudGFibGUuZ2V0Q2FsY1Jlc3VsdHMoKTtcblxuXHRcdFx0ZGF0YSA9IHtcblx0XHRcdFx0Y2FsY3M6IGNhbGNzLFxuXHRcdFx0XHRkYXRhOiBkYXRhXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdC8vYnVsayBkYXRhIHByb2Nlc3Npbmdcblx0XHRpZiAodHlwZW9mIHNlbGYudGFibGUub3B0aW9ucy5kb3dubG9hZERhdGFGb3JtYXR0ZXIgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRkYXRhID0gc2VsZi50YWJsZS5vcHRpb25zLmRvd25sb2FkRGF0YUZvcm1hdHRlcihkYXRhKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUucHJvY2Vzc0dyb3VwRGF0YSA9IGZ1bmN0aW9uIChncm91cCwgdmlzUm93cykge1xuXHRcdHZhciBfdGhpczQzID0gdGhpcztcblxuXHRcdHZhciBzdWJHcm91cHMgPSBncm91cC5nZXRTdWJHcm91cHMoKTtcblxuXHRcdHZhciBncm91cERhdGEgPSB7XG5cdFx0XHR0eXBlOiBcImdyb3VwXCIsXG5cdFx0XHRrZXk6IGdyb3VwLmtleVxuXHRcdH07XG5cblx0XHRpZiAoc3ViR3JvdXBzLmxlbmd0aCkge1xuXHRcdFx0Z3JvdXBEYXRhLnN1Ykdyb3VwcyA9IFtdO1xuXG5cdFx0XHRzdWJHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoc3ViR3JvdXApIHtcblx0XHRcdFx0Z3JvdXBEYXRhLnN1Ykdyb3Vwcy5wdXNoKF90aGlzNDMucHJvY2Vzc0dyb3VwRGF0YShzdWJHcm91cCwgdmlzUm93cykpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh2aXNSb3dzKSB7XG5cdFx0XHRcdGdyb3VwRGF0YS5yb3dzID0gW107XG5cblx0XHRcdFx0Z3JvdXAucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRpZiAodmlzUm93cy5pbmRleE9mKHJvdykgPiAtMSkge1xuXHRcdFx0XHRcdFx0Z3JvdXBEYXRhLnJvd3MucHVzaChyb3cuZ2V0RGF0YShcImRvd25sb2FkXCIpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3JvdXBEYXRhLnJvd3MgPSBncm91cC5nZXREYXRhKHRydWUsIFwiZG93bmxvYWRcIik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGdyb3VwRGF0YTtcblx0fTtcblxuXHREb3dubG9hZC5wcm90b3R5cGUudHJpZ2dlckRvd25sb2FkID0gZnVuY3Rpb24gKGRhdGEsIG1pbWUsIHR5cGUsIGZpbGVuYW1lLCBuZXdUYWIpIHtcblx0XHR2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSxcblx0XHQgICAgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwgeyB0eXBlOiBtaW1lIH0pLFxuXHRcdCAgICBmaWxlbmFtZSA9IGZpbGVuYW1lIHx8IFwiVGFidWxhdG9yLlwiICsgKHR5cGVvZiB0eXBlID09PSBcImZ1bmN0aW9uXCIgPyBcInR4dFwiIDogdHlwZSk7XG5cblx0XHRibG9iID0gdGhpcy50YWJsZS5vcHRpb25zLmRvd25sb2FkUmVhZHkuY2FsbCh0aGlzLnRhYmxlLCBkYXRhLCBibG9iKTtcblxuXHRcdGlmIChibG9iKSB7XG5cblx0XHRcdGlmIChuZXdUYWIpIHtcblx0XHRcdFx0d2luZG93Lm9wZW4od2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XG5cdFx0XHRcdFx0bmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IoYmxvYiwgZmlsZW5hbWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKCdocmVmJywgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpO1xuXG5cdFx0XHRcdFx0Ly9zZXQgZmlsZSB0aXRsZVxuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcblxuXHRcdFx0XHRcdC8vdHJpZ2dlciBkb3dubG9hZFxuXHRcdFx0XHRcdGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuXHRcdFx0XHRcdGVsZW1lbnQuY2xpY2soKTtcblxuXHRcdFx0XHRcdC8vcmVtb3ZlIHRlbXBvcmFyeSBsaW5rIGVsZW1lbnRcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRDb21wbGV0ZSkge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRDb21wbGV0ZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL25lc3RlZCBmaWVsZCBsb29rdXBcblx0RG93bmxvYWQucHJvdG90eXBlLmdldEZpZWxkVmFsdWUgPSBmdW5jdGlvbiAoZmllbGQsIGRhdGEpIHtcblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5zQnlGaWVsZFtmaWVsZF07XG5cblx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRyZXR1cm4gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG5cdERvd25sb2FkLnByb3RvdHlwZS5jb21tc1JlY2VpdmVkID0gZnVuY3Rpb24gKHRhYmxlLCBhY3Rpb24sIGRhdGEpIHtcblx0XHRzd2l0Y2ggKGFjdGlvbikge1xuXHRcdFx0Y2FzZSBcImludGVyY2VwdFwiOlxuXHRcdFx0XHR0aGlzLmRvd25sb2FkKGRhdGEudHlwZSwgXCJcIiwgZGF0YS5vcHRpb25zLCBkYXRhLmFjdGl2ZSwgZGF0YS5pbnRlcmNlcHQpO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH07XG5cblx0Ly9kb3dubG9hZGVyc1xuXHREb3dubG9hZC5wcm90b3R5cGUuZG93bmxvYWRlcnMgPSB7XG5cdFx0Y3N2OiBmdW5jdGlvbiBjc3YoY29sdW1ucywgZGF0YSwgb3B0aW9ucywgc2V0RmlsZUNvbnRlbnRzLCBjb25maWcpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdCAgICB0aXRsZXMgPSBbXSxcblx0XHRcdCAgICBmaWVsZHMgPSBbXSxcblx0XHRcdCAgICBkZWxpbWl0ZXIgPSBvcHRpb25zICYmIG9wdGlvbnMuZGVsaW1pdGVyID8gb3B0aW9ucy5kZWxpbWl0ZXIgOiBcIixcIixcblx0XHRcdCAgICBmaWxlQ29udGVudHMsXG5cdFx0XHQgICAgb3V0cHV0O1xuXG5cdFx0XHQvL2J1aWxkIGNvbHVtbiBoZWFkZXJzXG5cdFx0XHRmdW5jdGlvbiBwYXJzZVNpbXBsZVRpdGxlcygpIHtcblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHR0aXRsZXMucHVzaCgnXCInICsgU3RyaW5nKGNvbHVtbi50aXRsZSkuc3BsaXQoJ1wiJykuam9pbignXCJcIicpICsgJ1wiJyk7XG5cdFx0XHRcdFx0ZmllbGRzLnB1c2goY29sdW1uLmZpZWxkKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlQ29sdW1uR3JvdXAoY29sdW1uLCBsZXZlbCkge1xuXHRcdFx0XHRpZiAoY29sdW1uLnN1Ykdyb3Vwcykge1xuXHRcdFx0XHRcdGNvbHVtbi5zdWJHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoc3ViR3JvdXApIHtcblx0XHRcdFx0XHRcdHBhcnNlQ29sdW1uR3JvdXAoc3ViR3JvdXAsIGxldmVsICsgMSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGl0bGVzLnB1c2goJ1wiJyArIFN0cmluZyhjb2x1bW4udGl0bGUpLnNwbGl0KCdcIicpLmpvaW4oJ1wiXCInKSArICdcIicpO1xuXHRcdFx0XHRcdGZpZWxkcy5wdXNoKGNvbHVtbi5kZWZpbml0aW9uLmZpZWxkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29uZmlnLmNvbHVtbkdyb3Vwcykge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gQ1NWIGRvd25sb2FkZXIgY2Fubm90IHByb2Nlc3MgY29sdW1uIGdyb3Vwc1wiKTtcblxuXHRcdFx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0XHRcdHBhcnNlQ29sdW1uR3JvdXAoY29sdW1uLCAwKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYXJzZVNpbXBsZVRpdGxlcygpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2dlbmVyYXRlIGhlYWRlciByb3dcblx0XHRcdGZpbGVDb250ZW50cyA9IFt0aXRsZXMuam9pbihkZWxpbWl0ZXIpXTtcblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VSb3dzKGRhdGEpIHtcblx0XHRcdFx0Ly9nZW5lcmF0ZSBlYWNoIHJvdyBvZiB0aGUgdGFibGVcblx0XHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHR2YXIgcm93RGF0YSA9IFtdO1xuXG5cdFx0XHRcdFx0ZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG5cdFx0XHRcdFx0XHR2YXIgdmFsdWUgPSBzZWxmLmdldEZpZWxkVmFsdWUoZmllbGQsIHJvdyk7XG5cblx0XHRcdFx0XHRcdHN3aXRjaCAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdFx0Y2FzZSBcIm51bGxcIjpcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvL2VzY2FwZSBxdW90YXRpb24gbWFya3Ncblx0XHRcdFx0XHRcdHJvd0RhdGEucHVzaCgnXCInICsgU3RyaW5nKHZhbHVlKS5zcGxpdCgnXCInKS5qb2luKCdcIlwiJykgKyAnXCInKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKHJvd0RhdGEuam9pbihkZWxpbWl0ZXIpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlR3JvdXAoZ3JvdXApIHtcblx0XHRcdFx0aWYgKGdyb3VwLnN1Ykdyb3Vwcykge1xuXHRcdFx0XHRcdGdyb3VwLnN1Ykdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJHcm91cCkge1xuXHRcdFx0XHRcdFx0cGFyc2VHcm91cChzdWJHcm91cCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cGFyc2VSb3dzKGdyb3VwLnJvd3MpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjb25maWcuY29sdW1uQ2FsY3MpIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiRG93bmxvYWQgV2FybmluZyAtIENTViBkb3dubG9hZGVyIGNhbm5vdCBwcm9jZXNzIGNvbHVtbiBjYWxjdWxhdGlvbnNcIik7XG5cdFx0XHRcdGRhdGEgPSBkYXRhLmRhdGE7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjb25maWcucm93R3JvdXBzKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIFdhcm5pbmcgLSBDU1YgZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyByb3cgZ3JvdXBzXCIpO1xuXG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0XHRwYXJzZUdyb3VwKGdyb3VwKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYXJzZVJvd3MoZGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdG91dHB1dCA9IGZpbGVDb250ZW50cy5qb2luKFwiXFxuXCIpO1xuXG5cdFx0XHRpZiAob3B0aW9ucy5ib20pIHtcblx0XHRcdFx0b3V0cHV0ID0gJ1xcdUZFRkYnICsgb3V0cHV0O1xuXHRcdFx0fVxuXG5cdFx0XHRzZXRGaWxlQ29udGVudHMob3V0cHV0LCBcInRleHQvY3N2XCIpO1xuXHRcdH0sXG5cblx0XHRqc29uOiBmdW5jdGlvbiBqc29uKGNvbHVtbnMsIGRhdGEsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cywgY29uZmlnKSB7XG5cdFx0XHR2YXIgZmlsZUNvbnRlbnRzO1xuXG5cdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIFdhcm5pbmcgLSBDU1YgZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyBjb2x1bW4gY2FsY3VsYXRpb25zXCIpO1xuXHRcdFx0XHRkYXRhID0gZGF0YS5kYXRhO1xuXHRcdFx0fVxuXG5cdFx0XHRmaWxlQ29udGVudHMgPSBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAnXFx0Jyk7XG5cblx0XHRcdHNldEZpbGVDb250ZW50cyhmaWxlQ29udGVudHMsIFwiYXBwbGljYXRpb24vanNvblwiKTtcblx0XHR9LFxuXG5cdFx0cGRmOiBmdW5jdGlvbiBwZGYoY29sdW1ucywgZGF0YSwgb3B0aW9ucywgc2V0RmlsZUNvbnRlbnRzLCBjb25maWcpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdCAgICBmaWVsZHMgPSBbXSxcblx0XHRcdCAgICBoZWFkZXIgPSBbXSxcblx0XHRcdCAgICBib2R5ID0gW10sXG5cdFx0XHQgICAgY2FsY3MgPSB7fSxcblx0XHRcdCAgICBoZWFkZXJEZXB0aCA9IDEsXG5cdFx0XHQgICAgdGFibGUgPSBcIlwiLFxuXHRcdFx0ICAgIGF1dG9UYWJsZVBhcmFtcyA9IHt9LFxuXHRcdFx0ICAgIHJvd0dyb3VwU3R5bGVzID0gb3B0aW9ucy5yb3dHcm91cFN0eWxlcyB8fCB7XG5cdFx0XHRcdGZvbnRTdHlsZTogXCJib2xkXCIsXG5cdFx0XHRcdGZvbnRTaXplOiAxMixcblx0XHRcdFx0Y2VsbFBhZGRpbmc6IDYsXG5cdFx0XHRcdGZpbGxDb2xvcjogMjIwXG5cdFx0XHR9LFxuXHRcdFx0ICAgIHJvd0NhbGNTdHlsZXMgPSBvcHRpb25zLnJvd0NhbGNTdHlsZXMgfHwge1xuXHRcdFx0XHRmb250U3R5bGU6IFwiYm9sZFwiLFxuXHRcdFx0XHRmb250U2l6ZTogMTAsXG5cdFx0XHRcdGNlbGxQYWRkaW5nOiA0LFxuXHRcdFx0XHRmaWxsQ29sb3I6IDIzMlxuXHRcdFx0fSxcblx0XHRcdCAgICBqc1BERlBhcmFtcyA9IG9wdGlvbnMuanNQREYgfHwge30sXG5cdFx0XHQgICAgdGl0bGUgPSBvcHRpb25zICYmIG9wdGlvbnMudGl0bGUgPyBvcHRpb25zLnRpdGxlIDogXCJcIjtcblxuXHRcdFx0aWYgKGNvbmZpZy5jb2x1bW5DYWxjcykge1xuXHRcdFx0XHRjYWxjcyA9IGRhdGEuY2FsY3M7XG5cdFx0XHRcdGRhdGEgPSBkYXRhLmRhdGE7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghanNQREZQYXJhbXMub3JpZW50YXRpb24pIHtcblx0XHRcdFx0anNQREZQYXJhbXMub3JpZW50YXRpb24gPSBvcHRpb25zLm9yaWVudGF0aW9uIHx8IFwibGFuZHNjYXBlXCI7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghanNQREZQYXJhbXMudW5pdCkge1xuXHRcdFx0XHRqc1BERlBhcmFtcy51bml0ID0gXCJwdFwiO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2J1aWxkIGNvbHVtbiBoZWFkZXJzXG5cdFx0XHRmdW5jdGlvbiBwYXJzZVNpbXBsZVRpdGxlcygpIHtcblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRpZiAoY29sdW1uLmZpZWxkKSB7XG5cdFx0XHRcdFx0XHRoZWFkZXIucHVzaChjb2x1bW4udGl0bGUgfHwgXCJcIik7XG5cdFx0XHRcdFx0XHRmaWVsZHMucHVzaChjb2x1bW4uZmllbGQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aGVhZGVyID0gW2hlYWRlcl07XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlQ29sdW1uR3JvdXAoY29sdW1uLCBsZXZlbCkge1xuXHRcdFx0XHR2YXIgY29sU3BhbiA9IGNvbHVtbi53aWR0aCxcblx0XHRcdFx0ICAgIHJvd1NwYW4gPSAxLFxuXHRcdFx0XHQgICAgY29sID0ge1xuXHRcdFx0XHRcdGNvbnRlbnQ6IGNvbHVtbi50aXRsZSB8fCBcIlwiXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5zdWJHcm91cHMpIHtcblx0XHRcdFx0XHRjb2x1bW4uc3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKHN1Ykdyb3VwKSB7XG5cdFx0XHRcdFx0XHRwYXJzZUNvbHVtbkdyb3VwKHN1Ykdyb3VwLCBsZXZlbCArIDEpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHJvd1NwYW4gPSAxO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGZpZWxkcy5wdXNoKGNvbHVtbi5kZWZpbml0aW9uLmZpZWxkKTtcblx0XHRcdFx0XHRyb3dTcGFuID0gaGVhZGVyRGVwdGggLSBsZXZlbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbC5yb3dTcGFuID0gcm93U3Bhbjtcblx0XHRcdFx0Ly8gY29sLmNvbFNwYW4gPSBjb2xTcGFuO1xuXG5cdFx0XHRcdGhlYWRlcltsZXZlbF0ucHVzaChjb2wpO1xuXG5cdFx0XHRcdGNvbFNwYW4tLTtcblxuXHRcdFx0XHRpZiAocm93U3BhbiA+IDEpIHtcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gbGV2ZWwgKyAxOyBpIDwgaGVhZGVyRGVwdGg7IGkrKykge1xuXHRcdFx0XHRcdFx0aGVhZGVyW2ldLnB1c2goXCJcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjb2xTcGFuOyBpKyspIHtcblx0XHRcdFx0XHRoZWFkZXJbbGV2ZWxdLnB1c2goXCJcIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbmZpZy5jb2x1bW5Hcm91cHMpIHtcblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRpZiAoY29sdW1uLmRlcHRoID4gaGVhZGVyRGVwdGgpIHtcblx0XHRcdFx0XHRcdGhlYWRlckRlcHRoID0gY29sdW1uLmRlcHRoO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBoZWFkZXJEZXB0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aGVhZGVyLnB1c2goW10pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRwYXJzZUNvbHVtbkdyb3VwKGNvbHVtbiwgMCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cGFyc2VTaW1wbGVUaXRsZXMoKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZSkge1xuXHRcdFx0XHRzd2l0Y2ggKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSB7XG5cdFx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdFx0dmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRjYXNlIFwibnVsbFwiOlxuXHRcdFx0XHRcdFx0dmFsdWUgPSBcIlwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VSb3dzKGRhdGEpIHtcblx0XHRcdFx0Ly9idWlsZCB0YWJsZSByb3dzXG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0Ym9keS5wdXNoKHBhcnNlUm93KHJvdykpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VSb3cocm93LCBzdHlsZXMpIHtcblx0XHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0XHRmaWVsZHMuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHtcblx0XHRcdFx0XHR2YXIgdmFsdWUgPSBzZWxmLmdldEZpZWxkVmFsdWUoZmllbGQsIHJvdyk7XG5cdFx0XHRcdFx0dmFsdWUgPSBwYXJzZVZhbHVlKHZhbHVlKTtcblxuXHRcdFx0XHRcdGlmIChzdHlsZXMpIHtcblx0XHRcdFx0XHRcdHJvd0RhdGEucHVzaCh7XG5cdFx0XHRcdFx0XHRcdGNvbnRlbnQ6IHZhbHVlLFxuXHRcdFx0XHRcdFx0XHRzdHlsZXM6IHN0eWxlc1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJvd0RhdGEucHVzaCh2YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gcm93RGF0YTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcGFyc2VHcm91cChncm91cCwgY2FsY09iaikge1xuXHRcdFx0XHR2YXIgZ3JvdXBEYXRhID0gW107XG5cblx0XHRcdFx0Z3JvdXBEYXRhLnB1c2goeyBjb250ZW50OiBwYXJzZVZhbHVlKGdyb3VwLmtleSksIGNvbFNwYW46IGZpZWxkcy5sZW5ndGgsIHN0eWxlczogcm93R3JvdXBTdHlsZXMgfSk7XG5cblx0XHRcdFx0Ym9keS5wdXNoKGdyb3VwRGF0YSk7XG5cblx0XHRcdFx0aWYgKGdyb3VwLnN1Ykdyb3Vwcykge1xuXHRcdFx0XHRcdGdyb3VwLnN1Ykdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJHcm91cCkge1xuXHRcdFx0XHRcdFx0cGFyc2VHcm91cChzdWJHcm91cCwgY2FsY09ialtncm91cC5rZXldID8gY2FsY09ialtncm91cC5rZXldLmdyb3VwcyB8fCB7fSA6IHt9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGlmIChjb25maWcuY29sdW1uQ2FsY3MpIHtcblx0XHRcdFx0XHRcdGFkZENhbGNSb3coY2FsY09iaiwgZ3JvdXAua2V5LCBcInRvcFwiKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRwYXJzZVJvd3MoZ3JvdXAucm93cyk7XG5cblx0XHRcdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdFx0XHRhZGRDYWxjUm93KGNhbGNPYmosIGdyb3VwLmtleSwgXCJib3R0b21cIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGFkZENhbGNSb3coY2FsY3MsIHNlbGVjdG9yLCBwb3MpIHtcblx0XHRcdFx0dmFyIGNhbGNEYXRhID0gY2FsY3Nbc2VsZWN0b3JdO1xuXG5cdFx0XHRcdGlmIChjYWxjRGF0YSkge1xuXHRcdFx0XHRcdGlmIChwb3MpIHtcblx0XHRcdFx0XHRcdGNhbGNEYXRhID0gY2FsY0RhdGFbcG9zXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoT2JqZWN0LmtleXMoY2FsY0RhdGEpLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0Ym9keS5wdXNoKHBhcnNlUm93KGNhbGNEYXRhLCByb3dDYWxjU3R5bGVzKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjb25maWcucm93R3JvdXBzKSB7XG5cdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0XHRwYXJzZUdyb3VwKGdyb3VwLCBjYWxjcyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGNvbmZpZy5jb2x1bW5DYWxjcykge1xuXHRcdFx0XHRcdGFkZENhbGNSb3coY2FsY3MsIFwidG9wXCIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cGFyc2VSb3dzKGRhdGEpO1xuXG5cdFx0XHRcdGlmIChjb25maWcuY29sdW1uQ2FsY3MpIHtcblx0XHRcdFx0XHRhZGRDYWxjUm93KGNhbGNzLCBcImJvdHRvbVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZG9jID0gbmV3IGpzUERGKGpzUERGUGFyYW1zKTsgLy9zZXQgZG9jdW1lbnQgdG8gbGFuZHNjYXBlLCBiZXR0ZXIgZm9yIG1vc3QgdGFibGVzXG5cblx0XHRcdGlmIChvcHRpb25zICYmIG9wdGlvbnMuYXV0b1RhYmxlKSB7XG5cdFx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5hdXRvVGFibGUgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGF1dG9UYWJsZVBhcmFtcyA9IG9wdGlvbnMuYXV0b1RhYmxlKGRvYykgfHwge307XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0YXV0b1RhYmxlUGFyYW1zID0gb3B0aW9ucy5hdXRvVGFibGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHRpdGxlKSB7XG5cdFx0XHRcdGF1dG9UYWJsZVBhcmFtcy5hZGRQYWdlQ29udGVudCA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdFx0ZG9jLnRleHQodGl0bGUsIDQwLCAzMCk7XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdGF1dG9UYWJsZVBhcmFtcy5oZWFkID0gaGVhZGVyO1xuXHRcdFx0YXV0b1RhYmxlUGFyYW1zLmJvZHkgPSBib2R5O1xuXG5cdFx0XHRkb2MuYXV0b1RhYmxlKGF1dG9UYWJsZVBhcmFtcyk7XG5cblx0XHRcdGlmIChvcHRpb25zICYmIG9wdGlvbnMuZG9jdW1lbnRQcm9jZXNzaW5nKSB7XG5cdFx0XHRcdG9wdGlvbnMuZG9jdW1lbnRQcm9jZXNzaW5nKGRvYyk7XG5cdFx0XHR9XG5cblx0XHRcdHNldEZpbGVDb250ZW50cyhkb2Mub3V0cHV0KFwiYXJyYXlidWZmZXJcIiksIFwiYXBwbGljYXRpb24vcGRmXCIpO1xuXHRcdH0sXG5cblx0XHR4bHN4OiBmdW5jdGlvbiB4bHN4KGNvbHVtbnMsIGRhdGEsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cywgY29uZmlnKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHQgICAgc2hlZXROYW1lID0gb3B0aW9ucy5zaGVldE5hbWUgfHwgXCJTaGVldDFcIixcblx0XHRcdCAgICB3b3JrYm9vayA9IFhMU1gudXRpbHMuYm9va19uZXcoKSxcblx0XHRcdCAgICBjYWxjcyA9IHt9LFxuXHRcdFx0ICAgIGdyb3VwUm93SW5kZXhzID0gW10sXG5cdFx0XHQgICAgZ3JvdXBDb2x1bW5JbmRleHMgPSBbXSxcblx0XHRcdCAgICBjYWxjUm93SW5kZXhzID0gW10sXG5cdFx0XHQgICAgb3V0cHV0O1xuXG5cdFx0XHR3b3JrYm9vay5TaGVldE5hbWVzID0gW107XG5cdFx0XHR3b3JrYm9vay5TaGVldHMgPSB7fTtcblxuXHRcdFx0aWYgKGNvbmZpZy5jb2x1bW5DYWxjcykge1xuXHRcdFx0XHRjYWxjcyA9IGRhdGEuY2FsY3M7XG5cdFx0XHRcdGRhdGEgPSBkYXRhLmRhdGE7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGdlbmVyYXRlU2hlZXQoKSB7XG5cdFx0XHRcdHZhciB0aXRsZXMgPSBbXSxcblx0XHRcdFx0ICAgIGZpZWxkcyA9IFtdLFxuXHRcdFx0XHQgICAgcm93cyA9IFtdLFxuXHRcdFx0XHQgICAgd29ya3NoZWV0O1xuXG5cdFx0XHRcdC8vY29udmVydCByb3dzIHRvIHdvcmtzaGVldFxuXHRcdFx0XHRmdW5jdGlvbiByb3dzVG9TaGVldCgpIHtcblx0XHRcdFx0XHR2YXIgc2hlZXQgPSB7fTtcblx0XHRcdFx0XHR2YXIgcmFuZ2UgPSB7IHM6IHsgYzogMCwgcjogMCB9LCBlOiB7IGM6IGZpZWxkcy5sZW5ndGgsIHI6IHJvd3MubGVuZ3RoIH0gfTtcblxuXHRcdFx0XHRcdFhMU1gudXRpbHMuc2hlZXRfYWRkX2FvYShzaGVldCwgcm93cyk7XG5cblx0XHRcdFx0XHRzaGVldFsnIXJlZiddID0gWExTWC51dGlscy5lbmNvZGVfcmFuZ2UocmFuZ2UpO1xuXG5cdFx0XHRcdFx0dmFyIG1lcmdlcyA9IGdlbmVyYXRlTWVyZ2VzKCk7XG5cblx0XHRcdFx0XHRpZiAobWVyZ2VzLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0c2hlZXRbXCIhbWVyZ2VzXCJdID0gbWVyZ2VzO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBzaGVldDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZ1bmN0aW9uIHBhcnNlU2ltcGxlVGl0bGVzKCkge1xuXHRcdFx0XHRcdC8vZ2V0IGZpZWxkIGxpc3RzXG5cdFx0XHRcdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0XHRcdHRpdGxlcy5wdXNoKGNvbHVtbi50aXRsZSk7XG5cdFx0XHRcdFx0XHRmaWVsZHMucHVzaChjb2x1bW4uZmllbGQpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cm93cy5wdXNoKHRpdGxlcyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBwYXJzZUNvbHVtbkdyb3VwKGNvbHVtbiwgbGV2ZWwpIHtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgdGl0bGVzW2xldmVsXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0dGl0bGVzW2xldmVsXSA9IFtdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgZ3JvdXBDb2x1bW5JbmRleHNbbGV2ZWxdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRncm91cENvbHVtbkluZGV4c1tsZXZlbF0gPSBbXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoY29sdW1uLndpZHRoID4gMSkge1xuXG5cdFx0XHRcdFx0XHRncm91cENvbHVtbkluZGV4c1tsZXZlbF0ucHVzaCh7XG5cdFx0XHRcdFx0XHRcdHR5cGU6IFwiaG96XCIsXG5cdFx0XHRcdFx0XHRcdHN0YXJ0OiB0aXRsZXNbbGV2ZWxdLmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0ZW5kOiB0aXRsZXNbbGV2ZWxdLmxlbmd0aCArIGNvbHVtbi53aWR0aCAtIDFcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRpdGxlc1tsZXZlbF0ucHVzaChjb2x1bW4udGl0bGUpO1xuXG5cdFx0XHRcdFx0aWYgKGNvbHVtbi5zdWJHcm91cHMpIHtcblx0XHRcdFx0XHRcdGNvbHVtbi5zdWJHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoc3ViR3JvdXApIHtcblx0XHRcdFx0XHRcdFx0cGFyc2VDb2x1bW5Hcm91cChzdWJHcm91cCwgbGV2ZWwgKyAxKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRmaWVsZHMucHVzaChjb2x1bW4uZGVmaW5pdGlvbi5maWVsZCk7XG5cdFx0XHRcdFx0XHRwYWRDb2x1bW5UaXRsZXMoZmllbGRzLmxlbmd0aCAtIDEsIGxldmVsKTtcblxuXHRcdFx0XHRcdFx0Z3JvdXBDb2x1bW5JbmRleHNbbGV2ZWxdLnB1c2goe1xuXHRcdFx0XHRcdFx0XHR0eXBlOiBcInZlcnRcIixcblx0XHRcdFx0XHRcdFx0c3RhcnQ6IGZpZWxkcy5sZW5ndGggLSAxXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBwYWRDb2x1bW5UaXRsZXMoKSB7XG5cdFx0XHRcdFx0dmFyIG1heCA9IDA7XG5cblx0XHRcdFx0XHR0aXRsZXMuZm9yRWFjaChmdW5jdGlvbiAodGl0bGUpIHtcblx0XHRcdFx0XHRcdHZhciBsZW4gPSB0aXRsZS5sZW5ndGg7XG5cdFx0XHRcdFx0XHRpZiAobGVuID4gbWF4KSB7XG5cdFx0XHRcdFx0XHRcdG1heCA9IGxlbjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHRpdGxlcy5mb3JFYWNoKGZ1bmN0aW9uICh0aXRsZSkge1xuXHRcdFx0XHRcdFx0dmFyIGxlbiA9IHRpdGxlLmxlbmd0aDtcblx0XHRcdFx0XHRcdGlmIChsZW4gPCBtYXgpIHtcblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IGxlbjsgaSA8IG1heDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdFx0dGl0bGUucHVzaChcIlwiKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbmZpZy5jb2x1bW5Hcm91cHMpIHtcblx0XHRcdFx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0XHRcdFx0cGFyc2VDb2x1bW5Hcm91cChjb2x1bW4sIDApO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0dGl0bGVzLmZvckVhY2goZnVuY3Rpb24gKHRpdGxlKSB7XG5cdFx0XHRcdFx0XHRyb3dzLnB1c2godGl0bGUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHBhcnNlU2ltcGxlVGl0bGVzKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBnZW5lcmF0ZU1lcmdlcygpIHtcblx0XHRcdFx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRcdFx0XHRncm91cFJvd0luZGV4cy5mb3JFYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuXHRcdFx0XHRcdFx0b3V0cHV0LnB1c2goeyBzOiB7IHI6IGluZGV4LCBjOiAwIH0sIGU6IHsgcjogaW5kZXgsIGM6IGZpZWxkcy5sZW5ndGggLSAxIH0gfSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRncm91cENvbHVtbkluZGV4cy5mb3JFYWNoKGZ1bmN0aW9uIChtZXJnZXMsIGxldmVsKSB7XG5cdFx0XHRcdFx0XHRtZXJnZXMuZm9yRWFjaChmdW5jdGlvbiAobWVyZ2UpIHtcblx0XHRcdFx0XHRcdFx0aWYgKG1lcmdlLnR5cGUgPT09IFwiaG96XCIpIHtcblx0XHRcdFx0XHRcdFx0XHRvdXRwdXQucHVzaCh7IHM6IHsgcjogbGV2ZWwsIGM6IG1lcmdlLnN0YXJ0IH0sIGU6IHsgcjogbGV2ZWwsIGM6IG1lcmdlLmVuZCB9IH0pO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChsZXZlbCAhPSB0aXRsZXMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0b3V0cHV0LnB1c2goeyBzOiB7IHI6IGxldmVsLCBjOiBtZXJnZS5zdGFydCB9LCBlOiB7IHI6IHRpdGxlcy5sZW5ndGggLSAxLCBjOiBtZXJnZS5zdGFydCB9IH0pO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9nZW5lcmF0ZSBlYWNoIHJvdyBvZiB0aGUgdGFibGVcblx0XHRcdFx0ZnVuY3Rpb24gcGFyc2VSb3dzKGRhdGEpIHtcblx0XHRcdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdFx0cm93cy5wdXNoKHBhcnNlUm93KHJvdykpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZnVuY3Rpb24gcGFyc2VSb3cocm93KSB7XG5cdFx0XHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0XHRcdGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkge1xuXHRcdFx0XHRcdFx0dmFyIHZhbHVlID0gc2VsZi5nZXRGaWVsZFZhbHVlKGZpZWxkLCByb3cpO1xuXHRcdFx0XHRcdFx0cm93RGF0YS5wdXNoKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSAmJiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpID09PSBcIm9iamVjdFwiID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpIDogdmFsdWUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHJvd0RhdGE7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBhZGRDYWxjUm93KGNhbGNzLCBzZWxlY3RvciwgcG9zKSB7XG5cdFx0XHRcdFx0dmFyIGNhbGNEYXRhID0gY2FsY3Nbc2VsZWN0b3JdO1xuXG5cdFx0XHRcdFx0aWYgKGNhbGNEYXRhKSB7XG5cdFx0XHRcdFx0XHRpZiAocG9zKSB7XG5cdFx0XHRcdFx0XHRcdGNhbGNEYXRhID0gY2FsY0RhdGFbcG9zXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKE9iamVjdC5rZXlzKGNhbGNEYXRhKS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0Y2FsY1Jvd0luZGV4cy5wdXNoKHJvd3MubGVuZ3RoKTtcblx0XHRcdFx0XHRcdFx0cm93cy5wdXNoKHBhcnNlUm93KGNhbGNEYXRhKSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZnVuY3Rpb24gcGFyc2VHcm91cChncm91cCwgY2FsY09iaikge1xuXHRcdFx0XHRcdHZhciBncm91cERhdGEgPSBbXTtcblxuXHRcdFx0XHRcdGdyb3VwRGF0YS5wdXNoKGdyb3VwLmtleSk7XG5cblx0XHRcdFx0XHRncm91cFJvd0luZGV4cy5wdXNoKHJvd3MubGVuZ3RoKTtcblxuXHRcdFx0XHRcdHJvd3MucHVzaChncm91cERhdGEpO1xuXG5cdFx0XHRcdFx0aWYgKGdyb3VwLnN1Ykdyb3Vwcykge1xuXHRcdFx0XHRcdFx0Z3JvdXAuc3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKHN1Ykdyb3VwKSB7XG5cdFx0XHRcdFx0XHRcdHBhcnNlR3JvdXAoc3ViR3JvdXAsIGNhbGNPYmpbZ3JvdXAua2V5XSA/IGNhbGNPYmpbZ3JvdXAua2V5XS5ncm91cHMgfHwge30gOiB7fSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdFx0XHRcdGFkZENhbGNSb3coY2FsY09iaiwgZ3JvdXAua2V5LCBcInRvcFwiKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cGFyc2VSb3dzKGdyb3VwLnJvd3MpO1xuXG5cdFx0XHRcdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdFx0XHRcdGFkZENhbGNSb3coY2FsY09iaiwgZ3JvdXAua2V5LCBcImJvdHRvbVwiKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY29uZmlnLnJvd0dyb3Vwcykge1xuXHRcdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0XHRcdHBhcnNlR3JvdXAoZ3JvdXAsIGNhbGNzKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdFx0XHRhZGRDYWxjUm93KGNhbGNzLCBcInRvcFwiKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRwYXJzZVJvd3MoZGF0YSk7XG5cblx0XHRcdFx0XHRpZiAoY29uZmlnLmNvbHVtbkNhbGNzKSB7XG5cdFx0XHRcdFx0XHRhZGRDYWxjUm93KGNhbGNzLCBcImJvdHRvbVwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR3b3Jrc2hlZXQgPSByb3dzVG9TaGVldCgpO1xuXG5cdFx0XHRcdHJldHVybiB3b3Jrc2hlZXQ7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zLnNoZWV0T25seSkge1xuXHRcdFx0XHRzZXRGaWxlQ29udGVudHMoZ2VuZXJhdGVTaGVldCgpKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0aW9ucy5zaGVldHMpIHtcblx0XHRcdFx0Zm9yICh2YXIgc2hlZXQgaW4gb3B0aW9ucy5zaGVldHMpIHtcblxuXHRcdFx0XHRcdGlmIChvcHRpb25zLnNoZWV0c1tzaGVldF0gPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdHdvcmtib29rLlNoZWV0TmFtZXMucHVzaChzaGVldCk7XG5cdFx0XHRcdFx0XHR3b3JrYm9vay5TaGVldHNbc2hlZXRdID0gZ2VuZXJhdGVTaGVldCgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdHdvcmtib29rLlNoZWV0TmFtZXMucHVzaChzaGVldCk7XG5cblx0XHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb21tcy5zZW5kKG9wdGlvbnMuc2hlZXRzW3NoZWV0XSwgXCJkb3dubG9hZFwiLCBcImludGVyY2VwdFwiLCB7XG5cdFx0XHRcdFx0XHRcdHR5cGU6IFwieGxzeFwiLFxuXHRcdFx0XHRcdFx0XHRvcHRpb25zOiB7IHNoZWV0T25seTogdHJ1ZSB9LFxuXHRcdFx0XHRcdFx0XHRhY3RpdmU6IHNlbGYuYWN0aXZlLFxuXHRcdFx0XHRcdFx0XHRpbnRlcmNlcHQ6IGZ1bmN0aW9uIGludGVyY2VwdChkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0d29ya2Jvb2suU2hlZXRzW3NoZWV0XSA9IGRhdGE7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0d29ya2Jvb2suU2hlZXROYW1lcy5wdXNoKHNoZWV0TmFtZSk7XG5cdFx0XHRcdHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdID0gZ2VuZXJhdGVTaGVldCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0aW9ucy5kb2N1bWVudFByb2Nlc3NpbmcpIHtcblx0XHRcdFx0d29ya2Jvb2sgPSBvcHRpb25zLmRvY3VtZW50UHJvY2Vzc2luZyh3b3JrYm9vayk7XG5cdFx0XHR9XG5cblx0XHRcdC8vY29udmVydCB3b3JrYm9vayB0byBiaW5hcnkgYXJyYXlcblx0XHRcdGZ1bmN0aW9uIHMyYWIocykge1xuXHRcdFx0XHR2YXIgYnVmID0gbmV3IEFycmF5QnVmZmVyKHMubGVuZ3RoKTtcblx0XHRcdFx0dmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShidWYpO1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSAhPSBzLmxlbmd0aDsgKytpKSB7XG5cdFx0XHRcdFx0dmlld1tpXSA9IHMuY2hhckNvZGVBdChpKSAmIDB4RkY7XG5cdFx0XHRcdH1yZXR1cm4gYnVmO1xuXHRcdFx0fVxuXG5cdFx0XHRvdXRwdXQgPSBYTFNYLndyaXRlKHdvcmtib29rLCB7IGJvb2tUeXBlOiAneGxzeCcsIGJvb2tTU1Q6IHRydWUsIHR5cGU6ICdiaW5hcnknIH0pO1xuXG5cdFx0XHRzZXRGaWxlQ29udGVudHMoczJhYihvdXRwdXQpLCBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiKTtcblx0XHR9LFxuXG5cdFx0aHRtbDogZnVuY3Rpb24gaHRtbChjb2x1bW5zLCBkYXRhLCBvcHRpb25zLCBzZXRGaWxlQ29udGVudHMsIGNvbmZpZykge1xuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZXhwb3J0XCIsIHRydWUpKSB7XG5cdFx0XHRcdHNldEZpbGVDb250ZW50cyh0aGlzLnRhYmxlLm1vZHVsZXMuZXhwb3J0LmdldEh0bWwodHJ1ZSwgb3B0aW9ucy5zdHlsZSwgY29uZmlnKSwgXCJ0ZXh0L2h0bWxcIik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImRvd25sb2FkXCIsIERvd25sb2FkKTtcblxuXHR2YXIgRWRpdCA9IGZ1bmN0aW9uIEVkaXQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5jdXJyZW50Q2VsbCA9IGZhbHNlOyAvL2hvbGQgY3VycmVudGx5IGVkaXRpbmcgY2VsbFxuXHRcdHRoaXMubW91c2VDbGljayA9IGZhbHNlOyAvL2hvbGQgbW91c2Vkb3duIHN0YXRlIHRvIHByZXZlbnQgY2xpY2sgYmluZGluZyBiZWluZyBvdmVycmlkZW4gYnkgZWRpdG9yIG9wZW5pbmdcblx0XHR0aGlzLnJlY3Vyc2lvbkJsb2NrID0gZmFsc2U7IC8vcHJldmVudCBmb2N1cyByZWN1cnNpb25cblx0XHR0aGlzLmludmFsaWRFZGl0ID0gZmFsc2U7XG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBlZGl0b3Jcblx0RWRpdC5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHtcblx0XHRcdGVkaXRvcjogZmFsc2UsXG5cdFx0XHRibG9ja2VkOiBmYWxzZSxcblx0XHRcdGNoZWNrOiBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0YWJsZSxcblx0XHRcdHBhcmFtczogY29sdW1uLmRlZmluaXRpb24uZWRpdG9yUGFyYW1zIHx8IHt9XG5cdFx0fTtcblxuXHRcdC8vc2V0IGNvbHVtbiBlZGl0b3Jcblx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uZWRpdG9yKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IgPT09IFwidGlja1wiKSB7XG5cdFx0XHRcdFx0Y29sdW1uLmRlZmluaXRpb24uZWRpdG9yID0gXCJ0aWNrQ3Jvc3NcIjtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQVJOSU5HIC0gdGhlIHRpY2sgZWRpdG9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgdGhlIHRpY2tDcm9zcyBlZGl0b3JcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmVkaXRvcl0pIHtcblx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmVkaXRvcl07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdG9yIEVycm9yIC0gTm8gc3VjaCBlZGl0b3IgZm91bmQ6IFwiLCBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0Y29uZmlnLmVkaXRvciA9IGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvcjtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvciA9PT0gdHJ1ZSkge1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgIT09IFwiZnVuY3Rpb25cIikge1xuXG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyID09PSBcInRpY2tcIikge1xuXHRcdFx0XHRcdFx0XHRjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPSBcInRpY2tDcm9zc1wiO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQVJOSU5HIC0gdGhlIHRpY2sgZWRpdG9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgdGhlIHRpY2tDcm9zcyBlZGl0b3JcIik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChzZWxmLmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyXSkge1xuXHRcdFx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl07XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRjb25maWcuZWRpdG9yID0gc2VsZi5lZGl0b3JzW1wiaW5wdXRcIl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkVkaXRvciBFcnJvciAtIENhbm5vdCBhdXRvIGxvb2t1cCBlZGl0b3IgZm9yIGEgY3VzdG9tIGZvcm1hdHRlcjogXCIsIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGlmIChjb25maWcuZWRpdG9yKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5lZGl0ID0gY29uZmlnO1xuXHRcdH1cblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5nZXRDdXJyZW50Q2VsbCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5jdXJyZW50Q2VsbCA/IHRoaXMuY3VycmVudENlbGwuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5jbGVhckVkaXRvciA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY2VsbCA9IHRoaXMuY3VycmVudENlbGwsXG5cdFx0ICAgIGNlbGxFbDtcblxuXHRcdHRoaXMuaW52YWxpZEVkaXQgPSBmYWxzZTtcblxuXHRcdGlmIChjZWxsKSB7XG5cdFx0XHR0aGlzLmN1cnJlbnRDZWxsID0gZmFsc2U7XG5cblx0XHRcdGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFx0Y2VsbEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItdmFsaWRhdGlvbi1mYWlsXCIpO1xuXHRcdFx0Y2VsbEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdHdoaWxlIChjZWxsRWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRjZWxsRWwucmVtb3ZlQ2hpbGQoY2VsbEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0fWNlbGwucm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1lZGl0aW5nXCIpO1xuXHRcdH1cblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5jYW5jZWxFZGl0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKHRoaXMuY3VycmVudENlbGwpIHtcblx0XHRcdHZhciBjZWxsID0gdGhpcy5jdXJyZW50Q2VsbDtcblx0XHRcdHZhciBjb21wb25lbnQgPSB0aGlzLmN1cnJlbnRDZWxsLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHR0aGlzLmNsZWFyRWRpdG9yKCk7XG5cdFx0XHRjZWxsLnNldFZhbHVlQWN0dWFsKGNlbGwuZ2V0VmFsdWUoKSk7XG5cblx0XHRcdGlmIChjZWxsLmNvbHVtbi5jZWxsRXZlbnRzLmNlbGxFZGl0Q2FuY2VsbGVkKSB7XG5cdFx0XHRcdGNlbGwuY29sdW1uLmNlbGxFdmVudHMuY2VsbEVkaXRDYW5jZWxsZWQuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY2VsbEVkaXRDYW5jZWxsZWQuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiBhIGZvcm1hdHRlZCB2YWx1ZSBmb3IgYSBjZWxsXG5cdEVkaXQucHJvdG90eXBlLmJpbmRFZGl0b3IgPSBmdW5jdGlvbiAoY2VsbCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpO1xuXG5cdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCAwKTtcblxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFidWxhdG9yLWVkaXRpbmdcIikpIHtcblx0XHRcdFx0ZWxlbWVudC5mb2N1cygpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRzZWxmLm1vdXNlQ2xpY2sgPSB0cnVlO1xuXHRcdH0pO1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGlmICghc2VsZi5yZWN1cnNpb25CbG9jaykge1xuXHRcdFx0XHRzZWxmLmVkaXQoY2VsbCwgZSwgZmFsc2UpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLmZvY3VzQ2VsbE5vRXZlbnQgPSBmdW5jdGlvbiAoY2VsbCwgYmxvY2spIHtcblx0XHR0aGlzLnJlY3Vyc2lvbkJsb2NrID0gdHJ1ZTtcblx0XHRpZiAoIShibG9jayAmJiB0aGlzLnRhYmxlLmJyb3dzZXIgPT09IFwiaWVcIikpIHtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmZvY3VzKCk7XG5cdFx0fVxuXHRcdHRoaXMucmVjdXJzaW9uQmxvY2sgPSBmYWxzZTtcblx0fTtcblxuXHRFZGl0LnByb3RvdHlwZS5lZGl0Q2VsbCA9IGZ1bmN0aW9uIChjZWxsLCBmb3JjZUVkaXQpIHtcblx0XHR0aGlzLmZvY3VzQ2VsbE5vRXZlbnQoY2VsbCk7XG5cdFx0dGhpcy5lZGl0KGNlbGwsIGZhbHNlLCBmb3JjZUVkaXQpO1xuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLmVkaXQgPSBmdW5jdGlvbiAoY2VsbCwgZSwgZm9yY2VFZGl0KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBhbGxvd0VkaXQgPSB0cnVlLFxuXHRcdCAgICByZW5kZXJlZCA9IGZ1bmN0aW9uIHJlbmRlcmVkKCkge30sXG5cdFx0ICAgIGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0XHQgICAgY2VsbEVkaXRvcixcblx0XHQgICAgY29tcG9uZW50LFxuXHRcdCAgICBwYXJhbXM7XG5cblx0XHQvL3ByZXZlbnQgZWRpdGluZyBpZiBhbm90aGVyIGNlbGwgaXMgcmVmdXNpbmcgdG8gbGVhdmUgZm9jdXMgKGVnLiB2YWxpZGF0aW9uIGZhaWwpXG5cdFx0aWYgKHRoaXMuY3VycmVudENlbGwpIHtcblx0XHRcdGlmICghdGhpcy5pbnZhbGlkRWRpdCkge1xuXHRcdFx0XHR0aGlzLmNhbmNlbEVkaXQoKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvL2hhbmRsZSBzdWNjZXNzZnVsbCB2YWx1ZSBjaGFuZ2Vcblx0XHRmdW5jdGlvbiBzdWNjZXNzKHZhbHVlKSB7XG5cdFx0XHRpZiAoc2VsZi5jdXJyZW50Q2VsbCA9PT0gY2VsbCkge1xuXHRcdFx0XHR2YXIgdmFsaWQgPSB0cnVlO1xuXG5cdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5tb2R1bGVzLnZhbGlkYXRlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwidmFsaWRhdGVcIikpIHtcblx0XHRcdFx0XHR2YWxpZCA9IHNlbGYudGFibGUubW9kdWxlcy52YWxpZGF0ZS52YWxpZGF0ZShjZWxsLmNvbHVtbi5tb2R1bGVzLnZhbGlkYXRlLCBjZWxsLmdldENvbXBvbmVudCgpLCB2YWx1ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmFsaWQgPT09IHRydWUpIHtcblx0XHRcdFx0XHRzZWxmLmNsZWFyRWRpdG9yKCk7XG5cdFx0XHRcdFx0Y2VsbC5zZXRWYWx1ZSh2YWx1ZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5kYXRhVHJlZS5jaGVja0ZvclJlc3R5bGUoY2VsbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5pbnZhbGlkRWRpdCA9IHRydWU7XG5cdFx0XHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0XHRcdFx0XHRzZWxmLmZvY3VzQ2VsbE5vRXZlbnQoY2VsbCwgdHJ1ZSk7XG5cdFx0XHRcdFx0cmVuZGVyZWQoKTtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMudmFsaWRhdGlvbkZhaWxlZC5jYWxsKHNlbGYudGFibGUsIGNlbGwuZ2V0Q29tcG9uZW50KCksIHZhbHVlLCB2YWxpZCk7XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIGNvbnNvbGUud2FybihcIkVkaXQgU3VjY2VzcyBFcnJvciAtIGNhbm5vdCBjYWxsIHN1Y2Nlc3Mgb24gYSBjZWxsIHRoYXQgaXMgbm8gbG9uZ2VyIGJlaW5nIGVkaXRlZFwiKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvL2hhbmRsZSBhYm9ydGVkIGVkaXRcblx0XHRmdW5jdGlvbiBjYW5jZWwoKSB7XG5cdFx0XHRpZiAoc2VsZi5jdXJyZW50Q2VsbCA9PT0gY2VsbCkge1xuXHRcdFx0XHRzZWxmLmNhbmNlbEVkaXQoKTtcblxuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHNlbGYudGFibGUubW9kRXhpc3RzKFwiZGF0YVRyZWVcIikpIHtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuY2hlY2tGb3JSZXN0eWxlKGNlbGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjb25zb2xlLndhcm4oXCJFZGl0IFN1Y2Nlc3MgRXJyb3IgLSBjYW5ub3QgY2FsbCBjYW5jZWwgb24gYSBjZWxsIHRoYXQgaXMgbm8gbG9uZ2VyIGJlaW5nIGVkaXRlZFwiKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBvblJlbmRlcmVkKGNhbGxiYWNrKSB7XG5cdFx0XHRyZW5kZXJlZCA9IGNhbGxiYWNrO1xuXHRcdH1cblxuXHRcdGlmICghY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQpIHtcblx0XHRcdGlmIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9XG5cblx0XHRcdHN3aXRjaCAoX3R5cGVvZihjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2spKSB7XG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHRcdGFsbG93RWRpdCA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjaztcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFsbG93RWRpdCB8fCBmb3JjZUVkaXQpIHtcblxuXHRcdFx0XHRzZWxmLmNhbmNlbEVkaXQoKTtcblxuXHRcdFx0XHRzZWxmLmN1cnJlbnRDZWxsID0gY2VsbDtcblxuXHRcdFx0XHRjb21wb25lbnQgPSBjZWxsLmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdGlmICh0aGlzLm1vdXNlQ2xpY2spIHtcblx0XHRcdFx0XHR0aGlzLm1vdXNlQ2xpY2sgPSBmYWxzZTtcblxuXHRcdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5jZWxsRXZlbnRzLmNlbGxDbGljaykge1xuXHRcdFx0XHRcdFx0Y2VsbC5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsQ2xpY2suY2FsbCh0aGlzLnRhYmxlLCBlLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjZWxsLmNvbHVtbi5jZWxsRXZlbnRzLmNlbGxFZGl0aW5nKSB7XG5cdFx0XHRcdFx0Y2VsbC5jb2x1bW4uY2VsbEV2ZW50cy5jZWxsRWRpdGluZy5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY2VsbEVkaXRpbmcuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXG5cdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zKGNvbXBvbmVudCkgOiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQucGFyYW1zO1xuXG5cdFx0XHRcdGNlbGxFZGl0b3IgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yLmNhbGwoc2VsZiwgY29tcG9uZW50LCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIHBhcmFtcyk7XG5cblx0XHRcdFx0Ly9pZiBlZGl0b3IgcmV0dXJuZWQsIGFkZCB0byBET00sIGlmIGZhbHNlLCBhYm9ydCBlZGl0XG5cdFx0XHRcdGlmIChjZWxsRWRpdG9yICE9PSBmYWxzZSkge1xuXG5cdFx0XHRcdFx0aWYgKGNlbGxFZGl0b3IgaW5zdGFuY2VvZiBOb2RlKSB7XG5cdFx0XHRcdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdFx0XHRcdGNlbGwucm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvdy1lZGl0aW5nXCIpO1xuXHRcdFx0XHRcdFx0d2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHR9ZWxlbWVudC5hcHBlbmRDaGlsZChjZWxsRWRpdG9yKTtcblxuXHRcdFx0XHRcdFx0Ly90cmlnZ2VyIG9uUmVuZGVyZWQgQ2FsbGJhY2tcblx0XHRcdFx0XHRcdHJlbmRlcmVkKCk7XG5cblx0XHRcdFx0XHRcdC8vcHJldmVudCBlZGl0aW5nIGZyb20gdHJpZ2dlcmluZyByb3dDbGljayBldmVudFxuXHRcdFx0XHRcdFx0dmFyIGNoaWxkcmVuID0gZWxlbWVudC5jaGlsZHJlbjtcblxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRjaGlsZHJlbltpXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdCBFcnJvciAtIEVkaXRvciBzaG91bGQgcmV0dXJuIGFuIGluc3RhbmNlIG9mIE5vZGUsIHRoZSBlZGl0b3IgcmV0dXJuZWQ6XCIsIGNlbGxFZGl0b3IpO1xuXHRcdFx0XHRcdFx0ZWxlbWVudC5ibHVyKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVsZW1lbnQuYmx1cigpO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tb3VzZUNsaWNrID0gZmFsc2U7XG5cdFx0XHRcdGVsZW1lbnQuYmx1cigpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubW91c2VDbGljayA9IGZhbHNlO1xuXHRcdFx0ZWxlbWVudC5ibHVyKCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEVkaXQucHJvdG90eXBlLm1hc2tJbnB1dCA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuXHRcdHZhciBtYXNrID0gb3B0aW9ucy5tYXNrLFxuXHRcdCAgICBtYXNrTGV0dGVyID0gdHlwZW9mIG9wdGlvbnMubWFza0xldHRlckNoYXIgIT09IFwidW5kZWZpbmVkXCIgPyBvcHRpb25zLm1hc2tMZXR0ZXJDaGFyIDogXCJBXCIsXG5cdFx0ICAgIG1hc2tOdW1iZXIgPSB0eXBlb2Ygb3B0aW9ucy5tYXNrTnVtYmVyQ2hhciAhPT0gXCJ1bmRlZmluZWRcIiA/IG9wdGlvbnMubWFza051bWJlckNoYXIgOiBcIjlcIixcblx0XHQgICAgbWFza1dpbGRjYXJkID0gdHlwZW9mIG9wdGlvbnMubWFza1dpbGRjYXJkQ2hhciAhPT0gXCJ1bmRlZmluZWRcIiA/IG9wdGlvbnMubWFza1dpbGRjYXJkQ2hhciA6IFwiKlwiLFxuXHRcdCAgICBzdWNjZXNzID0gZmFsc2U7XG5cblx0XHRmdW5jdGlvbiBmaWxsU3ltYm9scyhpbmRleCkge1xuXHRcdFx0dmFyIHN5bWJvbCA9IG1hc2tbaW5kZXhdO1xuXHRcdFx0aWYgKHR5cGVvZiBzeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ltYm9sICE9PSBtYXNrV2lsZGNhcmQgJiYgc3ltYm9sICE9PSBtYXNrTGV0dGVyICYmIHN5bWJvbCAhPT0gbWFza051bWJlcikge1xuXHRcdFx0XHRlbC52YWx1ZSA9IGVsLnZhbHVlICsgXCJcIiArIHN5bWJvbDtcblx0XHRcdFx0ZmlsbFN5bWJvbHMoaW5kZXggKyAxKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRlbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIGluZGV4ID0gZWwudmFsdWUubGVuZ3RoLFxuXHRcdFx0ICAgIGNoYXIgPSBlLmtleTtcblxuXHRcdFx0aWYgKGUua2V5Q29kZSA+IDQ2KSB7XG5cdFx0XHRcdGlmIChpbmRleCA+PSBtYXNrLmxlbmd0aCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHN1Y2Nlc3MgPSBmYWxzZTtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c3dpdGNoIChtYXNrW2luZGV4XSkge1xuXHRcdFx0XHRcdFx0Y2FzZSBtYXNrTGV0dGVyOlxuXHRcdFx0XHRcdFx0XHRpZiAoY2hhci50b1VwcGVyQ2FzZSgpID09IGNoYXIudG9Mb3dlckNhc2UoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRcdHN1Y2Nlc3MgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGNhc2UgbWFza051bWJlcjpcblx0XHRcdFx0XHRcdFx0aWYgKGlzTmFOKGNoYXIpKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdFx0c3VjY2VzcyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBtYXNrV2lsZGNhcmQ6XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRpZiAoY2hhciAhPT0gbWFza1tpbmRleF0pIHtcblx0XHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0XHRzdWNjZXNzID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3VjY2VzcyA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9KTtcblxuXHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKGUua2V5Q29kZSA+IDQ2KSB7XG5cdFx0XHRcdGlmIChvcHRpb25zLm1hc2tBdXRvRmlsbCkge1xuXHRcdFx0XHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICghZWwucGxhY2Vob2xkZXIpIHtcblx0XHRcdGVsLnBsYWNlaG9sZGVyID0gbWFzaztcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5tYXNrQXV0b0ZpbGwpIHtcblx0XHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vZGVmYXVsdCBkYXRhIGVkaXRvcnNcblx0RWRpdC5wcm90b3R5cGUuZWRpdG9ycyA9IHtcblxuXHRcdC8vaW5wdXQgZWxlbWVudFxuXHRcdGlucHV0OiBmdW5jdGlvbiBpbnB1dChjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXG5cdFx0XHQvL2NyZWF0ZSBhbmQgc3R5bGUgaW5wdXRcblx0XHRcdHZhciBjZWxsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cblx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgZWRpdG9yUGFyYW1zLnNlYXJjaCA/IFwic2VhcmNoXCIgOiBcInRleHRcIik7XG5cblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC52YWx1ZSA9IHR5cGVvZiBjZWxsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBjZWxsVmFsdWUgOiBcIlwiO1xuXG5cdFx0XHRvblJlbmRlcmVkKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aW5wdXQuZm9jdXMoKTtcblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZnVuY3Rpb24gb25DaGFuZ2UoZSkge1xuXHRcdFx0XHRpZiAoKGNlbGxWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY2VsbFZhbHVlID09PSBcInVuZGVmaW5lZFwiKSAmJiBpbnB1dC52YWx1ZSAhPT0gXCJcIiB8fCBpbnB1dC52YWx1ZSAhPT0gY2VsbFZhbHVlKSB7XG5cblx0XHRcdFx0XHRpZiAoc3VjY2VzcyhpbnB1dC52YWx1ZSkpIHtcblx0XHRcdFx0XHRcdGNlbGxWYWx1ZSA9IGlucHV0LnZhbHVlOyAvL3BlcnNpc3QgdmFsdWUgaWYgc3VjY2Vzc2Z1bGx5IHZhbGlkYXRlZCBpbmNhc2UgZWRpdG9yIGlzIHVzZWQgYXMgaGVhZGVyIGZpbHRlclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1ciBvciBjaGFuZ2Vcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgb25DaGFuZ2UpO1xuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgb25DaGFuZ2UpO1xuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdFx0XHRvbkNoYW5nZShlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLm1hc2spIHtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmVkaXQubWFza0lucHV0KGlucHV0LCBlZGl0b3JQYXJhbXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaW5wdXQ7XG5cdFx0fSxcblxuXHRcdC8vcmVzaXphYmxlIHRleHQgYXJlYSBlbGVtZW50XG5cdFx0dGV4dGFyZWE6IGZ1bmN0aW9uIHRleHRhcmVhKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHQgICAgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIHZlcnROYXYgPSBlZGl0b3JQYXJhbXMudmVydGljYWxOYXZpZ2F0aW9uIHx8IFwiaHlicmlkXCIsXG5cdFx0XHQgICAgdmFsdWUgPSBTdHJpbmcoY2VsbFZhbHVlICE9PSBudWxsICYmIHR5cGVvZiBjZWxsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBjZWxsVmFsdWUgOiBcIlwiKSxcblx0XHRcdCAgICBjb3VudCA9ICh2YWx1ZS5tYXRjaCgvKD86XFxyXFxufFxccnxcXG4pL2cpIHx8IFtdKS5sZW5ndGggKyAxLFxuXHRcdFx0ICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIpLFxuXHRcdFx0ICAgIHNjcm9sbEhlaWdodCA9IDA7XG5cblx0XHRcdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHRcdFx0aW5wdXQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjJweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS53aGl0ZVNwYWNlID0gXCJwcmUtd3JhcFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUucmVzaXplID0gXCJub25lXCI7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgX3R5cGVvZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0Zm9yICh2YXIga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykge1xuXHRcdFx0XHRcdGlmIChrZXkuY2hhckF0KDApID09IFwiK1wiKSB7XG5cdFx0XHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlucHV0LnZhbHVlID0gdmFsdWU7XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRpbnB1dC5mb2N1cygpO1xuXHRcdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiBvbkNoYW5nZShlKSB7XG5cblx0XHRcdFx0aWYgKChjZWxsVmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIGNlbGxWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikgJiYgaW5wdXQudmFsdWUgIT09IFwiXCIgfHwgaW5wdXQudmFsdWUgIT09IGNlbGxWYWx1ZSkge1xuXG5cdFx0XHRcdFx0aWYgKHN1Y2Nlc3MoaW5wdXQudmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRjZWxsVmFsdWUgPSBpbnB1dC52YWx1ZTsgLy9wZXJzaXN0IHZhbHVlIGlmIHN1Y2Nlc3NmdWxseSB2YWxpZGF0ZWQgaW5jYXNlIGVkaXRvciBpcyB1c2VkIGFzIGhlYWRlciBmaWx0ZXJcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdGNlbGwuZ2V0Um93KCkubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHRcdFx0fSwgMzAwKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1ciBvciBjaGFuZ2Vcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgb25DaGFuZ2UpO1xuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgb25DaGFuZ2UpO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiXCI7XG5cblx0XHRcdFx0dmFyIGhlaWdodE5vdyA9IGlucHV0LnNjcm9sbEhlaWdodDtcblxuXHRcdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBoZWlnaHROb3cgKyBcInB4XCI7XG5cblx0XHRcdFx0aWYgKGhlaWdodE5vdyAhPSBzY3JvbGxIZWlnaHQpIHtcblx0XHRcdFx0XHRzY3JvbGxIZWlnaHQgPSBoZWlnaHROb3c7XG5cdFx0XHRcdFx0Y2VsbC5nZXRSb3coKS5ub3JtYWxpemVIZWlnaHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMzg6XG5cdFx0XHRcdFx0XHQvL3VwIGFycm93XG5cdFx0XHRcdFx0XHRpZiAodmVydE5hdiA9PSBcImVkaXRvclwiIHx8IHZlcnROYXYgPT0gXCJoeWJyaWRcIiAmJiBpbnB1dC5zZWxlY3Rpb25TdGFydCkge1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgNDA6XG5cdFx0XHRcdFx0XHQvL2Rvd24gYXJyb3dcblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGlucHV0LnNlbGVjdGlvblN0YXJ0ICE9PSBpbnB1dC52YWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5tYXNrKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5lZGl0Lm1hc2tJbnB1dChpbnB1dCwgZWRpdG9yUGFyYW1zKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGlucHV0O1xuXHRcdH0sXG5cblx0XHQvL2lucHV0IGVsZW1lbnQgd2l0aCB0eXBlIG9mIG51bWJlclxuXHRcdG51bWJlcjogZnVuY3Rpb24gbnVtYmVyKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cblx0XHRcdHZhciBjZWxsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgdmVydE5hdiA9IGVkaXRvclBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJlZGl0b3JcIixcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcIm51bWJlclwiKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBlZGl0b3JQYXJhbXMubWF4ICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwibWF4XCIsIGVkaXRvclBhcmFtcy5tYXgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGVkaXRvclBhcmFtcy5taW4gIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgZWRpdG9yUGFyYW1zLm1pbik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLnN0ZXAgIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJzdGVwXCIsIGVkaXRvclBhcmFtcy5zdGVwKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9jcmVhdGUgYW5kIHN0eWxlIGlucHV0XG5cdFx0XHRpbnB1dC5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblx0XHRcdGlucHV0LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aW5wdXQudmFsdWUgPSBjZWxsVmFsdWU7XG5cblx0XHRcdHZhciBibHVyRnVuYyA9IGZ1bmN0aW9uIGJsdXJGdW5jKGUpIHtcblx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdH07XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1clxuXHRcdFx0XHRpbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYmx1clwiLCBibHVyRnVuYyk7XG5cblx0XHRcdFx0aW5wdXQuZm9jdXMoKTtcblx0XHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cblx0XHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0XHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgYmx1ckZ1bmMpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIG9uQ2hhbmdlKCkge1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuXHRcdFx0XHRpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSAhPT0gXCJcIikge1xuXHRcdFx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh2YWx1ZSAhPT0gY2VsbFZhbHVlKSB7XG5cdFx0XHRcdFx0aWYgKHN1Y2Nlc3ModmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRjZWxsVmFsdWUgPSB2YWx1ZTsgLy9wZXJzaXN0IHZhbHVlIGlmIHN1Y2Nlc3NmdWxseSB2YWxpZGF0ZWQgaW5jYXNlIGVkaXRvciBpcyB1c2VkIGFzIGhlYWRlciBmaWx0ZXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGVudGVyXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdFx0XHQvLyBjYXNlIDk6XG5cdFx0XHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMzg6IC8vdXAgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDQwOlxuXHRcdFx0XHRcdFx0Ly9kb3duIGFycm93XG5cdFx0XHRcdFx0XHRpZiAodmVydE5hdiA9PSBcImVkaXRvclwiKSB7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9pbnB1dCBlbGVtZW50IHdpdGggdHlwZSBvZiBudW1iZXJcblx0XHRyYW5nZTogZnVuY3Rpb24gcmFuZ2UoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpIHtcblxuXHRcdFx0dmFyIGNlbGxWYWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInJhbmdlXCIpO1xuXG5cdFx0XHRpZiAodHlwZW9mIGVkaXRvclBhcmFtcy5tYXggIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgZWRpdG9yUGFyYW1zLm1heCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLm1pbiAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1pblwiLCBlZGl0b3JQYXJhbXMubWluKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBlZGl0b3JQYXJhbXMuc3RlcCAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShcInN0ZXBcIiwgZWRpdG9yUGFyYW1zLnN0ZXApO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2NyZWF0ZSBhbmQgc3R5bGUgaW5wdXRcblx0XHRcdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC52YWx1ZSA9IGNlbGxWYWx1ZTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LmZvY3VzKCk7XG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIG9uQ2hhbmdlKCkge1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZTtcblxuXHRcdFx0XHRpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSAhPT0gXCJcIikge1xuXHRcdFx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh2YWx1ZSAhPSBjZWxsVmFsdWUpIHtcblx0XHRcdFx0XHRpZiAoc3VjY2Vzcyh2YWx1ZSkpIHtcblx0XHRcdFx0XHRcdGNlbGxWYWx1ZSA9IHZhbHVlOyAvL3BlcnNpc3QgdmFsdWUgaWYgc3VjY2Vzc2Z1bGx5IHZhbGlkYXRlZCBpbmNhc2UgZWRpdG9yIGlzIHVzZWQgYXMgaGVhZGVyIGZpbHRlclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1clxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0XHRjYXNlIDk6XG5cdFx0XHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9zZWxlY3Rcblx0XHRzZWxlY3Q6IGZ1bmN0aW9uIHNlbGVjdChjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0ICAgIGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdFx0ICAgIGluaXRpYWxWYWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICB2ZXJ0TmF2ID0gZWRpdG9yUGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiB8fCBcImVkaXRvclwiLFxuXHRcdFx0ICAgIGluaXRpYWxEaXNwbGF5VmFsdWUgPSB0eXBlb2YgaW5pdGlhbFZhbHVlICE9PSBcInVuZGVmaW5lZFwiIHx8IGluaXRpYWxWYWx1ZSA9PT0gbnVsbCA/IGluaXRpYWxWYWx1ZSA6IHR5cGVvZiBlZGl0b3JQYXJhbXMuZGVmYXVsdFZhbHVlICE9PSBcInVuZGVmaW5lZFwiID8gZWRpdG9yUGFyYW1zLmRlZmF1bHRWYWx1ZSA6IFwiXCIsXG5cdFx0XHQgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksXG5cdFx0XHQgICAgbGlzdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRcdCAgICBkYXRhSXRlbXMgPSBbXSxcblx0XHRcdCAgICBkaXNwbGF5SXRlbXMgPSBbXSxcblx0XHRcdCAgICBjdXJyZW50SXRlbSA9IHt9LFxuXHRcdFx0ICAgIGJsdXJhYmxlID0gdHJ1ZTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBjYW5jZWxJdGVtKTtcblxuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoZWRpdG9yUGFyYW1zKSB8fCAhQXJyYXkuaXNBcnJheShlZGl0b3JQYXJhbXMpICYmICh0eXBlb2YgZWRpdG9yUGFyYW1zID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihlZGl0b3JQYXJhbXMpKSA9PT0gXCJvYmplY3RcIiAmJiAhZWRpdG9yUGFyYW1zLnZhbHVlcykge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJERVBSRUNBVElPTiBXQU5SSU5HIC0gdmFsdWVzIGZvciB0aGUgc2VsZWN0IGVkaXRvciBtdXN0IG5vdyBiZSBwYXNzZWQgaW50byB0aGUgdmFsdWVzIHByb3BlcnR5IG9mIHRoZSBlZGl0b3JQYXJhbXMgb2JqZWN0LCBub3QgYXMgdGhlIGVkaXRvclBhcmFtcyBvYmplY3RcIik7XG5cdFx0XHRcdGVkaXRvclBhcmFtcyA9IHsgdmFsdWVzOiBlZGl0b3JQYXJhbXMgfTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0VW5pcXVlQ29sdW1uVmFsdWVzKGZpZWxkKSB7XG5cdFx0XHRcdHZhciBvdXRwdXQgPSB7fSxcblx0XHRcdFx0ICAgIGRhdGEgPSBzZWxmLnRhYmxlLmdldERhdGEoKSxcblx0XHRcdFx0ICAgIGNvbHVtbjtcblxuXHRcdFx0XHRpZiAoZmllbGQpIHtcblx0XHRcdFx0XHRjb2x1bW4gPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uQnlGaWVsZChmaWVsZCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29sdW1uID0gY2VsbC5nZXRDb2x1bW4oKS5fZ2V0U2VsZigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbikge1xuXHRcdFx0XHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0XHR2YXIgdmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUocm93KTtcblxuXHRcdFx0XHRcdFx0aWYgKHZhbCAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbCAhPT0gXCJcIikge1xuXHRcdFx0XHRcdFx0XHRvdXRwdXRbdmFsXSA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNvcnRWYWx1ZXNMaXN0KSB7XG5cdFx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnNvcnRWYWx1ZXNMaXN0ID09IFwiYXNjXCIpIHtcblx0XHRcdFx0XHRcdFx0b3V0cHV0ID0gT2JqZWN0LmtleXMob3V0cHV0KS5zb3J0KCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRvdXRwdXQgPSBPYmplY3Qua2V5cyhvdXRwdXQpLnNvcnQoKS5yZXZlcnNlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG91dHB1dCA9IE9iamVjdC5rZXlzKG91dHB1dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcInVuYWJsZSB0byBmaW5kIG1hdGNoaW5nIGNvbHVtbiB0byBjcmVhdGUgc2VsZWN0IGxvb2t1cCBsaXN0OlwiLCBmaWVsZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBwYXJzZUl0ZW1zKGlucHV0VmFsdWVzLCBjdXJlbnRWYWx1ZSkge1xuXHRcdFx0XHR2YXIgZGF0YUxpc3QgPSBbXTtcblx0XHRcdFx0dmFyIGRpc3BsYXlMaXN0ID0gW107XG5cblx0XHRcdFx0ZnVuY3Rpb24gcHJvY2Vzc0NvbXBsZXhMaXN0SXRlbShpdGVtKSB7XG5cdFx0XHRcdFx0dmFyIGl0ZW0gPSB7XG5cdFx0XHRcdFx0XHRsYWJlbDogZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyID8gZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyKGl0ZW0udmFsdWUsIGl0ZW0ubGFiZWwpIDogaXRlbS5sYWJlbCxcblx0XHRcdFx0XHRcdHZhbHVlOiBpdGVtLnZhbHVlLFxuXHRcdFx0XHRcdFx0ZWxlbWVudDogZmFsc2Vcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0aWYgKGl0ZW0udmFsdWUgPT09IGN1cmVudFZhbHVlIHx8ICFpc05hTihwYXJzZUZsb2F0KGl0ZW0udmFsdWUpKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChpdGVtLnZhbHVlKSkgJiYgcGFyc2VGbG9hdChpdGVtLnZhbHVlKSA9PT0gcGFyc2VGbG9hdChjdXJlbnRWYWx1ZSkpIHtcblx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGl0ZW0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGRhdGFMaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0ZGlzcGxheUxpc3QucHVzaChpdGVtKTtcblxuXHRcdFx0XHRcdHJldHVybiBpdGVtO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBpbnB1dFZhbHVlcyA9PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRpbnB1dFZhbHVlcyA9IGlucHV0VmFsdWVzKGNlbGwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoaW5wdXRWYWx1ZXMpKSB7XG5cdFx0XHRcdFx0aW5wdXRWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdHZhciBpdGVtO1xuXG5cdFx0XHRcdFx0XHRpZiAoKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSA9PT0gXCJvYmplY3RcIikge1xuXG5cdFx0XHRcdFx0XHRcdGlmICh2YWx1ZS5vcHRpb25zKSB7XG5cdFx0XHRcdFx0XHRcdFx0aXRlbSA9IHtcblx0XHRcdFx0XHRcdFx0XHRcdGxhYmVsOiB2YWx1ZS5sYWJlbCxcblx0XHRcdFx0XHRcdFx0XHRcdGdyb3VwOiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudDogZmFsc2Vcblx0XHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdFx0ZGlzcGxheUxpc3QucHVzaChpdGVtKTtcblxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0NvbXBsZXhMaXN0SXRlbShpdGVtKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9jZXNzQ29tcGxleExpc3RJdGVtKHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHRcdGxhYmVsOiBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIgPyBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIodmFsdWUsIHZhbHVlKSA6IHZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlOiB2YWx1ZSxcblx0XHRcdFx0XHRcdFx0XHRlbGVtZW50OiBmYWxzZVxuXHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtLnZhbHVlID09PSBjdXJlbnRWYWx1ZSB8fCAhaXNOYU4ocGFyc2VGbG9hdChpdGVtLnZhbHVlKSkgJiYgIWlzTmFOKHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkpICYmIHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkgPT09IHBhcnNlRmxvYXQoY3VyZW50VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0Q3VycmVudEl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRkYXRhTGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHRkaXNwbGF5TGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGZvciAodmFyIGtleSBpbiBpbnB1dFZhbHVlcykge1xuXHRcdFx0XHRcdFx0dmFyIGl0ZW0gPSB7XG5cdFx0XHRcdFx0XHRcdGxhYmVsOiBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIgPyBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIoa2V5LCBpbnB1dFZhbHVlc1trZXldKSA6IGlucHV0VmFsdWVzW2tleV0sXG5cdFx0XHRcdFx0XHRcdHZhbHVlOiBrZXksXG5cdFx0XHRcdFx0XHRcdGVsZW1lbnQ6IGZhbHNlXG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpZiAoaXRlbS52YWx1ZSA9PT0gY3VyZW50VmFsdWUgfHwgIWlzTmFOKHBhcnNlRmxvYXQoaXRlbS52YWx1ZSkpICYmICFpc05hTihwYXJzZUZsb2F0KGl0ZW0udmFsdWUpKSAmJiBwYXJzZUZsb2F0KGl0ZW0udmFsdWUpID09PSBwYXJzZUZsb2F0KGN1cmVudFZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShpdGVtKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZGF0YUxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRcdGRpc3BsYXlMaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YUl0ZW1zID0gZGF0YUxpc3Q7XG5cdFx0XHRcdGRpc3BsYXlJdGVtcyA9IGRpc3BsYXlMaXN0O1xuXG5cdFx0XHRcdGZpbGxMaXN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbGxMaXN0KCkge1xuXHRcdFx0XHR3aGlsZSAobGlzdEVsLmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHRsaXN0RWwucmVtb3ZlQ2hpbGQobGlzdEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR9ZGlzcGxheUl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHR2YXIgZWwgPSBpdGVtLmVsZW1lbnQ7XG5cblx0XHRcdFx0XHRpZiAoIWVsKSB7XG5cblx0XHRcdFx0XHRcdGlmIChpdGVtLmdyb3VwKSB7XG5cdFx0XHRcdFx0XHRcdGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWdyb3VwXCIpO1xuXHRcdFx0XHRcdFx0XHRlbC50YWJJbmRleCA9IDA7XG5cdFx0XHRcdFx0XHRcdGVsLmlubmVySFRNTCA9IGl0ZW0ubGFiZWwgPT09IFwiXCIgPyBcIiZuYnNwO1wiIDogaXRlbS5sYWJlbDtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW1cIik7XG5cdFx0XHRcdFx0XHRcdGVsLnRhYkluZGV4ID0gMDtcblx0XHRcdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gaXRlbS5sYWJlbCA9PT0gXCJcIiA/IFwiJm5ic3A7XCIgOiBpdGVtLmxhYmVsO1xuXG5cdFx0XHRcdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0Q3VycmVudEl0ZW0oaXRlbSk7XG5cdFx0XHRcdFx0XHRcdFx0Y2hvb3NlSXRlbSgpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoaXRlbSA9PT0gY3VycmVudEl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRibHVyYWJsZSA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdGJsdXJhYmxlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fSwgMTApO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudCA9IGVsO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGxpc3RFbC5hcHBlbmRDaGlsZChlbCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBzZXRDdXJyZW50SXRlbShpdGVtKSB7XG5cblx0XHRcdFx0aWYgKGN1cnJlbnRJdGVtICYmIGN1cnJlbnRJdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRjdXJyZW50SXRlbS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjdXJyZW50SXRlbSA9IGl0ZW07XG5cdFx0XHRcdGlucHV0LnZhbHVlID0gaXRlbS5sYWJlbCA9PT0gXCImbmJzcDtcIiA/IFwiXCIgOiBpdGVtLmxhYmVsO1xuXG5cdFx0XHRcdGlmIChpdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRpdGVtLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjaG9vc2VJdGVtKCkge1xuXHRcdFx0XHRoaWRlTGlzdCgpO1xuXG5cdFx0XHRcdGlmIChpbml0aWFsVmFsdWUgIT09IGN1cnJlbnRJdGVtLnZhbHVlKSB7XG5cdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG5cdFx0XHRcdFx0c3VjY2VzcyhjdXJyZW50SXRlbS52YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2FuY2VsSXRlbSgpIHtcblx0XHRcdFx0aGlkZUxpc3QoKTtcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHNob3dMaXN0KCkge1xuXHRcdFx0XHRpZiAoIWxpc3RFbC5wYXJlbnROb2RlKSB7XG5cblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLnZhbHVlcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoKSwgaW5pdGlhbERpc3BsYXlWYWx1ZSk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLnZhbHVlcyA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdFx0cGFyc2VJdGVtcyhnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoZWRpdG9yUGFyYW1zLnZhbHVlcyksIGluaXRpYWxEaXNwbGF5VmFsdWUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRwYXJzZUl0ZW1zKGVkaXRvclBhcmFtcy52YWx1ZXMgfHwgW10sIGluaXRpYWxEaXNwbGF5VmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhciBvZmZzZXQgPSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQoY2VsbEVsKTtcblxuXHRcdFx0XHRcdGxpc3RFbC5zdHlsZS5taW5XaWR0aCA9IGNlbGxFbC5vZmZzZXRXaWR0aCArIFwicHhcIjtcblxuXHRcdFx0XHRcdGxpc3RFbC5zdHlsZS50b3AgPSBvZmZzZXQudG9wICsgY2VsbEVsLm9mZnNldEhlaWdodCArIFwicHhcIjtcblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUubGVmdCA9IG9mZnNldC5sZWZ0ICsgXCJweFwiO1xuXHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlzdEVsKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBoaWRlTGlzdCgpIHtcblx0XHRcdFx0aWYgKGxpc3RFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0bGlzdEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGlzdEVsKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJlbW92ZVNjcm9sbExpc3RlbmVyKCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlbW92ZVNjcm9sbExpc3RlbmVyKCkge1xuXHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGNhbmNlbEl0ZW0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3N0eWxlIGlucHV0XG5cdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKTtcblxuXHRcdFx0aW5wdXQuc3R5bGUucGFkZGluZyA9IFwiNHB4XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcblx0XHRcdGlucHV0LnJlYWRPbmx5ID0gdGhpcy5jdXJyZW50Q2VsbCAhPSBmYWxzZTtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aW5wdXQudmFsdWUgPSB0eXBlb2YgaW5pdGlhbFZhbHVlICE9PSBcInVuZGVmaW5lZFwiIHx8IGluaXRpYWxWYWx1ZSA9PT0gbnVsbCA/IGluaXRpYWxWYWx1ZSA6IFwiXCI7XG5cblx0XHRcdC8vIGlmKGVkaXRvclBhcmFtcy52YWx1ZXMgPT09IHRydWUpe1xuXHRcdFx0Ly8gXHRwYXJzZUl0ZW1zKGdldFVuaXF1ZUNvbHVtblZhbHVlcygpLCBpbml0aWFsVmFsdWUpO1xuXHRcdFx0Ly8gfWVsc2UgaWYodHlwZW9mIGVkaXRvclBhcmFtcy52YWx1ZXMgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0Ly8gXHRwYXJzZUl0ZW1zKGdldFVuaXF1ZUNvbHVtblZhbHVlcyhlZGl0b3JQYXJhbXMudmFsdWVzKSwgaW5pdGlhbFZhbHVlKTtcblx0XHRcdC8vIH1lbHNle1xuXHRcdFx0Ly8gXHRwYXJzZUl0ZW1zKGVkaXRvclBhcmFtcy52YWx1ZXMgfHwgW10sIGluaXRpYWxWYWx1ZSk7XG5cdFx0XHQvLyB9XG5cblx0XHRcdC8vYWxsb3cga2V5IGJhc2VkIG5hdmlnYXRpb25cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBpbmRleDtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzg6XG5cdFx0XHRcdFx0XHQvL3VwIGFycm93XG5cdFx0XHRcdFx0XHRpbmRleCA9IGRhdGFJdGVtcy5pbmRleE9mKGN1cnJlbnRJdGVtKTtcblxuXHRcdFx0XHRcdFx0aWYgKHZlcnROYXYgPT0gXCJlZGl0b3JcIiB8fCB2ZXJ0TmF2ID09IFwiaHlicmlkXCIgJiYgaW5kZXgpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleCA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkYXRhSXRlbXNbaW5kZXggLSAxXSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSA0MDpcblx0XHRcdFx0XHRcdC8vZG93biBhcnJvd1xuXHRcdFx0XHRcdFx0aW5kZXggPSBkYXRhSXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XG5cblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGluZGV4IDwgZGF0YUl0ZW1zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleCA8IGRhdGFJdGVtcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGluZGV4ID09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkYXRhSXRlbXNbMF0pO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkYXRhSXRlbXNbaW5kZXggKyAxXSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMzc6IC8vbGVmdCBhcnJvd1xuXHRcdFx0XHRcdGNhc2UgMzk6XG5cdFx0XHRcdFx0XHQvL3JpZ2h0IGFycm93XG5cdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0XHRcdC8vZW50ZXJcblx0XHRcdFx0XHRcdGNob29zZUl0ZW0oKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0XHRcdC8vZXNjYXBlXG5cdFx0XHRcdFx0XHRjYW5jZWxJdGVtKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChibHVyYWJsZSkge1xuXHRcdFx0XHRcdGNhbmNlbEl0ZW0oKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzaG93TGlzdCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vc3R5bGUgbGlzdCBlbGVtZW50XG5cdFx0XHRsaXN0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0bGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdFwiKTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0XHRpbnB1dC5mb2N1cygpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9hdXRvY29tcGxldGVcblx0XHRhdXRvY29tcGxldGU6IGZ1bmN0aW9uIGF1dG9jb21wbGV0ZShjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0ICAgIGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdFx0ICAgIGluaXRpYWxWYWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICB2ZXJ0TmF2ID0gZWRpdG9yUGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiB8fCBcImVkaXRvclwiLFxuXHRcdFx0ICAgIGluaXRpYWxEaXNwbGF5VmFsdWUgPSB0eXBlb2YgaW5pdGlhbFZhbHVlICE9PSBcInVuZGVmaW5lZFwiIHx8IGluaXRpYWxWYWx1ZSA9PT0gbnVsbCA/IGluaXRpYWxWYWx1ZSA6IHR5cGVvZiBlZGl0b3JQYXJhbXMuZGVmYXVsdFZhbHVlICE9PSBcInVuZGVmaW5lZFwiID8gZWRpdG9yUGFyYW1zLmRlZmF1bHRWYWx1ZSA6IFwiXCIsXG5cdFx0XHQgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksXG5cdFx0XHQgICAgbGlzdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRcdCAgICBhbGxJdGVtcyA9IFtdLFxuXHRcdFx0ICAgIGRpc3BsYXlJdGVtcyA9IFtdLFxuXHRcdFx0ICAgIHZhbHVlcyA9IFtdLFxuXHRcdFx0ICAgIGN1cnJlbnRJdGVtID0gZmFsc2UsXG5cdFx0XHQgICAgYmx1cmFibGUgPSB0cnVlO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGNhbmNlbEl0ZW0pO1xuXG5cdFx0XHQvL3N0eWxlIGlucHV0XG5cdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwic2VhcmNoXCIpO1xuXG5cdFx0XHRpbnB1dC5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblx0XHRcdGlucHV0LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0XHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdHlsZSBsaXN0IGVsZW1lbnRcblx0XHRcdGxpc3RFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWVkaXQtc2VsZWN0LWxpc3RcIik7XG5cblx0XHRcdGZ1bmN0aW9uIGdldFVuaXF1ZUNvbHVtblZhbHVlcyhmaWVsZCkge1xuXHRcdFx0XHR2YXIgb3V0cHV0ID0ge30sXG5cdFx0XHRcdCAgICBkYXRhID0gc2VsZi50YWJsZS5nZXREYXRhKCksXG5cdFx0XHRcdCAgICBjb2x1bW47XG5cblx0XHRcdFx0aWYgKGZpZWxkKSB7XG5cdFx0XHRcdFx0Y29sdW1uID0gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5RmllbGQoZmllbGQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbHVtbiA9IGNlbGwuZ2V0Q29sdW1uKCkuX2dldFNlbGYoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdFx0dmFyIHZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKHJvdyk7XG5cblx0XHRcdFx0XHRcdGlmICh2YWwgIT09IG51bGwgJiYgdHlwZW9mIHZhbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiB2YWwgIT09IFwiXCIpIHtcblx0XHRcdFx0XHRcdFx0b3V0cHV0W3ZhbF0gPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy5zb3J0VmFsdWVzTGlzdCkge1xuXHRcdFx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy5zb3J0VmFsdWVzTGlzdCA9PSBcImFzY1wiKSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dCA9IE9iamVjdC5rZXlzKG91dHB1dCkuc29ydCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0b3V0cHV0ID0gT2JqZWN0LmtleXMob3V0cHV0KS5zb3J0KCkucmV2ZXJzZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRvdXRwdXQgPSBPYmplY3Qua2V5cyhvdXRwdXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJ1bmFibGUgdG8gZmluZCBtYXRjaGluZyBjb2x1bW4gdG8gY3JlYXRlIGF1dG9jb21wbGV0ZSBsb29rdXAgbGlzdDpcIiwgZmllbGQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG91dHB1dDtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmlsdGVyTGlzdCh0ZXJtLCBpbnRpYWxMb2FkKSB7XG5cdFx0XHRcdHZhciBtYXRjaGVzID0gW10sXG5cdFx0XHRcdCAgICB2YWx1ZXMsXG5cdFx0XHRcdCAgICBpdGVtcyxcblx0XHRcdFx0ICAgIHNlYXJjaEVsO1xuXG5cdFx0XHRcdC8vbG9va3VwIGJhc2UgdmFsdWVzIGxpc3Rcblx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy52YWx1ZXMgPT09IHRydWUpIHtcblx0XHRcdFx0XHR2YWx1ZXMgPSBnZXRVbmlxdWVDb2x1bW5WYWx1ZXMoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLnZhbHVlcyA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdHZhbHVlcyA9IGdldFVuaXF1ZUNvbHVtblZhbHVlcyhlZGl0b3JQYXJhbXMudmFsdWVzKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWx1ZXMgPSBlZGl0b3JQYXJhbXMudmFsdWVzIHx8IFtdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy5zZWFyY2hGdW5jKSB7XG5cdFx0XHRcdFx0bWF0Y2hlcyA9IGVkaXRvclBhcmFtcy5zZWFyY2hGdW5jKHRlcm0sIHZhbHVlcyk7XG5cblx0XHRcdFx0XHRpZiAobWF0Y2hlcyBpbnN0YW5jZW9mIFByb21pc2UpIHtcblxuXHRcdFx0XHRcdFx0YWRkTm90aWNlKHR5cGVvZiBlZGl0b3JQYXJhbXMuc2VhcmNoaW5nUGxhY2Vob2xkZXIgIT09IFwidW5kZWZpbmVkXCIgPyBlZGl0b3JQYXJhbXMuc2VhcmNoaW5nUGxhY2Vob2xkZXIgOiBcIlNlYXJjaGluZy4uLlwiKTtcblxuXHRcdFx0XHRcdFx0bWF0Y2hlcy50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcblx0XHRcdFx0XHRcdFx0ZmlsbExpc3RJZk5vdEVtcHR5KHBhcnNlSXRlbXMocmVzdWx0KSwgaW50aWFsTG9hZCk7XG5cdFx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyKFwiZXJyb3IgaW4gYXV0b2NvbXBsZXRlIHNlYXJjaCBwcm9taXNlOlwiLCBlcnIpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGZpbGxMaXN0SWZOb3RFbXB0eShwYXJzZUl0ZW1zKG1hdGNoZXMpLCBpbnRpYWxMb2FkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aXRlbXMgPSBwYXJzZUl0ZW1zKHZhbHVlcyk7XG5cblx0XHRcdFx0XHRpZiAodGVybSA9PT0gXCJcIikge1xuXHRcdFx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy5zaG93TGlzdE9uRW1wdHkpIHtcblx0XHRcdFx0XHRcdFx0bWF0Y2hlcyA9IGl0ZW1zO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtLnZhbHVlICE9PSBudWxsIHx8IHR5cGVvZiBpdGVtLnZhbHVlICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKFN0cmluZyhpdGVtLnZhbHVlKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoU3RyaW5nKHRlcm0pLnRvTG93ZXJDYXNlKCkpID4gLTEgfHwgU3RyaW5nKGl0ZW0udGl0bGUpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihTdHJpbmcodGVybSkudG9Mb3dlckNhc2UoKSkgPiAtMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0bWF0Y2hlcy5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZmlsbExpc3RJZk5vdEVtcHR5KG1hdGNoZXMsIGludGlhbExvYWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGFkZE5vdGljZShub3RpY2UpIHtcblx0XHRcdFx0dmFyIHNlYXJjaEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdFx0XHRjbGVhckxpc3QoKTtcblxuXHRcdFx0XHRpZiAobm90aWNlICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdHNlYXJjaEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1zZWxlY3QtbGlzdC1ub3RpY2VcIik7XG5cdFx0XHRcdFx0c2VhcmNoRWwudGFiSW5kZXggPSAwO1xuXG5cdFx0XHRcdFx0aWYgKG5vdGljZSBpbnN0YW5jZW9mIE5vZGUpIHtcblx0XHRcdFx0XHRcdHNlYXJjaEVsLmFwcGVuZENoaWxkKG5vdGljZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHNlYXJjaEVsLmlubmVySFRNTCA9IG5vdGljZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsaXN0RWwuYXBwZW5kQ2hpbGQoc2VhcmNoRWwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlSXRlbXMoaW5wdXRWYWx1ZXMpIHtcblx0XHRcdFx0dmFyIGl0ZW1MaXN0ID0gW107XG5cblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoaW5wdXRWYWx1ZXMpKSB7XG5cdFx0XHRcdFx0aW5wdXRWYWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdHZhciBpdGVtID0ge1xuXHRcdFx0XHRcdFx0XHR0aXRsZTogZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyID8gZWRpdG9yUGFyYW1zLmxpc3RJdGVtRm9ybWF0dGVyKHZhbHVlLCB2YWx1ZSkgOiB2YWx1ZSxcblx0XHRcdFx0XHRcdFx0dmFsdWU6IHZhbHVlXG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpdGVtTGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGZvciAodmFyIGtleSBpbiBpbnB1dFZhbHVlcykge1xuXHRcdFx0XHRcdFx0dmFyIGl0ZW0gPSB7XG5cdFx0XHRcdFx0XHRcdHRpdGxlOiBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIgPyBlZGl0b3JQYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIoa2V5LCBpbnB1dFZhbHVlc1trZXldKSA6IGlucHV0VmFsdWVzW2tleV0sXG5cdFx0XHRcdFx0XHRcdHZhbHVlOiBrZXlcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdGl0ZW1MaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGl0ZW1MaXN0O1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjbGVhckxpc3QoKSB7XG5cdFx0XHRcdHdoaWxlIChsaXN0RWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdGxpc3RFbC5yZW1vdmVDaGlsZChsaXN0RWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmlsbExpc3RJZk5vdEVtcHR5KGl0ZW1zLCBpbnRpYWxMb2FkKSB7XG5cdFx0XHRcdGlmIChpdGVtcy5sZW5ndGgpIHtcblx0XHRcdFx0XHRmaWxsTGlzdChpdGVtcywgaW50aWFsTG9hZCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbXB0eVBsYWNlaG9sZGVyKSB7XG5cdFx0XHRcdFx0XHRhZGROb3RpY2UoZWRpdG9yUGFyYW1zLmVtcHR5UGxhY2Vob2xkZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmaWxsTGlzdChpdGVtcywgaW50aWFsTG9hZCkge1xuXHRcdFx0XHR2YXIgY3VycmVudCA9IGZhbHNlO1xuXG5cdFx0XHRcdGNsZWFyTGlzdCgpO1xuXG5cdFx0XHRcdGRpc3BsYXlJdGVtcyA9IGl0ZW1zO1xuXG5cdFx0XHRcdGRpc3BsYXlJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0dmFyIGVsID0gaXRlbS5lbGVtZW50O1xuXG5cdFx0XHRcdFx0aWYgKCFlbCkge1xuXHRcdFx0XHRcdFx0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LXNlbGVjdC1saXN0LWl0ZW1cIik7XG5cdFx0XHRcdFx0XHRlbC50YWJJbmRleCA9IDA7XG5cdFx0XHRcdFx0XHRlbC5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuXG5cdFx0XHRcdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShpdGVtKTtcblx0XHRcdFx0XHRcdFx0Y2hvb3NlSXRlbSgpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRibHVyYWJsZSA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdGJsdXJhYmxlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fSwgMTApO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudCA9IGVsO1xuXG5cdFx0XHRcdFx0XHRpZiAoaW50aWFsTG9hZCAmJiBpdGVtLnZhbHVlID09IGluaXRpYWxWYWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRpbnB1dC52YWx1ZSA9IGl0ZW0udGl0bGU7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGl0ZW0gPT09IGN1cnJlbnRJdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsaXN0RWwuYXBwZW5kQ2hpbGQoZWwpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoIWN1cnJlbnQpIHtcblx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2hvb3NlSXRlbSgpIHtcblx0XHRcdFx0aGlkZUxpc3QoKTtcblxuXHRcdFx0XHRpZiAoY3VycmVudEl0ZW0pIHtcblx0XHRcdFx0XHRpZiAoaW5pdGlhbFZhbHVlICE9PSBjdXJyZW50SXRlbS52YWx1ZSkge1xuXHRcdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG5cdFx0XHRcdFx0XHRpbnB1dC52YWx1ZSA9IGN1cnJlbnRJdGVtLnRpdGxlO1xuXHRcdFx0XHRcdFx0c3VjY2VzcyhjdXJyZW50SXRlbS52YWx1ZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmZyZWV0ZXh0KSB7XG5cdFx0XHRcdFx0XHRpbml0aWFsVmFsdWUgPSBpbnB1dC52YWx1ZTtcblx0XHRcdFx0XHRcdHN1Y2Nlc3MoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmFsbG93RW1wdHkgJiYgaW5wdXQudmFsdWUgPT09IFwiXCIpIHtcblx0XHRcdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gaW5wdXQudmFsdWU7XG5cdFx0XHRcdFx0XHRcdHN1Y2Nlc3MoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHNob3dMaXN0KCkge1xuXHRcdFx0XHRpZiAoIWxpc3RFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0d2hpbGUgKGxpc3RFbC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0XHRsaXN0RWwucmVtb3ZlQ2hpbGQobGlzdEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHRcdH12YXIgb2Zmc2V0ID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KGNlbGxFbCk7XG5cblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUubWluV2lkdGggPSBjZWxsRWwub2Zmc2V0V2lkdGggKyBcInB4XCI7XG5cblx0XHRcdFx0XHRsaXN0RWwuc3R5bGUudG9wID0gb2Zmc2V0LnRvcCArIGNlbGxFbC5vZmZzZXRIZWlnaHQgKyBcInB4XCI7XG5cdFx0XHRcdFx0bGlzdEVsLnN0eWxlLmxlZnQgPSBvZmZzZXQubGVmdCArIFwicHhcIjtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2V0Q3VycmVudEl0ZW0oaXRlbSwgc2hvd0lucHV0VmFsdWUpIHtcblx0XHRcdFx0aWYgKGN1cnJlbnRJdGVtICYmIGN1cnJlbnRJdGVtLmVsZW1lbnQpIHtcblx0XHRcdFx0XHRjdXJyZW50SXRlbS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjdXJyZW50SXRlbSA9IGl0ZW07XG5cblx0XHRcdFx0aWYgKGl0ZW0gJiYgaXRlbS5lbGVtZW50KSB7XG5cdFx0XHRcdFx0aXRlbS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGlkZUxpc3QoKSB7XG5cdFx0XHRcdGlmIChsaXN0RWwucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdGxpc3RFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGxpc3RFbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZW1vdmVTY3JvbGxMaXN0ZW5lcigpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjYW5jZWxJdGVtKCkge1xuXHRcdFx0XHRoaWRlTGlzdCgpO1xuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcmVtb3ZlU2Nyb2xsTGlzdGVuZXIoKSB7XG5cdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgY2FuY2VsSXRlbSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vYWxsb3cga2V5IGJhc2VkIG5hdmlnYXRpb25cblx0XHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBpbmRleDtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzg6XG5cdFx0XHRcdFx0XHQvL3VwIGFycm93XG5cdFx0XHRcdFx0XHRpbmRleCA9IGRpc3BsYXlJdGVtcy5pbmRleE9mKGN1cnJlbnRJdGVtKTtcblxuXHRcdFx0XHRcdFx0aWYgKHZlcnROYXYgPT0gXCJlZGl0b3JcIiB8fCB2ZXJ0TmF2ID09IFwiaHlicmlkXCIgJiYgaW5kZXgpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleCA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRzZXRDdXJyZW50SXRlbShkaXNwbGF5SXRlbXNbaW5kZXggLSAxXSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0Q3VycmVudEl0ZW0oZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgNDA6XG5cdFx0XHRcdFx0XHQvL2Rvd24gYXJyb3dcblxuXHRcdFx0XHRcdFx0aW5kZXggPSBkaXNwbGF5SXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XG5cblx0XHRcdFx0XHRcdGlmICh2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgdmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGluZGV4IDwgZGlzcGxheUl0ZW1zLmxlbmd0aCAtIDEpIHtcblxuXHRcdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGluZGV4IDwgZGlzcGxheUl0ZW1zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoaW5kZXggPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGRpc3BsYXlJdGVtc1swXSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNldEN1cnJlbnRJdGVtKGRpc3BsYXlJdGVtc1tpbmRleCArIDFdKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAzNzogLy9sZWZ0IGFycm93XG5cdFx0XHRcdFx0Y2FzZSAzOTpcblx0XHRcdFx0XHRcdC8vcmlnaHQgYXJyb3dcblx0XHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDEzOlxuXHRcdFx0XHRcdFx0Ly9lbnRlclxuXHRcdFx0XHRcdFx0Y2hvb3NlSXRlbSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Ly9lc2NhcGVcblx0XHRcdFx0XHRcdGNhbmNlbEl0ZW0oKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAzNjogLy9ob21lXG5cdFx0XHRcdFx0Y2FzZSAzNTpcblx0XHRcdFx0XHRcdC8vZW5kXG5cdFx0XHRcdFx0XHQvL3ByZXZlbnQgdGFibGUgbmF2aWdhdGlvbiB3aGlsZSB1c2luZyBpbnB1dCBlbGVtZW50XG5cdFx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzg6IC8vdXAgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDM3OiAvL2xlZnQgYXJyb3dcblx0XHRcdFx0XHRjYXNlIDM5OiAvL3VwIGFycm93XG5cdFx0XHRcdFx0Y2FzZSA0MDogLy9yaWdodCBhcnJvd1xuXHRcdFx0XHRcdGNhc2UgMTM6IC8vZW50ZXJcblx0XHRcdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRcdFx0Ly9lc2NhcGVcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGZpbHRlckxpc3QoaW5wdXQudmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcInNlYXJjaFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRmaWx0ZXJMaXN0KGlucHV0LnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAoYmx1cmFibGUpIHtcblx0XHRcdFx0XHRjaG9vc2VJdGVtKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFyIHZhbHVlID0gaW5pdGlhbERpc3BsYXlWYWx1ZTtcblx0XHRcdFx0c2hvd0xpc3QoKTtcblx0XHRcdFx0aW5wdXQudmFsdWUgPSB2YWx1ZTtcblx0XHRcdFx0ZmlsdGVyTGlzdCh2YWx1ZSwgdHJ1ZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0b25SZW5kZXJlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdFx0XHRpbnB1dC5mb2N1cygpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlZGl0b3JQYXJhbXMubWFzaykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5tYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0Ly9zdGFydCByYXRpbmdcblx0XHRzdGFyOiBmdW5jdGlvbiBzdGFyKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHQgICAgZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdFx0ICAgIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIG1heFN0YXJzID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInN2Z1wiKS5sZW5ndGggfHwgNSxcblx0XHRcdCAgICBzaXplID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInN2Z1wiKVswXSA/IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzdmdcIilbMF0uZ2V0QXR0cmlidXRlKFwid2lkdGhcIikgOiAxNCxcblx0XHRcdCAgICBzdGFycyA9IFtdLFxuXHRcdFx0ICAgIHN0YXJzSG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRcdCAgICBzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIFwic3ZnXCIpO1xuXG5cdFx0XHQvL2NoYW5nZSBzdGFyIHR5cGVcblx0XHRcdGZ1bmN0aW9uIHN0YXJDaGFuZ2UodmFsKSB7XG5cdFx0XHRcdHN0YXJzLmZvckVhY2goZnVuY3Rpb24gKHN0YXIsIGkpIHtcblx0XHRcdFx0XHRpZiAoaSA8IHZhbCkge1xuXHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUuYnJvd3NlciA9PSBcImllXCIpIHtcblx0XHRcdFx0XHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInRhYnVsYXRvci1zdGFyLWFjdGl2ZVwiKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHN0YXIuY2xhc3NMaXN0LnJlcGxhY2UoXCJ0YWJ1bGF0b3Itc3Rhci1pbmFjdGl2ZVwiLCBcInRhYnVsYXRvci1zdGFyLWFjdGl2ZVwiKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c3Rhci5pbm5lckhUTUwgPSAnPHBvbHlnb24gZmlsbD1cIiM0ODhDRTlcIiBzdHJva2U9XCIjMDE0QUFFXCIgc3Ryb2tlLXdpZHRoPVwiMzcuNjE1MlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiIHN0cm9rZS1taXRlcmxpbWl0PVwiMTBcIiBwb2ludHM9XCIyNTkuMjE2LDI5Ljk0MiAzMzAuMjcsMTczLjkxOSA0ODkuMTYsMTk3LjAwNyAzNzQuMTg1LDMwOS4wOCA0MDEuMzMsNDY3LjMxIDI1OS4yMTYsMzkyLjYxMiAxMTcuMTA0LDQ2Ny4zMSAxNDQuMjUsMzA5LjA4IDI5LjI3NCwxOTcuMDA3IDE4OC4xNjUsMTczLjkxOSBcIi8+Jztcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUuYnJvd3NlciA9PSBcImllXCIpIHtcblx0XHRcdFx0XHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInRhYnVsYXRvci1zdGFyLWluYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0c3Rhci5jbGFzc0xpc3QucmVwbGFjZShcInRhYnVsYXRvci1zdGFyLWFjdGl2ZVwiLCBcInRhYnVsYXRvci1zdGFyLWluYWN0aXZlXCIpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzdGFyLmlubmVySFRNTCA9ICc8cG9seWdvbiBmaWxsPVwiIzAxMDE1NVwiIHN0cm9rZT1cIiM2ODY4NjhcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vYnVpbGQgc3RhcnNcblx0XHRcdGZ1bmN0aW9uIGJ1aWxkU3RhcihpKSB7XG5cblx0XHRcdFx0dmFyIHN0YXJIb2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHRcdFx0dmFyIG5leHRTdGFyID0gc3Rhci5jbG9uZU5vZGUodHJ1ZSk7XG5cblx0XHRcdFx0c3RhcnMucHVzaChuZXh0U3Rhcik7XG5cblx0XHRcdFx0c3RhckhvbGRlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRzdGFyQ2hhbmdlKGkpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzdGFySG9sZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHN0YXJIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHN1Y2Nlc3MoaSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHN0YXJIb2xkZXIuYXBwZW5kQ2hpbGQobmV4dFN0YXIpO1xuXHRcdFx0XHRzdGFyc0hvbGRlci5hcHBlbmRDaGlsZChzdGFySG9sZGVyKTtcblx0XHRcdH1cblxuXHRcdFx0Ly9oYW5kbGUga2V5Ym9hcmQgbmF2aWdhdGlvbiB2YWx1ZSBjaGFuZ2Vcblx0XHRcdGZ1bmN0aW9uIGNoYW5nZVZhbHVlKHZhbCkge1xuXHRcdFx0XHR2YWx1ZSA9IHZhbDtcblx0XHRcdFx0c3RhckNoYW5nZSh2YWwpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3N0eWxlIGNlbGxcblx0XHRcdGVsZW1lbnQuc3R5bGUud2hpdGVTcGFjZSA9IFwibm93cmFwXCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdGVsZW1lbnQuc3R5bGUudGV4dE92ZXJmbG93ID0gXCJlbGxpcHNpc1wiO1xuXG5cdFx0XHQvL3N0eWxlIGhvbGRpbmcgZWxlbWVudFxuXHRcdFx0c3RhcnNIb2xkZXIuc3R5bGUudmVydGljYWxBbGlnbiA9IFwibWlkZGxlXCI7XG5cdFx0XHRzdGFyc0hvbGRlci5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcblx0XHRcdHN0YXJzSG9sZGVyLnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXG5cdFx0XHQvL3N0eWxlIHN0YXJcblx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgc2l6ZSk7XG5cdFx0XHRzdGFyLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBzaXplKTtcblx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCA1MTIgNTEyXCIpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ4bWw6c3BhY2VcIiwgXCJwcmVzZXJ2ZVwiKTtcblx0XHRcdHN0YXIuc3R5bGUucGFkZGluZyA9IFwiMCAxcHhcIjtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdHN0YXJzSG9sZGVyLnNldEF0dHJpYnV0ZShrZXksIHN0YXJzSG9sZGVyLmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHN0YXJzSG9sZGVyLnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9jcmVhdGUgY29ycmVjdCBudW1iZXIgb2Ygc3RhcnNcblx0XHRcdGZvciAodmFyIGkgPSAxOyBpIDw9IG1heFN0YXJzOyBpKyspIHtcblx0XHRcdFx0YnVpbGRTdGFyKGkpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2Vuc3VyZSB2YWx1ZSBkb2VzIG5vdCBleGNlZWQgbnVtYmVyIG9mIHN0YXJzXG5cdFx0XHR2YWx1ZSA9IE1hdGgubWluKHBhcnNlSW50KHZhbHVlKSwgbWF4U3RhcnMpO1xuXG5cdFx0XHQvLyBzZXQgaW5pdGlhbCBzdHlsaW5nIG9mIHN0YXJzXG5cdFx0XHRzdGFyQ2hhbmdlKHZhbHVlKTtcblxuXHRcdFx0c3RhcnNIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzdGFyQ2hhbmdlKDApO1xuXHRcdFx0fSk7XG5cblx0XHRcdHN0YXJzSG9sZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzdWNjZXNzKDApO1xuXHRcdFx0fSk7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly9hbGxvdyBrZXkgYmFzZWQgbmF2aWdhdGlvblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgMzk6XG5cdFx0XHRcdFx0XHQvL3JpZ2h0IGFycm93XG5cdFx0XHRcdFx0XHRjaGFuZ2VWYWx1ZSh2YWx1ZSArIDEpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDM3OlxuXHRcdFx0XHRcdFx0Ly9sZWZ0IGFycm93XG5cdFx0XHRcdFx0XHRjaGFuZ2VWYWx1ZSh2YWx1ZSAtIDEpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIDEzOlxuXHRcdFx0XHRcdFx0Ly9lbnRlclxuXHRcdFx0XHRcdFx0c3VjY2Vzcyh2YWx1ZSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMjc6XG5cdFx0XHRcdFx0XHQvL2VzY2FwZVxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzdGFyc0hvbGRlcjtcblx0XHR9LFxuXG5cdFx0Ly9kcmFnZ2FibGUgcHJvZ3Jlc3MgYmFyXG5cdFx0cHJvZ3Jlc3M6IGZ1bmN0aW9uIHByb2dyZXNzKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKSB7XG5cdFx0XHR2YXIgZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdFx0ICAgIG1heCA9IHR5cGVvZiBlZGl0b3JQYXJhbXMubWF4ID09PSBcInVuZGVmaW5lZFwiID8gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRpdlwiKVswXS5nZXRBdHRyaWJ1dGUoXCJtYXhcIikgfHwgMTAwIDogZWRpdG9yUGFyYW1zLm1heCxcblx0XHRcdCAgICBtaW4gPSB0eXBlb2YgZWRpdG9yUGFyYW1zLm1pbiA9PT0gXCJ1bmRlZmluZWRcIiA/IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkaXZcIilbMF0uZ2V0QXR0cmlidXRlKFwibWluXCIpIHx8IDAgOiBlZGl0b3JQYXJhbXMubWluLFxuXHRcdFx0ICAgIHBlcmNlbnQgPSAobWF4IC0gbWluKSAvIDEwMCxcblx0XHRcdCAgICB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSB8fCAwLFxuXHRcdFx0ICAgIGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0XHQgICAgYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRcdCAgICBtb3VzZURyYWcsXG5cdFx0XHQgICAgbW91c2VEcmFnV2lkdGg7XG5cblx0XHRcdC8vc2V0IG5ldyB2YWx1ZVxuXHRcdFx0ZnVuY3Rpb24gdXBkYXRlVmFsdWUoKSB7XG5cdFx0XHRcdHZhciBjYWxjVmFsID0gcGVyY2VudCAqIE1hdGgucm91bmQoYmFyLm9mZnNldFdpZHRoIC8gKGVsZW1lbnQuY2xpZW50V2lkdGggLyAxMDApKSArIG1pbjtcblx0XHRcdFx0c3VjY2VzcyhjYWxjVmFsKTtcblx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXZhbHVlbm93XCIsIGNhbGNWYWwpO1xuXHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3N0eWxlIGhhbmRsZVxuXHRcdFx0aGFuZGxlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0aGFuZGxlLnN0eWxlLnJpZ2h0ID0gXCIwXCI7XG5cdFx0XHRoYW5kbGUuc3R5bGUudG9wID0gXCIwXCI7XG5cdFx0XHRoYW5kbGUuc3R5bGUuYm90dG9tID0gXCIwXCI7XG5cdFx0XHRoYW5kbGUuc3R5bGUud2lkdGggPSBcIjVweFwiO1xuXHRcdFx0aGFuZGxlLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcHJvZ3Jlc3MtaGFuZGxlXCIpO1xuXG5cdFx0XHQvL3N0eWxlIGJhclxuXHRcdFx0YmFyLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRcdFx0YmFyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXHRcdFx0Ly8gYmFyLnN0eWxlLnRvcCA9IFwiOHB4XCI7XG5cdFx0XHQvLyBiYXIuc3R5bGUuYm90dG9tID0gXCI4cHhcIjtcblx0XHRcdC8vIGJhci5zdHlsZS5sZWZ0ID0gXCI0cHhcIjtcblx0XHRcdC8vIGJhci5zdHlsZS5tYXJnaW5SaWdodCA9IFwiNHB4XCI7XG5cdFx0XHRiYXIuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHRiYXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjNDg4Q0U5XCI7XG5cdFx0XHRiYXIuc3R5bGUubWF4V2lkdGggPSBcIjEwMCVcIjtcblx0XHRcdGJhci5zdHlsZS5taW5XaWR0aCA9IFwiMCVcIjtcblxuXHRcdFx0aWYgKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiBfdHlwZW9mKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcykgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0aWYgKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpIHtcblx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdGJhci5zZXRBdHRyaWJ1dGUoa2V5LCBiYXIuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFyLnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9zdHlsZSBjZWxsXG5cdFx0XHRlbGVtZW50LnN0eWxlLnBhZGRpbmcgPSBcIjRweCA0cHhcIjtcblxuXHRcdFx0Ly9tYWtlIHN1cmUgdmFsdWUgaXMgaW4gcmFuZ2Vcblx0XHRcdHZhbHVlID0gTWF0aC5taW4ocGFyc2VGbG9hdCh2YWx1ZSksIG1heCk7XG5cdFx0XHR2YWx1ZSA9IE1hdGgubWF4KHBhcnNlRmxvYXQodmFsdWUpLCBtaW4pO1xuXG5cdFx0XHQvL3dvcmtvdXQgcGVyY2VudGFnZVxuXHRcdFx0dmFsdWUgPSBNYXRoLnJvdW5kKCh2YWx1ZSAtIG1pbikgLyBwZXJjZW50KTtcblx0XHRcdC8vIGJhci5zdHlsZS5yaWdodCA9IHZhbHVlICsgXCIlXCI7XG5cdFx0XHRiYXIuc3R5bGUud2lkdGggPSB2YWx1ZSArIFwiJVwiO1xuXG5cdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdmFsdWVtaW5cIiwgbWluKTtcblx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS12YWx1ZW1heFwiLCBtYXgpO1xuXG5cdFx0XHRiYXIuYXBwZW5kQ2hpbGQoaGFuZGxlKTtcblxuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0bW91c2VEcmFnID0gZS5zY3JlZW5YO1xuXHRcdFx0XHRtb3VzZURyYWdXaWR0aCA9IGJhci5vZmZzZXRXaWR0aDtcblx0XHRcdH0pO1xuXG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGhhbmRsZS5zdHlsZS5jdXJzb3IgPSBcImV3LXJlc2l6ZVwiO1xuXHRcdFx0fSk7XG5cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAobW91c2VEcmFnKSB7XG5cdFx0XHRcdFx0YmFyLnN0eWxlLndpZHRoID0gbW91c2VEcmFnV2lkdGggKyBlLnNjcmVlblggLSBtb3VzZURyYWcgKyBcInB4XCI7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChtb3VzZURyYWcpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cblx0XHRcdFx0XHRtb3VzZURyYWcgPSBmYWxzZTtcblx0XHRcdFx0XHRtb3VzZURyYWdXaWR0aCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0dXBkYXRlVmFsdWUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vYWxsb3cga2V5IGJhc2VkIG5hdmlnYXRpb25cblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHRjYXNlIDM5OlxuXHRcdFx0XHRcdFx0Ly9yaWdodCBhcnJvd1xuXHRcdFx0XHRcdFx0YmFyLnN0eWxlLndpZHRoID0gYmFyLmNsaWVudFdpZHRoICsgZWxlbWVudC5jbGllbnRXaWR0aCAvIDEwMCArIFwicHhcIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAzNzpcblx0XHRcdFx0XHRcdC8vbGVmdCBhcnJvd1xuXHRcdFx0XHRcdFx0YmFyLnN0eWxlLndpZHRoID0gYmFyLmNsaWVudFdpZHRoIC0gZWxlbWVudC5jbGllbnRXaWR0aCAvIDEwMCArIFwicHhcIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0XHRcdC8vZW50ZXJcblx0XHRcdFx0XHRcdHVwZGF0ZVZhbHVlKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgMjc6XG5cdFx0XHRcdFx0XHQvL2VzY2FwZVxuXHRcdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBiYXI7XG5cdFx0fSxcblxuXHRcdC8vY2hlY2tib3hcblx0XHR0aWNrQ3Jvc3M6IGZ1bmN0aW9uIHRpY2tDcm9zcyhjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcykge1xuXHRcdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRcdFx0ICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLFxuXHRcdFx0ICAgIHRyaXN0YXRlID0gZWRpdG9yUGFyYW1zLnRyaXN0YXRlLFxuXHRcdFx0ICAgIGluZGV0ZXJtVmFsdWUgPSB0eXBlb2YgZWRpdG9yUGFyYW1zLmluZGV0ZXJtaW5hdGVWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IG51bGwgOiBlZGl0b3JQYXJhbXMuaW5kZXRlcm1pbmF0ZVZhbHVlLFxuXHRcdFx0ICAgIGluZGV0ZXJtU3RhdGUgPSBmYWxzZTtcblxuXHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXHRcdFx0aW5wdXQuc3R5bGUubWFyZ2luVG9wID0gXCI1cHhcIjtcblx0XHRcdGlucHV0LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xuXG5cdFx0XHRpZiAoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIF90eXBlb2YoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKSA9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAodmFyIGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRpZiAoa2V5LmNoYXJBdCgwKSA9PSBcIitcIikge1xuXHRcdFx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0XHRpZiAodHJpc3RhdGUgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWx1ZSA9PT0gaW5kZXRlcm1WYWx1ZSB8fCB2YWx1ZSA9PT0gXCJcIikpIHtcblx0XHRcdFx0aW5kZXRlcm1TdGF0ZSA9IHRydWU7XG5cdFx0XHRcdGlucHV0LmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5icm93c2VyICE9IFwiZmlyZWZveFwiKSB7XG5cdFx0XHRcdC8vcHJldmVudCBibHVyIGlzc3VlIG9uIG1hYyBmaXJlZm94XG5cdFx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlucHV0LmZvY3VzKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpbnB1dC5jaGVja2VkID0gdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IFwidHJ1ZVwiIHx8IHZhbHVlID09PSBcIlRydWVcIiB8fCB2YWx1ZSA9PT0gMTtcblxuXHRcdFx0ZnVuY3Rpb24gc2V0VmFsdWUoYmx1cikge1xuXHRcdFx0XHRpZiAodHJpc3RhdGUpIHtcblx0XHRcdFx0XHRpZiAoIWJsdXIpIHtcblx0XHRcdFx0XHRcdGlmIChpbnB1dC5jaGVja2VkICYmICFpbmRldGVybVN0YXRlKSB7XG5cdFx0XHRcdFx0XHRcdGlucHV0LmNoZWNrZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0aW5wdXQuaW5kZXRlcm1pbmF0ZSA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdGluZGV0ZXJtU3RhdGUgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gaW5kZXRlcm1WYWx1ZTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGluZGV0ZXJtU3RhdGUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGlucHV0LmNoZWNrZWQ7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChpbmRldGVybVN0YXRlKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBpbmRldGVybVZhbHVlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGlucHV0LmNoZWNrZWQ7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBpbnB1dC5jaGVja2VkO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBibHVyXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHN1Y2Nlc3Moc2V0VmFsdWUoKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c3VjY2VzcyhzZXRWYWx1ZSh0cnVlKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGVudGVyXG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDEzKSB7XG5cdFx0XHRcdFx0c3VjY2VzcyhzZXRWYWx1ZSgpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDI3KSB7XG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gaW5wdXQ7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJlZGl0XCIsIEVkaXQpO1xuXG5cdHZhciBFeHBvcnQgPSBmdW5jdGlvbiBFeHBvcnQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5jb25maWcgPSB7fTtcblx0XHR0aGlzLmNsb25lVGFibGVTdHlsZSA9IHRydWU7XG5cdFx0dGhpcy5jb2xWaXNQcm9wID0gXCJcIjtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLmdlbmVyZWF0ZVRhYmxlID0gZnVuY3Rpb24gKGNvbmZpZywgc3R5bGUsIHJhbmdlLCBjb2xWaXNQcm9wKSB7XG5cdFx0dGhpcy5jbG9uZVRhYmxlU3R5bGUgPSBzdHlsZTtcblx0XHR0aGlzLmNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcblx0XHR0aGlzLmNvbFZpc1Byb3AgPSBjb2xWaXNQcm9wO1xuXG5cdFx0dmFyIHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xuXHRcdHRhYmxlLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcHJpbnQtdGFibGVcIik7XG5cblx0XHRpZiAodGhpcy5jb25maWcuY29sdW1uSGVhZGVycyAhPT0gZmFsc2UpIHtcblx0XHRcdHRhYmxlLmFwcGVuZENoaWxkKHRoaXMuZ2VuZXJhdGVIZWFkZXJFbGVtZW50cygpKTtcblx0XHR9XG5cblx0XHR0YWJsZS5hcHBlbmRDaGlsZCh0aGlzLmdlbmVyYXRlQm9keUVsZW1lbnRzKHRoaXMucm93TG9va3VwKHJhbmdlKSkpO1xuXG5cdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKHRoaXMudGFibGUuZWxlbWVudCwgdGFibGUsIFtcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIl0pO1xuXG5cdFx0cmV0dXJuIHRhYmxlO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUucm93TG9va3VwID0gZnVuY3Rpb24gKHJhbmdlKSB7XG5cdFx0dmFyIF90aGlzNDQgPSB0aGlzO1xuXG5cdFx0dmFyIHJvd3MgPSBbXTtcblxuXHRcdGlmICh0eXBlb2YgcmFuZ2UgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRyYW5nZS5jYWxsKHRoaXMudGFibGUpLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRyb3cgPSBfdGhpczQ0LnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3cpO1xuXG5cdFx0XHRcdGlmIChyb3cpIHtcblx0XHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN3aXRjaCAocmFuZ2UpIHtcblx0XHRcdFx0Y2FzZSB0cnVlOlxuXHRcdFx0XHRjYXNlIFwidmlzaWJsZVwiOlxuXHRcdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0VmlzaWJsZVJvd3ModHJ1ZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImFsbFwiOlxuXHRcdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cztcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwic2VsZWN0ZWRcIjpcblx0XHRcdFx0XHRyb3dzID0gdGhpcy5tb2R1bGVzLnNlbGVjdFJvdy5zZWxlY3RlZFJvd3M7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImFjdGl2ZVwiOlxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihbXSwgcm93cyk7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5nZW5lcmF0ZUNvbHVtbkdyb3VwSGVhZGVycyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM0NSA9IHRoaXM7XG5cblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHR2YXIgY29sdW1ucyA9IHRoaXMuY29uZmlnLmNvbHVtbkdyb3VwcyAhPT0gZmFsc2UgPyB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1ucyA6IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleDtcblxuXHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHR2YXIgY29sRGF0YSA9IF90aGlzNDUucHJvY2Vzc0NvbHVtbkdyb3VwKGNvbHVtbik7XG5cblx0XHRcdGlmIChjb2xEYXRhKSB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKGNvbERhdGEpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRFeHBvcnQucHJvdG90eXBlLnByb2Nlc3NDb2x1bW5Hcm91cCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgX3RoaXM0NiA9IHRoaXM7XG5cblx0XHR2YXIgc3ViR3JvdXBzID0gY29sdW1uLmNvbHVtbnMsXG5cdFx0ICAgIG1heERlcHRoID0gMDtcblxuXHRcdHZhciBncm91cERhdGEgPSB7XG5cdFx0XHR0aXRsZTogY29sdW1uLmRlZmluaXRpb24udGl0bGUsXG5cdFx0XHRjb2x1bW46IGNvbHVtbixcblx0XHRcdGRlcHRoOiAxXG5cdFx0fTtcblxuXHRcdGlmIChzdWJHcm91cHMubGVuZ3RoKSB7XG5cdFx0XHRncm91cERhdGEuc3ViR3JvdXBzID0gW107XG5cdFx0XHRncm91cERhdGEud2lkdGggPSAwO1xuXG5cdFx0XHRzdWJHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoc3ViR3JvdXApIHtcblx0XHRcdFx0dmFyIHN1Ykdyb3VwRGF0YSA9IF90aGlzNDYucHJvY2Vzc0NvbHVtbkdyb3VwKHN1Ykdyb3VwKTtcblxuXHRcdFx0XHRpZiAoc3ViR3JvdXBEYXRhKSB7XG5cdFx0XHRcdFx0Z3JvdXBEYXRhLndpZHRoICs9IHN1Ykdyb3VwRGF0YS53aWR0aDtcblx0XHRcdFx0XHRncm91cERhdGEuc3ViR3JvdXBzLnB1c2goc3ViR3JvdXBEYXRhKTtcblxuXHRcdFx0XHRcdGlmIChzdWJHcm91cERhdGEuZGVwdGggPiBtYXhEZXB0aCkge1xuXHRcdFx0XHRcdFx0bWF4RGVwdGggPSBzdWJHcm91cERhdGEuZGVwdGg7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Z3JvdXBEYXRhLmRlcHRoICs9IG1heERlcHRoO1xuXG5cdFx0XHRpZiAoIWdyb3VwRGF0YS53aWR0aCkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh0aGlzLmNvbHVtblZpc0NoZWNrKGNvbHVtbikpIHtcblx0XHRcdFx0Z3JvdXBEYXRhLndpZHRoID0gMTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZ3JvdXBEYXRhO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ3JvdXBIZWFkZXJzVG9Sb3dzID0gZnVuY3Rpb24gKGNvbHVtbnMpIHtcblxuXHRcdHZhciBoZWFkZXJzID0gW10sXG5cdFx0ICAgIGhlYWRlckRlcHRoID0gMDtcblxuXHRcdGZ1bmN0aW9uIHBhcnNlQ29sdW1uR3JvdXAoY29sdW1uLCBsZXZlbCkge1xuXG5cdFx0XHR2YXIgZGVwdGggPSBoZWFkZXJEZXB0aCAtIGxldmVsO1xuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlcnNbbGV2ZWxdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGhlYWRlcnNbbGV2ZWxdID0gW107XG5cdFx0XHR9XG5cblx0XHRcdGNvbHVtbi5oZWlnaHQgPSBjb2x1bW4uc3ViR3JvdXBzID8gMSA6IGRlcHRoIC0gY29sdW1uLmRlcHRoICsgMTtcblxuXHRcdFx0aGVhZGVyc1tsZXZlbF0ucHVzaChjb2x1bW4pO1xuXG5cdFx0XHRpZiAoY29sdW1uLnN1Ykdyb3Vwcykge1xuXHRcdFx0XHRjb2x1bW4uc3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKHN1Ykdyb3VwKSB7XG5cdFx0XHRcdFx0cGFyc2VDb2x1bW5Hcm91cChzdWJHcm91cCwgbGV2ZWwgKyAxKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9jYWxjdWxhdGUgbWF4aW11bSBoZWFkZXIgZGVidGhcblx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKGNvbHVtbi5kZXB0aCA+IGhlYWRlckRlcHRoKSB7XG5cdFx0XHRcdGhlYWRlckRlcHRoID0gY29sdW1uLmRlcHRoO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHBhcnNlQ29sdW1uR3JvdXAoY29sdW1uLCAwKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBoZWFkZXJzO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJhdGVIZWFkZXJFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM0NyA9IHRoaXM7XG5cblx0XHR2YXIgaGVhZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhlYWRcIik7XG5cblx0XHR2YXIgcm93cyA9IHRoaXMuZ3JvdXBIZWFkZXJzVG9Sb3dzKHRoaXMuZ2VuZXJhdGVDb2x1bW5Hcm91cEhlYWRlcnMoKSk7XG5cblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0dmFyIHJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXG5cdFx0XHRfdGhpczQ3Lm1hcEVsZW1lbnRTdHlsZXMoX3RoaXM0Ny50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEhlYWRlcnNFbGVtZW50KCksIGhlYWRlckVsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiLCBcImNvbG9yXCIsIFwiZm9udC13ZWlnaHRcIiwgXCJmb250LWZhbWlseVwiLCBcImZvbnQtc2l6ZVwiXSk7XG5cblx0XHRcdHJvdy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0dmFyIGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcblx0XHRcdFx0dmFyIGNsYXNzTmFtZXMgPSBjb2x1bW4uY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3MgPyBjb2x1bW4uY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3Muc3BsaXQoXCIgXCIpIDogW107XG5cblx0XHRcdFx0Y2VsbEVsLmNvbFNwYW4gPSBjb2x1bW4ud2lkdGg7XG5cdFx0XHRcdGNlbGxFbC5yb3dTcGFuID0gY29sdW1uLmhlaWdodDtcblxuXHRcdFx0XHRjZWxsRWwuaW5uZXJIVE1MID0gY29sdW1uLmNvbHVtbi5kZWZpbml0aW9uLnRpdGxlO1xuXG5cdFx0XHRcdGlmIChfdGhpczQ3LmNsb25lVGFibGVTdHlsZSkge1xuXHRcdFx0XHRcdGNlbGxFbC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsYXNzTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG5cdFx0XHRcdFx0Y2VsbEVsLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0X3RoaXM0Ny5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb2x1bW4uZ2V0RWxlbWVudCgpLCBjZWxsRWwsIFtcInRleHQtYWxpZ25cIiwgXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiLCBcImNvbG9yXCIsIFwiZm9udC13ZWlnaHRcIiwgXCJmb250LWZhbWlseVwiLCBcImZvbnQtc2l6ZVwiXSk7XG5cdFx0XHRcdF90aGlzNDcubWFwRWxlbWVudFN0eWxlcyhjb2x1bW4uY29sdW1uLmNvbnRlbnRFbGVtZW50LCBjZWxsRWwsIFtcInBhZGRpbmctdG9wXCIsIFwicGFkZGluZy1sZWZ0XCIsIFwicGFkZGluZy1yaWdodFwiLCBcInBhZGRpbmctYm90dG9tXCJdKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uLmNvbHVtbi52aXNpYmxlKSB7XG5cdFx0XHRcdFx0X3RoaXM0Ny5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb2x1bW4uZ2V0RWxlbWVudCgpLCBjZWxsRWwsIFtcIndpZHRoXCJdKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAoY29sdW1uLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoKSB7XG5cdFx0XHRcdFx0XHRjZWxsRWwuc3R5bGUud2lkdGggPSBjb2x1bW4uY29sdW1uLmRlZmluaXRpb24ud2lkdGggKyBcInB4XCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5jb2x1bW4ucGFyZW50KSB7XG5cdFx0XHRcdFx0X3RoaXM0Ny5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb2x1bW4ucGFyZW50Lmdyb3VwRWxlbWVudCwgY2VsbEVsLCBbXCJib3JkZXItdG9wXCJdKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvd0VsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQocm93RWwpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGhlYWRlckVsO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuZ2VuZXJhdGVCb2R5RWxlbWVudHMgPSBmdW5jdGlvbiAocm93cykge307XG5cblx0RXhwb3J0LnByb3RvdHlwZS5nZW5lcmF0ZUJvZHlFbGVtZW50cyA9IGZ1bmN0aW9uIChyb3dzKSB7XG5cdFx0dmFyIF90aGlzNDggPSB0aGlzO1xuXG5cdFx0dmFyIG9kZFJvdywgZXZlblJvdywgY2FsY1JvdywgZmlyc3RSb3csIGZpcnN0Q2VsbCwgZmlyc3RHcm91cCwgbGFzdENlbGwsIHN0eWxlQ2VsbHMsIHN0eWxlUm93LCB0cmVlRWxlbWVudEZpZWxkLCByb3dGb3JtYXR0ZXI7XG5cblx0XHQvL2Fzc2lnbiByb3cgZm9ybWF0dGVyXG5cdFx0cm93Rm9ybWF0dGVyID0gdGhpcy50YWJsZS5vcHRpb25zW1wicm93Rm9ybWF0dGVyXCIgKyAodGhpcy5jb2xWaXNQcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xWaXNQcm9wLnNsaWNlKDEpKV07XG5cdFx0cm93Rm9ybWF0dGVyID0gcm93Rm9ybWF0dGVyICE9PSBudWxsID8gcm93Rm9ybWF0dGVyIDogdGhpcy50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcjtcblxuXHRcdC8vbG9va3VwIHJvdyBzdHlsZXNcblx0XHRpZiAodGhpcy5jbG9uZVRhYmxlU3R5bGUgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcblx0XHRcdG9kZFJvdyA9IHRoaXMudGFibGUuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhYnVsYXRvci1yb3ctb2RkOm5vdCgudGFidWxhdG9yLWdyb3VwKTpub3QoLnRhYnVsYXRvci1jYWxjcylcIik7XG5cdFx0XHRldmVuUm93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdy1ldmVuOm5vdCgudGFidWxhdG9yLWdyb3VwKTpub3QoLnRhYnVsYXRvci1jYWxjcylcIik7XG5cdFx0XHRjYWxjUm93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdy50YWJ1bGF0b3ItY2FsY3NcIik7XG5cdFx0XHRmaXJzdFJvdyA9IHRoaXMudGFibGUuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhYnVsYXRvci1yb3c6bm90KC50YWJ1bGF0b3ItZ3JvdXApOm5vdCgudGFidWxhdG9yLWNhbGNzKVwiKTtcblx0XHRcdGZpcnN0R3JvdXAgPSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInRhYnVsYXRvci1ncm91cFwiKVswXTtcblxuXHRcdFx0aWYgKGZpcnN0Um93KSB7XG5cdFx0XHRcdHN0eWxlQ2VsbHMgPSBmaXJzdFJvdy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidGFidWxhdG9yLWNlbGxcIik7XG5cdFx0XHRcdGZpcnN0Q2VsbCA9IHN0eWxlQ2VsbHNbMF07XG5cdFx0XHRcdGxhc3RDZWxsID0gc3R5bGVDZWxsc1tzdHlsZUNlbGxzLmxlbmd0aCAtIDFdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHZhciBib2R5RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGJvZHlcIik7XG5cblx0XHR2YXIgY29sdW1ucyA9IFtdO1xuXG5cdFx0aWYgKHRoaXMuY29uZmlnLmNvbHVtbkNhbGNzICE9PSBmYWxzZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcEluaXRpYWxpemVkKSB7XG5cdFx0XHRcdHJvd3MudW5zaGlmdCh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wUm93KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5ib3RJbml0aWFsaXplZCkge1xuXHRcdFx0XHRyb3dzLnB1c2godGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmJvdFJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKF90aGlzNDguY29sdW1uVmlzQ2hlY2soY29sdW1uKSkge1xuXHRcdFx0XHRjb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgdGhpcy5jb25maWcuZGF0YVRyZWUgIT09IGZhbHNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblx0XHRcdHRyZWVFbGVtZW50RmllbGQgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUuZWxlbWVudEZpZWxkO1xuXHRcdH1cblxuXHRcdHJvd3MgPSByb3dzLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRzd2l0Y2ggKHJvdy50eXBlKSB7XG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdHJldHVybiBfdGhpczQ4LmNvbmZpZy5yb3dHcm91cHMgIT09IGZhbHNlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJjYWxjXCI6XG5cdFx0XHRcdFx0cmV0dXJuIF90aGlzNDguY29uZmlnLmNvbHVtbkNhbGNzICE9PSBmYWxzZTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSk7XG5cblx0XHRpZiAocm93cy5sZW5ndGggPiAxMDAwKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJJdCBtYXkgdGFrZSBhIGxvbmcgdGltZSB0byByZW5kZXIgYW4gSFRNTCB0YWJsZSB3aXRoIG1vcmUgdGhhbiAxMDAwIHJvd3NcIik7XG5cdFx0fVxuXG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3csIGkpIHtcblx0XHRcdHZhciByb3dEYXRhID0gcm93LmdldERhdGEoX3RoaXM0OC5jb2xWaXNQcm9wKTtcblxuXHRcdFx0dmFyIHJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1yb3dcIik7XG5cblx0XHRcdHN3aXRjaCAocm93LnR5cGUpIHtcblx0XHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdFx0dmFyIGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcblx0XHRcdFx0XHRjZWxsRWwuY29sU3BhbiA9IGNvbHVtbnMubGVuZ3RoO1xuXHRcdFx0XHRcdGNlbGxFbC5pbm5lckhUTUwgPSByb3cua2V5O1xuXG5cdFx0XHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1ncm91cFwiKTtcblxuXHRcdFx0XHRcdF90aGlzNDgubWFwRWxlbWVudFN0eWxlcyhmaXJzdEdyb3VwLCByb3dFbCwgW1wiYm9yZGVyLXRvcFwiLCBcImJvcmRlci1sZWZ0XCIsIFwiYm9yZGVyLXJpZ2h0XCIsIFwiYm9yZGVyLWJvdHRvbVwiLCBcImNvbG9yXCIsIFwiZm9udC13ZWlnaHRcIiwgXCJmb250LWZhbWlseVwiLCBcImZvbnQtc2l6ZVwiLCBcImJhY2tncm91bmQtY29sb3JcIl0pO1xuXHRcdFx0XHRcdF90aGlzNDgubWFwRWxlbWVudFN0eWxlcyhmaXJzdEdyb3VwLCBjZWxsRWwsIFtcInBhZGRpbmctdG9wXCIsIFwicGFkZGluZy1sZWZ0XCIsIFwicGFkZGluZy1yaWdodFwiLCBcInBhZGRpbmctYm90dG9tXCJdKTtcblx0XHRcdFx0XHRyb3dFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJjYWxjXCI6XG5cdFx0XHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1jYWxjc1wiKTtcblxuXHRcdFx0XHRjYXNlIFwicm93XCI6XG5cblx0XHRcdFx0XHRpZiAoX3RoaXM0OC50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIF90aGlzNDguY29uZmlnLmRhdGFUcmVlID09PSBmYWxzZSAmJiByb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbiwgaSkge1xuXHRcdFx0XHRcdFx0dmFyIGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcblxuXHRcdFx0XHRcdFx0dmFyIHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUocm93RGF0YSk7XG5cblx0XHRcdFx0XHRcdHZhciBjZWxsV3JhcHBlciA9IHtcblx0XHRcdFx0XHRcdFx0bW9kdWxlczoge30sXG5cdFx0XHRcdFx0XHRcdGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdGdldEZpZWxkOiBmdW5jdGlvbiBnZXRGaWVsZCgpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb24uZmllbGQ7XG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdGdldEVsZW1lbnQ6IGZ1bmN0aW9uIGdldEVsZW1lbnQoKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGNlbGxFbDtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Z2V0Q29sdW1uOiBmdW5jdGlvbiBnZXRDb2x1bW4oKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Z2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YSgpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcm93RGF0YTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Z2V0Um93OiBmdW5jdGlvbiBnZXRSb3coKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJvdy5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Z2V0Q29tcG9uZW50OiBmdW5jdGlvbiBnZXRDb21wb25lbnQoKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGNlbGxXcmFwcGVyO1xuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRjb2x1bW46IGNvbHVtblxuXHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0dmFyIGNsYXNzTmFtZXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcyA/IGNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKSA6IFtdO1xuXG5cdFx0XHRcdFx0XHRjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdFx0XHRjZWxsRWwuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczQ4LnRhYmxlLm1vZEV4aXN0cyhcImZvcm1hdFwiKSAmJiBfdGhpczQ4LmNvbmZpZy5mb3JtYXRDZWxscyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBfdGhpczQ4LnRhYmxlLm1vZHVsZXMuZm9ybWF0LmZvcm1hdEV4cG9ydFZhbHVlKGNlbGxXcmFwcGVyLCBfdGhpczQ4LmNvbFZpc1Byb3ApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSBcIm51bGxcIjpcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgTm9kZSkge1xuXHRcdFx0XHRcdFx0XHRjZWxsRWwuYXBwZW5kQ2hpbGQodmFsdWUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y2VsbEVsLmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoZmlyc3RDZWxsKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzNDgubWFwRWxlbWVudFN0eWxlcyhmaXJzdENlbGwsIGNlbGxFbCwgW1wicGFkZGluZy10b3BcIiwgXCJwYWRkaW5nLWxlZnRcIiwgXCJwYWRkaW5nLXJpZ2h0XCIsIFwicGFkZGluZy1ib3R0b21cIiwgXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCJdKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uYWxpZ24pIHtcblx0XHRcdFx0XHRcdFx0XHRjZWxsRWwuc3R5bGUudGV4dEFsaWduID0gY29sdW1uLmRlZmluaXRpb24uYWxpZ247XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKF90aGlzNDgudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiBfdGhpczQ4LmNvbmZpZy5kYXRhVHJlZSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHRyZWVFbGVtZW50RmllbGQgJiYgdHJlZUVsZW1lbnRGaWVsZCA9PSBjb2x1bW4uZmllbGQgfHwgIXRyZWVFbGVtZW50RmllbGQgJiYgaSA9PSAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHJvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2VsbEVsLmluc2VydEJlZm9yZShyb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwuY2xvbmVOb2RlKHRydWUpLCBjZWxsRWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdGlmIChyb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2VsbEVsLmluc2VydEJlZm9yZShyb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbC5jbG9uZU5vZGUodHJ1ZSksIGNlbGxFbC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cm93RWwuYXBwZW5kQ2hpbGQoY2VsbEVsKTtcblxuXHRcdFx0XHRcdFx0aWYgKGNlbGxXcmFwcGVyLm1vZHVsZXMuZm9ybWF0ICYmIGNlbGxXcmFwcGVyLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkQ2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0Y2VsbFdyYXBwZXIubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjaygpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0c3R5bGVSb3cgPSByb3cudHlwZSA9PSBcImNhbGNcIiA/IGNhbGNSb3cgOiBpICUgMiAmJiBldmVuUm93ID8gZXZlblJvdyA6IG9kZFJvdztcblxuXHRcdFx0XHRcdF90aGlzNDgubWFwRWxlbWVudFN0eWxlcyhzdHlsZVJvdywgcm93RWwsIFtcImJvcmRlci10b3BcIiwgXCJib3JkZXItbGVmdFwiLCBcImJvcmRlci1yaWdodFwiLCBcImJvcmRlci1ib3R0b21cIiwgXCJjb2xvclwiLCBcImZvbnQtd2VpZ2h0XCIsIFwiZm9udC1mYW1pbHlcIiwgXCJmb250LXNpemVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yXCJdKTtcblxuXHRcdFx0XHRcdGlmIChyb3dGb3JtYXR0ZXIgJiYgX3RoaXM0OC5jb25maWcuZm9ybWF0Q2VsbHMgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHR2YXIgcm93Q29tcG9uZW50ID0gcm93LmdldENvbXBvbmVudCgpO1xuXG5cdFx0XHRcdFx0XHRyb3dDb21wb25lbnQuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJvd0VsO1xuXHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0cm93Rm9ybWF0dGVyKHJvd0NvbXBvbmVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGJvZHlFbC5hcHBlbmRDaGlsZChyb3dFbCk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gYm9keUVsO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUuY29sdW1uVmlzQ2hlY2sgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uW3RoaXMuY29sVmlzUHJvcF0gIT09IGZhbHNlICYmIChjb2x1bW4udmlzaWJsZSB8fCAhY29sdW1uLnZpc2libGUgJiYgY29sdW1uLmRlZmluaXRpb25bdGhpcy5jb2xWaXNQcm9wXSk7XG5cdH07XG5cblx0RXhwb3J0LnByb3RvdHlwZS5nZXRIdG1sID0gZnVuY3Rpb24gKHZpc2libGUsIHN0eWxlLCBjb25maWcsIGNvbFZpc1Byb3ApIHtcblx0XHR2YXIgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGhvbGRlci5hcHBlbmRDaGlsZCh0aGlzLmdlbmVyZWF0ZVRhYmxlKGNvbmZpZyB8fCB0aGlzLnRhYmxlLm9wdGlvbnMuaHRtbE91dHB1dENvbmZpZywgc3R5bGUsIHZpc2libGUsIGNvbFZpc1Byb3AgfHwgXCJodG1sT3V0cHV0XCIpKTtcblxuXHRcdHJldHVybiBob2xkZXIuaW5uZXJIVE1MO1xuXHR9O1xuXG5cdEV4cG9ydC5wcm90b3R5cGUubWFwRWxlbWVudFN0eWxlcyA9IGZ1bmN0aW9uIChmcm9tLCB0bywgcHJvcHMpIHtcblx0XHRpZiAodGhpcy5jbG9uZVRhYmxlU3R5bGUgJiYgZnJvbSAmJiB0bykge1xuXG5cdFx0XHR2YXIgbG9va3VwID0ge1xuXHRcdFx0XHRcImJhY2tncm91bmQtY29sb3JcIjogXCJiYWNrZ3JvdW5kQ29sb3JcIixcblx0XHRcdFx0XCJjb2xvclwiOiBcImZvbnRDb2xvclwiLFxuXHRcdFx0XHRcIndpZHRoXCI6IFwid2lkdGhcIixcblx0XHRcdFx0XCJmb250LXdlaWdodFwiOiBcImZvbnRXZWlnaHRcIixcblx0XHRcdFx0XCJmb250LWZhbWlseVwiOiBcImZvbnRGYW1pbHlcIixcblx0XHRcdFx0XCJmb250LXNpemVcIjogXCJmb250U2l6ZVwiLFxuXHRcdFx0XHRcInRleHQtYWxpZ25cIjogXCJ0ZXh0QWxpZ25cIixcblx0XHRcdFx0XCJib3JkZXItdG9wXCI6IFwiYm9yZGVyVG9wXCIsXG5cdFx0XHRcdFwiYm9yZGVyLWxlZnRcIjogXCJib3JkZXJMZWZ0XCIsXG5cdFx0XHRcdFwiYm9yZGVyLXJpZ2h0XCI6IFwiYm9yZGVyUmlnaHRcIixcblx0XHRcdFx0XCJib3JkZXItYm90dG9tXCI6IFwiYm9yZGVyQm90dG9tXCIsXG5cdFx0XHRcdFwicGFkZGluZy10b3BcIjogXCJwYWRkaW5nVG9wXCIsXG5cdFx0XHRcdFwicGFkZGluZy1sZWZ0XCI6IFwicGFkZGluZ0xlZnRcIixcblx0XHRcdFx0XCJwYWRkaW5nLXJpZ2h0XCI6IFwicGFkZGluZ1JpZ2h0XCIsXG5cdFx0XHRcdFwicGFkZGluZy1ib3R0b21cIjogXCJwYWRkaW5nQm90dG9tXCJcblx0XHRcdH07XG5cblx0XHRcdGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuXHRcdFx0XHR2YXIgZnJvbVN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZnJvbSk7XG5cblx0XHRcdFx0cHJvcHMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuXHRcdFx0XHRcdHRvLnN0eWxlW2xvb2t1cFtwcm9wXV0gPSBmcm9tU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJleHBvcnRcIiwgRXhwb3J0KTtcblxuXHR2YXIgRmlsdGVyID0gZnVuY3Rpb24gRmlsdGVyKHRhYmxlKSB7XG5cblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cblx0XHR0aGlzLmZpbHRlckxpc3QgPSBbXTsgLy9ob2xkIGZpbHRlciBsaXN0XG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJzID0ge307IC8vaG9sZCBjb2x1bW4gZmlsdGVyc1xuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucyA9IFtdOyAvL2hvbGQgY29sdW1ucyB0aGF0IHVzZSBoZWFkZXIgZmlsdGVyc1xuXG5cdFx0dGhpcy5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgPSBcIlwiO1xuXHRcdHRoaXMucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrID0gXCJ7fVwiO1xuXG5cdFx0dGhpcy5jaGFuZ2VkID0gZmFsc2U7IC8vaGFzIGZpbHRlcmluZyBjaGFuZ2VkIHNpbmNlIGxhc3QgcmVuZGVyXG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBoZWFkZXIgZmlsdGVyXG5cdEZpbHRlci5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4sIHZhbHVlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpLFxuXHRcdCAgICBwYXJhbXM7XG5cblx0XHQvL2hhbmRsZSBzdWNjZXNzZnVsbCB2YWx1ZSBjaGFuZ2Vcblx0XHRmdW5jdGlvbiBzdWNjZXNzKHZhbHVlKSB7XG5cdFx0XHR2YXIgZmlsdGVyVHlwZSA9IGNvbHVtbi5tb2R1bGVzLmZpbHRlci50YWdUeXBlID09IFwiaW5wdXRcIiAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuYXR0clR5cGUgPT0gXCJ0ZXh0XCIgfHwgY29sdW1uLm1vZHVsZXMuZmlsdGVyLnRhZ1R5cGUgPT0gXCJ0ZXh0YXJlYVwiID8gXCJwYXJ0aWFsXCIgOiBcIm1hdGNoXCIsXG5cdFx0XHQgICAgdHlwZSA9IFwiXCIsXG5cdFx0XHQgICAgZmlsdGVyQ2hhbmdlQ2hlY2sgPSBcIlwiLFxuXHRcdFx0ICAgIGZpbHRlckZ1bmM7XG5cblx0XHRcdGlmICh0eXBlb2YgY29sdW1uLm1vZHVsZXMuZmlsdGVyLnByZXZTdWNjZXNzID09PSBcInVuZGVmaW5lZFwiIHx8IGNvbHVtbi5tb2R1bGVzLmZpbHRlci5wcmV2U3VjY2VzcyAhPT0gdmFsdWUpIHtcblxuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIucHJldlN1Y2Nlc3MgPSB2YWx1ZTtcblxuXHRcdFx0XHRpZiAoIWNvbHVtbi5tb2R1bGVzLmZpbHRlci5lbXB0eUZ1bmModmFsdWUpKSB7XG5cdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnZhbHVlID0gdmFsdWU7XG5cblx0XHRcdFx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuYykpIHtcblx0XHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdFx0aWYgKHNlbGYuZmlsdGVyc1tjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jXSkge1xuXHRcdFx0XHRcdFx0XHRcdHR5cGUgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jO1xuXHRcdFx0XHRcdFx0XHRcdGZpbHRlckZ1bmMgPSBmdW5jdGlvbiBmaWx0ZXJGdW5jKGRhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBwYXJhbXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jUGFyYW1zIHx8IHt9O1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGZpZWxkVmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBwYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IHBhcmFtcyh2YWx1ZSwgZmllbGRWYWwsIGRhdGEpIDogcGFyYW1zO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gc2VsZi5maWx0ZXJzW2NvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckZ1bmNdKHZhbHVlLCBmaWVsZFZhbCwgZGF0YSwgcGFyYW1zKTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkhlYWRlciBGaWx0ZXIgRXJyb3IgLSBNYXRjaGluZyBmaWx0ZXIgZnVuY3Rpb24gbm90IGZvdW5kOiBcIiwgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuYyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHBhcmFtcyA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckZ1bmNQYXJhbXMgfHwge307XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGZpZWxkVmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgcGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXModmFsdWUsIGZpZWxkVmFsLCBkYXRhKSA6IHBhcmFtcztcblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jKHZhbHVlLCBmaWVsZFZhbCwgZGF0YSwgcGFyYW1zKTtcblx0XHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0XHR0eXBlID0gZmlsdGVyRnVuYztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFmaWx0ZXJGdW5jKSB7XG5cdFx0XHRcdFx0XHRzd2l0Y2ggKGZpbHRlclR5cGUpIHtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcInBhcnRpYWxcIjpcblx0XHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgY29sVmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29sVmFsICE9PSAndW5kZWZpbmVkJyAmJiBjb2xWYWwgIT09IG51bGwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIFN0cmluZyhjb2xWYWwpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihTdHJpbmcodmFsdWUpLnRvTG93ZXJDYXNlKCkpID4gLTE7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR0eXBlID0gXCJsaWtlXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24gZmlsdGVyRnVuYyhkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSkgPT0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR0eXBlID0gXCI9XCI7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5oZWFkZXJGaWx0ZXJzW2ZpZWxkXSA9IHsgdmFsdWU6IHZhbHVlLCBmdW5jOiBmaWx0ZXJGdW5jLCB0eXBlOiB0eXBlIH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZGVsZXRlIHNlbGYuaGVhZGVyRmlsdGVyc1tmaWVsZF07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmaWx0ZXJDaGFuZ2VDaGVjayA9IEpTT04uc3RyaW5naWZ5KHNlbGYuaGVhZGVyRmlsdGVycyk7XG5cblx0XHRcdFx0aWYgKHNlbGYucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrICE9PSBmaWx0ZXJDaGFuZ2VDaGVjaykge1xuXHRcdFx0XHRcdHNlbGYucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrID0gZmlsdGVyQ2hhbmdlQ2hlY2s7XG5cblx0XHRcdFx0XHRzZWxmLmNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5maWx0ZXJSZWZyZXNoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyID0ge1xuXHRcdFx0c3VjY2Vzczogc3VjY2Vzcyxcblx0XHRcdGF0dHJUeXBlOiBmYWxzZSxcblx0XHRcdHRhZ1R5cGU6IGZhbHNlLFxuXHRcdFx0ZW1wdHlGdW5jOiBmYWxzZVxuXHRcdH07XG5cblx0XHR0aGlzLmdlbmVyYXRlSGVhZGVyRmlsdGVyRWxlbWVudChjb2x1bW4pO1xuXHR9O1xuXG5cdEZpbHRlci5wcm90b3R5cGUuZ2VuZXJhdGVIZWFkZXJGaWx0ZXJFbGVtZW50ID0gZnVuY3Rpb24gKGNvbHVtbiwgaW5pdGlhbFZhbHVlLCByZWluaXRpYWxpemUpIHtcblx0XHR2YXIgX3RoaXM0OSA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHN1Y2Nlc3MgPSBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuc3VjY2Vzcyxcblx0XHQgICAgZmllbGQgPSBjb2x1bW4uZ2V0RmllbGQoKSxcblx0XHQgICAgZmlsdGVyRWxlbWVudCxcblx0XHQgICAgZWRpdG9yLFxuXHRcdCAgICBlZGl0b3JFbGVtZW50LFxuXHRcdCAgICBjZWxsV3JhcHBlcixcblx0XHQgICAgdHlwaW5nVGltZXIsXG5cdFx0ICAgIHNlYXJjaFRyaWdnZXIsXG5cdFx0ICAgIHBhcmFtcztcblxuXHRcdC8vaGFuZGxlIGFib3J0ZWQgZWRpdFxuXHRcdGZ1bmN0aW9uIGNhbmNlbCgpIHt9XG5cblx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQucGFyZW50Tm9kZSkge1xuXHRcdFx0Y29sdW1uLmNvbnRlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50LnBhcmVudE5vZGUpO1xuXHRcdH1cblxuXHRcdGlmIChmaWVsZCkge1xuXG5cdFx0XHQvL3NldCBlbXB0eSB2YWx1ZSBmdW5jdGlvblxuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckVtcHR5Q2hlY2sgfHwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdHJldHVybiAhdmFsdWUgJiYgdmFsdWUgIT09IFwiMFwiO1xuXHRcdFx0fTtcblxuXHRcdFx0ZmlsdGVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRmaWx0ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItaGVhZGVyLWZpbHRlclwiKTtcblxuXHRcdFx0Ly9zZXQgY29sdW1uIGVkaXRvclxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlcikpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGlmIChzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlcl0pIHtcblx0XHRcdFx0XHRcdGVkaXRvciA9IHNlbGYudGFibGUubW9kdWxlcy5lZGl0LmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyXTtcblxuXHRcdFx0XHRcdFx0aWYgKChjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXIgPT09IFwidGlja1wiIHx8IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gXCJ0aWNrQ3Jvc3NcIikgJiYgIWNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckVtcHR5Q2hlY2spIHtcblx0XHRcdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZSAhPT0gdHJ1ZSAmJiB2YWx1ZSAhPT0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIENhbm5vdCBidWlsZCBoZWFkZXIgZmlsdGVyLCBObyBzdWNoIGVkaXRvciBmb3VuZDogXCIsIGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGVkaXRvciA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlcjtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5lZGl0ICYmIGNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3IgPSBjb2x1bW4ubW9kdWxlcy5lZGl0LmVkaXRvcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciAmJiBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl0pIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yID0gc2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuZWRpdG9yc1tjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJdO1xuXG5cdFx0XHRcdFx0XHRcdGlmICgoY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyID09PSBcInRpY2tcIiB8fCBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPT09IFwidGlja0Nyb3NzXCIpICYmICFjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJFbXB0eUNoZWNrKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlICE9PSB0cnVlICYmIHZhbHVlICE9PSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3IgPSBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW1wiaW5wdXRcIl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZWRpdG9yKSB7XG5cblx0XHRcdFx0Y2VsbFdyYXBwZXIgPSB7XG5cdFx0XHRcdFx0Z2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHR5cGVvZiBpbml0aWFsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBpbml0aWFsVmFsdWUgOiBcIlwiO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0RmllbGQ6IGZ1bmN0aW9uIGdldEZpZWxkKCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uLmZpZWxkO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0RWxlbWVudDogZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHtcblx0XHRcdFx0XHRcdHJldHVybiBmaWx0ZXJFbGVtZW50O1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Q29sdW1uOiBmdW5jdGlvbiBnZXRDb2x1bW4oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Um93OiBmdW5jdGlvbiBnZXRSb3coKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHRub3JtYWxpemVIZWlnaHQ6IGZ1bmN0aW9uIG5vcm1hbGl6ZUhlaWdodCgpIHt9XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0XHRwYXJhbXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJQYXJhbXMgfHwge307XG5cblx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIHBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gcGFyYW1zLmNhbGwoc2VsZi50YWJsZSkgOiBwYXJhbXM7XG5cblx0XHRcdFx0ZWRpdG9yRWxlbWVudCA9IGVkaXRvci5jYWxsKHRoaXMudGFibGUubW9kdWxlcy5lZGl0LCBjZWxsV3JhcHBlciwgZnVuY3Rpb24gKCkge30sIHN1Y2Nlc3MsIGNhbmNlbCwgcGFyYW1zKTtcblxuXHRcdFx0XHRpZiAoIWVkaXRvckVsZW1lbnQpIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBDYW5ub3QgYWRkIGZpbHRlciB0byBcIiArIGZpZWxkICsgXCIgY29sdW1uLCBlZGl0b3IgcmV0dXJuZWQgYSB2YWx1ZSBvZiBmYWxzZVwiKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIShlZGl0b3JFbGVtZW50IGluc3RhbmNlb2YgTm9kZSkpIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBDYW5ub3QgYWRkIGZpbHRlciB0byBcIiArIGZpZWxkICsgXCIgY29sdW1uLCBlZGl0b3Igc2hvdWxkIHJldHVybiBhbiBpbnN0YW5jZSBvZiBOb2RlLCB0aGUgZWRpdG9yIHJldHVybmVkOlwiLCBlZGl0b3JFbGVtZW50KTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL3NldCBQbGFjZWhvbGRlciBUZXh0XG5cdFx0XHRcdGlmIChmaWVsZCkge1xuXHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwiaGVhZGVyRmlsdGVyc3xjb2x1bW5zfFwiICsgY29sdW1uLmRlZmluaXRpb24uZmllbGQsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCB0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsdWUgPyB2YWx1ZSA6IHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5nZXRUZXh0KFwiaGVhZGVyRmlsdGVyc3xkZWZhdWx0XCIpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImhlYWRlckZpbHRlcnN8ZGVmYXVsdFwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuc2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIiwgdHlwZW9mIHNlbGYuY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgc2VsZi5jb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlciA/IHNlbGYuY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyUGxhY2Vob2xkZXIgOiB2YWx1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2ZvY3VzIG9uIGVsZW1lbnQgb24gY2xpY2tcblx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuZm9jdXMoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHR2YXIgbGVmdCA9IF90aGlzNDkudGFibGUuY29sdW1uTWFuYWdlci5lbGVtZW50LnNjcm9sbExlZnQ7XG5cblx0XHRcdFx0XHRpZiAobGVmdCAhPT0gX3RoaXM0OS50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdCkge1xuXHRcdFx0XHRcdFx0X3RoaXM0OS50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHRcdFx0XHRfdGhpczQ5LnRhYmxlLmNvbHVtbk1hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vbGl2ZSB1cGRhdGUgZmlsdGVycyBhcyB1c2VyIHR5cGVzXG5cdFx0XHRcdHR5cGluZ1RpbWVyID0gZmFsc2U7XG5cblx0XHRcdFx0c2VhcmNoVHJpZ2dlciA9IGZ1bmN0aW9uIHNlYXJjaFRyaWdnZXIoZSkge1xuXHRcdFx0XHRcdGlmICh0eXBpbmdUaW1lcikge1xuXHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KHR5cGluZ1RpbWVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0eXBpbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0c3VjY2VzcyhlZGl0b3JFbGVtZW50LnZhbHVlKTtcblx0XHRcdFx0XHR9LCBzZWxmLnRhYmxlLm9wdGlvbnMuaGVhZGVyRmlsdGVyTGl2ZUZpbHRlckRlbGF5KTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCA9IGVkaXRvckVsZW1lbnQ7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5hdHRyVHlwZSA9IGVkaXRvckVsZW1lbnQuaGFzQXR0cmlidXRlKFwidHlwZVwiKSA/IGVkaXRvckVsZW1lbnQuZ2V0QXR0cmlidXRlKFwidHlwZVwiKS50b0xvd2VyQ2FzZSgpIDogXCJcIjtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnRhZ1R5cGUgPSBlZGl0b3JFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyTGl2ZUZpbHRlciAhPT0gZmFsc2UpIHtcblxuXHRcdFx0XHRcdGlmICghKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gJ2F1dG9jb21wbGV0ZScgfHwgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyID09PSAndGlja0Nyb3NzJyB8fCAoY29sdW1uLmRlZmluaXRpb24uZWRpdG9yID09PSAnYXV0b2NvbXBsZXRlJyB8fCBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IgPT09ICd0aWNrQ3Jvc3MnKSAmJiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXIgPT09IHRydWUpKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBzZWFyY2hUcmlnZ2VyKTtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNlYXJjaFwiLCBzZWFyY2hUcmlnZ2VyKTtcblxuXHRcdFx0XHRcdFx0Ly91cGRhdGUgbnVtYmVyIGZpbHRlcmVkIGNvbHVtbnMgb24gY2hhbmdlXG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID09IFwibnVtYmVyXCIpIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3VjY2VzcyhlZGl0b3JFbGVtZW50LnZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vY2hhbmdlIHRleHQgaW5wdXRzIHRvIHNlYXJjaCBpbnB1dHMgdG8gYWxsb3cgZm9yIGNsZWFyaW5nIG9mIGZpZWxkXG5cdFx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID09IFwidGV4dFwiICYmIHRoaXMudGFibGUuYnJvd3NlciAhPT0gXCJpZVwiKSB7XG5cdFx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInNlYXJjaFwiKTtcblx0XHRcdFx0XHRcdFx0Ly8gZWRpdG9yRWxlbWVudC5vZmYoXCJjaGFuZ2UgYmx1clwiKTsgLy9wcmV2ZW50IGJsdXIgZnJvbSB0cmlnZ2VyaW5nIGZpbHRlciBhbmQgcHJldmVudGluZyBzZWxlY3Rpb24gY2xpY2tcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvL3ByZXZlbnQgaW5wdXQgYW5kIHNlbGVjdCBlbGVtZW50cyBmcm9tIHByb3BlZ2F0aW5nIGNsaWNrIHRvIGNvbHVtbiBzb3J0ZXJzIGV0Y1xuXHRcdFx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcImlucHV0XCIgfHwgY29sdW1uLm1vZHVsZXMuZmlsdGVyLnRhZ1R5cGUgPT0gXCJzZWxlY3RcIiB8fCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcInRleHRhcmVhXCIpIHtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZmlsdGVyRWxlbWVudC5hcHBlbmRDaGlsZChlZGl0b3JFbGVtZW50KTtcblxuXHRcdFx0XHRjb2x1bW4uY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZmlsdGVyRWxlbWVudCk7XG5cblx0XHRcdFx0aWYgKCFyZWluaXRpYWxpemUpIHtcblx0XHRcdFx0XHRzZWxmLmhlYWRlckZpbHRlckNvbHVtbnMucHVzaChjb2x1bW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIENhbm5vdCBhZGQgaGVhZGVyIGZpbHRlciwgY29sdW1uIGhhcyBubyBmaWVsZCBzZXQ6XCIsIGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlKTtcblx0XHR9XG5cdH07XG5cblx0Ly9oaWRlIGFsbCBoZWFkZXIgZmlsdGVyIGVsZW1lbnRzICh1c2VkIHRvIGVuc3VyZSBjb3JyZWN0IGNvbHVtbiB3aWR0aHMgaW4gXCJmaXREYXRhXCIgbGF5b3V0IG1vZGUpXG5cdEZpbHRlci5wcm90b3R5cGUuaGlkZUhlYWRlckZpbHRlckVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL3Nob3cgYWxsIGhlYWRlciBmaWx0ZXIgZWxlbWVudHMgKHVzZWQgdG8gZW5zdXJlIGNvcnJlY3QgY29sdW1uIHdpZHRocyBpbiBcImZpdERhdGFcIiBsYXlvdXQgbW9kZSlcblx0RmlsdGVyLnByb3RvdHlwZS5zaG93SGVhZGVyRmlsdGVyRWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZpbHRlciAmJiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudCkge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9wcm9ncmFtYXRpY2FsbHkgc2V0IGZvY3VzIG9mIGhlYWRlciBmaWx0ZXJcblx0RmlsdGVyLnByb3RvdHlwZS5zZXRIZWFkZXJGaWx0ZXJGb2N1cyA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyICYmIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50KSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5mb2N1cygpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEZvY3VzIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcHJvZ3JhbW1hdGljYWxseSBnZXQgdmFsdWUgb2YgaGVhZGVyIGZpbHRlclxuXHRGaWx0ZXIucHJvdG90eXBlLmdldEhlYWRlckZpbHRlclZhbHVlID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpIHtcblx0XHRcdHJldHVybiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC52YWx1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIGhlYWRlciBmaWx0ZXIgc2V0IG9uIGNvbHVtbjpcIiwgY29sdW1uLmdldEZpZWxkKCkpO1xuXHRcdH1cblx0fTtcblxuXHQvL3Byb2dyYW1hdGljYWxseSBzZXQgdmFsdWUgb2YgaGVhZGVyIGZpbHRlclxuXHRGaWx0ZXIucHJvdG90eXBlLnNldEhlYWRlckZpbHRlclZhbHVlID0gZnVuY3Rpb24gKGNvbHVtbiwgdmFsdWUpIHtcblx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZmlsdGVyICYmIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50KSB7XG5cdFx0XHRcdHRoaXMuZ2VuZXJhdGVIZWFkZXJGaWx0ZXJFbGVtZW50KGNvbHVtbiwgdmFsdWUsIHRydWUpO1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuc3VjY2Vzcyh2YWx1ZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEZpbHRlci5wcm90b3R5cGUucmVsb2FkSGVhZGVyRmlsdGVyID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpIHtcblx0XHRcdFx0dGhpcy5nZW5lcmF0ZUhlYWRlckZpbHRlckVsZW1lbnQoY29sdW1uLCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudmFsdWUsIHRydWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIGhlYWRlciBmaWx0ZXIgc2V0IG9uIGNvbHVtbjpcIiwgY29sdW1uLmdldEZpZWxkKCkpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL2NoZWNrIGlmIHRoZSBmaWx0ZXJzIGhhcyBjaGFuZ2VkIHNpbmNlIGxhc3QgdXNlXG5cdEZpbHRlci5wcm90b3R5cGUuaGFzQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuY2hhbmdlZDtcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTtcblx0XHRyZXR1cm4gY2hhbmdlZDtcblx0fTtcblxuXHQvL3NldCBzdGFuZGFyZCBmaWx0ZXJzXG5cdEZpbHRlci5wcm90b3R5cGUuc2V0RmlsdGVyID0gZnVuY3Rpb24gKGZpZWxkLCB0eXBlLCB2YWx1ZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuZmlsdGVyTGlzdCA9IFtdO1xuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGZpZWxkKSkge1xuXHRcdFx0ZmllbGQgPSBbeyBmaWVsZDogZmllbGQsIHR5cGU6IHR5cGUsIHZhbHVlOiB2YWx1ZSB9XTtcblx0XHR9XG5cblx0XHRzZWxmLmFkZEZpbHRlcihmaWVsZCk7XG5cdH07XG5cblx0Ly9hZGQgZmlsdGVyIHRvIGFycmF5XG5cdEZpbHRlci5wcm90b3R5cGUuYWRkRmlsdGVyID0gZnVuY3Rpb24gKGZpZWxkLCB0eXBlLCB2YWx1ZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmICghQXJyYXkuaXNBcnJheShmaWVsZCkpIHtcblx0XHRcdGZpZWxkID0gW3sgZmllbGQ6IGZpZWxkLCB0eXBlOiB0eXBlLCB2YWx1ZTogdmFsdWUgfV07XG5cdFx0fVxuXG5cdFx0ZmllbGQuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7XG5cblx0XHRcdGZpbHRlciA9IHNlbGYuZmluZEZpbHRlcihmaWx0ZXIpO1xuXG5cdFx0XHRpZiAoZmlsdGVyKSB7XG5cdFx0XHRcdHNlbGYuZmlsdGVyTGlzdC5wdXNoKGZpbHRlcik7XG5cblx0XHRcdFx0c2VsZi5jaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiB0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmZpbHRlcikge1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJmaWx0ZXJcIik7XG5cdFx0fVxuXHR9O1xuXG5cdEZpbHRlci5wcm90b3R5cGUuZmluZEZpbHRlciA9IGZ1bmN0aW9uIChmaWx0ZXIpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbHVtbjtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHtcblx0XHRcdHJldHVybiB0aGlzLmZpbmRTdWJGaWx0ZXJzKGZpbHRlcik7XG5cdFx0fVxuXG5cdFx0dmFyIGZpbHRlckZ1bmMgPSBmYWxzZTtcblxuXHRcdGlmICh0eXBlb2YgZmlsdGVyLmZpZWxkID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRyZXR1cm4gZmlsdGVyLmZpZWxkKGRhdGEsIGZpbHRlci50eXBlIHx8IHt9KTsgLy8gcGFzcyBwYXJhbXMgdG8gY3VzdG9tIGZpbHRlciBmdW5jdGlvblxuXHRcdFx0fTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoc2VsZi5maWx0ZXJzW2ZpbHRlci50eXBlXSkge1xuXG5cdFx0XHRcdGNvbHVtbiA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGZpbHRlci5maWVsZCk7XG5cblx0XHRcdFx0aWYgKGNvbHVtbikge1xuXHRcdFx0XHRcdGZpbHRlckZ1bmMgPSBmdW5jdGlvbiBmaWx0ZXJGdW5jKGRhdGEpIHtcblx0XHRcdFx0XHRcdHJldHVybiBzZWxmLmZpbHRlcnNbZmlsdGVyLnR5cGVdKGZpbHRlci52YWx1ZSwgY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSkpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uIGZpbHRlckZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYuZmlsdGVyc1tmaWx0ZXIudHlwZV0oZmlsdGVyLnZhbHVlLCBkYXRhW2ZpbHRlci5maWVsZF0pO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIE5vIHN1Y2ggZmlsdGVyIHR5cGUgZm91bmQsIGlnbm9yaW5nOiBcIiwgZmlsdGVyLnR5cGUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZpbHRlci5mdW5jID0gZmlsdGVyRnVuYztcblxuXHRcdHJldHVybiBmaWx0ZXIuZnVuYyA/IGZpbHRlciA6IGZhbHNlO1xuXHR9O1xuXG5cdEZpbHRlci5wcm90b3R5cGUuZmluZFN1YkZpbHRlcnMgPSBmdW5jdGlvbiAoZmlsdGVycykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHRmaWx0ZXJzLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikge1xuXHRcdFx0ZmlsdGVyID0gc2VsZi5maW5kRmlsdGVyKGZpbHRlcik7XG5cblx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0b3V0cHV0LnB1c2goZmlsdGVyKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQubGVuZ3RoID8gb3V0cHV0IDogZmFsc2U7XG5cdH07XG5cblx0Ly9nZXQgYWxsIGZpbHRlcnNcblx0RmlsdGVyLnByb3RvdHlwZS5nZXRGaWx0ZXJzID0gZnVuY3Rpb24gKGFsbCwgYWpheCkge1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGlmIChhbGwpIHtcblx0XHRcdG91dHB1dCA9IHRoaXMuZ2V0SGVhZGVyRmlsdGVycygpO1xuXHRcdH1cblxuXHRcdGlmIChhamF4KSB7XG5cdFx0XHRvdXRwdXQuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRpZiAodHlwZW9mIGl0ZW0udHlwZSA9PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRpdGVtLnR5cGUgPSBcImZ1bmN0aW9uXCI7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQodGhpcy5maWx0ZXJzVG9BcnJheSh0aGlzLmZpbHRlckxpc3QsIGFqYXgpKTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Ly9maWx0ZXIgdG8gT2JqZWN0XG5cdEZpbHRlci5wcm90b3R5cGUuZmlsdGVyc1RvQXJyYXkgPSBmdW5jdGlvbiAoZmlsdGVyTGlzdCwgYWpheCkge1xuXHRcdHZhciBfdGhpczUwID0gdGhpcztcblxuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGZpbHRlckxpc3QuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7XG5cdFx0XHR2YXIgaXRlbTtcblxuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkge1xuXHRcdFx0XHRvdXRwdXQucHVzaChfdGhpczUwLmZpbHRlcnNUb0FycmF5KGZpbHRlciwgYWpheCkpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aXRlbSA9IHsgZmllbGQ6IGZpbHRlci5maWVsZCwgdHlwZTogZmlsdGVyLnR5cGUsIHZhbHVlOiBmaWx0ZXIudmFsdWUgfTtcblxuXHRcdFx0XHRpZiAoYWpheCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgaXRlbS50eXBlID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0aXRlbS50eXBlID0gXCJmdW5jdGlvblwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGl0ZW0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvL2dldCBhbGwgZmlsdGVyc1xuXHRGaWx0ZXIucHJvdG90eXBlLmdldEhlYWRlckZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdGZvciAodmFyIGtleSBpbiB0aGlzLmhlYWRlckZpbHRlcnMpIHtcblx0XHRcdG91dHB1dC5wdXNoKHsgZmllbGQ6IGtleSwgdHlwZTogdGhpcy5oZWFkZXJGaWx0ZXJzW2tleV0udHlwZSwgdmFsdWU6IHRoaXMuaGVhZGVyRmlsdGVyc1trZXldLnZhbHVlIH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0Ly9yZW1vdmUgZmlsdGVyIGZyb20gYXJyYXlcblx0RmlsdGVyLnByb3RvdHlwZS5yZW1vdmVGaWx0ZXIgPSBmdW5jdGlvbiAoZmllbGQsIHR5cGUsIHZhbHVlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGZpZWxkKSkge1xuXHRcdFx0ZmllbGQgPSBbeyBmaWVsZDogZmllbGQsIHR5cGU6IHR5cGUsIHZhbHVlOiB2YWx1ZSB9XTtcblx0XHR9XG5cblx0XHRmaWVsZC5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHtcblx0XHRcdHZhciBpbmRleCA9IC0xO1xuXG5cdFx0XHRpZiAoX3R5cGVvZihmaWx0ZXIuZmllbGQpID09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0aW5kZXggPSBzZWxmLmZpbHRlckxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbHRlciA9PT0gZWxlbWVudDtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpbmRleCA9IHNlbGYuZmlsdGVyTGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKGVsZW1lbnQpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsdGVyLmZpZWxkID09PSBlbGVtZW50LmZpZWxkICYmIGZpbHRlci50eXBlID09PSBlbGVtZW50LnR5cGUgJiYgZmlsdGVyLnZhbHVlID09PSBlbGVtZW50LnZhbHVlO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0c2VsZi5maWx0ZXJMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHRcdHNlbGYuY2hhbmdlZCA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBObyBtYXRjaGluZyBmaWx0ZXIgdHlwZSBmb3VuZCwgaWdub3Jpbmc6IFwiLCBmaWx0ZXIudHlwZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicGVyc2lzdGVuY2VcIiwgdHJ1ZSkgJiYgdGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLmNvbmZpZy5maWx0ZXIpIHtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwiZmlsdGVyXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIGZpbHRlcnNcblx0RmlsdGVyLnByb3RvdHlwZS5jbGVhckZpbHRlciA9IGZ1bmN0aW9uIChhbGwpIHtcblx0XHR0aGlzLmZpbHRlckxpc3QgPSBbXTtcblxuXHRcdGlmIChhbGwpIHtcblx0XHRcdHRoaXMuY2xlYXJIZWFkZXJGaWx0ZXIoKTtcblx0XHR9XG5cblx0XHR0aGlzLmNoYW5nZWQgPSB0cnVlO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuZmlsdGVyKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcImZpbHRlclwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly9jbGVhciBoZWFkZXIgZmlsdGVyc1xuXHRGaWx0ZXIucHJvdG90eXBlLmNsZWFySGVhZGVyRmlsdGVyID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHRoaXMuaGVhZGVyRmlsdGVycyA9IHt9O1xuXHRcdHNlbGYucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrID0gXCJ7fVwiO1xuXG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnZhbHVlID0gbnVsbDtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5wcmV2U3VjY2VzcyA9IHVuZGVmaW5lZDtcblx0XHRcdHNlbGYucmVsb2FkSGVhZGVyRmlsdGVyKGNvbHVtbik7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmNoYW5nZWQgPSB0cnVlO1xuXHR9O1xuXG5cdC8vc2VhcmNoIGRhdGEgYW5kIHJldHVybiBtYXRjaGluZyByb3dzXG5cdEZpbHRlci5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaFR5cGUsIGZpZWxkLCB0eXBlLCB2YWx1ZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgYWN0aXZlUm93cyA9IFtdLFxuXHRcdCAgICBmaWx0ZXJMaXN0ID0gW107XG5cblx0XHRpZiAoIUFycmF5LmlzQXJyYXkoZmllbGQpKSB7XG5cdFx0XHRmaWVsZCA9IFt7IGZpZWxkOiBmaWVsZCwgdHlwZTogdHlwZSwgdmFsdWU6IHZhbHVlIH1dO1xuXHRcdH1cblxuXHRcdGZpZWxkLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikge1xuXHRcdFx0ZmlsdGVyID0gc2VsZi5maW5kRmlsdGVyKGZpbHRlcik7XG5cblx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0ZmlsdGVyTGlzdC5wdXNoKGZpbHRlcik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdHZhciBtYXRjaCA9IHRydWU7XG5cblx0XHRcdGZpbHRlckxpc3QuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7XG5cdFx0XHRcdGlmICghc2VsZi5maWx0ZXJSZWN1cnNlKGZpbHRlciwgcm93LmdldERhdGEoKSkpIHtcblx0XHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdGFjdGl2ZVJvd3MucHVzaChzZWFyY2hUeXBlID09PSBcImRhdGFcIiA/IHJvdy5nZXREYXRhKFwiZGF0YVwiKSA6IHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gYWN0aXZlUm93cztcblx0fTtcblxuXHQvL2ZpbHRlciByb3cgYXJyYXlcblx0RmlsdGVyLnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbiAocm93TGlzdCwgZmlsdGVycykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgYWN0aXZlUm93cyA9IFtdLFxuXHRcdCAgICBhY3RpdmVSb3dDb21wb25lbnRzID0gW107XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFGaWx0ZXJpbmcpIHtcblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5kYXRhRmlsdGVyaW5nLmNhbGwoc2VsZi50YWJsZSwgc2VsZi5nZXRGaWx0ZXJzKCkpO1xuXHRcdH1cblxuXHRcdGlmICghc2VsZi50YWJsZS5vcHRpb25zLmFqYXhGaWx0ZXJpbmcgJiYgKHNlbGYuZmlsdGVyTGlzdC5sZW5ndGggfHwgT2JqZWN0LmtleXMoc2VsZi5oZWFkZXJGaWx0ZXJzKS5sZW5ndGgpKSB7XG5cblx0XHRcdHJvd0xpc3QuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdGlmIChzZWxmLmZpbHRlclJvdyhyb3cpKSB7XG5cdFx0XHRcdFx0YWN0aXZlUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRhY3RpdmVSb3dzID0gcm93TGlzdC5zbGljZSgwKTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFGaWx0ZXJlZCkge1xuXG5cdFx0XHRhY3RpdmVSb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRhY3RpdmVSb3dDb21wb25lbnRzLnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YUZpbHRlcmVkLmNhbGwoc2VsZi50YWJsZSwgc2VsZi5nZXRGaWx0ZXJzKCksIGFjdGl2ZVJvd0NvbXBvbmVudHMpO1xuXHRcdH1cblxuXHRcdHJldHVybiBhY3RpdmVSb3dzO1xuXHR9O1xuXG5cdC8vZmlsdGVyIGluZGl2aWR1YWwgcm93XG5cdEZpbHRlci5wcm90b3R5cGUuZmlsdGVyUm93ID0gZnVuY3Rpb24gKHJvdywgZmlsdGVycykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSB0cnVlLFxuXHRcdCAgICBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdHNlbGYuZmlsdGVyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHtcblx0XHRcdGlmICghc2VsZi5maWx0ZXJSZWN1cnNlKGZpbHRlciwgZGF0YSkpIHtcblx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGZvciAodmFyIGZpZWxkIGluIHNlbGYuaGVhZGVyRmlsdGVycykge1xuXHRcdFx0aWYgKCFzZWxmLmhlYWRlckZpbHRlcnNbZmllbGRdLmZ1bmMoZGF0YSkpIHtcblx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbWF0Y2g7XG5cdH07XG5cblx0RmlsdGVyLnByb3RvdHlwZS5maWx0ZXJSZWN1cnNlID0gZnVuY3Rpb24gKGZpbHRlciwgZGF0YSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSBmYWxzZTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHtcblx0XHRcdGZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uIChzdWJGaWx0ZXIpIHtcblx0XHRcdFx0aWYgKHNlbGYuZmlsdGVyUmVjdXJzZShzdWJGaWx0ZXIsIGRhdGEpKSB7XG5cdFx0XHRcdFx0bWF0Y2ggPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bWF0Y2ggPSBmaWx0ZXIuZnVuYyhkYXRhKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbWF0Y2g7XG5cdH07XG5cblx0Ly9saXN0IG9mIGF2YWlsYWJsZSBmaWx0ZXJzXG5cdEZpbHRlci5wcm90b3R5cGUuZmlsdGVycyA9IHtcblxuXHRcdC8vZXF1YWwgdG9cblx0XHRcIj1cIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsID09IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0Ly9sZXNzIHRoYW5cblx0XHRcIjxcIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsIDwgZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvL2xlc3MgdGhhbiBvciBlcXVhbCB0b1xuXHRcdFwiPD1cIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsIDw9IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0Ly9ncmVhdGVyIHRoYW5cblx0XHRcIj5cIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsID4gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvL2dyZWF0ZXIgdGhhbiBvciBlcXVhbCB0b1xuXHRcdFwiPj1cIjogZnVuY3Rpb24gXyhmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gcm93VmFsID49IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0Ly9ub3QgZXF1YWwgdG9cblx0XHRcIiE9XCI6IGZ1bmN0aW9uIF8oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXHRcdFx0cmV0dXJuIHJvd1ZhbCAhPSBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdFx0fSxcblxuXHRcdFwicmVnZXhcIjogZnVuY3Rpb24gcmVnZXgoZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcykge1xuXG5cdFx0XHRpZiAodHlwZW9mIGZpbHRlclZhbCA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdGZpbHRlclZhbCA9IG5ldyBSZWdFeHAoZmlsdGVyVmFsKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZpbHRlclZhbC50ZXN0KHJvd1ZhbCk7XG5cdFx0fSxcblxuXHRcdC8vY29udGFpbnMgdGhlIHN0cmluZ1xuXHRcdFwibGlrZVwiOiBmdW5jdGlvbiBsaWtlKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdGlmIChmaWx0ZXJWYWwgPT09IG51bGwgfHwgdHlwZW9mIGZpbHRlclZhbCA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gcm93VmFsID09PSBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodHlwZW9mIHJvd1ZhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgcm93VmFsICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFN0cmluZyhyb3dWYWwpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXJWYWwudG9Mb3dlckNhc2UoKSkgPiAtMTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Ly9pbiBhcnJheVxuXHRcdFwiaW5cIjogZnVuY3Rpb24gX2luKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpIHtcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KGZpbHRlclZhbCkpIHtcblx0XHRcdFx0cmV0dXJuIGZpbHRlclZhbC5pbmRleE9mKHJvd1ZhbCkgPiAtMTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIGZpbHRlciB2YWx1ZSBpcyBub3QgYW4gYXJyYXk6XCIsIGZpbHRlclZhbCk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImZpbHRlclwiLCBGaWx0ZXIpO1xuXG5cdHZhciBGb3JtYXQgPSBmdW5jdGlvbiBGb3JtYXQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBmb3JtYXR0ZXJcblx0Rm9ybWF0LnByb3RvdHlwZS5pbml0aWFsaXplQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdGNvbHVtbi5tb2R1bGVzLmZvcm1hdCA9IHRoaXMubG9va3VwRm9ybWF0dGVyKGNvbHVtbiwgXCJcIik7XG5cblx0XHRpZiAodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlclByaW50ICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mb3JtYXQucHJpbnQgPSB0aGlzLmxvb2t1cEZvcm1hdHRlcihjb2x1bW4sIFwiUHJpbnRcIik7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJDbGlwYm9hcmQgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZvcm1hdC5jbGlwYm9hcmQgPSB0aGlzLmxvb2t1cEZvcm1hdHRlcihjb2x1bW4sIFwiQ2xpcGJvYXJkXCIpO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVySHRtbE91dHB1dCAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZm9ybWF0Lmh0bWxPdXRwdXQgPSB0aGlzLmxvb2t1cEZvcm1hdHRlcihjb2x1bW4sIFwiSHRtbE91dHB1dFwiKTtcblx0XHR9XG5cdH07XG5cblx0Rm9ybWF0LnByb3RvdHlwZS5sb29rdXBGb3JtYXR0ZXIgPSBmdW5jdGlvbiAoY29sdW1uLCB0eXBlKSB7XG5cdFx0dmFyIGNvbmZpZyA9IHsgcGFyYW1zOiBjb2x1bW4uZGVmaW5pdGlvbltcImZvcm1hdHRlclwiICsgdHlwZSArIFwiUGFyYW1zXCJdIHx8IHt9IH0sXG5cdFx0ICAgIGZvcm1hdHRlciA9IGNvbHVtbi5kZWZpbml0aW9uW1wiZm9ybWF0dGVyXCIgKyB0eXBlXTtcblxuXHRcdC8vc2V0IGNvbHVtbiBmb3JtYXR0ZXJcblx0XHRzd2l0Y2ggKHR5cGVvZiBmb3JtYXR0ZXIgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGZvcm1hdHRlcikpIHtcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblxuXHRcdFx0XHRpZiAoZm9ybWF0dGVyID09PSBcInRpY2tcIikge1xuXHRcdFx0XHRcdGZvcm1hdHRlciA9IFwidGlja0Nyb3NzXCI7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbmZpZy5wYXJhbXMuY3Jvc3NFbGVtZW50ID09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdGNvbmZpZy5wYXJhbXMuY3Jvc3NFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiREVQUkVDQVRJT04gV0FSTklORyAtIHRoZSB0aWNrIGZvcm1hdHRlciBoYXMgYmVlbiBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIHRoZSB0aWNrQ3Jvc3MgZm9ybWF0dGVyIHdpdGggdGhlIGNyb3NzRWxlbWVudCBwYXJhbSBzZXQgdG8gZmFsc2VcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGhpcy5mb3JtYXR0ZXJzW2Zvcm1hdHRlcl0pIHtcblx0XHRcdFx0XHRjb25maWcuZm9ybWF0dGVyID0gdGhpcy5mb3JtYXR0ZXJzW2Zvcm1hdHRlcl07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRm9ybWF0dGVyIEVycm9yIC0gTm8gc3VjaCBmb3JtYXR0ZXIgZm91bmQ6IFwiLCBmb3JtYXR0ZXIpO1xuXHRcdFx0XHRcdGNvbmZpZy5mb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdHRlcnMucGxhaW50ZXh0O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0Y29uZmlnLmZvcm1hdHRlciA9IGZvcm1hdHRlcjtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGNvbmZpZy5mb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdHRlcnMucGxhaW50ZXh0O1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gY29uZmlnO1xuXHR9O1xuXG5cdEZvcm1hdC5wcm90b3R5cGUuY2VsbFJlbmRlcmVkID0gZnVuY3Rpb24gKGNlbGwpIHtcblx0XHRpZiAoY2VsbC5tb2R1bGVzLmZvcm1hdCAmJiBjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkQ2FsbGJhY2spIHtcblx0XHRcdGNlbGwubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjaygpO1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiBhIGZvcm1hdHRlZCB2YWx1ZSBmb3IgYSBjZWxsXG5cdEZvcm1hdC5wcm90b3R5cGUuZm9ybWF0VmFsdWUgPSBmdW5jdGlvbiAoY2VsbCkge1xuXHRcdHZhciBjb21wb25lbnQgPSBjZWxsLmdldENvbXBvbmVudCgpLFxuXHRcdCAgICBwYXJhbXMgPSB0eXBlb2YgY2VsbC5jb2x1bW4ubW9kdWxlcy5mb3JtYXQucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdC5wYXJhbXMoY29tcG9uZW50KSA6IGNlbGwuY29sdW1uLm1vZHVsZXMuZm9ybWF0LnBhcmFtcztcblxuXHRcdGZ1bmN0aW9uIG9uUmVuZGVyZWQoY2FsbGJhY2spIHtcblx0XHRcdGlmICghY2VsbC5tb2R1bGVzLmZvcm1hdCkge1xuXHRcdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0ID0ge307XG5cdFx0XHR9XG5cblx0XHRcdGNlbGwubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjayA9IGNhbGxiYWNrO1xuXHRcdH1cblxuXHRcdHJldHVybiBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdC5mb3JtYXR0ZXIuY2FsbCh0aGlzLCBjb21wb25lbnQsIHBhcmFtcywgb25SZW5kZXJlZCk7XG5cdH07XG5cblx0Rm9ybWF0LnByb3RvdHlwZS5mb3JtYXRFeHBvcnRWYWx1ZSA9IGZ1bmN0aW9uIChjZWxsLCB0eXBlKSB7XG5cdFx0dmFyIGZvcm1hdHRlciA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZm9ybWF0W3R5cGVdLFxuXHRcdCAgICBwYXJhbXM7XG5cblx0XHRpZiAoZm9ybWF0dGVyKSB7XG5cdFx0XHR2YXIgb25SZW5kZXJlZCA9IGZ1bmN0aW9uIG9uUmVuZGVyZWQoY2FsbGJhY2spIHtcblx0XHRcdFx0aWYgKCFjZWxsLm1vZHVsZXMuZm9ybWF0KSB7XG5cdFx0XHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdCA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrID0gY2FsbGJhY2s7XG5cdFx0XHR9O1xuXG5cdFx0XHRwYXJhbXMgPSB0eXBlb2YgZm9ybWF0dGVyLnBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gZm9ybWF0dGVyLnBhcmFtcyhjb21wb25lbnQpIDogZm9ybWF0dGVyLnBhcmFtcztcblxuXHRcdFx0cmV0dXJuIGZvcm1hdHRlci5mb3JtYXR0ZXIuY2FsbCh0aGlzLCBjZWxsLmdldENvbXBvbmVudCgpLCBwYXJhbXMsIG9uUmVuZGVyZWQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5mb3JtYXRWYWx1ZShjZWxsKTtcblx0XHR9XG5cdH07XG5cblx0Rm9ybWF0LnByb3RvdHlwZS5zYW5pdGl6ZUhUTUwgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRpZiAodmFsdWUpIHtcblx0XHRcdHZhciBlbnRpdHlNYXAgPSB7XG5cdFx0XHRcdCcmJzogJyZhbXA7Jyxcblx0XHRcdFx0JzwnOiAnJmx0OycsXG5cdFx0XHRcdCc+JzogJyZndDsnLFxuXHRcdFx0XHQnXCInOiAnJnF1b3Q7Jyxcblx0XHRcdFx0XCInXCI6ICcmIzM5OycsXG5cdFx0XHRcdCcvJzogJyYjeDJGOycsXG5cdFx0XHRcdCdgJzogJyYjeDYwOycsXG5cdFx0XHRcdCc9JzogJyYjeDNEOydcblx0XHRcdH07XG5cblx0XHRcdHJldHVybiBTdHJpbmcodmFsdWUpLnJlcGxhY2UoL1smPD5cIidgPVxcL10vZywgZnVuY3Rpb24gKHMpIHtcblx0XHRcdFx0cmV0dXJuIGVudGl0eU1hcFtzXTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXHR9O1xuXG5cdEZvcm1hdC5wcm90b3R5cGUuZW1wdHlUb1NwYWNlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IFwiJm5ic3A7XCIgOiB2YWx1ZTtcblx0fTtcblxuXHQvL2dldCBmb3JtYXR0ZXIgZm9yIGNlbGxcblx0Rm9ybWF0LnByb3RvdHlwZS5nZXRGb3JtYXR0ZXIgPSBmdW5jdGlvbiAoZm9ybWF0dGVyKSB7XG5cdFx0dmFyIGZvcm1hdHRlcjtcblxuXHRcdHN3aXRjaCAodHlwZW9mIGZvcm1hdHRlciA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZm9ybWF0dGVyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZiAodGhpcy5mb3JtYXR0ZXJzW2Zvcm1hdHRlcl0pIHtcblx0XHRcdFx0XHRmb3JtYXR0ZXIgPSB0aGlzLmZvcm1hdHRlcnNbZm9ybWF0dGVyXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGb3JtYXR0ZXIgRXJyb3IgLSBObyBzdWNoIGZvcm1hdHRlciBmb3VuZDogXCIsIGZvcm1hdHRlcik7XG5cdFx0XHRcdFx0Zm9ybWF0dGVyID0gdGhpcy5mb3JtYXR0ZXJzLnBsYWludGV4dDtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdGZvcm1hdHRlciA9IGZvcm1hdHRlcjtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGZvcm1hdHRlciA9IHRoaXMuZm9ybWF0dGVycy5wbGFpbnRleHQ7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiBmb3JtYXR0ZXI7XG5cdH07XG5cblx0Ly9kZWZhdWx0IGRhdGEgZm9ybWF0dGVyc1xuXHRGb3JtYXQucHJvdG90eXBlLmZvcm1hdHRlcnMgPSB7XG5cdFx0Ly9wbGFpbiB0ZXh0IHZhbHVlXG5cdFx0cGxhaW50ZXh0OiBmdW5jdGlvbiBwbGFpbnRleHQoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lbXB0eVRvU3BhY2UodGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSk7XG5cdFx0fSxcblxuXHRcdC8vaHRtbCB0ZXh0IHZhbHVlXG5cdFx0aHRtbDogZnVuY3Rpb24gaHRtbChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiBjZWxsLmdldFZhbHVlKCk7XG5cdFx0fSxcblxuXHRcdC8vbXVsdGlsaW5lIHRleHQgYXJlYVxuXHRcdHRleHRhcmVhOiBmdW5jdGlvbiB0ZXh0YXJlYShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLnN0eWxlLndoaXRlU3BhY2UgPSBcInByZS13cmFwXCI7XG5cdFx0XHRyZXR1cm4gdGhpcy5lbXB0eVRvU3BhY2UodGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSk7XG5cdFx0fSxcblxuXHRcdC8vY3VycmVuY3kgZm9ybWF0dGluZ1xuXHRcdG1vbmV5OiBmdW5jdGlvbiBtb25leShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciBmbG9hdFZhbCA9IHBhcnNlRmxvYXQoY2VsbC5nZXRWYWx1ZSgpKSxcblx0XHRcdCAgICBudW1iZXIsXG5cdFx0XHQgICAgaW50ZWdlcixcblx0XHRcdCAgICBkZWNpbWFsLFxuXHRcdFx0ICAgIHJneDtcblxuXHRcdFx0dmFyIGRlY2ltYWxTeW0gPSBmb3JtYXR0ZXJQYXJhbXMuZGVjaW1hbCB8fCBcIi5cIjtcblx0XHRcdHZhciB0aG91c2FuZFN5bSA9IGZvcm1hdHRlclBhcmFtcy50aG91c2FuZCB8fCBcIixcIjtcblx0XHRcdHZhciBzeW1ib2wgPSBmb3JtYXR0ZXJQYXJhbXMuc3ltYm9sIHx8IFwiXCI7XG5cdFx0XHR2YXIgYWZ0ZXIgPSAhIWZvcm1hdHRlclBhcmFtcy5zeW1ib2xBZnRlcjtcblx0XHRcdHZhciBwcmVjaXNpb24gPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnByZWNpc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5wcmVjaXNpb24gOiAyO1xuXG5cdFx0XHRpZiAoaXNOYU4oZmxvYXRWYWwpKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmVtcHR5VG9TcGFjZSh0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0bnVtYmVyID0gcHJlY2lzaW9uICE9PSBmYWxzZSA/IGZsb2F0VmFsLnRvRml4ZWQocHJlY2lzaW9uKSA6IGZsb2F0VmFsO1xuXHRcdFx0bnVtYmVyID0gU3RyaW5nKG51bWJlcikuc3BsaXQoXCIuXCIpO1xuXG5cdFx0XHRpbnRlZ2VyID0gbnVtYmVyWzBdO1xuXHRcdFx0ZGVjaW1hbCA9IG51bWJlci5sZW5ndGggPiAxID8gZGVjaW1hbFN5bSArIG51bWJlclsxXSA6IFwiXCI7XG5cblx0XHRcdHJneCA9IC8oXFxkKykoXFxkezN9KS87XG5cblx0XHRcdHdoaWxlIChyZ3gudGVzdChpbnRlZ2VyKSkge1xuXHRcdFx0XHRpbnRlZ2VyID0gaW50ZWdlci5yZXBsYWNlKHJneCwgXCIkMVwiICsgdGhvdXNhbmRTeW0gKyBcIiQyXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYWZ0ZXIgPyBpbnRlZ2VyICsgZGVjaW1hbCArIHN5bWJvbCA6IHN5bWJvbCArIGludGVnZXIgKyBkZWNpbWFsO1xuXHRcdH0sXG5cblx0XHQvL2NsaWNrYWJsZSBhbmNob3IgdGFnXG5cdFx0bGluazogZnVuY3Rpb24gbGluayhjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICB1cmxQcmVmaXggPSBmb3JtYXR0ZXJQYXJhbXMudXJsUHJlZml4IHx8IFwiXCIsXG5cdFx0XHQgICAgZG93bmxvYWQgPSBmb3JtYXR0ZXJQYXJhbXMuZG93bmxvYWQsXG5cdFx0XHQgICAgbGFiZWwgPSB2YWx1ZSxcblx0XHRcdCAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLFxuXHRcdFx0ICAgIGRhdGE7XG5cblx0XHRcdGlmIChmb3JtYXR0ZXJQYXJhbXMubGFiZWxGaWVsZCkge1xuXHRcdFx0XHRkYXRhID0gY2VsbC5nZXREYXRhKCk7XG5cdFx0XHRcdGxhYmVsID0gZGF0YVtmb3JtYXR0ZXJQYXJhbXMubGFiZWxGaWVsZF07XG5cdFx0XHR9XG5cblx0XHRcdGlmIChmb3JtYXR0ZXJQYXJhbXMubGFiZWwpIHtcblx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5sYWJlbCkpIHtcblx0XHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0XHRsYWJlbCA9IGZvcm1hdHRlclBhcmFtcy5sYWJlbDtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0XHRsYWJlbCA9IGZvcm1hdHRlclBhcmFtcy5sYWJlbChjZWxsKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChsYWJlbCkge1xuXHRcdFx0XHRpZiAoZm9ybWF0dGVyUGFyYW1zLnVybEZpZWxkKSB7XG5cdFx0XHRcdFx0ZGF0YSA9IGNlbGwuZ2V0RGF0YSgpO1xuXHRcdFx0XHRcdHZhbHVlID0gZGF0YVtmb3JtYXR0ZXJQYXJhbXMudXJsRmllbGRdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGZvcm1hdHRlclBhcmFtcy51cmwpIHtcblx0XHRcdFx0XHRzd2l0Y2ggKF90eXBlb2YoZm9ybWF0dGVyUGFyYW1zLnVybCkpIHtcblx0XHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBmb3JtYXR0ZXJQYXJhbXMudXJsO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gZm9ybWF0dGVyUGFyYW1zLnVybChjZWxsKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCB1cmxQcmVmaXggKyB2YWx1ZSk7XG5cblx0XHRcdFx0aWYgKGZvcm1hdHRlclBhcmFtcy50YXJnZXQpIHtcblx0XHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJ0YXJnZXRcIiwgZm9ybWF0dGVyUGFyYW1zLnRhcmdldCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZm9ybWF0dGVyUGFyYW1zLmRvd25sb2FkKSB7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGRvd25sb2FkID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0ZG93bmxvYWQgPSBkb3dubG9hZChjZWxsKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZG93bmxvYWQgPSBkb3dubG9hZCA9PT0gdHJ1ZSA/IFwiXCIgOiBkb3dubG9hZDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBkb3dubG9hZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlbC5pbm5lckhUTUwgPSB0aGlzLmVtcHR5VG9TcGFjZSh0aGlzLnNhbml0aXplSFRNTChsYWJlbCkpO1xuXG5cdFx0XHRcdHJldHVybiBlbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiBcIiZuYnNwO1wiO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL2ltYWdlIGVsZW1lbnRcblx0XHRpbWFnZTogZnVuY3Rpb24gaW1hZ2UoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuXHRcdFx0ZWwuc2V0QXR0cmlidXRlKFwic3JjXCIsIGNlbGwuZ2V0VmFsdWUoKSk7XG5cblx0XHRcdHN3aXRjaCAoX3R5cGVvZihmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0KSkge1xuXHRcdFx0XHRjYXNlIFwibnVtYmVyXCI6XG5cdFx0XHRcdFx0ZWwuc3R5bGUuaGVpZ2h0ID0gZm9ybWF0dGVyUGFyYW1zLmhlaWdodCArIFwicHhcIjtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0ZWwuc3R5bGUuaGVpZ2h0ID0gZm9ybWF0dGVyUGFyYW1zLmhlaWdodDtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy53aWR0aCkpIHtcblx0XHRcdFx0Y2FzZSBcIm51bWJlclwiOlxuXHRcdFx0XHRcdGVsLnN0eWxlLndpZHRoID0gZm9ybWF0dGVyUGFyYW1zLndpZHRoICsgXCJweFwiO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRlbC5zdHlsZS53aWR0aCA9IGZvcm1hdHRlclBhcmFtcy53aWR0aDtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRjZWxsLmdldFJvdygpLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBlbDtcblx0XHR9LFxuXG5cdFx0Ly90aWNrIG9yIGNyb3NzXG5cdFx0dGlja0Nyb3NzOiBmdW5jdGlvbiB0aWNrQ3Jvc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdFx0XHQgICAgZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdFx0ICAgIGVtcHR5ID0gZm9ybWF0dGVyUGFyYW1zLmFsbG93RW1wdHksXG5cdFx0XHQgICAgdHJ1dGh5ID0gZm9ybWF0dGVyUGFyYW1zLmFsbG93VHJ1dGh5LFxuXHRcdFx0ICAgIHRpY2sgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnRpY2tFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnRpY2tFbGVtZW50IDogJzxzdmcgZW5hYmxlLWJhY2tncm91bmQ9XCJuZXcgMCAwIDI0IDI0XCIgaGVpZ2h0PVwiMTRcIiB3aWR0aD1cIjE0XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCIgPjxwYXRoIGZpbGw9XCIjMkRDMjE0XCIgY2xpcC1ydWxlPVwiZXZlbm9kZFwiIGQ9XCJNMjEuNjUyLDMuMjExYy0wLjI5My0wLjI5NS0wLjc3LTAuMjk1LTEuMDYxLDBMOS40MSwxNC4zNCAgYy0wLjI5MywwLjI5Ny0wLjc3MSwwLjI5Ny0xLjA2MiwwTDMuNDQ5LDkuMzUxQzMuMzA0LDkuMjAzLDMuMTE0LDkuMTMsMi45MjMsOS4xMjlDMi43Myw5LjEyOCwyLjUzNCw5LjIwMSwyLjM4Nyw5LjM1MSAgbC0yLjE2NSwxLjk0NkMwLjA3OCwxMS40NDUsMCwxMS42MywwLDExLjgyM2MwLDAuMTk0LDAuMDc4LDAuMzk3LDAuMjIzLDAuNTQ0bDQuOTQsNS4xODRjMC4yOTIsMC4yOTYsMC43NzEsMC43NzYsMS4wNjIsMS4wNyAgbDIuMTI0LDIuMTQxYzAuMjkyLDAuMjkzLDAuNzY5LDAuMjkzLDEuMDYyLDBsMTQuMzY2LTE0LjM0YzAuMjkzLTAuMjk0LDAuMjkzLTAuNzc3LDAtMS4wNzFMMjEuNjUyLDMuMjExelwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIi8+PC9zdmc+Jyxcblx0XHRcdCAgICBjcm9zcyA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuY3Jvc3NFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLmNyb3NzRWxlbWVudCA6ICc8c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPVwibmV3IDAgMCAyNCAyNFwiIGhlaWdodD1cIjE0XCIgd2lkdGg9XCIxNFwiICB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiA+PHBhdGggZmlsbD1cIiNDRTE1MTVcIiBkPVwiTTIyLjI0NSw0LjAxNWMwLjMxMywwLjMxMywwLjMxMywwLjgyNiwwLDEuMTM5bC02LjI3Niw2LjI3Yy0wLjMxMywwLjMxMi0wLjMxMywwLjgyNiwwLDEuMTRsNi4yNzMsNi4yNzIgIGMwLjMxMywwLjMxMywwLjMxMywwLjgyNiwwLDEuMTRsLTIuMjg1LDIuMjc3Yy0wLjMxNCwwLjMxMi0wLjgyOCwwLjMxMi0xLjE0MiwwbC02LjI3MS02LjI3MWMtMC4zMTMtMC4zMTMtMC44MjgtMC4zMTMtMS4xNDEsMCAgbC02LjI3Niw2LjI2N2MtMC4zMTMsMC4zMTMtMC44MjgsMC4zMTMtMS4xNDEsMGwtMi4yODItMi4yOGMtMC4zMTMtMC4zMTMtMC4zMTMtMC44MjYsMC0xLjE0bDYuMjc4LTYuMjY5ICBjMC4zMTMtMC4zMTIsMC4zMTMtMC44MjYsMC0xLjE0TDEuNzA5LDUuMTQ3Yy0wLjMxNC0wLjMxMy0wLjMxNC0wLjgyNywwLTEuMTRsMi4yODQtMi4yNzhDNC4zMDgsMS40MTcsNC44MjEsMS40MTcsNS4xMzUsMS43MyAgTDExLjQwNSw4YzAuMzE0LDAuMzE0LDAuODI4LDAuMzE0LDEuMTQxLDAuMDAxbDYuMjc2LTYuMjY3YzAuMzEyLTAuMzEyLDAuODI2LTAuMzEyLDEuMTQxLDBMMjIuMjQ1LDQuMDE1elwiLz48L3N2Zz4nO1xuXG5cdFx0XHRpZiAodHJ1dGh5ICYmIHZhbHVlIHx8IHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBcInRydWVcIiB8fCB2YWx1ZSA9PT0gXCJUcnVlXCIgfHwgdmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IFwiMVwiKSB7XG5cdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1jaGVja2VkXCIsIHRydWUpO1xuXHRcdFx0XHRyZXR1cm4gdGljayB8fCBcIlwiO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGVtcHR5ICYmICh2YWx1ZSA9PT0gXCJudWxsXCIgfHwgdmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSkge1xuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1jaGVja2VkXCIsIFwibWl4ZWRcIik7XG5cdFx0XHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWNoZWNrZWRcIiwgZmFsc2UpO1xuXHRcdFx0XHRcdHJldHVybiBjcm9zcyB8fCBcIlwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGRhdGV0aW1lOiBmdW5jdGlvbiBkYXRldGltZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciBpbnB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5pbnB1dEZvcm1hdCB8fCBcIllZWVktTU0tREQgaGg6bW06c3NcIjtcblx0XHRcdHZhciBvdXRwdXRGb3JtYXQgPSBmb3JtYXR0ZXJQYXJhbXMub3V0cHV0Rm9ybWF0IHx8IFwiREQvTU0vWVlZWSBoaDptbTpzc1wiO1xuXHRcdFx0dmFyIGludmFsaWQgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmludmFsaWRQbGFjZWhvbGRlciAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5pbnZhbGlkUGxhY2Vob2xkZXIgOiBcIlwiO1xuXHRcdFx0dmFyIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpO1xuXG5cdFx0XHR2YXIgbmV3RGF0ZXRpbWUgPSBtb21lbnQodmFsdWUsIGlucHV0Rm9ybWF0KTtcblxuXHRcdFx0aWYgKG5ld0RhdGV0aW1lLmlzVmFsaWQoKSkge1xuXHRcdFx0XHRyZXR1cm4gbmV3RGF0ZXRpbWUuZm9ybWF0KG91dHB1dEZvcm1hdCk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChpbnZhbGlkID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBpbnZhbGlkID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gaW52YWxpZCh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGludmFsaWQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0ZGF0ZXRpbWVkaWZmOiBmdW5jdGlvbiBkYXRldGltZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciBpbnB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5pbnB1dEZvcm1hdCB8fCBcIllZWVktTU0tREQgaGg6bW06c3NcIjtcblx0XHRcdHZhciBpbnZhbGlkID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy5pbnZhbGlkUGxhY2Vob2xkZXIgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuaW52YWxpZFBsYWNlaG9sZGVyIDogXCJcIjtcblx0XHRcdHZhciBzdWZmaXggPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnN1ZmZpeCAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5zdWZmaXggOiBmYWxzZTtcblx0XHRcdHZhciB1bml0ID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy51bml0ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnVuaXQgOiB1bmRlZmluZWQ7XG5cdFx0XHR2YXIgaHVtYW5pemUgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmh1bWFuaXplICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLmh1bWFuaXplIDogZmFsc2U7XG5cdFx0XHR2YXIgZGF0ZSA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuZGF0ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5kYXRlIDogbW9tZW50KCk7XG5cdFx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCk7XG5cblx0XHRcdHZhciBuZXdEYXRldGltZSA9IG1vbWVudCh2YWx1ZSwgaW5wdXRGb3JtYXQpO1xuXG5cdFx0XHRpZiAobmV3RGF0ZXRpbWUuaXNWYWxpZCgpKSB7XG5cdFx0XHRcdGlmIChodW1hbml6ZSkge1xuXHRcdFx0XHRcdHJldHVybiBtb21lbnQuZHVyYXRpb24obmV3RGF0ZXRpbWUuZGlmZihkYXRlKSkuaHVtYW5pemUoc3VmZml4KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3RGF0ZXRpbWUuZGlmZihkYXRlLCB1bml0KSArIChzdWZmaXggPyBcIiBcIiArIHN1ZmZpeCA6IFwiXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmIChpbnZhbGlkID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBpbnZhbGlkID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gaW52YWxpZCh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGludmFsaWQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Ly9zZWxlY3Rcblx0XHRsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXNbdmFsdWVdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTWlzc2luZyBkaXNwbGF5IHZhbHVlIGZvciAnICsgdmFsdWUpO1xuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmb3JtYXR0ZXJQYXJhbXNbdmFsdWVdO1xuXHRcdH0sXG5cblx0XHQvL3N0YXIgcmF0aW5nXG5cdFx0c3RhcjogZnVuY3Rpb24gc3RhcihjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0XHRcdCAgICBlbGVtZW50ID0gY2VsbC5nZXRFbGVtZW50KCksXG5cdFx0XHQgICAgbWF4U3RhcnMgPSBmb3JtYXR0ZXJQYXJhbXMgJiYgZm9ybWF0dGVyUGFyYW1zLnN0YXJzID8gZm9ybWF0dGVyUGFyYW1zLnN0YXJzIDogNSxcblx0XHRcdCAgICBzdGFycyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHRcdFx0ICAgIHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgXCJzdmdcIiksXG5cdFx0XHQgICAgc3RhckFjdGl2ZSA9ICc8cG9seWdvbiBmaWxsPVwiI0ZGRUEwMFwiIHN0cm9rZT1cIiNDMUFCNjBcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nLFxuXHRcdFx0ICAgIHN0YXJJbmFjdGl2ZSA9ICc8cG9seWdvbiBmaWxsPVwiI0QyRDJEMlwiIHN0cm9rZT1cIiM2ODY4NjhcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXG5cdFx0XHQvL3N0eWxlIHN0YXJzIGhvbGRlclxuXHRcdFx0c3RhcnMuc3R5bGUudmVydGljYWxBbGlnbiA9IFwibWlkZGxlXCI7XG5cblx0XHRcdC8vc3R5bGUgc3RhclxuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBcIjE0XCIpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgXCIxNFwiKTtcblx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCA1MTIgNTEyXCIpO1xuXHRcdFx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ4bWw6c3BhY2VcIiwgXCJwcmVzZXJ2ZVwiKTtcblx0XHRcdHN0YXIuc3R5bGUucGFkZGluZyA9IFwiMCAxcHhcIjtcblxuXHRcdFx0dmFsdWUgPSB2YWx1ZSAmJiAhaXNOYU4odmFsdWUpID8gcGFyc2VJbnQodmFsdWUpIDogMDtcblxuXHRcdFx0dmFsdWUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih2YWx1ZSwgbWF4U3RhcnMpKTtcblxuXHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPD0gbWF4U3RhcnM7IGkrKykge1xuXHRcdFx0XHR2YXIgbmV4dFN0YXIgPSBzdGFyLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0bmV4dFN0YXIuaW5uZXJIVE1MID0gaSA8PSB2YWx1ZSA/IHN0YXJBY3RpdmUgOiBzdGFySW5hY3RpdmU7XG5cblx0XHRcdFx0c3RhcnMuYXBwZW5kQ2hpbGQobmV4dFN0YXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRlbGVtZW50LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnRleHRPdmVyZmxvdyA9IFwiZWxsaXBzaXNcIjtcblxuXHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblxuXHRcdFx0cmV0dXJuIHN0YXJzO1xuXHRcdH0sXG5cblx0XHR0cmFmZmljOiBmdW5jdGlvbiB0cmFmZmljKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSB8fCAwLFxuXHRcdFx0ICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdFx0XHQgICAgbWF4ID0gZm9ybWF0dGVyUGFyYW1zICYmIGZvcm1hdHRlclBhcmFtcy5tYXggPyBmb3JtYXR0ZXJQYXJhbXMubWF4IDogMTAwLFxuXHRcdFx0ICAgIG1pbiA9IGZvcm1hdHRlclBhcmFtcyAmJiBmb3JtYXR0ZXJQYXJhbXMubWluID8gZm9ybWF0dGVyUGFyYW1zLm1pbiA6IDAsXG5cdFx0XHQgICAgY29sb3JzID0gZm9ybWF0dGVyUGFyYW1zICYmIHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgOiBbXCJyZWRcIiwgXCJvcmFuZ2VcIiwgXCJncmVlblwiXSxcblx0XHRcdCAgICBjb2xvciA9IFwiIzY2NjY2NlwiLFxuXHRcdFx0ICAgIHBlcmNlbnQsXG5cdFx0XHQgICAgcGVyY2VudFZhbHVlO1xuXG5cdFx0XHRpZiAoaXNOYU4odmFsdWUpIHx8IHR5cGVvZiBjZWxsLmdldFZhbHVlKCkgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRyYWZmaWMtbGlnaHRcIik7XG5cblx0XHRcdC8vbWFrZSBzdXJlIHZhbHVlIGlzIGluIHJhbmdlXG5cdFx0XHRwZXJjZW50VmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKSA8PSBtYXggPyBwYXJzZUZsb2F0KHZhbHVlKSA6IG1heDtcblx0XHRcdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQocGVyY2VudFZhbHVlKSA+PSBtaW4gPyBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgOiBtaW47XG5cblx0XHRcdC8vd29ya291dCBwZXJjZW50YWdlXG5cdFx0XHRwZXJjZW50ID0gKG1heCAtIG1pbikgLyAxMDA7XG5cdFx0XHRwZXJjZW50VmFsdWUgPSBNYXRoLnJvdW5kKChwZXJjZW50VmFsdWUgLSBtaW4pIC8gcGVyY2VudCk7XG5cblx0XHRcdC8vc2V0IGNvbG9yXG5cdFx0XHRzd2l0Y2ggKHR5cGVvZiBjb2xvcnMgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbG9ycykpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGNvbG9yID0gY29sb3JzO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb2xvciA9IGNvbG9ycyh2YWx1ZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShjb2xvcnMpKSB7XG5cdFx0XHRcdFx0XHR2YXIgdW5pdCA9IDEwMCAvIGNvbG9ycy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR2YXIgaW5kZXggPSBNYXRoLmZsb29yKHBlcmNlbnRWYWx1ZSAvIHVuaXQpO1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBjb2xvcnMubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTtcblx0XHRcdFx0XHRcdGNvbG9yID0gY29sb3JzW2luZGV4XTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG5cblx0XHRcdHJldHVybiBlbDtcblx0XHR9LFxuXG5cdFx0Ly9wcm9ncmVzcyBiYXJcblx0XHRwcm9ncmVzczogZnVuY3Rpb24gcHJvZ3Jlc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHQvL3Byb2dyZXNzIGJhclxuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSB8fCAwLFxuXHRcdFx0ICAgIGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0XHRcdCAgICBtYXggPSBmb3JtYXR0ZXJQYXJhbXMgJiYgZm9ybWF0dGVyUGFyYW1zLm1heCA/IGZvcm1hdHRlclBhcmFtcy5tYXggOiAxMDAsXG5cdFx0XHQgICAgbWluID0gZm9ybWF0dGVyUGFyYW1zICYmIGZvcm1hdHRlclBhcmFtcy5taW4gPyBmb3JtYXR0ZXJQYXJhbXMubWluIDogMCxcblx0XHRcdCAgICBsZWdlbmRBbGlnbiA9IGZvcm1hdHRlclBhcmFtcyAmJiBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gPyBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gOiBcImNlbnRlclwiLFxuXHRcdFx0ICAgIHBlcmNlbnQsXG5cdFx0XHQgICAgcGVyY2VudFZhbHVlLFxuXHRcdFx0ICAgIGNvbG9yLFxuXHRcdFx0ICAgIGxlZ2VuZCxcblx0XHRcdCAgICBsZWdlbmRDb2xvcixcblx0XHRcdCAgICB0b3AsXG5cdFx0XHQgICAgbGVmdCxcblx0XHRcdCAgICByaWdodCxcblx0XHRcdCAgICBib3R0b207XG5cblx0XHRcdC8vbWFrZSBzdXJlIHZhbHVlIGlzIGluIHJhbmdlXG5cdFx0XHRwZXJjZW50VmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKSA8PSBtYXggPyBwYXJzZUZsb2F0KHZhbHVlKSA6IG1heDtcblx0XHRcdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQocGVyY2VudFZhbHVlKSA+PSBtaW4gPyBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgOiBtaW47XG5cblx0XHRcdC8vd29ya291dCBwZXJjZW50YWdlXG5cdFx0XHRwZXJjZW50ID0gKG1heCAtIG1pbikgLyAxMDA7XG5cdFx0XHRwZXJjZW50VmFsdWUgPSBNYXRoLnJvdW5kKChwZXJjZW50VmFsdWUgLSBtaW4pIC8gcGVyY2VudCk7XG5cblx0XHRcdC8vc2V0IGJhciBjb2xvclxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5jb2xvcikpIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGNvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmNvbG9yO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb2xvciA9IGZvcm1hdHRlclBhcmFtcy5jb2xvcih2YWx1ZSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShmb3JtYXR0ZXJQYXJhbXMuY29sb3IpKSB7XG5cdFx0XHRcdFx0XHR2YXIgdW5pdCA9IDEwMCAvIGZvcm1hdHRlclBhcmFtcy5jb2xvci5sZW5ndGg7XG5cdFx0XHRcdFx0XHR2YXIgaW5kZXggPSBNYXRoLmZsb29yKHBlcmNlbnRWYWx1ZSAvIHVuaXQpO1xuXG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBmb3JtYXR0ZXJQYXJhbXMuY29sb3IubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0XHRpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTtcblx0XHRcdFx0XHRcdGNvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmNvbG9yW2luZGV4XTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRjb2xvciA9IFwiIzJEQzIxNFwiO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2dlbmVyYXRlIGxlZ2VuZFxuXHRcdFx0c3dpdGNoIChfdHlwZW9mKGZvcm1hdHRlclBhcmFtcy5sZWdlbmQpKSB7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kKHZhbHVlKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRsZWdlbmQgPSB2YWx1ZTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRsZWdlbmQgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgbGVnZW5kIGNvbG9yXG5cdFx0XHRzd2l0Y2ggKF90eXBlb2YoZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKSkge1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0bGVnZW5kQ29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3I7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdGxlZ2VuZENvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKHZhbHVlKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvcikpIHtcblx0XHRcdFx0XHRcdHZhciB1bml0ID0gMTAwIC8gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yLmxlbmd0aDtcblx0XHRcdFx0XHRcdHZhciBpbmRleCA9IE1hdGguZmxvb3IocGVyY2VudFZhbHVlIC8gdW5pdCk7XG5cblx0XHRcdFx0XHRcdGluZGV4ID0gTWF0aC5taW4oaW5kZXgsIGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvci5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdGluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIDApO1xuXHRcdFx0XHRcdFx0bGVnZW5kQ29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3JbaW5kZXhdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRsZWdlbmRDb2xvciA9IFwiIzAwMFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCIzMHB4XCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXG5cdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcGVyY2VudFZhbHVlKTtcblxuXHRcdFx0dmFyIGJhckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdGJhckVsLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRcdFx0YmFyRWwuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG5cdFx0XHRiYXJFbC5zdHlsZS53aWR0aCA9IHBlcmNlbnRWYWx1ZSArIFwiJVwiO1xuXHRcdFx0YmFyRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG5cdFx0XHRiYXJFbC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblxuXHRcdFx0YmFyRWwuc2V0QXR0cmlidXRlKCdkYXRhLW1heCcsIG1heCk7XG5cdFx0XHRiYXJFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTtcblxuXHRcdFx0aWYgKGxlZ2VuZCkge1xuXHRcdFx0XHR2YXIgbGVnZW5kRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRcdFx0bGVnZW5kRWwuc3R5bGUudG9wID0gXCI0cHhcIjtcblx0XHRcdFx0bGVnZW5kRWwuc3R5bGUubGVmdCA9IDA7XG5cdFx0XHRcdGxlZ2VuZEVsLnN0eWxlLnRleHRBbGlnbiA9IGxlZ2VuZEFsaWduO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRcdFx0XHRsZWdlbmRFbC5zdHlsZS5jb2xvciA9IGxlZ2VuZENvbG9yO1xuXHRcdFx0XHRsZWdlbmRFbC5pbm5lckhUTUwgPSBsZWdlbmQ7XG5cdFx0XHR9XG5cblx0XHRcdG9uUmVuZGVyZWQoZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdC8vaGFuZGxlIGN1c3RvbSBlbGVtZW50IG5lZWRlZCBpZiBmb3JtYXR0ZXIgaXMgdG8gYmUgaW5jbHVkZWQgaW4gcHJpbnRlZC9kb3dubG9hZGVkIG91dHB1dFxuXHRcdFx0XHRpZiAoIShjZWxsIGluc3RhbmNlb2YgQ2VsbENvbXBvbmVudCkpIHtcblx0XHRcdFx0XHR2YXIgaG9sZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdGhvbGRlckVsLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0XHRcdGhvbGRlckVsLnN0eWxlLnRvcCA9IFwiNHB4XCI7XG5cdFx0XHRcdFx0aG9sZGVyRWwuc3R5bGUuYm90dG9tID0gXCI0cHhcIjtcblx0XHRcdFx0XHRob2xkZXJFbC5zdHlsZS5sZWZ0ID0gXCI0cHhcIjtcblx0XHRcdFx0XHRob2xkZXJFbC5zdHlsZS5yaWdodCA9IFwiNHB4XCI7XG5cblx0XHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlckVsKTtcblxuXHRcdFx0XHRcdGVsZW1lbnQgPSBob2xkZXJFbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQoYmFyRWwpO1xuXG5cdFx0XHRcdGlmIChsZWdlbmQpIHtcblx0XHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGxlZ2VuZEVsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH0sXG5cblx0XHQvL2JhY2tncm91bmQgY29sb3Jcblx0XHRjb2xvcjogZnVuY3Rpb24gY29sb3IoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpO1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fSxcblxuXHRcdC8vdGljayBpY29uXG5cdFx0YnV0dG9uVGljazogZnVuY3Rpb24gYnV0dG9uVGljayhjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiAnPHN2ZyBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjQgMjRcIiBoZWlnaHQ9XCIxNFwiIHdpZHRoPVwiMTRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiA+PHBhdGggZmlsbD1cIiMyREMyMTRcIiBjbGlwLXJ1bGU9XCJldmVub2RkXCIgZD1cIk0yMS42NTIsMy4yMTFjLTAuMjkzLTAuMjk1LTAuNzctMC4yOTUtMS4wNjEsMEw5LjQxLDE0LjM0ICBjLTAuMjkzLDAuMjk3LTAuNzcxLDAuMjk3LTEuMDYyLDBMMy40NDksOS4zNTFDMy4zMDQsOS4yMDMsMy4xMTQsOS4xMywyLjkyMyw5LjEyOUMyLjczLDkuMTI4LDIuNTM0LDkuMjAxLDIuMzg3LDkuMzUxICBsLTIuMTY1LDEuOTQ2QzAuMDc4LDExLjQ0NSwwLDExLjYzLDAsMTEuODIzYzAsMC4xOTQsMC4wNzgsMC4zOTcsMC4yMjMsMC41NDRsNC45NCw1LjE4NGMwLjI5MiwwLjI5NiwwLjc3MSwwLjc3NiwxLjA2MiwxLjA3ICBsMi4xMjQsMi4xNDFjMC4yOTIsMC4yOTMsMC43NjksMC4yOTMsMS4wNjIsMGwxNC4zNjYtMTQuMzRjMC4yOTMtMC4yOTQsMC4yOTMtMC43NzcsMC0xLjA3MUwyMS42NTIsMy4yMTF6XCIgZmlsbC1ydWxlPVwiZXZlbm9kZFwiLz48L3N2Zz4nO1xuXHRcdH0sXG5cblx0XHQvL2Nyb3NzIGljb25cblx0XHRidXR0b25Dcm9zczogZnVuY3Rpb24gYnV0dG9uQ3Jvc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdFx0XHRyZXR1cm4gJzxzdmcgZW5hYmxlLWJhY2tncm91bmQ9XCJuZXcgMCAwIDI0IDI0XCIgaGVpZ2h0PVwiMTRcIiB3aWR0aD1cIjE0XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCIgPjxwYXRoIGZpbGw9XCIjQ0UxNTE1XCIgZD1cIk0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXpcIi8+PC9zdmc+Jztcblx0XHR9LFxuXG5cdFx0Ly9jdXJyZW50IHJvdyBudW1iZXJcblx0XHRyb3dudW06IGZ1bmN0aW9uIHJvd251bShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cy5pbmRleE9mKGNlbGwuZ2V0Um93KCkuX2dldFNlbGYoKSkgKyAxO1xuXHRcdH0sXG5cblx0XHQvL3JvdyBoYW5kbGVcblx0XHRoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhhbmRsZVwiKTtcblx0XHRcdHJldHVybiBcIjxkaXYgY2xhc3M9J3RhYnVsYXRvci1yb3ctaGFuZGxlLWJveCc+PGRpdiBjbGFzcz0ndGFidWxhdG9yLXJvdy1oYW5kbGUtYmFyJz48L2Rpdj48ZGl2IGNsYXNzPSd0YWJ1bGF0b3Itcm93LWhhbmRsZS1iYXInPjwvZGl2PjxkaXYgY2xhc3M9J3RhYnVsYXRvci1yb3ctaGFuZGxlLWJhcic+PC9kaXY+PC9kaXY+XCI7XG5cdFx0fSxcblxuXHRcdHJlc3BvbnNpdmVDb2xsYXBzZTogZnVuY3Rpb24gcmVzcG9uc2l2ZUNvbGxhcHNlKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0ICAgIG9wZW4gPSBmYWxzZSxcblx0XHRcdCAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0XHQgICAgY29uZmlnID0gY2VsbC5nZXRSb3coKS5fcm93Lm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dDtcblxuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZVwiKTtcblx0XHRcdGVsLmlubmVySFRNTCA9IFwiPHNwYW4gY2xhc3M9J3RhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZS1vcGVuJz4rPC9zcGFuPjxzcGFuIGNsYXNzPSd0YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGUtY2xvc2UnPi08L3NwYW4+XCI7XG5cblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhhbmRsZVwiKTtcblxuXHRcdFx0ZnVuY3Rpb24gdG9nZ2xlTGlzdChpc09wZW4pIHtcblx0XHRcdFx0dmFyIGNvbGxhcHNlRWwgPSBjb25maWcuZWxlbWVudDtcblxuXHRcdFx0XHRjb25maWcub3BlbiA9IGlzT3BlbjtcblxuXHRcdFx0XHRpZiAoY29sbGFwc2VFbCkge1xuXG5cdFx0XHRcdFx0aWYgKGNvbmZpZy5vcGVuKSB7XG5cdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwib3BlblwiKTtcblx0XHRcdFx0XHRcdGNvbGxhcHNlRWwuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlbC5jbGFzc0xpc3QucmVtb3ZlKFwib3BlblwiKTtcblx0XHRcdFx0XHRcdGNvbGxhcHNlRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdHRvZ2dsZUxpc3QoIWNvbmZpZy5vcGVuKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0b2dnbGVMaXN0KGNvbmZpZy5vcGVuKTtcblxuXHRcdFx0cmV0dXJuIGVsO1xuXHRcdH0sXG5cblx0XHRyb3dTZWxlY3Rpb246IGZ1bmN0aW9uIHJvd1NlbGVjdGlvbihjZWxsKSB7XG5cdFx0XHR2YXIgX3RoaXM1MSA9IHRoaXM7XG5cblx0XHRcdHZhciBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRcdFx0Y2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiLCB0cnVlKSkge1xuXG5cdFx0XHRcdGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgY2VsbC5nZXRSb3cgPT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHZhciByb3cgPSBjZWxsLmdldFJvdygpO1xuXG5cdFx0XHRcdFx0Y2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0cm93LnRvZ2dsZVNlbGVjdCgpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Y2hlY2tib3guY2hlY2tlZCA9IHJvdy5pc1NlbGVjdGVkKCk7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJvdy5yZWdpc3RlclJvd1NlbGVjdENoZWNrYm94KHJvdywgY2hlY2tib3gpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdGlmIChfdGhpczUxLnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LnNlbGVjdGVkUm93cy5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM1MS50YWJsZS5kZXNlbGVjdFJvdygpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM1MS50YWJsZS5zZWxlY3RSb3coKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cucmVnaXN0ZXJIZWFkZXJTZWxlY3RDaGVja2JveChjaGVja2JveCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBjaGVja2JveDtcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImZvcm1hdFwiLCBGb3JtYXQpO1xuXG5cdHZhciBGcm96ZW5Db2x1bW5zID0gZnVuY3Rpb24gRnJvemVuQ29sdW1ucyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmxlZnRDb2x1bW5zID0gW107XG5cdFx0dGhpcy5yaWdodENvbHVtbnMgPSBbXTtcblx0XHR0aGlzLmxlZnRNYXJnaW4gPSAwO1xuXHRcdHRoaXMucmlnaHRNYXJnaW4gPSAwO1xuXHRcdHRoaXMucmlnaHRQYWRkaW5nID0gMDtcblx0XHR0aGlzLmluaXRpYWxpemF0aW9uTW9kZSA9IFwibGVmdFwiO1xuXHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cdFx0dGhpcy5zY3JvbGxFbmRUaW1lciA9IGZhbHNlO1xuXHR9O1xuXG5cdC8vcmVzZXQgaW5pdGlhbCBzdGF0ZVxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmluaXRpYWxpemF0aW9uTW9kZSA9IFwibGVmdFwiO1xuXHRcdHRoaXMubGVmdENvbHVtbnMgPSBbXTtcblx0XHR0aGlzLnJpZ2h0Q29sdW1ucyA9IFtdO1xuXHRcdHRoaXMubGVmdE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5yaWdodE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5yaWdodE1hcmdpbiA9IDA7XG5cdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gMDtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudC5zdHlsZS5wYWRkaW5nUmlnaHQgPSAwO1xuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBzcGVjaWZpYyBjb2x1bW5cblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgY29uZmlnID0geyBtYXJnaW46IDAsIGVkZ2U6IGZhbHNlIH07XG5cblx0XHRpZiAoIWNvbHVtbi5pc0dyb3VwKSB7XG5cblx0XHRcdGlmICh0aGlzLmZyb3plbkNoZWNrKGNvbHVtbikpIHtcblxuXHRcdFx0XHRjb25maWcucG9zaXRpb24gPSB0aGlzLmluaXRpYWxpemF0aW9uTW9kZTtcblxuXHRcdFx0XHRpZiAodGhpcy5pbml0aWFsaXphdGlvbk1vZGUgPT0gXCJsZWZ0XCIpIHtcblx0XHRcdFx0XHR0aGlzLmxlZnRDb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnJpZ2h0Q29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmFjdGl2ZSA9IHRydWU7XG5cblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuID0gY29uZmlnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXphdGlvbk1vZGUgPSBcInJpZ2h0XCI7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmZyb3plbkNoZWNrID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBmcm96ZW4gPSBmYWxzZTtcblxuXHRcdGlmIChjb2x1bW4ucGFyZW50LmlzR3JvdXAgJiYgY29sdW1uLmRlZmluaXRpb24uZnJvemVuKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJGcm96ZW4gQ29sdW1uIEVycm9yIC0gUGFyZW50IGNvbHVtbiBncm91cCBtdXN0IGJlIGZyb3plbiwgbm90IGluZGl2aWR1YWwgY29sdW1ucyBvciBzdWIgY29sdW1uIGdyb3Vwc1wiKTtcblx0XHR9XG5cblx0XHRpZiAoY29sdW1uLnBhcmVudC5pc0dyb3VwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5mcm96ZW5DaGVjayhjb2x1bW4ucGFyZW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uLmZyb3plbjtcblx0XHR9XG5cblx0XHRyZXR1cm4gZnJvemVuO1xuXHR9O1xuXG5cdC8vcXVpY2sgbGF5b3V0IHRvIHNtb290aCBob3Jpem9udGFsIHNjcm9sbGluZ1xuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5zY3JvbGxIb3Jpem9udGFsID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczUyID0gdGhpcztcblxuXHRcdHZhciByb3dzO1xuXG5cdFx0aWYgKHRoaXMuYWN0aXZlKSB7XG5cdFx0XHRjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxFbmRUaW1lcik7XG5cblx0XHRcdC8vbGF5b3V0IGFsbCByb3dzIGFmdGVyIHNjcm9sbCBpcyBjb21wbGV0ZVxuXHRcdFx0dGhpcy5zY3JvbGxFbmRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRfdGhpczUyLmxheW91dCgpO1xuXHRcdFx0fSwgMTAwKTtcblxuXHRcdFx0cm93cyA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRWaXNpYmxlUm93cygpO1xuXG5cdFx0XHR0aGlzLmNhbGNNYXJnaW5zKCk7XG5cblx0XHRcdHRoaXMubGF5b3V0Q29sdW1uUG9zaXRpb24oKTtcblxuXHRcdFx0dGhpcy5sYXlvdXRDYWxjUm93cygpO1xuXG5cdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRpZiAocm93LnR5cGUgPT09IFwicm93XCIpIHtcblx0XHRcdFx0XHRfdGhpczUyLmxheW91dFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnRhYmxlRWxlbWVudC5zdHlsZS5tYXJnaW5SaWdodCA9IHRoaXMucmlnaHRNYXJnaW47XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2FsY3VsYXRlIG1hcmdpbnMgZm9yIHJvd3Ncblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUuY2FsY01hcmdpbnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5sZWZ0TWFyZ2luID0gdGhpcy5fY2FsY1NwYWNlKHRoaXMubGVmdENvbHVtbnMsIHRoaXMubGVmdENvbHVtbnMubGVuZ3RoKSArIFwicHhcIjtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuaGVhZGVyc0VsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IHRoaXMubGVmdE1hcmdpbjtcblxuXHRcdHRoaXMucmlnaHRNYXJnaW4gPSB0aGlzLl9jYWxjU3BhY2UodGhpcy5yaWdodENvbHVtbnMsIHRoaXMucmlnaHRDb2x1bW5zLmxlbmd0aCkgKyBcInB4XCI7XG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmVsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy5yaWdodE1hcmdpbjtcblxuXHRcdC8vY2FsY3VsYXRlIHJpZ2h0IGZyb3plbiBjb2x1bW5zXG5cdFx0dGhpcy5yaWdodFBhZGRpbmcgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRXaWR0aCArIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxMZWZ0O1xuXHR9O1xuXG5cdC8vbGF5b3V0IGNhbGN1bGF0aW9uIHJvd3Ncblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUubGF5b3V0Q2FsY1Jvd3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wSW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcFJvdykge1xuXHRcdFx0XHR0aGlzLmxheW91dFJvdyh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wUm93KTtcblx0XHRcdH1cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90SW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmJvdFJvdykge1xuXHRcdFx0XHR0aGlzLmxheW91dFJvdyh0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90Um93KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9jYWxjdWxhdGUgY29sdW1uIHBvc2l0aW9ucyBhbmQgbGF5b3V0IGhlYWRlcnNcblx0RnJvemVuQ29sdW1ucy5wcm90b3R5cGUubGF5b3V0Q29sdW1uUG9zaXRpb24gPSBmdW5jdGlvbiAoYWxsQ2VsbHMpIHtcblx0XHR2YXIgX3RoaXM1MyA9IHRoaXM7XG5cblx0XHR2YXIgbGVmdFBhcmVudHMgPSBbXTtcblxuXHRcdHRoaXMubGVmdENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCBpKSB7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luID0gX3RoaXM1My5fY2FsY1NwYWNlKF90aGlzNTMubGVmdENvbHVtbnMsIGkpICsgX3RoaXM1My50YWJsZS5jb2x1bW5NYW5hZ2VyLnNjcm9sbExlZnQgKyBcInB4XCI7XG5cblx0XHRcdGlmIChpID09IF90aGlzNTMubGVmdENvbHVtbnMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSA9IGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29sdW1uLnBhcmVudC5pc0dyb3VwKSB7XG5cdFx0XHRcdHZhciBwYXJlbnRFbCA9IF90aGlzNTMuZ2V0Q29sR3JvdXBQYXJlbnRFbGVtZW50KGNvbHVtbik7XG5cdFx0XHRcdGlmICghbGVmdFBhcmVudHMuaW5jbHVkZXMocGFyZW50RWwpKSB7XG5cdFx0XHRcdFx0X3RoaXM1My5sYXlvdXRFbGVtZW50KHBhcmVudEVsLCBjb2x1bW4pO1xuXHRcdFx0XHRcdGxlZnRQYXJlbnRzLnB1c2gocGFyZW50RWwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlKSB7XG5cdFx0XHRcdFx0cGFyZW50RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mcm96ZW4tXCIgKyBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfdGhpczUzLmxheW91dEVsZW1lbnQoY29sdW1uLmdldEVsZW1lbnQoKSwgY29sdW1uKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFsbENlbGxzKSB7XG5cdFx0XHRcdGNvbHVtbi5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0XHRcdFx0X3RoaXM1My5sYXlvdXRFbGVtZW50KGNlbGwuZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMucmlnaHRDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbiwgaSkge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbiA9IF90aGlzNTMucmlnaHRQYWRkaW5nIC0gX3RoaXM1My5fY2FsY1NwYWNlKF90aGlzNTMucmlnaHRDb2x1bW5zLCBpICsgMSkgKyBcInB4XCI7XG5cblx0XHRcdGlmIChpID09IF90aGlzNTMucmlnaHRDb2x1bW5zLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbHVtbi5wYXJlbnQuaXNHcm91cCkge1xuXHRcdFx0XHRfdGhpczUzLmxheW91dEVsZW1lbnQoX3RoaXM1My5nZXRDb2xHcm91cFBhcmVudEVsZW1lbnQoY29sdW1uKSwgY29sdW1uKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF90aGlzNTMubGF5b3V0RWxlbWVudChjb2x1bW4uZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYWxsQ2VsbHMpIHtcblx0XHRcdFx0Y29sdW1uLmNlbGxzLmZvckVhY2goZnVuY3Rpb24gKGNlbGwpIHtcblx0XHRcdFx0XHRfdGhpczUzLmxheW91dEVsZW1lbnQoY2VsbC5nZXRFbGVtZW50KCksIGNvbHVtbik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmdldENvbEdyb3VwUGFyZW50RWxlbWVudCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRyZXR1cm4gY29sdW1uLnBhcmVudC5pc0dyb3VwID8gdGhpcy5nZXRDb2xHcm91cFBhcmVudEVsZW1lbnQoY29sdW1uLnBhcmVudCkgOiBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHR9O1xuXG5cdC8vbGF5b3V0IGNvbHVtbnMgYXBwcm9wcm9wcmlhdGx5XG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmxheW91dCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJpZ2h0TWFyZ2luID0gMDtcblxuXHRcdGlmIChzZWxmLmFjdGl2ZSkge1xuXG5cdFx0XHQvL2NhbGN1bGF0ZSByb3cgcGFkZGluZ1xuXHRcdFx0dGhpcy5jYWxjTWFyZ2lucygpO1xuXG5cdFx0XHQvLyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHQvLyBcdHNlbGYubGF5b3V0Um93KHJvdyk7XG5cdFx0XHQvLyB9KTtcblxuXHRcdFx0Ly8gaWYoc2VsZi50YWJsZS5vcHRpb25zLmRhdGFUcmVlKXtcblx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRpZiAocm93LnR5cGUgPT09IFwicm93XCIpIHtcblx0XHRcdFx0XHRzZWxmLmxheW91dFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdC8vIH1cblxuXHRcdFx0dGhpcy5sYXlvdXRDYWxjUm93cygpO1xuXG5cdFx0XHQvL2NhbGN1bGF0ZSBsZWZ0IGNvbHVtbnNcblx0XHRcdHRoaXMubGF5b3V0Q29sdW1uUG9zaXRpb24odHJ1ZSk7XG5cblx0XHRcdC8vIGlmKHRhYmxlSG9sZGVyLnNjcm9sbEhlaWdodCA+IHRhYmxlSG9sZGVyLmNsaWVudEhlaWdodCl7XG5cdFx0XHQvLyBcdHJpZ2h0TWFyZ2luIC09IHRhYmxlSG9sZGVyLm9mZnNldFdpZHRoIC0gdGFibGVIb2xkZXIuY2xpZW50V2lkdGg7XG5cdFx0XHQvLyB9XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci50YWJsZUVsZW1lbnQuc3R5bGUubWFyZ2luUmlnaHQgPSB0aGlzLnJpZ2h0TWFyZ2luO1xuXHRcdH1cblx0fTtcblxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5sYXlvdXRSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIF90aGlzNTQgPSB0aGlzO1xuXG5cdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHJvd0VsLnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy5sZWZ0TWFyZ2luO1xuXHRcdC8vIHJvd0VsLnN0eWxlLnBhZGRpbmdSaWdodCA9IHRoaXMucmlnaHRNYXJnaW4gKyBcInB4XCI7XG5cblx0XHR0aGlzLmxlZnRDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXG5cdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRfdGhpczU0LmxheW91dEVsZW1lbnQoY2VsbC5nZXRFbGVtZW50KCksIGNvbHVtbik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLnJpZ2h0Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciBjZWxsID0gcm93LmdldENlbGwoY29sdW1uKTtcblxuXHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0X3RoaXM1NC5sYXlvdXRFbGVtZW50KGNlbGwuZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEZyb3plbkNvbHVtbnMucHJvdG90eXBlLmxheW91dEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29sdW1uKSB7XG5cblx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZnJvemVuKSB7XG5cdFx0XHRlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5sZWZ0ID0gY29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbjtcblxuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWZyb3plblwiKTtcblxuXHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlKSB7XG5cdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mcm96ZW4tXCIgKyBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRGcm96ZW5Db2x1bW5zLnByb3RvdHlwZS5fY2FsY1NwYWNlID0gZnVuY3Rpb24gKGNvbHVtbnMsIGluZGV4KSB7XG5cdFx0dmFyIHdpZHRoID0gMDtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgaW5kZXg7IGkrKykge1xuXHRcdFx0aWYgKGNvbHVtbnNbaV0udmlzaWJsZSkge1xuXHRcdFx0XHR3aWR0aCArPSBjb2x1bW5zW2ldLmdldFdpZHRoKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHdpZHRoO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJmcm96ZW5Db2x1bW5zXCIsIEZyb3plbkNvbHVtbnMpO1xuXHR2YXIgRnJvemVuUm93cyA9IGZ1bmN0aW9uIEZyb3plblJvd3ModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy50b3BFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLnJvd3MgPSBbXTtcblx0XHR0aGlzLmRpc3BsYXlJbmRleCA9IDA7IC8vaW5kZXggaW4gZGlzcGxheSBwaXBlbGluZVxuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5yb3dzID0gW107XG5cblx0XHR0aGlzLnRvcEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mcm96ZW4tcm93cy1ob2xkZXJcIik7XG5cblx0XHQvLyB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudC5hcHBlbmQodGhpcy50b3BFbGVtZW50KTtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0RWxlbWVudCgpLmluc2VydEJlZm9yZSh0aGlzLnRvcEVsZW1lbnQsIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5uZXh0U2libGluZyk7XG5cdH07XG5cblx0RnJvemVuUm93cy5wcm90b3R5cGUuc2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSBpbmRleDtcblx0fTtcblxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5nZXREaXNwbGF5SW5kZXggPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheUluZGV4O1xuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLmlzRnJvemVuID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiAhIXRoaXMucm93cy5sZW5ndGg7XG5cdH07XG5cblx0Ly9maWx0ZXIgZnJvemVuIHJvd3Mgb3V0IG9mIGRpc3BsYXkgZGF0YVxuXHRGcm96ZW5Sb3dzLnByb3RvdHlwZS5nZXRSb3dzID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGZyb3plbiA9IFtdLFxuXHRcdCAgICBvdXRwdXQgPSByb3dzLnNsaWNlKDApO1xuXG5cdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0dmFyIGluZGV4ID0gb3V0cHV0LmluZGV4T2Yocm93KTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0b3V0cHV0LnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLmZyZWV6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRpZiAoIXJvdy5tb2R1bGVzLmZyb3plbikge1xuXHRcdFx0cm93Lm1vZHVsZXMuZnJvemVuID0gdHJ1ZTtcblx0XHRcdHRoaXMudG9wRWxlbWVudC5hcHBlbmRDaGlsZChyb3cuZ2V0RWxlbWVudCgpKTtcblx0XHRcdHJvdy5pbml0aWFsaXplKCk7XG5cdFx0XHRyb3cubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cblx0XHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImRpc3BsYXlcIik7XG5cblx0XHRcdHRoaXMuc3R5bGVSb3dzKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZyZWV6ZSBFcnJvciAtIFJvdyBpcyBhbHJlYWR5IGZyb3plblwiKTtcblx0XHR9XG5cdH07XG5cblx0RnJvemVuUm93cy5wcm90b3R5cGUudW5mcmVlemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5yb3dzLmluZGV4T2Yocm93KTtcblxuXHRcdGlmIChyb3cubW9kdWxlcy5mcm96ZW4pIHtcblxuXHRcdFx0cm93Lm1vZHVsZXMuZnJvemVuID0gZmFsc2U7XG5cblx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRyb3dFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0VsKTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXG5cdFx0XHR0aGlzLnJvd3Muc3BsaWNlKGluZGV4LCAxKTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwiZGlzcGxheVwiKTtcblxuXHRcdFx0aWYgKHRoaXMucm93cy5sZW5ndGgpIHtcblx0XHRcdFx0dGhpcy5zdHlsZVJvd3MoKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRnJlZXplIEVycm9yIC0gUm93IGlzIGFscmVhZHkgdW5mcm96ZW5cIik7XG5cdFx0fVxuXHR9O1xuXG5cdEZyb3plblJvd3MucHJvdG90eXBlLnN0eWxlUm93cyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93LCBpKSB7XG5cdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuc3R5bGVSb3cocm93LCBpKTtcblx0XHR9KTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiZnJvemVuUm93c1wiLCBGcm96ZW5Sb3dzKTtcblxuXHQvL3B1YmxpYyBncm91cCBvYmplY3Rcblx0dmFyIEdyb3VwQ29tcG9uZW50ID0gZnVuY3Rpb24gR3JvdXBDb21wb25lbnQoZ3JvdXApIHtcblx0XHR0aGlzLl9ncm91cCA9IGdyb3VwO1xuXHRcdHRoaXMudHlwZSA9IFwiR3JvdXBDb21wb25lbnRcIjtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0S2V5ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5rZXk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5maWVsZDtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZWxlbWVudDtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZ2V0Um93cyh0cnVlKTtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0U3ViR3JvdXBzID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5nZXRTdWJHcm91cHModHJ1ZSk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldFBhcmVudEdyb3VwID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5wYXJlbnQgPyB0aGlzLl9ncm91cC5wYXJlbnQuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuZ2V0VmlzaWJpbGl0eSA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAudmlzaWJsZTtcblx0fTtcblxuXHRHcm91cENvbXBvbmVudC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLl9ncm91cC5zaG93KCk7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5fZ3JvdXAuaGlkZSgpO1xuXHR9O1xuXG5cdEdyb3VwQ29tcG9uZW50LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5fZ3JvdXAudG9nZ2xlVmlzaWJpbGl0eSgpO1xuXHR9O1xuXG5cdEdyb3VwQ29tcG9uZW50LnByb3RvdHlwZS5fZ2V0U2VsZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXA7XG5cdH07XG5cblx0R3JvdXBDb21wb25lbnQucHJvdG90eXBlLmdldFRhYmxlID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5ncm91cE1hbmFnZXIudGFibGU7XG5cdH07XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLyBHcm91cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHR2YXIgR3JvdXAgPSBmdW5jdGlvbiBHcm91cChncm91cE1hbmFnZXIsIHBhcmVudCwgbGV2ZWwsIGtleSwgZmllbGQsIGdlbmVyYXRvciwgb2xkR3JvdXApIHtcblxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyID0gZ3JvdXBNYW5hZ2VyO1xuXHRcdHRoaXMucGFyZW50ID0gcGFyZW50O1xuXHRcdHRoaXMua2V5ID0ga2V5O1xuXHRcdHRoaXMubGV2ZWwgPSBsZXZlbDtcblx0XHR0aGlzLmZpZWxkID0gZmllbGQ7XG5cdFx0dGhpcy5oYXNTdWJHcm91cHMgPSBsZXZlbCA8IGdyb3VwTWFuYWdlci5ncm91cElETG9va3Vwcy5sZW5ndGggLSAxO1xuXHRcdHRoaXMuYWRkUm93ID0gdGhpcy5oYXNTdWJHcm91cHMgPyB0aGlzLl9hZGRSb3dUb0dyb3VwIDogdGhpcy5fYWRkUm93O1xuXHRcdHRoaXMudHlwZSA9IFwiZ3JvdXBcIjsgLy90eXBlIG9mIGVsZW1lbnRcblx0XHR0aGlzLm9sZCA9IG9sZEdyb3VwO1xuXHRcdHRoaXMucm93cyA9IFtdO1xuXHRcdHRoaXMuZ3JvdXBzID0gW107XG5cdFx0dGhpcy5ncm91cExpc3QgPSBbXTtcblx0XHR0aGlzLmdlbmVyYXRvciA9IGdlbmVyYXRvcjtcblx0XHR0aGlzLmVsZW1lbnRDb250ZW50cyA9IGZhbHNlO1xuXHRcdHRoaXMuaGVpZ2h0ID0gMDtcblx0XHR0aGlzLm91dGVySGVpZ2h0ID0gMDtcblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0dGhpcy5jYWxjcyA9IHt9O1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblx0XHR0aGlzLmFycm93RWxlbWVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy52aXNpYmxlID0gb2xkR3JvdXAgPyBvbGRHcm91cC52aXNpYmxlIDogdHlwZW9mIGdyb3VwTWFuYWdlci5zdGFydE9wZW5bbGV2ZWxdICE9PSBcInVuZGVmaW5lZFwiID8gZ3JvdXBNYW5hZ2VyLnN0YXJ0T3BlbltsZXZlbF0gOiBncm91cE1hbmFnZXIuc3RhcnRPcGVuWzBdO1xuXG5cdFx0dGhpcy5jcmVhdGVFbGVtZW50cygpO1xuXHRcdHRoaXMuYWRkQmluZGluZ3MoKTtcblxuXHRcdHRoaXMuY3JlYXRlVmFsdWVHcm91cHMoKTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUud2lwZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5ncm91cExpc3QubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRncm91cC53aXBlKCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5lbGVtZW50ID0gZmFsc2U7XG5cdFx0XHR0aGlzLmFycm93RWxlbWVudCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5lbGVtZW50Q29udGVudHMgPSBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBhcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0YXJyb3cuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1hcnJvd1wiKTtcblxuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwXCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwLWxldmVsLVwiICsgdGhpcy5sZXZlbCk7XG5cdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyb3dncm91cFwiKTtcblxuXHRcdHRoaXMuYXJyb3dFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLmFycm93RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwLXRvZ2dsZVwiKTtcblx0XHR0aGlzLmFycm93RWxlbWVudC5hcHBlbmRDaGlsZChhcnJvdyk7XG5cblx0XHQvL3NldHVwIG1vdmFibGUgcm93c1xuXHRcdGlmICh0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzICE9PSBmYWxzZSAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2RFeGlzdHMoXCJtb3ZlUm93XCIpKSB7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLm1vdmVSb3cuaW5pdGlhbGl6ZUdyb3VwSGVhZGVyKHRoaXMpO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuY3JlYXRlVmFsdWVHcm91cHMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNTUgPSB0aGlzO1xuXG5cdFx0dmFyIGxldmVsID0gdGhpcy5sZXZlbCArIDE7XG5cdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLmFsbG93ZWRWYWx1ZXMgJiYgdGhpcy5ncm91cE1hbmFnZXIuYWxsb3dlZFZhbHVlc1tsZXZlbF0pIHtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLmFsbG93ZWRWYWx1ZXNbbGV2ZWxdLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdF90aGlzNTUuX2NyZWF0ZUdyb3VwKHZhbHVlLCBsZXZlbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmFkZEJpbmRpbmdzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZGJsVGFwLFxuXHRcdCAgICB0YXBIb2xkLFxuXHRcdCAgICB0YXAsXG5cdFx0ICAgIHRvZ2dsZUVsZW1lbnQ7XG5cblx0XHQvL2hhbmRsZSBncm91cCBjbGljayBldmVudHNcblx0XHRpZiAoc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENsaWNrKSB7XG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBDbGljay5jYWxsKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLCBlLCBzZWxmLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwRGJsQ2xpY2spIHtcblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cERibENsaWNrLmNhbGwoc2VsZi5ncm91cE1hbmFnZXIudGFibGUsIGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBDb250ZXh0KSB7XG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBDb250ZXh0LmNhbGwoc2VsZi5ncm91cE1hbmFnZXIudGFibGUsIGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBUYXApIHtcblxuXHRcdFx0dGFwID0gZmFsc2U7XG5cblx0XHRcdHNlbGYuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR0YXAgPSB0cnVlO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmICh0YXApIHtcblx0XHRcdFx0XHRzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFwID0gZmFsc2U7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cERibFRhcCkge1xuXG5cdFx0XHRkYmxUYXAgPSBudWxsO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0aWYgKGRibFRhcCkge1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dChkYmxUYXApO1xuXHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cblx0XHRcdFx0XHRzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwRGJsVGFwKGUsIHNlbGYuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0ZGJsVGFwID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQoZGJsVGFwKTtcblx0XHRcdFx0XHRcdGRibFRhcCA9IG51bGw7XG5cdFx0XHRcdFx0fSwgMzAwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBUYXBIb2xkKSB7XG5cblx0XHRcdHRhcEhvbGQgPSBudWxsO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRhcEhvbGQpO1xuXG5cdFx0XHRcdHRhcEhvbGQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRjbGVhclRpbWVvdXQodGFwSG9sZCk7XG5cdFx0XHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cdFx0XHRcdFx0dGFwID0gZmFsc2U7XG5cdFx0XHRcdFx0c2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFRhcEhvbGQoZSwgc2VsZi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH0sIDEwMDApO1xuXHRcdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHRzZWxmLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXBIb2xkKTtcblx0XHRcdFx0dGFwSG9sZCA9IG51bGw7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFRvZ2dsZUVsZW1lbnQpIHtcblx0XHRcdHRvZ2dsZUVsZW1lbnQgPSBzZWxmLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVG9nZ2xlRWxlbWVudCA9PSBcImFycm93XCIgPyBzZWxmLmFycm93RWxlbWVudCA6IHNlbGYuZWxlbWVudDtcblxuXHRcdFx0dG9nZ2xlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0c2VsZi50b2dnbGVWaXNpYmlsaXR5KCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLl9jcmVhdGVHcm91cCA9IGZ1bmN0aW9uIChncm91cElELCBsZXZlbCkge1xuXHRcdHZhciBncm91cEtleSA9IGxldmVsICsgXCJfXCIgKyBncm91cElEO1xuXHRcdHZhciBncm91cCA9IG5ldyBHcm91cCh0aGlzLmdyb3VwTWFuYWdlciwgdGhpcywgbGV2ZWwsIGdyb3VwSUQsIHRoaXMuZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzW2xldmVsXS5maWVsZCwgdGhpcy5ncm91cE1hbmFnZXIuaGVhZGVyR2VuZXJhdG9yW2xldmVsXSB8fCB0aGlzLmdyb3VwTWFuYWdlci5oZWFkZXJHZW5lcmF0b3JbMF0sIHRoaXMub2xkID8gdGhpcy5vbGQuZ3JvdXBzW2dyb3VwS2V5XSA6IGZhbHNlKTtcblxuXHRcdHRoaXMuZ3JvdXBzW2dyb3VwS2V5XSA9IGdyb3VwO1xuXHRcdHRoaXMuZ3JvdXBMaXN0LnB1c2goZ3JvdXApO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5fYWRkUm93VG9Hcm91cCA9IGZ1bmN0aW9uIChyb3cpIHtcblxuXHRcdHZhciBsZXZlbCA9IHRoaXMubGV2ZWwgKyAxO1xuXG5cdFx0aWYgKHRoaXMuaGFzU3ViR3JvdXBzKSB7XG5cdFx0XHR2YXIgZ3JvdXBJRCA9IHRoaXMuZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzW2xldmVsXS5mdW5jKHJvdy5nZXREYXRhKCkpLFxuXHRcdFx0ICAgIGdyb3VwS2V5ID0gbGV2ZWwgKyBcIl9cIiArIGdyb3VwSUQ7XG5cblx0XHRcdGlmICh0aGlzLmdyb3VwTWFuYWdlci5hbGxvd2VkVmFsdWVzICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLmFsbG93ZWRWYWx1ZXNbbGV2ZWxdKSB7XG5cdFx0XHRcdGlmICh0aGlzLmdyb3Vwc1tncm91cEtleV0pIHtcblx0XHRcdFx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0uYWRkUm93KHJvdyk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICghdGhpcy5ncm91cHNbZ3JvdXBLZXldKSB7XG5cdFx0XHRcdFx0dGhpcy5fY3JlYXRlR3JvdXAoZ3JvdXBJRCwgbGV2ZWwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuX2FkZFJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR0aGlzLnJvd3MucHVzaChyb3cpO1xuXHRcdHJvdy5tb2R1bGVzLmdyb3VwID0gdGhpcztcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuaW5zZXJ0Um93ID0gZnVuY3Rpb24gKHJvdywgdG8sIGFmdGVyKSB7XG5cdFx0dmFyIGRhdGEgPSB0aGlzLmNvbmZvcm1Sb3dEYXRhKHt9KTtcblxuXHRcdHJvdy51cGRhdGVEYXRhKGRhdGEpO1xuXG5cdFx0dmFyIHRvSW5kZXggPSB0aGlzLnJvd3MuaW5kZXhPZih0byk7XG5cblx0XHRpZiAodG9JbmRleCA+IC0xKSB7XG5cdFx0XHRpZiAoYWZ0ZXIpIHtcblx0XHRcdFx0dGhpcy5yb3dzLnNwbGljZSh0b0luZGV4ICsgMSwgMCwgcm93KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMucm93cy5zcGxpY2UodG9JbmRleCwgMCwgcm93KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKGFmdGVyKSB7XG5cdFx0XHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnJvd3MudW5zaGlmdChyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJvdy5tb2R1bGVzLmdyb3VwID0gdGhpcztcblxuXHRcdHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzKCk7XG5cblx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIpIHtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjR3JvdXAodGhpcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ncm91cE1hbmFnZXIudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5zY3JvbGxIZWFkZXIgPSBmdW5jdGlvbiAobGVmdCkge1xuXHRcdHRoaXMuYXJyb3dFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBsZWZ0O1xuXG5cdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcblx0XHRcdGNoaWxkLnNjcm9sbEhlYWRlcihsZWZ0KTtcblx0XHR9KTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0Um93SW5kZXggPSBmdW5jdGlvbiAocm93KSB7fTtcblxuXHQvL3VwZGF0ZSByb3cgZGF0YSB0byBtYXRjaCBncm91cGluZyBjb250cmFpbnRzXG5cdEdyb3VwLnByb3RvdHlwZS5jb25mb3JtUm93RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0aWYgKHRoaXMuZmllbGQpIHtcblx0XHRcdGRhdGFbdGhpcy5maWVsZF0gPSB0aGlzLmtleTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRGF0YSBDb25mb3JtaW5nIEVycm9yIC0gQ2Fubm90IGNvbmZvcm0gcm93IGRhdGEgdG8gbWF0Y2ggbmV3IGdyb3VwIGFzIGdyb3VwQnkgaXMgYSBmdW5jdGlvblwiKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYXJlbnQpIHtcblx0XHRcdGRhdGEgPSB0aGlzLnBhcmVudC5jb25mb3JtUm93RGF0YShkYXRhKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUucmVtb3ZlUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBpbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cdFx0dmFyIGVsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdGlmIChpbmRleCA+IC0xKSB7XG5cdFx0XHR0aGlzLnJvd3Muc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBWYWx1ZXMgJiYgIXRoaXMucm93cy5sZW5ndGgpIHtcblx0XHRcdGlmICh0aGlzLnBhcmVudCkge1xuXHRcdFx0XHR0aGlzLnBhcmVudC5yZW1vdmVHcm91cCh0aGlzKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnJlbW92ZUdyb3VwKHRoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGVsLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0ZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzKCk7XG5cblx0XHRcdGlmICh0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwidGFibGVcIikge1xuXHRcdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlY2FsY0dyb3VwKHRoaXMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUucmVtb3ZlR3JvdXAgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgZ3JvdXBLZXkgPSBncm91cC5sZXZlbCArIFwiX1wiICsgZ3JvdXAua2V5LFxuXHRcdCAgICBpbmRleDtcblxuXHRcdGlmICh0aGlzLmdyb3Vwc1tncm91cEtleV0pIHtcblx0XHRcdGRlbGV0ZSB0aGlzLmdyb3Vwc1tncm91cEtleV07XG5cblx0XHRcdGluZGV4ID0gdGhpcy5ncm91cExpc3QuaW5kZXhPZihncm91cCk7XG5cblx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cdFx0XHRcdHRoaXMuZ3JvdXBMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghdGhpcy5ncm91cExpc3QubGVuZ3RoKSB7XG5cdFx0XHRcdGlmICh0aGlzLnBhcmVudCkge1xuXHRcdFx0XHRcdHRoaXMucGFyZW50LnJlbW92ZUdyb3VwKHRoaXMpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnJlbW92ZUdyb3VwKHRoaXMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5nZXRIZWFkZXJzQW5kUm93cyA9IGZ1bmN0aW9uIChub0NhbGMpIHtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRvdXRwdXQucHVzaCh0aGlzKTtcblxuXHRcdHRoaXMuX3Zpc1NldCgpO1xuXG5cdFx0aWYgKHRoaXMudmlzaWJsZSkge1xuXHRcdFx0aWYgKHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQoZ3JvdXAuZ2V0SGVhZGVyc0FuZFJvd3Mobm9DYWxjKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKCFub0NhbGMgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5oYXNUb3BDYWxjcygpKSB7XG5cdFx0XHRcdFx0aWYgKHRoaXMuY2FsY3MudG9wKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcC5kZXRhY2hFbGVtZW50KCk7XG5cdFx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcC5kZWxldGVDZWxscygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRoaXMuY2FsY3MudG9wID0gdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5nZW5lcmF0ZVRvcFJvdyh0aGlzLnJvd3MpO1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMuY2FsY3MudG9wKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQodGhpcy5yb3dzKTtcblxuXHRcdFx0XHRpZiAoIW5vQ2FsYyAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwidGFibGVcIiAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmhhc0JvdHRvbUNhbGNzKCkpIHtcblx0XHRcdFx0XHRpZiAodGhpcy5jYWxjcy5ib3R0b20pIHtcblx0XHRcdFx0XHRcdHRoaXMuY2FsY3MuYm90dG9tLmRldGFjaEVsZW1lbnQoKTtcblx0XHRcdFx0XHRcdHRoaXMuY2FsY3MuYm90dG9tLmRlbGV0ZUNlbGxzKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhpcy5jYWxjcy5ib3R0b20gPSB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmdlbmVyYXRlQm90dG9tUm93KHRoaXMucm93cyk7XG5cdFx0XHRcdFx0b3V0cHV0LnB1c2godGhpcy5jYWxjcy5ib3R0b20pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICghdGhpcy5ncm91cExpc3QubGVuZ3RoICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKSB7XG5cblx0XHRcdFx0aWYgKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKSB7XG5cblx0XHRcdFx0XHRpZiAoIW5vQ2FsYyAmJiB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmhhc1RvcENhbGNzKCkpIHtcblx0XHRcdFx0XHRcdGlmICh0aGlzLmNhbGNzLnRvcCkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmNhbGNzLnRvcC5kZXRhY2hFbGVtZW50KCk7XG5cdFx0XHRcdFx0XHRcdHRoaXMuY2FsY3MudG9wLmRlbGV0ZUNlbGxzKCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwQ2xvc2VkU2hvd0NhbGNzKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuY2FsY3MudG9wID0gdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5nZW5lcmF0ZVRvcFJvdyh0aGlzLnJvd3MpO1xuXHRcdFx0XHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLmNhbGNzLnRvcCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFub0NhbGMgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5oYXNCb3R0b21DYWxjcygpKSB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5jYWxjcy5ib3R0b20pIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5jYWxjcy5ib3R0b20uZGV0YWNoRWxlbWVudCgpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmNhbGNzLmJvdHRvbS5kZWxldGVDZWxscygpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENsb3NlZFNob3dDYWxjcykge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmNhbGNzLmJvdHRvbSA9IHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2VuZXJhdGVCb3R0b21Sb3codGhpcy5yb3dzKTtcblx0XHRcdFx0XHRcdFx0b3V0cHV0LnB1c2godGhpcy5jYWxjcy5ib3R0b20pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbiAodmlzaWJsZSwgdHJhbnNmb3JtKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXTtcblxuXHRcdHRoaXMuX3Zpc1NldCgpO1xuXG5cdFx0aWYgKCF2aXNpYmxlIHx8IHZpc2libGUgJiYgdGhpcy52aXNpYmxlKSB7XG5cdFx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKHJvdy5nZXREYXRhKHRyYW5zZm9ybSB8fCBcImRhdGFcIikpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHQvLyBHcm91cC5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uKCl7XG5cdC8vIFx0dGhpcy5fdmlzU2V0KCk7XG5cblx0Ly8gXHRyZXR1cm4gdGhpcy52aXNpYmxlID8gdGhpcy5yb3dzIDogW107XG5cdC8vIH07XG5cblx0R3JvdXAucHJvdG90eXBlLmdldFJvd0NvdW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBjb3VudCA9IDA7XG5cblx0XHRpZiAodGhpcy5ncm91cExpc3QubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0XHRjb3VudCArPSBncm91cC5nZXRSb3dDb3VudCgpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvdW50ID0gdGhpcy5yb3dzLmxlbmd0aDtcblx0XHR9XG5cdFx0cmV0dXJuIGNvdW50O1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS50b2dnbGVWaXNpYmlsaXR5ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLnZpc2libGUpIHtcblx0XHRcdHRoaXMuaGlkZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnNob3coKTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy52aXNpYmxlID0gZmFsc2U7XG5cblx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUucm93TWFuYWdlci5nZXRSZW5kZXJNb2RlKCkgPT0gXCJjbGFzc2ljXCIgJiYgIXRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbikge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXG5cdFx0XHRpZiAodGhpcy5ncm91cExpc3QubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cblx0XHRcdFx0XHR2YXIgcm93cyA9IGdyb3VwLmdldEhlYWRlcnNBbmRSb3dzKCk7XG5cblx0XHRcdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdFx0cm93LmRldGFjaEVsZW1lbnQoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0VsKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuc2V0RGlzcGxheVJvd3ModGhpcy5ncm91cE1hbmFnZXIudXBkYXRlR3JvdXBSb3dzKCksIHRoaXMuZ3JvdXBNYW5hZ2VyLmdldERpc3BsYXlJbmRleCgpKTtcblxuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudGFibGUucm93TWFuYWdlci5jaGVja0NsYXNzaWNNb2RlR3JvdXBIZWFkZXJXaWR0aCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFZpc2liaWxpdHlDaGFuZ2VkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5nZXRDb21wb25lbnQoKSwgZmFsc2UpO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYudmlzaWJsZSA9IHRydWU7XG5cblx0XHRpZiAodGhpcy5ncm91cE1hbmFnZXIudGFibGUucm93TWFuYWdlci5nZXRSZW5kZXJNb2RlKCkgPT0gXCJjbGFzc2ljXCIgJiYgIXRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbikge1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXG5cdFx0XHR2YXIgcHJldiA9IHNlbGYuZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRpZiAodGhpcy5ncm91cExpc3QubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRcdFx0dmFyIHJvd3MgPSBncm91cC5nZXRIZWFkZXJzQW5kUm93cygpO1xuXG5cdFx0XHRcdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0XHRwcmV2LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHJvd0VsLCBwcmV2Lm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdHJvdy5pbml0aWFsaXplKCk7XG5cdFx0XHRcdFx0XHRwcmV2ID0gcm93RWw7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2VsZi5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cHJldi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShyb3dFbCwgcHJldi5uZXh0U2libGluZyk7XG5cdFx0XHRcdFx0cm93LmluaXRpYWxpemUoKTtcblx0XHRcdFx0XHRwcmV2ID0gcm93RWw7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5yb3dNYW5hZ2VyLnNldERpc3BsYXlSb3dzKHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cygpLCB0aGlzLmdyb3VwTWFuYWdlci5nZXREaXNwbGF5SW5kZXgoKSk7XG5cblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuY2hlY2tDbGFzc2ljTW9kZUdyb3VwSGVhZGVyV2lkdGgoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5ncm91cE1hbmFnZXIudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBWaXNpYmlsaXR5Q2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCksIHRydWUpO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5fdmlzU2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBkYXRhID0gW107XG5cblx0XHRpZiAodHlwZW9mIHRoaXMudmlzaWJsZSA9PSBcImZ1bmN0aW9uXCIpIHtcblxuXHRcdFx0dGhpcy5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy52aXNpYmxlKHRoaXMua2V5LCB0aGlzLmdldFJvd0NvdW50KCksIGRhdGEsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0Um93R3JvdXAgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIG1hdGNoID0gZmFsc2U7XG5cdFx0aWYgKHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHRcdFx0dmFyIHJlc3VsdCA9IGdyb3VwLmdldFJvd0dyb3VwKHJvdyk7XG5cblx0XHRcdFx0aWYgKHJlc3VsdCkge1xuXHRcdFx0XHRcdG1hdGNoID0gcmVzdWx0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHRoaXMucm93cy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdHJldHVybiBpdGVtID09PSByb3c7XG5cdFx0XHR9KSkge1xuXHRcdFx0XHRtYXRjaCA9IHRoaXM7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5nZXRTdWJHcm91cHMgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcblx0XHRcdG91dHB1dC5wdXNoKGNvbXBvbmVudCA/IGNoaWxkLmdldENvbXBvbmVudCgpIDogY2hpbGQpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uIChjb21wb21lbnQpIHtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRvdXRwdXQucHVzaChjb21wb21lbnQgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiByb3cpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUuZ2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBkYXRhID0gW107XG5cblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmVsZW1lbnRDb250ZW50cyA9IHRoaXMuZ2VuZXJhdG9yKHRoaXMua2V5LCB0aGlzLmdldFJvd0NvdW50KCksIGRhdGEsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXG5cdFx0d2hpbGUgKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdH1pZiAodHlwZW9mIHRoaXMuZWxlbWVudENvbnRlbnRzID09PSBcInN0cmluZ1wiKSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5lbGVtZW50Q29udGVudHM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRDb250ZW50cyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbGVtZW50Lmluc2VydEJlZm9yZSh0aGlzLmFycm93RWxlbWVudCwgdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHR9O1xuXG5cdC8vLy8vLy8vLy8vLy8vIFN0YW5kYXJkIFJvdyBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy9cblxuXHRHcm91cC5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmFkZEJpbmRpbmdzZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5fdmlzU2V0KCk7XG5cblx0XHRpZiAodGhpcy52aXNpYmxlKSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXHRcdH1cblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoOyArK2kpIHtcblx0XHRcdHRoaXMuZWxlbWVudC5jaGlsZE5vZGVzW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LmNoaWxkTm9kZXNbaV0pO1xuXHRcdH1cblxuXHRcdHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzKCk7XG5cblx0XHQvLyB0aGlzLmFkZEJpbmRpbmdzKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5kZXRhY2hFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vbm9ybWFsaXplIHRoZSBoZWlnaHQgb2YgZWxlbWVudHMgaW4gdGhlIHJvd1xuXHRHcm91cC5wcm90b3R5cGUubm9ybWFsaXplSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuc2V0SGVpZ2h0KHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQpO1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cdFx0aWYgKCF0aGlzLmluaXRpYWxpemVkIHx8IGZvcmNlKSB7XG5cdFx0XHR0aGlzLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0dGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0fVxuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5yZWluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuaGVpZ2h0ID0gMDtcblxuXHRcdGlmIChUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxWaXNpYmxlKHRoaXMuZWxlbWVudCkpIHtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXAucHJvdG90eXBlLnNldEhlaWdodCA9IGZ1bmN0aW9uIChoZWlnaHQpIHtcblx0XHRpZiAodGhpcy5oZWlnaHQgIT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLmhlaWdodCA9IGhlaWdodDtcblx0XHRcdHRoaXMub3V0ZXJIZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXHRcdH1cblx0fTtcblxuXHQvL3JldHVybiByb3dzIG91dGVyIGhlaWdodFxuXHRHcm91cC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLm91dGVySGVpZ2h0O1xuXHR9O1xuXG5cdEdyb3VwLnByb3RvdHlwZS5nZXRHcm91cCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcztcblx0fTtcblxuXHRHcm91cC5wcm90b3R5cGUucmVpbml0aWFsaXplSGVpZ2h0ID0gZnVuY3Rpb24gKCkge307XG5cdEdyb3VwLnByb3RvdHlwZS5jYWxjSGVpZ2h0ID0gZnVuY3Rpb24gKCkge307XG5cdEdyb3VwLnByb3RvdHlwZS5zZXRDZWxsSGVpZ2h0ID0gZnVuY3Rpb24gKCkge307XG5cdEdyb3VwLnByb3RvdHlwZS5jbGVhckNlbGxIZWlnaHQgPSBmdW5jdGlvbiAoKSB7fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vIE9iamVjdCBHZW5lcmF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cdEdyb3VwLnByb3RvdHlwZS5nZXRDb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIG5ldyBHcm91cENvbXBvbmVudCh0aGlzKTtcblx0fTtcblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLyBHcm91cCBSb3cgRXh0ZW5zaW9uIC8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdHZhciBHcm91cFJvd3MgPSBmdW5jdGlvbiBHcm91cFJvd3ModGFibGUpIHtcblxuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3RcblxuXHRcdHRoaXMuZ3JvdXBJRExvb2t1cHMgPSBmYWxzZTsgLy9lbmFibGUgdGFibGUgZ3JvdXBpbmcgYW5kIHNldCBmaWVsZCB0byBncm91cCBieVxuXHRcdHRoaXMuc3RhcnRPcGVuID0gW2Z1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XTsgLy9zdGFydGluZyBzdGF0ZSBvZiBncm91cFxuXHRcdHRoaXMuaGVhZGVyR2VuZXJhdG9yID0gW2Z1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH1dO1xuXHRcdHRoaXMuZ3JvdXBMaXN0ID0gW107IC8vb3JkZXJlZCBsaXN0IG9mIGdyb3Vwc1xuXHRcdHRoaXMuYWxsb3dlZFZhbHVlcyA9IGZhbHNlO1xuXHRcdHRoaXMuZ3JvdXBzID0ge307IC8vaG9sZCByb3cgZ3JvdXBzXG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSAwOyAvL2luZGV4IGluIGRpc3BsYXkgcGlwZWxpbmVcblx0fTtcblxuXHQvL2luaXRpYWxpemUgZ3JvdXAgY29uZmlndXJhdGlvblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBncm91cEJ5ID0gc2VsZi50YWJsZS5vcHRpb25zLmdyb3VwQnksXG5cdFx0ICAgIHN0YXJ0T3BlbiA9IHNlbGYudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbixcblx0XHQgICAgZ3JvdXBIZWFkZXIgPSBzZWxmLnRhYmxlLm9wdGlvbnMuZ3JvdXBIZWFkZXI7XG5cblx0XHR0aGlzLmFsbG93ZWRWYWx1ZXMgPSBzZWxmLnRhYmxlLm9wdGlvbnMuZ3JvdXBWYWx1ZXM7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShncm91cEJ5KSAmJiBBcnJheS5pc0FycmF5KGdyb3VwSGVhZGVyKSAmJiBncm91cEJ5Lmxlbmd0aCA+IGdyb3VwSGVhZGVyLmxlbmd0aCkge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRXJyb3IgY3JlYXRpbmcgZ3JvdXAgaGVhZGVycywgZ3JvdXBIZWFkZXIgYXJyYXkgaXMgc2hvcnRlciB0aGFuIGdyb3VwQnkgYXJyYXlcIik7XG5cdFx0fVxuXG5cdFx0c2VsZi5oZWFkZXJHZW5lcmF0b3IgPSBbZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fV07XG5cdFx0dGhpcy5zdGFydE9wZW4gPSBbZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1dOyAvL3N0YXJ0aW5nIHN0YXRlIG9mIGdyb3VwXG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcImdyb3Vwc3xpdGVtXCIsIGZ1bmN0aW9uIChsYW5nVmFsdWUsIGxhbmcpIHtcblx0XHRcdHNlbGYuaGVhZGVyR2VuZXJhdG9yWzBdID0gZnVuY3Rpb24gKHZhbHVlLCBjb3VudCwgZGF0YSkge1xuXHRcdFx0XHQvL2hlYWRlciBsYXlvdXQgZnVuY3Rpb25cblx0XHRcdFx0cmV0dXJuICh0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBcIlwiIDogdmFsdWUpICsgXCI8c3Bhbj4oXCIgKyBjb3VudCArIFwiIFwiICsgKGNvdW50ID09PSAxID8gbGFuZ1ZhbHVlIDogbGFuZy5ncm91cHMuaXRlbXMpICsgXCIpPC9zcGFuPlwiO1xuXHRcdFx0fTtcblx0XHR9KTtcblxuXHRcdHRoaXMuZ3JvdXBJRExvb2t1cHMgPSBbXTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGdyb3VwQnkpIHx8IGdyb3VwQnkpIHtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIgJiYgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwiYm90aFwiKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5yZW1vdmVDYWxjcygpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJncm91cFwiKSB7XG5cblx0XHRcdFx0dmFyIGNvbHMgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0UmVhbENvbHVtbnMoKTtcblxuXHRcdFx0XHRjb2xzLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0XHRcdGlmIChjb2wuZGVmaW5pdGlvbi50b3BDYWxjKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZVRvcFJvdygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChjb2wuZGVmaW5pdGlvbi5ib3R0b21DYWxjKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZUJvdHRvbVJvdygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGdyb3VwQnkpKSB7XG5cdFx0XHRncm91cEJ5ID0gW2dyb3VwQnldO1xuXHRcdH1cblxuXHRcdGdyb3VwQnkuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXAsIGkpIHtcblx0XHRcdHZhciBsb29rdXBGdW5jLCBjb2x1bW47XG5cblx0XHRcdGlmICh0eXBlb2YgZ3JvdXAgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGxvb2t1cEZ1bmMgPSBncm91cDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbHVtbiA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGdyb3VwKTtcblxuXHRcdFx0XHRpZiAoY29sdW1uKSB7XG5cdFx0XHRcdFx0bG9va3VwRnVuYyA9IGZ1bmN0aW9uIGxvb2t1cEZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bG9va3VwRnVuYyA9IGZ1bmN0aW9uIGxvb2t1cEZ1bmMoZGF0YSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRhdGFbZ3JvdXBdO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c2VsZi5ncm91cElETG9va3Vwcy5wdXNoKHtcblx0XHRcdFx0ZmllbGQ6IHR5cGVvZiBncm91cCA9PT0gXCJmdW5jdGlvblwiID8gZmFsc2UgOiBncm91cCxcblx0XHRcdFx0ZnVuYzogbG9va3VwRnVuYyxcblx0XHRcdFx0dmFsdWVzOiBzZWxmLmFsbG93ZWRWYWx1ZXMgPyBzZWxmLmFsbG93ZWRWYWx1ZXNbaV0gOiBmYWxzZVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRpZiAoc3RhcnRPcGVuKSB7XG5cblx0XHRcdGlmICghQXJyYXkuaXNBcnJheShzdGFydE9wZW4pKSB7XG5cdFx0XHRcdHN0YXJ0T3BlbiA9IFtzdGFydE9wZW5dO1xuXHRcdFx0fVxuXG5cdFx0XHRzdGFydE9wZW4uZm9yRWFjaChmdW5jdGlvbiAobGV2ZWwpIHtcblx0XHRcdFx0bGV2ZWwgPSB0eXBlb2YgbGV2ZWwgPT0gXCJmdW5jdGlvblwiID8gbGV2ZWwgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5zdGFydE9wZW4gPSBzdGFydE9wZW47XG5cdFx0fVxuXG5cdFx0aWYgKGdyb3VwSGVhZGVyKSB7XG5cdFx0XHRzZWxmLmhlYWRlckdlbmVyYXRvciA9IEFycmF5LmlzQXJyYXkoZ3JvdXBIZWFkZXIpID8gZ3JvdXBIZWFkZXIgOiBbZ3JvdXBIZWFkZXJdO1xuXHRcdH1cblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuc2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSBpbmRleDtcblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldERpc3BsYXlJbmRleCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5SW5kZXg7XG5cdH07XG5cblx0Ly9yZXR1cm4gYXBwcm9wcmlhdGUgcm93cyB3aXRoIGdyb3VwIGhlYWRlcnNcblx0R3JvdXBSb3dzLnByb3RvdHlwZS5nZXRSb3dzID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHRpZiAodGhpcy5ncm91cElETG9va3Vwcy5sZW5ndGgpIHtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmRhdGFHcm91cGluZy5jYWxsKHRoaXMudGFibGUpO1xuXG5cdFx0XHR0aGlzLmdlbmVyYXRlR3JvdXBzKHJvd3MpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRhdGFHcm91cGVkKSB7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5kYXRhR3JvdXBlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0R3JvdXBzKHRydWUpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMudXBkYXRlR3JvdXBSb3dzKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiByb3dzLnNsaWNlKDApO1xuXHRcdH1cblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldEdyb3VwcyA9IGZ1bmN0aW9uIChjb21wb21lbnQpIHtcblx0XHR2YXIgZ3JvdXBDb21wb25lbnRzID0gW107XG5cblx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0Z3JvdXBDb21wb25lbnRzLnB1c2goY29tcG9tZW50ID8gZ3JvdXAuZ2V0Q29tcG9uZW50KCkgOiBncm91cCk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZ3JvdXBDb21wb25lbnRzO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2V0Q2hpbGRHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgX3RoaXM1NiA9IHRoaXM7XG5cblx0XHR2YXIgZ3JvdXBDb21wb25lbnRzID0gW107XG5cblx0XHRpZiAoIWdyb3VwKSB7XG5cdFx0XHRncm91cCA9IHRoaXM7XG5cdFx0fVxuXG5cdFx0Z3JvdXAuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG5cdFx0XHRpZiAoY2hpbGQuZ3JvdXBMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHRncm91cENvbXBvbmVudHMgPSBncm91cENvbXBvbmVudHMuY29uY2F0KF90aGlzNTYuZ2V0Q2hpbGRHcm91cHMoY2hpbGQpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdyb3VwQ29tcG9uZW50cy5wdXNoKGNoaWxkKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBncm91cENvbXBvbmVudHM7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS53aXBlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRncm91cC53aXBlKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5wdWxsR3JvdXBMaXN0RGF0YSA9IGZ1bmN0aW9uIChncm91cExpc3QpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0dmFyIGdyb3VwTGlzdERhdGEgPSBbXTtcblxuXHRcdGdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0dmFyIGdyb3VwSGVhZGVyID0ge307XG5cdFx0XHRncm91cEhlYWRlci5sZXZlbCA9IDA7XG5cdFx0XHRncm91cEhlYWRlci5yb3dDb3VudCA9IDA7XG5cdFx0XHRncm91cEhlYWRlci5oZWFkZXJDb250ZW50ID0gXCJcIjtcblx0XHRcdHZhciBjaGlsZERhdGEgPSBbXTtcblxuXHRcdFx0aWYgKGdyb3VwLmhhc1N1Ykdyb3Vwcykge1xuXHRcdFx0XHRjaGlsZERhdGEgPSBzZWxmLnB1bGxHcm91cExpc3REYXRhKGdyb3VwLmdyb3VwTGlzdCk7XG5cblx0XHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSBncm91cC5sZXZlbDtcblx0XHRcdFx0Z3JvdXBIZWFkZXIucm93Q291bnQgPSBjaGlsZERhdGEubGVuZ3RoIC0gZ3JvdXAuZ3JvdXBMaXN0Lmxlbmd0aDsgLy8gZGF0YSBsZW5ndGggbWludXMgbnVtYmVyIG9mIHN1Yi1oZWFkZXJzXG5cdFx0XHRcdGdyb3VwSGVhZGVyLmhlYWRlckNvbnRlbnQgPSBncm91cC5nZW5lcmF0b3IoZ3JvdXAua2V5LCBncm91cEhlYWRlci5yb3dDb3VudCwgZ3JvdXAucm93cywgZ3JvdXApO1xuXG5cdFx0XHRcdGdyb3VwTGlzdERhdGEucHVzaChncm91cEhlYWRlcik7XG5cdFx0XHRcdGdyb3VwTGlzdERhdGEgPSBncm91cExpc3REYXRhLmNvbmNhdChjaGlsZERhdGEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSBncm91cC5sZXZlbDtcblx0XHRcdFx0Z3JvdXBIZWFkZXIuaGVhZGVyQ29udGVudCA9IGdyb3VwLmdlbmVyYXRvcihncm91cC5rZXksIGdyb3VwLnJvd3MubGVuZ3RoLCBncm91cC5yb3dzLCBncm91cCk7XG5cdFx0XHRcdGdyb3VwSGVhZGVyLnJvd0NvdW50ID0gZ3JvdXAuZ2V0Um93cygpLmxlbmd0aDtcblxuXHRcdFx0XHRncm91cExpc3REYXRhLnB1c2goZ3JvdXBIZWFkZXIpO1xuXG5cdFx0XHRcdGdyb3VwLmdldFJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRncm91cExpc3REYXRhLnB1c2gocm93LmdldERhdGEoXCJkYXRhXCIpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZ3JvdXBMaXN0RGF0YTtcblx0fTtcblxuXHRHcm91cFJvd3MucHJvdG90eXBlLmdldEdyb3VwZWREYXRhID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0cmV0dXJuIHRoaXMucHVsbEdyb3VwTGlzdERhdGEodGhpcy5ncm91cExpc3QpO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2V0Um93R3JvdXAgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIG1hdGNoID0gZmFsc2U7XG5cblx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0dmFyIHJlc3VsdCA9IGdyb3VwLmdldFJvd0dyb3VwKHJvdyk7XG5cblx0XHRcdGlmIChyZXN1bHQpIHtcblx0XHRcdFx0bWF0Y2ggPSByZXN1bHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbWF0Y2g7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5jb3VudEdyb3VwcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5ncm91cExpc3QubGVuZ3RoO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuZ2VuZXJhdGVHcm91cHMgPSBmdW5jdGlvbiAocm93cykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb2xkR3JvdXBzID0gc2VsZi5ncm91cHM7XG5cblx0XHRzZWxmLmdyb3VwcyA9IHt9O1xuXHRcdHNlbGYuZ3JvdXBMaXN0ID0gW107XG5cblx0XHRpZiAodGhpcy5hbGxvd2VkVmFsdWVzICYmIHRoaXMuYWxsb3dlZFZhbHVlc1swXSkge1xuXHRcdFx0dGhpcy5hbGxvd2VkVmFsdWVzWzBdLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdHNlbGYuY3JlYXRlR3JvdXAodmFsdWUsIDAsIG9sZEdyb3Vwcyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0c2VsZi5hc3NpZ25Sb3dUb0V4aXN0aW5nR3JvdXAocm93LCBvbGRHcm91cHMpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdHNlbGYuYXNzaWduUm93VG9Hcm91cChyb3csIG9sZEdyb3Vwcyk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5jcmVhdGVHcm91cCA9IGZ1bmN0aW9uIChncm91cElELCBsZXZlbCwgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwS2V5ID0gbGV2ZWwgKyBcIl9cIiArIGdyb3VwSUQsXG5cdFx0ICAgIGdyb3VwO1xuXG5cdFx0b2xkR3JvdXBzID0gb2xkR3JvdXBzIHx8IFtdO1xuXG5cdFx0Z3JvdXAgPSBuZXcgR3JvdXAodGhpcywgZmFsc2UsIGxldmVsLCBncm91cElELCB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZpZWxkLCB0aGlzLmhlYWRlckdlbmVyYXRvclswXSwgb2xkR3JvdXBzW2dyb3VwS2V5XSk7XG5cblx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0gPSBncm91cDtcblx0XHR0aGlzLmdyb3VwTGlzdC5wdXNoKGdyb3VwKTtcblx0fTtcblxuXHQvLyBHcm91cFJvd3MucHJvdG90eXBlLmFzc2lnblJvd1RvR3JvdXAgPSBmdW5jdGlvbihyb3csIG9sZEdyb3Vwcyl7XG5cdC8vIFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdC8vIFx0Z3JvdXBLZXkgPSBcIjBfXCIgKyBncm91cElEO1xuXG5cdC8vIFx0aWYoIXRoaXMuZ3JvdXBzW2dyb3VwS2V5XSl7XG5cdC8vIFx0XHR0aGlzLmNyZWF0ZUdyb3VwKGdyb3VwSUQsIDAsIG9sZEdyb3Vwcyk7XG5cdC8vIFx0fVxuXG5cdC8vIFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHQvLyB9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUuYXNzaWduUm93VG9FeGlzdGluZ0dyb3VwID0gZnVuY3Rpb24gKHJvdywgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdFx0ICAgIGdyb3VwS2V5ID0gXCIwX1wiICsgZ3JvdXBJRDtcblxuXHRcdGlmICh0aGlzLmdyb3Vwc1tncm91cEtleV0pIHtcblx0XHRcdHRoaXMuZ3JvdXBzW2dyb3VwS2V5XS5hZGRSb3cocm93KTtcblx0XHR9XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5hc3NpZ25Sb3dUb0dyb3VwID0gZnVuY3Rpb24gKHJvdywgb2xkR3JvdXBzKSB7XG5cdFx0dmFyIGdyb3VwSUQgPSB0aGlzLmdyb3VwSURMb29rdXBzWzBdLmZ1bmMocm93LmdldERhdGEoKSksXG5cdFx0ICAgIG5ld0dyb3VwTmVlZGVkID0gIXRoaXMuZ3JvdXBzW1wiMF9cIiArIGdyb3VwSURdO1xuXG5cdFx0aWYgKG5ld0dyb3VwTmVlZGVkKSB7XG5cdFx0XHR0aGlzLmNyZWF0ZUdyb3VwKGdyb3VwSUQsIDAsIG9sZEdyb3Vwcyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ncm91cHNbXCIwX1wiICsgZ3JvdXBJRF0uYWRkUm93KHJvdyk7XG5cblx0XHRyZXR1cm4gIW5ld0dyb3VwTmVlZGVkO1xuXHR9O1xuXG5cdEdyb3VwUm93cy5wcm90b3R5cGUudXBkYXRlR3JvdXBSb3dzID0gZnVuY3Rpb24gKGZvcmNlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBvdXRwdXQgPSBbXSxcblx0XHQgICAgb2xkUm93Q291bnQ7XG5cblx0XHRzZWxmLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuXHRcdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdChncm91cC5nZXRIZWFkZXJzQW5kUm93cygpKTtcblx0XHR9KTtcblxuXHRcdC8vZm9yY2UgdXBkYXRlIG9mIHRhYmxlIGRpc3BsYXlcblx0XHRpZiAoZm9yY2UpIHtcblxuXHRcdFx0dmFyIGRpc3BsYXlJbmRleCA9IHNlbGYudGFibGUucm93TWFuYWdlci5zZXREaXNwbGF5Um93cyhvdXRwdXQsIHRoaXMuZ2V0RGlzcGxheUluZGV4KCkpO1xuXG5cdFx0XHRpZiAoZGlzcGxheUluZGV4ICE9PSB0cnVlKSB7XG5cdFx0XHRcdHRoaXMuc2V0RGlzcGxheUluZGV4KGRpc3BsYXlJbmRleCk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5yZWZyZXNoQWN0aXZlRGF0YShcImdyb3VwXCIsIHRydWUsIHRydWUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5zY3JvbGxIZWFkZXJzID0gZnVuY3Rpb24gKGxlZnQpIHtcblx0XHRsZWZ0ID0gbGVmdCArIFwicHhcIjtcblxuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7XG5cdFx0XHRncm91cC5zY3JvbGxIZWFkZXIobGVmdCk7XG5cdFx0fSk7XG5cdH07XG5cblx0R3JvdXBSb3dzLnByb3RvdHlwZS5yZW1vdmVHcm91cCA9IGZ1bmN0aW9uIChncm91cCkge1xuXHRcdHZhciBncm91cEtleSA9IGdyb3VwLmxldmVsICsgXCJfXCIgKyBncm91cC5rZXksXG5cdFx0ICAgIGluZGV4O1xuXG5cdFx0aWYgKHRoaXMuZ3JvdXBzW2dyb3VwS2V5XSkge1xuXHRcdFx0ZGVsZXRlIHRoaXMuZ3JvdXBzW2dyb3VwS2V5XTtcblxuXHRcdFx0aW5kZXggPSB0aGlzLmdyb3VwTGlzdC5pbmRleE9mKGdyb3VwKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0dGhpcy5ncm91cExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcImdyb3VwUm93c1wiLCBHcm91cFJvd3MpO1xuXHR2YXIgSGlzdG9yeSA9IGZ1bmN0aW9uIEhpc3RvcnkodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cblx0XHR0aGlzLmhpc3RvcnkgPSBbXTtcblx0XHR0aGlzLmluZGV4ID0gLTE7XG5cdH07XG5cblx0SGlzdG9yeS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5oaXN0b3J5ID0gW107XG5cdFx0dGhpcy5pbmRleCA9IC0xO1xuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLmFjdGlvbiA9IGZ1bmN0aW9uICh0eXBlLCBjb21wb25lbnQsIGRhdGEpIHtcblxuXHRcdHRoaXMuaGlzdG9yeSA9IHRoaXMuaGlzdG9yeS5zbGljZSgwLCB0aGlzLmluZGV4ICsgMSk7XG5cblx0XHR0aGlzLmhpc3RvcnkucHVzaCh7XG5cdFx0XHR0eXBlOiB0eXBlLFxuXHRcdFx0Y29tcG9uZW50OiBjb21wb25lbnQsXG5cdFx0XHRkYXRhOiBkYXRhXG5cdFx0fSk7XG5cblx0XHR0aGlzLmluZGV4Kys7XG5cdH07XG5cblx0SGlzdG9yeS5wcm90b3R5cGUuZ2V0SGlzdG9yeVVuZG9TaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmluZGV4ICsgMTtcblx0fTtcblxuXHRIaXN0b3J5LnByb3RvdHlwZS5nZXRIaXN0b3J5UmVkb1NpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuaGlzdG9yeS5sZW5ndGggLSAodGhpcy5pbmRleCArIDEpO1xuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnVuZG8gPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRpZiAodGhpcy5pbmRleCA+IC0xKSB7XG5cdFx0XHR2YXIgYWN0aW9uID0gdGhpcy5oaXN0b3J5W3RoaXMuaW5kZXhdO1xuXG5cdFx0XHR0aGlzLnVuZG9lcnNbYWN0aW9uLnR5cGVdLmNhbGwodGhpcywgYWN0aW9uKTtcblxuXHRcdFx0dGhpcy5pbmRleC0tO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeVVuZG8uY2FsbCh0aGlzLnRhYmxlLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSGlzdG9yeSBVbmRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHVuZG9cIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnJlZG8gPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMuaGlzdG9yeS5sZW5ndGggLSAxID4gdGhpcy5pbmRleCkge1xuXG5cdFx0XHR0aGlzLmluZGV4Kys7XG5cblx0XHRcdHZhciBhY3Rpb24gPSB0aGlzLmhpc3RvcnlbdGhpcy5pbmRleF07XG5cblx0XHRcdHRoaXMucmVkb2Vyc1thY3Rpb24udHlwZV0uY2FsbCh0aGlzLCBhY3Rpb24pO1xuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeVJlZG8uY2FsbCh0aGlzLnRhYmxlLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSGlzdG9yeSBSZWRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHJlZG9cIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnVuZG9lcnMgPSB7XG5cdFx0Y2VsbEVkaXQ6IGZ1bmN0aW9uIGNlbGxFZGl0KGFjdGlvbikge1xuXHRcdFx0YWN0aW9uLmNvbXBvbmVudC5zZXRWYWx1ZVByb2Nlc3NEYXRhKGFjdGlvbi5kYXRhLm9sZFZhbHVlKTtcblx0XHR9LFxuXG5cdFx0cm93QWRkOiBmdW5jdGlvbiByb3dBZGQoYWN0aW9uKSB7XG5cdFx0XHRhY3Rpb24uY29tcG9uZW50LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdH0sXG5cblx0XHRyb3dEZWxldGU6IGZ1bmN0aW9uIHJvd0RlbGV0ZShhY3Rpb24pIHtcblx0XHRcdHZhciBuZXdSb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRkUm93QWN0dWFsKGFjdGlvbi5kYXRhLmRhdGEsIGFjdGlvbi5kYXRhLnBvcywgYWN0aW9uLmRhdGEuaW5kZXgpO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJncm91cFJvd3NcIikpIHtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3JlYmluZFJvdyhhY3Rpb24uY29tcG9uZW50LCBuZXdSb3cpO1xuXHRcdH0sXG5cblx0XHRyb3dNb3ZlOiBmdW5jdGlvbiByb3dNb3ZlKGFjdGlvbikge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwoYWN0aW9uLmNvbXBvbmVudCwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3NbYWN0aW9uLmRhdGEucG9zRnJvbV0sICFhY3Rpb24uZGF0YS5hZnRlcik7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVkcmF3KCk7XG5cdFx0fVxuXHR9O1xuXG5cdEhpc3RvcnkucHJvdG90eXBlLnJlZG9lcnMgPSB7XG5cdFx0Y2VsbEVkaXQ6IGZ1bmN0aW9uIGNlbGxFZGl0KGFjdGlvbikge1xuXHRcdFx0YWN0aW9uLmNvbXBvbmVudC5zZXRWYWx1ZVByb2Nlc3NEYXRhKGFjdGlvbi5kYXRhLm5ld1ZhbHVlKTtcblx0XHR9LFxuXG5cdFx0cm93QWRkOiBmdW5jdGlvbiByb3dBZGQoYWN0aW9uKSB7XG5cdFx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhY3Rpb24uZGF0YS5kYXRhLCBhY3Rpb24uZGF0YS5wb3MsIGFjdGlvbi5kYXRhLmluZGV4KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKSB7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLl9yZWJpbmRSb3coYWN0aW9uLmNvbXBvbmVudCwgbmV3Um93KTtcblx0XHR9LFxuXG5cdFx0cm93RGVsZXRlOiBmdW5jdGlvbiByb3dEZWxldGUoYWN0aW9uKSB7XG5cdFx0XHRhY3Rpb24uY29tcG9uZW50LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdH0sXG5cblx0XHRyb3dNb3ZlOiBmdW5jdGlvbiByb3dNb3ZlKGFjdGlvbikge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwoYWN0aW9uLmNvbXBvbmVudCwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3NbYWN0aW9uLmRhdGEucG9zVG9dLCBhY3Rpb24uZGF0YS5hZnRlcik7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVkcmF3KCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vcmViaW5kIHJvd3MgdG8gbmV3IGVsZW1lbnQgYWZ0ZXIgZGVsZXRpb25cblx0SGlzdG9yeS5wcm90b3R5cGUuX3JlYmluZFJvdyA9IGZ1bmN0aW9uIChvbGRSb3csIG5ld1Jvdykge1xuXHRcdHRoaXMuaGlzdG9yeS5mb3JFYWNoKGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50IGluc3RhbmNlb2YgUm93KSB7XG5cdFx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50ID09PSBvbGRSb3cpIHtcblx0XHRcdFx0XHRhY3Rpb24uY29tcG9uZW50ID0gbmV3Um93O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGFjdGlvbi5jb21wb25lbnQgaW5zdGFuY2VvZiBDZWxsKSB7XG5cdFx0XHRcdGlmIChhY3Rpb24uY29tcG9uZW50LnJvdyA9PT0gb2xkUm93KSB7XG5cdFx0XHRcdFx0dmFyIGZpZWxkID0gYWN0aW9uLmNvbXBvbmVudC5jb2x1bW4uZ2V0RmllbGQoKTtcblxuXHRcdFx0XHRcdGlmIChmaWVsZCkge1xuXHRcdFx0XHRcdFx0YWN0aW9uLmNvbXBvbmVudCA9IG5ld1Jvdy5nZXRDZWxsKGZpZWxkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwiaGlzdG9yeVwiLCBIaXN0b3J5KTtcblx0dmFyIEh0bWxUYWJsZUltcG9ydCA9IGZ1bmN0aW9uIEh0bWxUYWJsZUltcG9ydCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmZpZWxkSW5kZXggPSBbXTtcblx0XHR0aGlzLmhhc0luZGV4ID0gZmFsc2U7XG5cdH07XG5cblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5wYXJzZVRhYmxlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgZWxlbWVudCA9IHNlbGYudGFibGUuZWxlbWVudCxcblx0XHQgICAgb3B0aW9ucyA9IHNlbGYudGFibGUub3B0aW9ucyxcblx0XHQgICAgY29sdW1ucyA9IG9wdGlvbnMuY29sdW1ucyxcblx0XHQgICAgaGVhZGVycyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0aFwiKSxcblx0XHQgICAgcm93cyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXSxcblx0XHQgICAgZGF0YSA9IFtdLFxuXHRcdCAgICBuZXdUYWJsZTtcblxuXHRcdHNlbGYuaGFzSW5kZXggPSBmYWxzZTtcblxuXHRcdHNlbGYudGFibGUub3B0aW9ucy5odG1sSW1wb3J0aW5nLmNhbGwodGhpcy50YWJsZSk7XG5cblx0XHRyb3dzID0gcm93cyA/IHJvd3MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0clwiKSA6IFtdO1xuXG5cdFx0Ly9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRzZWxmLl9leHRyYWN0T3B0aW9ucyhlbGVtZW50LCBvcHRpb25zKTtcblxuXHRcdGlmIChoZWFkZXJzLmxlbmd0aCkge1xuXHRcdFx0c2VsZi5fZXh0cmFjdEhlYWRlcnMoaGVhZGVycywgcm93cyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuX2dlbmVyYXRlQmxhbmtIZWFkZXJzKGhlYWRlcnMsIHJvd3MpO1xuXHRcdH1cblxuXHRcdC8vaXRlcmF0ZSB0aHJvdWdoIHRhYmxlIHJvd3MgYW5kIGJ1aWxkIGRhdGEgc2V0XG5cdFx0Zm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJvd3MubGVuZ3RoOyBpbmRleCsrKSB7XG5cdFx0XHR2YXIgcm93ID0gcm93c1tpbmRleF0sXG5cdFx0XHQgICAgY2VsbHMgPSByb3cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0ZFwiKSxcblx0XHRcdCAgICBpdGVtID0ge307XG5cblx0XHRcdC8vY3JlYXRlIGluZGV4IGlmIHRoZSBkb250IGV4aXN0IGluIHRhYmxlXG5cdFx0XHRpZiAoIXNlbGYuaGFzSW5kZXgpIHtcblx0XHRcdFx0aXRlbVtvcHRpb25zLmluZGV4XSA9IGluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNlbGxzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHZhciBjZWxsID0gY2VsbHNbaV07XG5cdFx0XHRcdGlmICh0eXBlb2YgdGhpcy5maWVsZEluZGV4W2ldICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0aXRlbVt0aGlzLmZpZWxkSW5kZXhbaV1dID0gY2VsbC5pbm5lckhUTUw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9hZGQgcm93IGRhdGEgdG8gaXRlbVxuXHRcdFx0ZGF0YS5wdXNoKGl0ZW0pO1xuXHRcdH1cblxuXHRcdC8vY3JlYXRlIG5ldyBlbGVtZW50XG5cdFx0dmFyIG5ld0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0Ly90cmFuc2ZlciBhdHRyaWJ1dGVzIHRvIG5ldyBlbGVtZW50XG5cdFx0dmFyIGF0dHJpYnV0ZXMgPSBlbGVtZW50LmF0dHJpYnV0ZXM7XG5cblx0XHQvLyBsb29wIHRocm91Z2ggYXR0cmlidXRlcyBhbmQgYXBwbHkgdGhlbSBvbiBkaXZcblxuXHRcdGZvciAodmFyIGkgaW4gYXR0cmlidXRlcykge1xuXHRcdFx0aWYgKF90eXBlb2YoYXR0cmlidXRlc1tpXSkgPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVzW2ldLm5hbWUsIGF0dHJpYnV0ZXNbaV0udmFsdWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIHJlcGxhY2UgdGFibGUgd2l0aCBkaXYgZWxlbWVudFxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3RWxlbWVudCwgZWxlbWVudCk7XG5cblx0XHRvcHRpb25zLmRhdGEgPSBkYXRhO1xuXG5cdFx0c2VsZi50YWJsZS5vcHRpb25zLmh0bWxJbXBvcnRlZC5jYWxsKHRoaXMudGFibGUpO1xuXG5cdFx0Ly8gLy8gbmV3RWxlbWVudC50YWJ1bGF0b3Iob3B0aW9ucyk7XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQgPSBuZXdFbGVtZW50O1xuXHR9O1xuXG5cdC8vZXh0cmFjdCB0YWJ1bGF0b3IgYXR0cmlidXRlIG9wdGlvbnNcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZXh0cmFjdE9wdGlvbnMgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgZGVmYXVsdE9wdGlvbnMpIHtcblx0XHR2YXIgYXR0cmlidXRlcyA9IGVsZW1lbnQuYXR0cmlidXRlcztcblx0XHR2YXIgb3B0aW9uc0FyciA9IGRlZmF1bHRPcHRpb25zID8gT2JqZWN0LmFzc2lnbihbXSwgZGVmYXVsdE9wdGlvbnMpIDogT2JqZWN0LmtleXMob3B0aW9ucyk7XG5cdFx0dmFyIG9wdGlvbnNMaXN0ID0ge307XG5cblx0XHRvcHRpb25zQXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdG9wdGlvbnNMaXN0W2l0ZW0udG9Mb3dlckNhc2UoKV0gPSBpdGVtO1xuXHRcdH0pO1xuXG5cdFx0Zm9yICh2YXIgaW5kZXggaW4gYXR0cmlidXRlcykge1xuXHRcdFx0dmFyIGF0dHJpYiA9IGF0dHJpYnV0ZXNbaW5kZXhdO1xuXHRcdFx0dmFyIG5hbWU7XG5cblx0XHRcdGlmIChhdHRyaWIgJiYgKHR5cGVvZiBhdHRyaWIgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGF0dHJpYikpID09IFwib2JqZWN0XCIgJiYgYXR0cmliLm5hbWUgJiYgYXR0cmliLm5hbWUuaW5kZXhPZihcInRhYnVsYXRvci1cIikgPT09IDApIHtcblx0XHRcdFx0bmFtZSA9IGF0dHJpYi5uYW1lLnJlcGxhY2UoXCJ0YWJ1bGF0b3ItXCIsIFwiXCIpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uc0xpc3RbbmFtZV0gIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRvcHRpb25zW29wdGlvbnNMaXN0W25hbWVdXSA9IHRoaXMuX2F0dHJpYlZhbHVlKGF0dHJpYi52YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9nZXQgdmFsdWUgb2YgYXR0cmlidXRlXG5cdEh0bWxUYWJsZUltcG9ydC5wcm90b3R5cGUuX2F0dHJpYlZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0aWYgKHZhbHVlID09PSBcInRydWVcIikge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHZhbHVlID09PSBcImZhbHNlXCIpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWU7XG5cdH07XG5cblx0Ly9maW5kIGNvbHVtbiBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWRcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZmluZENvbCA9IGZ1bmN0aW9uICh0aXRsZSkge1xuXHRcdHZhciBtYXRjaCA9IHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0cmV0dXJuIGNvbHVtbi50aXRsZSA9PT0gdGl0bGU7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdH07XG5cblx0Ly9leHRyYWN0IGNvbHVtbiBmcm9tIGhlYWRlcnNcblx0SHRtbFRhYmxlSW1wb3J0LnByb3RvdHlwZS5fZXh0cmFjdEhlYWRlcnMgPSBmdW5jdGlvbiAoaGVhZGVycywgcm93cykge1xuXHRcdGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBoZWFkZXJzLmxlbmd0aDsgaW5kZXgrKykge1xuXHRcdFx0dmFyIGhlYWRlciA9IGhlYWRlcnNbaW5kZXhdLFxuXHRcdFx0ICAgIGV4aXN0cyA9IGZhbHNlLFxuXHRcdFx0ICAgIGNvbCA9IHRoaXMuX2ZpbmRDb2woaGVhZGVyLnRleHRDb250ZW50KSxcblx0XHRcdCAgICB3aWR0aCxcblx0XHRcdCAgICBhdHRyaWJ1dGVzO1xuXG5cdFx0XHRpZiAoY29sKSB7XG5cdFx0XHRcdGV4aXN0cyA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb2wgPSB7IHRpdGxlOiBoZWFkZXIudGV4dENvbnRlbnQudHJpbSgpIH07XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY29sLmZpZWxkKSB7XG5cdFx0XHRcdGNvbC5maWVsZCA9IGhlYWRlci50ZXh0Q29udGVudC50cmltKCkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKFwiIFwiLCBcIl9cIik7XG5cdFx0XHR9XG5cblx0XHRcdHdpZHRoID0gaGVhZGVyLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuXG5cdFx0XHRpZiAod2lkdGggJiYgIWNvbC53aWR0aCkge1xuXHRcdFx0XHRjb2wud2lkdGggPSB3aWR0aDtcblx0XHRcdH1cblxuXHRcdFx0Ly9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRcdGF0dHJpYnV0ZXMgPSBoZWFkZXIuYXR0cmlidXRlcztcblxuXHRcdFx0Ly8gLy9jaGVjayBmb3IgdGFibGF0b3IgaW5saW5lIG9wdGlvbnNcblx0XHRcdHRoaXMuX2V4dHJhY3RPcHRpb25zKGhlYWRlciwgY29sLCBDb2x1bW4ucHJvdG90eXBlLmRlZmF1bHRPcHRpb25MaXN0KTtcblxuXHRcdFx0dGhpcy5maWVsZEluZGV4W2luZGV4XSA9IGNvbC5maWVsZDtcblxuXHRcdFx0aWYgKGNvbC5maWVsZCA9PSB0aGlzLnRhYmxlLm9wdGlvbnMuaW5kZXgpIHtcblx0XHRcdFx0dGhpcy5oYXNJbmRleCA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghZXhpc3RzKSB7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLnB1c2goY29sKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSBibGFuayBoZWFkZXJzXG5cdEh0bWxUYWJsZUltcG9ydC5wcm90b3R5cGUuX2dlbmVyYXRlQmxhbmtIZWFkZXJzID0gZnVuY3Rpb24gKGhlYWRlcnMsIHJvd3MpIHtcblx0XHRmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgaGVhZGVycy5sZW5ndGg7IGluZGV4KyspIHtcblx0XHRcdHZhciBoZWFkZXIgPSBoZWFkZXJzW2luZGV4XSxcblx0XHRcdCAgICBjb2wgPSB7IHRpdGxlOiBcIlwiLCBmaWVsZDogXCJjb2xcIiArIGluZGV4IH07XG5cblx0XHRcdHRoaXMuZmllbGRJbmRleFtpbmRleF0gPSBjb2wuZmllbGQ7XG5cblx0XHRcdHZhciB3aWR0aCA9IGhlYWRlci5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcblxuXHRcdFx0aWYgKHdpZHRoKSB7XG5cdFx0XHRcdGNvbC53aWR0aCA9IHdpZHRoO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucy5wdXNoKGNvbCk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJodG1sVGFibGVJbXBvcnRcIiwgSHRtbFRhYmxlSW1wb3J0KTtcblx0dmFyIEtleWJpbmRpbmdzID0gZnVuY3Rpb24gS2V5YmluZGluZ3ModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy53YXRjaEtleXMgPSBudWxsO1xuXHRcdHRoaXMucHJlc3NlZEtleXMgPSBudWxsO1xuXHRcdHRoaXMua2V5dXBCaW5kaW5nID0gZmFsc2U7XG5cdFx0dGhpcy5rZXlkb3duQmluZGluZyA9IGZhbHNlO1xuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBiaW5kaW5ncyA9IHRoaXMudGFibGUub3B0aW9ucy5rZXliaW5kaW5ncyxcblx0XHQgICAgbWVyZ2VkQmluZGluZ3MgPSB7fTtcblxuXHRcdHRoaXMud2F0Y2hLZXlzID0ge307XG5cdFx0dGhpcy5wcmVzc2VkS2V5cyA9IFtdO1xuXG5cdFx0aWYgKGJpbmRpbmdzICE9PSBmYWxzZSkge1xuXG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gdGhpcy5iaW5kaW5ncykge1xuXHRcdFx0XHRtZXJnZWRCaW5kaW5nc1trZXldID0gdGhpcy5iaW5kaW5nc1trZXldO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoT2JqZWN0LmtleXMoYmluZGluZ3MpLmxlbmd0aCkge1xuXG5cdFx0XHRcdGZvciAodmFyIF9rZXkgaW4gYmluZGluZ3MpIHtcblx0XHRcdFx0XHRtZXJnZWRCaW5kaW5nc1tfa2V5XSA9IGJpbmRpbmdzW19rZXldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMubWFwQmluZGluZ3MobWVyZ2VkQmluZGluZ3MpO1xuXHRcdFx0dGhpcy5iaW5kRXZlbnRzKCk7XG5cdFx0fVxuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5tYXBCaW5kaW5ncyA9IGZ1bmN0aW9uIChiaW5kaW5ncykge1xuXHRcdHZhciBfdGhpczU3ID0gdGhpcztcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoa2V5KSB7XG5cblx0XHRcdGlmIChfdGhpczU3LmFjdGlvbnNba2V5XSkge1xuXG5cdFx0XHRcdGlmIChiaW5kaW5nc1trZXldKSB7XG5cblx0XHRcdFx0XHRpZiAoX3R5cGVvZihiaW5kaW5nc1trZXldKSAhPT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRcdFx0YmluZGluZ3Nba2V5XSA9IFtiaW5kaW5nc1trZXldXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRiaW5kaW5nc1trZXldLmZvckVhY2goZnVuY3Rpb24gKGJpbmRpbmcpIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwQmluZGluZyhrZXksIGJpbmRpbmcpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJLZXkgQmluZGluZyBFcnJvciAtIG5vIHN1Y2ggYWN0aW9uOlwiLCBrZXkpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gYmluZGluZ3MpIHtcblx0XHRcdF9sb29wMihrZXkpO1xuXHRcdH1cblx0fTtcblxuXHRLZXliaW5kaW5ncy5wcm90b3R5cGUubWFwQmluZGluZyA9IGZ1bmN0aW9uIChhY3Rpb24sIHN5bWJvbHNMaXN0KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIGJpbmRpbmcgPSB7XG5cdFx0XHRhY3Rpb246IHRoaXMuYWN0aW9uc1thY3Rpb25dLFxuXHRcdFx0a2V5czogW10sXG5cdFx0XHRjdHJsOiBmYWxzZSxcblx0XHRcdHNoaWZ0OiBmYWxzZSxcblx0XHRcdG1ldGE6IGZhbHNlXG5cdFx0fTtcblxuXHRcdHZhciBzeW1ib2xzID0gc3ltYm9sc0xpc3QudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiIFwiKS5qb2luKFwiXCIpLnNwbGl0KFwiK1wiKTtcblxuXHRcdHN5bWJvbHMuZm9yRWFjaChmdW5jdGlvbiAoc3ltYm9sKSB7XG5cdFx0XHRzd2l0Y2ggKHN5bWJvbCkge1xuXHRcdFx0XHRjYXNlIFwiY3RybFwiOlxuXHRcdFx0XHRcdGJpbmRpbmcuY3RybCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInNoaWZ0XCI6XG5cdFx0XHRcdFx0YmluZGluZy5zaGlmdCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcIm1ldGFcIjpcblx0XHRcdFx0XHRiaW5kaW5nLm1ldGEgPSB0cnVlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0c3ltYm9sID0gcGFyc2VJbnQoc3ltYm9sKTtcblx0XHRcdFx0XHRiaW5kaW5nLmtleXMucHVzaChzeW1ib2wpO1xuXG5cdFx0XHRcdFx0aWYgKCFzZWxmLndhdGNoS2V5c1tzeW1ib2xdKSB7XG5cdFx0XHRcdFx0XHRzZWxmLndhdGNoS2V5c1tzeW1ib2xdID0gW107XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi53YXRjaEtleXNbc3ltYm9sXS5wdXNoKGJpbmRpbmcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5iaW5kRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHRoaXMua2V5dXBCaW5kaW5nID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBjb2RlID0gZS5rZXlDb2RlO1xuXHRcdFx0dmFyIGJpbmRpbmdzID0gc2VsZi53YXRjaEtleXNbY29kZV07XG5cblx0XHRcdGlmIChiaW5kaW5ncykge1xuXG5cdFx0XHRcdHNlbGYucHJlc3NlZEtleXMucHVzaChjb2RlKTtcblxuXHRcdFx0XHRiaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7XG5cdFx0XHRcdFx0c2VsZi5jaGVja0JpbmRpbmcoZSwgYmluZGluZyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLmtleWRvd25CaW5kaW5nID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBjb2RlID0gZS5rZXlDb2RlO1xuXHRcdFx0dmFyIGJpbmRpbmdzID0gc2VsZi53YXRjaEtleXNbY29kZV07XG5cblx0XHRcdGlmIChiaW5kaW5ncykge1xuXG5cdFx0XHRcdHZhciBpbmRleCA9IHNlbGYucHJlc3NlZEtleXMuaW5kZXhPZihjb2RlKTtcblxuXHRcdFx0XHRpZiAoaW5kZXggPiAtMSkge1xuXHRcdFx0XHRcdHNlbGYucHJlc3NlZEtleXMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5rZXl1cEJpbmRpbmcpO1xuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmtleWRvd25CaW5kaW5nKTtcblx0fTtcblxuXHRLZXliaW5kaW5ncy5wcm90b3R5cGUuY2xlYXJCaW5kaW5ncyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5rZXl1cEJpbmRpbmcpIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmtleXVwQmluZGluZyk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMua2V5ZG93bkJpbmRpbmcpIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5rZXlkb3duQmluZGluZyk7XG5cdFx0fVxuXHR9O1xuXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5jaGVja0JpbmRpbmcgPSBmdW5jdGlvbiAoZSwgYmluZGluZykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbWF0Y2ggPSB0cnVlO1xuXG5cdFx0aWYgKGUuY3RybEtleSA9PSBiaW5kaW5nLmN0cmwgJiYgZS5zaGlmdEtleSA9PSBiaW5kaW5nLnNoaWZ0ICYmIGUubWV0YUtleSA9PSBiaW5kaW5nLm1ldGEpIHtcblx0XHRcdGJpbmRpbmcua2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdFx0dmFyIGluZGV4ID0gc2VsZi5wcmVzc2VkS2V5cy5pbmRleE9mKGtleSk7XG5cblx0XHRcdFx0aWYgKGluZGV4ID09IC0xKSB7XG5cdFx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChtYXRjaCkge1xuXHRcdFx0XHRiaW5kaW5nLmFjdGlvbi5jYWxsKHNlbGYsIGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0Ly9kZWZhdWx0IGJpbmRpbmdzXG5cdEtleWJpbmRpbmdzLnByb3RvdHlwZS5iaW5kaW5ncyA9IHtcblx0XHRuYXZQcmV2OiBcInNoaWZ0ICsgOVwiLFxuXHRcdG5hdk5leHQ6IDksXG5cdFx0bmF2VXA6IDM4LFxuXHRcdG5hdkRvd246IDQwLFxuXHRcdHNjcm9sbFBhZ2VVcDogMzMsXG5cdFx0c2Nyb2xsUGFnZURvd246IDM0LFxuXHRcdHNjcm9sbFRvU3RhcnQ6IDM2LFxuXHRcdHNjcm9sbFRvRW5kOiAzNSxcblx0XHR1bmRvOiBcImN0cmwgKyA5MFwiLFxuXHRcdHJlZG86IFwiY3RybCArIDg5XCIsXG5cdFx0Y29weVRvQ2xpcGJvYXJkOiBcImN0cmwgKyA2N1wiXG5cdH07XG5cblx0Ly9kZWZhdWx0IGFjdGlvbnNcblx0S2V5YmluZGluZ3MucHJvdG90eXBlLmFjdGlvbnMgPSB7XG5cdFx0a2V5QmxvY2s6IGZ1bmN0aW9uIGtleUJsb2NrKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSxcblx0XHRzY3JvbGxQYWdlVXA6IGZ1bmN0aW9uIHNjcm9sbFBhZ2VVcChlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRcdCAgICBuZXdQb3MgPSByb3dNYW5hZ2VyLnNjcm9sbFRvcCAtIHJvd01hbmFnZXIuaGVpZ2h0LFxuXHRcdFx0ICAgIHNjcm9sbE1heCA9IHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRpZiAobmV3UG9zID49IDApIHtcblx0XHRcdFx0XHRyb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsVG9wID0gbmV3UG9zO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpWzBdKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuZm9jdXMoKTtcblx0XHR9LFxuXHRcdHNjcm9sbFBhZ2VEb3duOiBmdW5jdGlvbiBzY3JvbGxQYWdlRG93bihlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRcdCAgICBuZXdQb3MgPSByb3dNYW5hZ2VyLnNjcm9sbFRvcCArIHJvd01hbmFnZXIuaGVpZ2h0LFxuXHRcdFx0ICAgIHNjcm9sbE1heCA9IHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRpZiAobmV3UG9zIDw9IHNjcm9sbE1heCkge1xuXHRcdFx0XHRcdHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPSBuZXdQb3M7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cm93TWFuYWdlci5zY3JvbGxUb1Jvdyhyb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKClbcm93TWFuYWdlci5kaXNwbGF5Um93c0NvdW50IC0gMV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5mb2N1cygpO1xuXHRcdH0sXG5cdFx0c2Nyb2xsVG9TdGFydDogZnVuY3Rpb24gc2Nyb2xsVG9TdGFydChlKSB7XG5cdFx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcjtcblxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAocm93TWFuYWdlci5kaXNwbGF5Um93c0NvdW50KSB7XG5cdFx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpWzBdKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmZvY3VzKCk7XG5cdFx0fSxcblx0XHRzY3JvbGxUb0VuZDogZnVuY3Rpb24gc2Nyb2xsVG9FbmQoZSkge1xuXHRcdFx0dmFyIHJvd01hbmFnZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXI7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKHJvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCkge1xuXHRcdFx0XHRyb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKVtyb3dNYW5hZ2VyLmRpc3BsYXlSb3dzQ291bnQgLSAxXSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5mb2N1cygpO1xuXHRcdH0sXG5cdFx0bmF2UHJldjogZnVuY3Rpb24gbmF2UHJldihlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjZWxsLm5hdigpLnByZXYoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRuYXZOZXh0OiBmdW5jdGlvbiBuYXZOZXh0KGUpIHtcblx0XHRcdHZhciBjZWxsID0gZmFsc2U7XG5cdFx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5vcHRpb25zLnRhYkVuZE5ld1Jvdztcblx0XHRcdHZhciBuYXY7XG5cblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpIHtcblx0XHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRcdGlmIChjZWxsKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0bmF2ID0gY2VsbC5uYXYoKTtcblxuXHRcdFx0XHRcdGlmICghbmF2Lm5leHQoKSkge1xuXHRcdFx0XHRcdFx0aWYgKG5ld1Jvdykge1xuXG5cdFx0XHRcdFx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmZpcnN0Q2hpbGQuYmx1cigpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChuZXdSb3cgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyh7fSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBuZXdSb3cgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyhuZXdSb3coY2VsbC5yb3cuZ2V0Q29tcG9uZW50KCkpKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0bmV3Um93ID0gdGhpcy50YWJsZS5hZGRSb3cobmV3Um93KTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRuZXdSb3cudGhlbihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRuYXYubmV4dCgpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bmF2TGVmdDogZnVuY3Rpb24gbmF2TGVmdChlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjZWxsLm5hdigpLmxlZnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRuYXZSaWdodDogZnVuY3Rpb24gbmF2UmlnaHQoZSkge1xuXHRcdFx0dmFyIGNlbGwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXHRcdFx0XHRjZWxsID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGw7XG5cblx0XHRcdFx0aWYgKGNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0Y2VsbC5uYXYoKS5yaWdodCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdG5hdlVwOiBmdW5jdGlvbiBuYXZVcChlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjZWxsLm5hdigpLnVwKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bmF2RG93bjogZnVuY3Rpb24gbmF2RG93bihlKSB7XG5cdFx0XHR2YXIgY2VsbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjZWxsLm5hdigpLmRvd24oKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHR1bmRvOiBmdW5jdGlvbiB1bmRvKGUpIHtcblx0XHRcdHZhciBjZWxsID0gZmFsc2U7XG5cdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmhpc3RvcnkgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJoaXN0b3J5XCIpICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSkge1xuXG5cdFx0XHRcdGNlbGwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbDtcblxuXHRcdFx0XHRpZiAoIWNlbGwpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmhpc3RvcnkudW5kbygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdHJlZG86IGZ1bmN0aW9uIHJlZG8oZSkge1xuXHRcdFx0dmFyIGNlbGwgPSBmYWxzZTtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImhpc3RvcnlcIikgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKSB7XG5cblx0XHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xuXG5cdFx0XHRcdGlmICghY2VsbCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuaGlzdG9yeS5yZWRvKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Y29weVRvQ2xpcGJvYXJkOiBmdW5jdGlvbiBjb3B5VG9DbGlwYm9hcmQoZSkge1xuXHRcdFx0aWYgKCF0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkge1xuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjbGlwYm9hcmRcIiwgdHJ1ZSkpIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY2xpcGJvYXJkLmNvcHkoZmFsc2UsIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJrZXliaW5kaW5nc1wiLCBLZXliaW5kaW5ncyk7XG5cdHZhciBNZW51ID0gZnVuY3Rpb24gTWVudSh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLm1lbnVFbCA9IGZhbHNlO1xuXHRcdHRoaXMuYmx1ckV2ZW50ID0gdGhpcy5oaWRlTWVudS5iaW5kKHRoaXMpO1xuXHR9O1xuXG5cdE1lbnUucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW5IZWFkZXIgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIF90aGlzNTggPSB0aGlzO1xuXG5cdFx0dmFyIGhlYWRlck1lbnVFbDtcblxuXHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJDb250ZXh0TWVudSkge1xuXHRcdFx0Y29sdW1uLmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyQ29udGV4dE1lbnUgPT0gXCJmdW5jdGlvblwiID8gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyQ29udGV4dE1lbnUoKSA6IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckNvbnRleHRNZW51O1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRfdGhpczU4LmxvYWRNZW51KGUsIGNvbHVtbiwgbWVudSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudSkge1xuXG5cdFx0XHRoZWFkZXJNZW51RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHRcdGhlYWRlck1lbnVFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWhlYWRlci1tZW51LWJ1dHRvblwiKTtcblx0XHRcdGhlYWRlck1lbnVFbC5pbm5lckhUTUwgPSBcIiZ2ZWxsaXA7XCI7XG5cblx0XHRcdGhlYWRlck1lbnVFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudSA9PSBcImZ1bmN0aW9uXCIgPyBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJNZW51KCkgOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJNZW51O1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0X3RoaXM1OC5sb2FkTWVudShlLCBjb2x1bW4sIG1lbnUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGNvbHVtbi50aXRsZUVsZW1lbnQuaW5zZXJ0QmVmb3JlKGhlYWRlck1lbnVFbCwgY29sdW1uLnRpdGxlRWxlbWVudC5maXJzdENoaWxkKTtcblx0XHR9XG5cdH07XG5cblx0TWVudS5wcm90b3R5cGUuaW5pdGlhbGl6ZUNlbGwgPSBmdW5jdGlvbiAoY2VsbCkge1xuXHRcdHZhciBfdGhpczU5ID0gdGhpcztcblxuXHRcdGNlbGwuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgY2VsbC5jb2x1bW4uZGVmaW5pdGlvbi5jb250ZXh0TWVudSA9PSBcImZ1bmN0aW9uXCIgPyBjZWxsLmNvbHVtbi5kZWZpbml0aW9uLmNvbnRleHRNZW51KCkgOiBjZWxsLmNvbHVtbi5kZWZpbml0aW9uLmNvbnRleHRNZW51O1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdF90aGlzNTkubG9hZE1lbnUoZSwgY2VsbCwgbWVudSk7XG5cdFx0fSk7XG5cdH07XG5cblx0TWVudS5wcm90b3R5cGUuaW5pdGlhbGl6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgX3RoaXM2MCA9IHRoaXM7XG5cblx0XHRyb3cuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIG1lbnUgPSB0eXBlb2YgX3RoaXM2MC50YWJsZS5vcHRpb25zLnJvd0NvbnRleHRNZW51ID09IFwiZnVuY3Rpb25cIiA/IF90aGlzNjAudGFibGUub3B0aW9ucy5yb3dDb250ZXh0TWVudSgpIDogX3RoaXM2MC50YWJsZS5vcHRpb25zLnJvd0NvbnRleHRNZW51O1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdF90aGlzNjAubG9hZE1lbnUoZSwgcm93LCBtZW51KTtcblx0XHR9KTtcblx0fTtcblxuXHRNZW51LnByb3RvdHlwZS5sb2FkTWVudSA9IGZ1bmN0aW9uIChlLCBjb21wb25lbnQsIG1lbnUpIHtcblx0XHR2YXIgX3RoaXM2MSA9IHRoaXM7XG5cblx0XHR2YXIgZG9jSGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQ7XG5cblx0XHQvL2Fib3J0IGlmIG5vIG1lbnUgc2V0XG5cdFx0aWYgKCFtZW51IHx8ICFtZW51Lmxlbmd0aCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHRoaXMuaGlkZU1lbnUoKTtcblxuXHRcdHRoaXMubWVudUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLm1lbnVFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnVcIik7XG5cblx0XHRtZW51LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdHZhciBpdGVtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0dmFyIGxhYmVsID0gaXRlbS5sYWJlbDtcblx0XHRcdHZhciBkaXNhYmxlZCA9IGl0ZW0uZGlzYWJsZWQ7XG5cblx0XHRcdGlmIChpdGVtLnNlcGFyYXRvcikge1xuXHRcdFx0XHRpdGVtRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tZW51LXNlcGFyYXRvclwiKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGl0ZW1FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnUtaXRlbVwiKTtcblxuXHRcdFx0XHRpZiAodHlwZW9mIGxhYmVsID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGxhYmVsID0gbGFiZWwoY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChsYWJlbCBpbnN0YW5jZW9mIE5vZGUpIHtcblx0XHRcdFx0XHRpdGVtRWwuYXBwZW5kQ2hpbGQobGFiZWwpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGl0ZW1FbC5pbm5lckhUTUwgPSBsYWJlbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgZGlzYWJsZWQgPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0ZGlzYWJsZWQgPSBkaXNhYmxlZChjb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGRpc2FibGVkKSB7XG5cdFx0XHRcdFx0aXRlbUVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbWVudS1pdGVtLWRpc2FibGVkXCIpO1xuXHRcdFx0XHRcdGl0ZW1FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aXRlbUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0X3RoaXM2MS5oaWRlTWVudSgpO1xuXHRcdFx0XHRcdFx0aXRlbS5hY3Rpb24oZSwgY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRfdGhpczYxLm1lbnVFbC5hcHBlbmRDaGlsZChpdGVtRWwpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5tZW51RWwuc3R5bGUudG9wID0gZS5wYWdlWSArIFwicHhcIjtcblx0XHR0aGlzLm1lbnVFbC5zdHlsZS5sZWZ0ID0gZS5wYWdlWCArIFwicHhcIjtcblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuYmx1ckV2ZW50KTtcblxuXHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgX3RoaXM2MS5ibHVyRXZlbnQpO1xuXHRcdH0sIDEwMCk7XG5cblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubWVudUVsKTtcblxuXHRcdC8vbW92ZSBtZW51IHRvIHN0YXJ0IG9uIHJpZ2h0IGVkZ2UgaWYgaXQgaXMgdG9vIGNsb3NlIHRvIHRoZSBlZGdlIG9mIHRoZSBzY3JlZW5cblx0XHRpZiAoZS5wYWdlWCArIHRoaXMubWVudUVsLm9mZnNldFdpZHRoID49IGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgpIHtcblx0XHRcdHRoaXMubWVudUVsLnN0eWxlLmxlZnQgPSBcIlwiO1xuXHRcdFx0dGhpcy5tZW51RWwuc3R5bGUucmlnaHQgPSBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoIC0gZS5wYWdlWCArIFwicHhcIjtcblx0XHR9XG5cblx0XHQvL21vdmUgbWVudSB0byBzdGFydCBvbiBib3R0b20gZWRnZSBpZiBpdCBpcyB0b28gY2xvc2UgdG8gdGhlIGVkZ2Ugb2YgdGhlIHNjcmVlblxuXHRcdGlmIChlLnBhZ2VZICsgdGhpcy5tZW51RWwub2Zmc2V0SGVpZ2h0ID49IGRvY0hlaWdodCkge1xuXHRcdFx0dGhpcy5tZW51RWwuc3R5bGUudG9wID0gXCJcIjtcblx0XHRcdHRoaXMubWVudUVsLnN0eWxlLmJvdHRvbSA9IGRvY0hlaWdodCAtIGUucGFnZVkgKyBcInB4XCI7XG5cdFx0fVxuXHR9O1xuXG5cdE1lbnUucHJvdG90eXBlLmhpZGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLm1lbnVFbC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLm1lbnVFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWVudUVsKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5ibHVyRXZlbnQpIHtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdH1cblx0fTtcblxuXHQvL2RlZmF1bHQgYWNjZXNzb3JzXG5cdE1lbnUucHJvdG90eXBlLm1lbnVzID0ge307XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm1lbnVcIiwgTWVudSk7XG5cdHZhciBNb3ZlQ29sdW1ucyA9IGZ1bmN0aW9uIE1vdmVDb2x1bW5zKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50ID0gdGhpcy5jcmVhdGVQbGFjZWhvbGRlckVsZW1lbnQoKTtcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGZhbHNlOyAvL2Zsb2F0aW5nIGNvbHVtbiBoZWFkZXIgZWxlbWVudFxuXHRcdHRoaXMuY2hlY2tUaW1lb3V0ID0gZmFsc2U7IC8vY2xpY2sgY2hlY2sgdGltZW91dCBob2xkZXJcblx0XHR0aGlzLmNoZWNrUGVyaW9kID0gMjUwOyAvL3BlcmlvZCB0byB3YWl0IG9uIG1vdXNlZG93biB0byBjb25zaWRlciB0aGlzIGEgbW92ZSBhbmQgbm90IGEgY2xpY2tcblx0XHR0aGlzLm1vdmluZyA9IGZhbHNlOyAvL2N1cnJlbnRseSBtb3ZpbmcgY29sdW1uXG5cdFx0dGhpcy50b0NvbCA9IGZhbHNlOyAvL2Rlc3RpbmF0aW9uIGNvbHVtblxuXHRcdHRoaXMudG9Db2xBZnRlciA9IGZhbHNlOyAvL3Bvc2l0aW9uIG9mIG1vdmluZyBjb2x1bW4gcmVsYXRpdmUgdG8gdGhlIGRlc2l0bmF0aW9uIGNvbHVtblxuXHRcdHRoaXMuc3RhcnRYID0gMDsgLy9zdGFydGluZyBwb3NpdGlvbiB3aXRoaW4gaGVhZGVyIGVsZW1lbnRcblx0XHR0aGlzLmF1dG9TY3JvbGxNYXJnaW4gPSA0MDsgLy9hdXRvIHNjcm9sbCBvbiBlZGdlIHdoZW4gd2l0aGluIG1hcmdpblxuXHRcdHRoaXMuYXV0b1Njcm9sbFN0ZXAgPSA1OyAvL2F1dG8gc2Nyb2xsIGRpc3RhbmNlIGluIHBpeGVsc1xuXHRcdHRoaXMuYXV0b1Njcm9sbFRpbWVvdXQgPSBmYWxzZTsgLy9hdXRvIHNjcm9sbCB0aW1lb3V0XG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMubW92ZUhvdmVyID0gdGhpcy5tb3ZlSG92ZXIuYmluZCh0aGlzKTtcblx0XHR0aGlzLmVuZE1vdmUgPSB0aGlzLmVuZE1vdmUuYmluZCh0aGlzKTtcblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUuY3JlYXRlUGxhY2Vob2xkZXJFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbFwiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1wbGFjZWhvbGRlclwiKTtcblxuXHRcdHJldHVybiBlbDtcblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHt9LFxuXHRcdCAgICBjb2xFbDtcblxuXHRcdGlmICghY29sdW1uLm1vZHVsZXMuZnJvemVuKSB7XG5cblx0XHRcdGNvbEVsID0gY29sdW1uLmdldEVsZW1lbnQoKTtcblxuXHRcdFx0Y29uZmlnLm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChjb2x1bW4ucGFyZW50ID09PSBzZWxmLm1vdmluZy5wYXJlbnQpIHtcblx0XHRcdFx0XHRpZiAoKHNlbGYudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCkgLSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQoY29sRWwpLmxlZnQgKyBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudC5zY3JvbGxMZWZ0ID4gY29sdW1uLmdldFdpZHRoKCkgLyAyKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi50b0NvbCAhPT0gY29sdW1uIHx8ICFzZWxmLnRvQ29sQWZ0ZXIpIHtcblx0XHRcdFx0XHRcdFx0Y29sRWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIGNvbEVsLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlQ29sdW1uKGNvbHVtbiwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChzZWxmLnRvQ29sICE9PSBjb2x1bW4gfHwgc2VsZi50b0NvbEFmdGVyKSB7XG5cdFx0XHRcdFx0XHRcdGNvbEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCBjb2xFbCk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZUNvbHVtbihjb2x1bW4sIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0uYmluZChzZWxmKTtcblxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzZWxmLnRvdWNoTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRcdHNlbGYuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCBjb2x1bW4pO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKGUud2hpY2ggPT09IDEpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5jaGVja1RpbWVvdXQpIHtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5iaW5kVG91Y2hFdmVudHMoY29sdW1uKTtcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uID0gY29uZmlnO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5iaW5kVG91Y2hFdmVudHMgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb2xFbCA9IGNvbHVtbi5nZXRFbGVtZW50KCksXG5cdFx0ICAgIHN0YXJ0WE1vdmUgPSBmYWxzZSxcblx0XHQgICAgLy9zaGlmdGluZyBjZW50ZXIgcG9zaXRpb24gb2YgdGhlIGNlbGxcblx0XHRkaXIgPSBmYWxzZSxcblx0XHQgICAgY3VycmVudENvbCxcblx0XHQgICAgbmV4dENvbCxcblx0XHQgICAgcHJldkNvbCxcblx0XHQgICAgbmV4dENvbFdpZHRoLFxuXHRcdCAgICBwcmV2Q29sV2lkdGgsXG5cdFx0ICAgIG5leHRDb2xXaWR0aExhc3QsXG5cdFx0ICAgIHByZXZDb2xXaWR0aExhc3Q7XG5cblx0XHRjb2xFbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi50b3VjaE1vdmUgPSB0cnVlO1xuXHRcdFx0XHRjdXJyZW50Q29sID0gY29sdW1uO1xuXHRcdFx0XHRuZXh0Q29sID0gY29sdW1uLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0bmV4dENvbFdpZHRoID0gbmV4dENvbCA/IG5leHRDb2wuZ2V0V2lkdGgoKSAvIDIgOiAwO1xuXHRcdFx0XHRwcmV2Q29sID0gY29sdW1uLnByZXZDb2x1bW4oKTtcblx0XHRcdFx0cHJldkNvbFdpZHRoID0gcHJldkNvbCA/IHByZXZDb2wuZ2V0V2lkdGgoKSAvIDIgOiAwO1xuXHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gMDtcblx0XHRcdFx0cHJldkNvbFdpZHRoTGFzdCA9IDA7XG5cdFx0XHRcdHN0YXJ0WE1vdmUgPSBmYWxzZTtcblxuXHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCBjb2x1bW4pO1xuXHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIGhhbGZDb2wsIGRpZmYsIG1vdmVUb0NvbDtcblxuXHRcdFx0aWYgKHNlbGYubW92aW5nKSB7XG5cdFx0XHRcdHNlbGYubW92ZUhvdmVyKGUpO1xuXG5cdFx0XHRcdGlmICghc3RhcnRYTW92ZSkge1xuXHRcdFx0XHRcdHN0YXJ0WE1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkaWZmID0gZS50b3VjaGVzWzBdLnBhZ2VYIC0gc3RhcnRYTW92ZTtcblxuXHRcdFx0XHRpZiAoZGlmZiA+IDApIHtcblx0XHRcdFx0XHRpZiAobmV4dENvbCAmJiBkaWZmIC0gbmV4dENvbFdpZHRoTGFzdCA+IG5leHRDb2xXaWR0aCkge1xuXHRcdFx0XHRcdFx0bW92ZVRvQ29sID0gbmV4dENvbDtcblxuXHRcdFx0XHRcdFx0aWYgKG1vdmVUb0NvbCAhPT0gY29sdW1uKSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0WE1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG5cdFx0XHRcdFx0XHRcdG1vdmVUb0NvbC5nZXRFbGVtZW50KCkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIG1vdmVUb0NvbC5nZXRFbGVtZW50KCkubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLm1vdmVDb2x1bW4obW92ZVRvQ29sLCB0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHByZXZDb2wgJiYgLWRpZmYgLSBwcmV2Q29sV2lkdGhMYXN0ID4gcHJldkNvbFdpZHRoKSB7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Db2wgPSBwcmV2Q29sO1xuXG5cdFx0XHRcdFx0XHRpZiAobW92ZVRvQ29sICE9PSBjb2x1bW4pIHtcblx0XHRcdFx0XHRcdFx0c3RhcnRYTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWDtcblx0XHRcdFx0XHRcdFx0bW92ZVRvQ29sLmdldEVsZW1lbnQoKS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgbW92ZVRvQ29sLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZUNvbHVtbihtb3ZlVG9Db2wsIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobW92ZVRvQ29sKSB7XG5cdFx0XHRcdFx0Y3VycmVudENvbCA9IG1vdmVUb0NvbDtcblx0XHRcdFx0XHRuZXh0Q29sID0gbW92ZVRvQ29sLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gbmV4dENvbFdpZHRoO1xuXHRcdFx0XHRcdG5leHRDb2xXaWR0aCA9IG5leHRDb2wgPyBuZXh0Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0XHRwcmV2Q29sID0gbW92ZVRvQ29sLnByZXZDb2x1bW4oKTtcblx0XHRcdFx0XHRwcmV2Q29sV2lkdGhMYXN0ID0gcHJldkNvbFdpZHRoO1xuXHRcdFx0XHRcdHByZXZDb2xXaWR0aCA9IHByZXZDb2wgPyBwcmV2Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdGNvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKHNlbGYuY2hlY2tUaW1lb3V0KSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoc2VsZi5tb3ZpbmcpIHtcblx0XHRcdFx0c2VsZi5lbmRNb3ZlKGUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5zdGFydE1vdmUgPSBmdW5jdGlvbiAoZSwgY29sdW1uKSB7XG5cdFx0dmFyIGVsZW1lbnQgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXG5cdFx0dGhpcy5tb3ZpbmcgPSBjb2x1bW47XG5cdFx0dGhpcy5zdGFydFggPSAodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSAtIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChlbGVtZW50KS5sZWZ0O1xuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0Ly9jcmVhdGUgcGxhY2Vob2xkZXJcblx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5zdHlsZS53aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLmhlaWdodCA9IGNvbHVtbi5nZXRIZWlnaHQoKSArIFwicHhcIjtcblxuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcblxuXHRcdC8vY3JlYXRlIGhvdmVyIGVsZW1lbnRcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbW92aW5nXCIpO1xuXG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZCh0aGlzLmhvdmVyRWxlbWVudCk7XG5cblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUuYm90dG9tID0gXCIwXCI7XG5cblx0XHRpZiAoIXRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl9iaW5kTW91c2VNb3ZlKCk7XG5cblx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdmVIb3Zlcik7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuZW5kTW92ZSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5tb3ZlSG92ZXIoZSk7XG5cdH07XG5cblx0TW92ZUNvbHVtbnMucHJvdG90eXBlLl9iaW5kTW91c2VNb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSkge1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5fdW5iaW5kTW91c2VNb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSkge1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVDb2x1bW5zLnByb3RvdHlwZS5tb3ZlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbiwgYWZ0ZXIpIHtcblx0XHR2YXIgbW92aW5nQ2VsbHMgPSB0aGlzLm1vdmluZy5nZXRDZWxscygpO1xuXG5cdFx0dGhpcy50b0NvbCA9IGNvbHVtbjtcblx0XHR0aGlzLnRvQ29sQWZ0ZXIgPSBhZnRlcjtcblxuXHRcdGlmIChhZnRlcikge1xuXHRcdFx0Y29sdW1uLmdldENlbGxzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCwgaSkge1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdGNlbGxFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb3ZpbmdDZWxsc1tpXS5nZXRFbGVtZW50KCksIGNlbGxFbC5uZXh0U2libGluZyk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29sdW1uLmdldENlbGxzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCwgaSkge1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdGNlbGxFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb3ZpbmdDZWxsc1tpXS5nZXRFbGVtZW50KCksIGNlbGxFbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0TW92ZUNvbHVtbnMucHJvdG90eXBlLmVuZE1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmIChlLndoaWNoID09PSAxIHx8IHRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl91bmJpbmRNb3VzZU1vdmUoKTtcblxuXHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5tb3ZpbmcuZ2V0RWxlbWVudCgpLCB0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJFbGVtZW50KTtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5ob3ZlckVsZW1lbnQpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdGlmICh0aGlzLnRvQ29sKSB7XG5cdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5tb3ZlQ29sdW1uQWN0dWFsKHRoaXMubW92aW5nLCB0aGlzLnRvQ29sLCB0aGlzLnRvQ29sQWZ0ZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b0NvbCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b0NvbEFmdGVyID0gZmFsc2U7XG5cblx0XHRcdGlmICghdGhpcy50b3VjaE1vdmUpIHtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMubW92ZUhvdmVyKTtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRNb3ZlQ29sdW1ucy5wcm90b3R5cGUubW92ZUhvdmVyID0gZnVuY3Rpb24gKGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbHVtbkhvbGRlciA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCksXG5cdFx0ICAgIHNjcm9sbExlZnQgPSBjb2x1bW5Ib2xkZXIuc2Nyb2xsTGVmdCxcblx0XHQgICAgeFBvcyA9IChzZWxmLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVgpIC0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmVsT2Zmc2V0KGNvbHVtbkhvbGRlcikubGVmdCArIHNjcm9sbExlZnQsXG5cdFx0ICAgIHNjcm9sbFBvcztcblxuXHRcdHNlbGYuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSB4UG9zIC0gc2VsZi5zdGFydFggKyBcInB4XCI7XG5cblx0XHRpZiAoeFBvcyAtIHNjcm9sbExlZnQgPCBzZWxmLmF1dG9TY3JvbGxNYXJnaW4pIHtcblx0XHRcdGlmICghc2VsZi5hdXRvU2Nyb2xsVGltZW91dCkge1xuXHRcdFx0XHRzZWxmLmF1dG9TY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0c2Nyb2xsUG9zID0gTWF0aC5tYXgoMCwgc2Nyb2xsTGVmdCAtIDUpO1xuXHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuc2Nyb2xsTGVmdCA9IHNjcm9sbFBvcztcblx0XHRcdFx0XHRzZWxmLmF1dG9TY3JvbGxUaW1lb3V0ID0gZmFsc2U7XG5cdFx0XHRcdH0sIDEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChzY3JvbGxMZWZ0ICsgY29sdW1uSG9sZGVyLmNsaWVudFdpZHRoIC0geFBvcyA8IHNlbGYuYXV0b1Njcm9sbE1hcmdpbikge1xuXHRcdFx0aWYgKCFzZWxmLmF1dG9TY3JvbGxUaW1lb3V0KSB7XG5cdFx0XHRcdHNlbGYuYXV0b1Njcm9sbFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRzY3JvbGxQb3MgPSBNYXRoLm1pbihjb2x1bW5Ib2xkZXIuY2xpZW50V2lkdGgsIHNjcm9sbExlZnQgKyA1KTtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpLnNjcm9sbExlZnQgPSBzY3JvbGxQb3M7XG5cdFx0XHRcdFx0c2VsZi5hdXRvU2Nyb2xsVGltZW91dCA9IGZhbHNlO1xuXHRcdFx0XHR9LCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm1vdmVDb2x1bW5cIiwgTW92ZUNvbHVtbnMpO1xuXG5cdHZhciBNb3ZlUm93cyA9IGZ1bmN0aW9uIE1vdmVSb3dzKHRhYmxlKSB7XG5cblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQgPSB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyRWxlbWVudCgpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50ID0gZmFsc2U7IC8vZmxvYXRpbmcgcm93IGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5jaGVja1RpbWVvdXQgPSBmYWxzZTsgLy9jbGljayBjaGVjayB0aW1lb3V0IGhvbGRlclxuXHRcdHRoaXMuY2hlY2tQZXJpb2QgPSAxNTA7IC8vcGVyaW9kIHRvIHdhaXQgb24gbW91c2Vkb3duIHRvIGNvbnNpZGVyIHRoaXMgYSBtb3ZlIGFuZCBub3QgYSBjbGlja1xuXHRcdHRoaXMubW92aW5nID0gZmFsc2U7IC8vY3VycmVudGx5IG1vdmluZyByb3dcblx0XHR0aGlzLnRvUm93ID0gZmFsc2U7IC8vZGVzdGluYXRpb24gcm93XG5cdFx0dGhpcy50b1Jvd0FmdGVyID0gZmFsc2U7IC8vcG9zaXRpb24gb2YgbW92aW5nIHJvdyByZWxhdGl2ZSB0byB0aGUgZGVzaXRuYXRpb24gcm93XG5cdFx0dGhpcy5oYXNIYW5kbGUgPSBmYWxzZTsgLy9yb3cgaGFzIGhhbmRsZSBpbnN0ZWFkIG9mIGZ1bGx5IG1vdmFibGUgcm93XG5cdFx0dGhpcy5zdGFydFkgPSAwOyAvL3N0YXJ0aW5nIFkgcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5zdGFydFggPSAwOyAvL3N0YXJ0aW5nIFggcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cblx0XHR0aGlzLm1vdmVIb3ZlciA9IHRoaXMubW92ZUhvdmVyLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5lbmRNb3ZlID0gdGhpcy5lbmRNb3ZlLmJpbmQodGhpcyk7XG5cdFx0dGhpcy50YWJsZVJvd0Ryb3BFdmVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMuY29ubmVjdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMuY29ubmVjdGlvbnMgPSBbXTtcblxuXHRcdHRoaXMuY29ubmVjdGVkVGFibGUgPSBmYWxzZTtcblx0XHR0aGlzLmNvbm5lY3RlZFJvdyA9IGZhbHNlO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5jcmVhdGVQbGFjZWhvbGRlckVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LXBsYWNlaG9sZGVyXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuXHRcdHRoaXMuY29ubmVjdGlvbiA9IHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c0Nvbm5lY3RlZFRhYmxlcztcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuc2V0SGFuZGxlID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuXHRcdHRoaXMuaGFzSGFuZGxlID0gaGFuZGxlO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5pbml0aWFsaXplR3JvdXBIZWFkZXIgPSBmdW5jdGlvbiAoZ3JvdXApIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbmZpZyA9IHt9LFxuXHRcdCAgICByb3dFbDtcblxuXHRcdC8vaW50ZXIgdGFibGUgZHJhZyBkcm9wXG5cdFx0Y29uZmlnLm1vdXNldXAgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi50YWJsZVJvd0Ryb3AoZSwgcm93KTtcblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHQvL3NhbWUgdGFibGUgZHJhZyBkcm9wXG5cdFx0Y29uZmlnLm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoZS5wYWdlWSAtIFRhYnVsYXRvci5wcm90b3R5cGUuaGVscGVycy5lbE9mZnNldChncm91cC5lbGVtZW50KS50b3AgKyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPiBncm91cC5nZXRIZWlnaHQoKSAvIDIpIHtcblx0XHRcdFx0aWYgKHNlbGYudG9Sb3cgIT09IGdyb3VwIHx8ICFzZWxmLnRvUm93QWZ0ZXIpIHtcblx0XHRcdFx0XHR2YXIgcm93RWwgPSBncm91cC5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIHJvd0VsLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVSb3coZ3JvdXAsIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2VsZi50b1JvdyAhPT0gZ3JvdXAgfHwgc2VsZi50b1Jvd0FmdGVyKSB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gZ3JvdXAuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdGlmIChyb3dFbC5wcmV2aW91c1NpYmxpbmcpIHtcblx0XHRcdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCByb3dFbCk7XG5cdFx0XHRcdFx0XHRzZWxmLm1vdmVSb3coZ3JvdXAsIGZhbHNlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHRncm91cC5tb2R1bGVzLm1vdmVSb3cgPSBjb25maWc7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb25maWcgPSB7fSxcblx0XHQgICAgcm93RWw7XG5cblx0XHQvL2ludGVyIHRhYmxlIGRyYWcgZHJvcFxuXHRcdGNvbmZpZy5tb3VzZXVwID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHNlbGYudGFibGVSb3dEcm9wKGUsIHJvdyk7XG5cdFx0fS5iaW5kKHNlbGYpO1xuXG5cdFx0Ly9zYW1lIHRhYmxlIGRyYWcgZHJvcFxuXHRcdGNvbmZpZy5tb3VzZW1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKGUucGFnZVkgLSBUYWJ1bGF0b3IucHJvdG90eXBlLmhlbHBlcnMuZWxPZmZzZXQocm93LmVsZW1lbnQpLnRvcCArIHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCA+IHJvdy5nZXRIZWlnaHQoKSAvIDIpIHtcblx0XHRcdFx0aWYgKHNlbGYudG9Sb3cgIT09IHJvdyB8fCAhc2VsZi50b1Jvd0FmdGVyKSB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgcm93RWwubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdHNlbGYubW92ZVJvdyhyb3csIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2VsZi50b1JvdyAhPT0gcm93IHx8IHNlbGYudG9Sb3dBZnRlcikge1xuXHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIHJvd0VsKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVSb3cocm93LCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LmJpbmQoc2VsZik7XG5cblx0XHRpZiAoIXRoaXMuaGFzSGFuZGxlKSB7XG5cblx0XHRcdHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRcdHNlbGYuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCByb3cpO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKGUud2hpY2ggPT09IDEpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5jaGVja1RpbWVvdXQpIHtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5iaW5kVG91Y2hFdmVudHMocm93LCByb3cuZ2V0RWxlbWVudCgpKTtcblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5tb3ZlUm93ID0gY29uZmlnO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5pbml0aWFsaXplQ2VsbCA9IGZ1bmN0aW9uIChjZWxsKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjZWxsRWwgPSBjZWxsLmdldEVsZW1lbnQoKTtcblxuXHRcdGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoZS53aGljaCA9PT0gMSkge1xuXHRcdFx0XHRzZWxmLmNoZWNrVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHNlbGYuc3RhcnRNb3ZlKGUsIGNlbGwucm93KTtcblx0XHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGlmIChlLndoaWNoID09PSAxKSB7XG5cdFx0XHRcdGlmIChzZWxmLmNoZWNrVGltZW91dCkge1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMuYmluZFRvdWNoRXZlbnRzKGNlbGwucm93LCBjZWxsLmdldEVsZW1lbnQoKSk7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmJpbmRUb3VjaEV2ZW50cyA9IGZ1bmN0aW9uIChyb3csIGVsZW1lbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHN0YXJ0WU1vdmUgPSBmYWxzZSxcblx0XHQgICAgLy9zaGlmdGluZyBjZW50ZXIgcG9zaXRpb24gb2YgdGhlIGNlbGxcblx0XHRkaXIgPSBmYWxzZSxcblx0XHQgICAgY3VycmVudFJvdyxcblx0XHQgICAgbmV4dFJvdyxcblx0XHQgICAgcHJldlJvdyxcblx0XHQgICAgbmV4dFJvd0hlaWdodCxcblx0XHQgICAgcHJldlJvd0hlaWdodCxcblx0XHQgICAgbmV4dFJvd0hlaWdodExhc3QsXG5cdFx0ICAgIHByZXZSb3dIZWlnaHRMYXN0O1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi50b3VjaE1vdmUgPSB0cnVlO1xuXHRcdFx0XHRjdXJyZW50Um93ID0gcm93O1xuXHRcdFx0XHRuZXh0Um93ID0gcm93Lm5leHRSb3coKTtcblx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpIC8gMiA6IDA7XG5cdFx0XHRcdHByZXZSb3cgPSByb3cucHJldlJvdygpO1xuXHRcdFx0XHRwcmV2Um93SGVpZ2h0ID0gcHJldlJvdyA/IHByZXZSb3cuZ2V0SGVpZ2h0KCkgLyAyIDogMDtcblx0XHRcdFx0bmV4dFJvd0hlaWdodExhc3QgPSAwO1xuXHRcdFx0XHRwcmV2Um93SGVpZ2h0TGFzdCA9IDA7XG5cdFx0XHRcdHN0YXJ0WU1vdmUgPSBmYWxzZTtcblxuXHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCByb3cpO1xuXHRcdFx0fSwgc2VsZi5jaGVja1BlcmlvZCk7XG5cdFx0fSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXHRcdHRoaXMubW92aW5nLCB0aGlzLnRvUm93LCB0aGlzLnRvUm93QWZ0ZXI7XG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdHZhciBoYWxmQ29sLCBkaWZmLCBtb3ZlVG9Sb3c7XG5cblx0XHRcdGlmIChzZWxmLm1vdmluZykge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0c2VsZi5tb3ZlSG92ZXIoZSk7XG5cblx0XHRcdFx0aWYgKCFzdGFydFlNb3ZlKSB7XG5cdFx0XHRcdFx0c3RhcnRZTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRpZmYgPSBlLnRvdWNoZXNbMF0ucGFnZVkgLSBzdGFydFlNb3ZlO1xuXG5cdFx0XHRcdGlmIChkaWZmID4gMCkge1xuXHRcdFx0XHRcdGlmIChuZXh0Um93ICYmIGRpZmYgLSBuZXh0Um93SGVpZ2h0TGFzdCA+IG5leHRSb3dIZWlnaHQpIHtcblx0XHRcdFx0XHRcdG1vdmVUb1JvdyA9IG5leHRSb3c7XG5cblx0XHRcdFx0XHRcdGlmIChtb3ZlVG9Sb3cgIT09IHJvdykge1xuXHRcdFx0XHRcdFx0XHRzdGFydFlNb3ZlID0gZS50b3VjaGVzWzBdLnBhZ2VZO1xuXHRcdFx0XHRcdFx0XHRtb3ZlVG9Sb3cuZ2V0RWxlbWVudCgpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCBtb3ZlVG9Sb3cuZ2V0RWxlbWVudCgpLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlUm93KG1vdmVUb1JvdywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChwcmV2Um93ICYmIC1kaWZmIC0gcHJldlJvd0hlaWdodExhc3QgPiBwcmV2Um93SGVpZ2h0KSB7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Sb3cgPSBwcmV2Um93O1xuXG5cdFx0XHRcdFx0XHRpZiAobW92ZVRvUm93ICE9PSByb3cpIHtcblx0XHRcdFx0XHRcdFx0c3RhcnRZTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWTtcblx0XHRcdFx0XHRcdFx0bW92ZVRvUm93LmdldEVsZW1lbnQoKS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgbW92ZVRvUm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZVJvdyhtb3ZlVG9Sb3csIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobW92ZVRvUm93KSB7XG5cdFx0XHRcdFx0Y3VycmVudFJvdyA9IG1vdmVUb1Jvdztcblx0XHRcdFx0XHRuZXh0Um93ID0gbW92ZVRvUm93Lm5leHRSb3coKTtcblx0XHRcdFx0XHRuZXh0Um93SGVpZ2h0TGFzdCA9IG5leHRSb3dIZWlnaHQ7XG5cdFx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpIC8gMiA6IDA7XG5cdFx0XHRcdFx0cHJldlJvdyA9IG1vdmVUb1Jvdy5wcmV2Um93KCk7XG5cdFx0XHRcdFx0cHJldlJvd0hlaWdodExhc3QgPSBwcmV2Um93SGVpZ2h0O1xuXHRcdFx0XHRcdHByZXZSb3dIZWlnaHQgPSBwcmV2Um93ID8gcHJldlJvdy5nZXRIZWlnaHQoKSAvIDIgOiAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKHNlbGYuY2hlY2tUaW1lb3V0KSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoc2VsZi5tb3ZpbmcpIHtcblx0XHRcdFx0c2VsZi5lbmRNb3ZlKGUpO1xuXHRcdFx0XHRzZWxmLnRvdWNoTW92ZSA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5fYmluZE1vdXNlTW92ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdGlmICgocm93LnR5cGUgPT09IFwicm93XCIgfHwgcm93LnR5cGUgPT09IFwiZ3JvdXBcIikgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpIHtcblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2Vtb3ZlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuX3VuYmluZE1vdXNlTW92ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdGlmICgocm93LnR5cGUgPT09IFwicm93XCIgfHwgcm93LnR5cGUgPT09IFwiZ3JvdXBcIikgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpIHtcblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2Vtb3ZlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuc3RhcnRNb3ZlID0gZnVuY3Rpb24gKGUsIHJvdykge1xuXHRcdHZhciBlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHRoaXMuc2V0U3RhcnRQb3NpdGlvbihlLCByb3cpO1xuXG5cdFx0dGhpcy5tb3ZpbmcgPSByb3c7XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHQvL2NyZWF0ZSBwbGFjZWhvbGRlclxuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLndpZHRoID0gcm93LmdldFdpZHRoKCkgKyBcInB4XCI7XG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gcm93LmdldEhlaWdodCgpICsgXCJweFwiO1xuXG5cdFx0aWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdFx0ZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3Zpbmdyb3ctc2VuZGluZ1wiKTtcblx0XHRcdHRoaXMuY29ubmVjdFRvVGFibGVzKHJvdyk7XG5cdFx0fVxuXG5cdFx0Ly9jcmVhdGUgaG92ZXIgZWxlbWVudFxuXHRcdHRoaXMuaG92ZXJFbGVtZW50ID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3ZpbmdcIik7XG5cblx0XHRpZiAodGhpcy5jb25uZWN0aW9uKSB7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSBcIjBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnRvcCA9IFwiMFwiO1xuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGggKyBcInB4XCI7XG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS53aGl0ZVNwYWNlID0gXCJub3dyYXBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFRhYmxlRWxlbWVudCgpLmFwcGVuZENoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblxuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUubGVmdCA9IFwiMFwiO1xuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUudG9wID0gXCIwXCI7XG5cblx0XHRcdHRoaXMuX2JpbmRNb3VzZU1vdmUoKTtcblx0XHR9XG5cblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5tb3ZlSG92ZXIpO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5lbmRNb3ZlKTtcblxuXHRcdHRoaXMubW92ZUhvdmVyKGUpO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5zZXRTdGFydFBvc2l0aW9uID0gZnVuY3Rpb24gKGUsIHJvdykge1xuXHRcdHZhciBwYWdlWCA9IHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCxcblx0XHQgICAgcGFnZVkgPSB0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVksXG5cdFx0ICAgIGVsZW1lbnQsXG5cdFx0ICAgIHBvc2l0aW9uO1xuXG5cdFx0ZWxlbWVudCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0aWYgKHRoaXMuY29ubmVjdGlvbikge1xuXHRcdFx0cG9zaXRpb24gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0XHR0aGlzLnN0YXJ0WCA9IHBvc2l0aW9uLmxlZnQgLSBwYWdlWCArIHdpbmRvdy5wYWdlWE9mZnNldDtcblx0XHRcdHRoaXMuc3RhcnRZID0gcG9zaXRpb24udG9wIC0gcGFnZVkgKyB3aW5kb3cucGFnZVlPZmZzZXQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuc3RhcnRZID0gcGFnZVkgLSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblx0XHR9XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLmVuZE1vdmUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmICghZSB8fCBlLndoaWNoID09PSAxIHx8IHRoaXMudG91Y2hNb3ZlKSB7XG5cdFx0XHR0aGlzLl91bmJpbmRNb3VzZU1vdmUoKTtcblxuXHRcdFx0aWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5tb3ZpbmcuZ2V0RWxlbWVudCgpLCB0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0XHRpZiAodGhpcy50b1Jvdykge1xuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubW92ZVJvdyh0aGlzLm1vdmluZywgdGhpcy50b1JvdywgdGhpcy50b1Jvd0FmdGVyKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9Sb3cgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9Sb3dBZnRlciA9IGZhbHNlO1xuXG5cdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5tb3ZlSG92ZXIpO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXG5cdFx0XHRpZiAodGhpcy5jb25uZWN0aW9uKSB7XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1zZW5kaW5nXCIpO1xuXHRcdFx0XHR0aGlzLmRpc2Nvbm5lY3RGcm9tVGFibGVzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5tb3ZlUm93ID0gZnVuY3Rpb24gKHJvdywgYWZ0ZXIpIHtcblx0XHR0aGlzLnRvUm93ID0gcm93O1xuXHRcdHRoaXMudG9Sb3dBZnRlciA9IGFmdGVyO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5tb3ZlSG92ZXIgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmICh0aGlzLmNvbm5lY3Rpb24pIHtcblx0XHRcdHRoaXMubW92ZUhvdmVyQ29ubmVjdGlvbnMuY2FsbCh0aGlzLCBlKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5tb3ZlSG92ZXJUYWJsZS5jYWxsKHRoaXMsIGUpO1xuXHRcdH1cblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUubW92ZUhvdmVyVGFibGUgPSBmdW5jdGlvbiAoZSkge1xuXHRcdHZhciByb3dIb2xkZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpLFxuXHRcdCAgICBzY3JvbGxUb3AgPSByb3dIb2xkZXIuc2Nyb2xsVG9wLFxuXHRcdCAgICB5UG9zID0gKHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWSkgLSByb3dIb2xkZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgc2Nyb2xsVG9wLFxuXHRcdCAgICBzY3JvbGxQb3M7XG5cblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS50b3AgPSB5UG9zIC0gdGhpcy5zdGFydFkgKyBcInB4XCI7XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLm1vdmVIb3ZlckNvbm5lY3Rpb25zID0gZnVuY3Rpb24gKGUpIHtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gdGhpcy5zdGFydFggKyAodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSArIFwicHhcIjtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS50b3AgPSB0aGlzLnN0YXJ0WSArICh0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVkpICsgXCJweFwiO1xuXHR9O1xuXG5cdC8vZXN0YWJsaXNoIGNvbm5lY3Rpb24gd2l0aCBvdGhlciB0YWJsZXNcblx0TW92ZVJvd3MucHJvdG90eXBlLmNvbm5lY3RUb1RhYmxlcyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIGNvbm5lY3Rpb25zID0gdGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLmdldENvbm5lY3Rpb25zKHRoaXMuY29ubmVjdGlvbik7XG5cblx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kaW5nU3RhcnQuY2FsbCh0aGlzLnRhYmxlLCBjb25uZWN0aW9ucyk7XG5cblx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29tbXMuc2VuZCh0aGlzLmNvbm5lY3Rpb24sIFwibW92ZVJvd1wiLCBcImNvbm5lY3RcIiwge1xuXHRcdFx0cm93OiByb3dcblx0XHR9KTtcblx0fTtcblxuXHQvL2Rpc2Nvbm5lY3QgZnJvbSBvdGhlciB0YWJsZXNcblx0TW92ZVJvd3MucHJvdG90eXBlLmRpc2Nvbm5lY3RGcm9tVGFibGVzID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgY29ubmVjdGlvbnMgPSB0aGlzLnRhYmxlLm1vZHVsZXMuY29tbXMuZ2V0Q29ubmVjdGlvbnModGhpcy5jb25uZWN0aW9uKTtcblxuXHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRpbmdTdG9wLmNhbGwodGhpcy50YWJsZSwgY29ubmVjdGlvbnMpO1xuXG5cdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLnNlbmQodGhpcy5jb25uZWN0aW9uLCBcIm1vdmVSb3dcIiwgXCJkaXNjb25uZWN0XCIpO1xuXHR9O1xuXG5cdC8vYWNjZXB0IGluY29tbWluZyBjb25uZWN0aW9uXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKHRhYmxlLCByb3cpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0aWYgKCF0aGlzLmNvbm5lY3RlZFRhYmxlKSB7XG5cdFx0XHR0aGlzLmNvbm5lY3RlZFRhYmxlID0gdGFibGU7XG5cdFx0XHR0aGlzLmNvbm5lY3RlZFJvdyA9IHJvdztcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbW92aW5ncm93LXJlY2VpdmluZ1wiKTtcblxuXHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCkuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdGlmIChyb3cudHlwZSA9PT0gXCJyb3dcIiAmJiByb3cubW9kdWxlcy5tb3ZlUm93ICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2V1cCkge1xuXHRcdFx0XHRcdHJvdy5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYudGFibGVSb3dEcm9wRXZlbnQgPSBzZWxmLnRhYmxlUm93RHJvcC5iaW5kKHNlbGYpO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgc2VsZi50YWJsZVJvd0Ryb3BFdmVudCk7XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmluZ1N0YXJ0LmNhbGwodGhpcy50YWJsZSwgcm93LCB0YWJsZSk7XG5cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIFJvdyBFcnJvciAtIFRhYmxlIGNhbm5vdCBhY2NlcHQgY29ubmVjdGlvbiwgYWxyZWFkeSBjb25uZWN0ZWQgdG8gdGFibGU6XCIsIHRoaXMuY29ubmVjdGVkVGFibGUpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvL2Nsb3NlIGluY29tbWluZyBjb25uZWN0aW9uXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKHRhYmxlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdGlmICh0YWJsZSA9PT0gdGhpcy5jb25uZWN0ZWRUYWJsZSkge1xuXHRcdFx0dGhpcy5jb25uZWN0ZWRUYWJsZSA9IGZhbHNlO1xuXHRcdFx0dGhpcy5jb25uZWN0ZWRSb3cgPSBmYWxzZTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItbW92aW5ncm93LXJlY2VpdmluZ1wiKTtcblxuXHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCkuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdGlmIChyb3cudHlwZSA9PT0gXCJyb3dcIiAmJiByb3cubW9kdWxlcy5tb3ZlUm93ICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2V1cCkge1xuXHRcdFx0XHRcdHJvdy5nZXRFbGVtZW50KCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYudGFibGUuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBzZWxmLnRhYmxlUm93RHJvcEV2ZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2aW5nU3RvcC5jYWxsKHRoaXMudGFibGUsIHRhYmxlKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZSBSb3cgRXJyb3IgLSB0cnlpbmcgdG8gZGlzY29ubmVjdCBmcm9tIG5vbiBjb25uZWN0ZWQgdGFibGVcIik7XG5cdFx0fVxuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5kcm9wQ29tcGxldGUgPSBmdW5jdGlvbiAodGFibGUsIHJvdywgc3VjY2Vzcykge1xuXHRcdHZhciBzZW5kZXIgPSBmYWxzZTtcblxuXHRcdGlmIChzdWNjZXNzKSB7XG5cblx0XHRcdHN3aXRjaCAoX3R5cGVvZih0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kZXIpKSB7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRzZW5kZXIgPSB0aGlzLnNlbmRlcnNbdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzU2VuZGVyXTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRzZW5kZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW5kZXI7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZW5kZXIpIHtcblx0XHRcdFx0c2VuZGVyLmNhbGwodGhpcywgdGhpcy5tb3ZpbmcuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGFibGUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcikge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIk1vdmVyIFJvdyBFcnJvciAtIG5vIG1hdGNoaW5nIHNlbmRlciBmb3VuZDpcIiwgdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzU2VuZGVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW50LmNhbGwodGhpcy50YWJsZSwgdGhpcy5tb3ZpbmcuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGFibGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NTZW50RmFpbGVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5tb3ZpbmcuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGFibGUpO1xuXHRcdH1cblxuXHRcdHRoaXMuZW5kTW92ZSgpO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS50YWJsZVJvd0Ryb3AgPSBmdW5jdGlvbiAoZSwgcm93KSB7XG5cdFx0dmFyIHJlY2VpdmVyID0gZmFsc2UsXG5cdFx0ICAgIHN1Y2Nlc3MgPSBmYWxzZTtcblxuXHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cblx0XHRzd2l0Y2ggKF90eXBlb2YodGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2ZXIpKSB7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHJlY2VpdmVyID0gdGhpcy5yZWNlaXZlcnNbdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2ZXJdO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHJlY2VpdmVyID0gdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2ZXI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGlmIChyZWNlaXZlcikge1xuXHRcdFx0c3VjY2VzcyA9IHJlY2VpdmVyLmNhbGwodGhpcywgdGhpcy5jb25uZWN0ZWRSb3cuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmVyIFJvdyBFcnJvciAtIG5vIG1hdGNoaW5nIHJlY2VpdmVyIGZvdW5kOlwiLCB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZlcik7XG5cdFx0fVxuXG5cdFx0aWYgKHN1Y2Nlc3MpIHtcblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5jb25uZWN0ZWRSb3cuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVkRmFpbGVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5jb25uZWN0ZWRSb3cuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLnNlbmQodGhpcy5jb25uZWN0ZWRUYWJsZSwgXCJtb3ZlUm93XCIsIFwiZHJvcGNvbXBsZXRlXCIsIHtcblx0XHRcdHJvdzogcm93LFxuXHRcdFx0c3VjY2Vzczogc3VjY2Vzc1xuXHRcdH0pO1xuXHR9O1xuXG5cdE1vdmVSb3dzLnByb3RvdHlwZS5yZWNlaXZlcnMgPSB7XG5cdFx0aW5zZXJ0OiBmdW5jdGlvbiBpbnNlcnQoZnJvbVJvdywgdG9Sb3csIGZyb21UYWJsZSkge1xuXHRcdFx0dGhpcy50YWJsZS5hZGRSb3coZnJvbVJvdy5nZXREYXRhKCksIHVuZGVmaW5lZCwgdG9Sb3cpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSxcblxuXHRcdGFkZDogZnVuY3Rpb24gYWRkKGZyb21Sb3csIHRvUm93LCBmcm9tVGFibGUpIHtcblx0XHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpKTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0sXG5cblx0XHR1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKSB7XG5cdFx0XHRpZiAodG9Sb3cpIHtcblx0XHRcdFx0dG9Sb3cudXBkYXRlKGZyb21Sb3cuZ2V0RGF0YSgpKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0cmVwbGFjZTogZnVuY3Rpb24gcmVwbGFjZShmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKSB7XG5cdFx0XHRpZiAodG9Sb3cpIHtcblx0XHRcdFx0dGhpcy50YWJsZS5hZGRSb3coZnJvbVJvdy5nZXREYXRhKCksIHVuZGVmaW5lZCwgdG9Sb3cpO1xuXHRcdFx0XHR0b1Jvdy5kZWxldGUoKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0TW92ZVJvd3MucHJvdG90eXBlLnNlbmRlcnMgPSB7XG5cdFx0ZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKGZyb21Sb3csIHRvUm93LCB0b1RhYmxlKSB7XG5cdFx0XHRmcm9tUm93LmRlbGV0ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRNb3ZlUm93cy5wcm90b3R5cGUuY29tbXNSZWNlaXZlZCA9IGZ1bmN0aW9uICh0YWJsZSwgYWN0aW9uLCBkYXRhKSB7XG5cdFx0c3dpdGNoIChhY3Rpb24pIHtcblx0XHRcdGNhc2UgXCJjb25uZWN0XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLmNvbm5lY3QodGFibGUsIGRhdGEucm93KTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJkaXNjb25uZWN0XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLmRpc2Nvbm5lY3QodGFibGUpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImRyb3Bjb21wbGV0ZVwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5kcm9wQ29tcGxldGUodGFibGUsIGRhdGEucm93LCBkYXRhLnN1Y2Nlc3MpO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm1vdmVSb3dcIiwgTW92ZVJvd3MpO1xuXHR2YXIgTXV0YXRvciA9IGZ1bmN0aW9uIE11dGF0b3IodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5hbGxvd2VkVHlwZXMgPSBbXCJcIiwgXCJkYXRhXCIsIFwiZWRpdFwiLCBcImNsaXBib2FyZFwiXTsgLy9saXN0IG9mIG11YXRhdGlvbiB0eXBlc1xuXHRcdHRoaXMuZW5hYmxlZCA9IHRydWU7XG5cdH07XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBtdXRhdG9yXG5cdE11dGF0b3IucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBtYXRjaCA9IGZhbHNlLFxuXHRcdCAgICBjb25maWcgPSB7fTtcblxuXHRcdHRoaXMuYWxsb3dlZFR5cGVzLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHtcblx0XHRcdHZhciBrZXkgPSBcIm11dGF0b3JcIiArICh0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zbGljZSgxKSksXG5cdFx0XHQgICAgbXV0YXRvcjtcblxuXHRcdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uW2tleV0pIHtcblx0XHRcdFx0bXV0YXRvciA9IHNlbGYubG9va3VwTXV0YXRvcihjb2x1bW4uZGVmaW5pdGlvbltrZXldKTtcblxuXHRcdFx0XHRpZiAobXV0YXRvcikge1xuXHRcdFx0XHRcdG1hdGNoID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGNvbmZpZ1trZXldID0ge1xuXHRcdFx0XHRcdFx0bXV0YXRvcjogbXV0YXRvcixcblx0XHRcdFx0XHRcdHBhcmFtczogY29sdW1uLmRlZmluaXRpb25ba2V5ICsgXCJQYXJhbXNcIl0gfHwge31cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLm11dGF0ZSA9IGNvbmZpZztcblx0XHR9XG5cdH07XG5cblx0TXV0YXRvci5wcm90b3R5cGUubG9va3VwTXV0YXRvciA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdHZhciBtdXRhdG9yID0gZmFsc2U7XG5cblx0XHQvL3NldCBjb2x1bW4gbXV0YXRvclxuXHRcdHN3aXRjaCAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpIHtcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0aWYgKHRoaXMubXV0YXRvcnNbdmFsdWVdKSB7XG5cdFx0XHRcdFx0bXV0YXRvciA9IHRoaXMubXV0YXRvcnNbdmFsdWVdO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIk11dGF0b3IgRXJyb3IgLSBObyBzdWNoIG11dGF0b3IgZm91bmQsIGlnbm9yaW5nOiBcIiwgdmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0bXV0YXRvciA9IHZhbHVlO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gbXV0YXRvcjtcblx0fTtcblxuXHQvL2FwcGx5IG11dGF0b3IgdG8gcm93XG5cdE11dGF0b3IucHJvdG90eXBlLnRyYW5zZm9ybVJvdyA9IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCB1cGRhdGVkRGF0YSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAga2V5ID0gXCJtdXRhdG9yXCIgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpLFxuXHRcdCAgICB2YWx1ZTtcblxuXHRcdGlmICh0aGlzLmVuYWJsZWQpIHtcblxuXHRcdFx0c2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnRyYXZlcnNlKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdFx0dmFyIG11dGF0b3IsIHBhcmFtcywgY29tcG9uZW50O1xuXG5cdFx0XHRcdGlmIChjb2x1bW4ubW9kdWxlcy5tdXRhdGUpIHtcblx0XHRcdFx0XHRtdXRhdG9yID0gY29sdW1uLm1vZHVsZXMubXV0YXRlW2tleV0gfHwgY29sdW1uLm1vZHVsZXMubXV0YXRlLm11dGF0b3IgfHwgZmFsc2U7XG5cblx0XHRcdFx0XHRpZiAobXV0YXRvcikge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZSh0eXBlb2YgdXBkYXRlZERhdGEgIT09IFwidW5kZWZpbmVkXCIgPyB1cGRhdGVkRGF0YSA6IGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRpZiAodHlwZSA9PSBcImRhdGFcIiB8fCB0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRcdFx0Y29tcG9uZW50ID0gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgbXV0YXRvci5wYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IG11dGF0b3IucGFyYW1zKHZhbHVlLCBkYXRhLCB0eXBlLCBjb21wb25lbnQpIDogbXV0YXRvci5wYXJhbXM7XG5cdFx0XHRcdFx0XHRcdGNvbHVtbi5zZXRGaWVsZFZhbHVlKGRhdGEsIG11dGF0b3IubXV0YXRvcih2YWx1ZSwgZGF0YSwgdHlwZSwgcGFyYW1zLCBjb21wb25lbnQpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9O1xuXG5cdC8vYXBwbHkgbXV0YXRvciB0byBuZXcgY2VsbCB2YWx1ZVxuXHRNdXRhdG9yLnByb3RvdHlwZS50cmFuc2Zvcm1DZWxsID0gZnVuY3Rpb24gKGNlbGwsIHZhbHVlKSB7XG5cdFx0dmFyIG11dGF0b3IgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yRWRpdCB8fCBjZWxsLmNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yIHx8IGZhbHNlLFxuXHRcdCAgICB0ZW1wRGF0YSA9IHt9O1xuXG5cdFx0aWYgKG11dGF0b3IpIHtcblx0XHRcdHRlbXBEYXRhID0gT2JqZWN0LmFzc2lnbih0ZW1wRGF0YSwgY2VsbC5yb3cuZ2V0RGF0YSgpKTtcblx0XHRcdGNlbGwuY29sdW1uLnNldEZpZWxkVmFsdWUodGVtcERhdGEsIHZhbHVlKTtcblx0XHRcdHJldHVybiBtdXRhdG9yLm11dGF0b3IodmFsdWUsIHRlbXBEYXRhLCBcImVkaXRcIiwgbXV0YXRvci5wYXJhbXMsIGNlbGwuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXHR9O1xuXG5cdE11dGF0b3IucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmVuYWJsZWQgPSB0cnVlO1xuXHR9O1xuXG5cdE11dGF0b3IucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5lbmFibGVkID0gZmFsc2U7XG5cdH07XG5cblx0Ly9kZWZhdWx0IG11dGF0b3JzXG5cdE11dGF0b3IucHJvdG90eXBlLm11dGF0b3JzID0ge307XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcIm11dGF0b3JcIiwgTXV0YXRvcik7XG5cdHZhciBQYWdlID0gZnVuY3Rpb24gUGFnZSh0YWJsZSkge1xuXG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXG5cdFx0dGhpcy5tb2RlID0gXCJsb2NhbFwiO1xuXHRcdHRoaXMucHJvZ3Jlc3NpdmVMb2FkID0gZmFsc2U7XG5cblx0XHR0aGlzLnNpemUgPSAwO1xuXHRcdHRoaXMucGFnZSA9IDE7XG5cdFx0dGhpcy5jb3VudCA9IDU7XG5cdFx0dGhpcy5tYXggPSAxO1xuXG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSAwOyAvL2luZGV4IGluIGRpc3BsYXkgcGlwZWxpbmVcblxuXHRcdHRoaXMuaW5pdGlhbExvYWQgPSB0cnVlO1xuXG5cdFx0dGhpcy5wYWdlU2l6ZXMgPSBbXTtcblxuXHRcdHRoaXMuY3JlYXRlRWxlbWVudHMoKTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciBidXR0b247XG5cblx0XHR0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wYWdpbmF0b3JcIik7XG5cblx0XHR0aGlzLnBhZ2VzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdHRoaXMucGFnZXNFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnZXNcIik7XG5cblx0XHRidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2VcIik7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJidXR0b25cIik7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJidXR0b25cIik7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJcIik7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiXCIpO1xuXG5cdFx0dGhpcy5maXJzdEJ1dCA9IGJ1dHRvbi5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5maXJzdEJ1dC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhZ2VcIiwgXCJmaXJzdFwiKTtcblxuXHRcdHRoaXMucHJldkJ1dCA9IGJ1dHRvbi5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5wcmV2QnV0LnNldEF0dHJpYnV0ZShcImRhdGEtcGFnZVwiLCBcInByZXZcIik7XG5cblx0XHR0aGlzLm5leHRCdXQgPSBidXR0b24uY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMubmV4dEJ1dC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhZ2VcIiwgXCJuZXh0XCIpO1xuXG5cdFx0dGhpcy5sYXN0QnV0ID0gYnV0dG9uLmNsb25lTm9kZSh0cnVlKTtcblx0XHR0aGlzLmxhc3RCdXQuc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlXCIsIFwibGFzdFwiKTtcblxuXHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvblNpemVTZWxlY3Rvcikge1xuXHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG5cdFx0XHR0aGlzLnBhZ2VTaXplU2VsZWN0LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnZS1zaXplXCIpO1xuXHRcdH1cblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5nZW5lcmF0ZVBhZ2VTaXplU2VsZWN0TGlzdCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM2MiA9IHRoaXM7XG5cblx0XHR2YXIgcGFnZVNpemVzID0gW107XG5cblx0XHRpZiAodGhpcy5wYWdlU2l6ZVNlbGVjdCkge1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvblNpemVTZWxlY3RvcikpIHtcblx0XHRcdFx0cGFnZVNpemVzID0gdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplU2VsZWN0b3I7XG5cdFx0XHRcdHRoaXMucGFnZVNpemVzID0gcGFnZVNpemVzO1xuXG5cdFx0XHRcdGlmICh0aGlzLnBhZ2VTaXplcy5pbmRleE9mKHRoaXMuc2l6ZSkgPT0gLTEpIHtcblx0XHRcdFx0XHRwYWdlU2l6ZXMudW5zaGlmdCh0aGlzLnNpemUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGlmICh0aGlzLnBhZ2VTaXplcy5pbmRleE9mKHRoaXMuc2l6ZSkgPT0gLTEpIHtcblx0XHRcdFx0XHRwYWdlU2l6ZXMgPSBbXTtcblxuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAxOyBpIDwgNTsgaSsrKSB7XG5cdFx0XHRcdFx0XHRwYWdlU2l6ZXMucHVzaCh0aGlzLnNpemUgKiBpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0aGlzLnBhZ2VTaXplcyA9IHBhZ2VTaXplcztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRwYWdlU2l6ZXMgPSB0aGlzLnBhZ2VTaXplcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAodGhpcy5wYWdlU2l6ZVNlbGVjdC5maXJzdENoaWxkKSB7XG5cdFx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QucmVtb3ZlQ2hpbGQodGhpcy5wYWdlU2l6ZVNlbGVjdC5maXJzdENoaWxkKTtcblx0XHRcdH1wYWdlU2l6ZXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHR2YXIgaXRlbUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcblx0XHRcdFx0aXRlbUVsLnZhbHVlID0gaXRlbTtcblx0XHRcdFx0aXRlbUVsLmlubmVySFRNTCA9IGl0ZW07XG5cblx0XHRcdFx0X3RoaXM2Mi5wYWdlU2l6ZVNlbGVjdC5hcHBlbmRDaGlsZChpdGVtRWwpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QudmFsdWUgPSB0aGlzLnNpemU7XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0dXAgcGFnZWluYXRpb25cblx0UGFnZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChoaWRkZW4pIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHBhZ2VTZWxlY3RMYWJlbDtcblxuXHRcdC8vdXBkYXRlIHBhcmFtIG5hbWVzXG5cdFx0Zm9yICh2YXIga2V5IGluIHNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uRGF0YVNlbnQpIHtcblx0XHRcdHNlbGYucGFnaW5hdGlvbkRhdGFTZW50TmFtZXNba2V5XSA9IHNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uRGF0YVNlbnRba2V5XTtcblx0XHR9XG5cblx0XHRmb3IgKHZhciBfa2V5MiBpbiBzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkRhdGFSZWNlaXZlZCkge1xuXHRcdFx0c2VsZi5wYWdpbmF0aW9uRGF0YVJlY2VpdmVkTmFtZXNbX2tleTJdID0gc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWRbX2tleTJdO1xuXHRcdH1cblxuXHRcdC8vYnVpbGQgcGFnaW5hdGlvbiBlbGVtZW50XG5cblx0XHQvL2JpbmQgbG9jYWxpemF0aW9uc1xuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxmaXJzdFwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYuZmlyc3RCdXQuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258Zmlyc3RfdGl0bGVcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRzZWxmLmZpcnN0QnV0LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXHRcdFx0c2VsZi5maXJzdEJ1dC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258cHJldlwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYucHJldkJ1dC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHR9KTtcblxuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxwcmV2X3RpdGxlXCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0c2VsZi5wcmV2QnV0LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXHRcdFx0c2VsZi5wcmV2QnV0LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHZhbHVlKTtcblx0XHR9KTtcblxuXHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxuZXh0XCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0c2VsZi5uZXh0QnV0LmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufG5leHRfdGl0bGVcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRzZWxmLm5leHRCdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRzZWxmLm5leHRCdXQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUpO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJwYWdpbmF0aW9ufGxhc3RcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRzZWxmLmxhc3RCdXQuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0fSk7XG5cblx0XHRzZWxmLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuYmluZChcInBhZ2luYXRpb258bGFzdF90aXRsZVwiLCBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdHNlbGYubGFzdEJ1dC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblx0XHRcdHNlbGYubGFzdEJ1dC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0fSk7XG5cblx0XHQvL2NsaWNrIGJpbmRpbmdzXG5cdFx0c2VsZi5maXJzdEJ1dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5zZXRQYWdlKDEpO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi5wcmV2QnV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLnByZXZpb3VzUGFnZSgpO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi5uZXh0QnV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLm5leHRQYWdlKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdH0pO1xuXG5cdFx0c2VsZi5sYXN0QnV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLnNldFBhZ2Uoc2VsZi5tYXgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uRWxlbWVudCkge1xuXHRcdFx0c2VsZi5lbGVtZW50ID0gc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25FbGVtZW50O1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnBhZ2VTaXplU2VsZWN0KSB7XG5cdFx0XHRwYWdlU2VsZWN0TGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIik7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5iaW5kKFwicGFnaW5hdGlvbnxwYWdlX3NpemVcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRcdHNlbGYucGFnZVNpemVTZWxlY3Quc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRcdHNlbGYucGFnZVNpemVTZWxlY3Quc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUpO1xuXHRcdFx0XHRwYWdlU2VsZWN0TGFiZWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHBhZ2VTZWxlY3RMYWJlbCk7XG5cdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kQ2hpbGQoc2VsZi5wYWdlU2l6ZVNlbGVjdCk7XG5cblx0XHRcdHNlbGYucGFnZVNpemVTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRzZWxmLnNldFBhZ2VTaXplKHNlbGYucGFnZVNpemVTZWxlY3QudmFsdWUpO1xuXHRcdFx0XHRzZWxmLnNldFBhZ2UoMSkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly9hcHBlbmQgdG8gRE9NXG5cdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHNlbGYuZmlyc3RCdXQpO1xuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLnByZXZCdXQpO1xuXHRcdHNlbGYuZWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLnBhZ2VzRWxlbWVudCk7XG5cdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHNlbGYubmV4dEJ1dCk7XG5cdFx0c2VsZi5lbGVtZW50LmFwcGVuZENoaWxkKHNlbGYubGFzdEJ1dCk7XG5cblx0XHRpZiAoIXNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uRWxlbWVudCAmJiAhaGlkZGVuKSB7XG5cdFx0XHRzZWxmLnRhYmxlLmZvb3Rlck1hbmFnZXIuYXBwZW5kKHNlbGYuZWxlbWVudCwgc2VsZik7XG5cdFx0fVxuXG5cdFx0Ly9zZXQgZGVmYXVsdCB2YWx1ZXNcblx0XHRzZWxmLm1vZGUgPSBzZWxmLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbjtcblxuXHRcdHNlbGYuc2l6ZSA9IHNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uU2l6ZSB8fCBNYXRoLmZsb29yKHNlbGYudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuY2xpZW50SGVpZ2h0IC8gMjQpO1xuXHRcdC8vIHNlbGYucGFnZSA9IHNlbGYudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgfHwgMTtcblx0XHRzZWxmLmNvdW50ID0gc2VsZi50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25CdXR0b25Db3VudDtcblxuXHRcdHNlbGYuZ2VuZXJhdGVQYWdlU2l6ZVNlbGVjdExpc3QoKTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5pbml0aWFsaXplUHJvZ3Jlc3NpdmUgPSBmdW5jdGlvbiAobW9kZSkge1xuXHRcdHRoaXMuaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHR0aGlzLm1vZGUgPSBcInByb2dyZXNzaXZlX1wiICsgbW9kZTtcblx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IHRydWU7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuc2V0RGlzcGxheUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdFx0dGhpcy5kaXNwbGF5SW5kZXggPSBpbmRleDtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5nZXREaXNwbGF5SW5kZXggPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheUluZGV4O1xuXHR9O1xuXG5cdC8vY2FsY3VsYXRlIG1heGltdW0gcGFnZSBmcm9tIG51bWJlciBvZiByb3dzXG5cdFBhZ2UucHJvdG90eXBlLnNldE1heFJvd3MgPSBmdW5jdGlvbiAocm93Q291bnQpIHtcblx0XHRpZiAoIXJvd0NvdW50KSB7XG5cdFx0XHR0aGlzLm1heCA9IDE7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubWF4ID0gTWF0aC5jZWlsKHJvd0NvdW50IC8gdGhpcy5zaXplKTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYWdlID4gdGhpcy5tYXgpIHtcblx0XHRcdHRoaXMucGFnZSA9IHRoaXMubWF4O1xuXHRcdH1cblx0fTtcblxuXHQvL3Jlc2V0IHRvIGZpcnN0IHBhZ2Ugd2l0aG91dCB0cmlnZ2VyaW5nIGFjdGlvblxuXHRQYWdlLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uIChmb3JjZSwgY29sdW1uc0NoYW5nZWQpIHtcblx0XHRpZiAodGhpcy5tb2RlID09IFwibG9jYWxcIiB8fCBmb3JjZSkge1xuXHRcdFx0dGhpcy5wYWdlID0gMTtcblx0XHR9XG5cblx0XHRpZiAoY29sdW1uc0NoYW5nZWQpIHtcblx0XHRcdHRoaXMuaW5pdGlhbExvYWQgPSB0cnVlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9O1xuXG5cdC8vc2V0IHRoZSBtYXhtdW0gcGFnZVxuXHRQYWdlLnByb3RvdHlwZS5zZXRNYXhQYWdlID0gZnVuY3Rpb24gKG1heCkge1xuXG5cdFx0bWF4ID0gcGFyc2VJbnQobWF4KTtcblxuXHRcdHRoaXMubWF4ID0gbWF4IHx8IDE7XG5cblx0XHRpZiAodGhpcy5wYWdlID4gdGhpcy5tYXgpIHtcblx0XHRcdHRoaXMucGFnZSA9IHRoaXMubWF4O1xuXHRcdFx0dGhpcy50cmlnZ2VyKCk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2V0IGN1cnJlbnQgcGFnZSBudW1iZXJcblx0UGFnZS5wcm90b3R5cGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XG5cdFx0dmFyIF90aGlzNjMgPSB0aGlzO1xuXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdFx0cGFnZSA9IHBhcnNlSW50KHBhZ2UpO1xuXG5cdFx0XHRpZiAocGFnZSA+IDAgJiYgcGFnZSA8PSBfdGhpczYzLm1heCkge1xuXHRcdFx0XHRfdGhpczYzLnBhZ2UgPSBwYWdlO1xuXHRcdFx0XHRfdGhpczYzLnRyaWdnZXIoKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiBzZWxmLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHNlbGYudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcucGFnZSkge1xuXHRcdFx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwicGFnZVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiUGFnaW5hdGlvbiBFcnJvciAtIFJlcXVlc3RlZCBwYWdlIGlzIG91dCBvZiByYW5nZSBvZiAxIC0gXCIgKyBfdGhpczYzLm1heCArIFwiOlwiLCBwYWdlKTtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuc2V0UGFnZVRvUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBfdGhpczY0ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdHZhciByb3dzID0gX3RoaXM2NC50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKF90aGlzNjQuZGlzcGxheUluZGV4IC0gMSk7XG5cdFx0XHR2YXIgaW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0dmFyIHBhZ2UgPSBNYXRoLmNlaWwoKGluZGV4ICsgMSkgLyBfdGhpczY0LnNpemUpO1xuXG5cdFx0XHRcdF90aGlzNjQuc2V0UGFnZShwYWdlKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gUmVxdWVzdGVkIHJvdyBpcyBub3QgdmlzaWJsZVwiKTtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuc2V0UGFnZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuXHRcdHNpemUgPSBwYXJzZUludChzaXplKTtcblxuXHRcdGlmIChzaXplID4gMCkge1xuXHRcdFx0dGhpcy5zaXplID0gc2l6ZTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wYWdlU2l6ZVNlbGVjdCkge1xuXHRcdFx0Ly8gdGhpcy5wYWdlU2l6ZVNlbGVjdC52YWx1ZSA9IHNpemU7XG5cdFx0XHR0aGlzLmdlbmVyYXRlUGFnZVNpemVTZWxlY3RMaXN0KCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcucGFnZSkge1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJwYWdlXCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL3NldHVwIHRoZSBwYWdpbmF0aW9uIGJ1dHRvbnNcblx0UGFnZS5wcm90b3R5cGUuX3NldFBhZ2VCdXR0b25zID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHZhciBsZWZ0U2l6ZSA9IE1hdGguZmxvb3IoKHRoaXMuY291bnQgLSAxKSAvIDIpO1xuXHRcdHZhciByaWdodFNpemUgPSBNYXRoLmNlaWwoKHRoaXMuY291bnQgLSAxKSAvIDIpO1xuXHRcdHZhciBtaW4gPSB0aGlzLm1heCAtIHRoaXMucGFnZSArIGxlZnRTaXplICsgMSA8IHRoaXMuY291bnQgPyB0aGlzLm1heCAtIHRoaXMuY291bnQgKyAxIDogTWF0aC5tYXgodGhpcy5wYWdlIC0gbGVmdFNpemUsIDEpO1xuXHRcdHZhciBtYXggPSB0aGlzLnBhZ2UgPD0gcmlnaHRTaXplID8gTWF0aC5taW4odGhpcy5jb3VudCwgdGhpcy5tYXgpIDogTWF0aC5taW4odGhpcy5wYWdlICsgcmlnaHRTaXplLCB0aGlzLm1heCk7XG5cblx0XHR3aGlsZSAoc2VsZi5wYWdlc0VsZW1lbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0c2VsZi5wYWdlc0VsZW1lbnQucmVtb3ZlQ2hpbGQoc2VsZi5wYWdlc0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0fWlmIChzZWxmLnBhZ2UgPT0gMSkge1xuXHRcdFx0c2VsZi5maXJzdEJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdFx0XHRzZWxmLnByZXZCdXQuZGlzYWJsZWQgPSB0cnVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZWxmLmZpcnN0QnV0LmRpc2FibGVkID0gZmFsc2U7XG5cdFx0XHRzZWxmLnByZXZCdXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRpZiAoc2VsZi5wYWdlID09IHNlbGYubWF4KSB7XG5cdFx0XHRzZWxmLmxhc3RCdXQuZGlzYWJsZWQgPSB0cnVlO1xuXHRcdFx0c2VsZi5uZXh0QnV0LmRpc2FibGVkID0gdHJ1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5sYXN0QnV0LmRpc2FibGVkID0gZmFsc2U7XG5cdFx0XHRzZWxmLm5leHRCdXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRmb3IgKHZhciBpID0gbWluOyBpIDw9IG1heDsgaSsrKSB7XG5cdFx0XHRpZiAoaSA+IDAgJiYgaSA8PSBzZWxmLm1heCkge1xuXHRcdFx0XHRzZWxmLnBhZ2VzRWxlbWVudC5hcHBlbmRDaGlsZChzZWxmLl9nZW5lcmF0ZVBhZ2VCdXR0b24oaSkpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuZm9vdGVyUmVkcmF3KCk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuX2dlbmVyYXRlUGFnZUJ1dHRvbiA9IGZ1bmN0aW9uIChwYWdlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuXG5cdFx0YnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnZVwiKTtcblx0XHRpZiAocGFnZSA9PSBzZWxmLnBhZ2UpIHtcblx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdH1cblxuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiU2hvdyBQYWdlIFwiICsgcGFnZSk7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIFwiU2hvdyBQYWdlIFwiICsgcGFnZSk7XG5cdFx0YnV0dG9uLnNldEF0dHJpYnV0ZShcImRhdGEtcGFnZVwiLCBwYWdlKTtcblx0XHRidXR0b24udGV4dENvbnRlbnQgPSBwYWdlO1xuXG5cdFx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0c2VsZi5zZXRQYWdlKHBhZ2UpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGJ1dHRvbjtcblx0fTtcblxuXHQvL3ByZXZpb3VzIHBhZ2Vcblx0UGFnZS5wcm90b3R5cGUucHJldmlvdXNQYWdlID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBfdGhpczY1ID0gdGhpcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRpZiAoX3RoaXM2NS5wYWdlID4gMSkge1xuXHRcdFx0XHRfdGhpczY1LnBhZ2UtLTtcblx0XHRcdFx0X3RoaXM2NS50cmlnZ2VyKCkudGhlbihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChfdGhpczY1LnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgX3RoaXM2NS50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiBfdGhpczY1LnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLnBhZ2UpIHtcblx0XHRcdFx0XHRfdGhpczY1LnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2Uuc2F2ZShcInBhZ2VcIik7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2luYXRpb24gRXJyb3IgLSBQcmV2aW91cyBwYWdlIHdvdWxkIGJlIGxlc3MgdGhhbiBwYWdlIDE6XCIsIDApO1xuXHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHQvL25leHQgcGFnZVxuXHRQYWdlLnByb3RvdHlwZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM2NiA9IHRoaXM7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0aWYgKF90aGlzNjYucGFnZSA8IF90aGlzNjYubWF4KSB7XG5cdFx0XHRcdF90aGlzNjYucGFnZSsrO1xuXHRcdFx0XHRfdGhpczY2LnRyaWdnZXIoKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKF90aGlzNjYudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiBfdGhpczY2LnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIF90aGlzNjYudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcucGFnZSkge1xuXHRcdFx0XHRcdF90aGlzNjYudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5zYXZlKFwicGFnZVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKCFfdGhpczY2LnByb2dyZXNzaXZlTG9hZCkge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2luYXRpb24gRXJyb3IgLSBOZXh0IHBhZ2Ugd291bGQgYmUgZ3JlYXRlciB0aGFuIG1heGltdW0gcGFnZSBvZiBcIiArIF90aGlzNjYubWF4ICsgXCI6XCIsIF90aGlzNjYubWF4ICsgMSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9yZXR1cm4gY3VycmVudCBwYWdlIG51bWJlclxuXHRQYWdlLnByb3RvdHlwZS5nZXRQYWdlID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLnBhZ2U7XG5cdH07XG5cblx0Ly9yZXR1cm4gbWF4IHBhZ2UgbnVtYmVyXG5cdFBhZ2UucHJvdG90eXBlLmdldFBhZ2VNYXggPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMubWF4O1xuXHR9O1xuXG5cdFBhZ2UucHJvdG90eXBlLmdldFBhZ2VTaXplID0gZnVuY3Rpb24gKHNpemUpIHtcblx0XHRyZXR1cm4gdGhpcy5zaXplO1xuXHR9O1xuXG5cdFBhZ2UucHJvdG90eXBlLmdldE1vZGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMubW9kZTtcblx0fTtcblxuXHQvL3JldHVybiBhcHByb3ByaWF0ZSByb3dzIGZvciBjdXJyZW50IHBhZ2Vcblx0UGFnZS5wcm90b3R5cGUuZ2V0Um93cyA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIG91dHB1dCwgc3RhcnQsIGVuZDtcblxuXHRcdGlmICh0aGlzLm1vZGUgPT0gXCJsb2NhbFwiKSB7XG5cdFx0XHRvdXRwdXQgPSBbXTtcblx0XHRcdHN0YXJ0ID0gdGhpcy5zaXplICogKHRoaXMucGFnZSAtIDEpO1xuXHRcdFx0ZW5kID0gc3RhcnQgKyBwYXJzZUludCh0aGlzLnNpemUpO1xuXG5cdFx0XHR0aGlzLl9zZXRQYWdlQnV0dG9ucygpO1xuXG5cdFx0XHRmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuXHRcdFx0XHRpZiAoZGF0YVtpXSkge1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKGRhdGFbaV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5fc2V0UGFnZUJ1dHRvbnMoKTtcblxuXHRcdFx0cmV0dXJuIGRhdGEuc2xpY2UoMCk7XG5cdFx0fVxuXHR9O1xuXG5cdFBhZ2UucHJvdG90eXBlLnRyaWdnZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzNjcgPSB0aGlzO1xuXG5cdFx0dmFyIGxlZnQ7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG5cdFx0XHRzd2l0Y2ggKF90aGlzNjcubW9kZSkge1xuXHRcdFx0XHRjYXNlIFwibG9jYWxcIjpcblx0XHRcdFx0XHRsZWZ0ID0gX3RoaXM2Ny50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbExlZnQ7XG5cblx0XHRcdFx0XHRfdGhpczY3LnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoXCJwYWdlXCIpO1xuXHRcdFx0XHRcdF90aGlzNjcudGFibGUucm93TWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXG5cdFx0XHRcdFx0X3RoaXM2Ny50YWJsZS5vcHRpb25zLnBhZ2VMb2FkZWQuY2FsbChfdGhpczY3LnRhYmxlLCBfdGhpczY3LmdldFBhZ2UoKSk7XG5cdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJyZW1vdGVcIjpcblx0XHRcdFx0Y2FzZSBcInByb2dyZXNzaXZlX2xvYWRcIjpcblx0XHRcdFx0Y2FzZSBcInByb2dyZXNzaXZlX3Njcm9sbFwiOlxuXHRcdFx0XHRcdF90aGlzNjcudGFibGUubW9kdWxlcy5hamF4LmJsb2NrQWN0aXZlUmVxdWVzdCgpO1xuXHRcdFx0XHRcdF90aGlzNjcuX2dldFJlbW90ZVBhZ2UoKS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2luYXRpb24gRXJyb3IgLSBubyBzdWNoIHBhZ2luYXRpb24gbW9kZTpcIiwgX3RoaXM2Ny5tb2RlKTtcblx0XHRcdFx0XHRyZWplY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRQYWdlLnByb3RvdHlwZS5fZ2V0UmVtb3RlUGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgX3RoaXM2OCA9IHRoaXM7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIG9sZFBhcmFtcyxcblx0XHQgICAgcGFnZVBhcmFtcztcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cblx0XHRcdGlmICghc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJhamF4XCIsIHRydWUpKSB7XG5cdFx0XHRcdHJlamVjdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3JlY29yZCBvbGQgcGFyYW1zIGFuZCByZXN0b3JlIGFmdGVyIHJlcXVlc3QgaGFzIGJlZW4gbWFkZVxuXHRcdFx0b2xkUGFyYW1zID0gVGFidWxhdG9yLnByb3RvdHlwZS5oZWxwZXJzLmRlZXBDbG9uZShzZWxmLnRhYmxlLm1vZHVsZXMuYWpheC5nZXRQYXJhbXMoKSB8fCB7fSk7XG5cdFx0XHRwYWdlUGFyYW1zID0gc2VsZi50YWJsZS5tb2R1bGVzLmFqYXguZ2V0UGFyYW1zKCk7XG5cblx0XHRcdC8vY29uZmlndXJlIHJlcXVlc3QgcGFyYW1zXG5cdFx0XHRwYWdlUGFyYW1zW190aGlzNjgucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMucGFnZV0gPSBzZWxmLnBhZ2U7XG5cblx0XHRcdC8vc2V0IHBhZ2Ugc2l6ZSBpZiBkZWZpbmVkXG5cdFx0XHRpZiAoX3RoaXM2OC5zaXplKSB7XG5cdFx0XHRcdHBhZ2VQYXJhbXNbX3RoaXM2OC5wYWdpbmF0aW9uRGF0YVNlbnROYW1lcy5zaXplXSA9IF90aGlzNjguc2l6ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgc29ydCBkYXRhIGlmIGRlZmluZWRcblx0XHRcdGlmIChfdGhpczY4LnRhYmxlLm9wdGlvbnMuYWpheFNvcnRpbmcgJiYgX3RoaXM2OC50YWJsZS5tb2RFeGlzdHMoXCJzb3J0XCIpKSB7XG5cdFx0XHRcdHZhciBzb3J0ZXJzID0gc2VsZi50YWJsZS5tb2R1bGVzLnNvcnQuZ2V0U29ydCgpO1xuXG5cdFx0XHRcdHNvcnRlcnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdGRlbGV0ZSBpdGVtLmNvbHVtbjtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cGFnZVBhcmFtc1tfdGhpczY4LnBhZ2luYXRpb25EYXRhU2VudE5hbWVzLnNvcnRlcnNdID0gc29ydGVycztcblx0XHRcdH1cblxuXHRcdFx0Ly9zZXQgZmlsdGVyIGRhdGEgaWYgZGVmaW5lZFxuXHRcdFx0aWYgKF90aGlzNjgudGFibGUub3B0aW9ucy5hamF4RmlsdGVyaW5nICYmIF90aGlzNjgudGFibGUubW9kRXhpc3RzKFwiZmlsdGVyXCIpKSB7XG5cdFx0XHRcdHZhciBmaWx0ZXJzID0gc2VsZi50YWJsZS5tb2R1bGVzLmZpbHRlci5nZXRGaWx0ZXJzKHRydWUsIHRydWUpO1xuXHRcdFx0XHRwYWdlUGFyYW1zW190aGlzNjgucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMuZmlsdGVyc10gPSBmaWx0ZXJzO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnRhYmxlLm1vZHVsZXMuYWpheC5zZXRQYXJhbXMocGFnZVBhcmFtcyk7XG5cblx0XHRcdHNlbGYudGFibGUubW9kdWxlcy5hamF4LnNlbmRSZXF1ZXN0KF90aGlzNjgucHJvZ3Jlc3NpdmVMb2FkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdHNlbGYuX3BhcnNlUmVtb3RlRGF0YShkYXRhKTtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0cmVqZWN0KCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLmFqYXguc2V0UGFyYW1zKG9sZFBhcmFtcyk7XG5cdFx0fSk7XG5cdH07XG5cblx0UGFnZS5wcm90b3R5cGUuX3BhcnNlUmVtb3RlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBsZWZ0LFxuXHRcdCAgICBkYXRhLFxuXHRcdCAgICBtYXJnaW47XG5cblx0XHRpZiAodHlwZW9mIGRhdGFbdGhpcy5wYWdpbmF0aW9uRGF0YVJlY2VpdmVkTmFtZXMubGFzdF9wYWdlXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiUmVtb3RlIFBhZ2luYXRpb24gRXJyb3IgLSBTZXJ2ZXIgcmVzcG9uc2UgbWlzc2luZyAnXCIgKyB0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcy5sYXN0X3BhZ2UgKyBcIicgcHJvcGVydHlcIik7XG5cdFx0fVxuXG5cdFx0aWYgKGRhdGFbdGhpcy5wYWdpbmF0aW9uRGF0YVJlY2VpdmVkTmFtZXMuZGF0YV0pIHtcblx0XHRcdHRoaXMubWF4ID0gcGFyc2VJbnQoZGF0YVt0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcy5sYXN0X3BhZ2VdKSB8fCAxO1xuXG5cdFx0XHRpZiAodGhpcy5wcm9ncmVzc2l2ZUxvYWQpIHtcblx0XHRcdFx0c3dpdGNoICh0aGlzLm1vZGUpIHtcblx0XHRcdFx0XHRjYXNlIFwicHJvZ3Jlc3NpdmVfbG9hZFwiOlxuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5wYWdlID09IDEpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNldERhdGEoZGF0YVt0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcy5kYXRhXSwgZmFsc2UsIHRoaXMuaW5pdGlhbExvYWQgJiYgdGhpcy5wYWdlID09IDEpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd3MoZGF0YVt0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcy5kYXRhXSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLnBhZ2UgPCB0aGlzLm1heCkge1xuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLm5leHRQYWdlKCkudGhlbihmdW5jdGlvbiAoKSB7fSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuXHRcdFx0XHRcdFx0XHR9LCBzZWxmLnRhYmxlLm9wdGlvbnMuYWpheFByb2dyZXNzaXZlTG9hZERlbGF5KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInByb2dyZXNzaXZlX3Njcm9sbFwiOlxuXHRcdFx0XHRcdFx0ZGF0YSA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXREYXRhKCkuY29uY2F0KGRhdGFbdGhpcy5wYWdpbmF0aW9uRGF0YVJlY2VpdmVkTmFtZXMuZGF0YV0pO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLCB0cnVlLCB0aGlzLmluaXRpYWxMb2FkICYmIHRoaXMucGFnZSA9PSAxKTtcblxuXHRcdFx0XHRcdFx0bWFyZ2luID0gdGhpcy50YWJsZS5vcHRpb25zLmFqYXhQcm9ncmVzc2l2ZUxvYWRTY3JvbGxNYXJnaW4gfHwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50SGVpZ2h0ICogMjtcblxuXHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbEhlaWdodCA8PSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQgKyBtYXJnaW4pIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5uZXh0UGFnZSgpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsZWZ0ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbExlZnQ7XG5cblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNldERhdGEoZGF0YVt0aGlzLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcy5kYXRhXSwgZmFsc2UsIHRoaXMuaW5pdGlhbExvYWQgJiYgdGhpcy5wYWdlID09IDEpO1xuXG5cdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXG5cdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wYWdlTG9hZGVkLmNhbGwodGhpcy50YWJsZSwgdGhpcy5nZXRQYWdlKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmluaXRpYWxMb2FkID0gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIlJlbW90ZSBQYWdpbmF0aW9uIEVycm9yIC0gU2VydmVyIHJlc3BvbnNlIG1pc3NpbmcgJ1wiICsgdGhpcy5wYWdpbmF0aW9uRGF0YVJlY2VpdmVkTmFtZXMuZGF0YSArIFwiJyBwcm9wZXJ0eVwiKTtcblx0XHR9XG5cdH07XG5cblx0Ly9oYW5kbGUgdGhlIGZvb3RlciBlbGVtZW50IGJlaW5nIHJlZHJhd25cblx0UGFnZS5wcm90b3R5cGUuZm9vdGVyUmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBmb290ZXIgPSB0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIuZWxlbWVudDtcblxuXHRcdGlmIChNYXRoLmNlaWwoZm9vdGVyLmNsaWVudFdpZHRoKSAtIGZvb3Rlci5zY3JvbGxXaWR0aCA8IDApIHtcblx0XHRcdHRoaXMucGFnZXNFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMucGFnZXNFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcblxuXHRcdFx0aWYgKE1hdGguY2VpbChmb290ZXIuY2xpZW50V2lkdGgpIC0gZm9vdGVyLnNjcm9sbFdpZHRoIDwgMCkge1xuXHRcdFx0XHR0aGlzLnBhZ2VzRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3NldCB0aGUgcGFyYW10ZXIgbmFtZXMgZm9yIHBhZ2luYXRpb24gcmVxdWVzdHNcblx0UGFnZS5wcm90b3R5cGUucGFnaW5hdGlvbkRhdGFTZW50TmFtZXMgPSB7XG5cdFx0XCJwYWdlXCI6IFwicGFnZVwiLFxuXHRcdFwic2l6ZVwiOiBcInNpemVcIixcblx0XHRcInNvcnRlcnNcIjogXCJzb3J0ZXJzXCIsXG5cdFx0Ly8gXCJzb3J0X2RpclwiOlwic29ydF9kaXJcIixcblx0XHRcImZpbHRlcnNcIjogXCJmaWx0ZXJzXCJcblx0XHQvLyBcImZpbHRlcl92YWx1ZVwiOlwiZmlsdGVyX3ZhbHVlXCIsXG5cdFx0Ly8gXCJmaWx0ZXJfdHlwZVwiOlwiZmlsdGVyX3R5cGVcIixcblx0fTtcblxuXHQvL3NldCB0aGUgcHJvcGVydHkgbmFtZXMgZm9yIHBhZ2luYXRpb24gcmVzcG9uc2VzXG5cdFBhZ2UucHJvdG90eXBlLnBhZ2luYXRpb25EYXRhUmVjZWl2ZWROYW1lcyA9IHtcblx0XHRcImN1cnJlbnRfcGFnZVwiOiBcImN1cnJlbnRfcGFnZVwiLFxuXHRcdFwibGFzdF9wYWdlXCI6IFwibGFzdF9wYWdlXCIsXG5cdFx0XCJkYXRhXCI6IFwiZGF0YVwiXG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInBhZ2VcIiwgUGFnZSk7XG5cblx0dmFyIFBlcnNpc3RlbmNlID0gZnVuY3Rpb24gUGVyc2lzdGVuY2UodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5tb2RlID0gXCJcIjtcblx0XHR0aGlzLmlkID0gXCJcIjtcblx0XHQvLyB0aGlzLnBlcnNpc3RQcm9wcyA9IFtcImZpZWxkXCIsIFwid2lkdGhcIiwgXCJ2aXNpYmxlXCJdO1xuXHRcdHRoaXMuZGVmV2F0Y2hlckJsb2NrID0gZmFsc2U7XG5cdFx0dGhpcy5jb25maWcgPSB7fTtcblx0XHR0aGlzLnJlYWRGdW5jID0gZmFsc2U7XG5cdFx0dGhpcy53cml0ZUZ1bmMgPSBmYWxzZTtcblx0fTtcblxuXHQvLyBUZXN0IGZvciB3aGV0aGVyIGxvY2FsU3RvcmFnZSBpcyBhdmFpbGFibGUgZm9yIHVzZS5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmxvY2FsU3RvcmFnZVRlc3QgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHRlc3RLZXkgPSBcIl90YWJ1bGF0b3JfdGVzdFwiO1xuXG5cdFx0dHJ5IHtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0ZXN0S2V5LCB0ZXN0S2V5KTtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0ZXN0S2V5KTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0Ly9zZXR1cCBwYXJhbWV0ZXJzXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXHRcdC8vZGV0ZXJtaW5lIHBlcnNpc3RlbnQgbGF5b3V0IHN0b3JhZ2UgdHlwZVxuXG5cdFx0dmFyIG1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VNb2RlLFxuXHRcdCAgICBpZCA9IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZUlELFxuXHRcdCAgICByZXRyZWl2ZWREYXRhO1xuXG5cdFx0dGhpcy5tb2RlID0gbW9kZSAhPT0gdHJ1ZSA/IG1vZGUgOiB0aGlzLmxvY2FsU3RvcmFnZVRlc3QoKSA/IFwibG9jYWxcIiA6IFwiY29va2llXCI7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlUmVhZGVyRnVuYykge1xuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0dGhpcy5yZWFkRnVuYyA9IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmM7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodGhpcy5yZWFkZXJzW3RoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmNdKSB7XG5cdFx0XHRcdFx0dGhpcy5yZWFkRnVuYyA9IHRoaXMucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh0aGlzLnJlYWRlcnNbdGhpcy5tb2RlXSkge1xuXHRcdFx0XHR0aGlzLnJlYWRGdW5jID0gdGhpcy5yZWFkZXJzW3RoaXMubW9kZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMubW9kZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVdyaXRlckZ1bmMpIHtcblx0XHRcdGlmICh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYyA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdHRoaXMud3JpdGVGdW5jID0gdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmICh0aGlzLnJlYWRlcnNbdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuY10pIHtcblx0XHRcdFx0XHR0aGlzLndyaXRlRnVuYyA9IHRoaXMucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VXcml0ZXJGdW5jXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBXcml0ZSBFcnJvciAtIGludmFsaWQgcmVhZGVyIHNldFwiLCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VXcml0ZXJGdW5jKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpcy53cml0ZXJzW3RoaXMubW9kZV0pIHtcblx0XHRcdFx0dGhpcy53cml0ZUZ1bmMgPSB0aGlzLndyaXRlcnNbdGhpcy5tb2RlXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlBlcnNpc3RlbmNlIFdyaXRlIEVycm9yIC0gaW52YWxpZCB3cml0ZXIgc2V0XCIsIHRoaXMubW9kZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9zZXQgc3RvcmFnZSB0YWdcblx0XHR0aGlzLmlkID0gXCJ0YWJ1bGF0b3ItXCIgKyAoaWQgfHwgdGhpcy50YWJsZS5lbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpIHx8IFwiXCIpO1xuXG5cdFx0dGhpcy5jb25maWcgPSB7XG5cdFx0XHRzb3J0OiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLnNvcnQsXG5cdFx0XHRmaWx0ZXI6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UuZmlsdGVyLFxuXHRcdFx0Z3JvdXA6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UuZ3JvdXAsXG5cdFx0XHRwYWdlOiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLnBhZ2UsXG5cdFx0XHRjb2x1bW5zOiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgPyBbXCJ0aXRsZVwiLCBcIndpZHRoXCIsIFwidmlzaWJsZVwiXSA6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZS5jb2x1bW5zXG5cdFx0fTtcblxuXHRcdC8vbG9hZCBwYWdpbmF0aW9uIGRhdGEgaWYgbmVlZGVkXG5cdFx0aWYgKHRoaXMuY29uZmlnLnBhZ2UpIHtcblx0XHRcdHJldHJlaXZlZERhdGEgPSB0aGlzLnJldHJlaXZlRGF0YShcInBhZ2VcIik7XG5cblx0XHRcdGlmIChyZXRyZWl2ZWREYXRhKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uU2l6ZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAodGhpcy5jb25maWcucGFnZSA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5wYWdlLnNpemUpKSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplID0gcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uU2l6ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLnBhZ2UgPT09IHRydWUgfHwgdGhpcy5jb25maWcucGFnZS5wYWdlKSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgPSByZXRyZWl2ZWREYXRhLnBhZ2luYXRpb25Jbml0aWFsUGFnZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vbG9hZCBncm91cCBkYXRhIGlmIG5lZWRlZFxuXHRcdGlmICh0aGlzLmNvbmZpZy5ncm91cCkge1xuXHRcdFx0cmV0cmVpdmVkRGF0YSA9IHRoaXMucmV0cmVpdmVEYXRhKFwiZ3JvdXBcIik7XG5cblx0XHRcdGlmIChyZXRyZWl2ZWREYXRhKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5ncm91cEJ5ICE9PSBcInVuZGVmaW5lZFwiICYmICh0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ID0gcmV0cmVpdmVkRGF0YS5ncm91cEJ5O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh0eXBlb2YgcmV0cmVpdmVkRGF0YS5ncm91cFN0YXJ0T3BlbiAhPT0gXCJ1bmRlZmluZWRcIiAmJiAodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBTdGFydE9wZW4pKSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmdyb3VwU3RhcnRPcGVuID0gcmV0cmVpdmVkRGF0YS5ncm91cFN0YXJ0T3Blbjtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAodHlwZW9mIHJldHJlaXZlZERhdGEuZ3JvdXBIZWFkZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwSGVhZGVyKSkge1xuXHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEhlYWRlciA9IHJldHJlaXZlZERhdGEuZ3JvdXBIZWFkZXI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWYsXG5cdFx0ICAgIGtleXM7XG5cblx0XHRpZiAodGhpcy5jb25maWcuY29sdW1ucykge1xuXHRcdFx0dGhpcy5kZWZXYXRjaGVyQmxvY2sgPSB0cnVlO1xuXG5cdFx0XHRkZWYgPSBjb2x1bW4uZ2V0RGVmaW5pdGlvbigpO1xuXG5cdFx0XHRrZXlzID0gdGhpcy5jb25maWcuY29sdW1ucyA9PT0gdHJ1ZSA/IE9iamVjdC5rZXlzKGRlZikgOiB0aGlzLmNvbmZpZy5jb2x1bW5zO1xuXG5cdFx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXHRcdFx0XHR2YXIgcHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRlZiwga2V5KTtcblx0XHRcdFx0dmFyIHZhbHVlID0gZGVmW2tleV07XG5cdFx0XHRcdGlmIChwcm9wcykge1xuXHRcdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZWYsIGtleSwge1xuXHRcdFx0XHRcdFx0c2V0OiBmdW5jdGlvbiBzZXQobmV3VmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBuZXdWYWx1ZTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXNlbGYuZGVmV2F0Y2hlckJsb2NrKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmIChwcm9wcy5zZXQpIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wcy5zZXQobmV3VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0Z2V0OiBmdW5jdGlvbiBnZXQoKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChwcm9wcy5nZXQpIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wcy5nZXQoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmRlZldhdGNoZXJCbG9jayA9IGZhbHNlO1xuXHRcdH1cblx0fTtcblxuXHQvL2xvYWQgc2F2ZWQgZGVmaW5pdGlvbnNcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAodHlwZSwgY3VycmVudCkge1xuXHRcdHZhciBkYXRhID0gdGhpcy5yZXRyZWl2ZURhdGEodHlwZSk7XG5cblx0XHRpZiAoY3VycmVudCkge1xuXHRcdFx0ZGF0YSA9IGRhdGEgPyB0aGlzLm1lcmdlRGVmaW5pdGlvbihjdXJyZW50LCBkYXRhKSA6IGN1cnJlbnQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0Ly9yZXRyZWl2ZSBkYXRhIGZyb20gbWVtb3J5XG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5yZXRyZWl2ZURhdGEgPSBmdW5jdGlvbiAodHlwZSkge1xuXHRcdHJldHVybiB0aGlzLnJlYWRGdW5jID8gdGhpcy5yZWFkRnVuYyh0aGlzLmlkLCB0eXBlKSA6IGZhbHNlO1xuXHR9O1xuXG5cdC8vbWVyZ2Ugb2xkIGFuZCBuZXcgY29sdW1uIGRlZmluaXRpb25zXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5tZXJnZURlZmluaXRpb24gPSBmdW5jdGlvbiAob2xkQ29scywgbmV3Q29scykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgb3V0cHV0ID0gW107XG5cblx0XHQvLyBvbGRDb2xzID0gb2xkQ29scyB8fCBbXTtcblx0XHRuZXdDb2xzID0gbmV3Q29scyB8fCBbXTtcblxuXHRcdG5ld0NvbHMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCB0bykge1xuXG5cdFx0XHR2YXIgZnJvbSA9IHNlbGYuX2ZpbmRDb2x1bW4ob2xkQ29scywgY29sdW1uKSxcblx0XHRcdCAgICBrZXlzO1xuXG5cdFx0XHRpZiAoZnJvbSkge1xuXG5cdFx0XHRcdGlmIChzZWxmLmNvbmZpZy5jb2x1bW5zID09PSB0cnVlIHx8IHNlbGYuY29uZmlnLmNvbHVtbnMgPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0a2V5cyA9IE9iamVjdC5rZXlzKGZyb20pO1xuXHRcdFx0XHRcdGtleXMucHVzaChcIndpZHRoXCIpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGtleXMgPSBzZWxmLmNvbmZpZy5jb2x1bW5zO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0a2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbHVtbltrZXldICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRmcm9tW2tleV0gPSBjb2x1bW5ba2V5XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmcm9tLmNvbHVtbnMpIHtcblx0XHRcdFx0XHRmcm9tLmNvbHVtbnMgPSBzZWxmLm1lcmdlRGVmaW5pdGlvbihmcm9tLmNvbHVtbnMsIGNvbHVtbi5jb2x1bW5zKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGZyb20pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0b2xkQ29scy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGkpIHtcblx0XHRcdHZhciBmcm9tID0gc2VsZi5fZmluZENvbHVtbihuZXdDb2xzLCBjb2x1bW4pO1xuXHRcdFx0aWYgKCFmcm9tKSB7XG5cdFx0XHRcdGlmIChvdXRwdXQubGVuZ3RoID4gaSkge1xuXHRcdFx0XHRcdG91dHB1dC5zcGxpY2UoaSwgMCwgY29sdW1uKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjb2x1bW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdC8vZmluZCBtYXRjaGluZyBjb2x1bW5zXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5fZmluZENvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW5zLCBzdWJqZWN0KSB7XG5cdFx0dmFyIHR5cGUgPSBzdWJqZWN0LmNvbHVtbnMgPyBcImdyb3VwXCIgOiBzdWJqZWN0LmZpZWxkID8gXCJmaWVsZFwiIDogXCJvYmplY3RcIjtcblxuXHRcdHJldHVybiBjb2x1bW5zLmZpbmQoZnVuY3Rpb24gKGNvbCkge1xuXHRcdFx0c3dpdGNoICh0eXBlKSB7XG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wudGl0bGUgPT09IHN1YmplY3QudGl0bGUgJiYgY29sLmNvbHVtbnMubGVuZ3RoID09PSBzdWJqZWN0LmNvbHVtbnMubGVuZ3RoO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmaWVsZFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wuZmllbGQgPT09IHN1YmplY3QuZmllbGQ7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRcdHJldHVybiBjb2wgPT09IHN1YmplY3Q7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9zYXZlIGRhdGFcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAodHlwZSkge1xuXHRcdHZhciBkYXRhID0ge307XG5cblx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdGNhc2UgXCJjb2x1bW5zXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLnBhcnNlQ29sdW1ucyh0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1ucygpKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmaWx0ZXJcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZ2V0RmlsdGVycygpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInNvcnRcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMudmFsaWRhdGVTb3J0ZXJzKHRoaXMudGFibGUubW9kdWxlcy5zb3J0LmdldFNvcnQoKSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZ3JvdXBcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMuZ2V0R3JvdXBDb25maWcoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJwYWdlXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLmdldFBhZ2VDb25maWcoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMud3JpdGVGdW5jKSB7XG5cdFx0XHR0aGlzLndyaXRlRnVuYyh0aGlzLmlkLCB0eXBlLCBkYXRhKTtcblx0XHR9XG5cdH07XG5cblx0Ly9lbnN1cmUgc29ydGVycyBjb250YWluIG5vIGZ1bmN0aW9uIGRhdGFcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnZhbGlkYXRlU29ydGVycyA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRpdGVtLmNvbHVtbiA9IGl0ZW0uZmllbGQ7XG5cdFx0XHRkZWxldGUgaXRlbS5maWVsZDtcblx0XHR9KTtcblxuXHRcdHJldHVybiBkYXRhO1xuXHR9O1xuXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5nZXRHcm91cENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5jb25maWcuZ3JvdXApIHtcblx0XHRcdGlmICh0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KSB7XG5cdFx0XHRcdGRhdGEuZ3JvdXBCeSA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBTdGFydE9wZW4pIHtcblx0XHRcdFx0ZGF0YS5ncm91cFN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwSGVhZGVyKSB7XG5cdFx0XHRcdGRhdGEuZ3JvdXBIZWFkZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBIZWFkZXI7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH07XG5cblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLmdldFBhZ2VDb25maWcgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGRhdGEgPSB7fTtcblxuXHRcdGlmICh0aGlzLmNvbmZpZy5wYWdlKSB7XG5cdFx0XHRpZiAodGhpcy5jb25maWcucGFnZSA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5wYWdlLnNpemUpIHtcblx0XHRcdFx0ZGF0YS5wYWdpbmF0aW9uU2l6ZSA9IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2VTaXplKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmNvbmZpZy5wYWdlID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLnBhZ2UucGFnZSkge1xuXHRcdFx0XHRkYXRhLnBhZ2luYXRpb25Jbml0aWFsUGFnZSA9IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2UoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHQvL3BhcnNlIGNvbHVtbnMgZm9yIGRhdGEgdG8gc3RvcmVcblx0UGVyc2lzdGVuY2UucHJvdG90eXBlLnBhcnNlQ29sdW1ucyA9IGZ1bmN0aW9uIChjb2x1bW5zKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkZWZpbml0aW9ucyA9IFtdO1xuXG5cdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHRcdHZhciBkZWZTdG9yZSA9IHt9LFxuXHRcdFx0ICAgIGNvbERlZiA9IGNvbHVtbi5nZXREZWZpbml0aW9uKCksXG5cdFx0XHQgICAga2V5cztcblxuXHRcdFx0aWYgKGNvbHVtbi5pc0dyb3VwKSB7XG5cdFx0XHRcdGRlZlN0b3JlLnRpdGxlID0gY29sRGVmLnRpdGxlO1xuXHRcdFx0XHRkZWZTdG9yZS5jb2x1bW5zID0gc2VsZi5wYXJzZUNvbHVtbnMoY29sdW1uLmdldENvbHVtbnMoKSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkZWZTdG9yZS5maWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRcdGlmIChzZWxmLmNvbmZpZy5jb2x1bW5zID09PSB0cnVlIHx8IHNlbGYuY29uZmlnLmNvbHVtbnMgPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0a2V5cyA9IE9iamVjdC5rZXlzKGNvbERlZik7XG5cdFx0XHRcdFx0a2V5cy5wdXNoKFwid2lkdGhcIik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0a2V5cyA9IHNlbGYuY29uZmlnLmNvbHVtbnM7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXG5cdFx0XHRcdFx0c3dpdGNoIChrZXkpIHtcblx0XHRcdFx0XHRcdGNhc2UgXCJ3aWR0aFwiOlxuXHRcdFx0XHRcdFx0XHRkZWZTdG9yZS53aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdGNhc2UgXCJ2aXNpYmxlXCI6XG5cdFx0XHRcdFx0XHRcdGRlZlN0b3JlLnZpc2libGUgPSBjb2x1bW4udmlzaWJsZTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdGRlZlN0b3JlW2tleV0gPSBjb2xEZWZba2V5XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZpbml0aW9ucy5wdXNoKGRlZlN0b3JlKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBkZWZpbml0aW9ucztcblx0fTtcblxuXHQvLyByZWFkIHBlcmlzdGVuY2UgaW5mb3JtYXRpb24gZnJvbSBzdG9yYWdlXG5cdFBlcnNpc3RlbmNlLnByb3RvdHlwZS5yZWFkZXJzID0ge1xuXHRcdGxvY2FsOiBmdW5jdGlvbiBsb2NhbChpZCwgdHlwZSkge1xuXHRcdFx0dmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShpZCArIFwiLVwiICsgdHlwZSk7XG5cblx0XHRcdHJldHVybiBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IGZhbHNlO1xuXHRcdH0sXG5cdFx0Y29va2llOiBmdW5jdGlvbiBjb29raWUoaWQsIHR5cGUpIHtcblx0XHRcdHZhciBjb29raWUgPSBkb2N1bWVudC5jb29raWUsXG5cdFx0XHQgICAga2V5ID0gaWQgKyBcIi1cIiArIHR5cGUsXG5cdFx0XHQgICAgY29va2llUG9zID0gY29va2llLmluZGV4T2Yoa2V5ICsgXCI9XCIpLFxuXHRcdFx0ICAgIGVuZCxcblx0XHRcdCAgICBkYXRhO1xuXG5cdFx0XHQvL2lmIGNvb2tpZSBleGlzdHMsIGRlY29kZSBhbmQgbG9hZCBjb2x1bW4gZGF0YSBpbnRvIHRhYnVsYXRvclxuXHRcdFx0aWYgKGNvb2tpZVBvcyA+IC0xKSB7XG5cdFx0XHRcdGNvb2tpZSA9IGNvb2tpZS5zdWJzdHIoY29va2llUG9zKTtcblxuXHRcdFx0XHRlbmQgPSBjb29raWUuaW5kZXhPZihcIjtcIik7XG5cblx0XHRcdFx0aWYgKGVuZCA+IC0xKSB7XG5cdFx0XHRcdFx0Y29va2llID0gY29va2llLnN1YnN0cigwLCBlbmQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YSA9IGNvb2tpZS5yZXBsYWNlKGtleSArIFwiPVwiLCBcIlwiKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGEgPyBKU09OLnBhcnNlKGRhdGEpIDogZmFsc2U7XG5cdFx0fVxuXHR9O1xuXG5cdC8vd3JpdGUgcGVyc2lzdGVuY2UgaW5mb3JtYXRpb24gdG8gc3RvcmFnZVxuXHRQZXJzaXN0ZW5jZS5wcm90b3R5cGUud3JpdGVycyA9IHtcblx0XHRsb2NhbDogZnVuY3Rpb24gbG9jYWwoaWQsIHR5cGUsIGRhdGEpIHtcblx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKGlkICsgXCItXCIgKyB0eXBlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cdFx0fSxcblx0XHRjb29raWU6IGZ1bmN0aW9uIGNvb2tpZShpZCwgdHlwZSwgZGF0YSkge1xuXHRcdFx0dmFyIGV4cGlyZURhdGUgPSBuZXcgRGF0ZSgpO1xuXG5cdFx0XHRleHBpcmVEYXRlLnNldERhdGUoZXhwaXJlRGF0ZS5nZXREYXRlKCkgKyAxMDAwMCk7XG5cblx0XHRcdGRvY3VtZW50LmNvb2tpZSA9IGlkICsgXCItXCIgKyB0eXBlICsgXCI9XCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSArIFwiOyBleHBpcmVzPVwiICsgZXhwaXJlRGF0ZS50b1VUQ1N0cmluZygpO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwicGVyc2lzdGVuY2VcIiwgUGVyc2lzdGVuY2UpO1xuXG5cdHZhciBQcmludCA9IGZ1bmN0aW9uIFByaW50KHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlOyAvL2hvbGQgVGFidWxhdG9yIG9iamVjdFxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMubWFudWFsQmxvY2sgPSBmYWxzZTtcblx0fTtcblxuXHRQcmludC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImJlZm9yZXByaW50XCIsIHRoaXMucmVwbGFjZVRhYmxlLmJpbmQodGhpcykpO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiYWZ0ZXJwcmludFwiLCB0aGlzLmNsZWFudXAuYmluZCh0aGlzKSk7XG5cdH07XG5cblx0UHJpbnQucHJvdG90eXBlLnJlcGxhY2VUYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoIXRoaXMubWFudWFsQmxvY2spIHtcblx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZVwiKTtcblxuXHRcdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGFibGUubW9kdWxlcy5leHBvcnQuZ2VuZXJlYXRlVGFibGUodGhpcy50YWJsZS5vcHRpb25zLnByaW50Q29uZmlnLCB0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRTdHlsZWQsIHRoaXMudGFibGUub3B0aW9ucy5wcmludFJvd1JhbmdlLCBcInByaW50XCIpKTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuZWxlbWVudCwgdGhpcy50YWJsZS5lbGVtZW50KTtcblx0XHR9XG5cdH07XG5cblx0UHJpbnQucHJvdG90eXBlLmNsZWFudXAgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZVwiKTtcblxuXHRcdGlmICh0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG5cdFx0fVxuXHR9O1xuXG5cdFByaW50LnByb3RvdHlwZS5wcmludEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAodmlzaWJsZSwgc3R5bGUsIGNvbmZpZykge1xuXHRcdHZhciBzY3JvbGxYID0gd2luZG93LnNjcm9sbFgsXG5cdFx0ICAgIHNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsWSxcblx0XHQgICAgaGVhZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdCAgICBmb290ZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0ICAgIHRhYmxlRWwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZXhwb3J0LmdlbmVyZWF0ZVRhYmxlKHR5cGVvZiBjb25maWcgIT0gXCJ1bmRlZmluZWRcIiA/IGNvbmZpZyA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludENvbmZpZywgdHlwZW9mIHN0eWxlICE9IFwidW5kZWZpbmVkXCIgPyBzdHlsZSA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludFN0eWxlZCwgdmlzaWJsZSwgXCJwcmludFwiKSxcblx0XHQgICAgaGVhZGVyQ29udGVudCxcblx0XHQgICAgZm9vdGVyQ29udGVudDtcblxuXHRcdHRoaXMubWFudWFsQmxvY2sgPSB0cnVlO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1mdWxsc2NyZWVuXCIpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wcmludEhlYWRlcikge1xuXHRcdFx0aGVhZGVyRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1oZWFkZXJcIik7XG5cblx0XHRcdGhlYWRlckNvbnRlbnQgPSB0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyID09IFwiZnVuY3Rpb25cIiA/IHRoaXMudGFibGUub3B0aW9ucy5wcmludEhlYWRlci5jYWxsKHRoaXMudGFibGUpIDogdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyO1xuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNvbnRlbnQgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRoZWFkZXJFbC5pbm5lckhUTUwgPSBoZWFkZXJDb250ZW50O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQoaGVhZGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChoZWFkZXJFbCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRhYmxlRWwpO1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3Rlcikge1xuXHRcdFx0Zm9vdGVyRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1mb290ZXJcIik7XG5cblx0XHRcdGZvb3RlckNvbnRlbnQgPSB0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9vdGVyID09IFwiZnVuY3Rpb25cIiA/IHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3Rlci5jYWxsKHRoaXMudGFibGUpIDogdGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9vdGVyO1xuXG5cdFx0XHRpZiAodHlwZW9mIGZvb3RlckNvbnRlbnQgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRmb290ZXJFbC5pbm5lckhUTUwgPSBmb290ZXJDb250ZW50O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9vdGVyRWwuYXBwZW5kQ2hpbGQoZm9vdGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChmb290ZXJFbCk7XG5cdFx0fVxuXG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZVwiKTtcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG5cblx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9ybWF0dGVyKSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRGb3JtYXR0ZXIodGhpcy5lbGVtZW50LCB0YWJsZUVsKTtcblx0XHR9XG5cblx0XHR3aW5kb3cucHJpbnQoKTtcblxuXHRcdHRoaXMuY2xlYW51cCgpO1xuXG5cdFx0d2luZG93LnNjcm9sbFRvKHNjcm9sbFgsIHNjcm9sbFkpO1xuXG5cdFx0dGhpcy5tYW51YWxCbG9jayA9IGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJwcmludFwiLCBQcmludCk7XG5cdHZhciBSZWFjdGl2ZURhdGEgPSBmdW5jdGlvbiBSZWFjdGl2ZURhdGEodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5kYXRhID0gZmFsc2U7XG5cdFx0dGhpcy5ibG9ja2VkID0gZmFsc2U7IC8vYmxvY2sgcmVhY3Rpdml0eSB3aGlsZSBwZXJmb3JtaW5nIHVwZGF0ZVxuXHRcdHRoaXMub3JpZ0Z1bmNzID0ge307IC8vIGhvbGQgb3JpZ2luYWwgZGF0YSBhcnJheSBmdW5jdGlvbnMgdG8gYWxsb3cgcmVwbGFjZW1lbnQgYWZ0ZXIgZGF0YSBpcyBkb25lIHdpdGhcblx0XHR0aGlzLmN1cnJlbnRWZXJzaW9uID0gMDtcblx0fTtcblxuXHRSZWFjdGl2ZURhdGEucHJvdG90eXBlLndhdGNoRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBwdXNoRnVuYyxcblx0XHQgICAgdmVyc2lvbjtcblxuXHRcdHRoaXMuY3VycmVudFZlcnNpb24rKztcblxuXHRcdHZlcnNpb24gPSB0aGlzLmN1cnJlbnRWZXJzaW9uO1xuXG5cdFx0c2VsZi51bndhdGNoRGF0YSgpO1xuXG5cdFx0c2VsZi5kYXRhID0gZGF0YTtcblxuXHRcdC8vb3ZlcnJpZGUgYXJyYXkgcHVzaCBmdW5jdGlvblxuXHRcdHNlbGYub3JpZ0Z1bmNzLnB1c2ggPSBkYXRhLnB1c2g7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5kYXRhLCBcInB1c2hcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG5cdFx0XHRcdHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpO1xuXG5cdFx0XHRcdGlmICghc2VsZi5ibG9ja2VkICYmIHZlcnNpb24gPT09IHNlbGYuY3VycmVudFZlcnNpb24pIHtcblx0XHRcdFx0XHRhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykge1xuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhcmcsIGZhbHNlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmLm9yaWdGdW5jcy5wdXNoLmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHVuc2hpZnQgZnVuY3Rpb25cblx0XHRzZWxmLm9yaWdGdW5jcy51bnNoaWZ0ID0gZGF0YS51bnNoaWZ0O1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJ1bnNoaWZ0XCIsIHtcblx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxuXHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuXHRcdFx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKTtcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cdFx0XHRcdFx0YXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5hZGRSb3dBY3R1YWwoYXJnLCB0cnVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmLm9yaWdGdW5jcy51bnNoaWZ0LmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHNoaWZ0IGZ1bmN0aW9uXG5cdFx0c2VsZi5vcmlnRnVuY3Muc2hpZnQgPSBkYXRhLnNoaWZ0O1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJzaGlmdFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcblx0XHRcdFx0dmFyIHJvdztcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cdFx0XHRcdFx0aWYgKHNlbGYuZGF0YS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChzZWxmLmRhdGFbMF0pO1xuXG5cdFx0XHRcdFx0XHRpZiAocm93KSB7XG5cdFx0XHRcdFx0XHRcdHJvdy5kZWxldGVBY3R1YWwoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3Muc2hpZnQuY2FsbChkYXRhKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vb3ZlcnJpZGUgYXJyYXkgcG9wIGZ1bmN0aW9uXG5cdFx0c2VsZi5vcmlnRnVuY3MucG9wID0gZGF0YS5wb3A7XG5cblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5kYXRhLCBcInBvcFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcblx0XHRcdFx0dmFyIHJvdztcblx0XHRcdFx0aWYgKCFzZWxmLmJsb2NrZWQgJiYgdmVyc2lvbiA9PT0gc2VsZi5jdXJyZW50VmVyc2lvbikge1xuXHRcdFx0XHRcdGlmIChzZWxmLmRhdGEubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRyb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbURhdGFPYmplY3Qoc2VsZi5kYXRhW3NlbGYuZGF0YS5sZW5ndGggLSAxXSk7XG5cblx0XHRcdFx0XHRcdGlmIChyb3cpIHtcblx0XHRcdFx0XHRcdFx0cm93LmRlbGV0ZUFjdHVhbCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3MucG9wLmNhbGwoZGF0YSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL292ZXJyaWRlIGFycmF5IHNwbGljZSBmdW5jdGlvblxuXHRcdHNlbGYub3JpZ0Z1bmNzLnNwbGljZSA9IGRhdGEuc3BsaWNlO1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuZGF0YSwgXCJzcGxpY2VcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG5cdFx0XHRcdHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpLFxuXHRcdFx0XHQgICAgc3RhcnQgPSBhcmdzWzBdIDwgMCA/IGRhdGEubGVuZ3RoICsgYXJnc1swXSA6IGFyZ3NbMF0sXG5cdFx0XHRcdCAgICBlbmQgPSBhcmdzWzFdLFxuXHRcdFx0XHQgICAgbmV3Um93cyA9IGFyZ3NbMl0gPyBhcmdzLnNsaWNlKDIpIDogZmFsc2UsXG5cdFx0XHRcdCAgICBzdGFydFJvdztcblxuXHRcdFx0XHRpZiAoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKSB7XG5cblx0XHRcdFx0XHQvL2FkZCBuZXcgcm93c1xuXHRcdFx0XHRcdGlmIChuZXdSb3dzKSB7XG5cdFx0XHRcdFx0XHRzdGFydFJvdyA9IGRhdGFbc3RhcnRdID8gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd0Zyb21EYXRhT2JqZWN0KGRhdGFbc3RhcnRdKSA6IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRpZiAoc3RhcnRSb3cpIHtcblx0XHRcdFx0XHRcdFx0bmV3Um93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3dEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChyb3dEYXRhLCB0cnVlLCBzdGFydFJvdywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0bmV3Um93cyA9IG5ld1Jvd3Muc2xpY2UoKS5yZXZlcnNlKCk7XG5cblx0XHRcdFx0XHRcdFx0bmV3Um93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3dEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChyb3dEYXRhLCB0cnVlLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vZGVsZXRlIHJlbW92ZWQgcm93c1xuXHRcdFx0XHRcdGlmIChlbmQgIT09IDApIHtcblx0XHRcdFx0XHRcdHZhciBvbGRSb3dzID0gZGF0YS5zbGljZShzdGFydCwgdHlwZW9mIGFyZ3NbMV0gPT09IFwidW5kZWZpbmVkXCIgPyBhcmdzWzFdIDogc3RhcnQgKyBlbmQpO1xuXG5cdFx0XHRcdFx0XHRvbGRSb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvd0RhdGEsIGkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChyb3dEYXRhKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAocm93KSB7XG5cdFx0XHRcdFx0XHRcdFx0cm93LmRlbGV0ZUFjdHVhbChpICE9PSBvbGRSb3dzLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAobmV3Um93cyB8fCBlbmQgIT09IDApIHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc2VsZi5vcmlnRnVuY3Muc3BsaWNlLmFwcGx5KGRhdGEsIGFyZ3VtZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bndhdGNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5kYXRhICE9PSBmYWxzZSkge1xuXHRcdFx0Zm9yICh2YXIga2V5IGluIHRoaXMub3JpZ0Z1bmNzKSB7XG5cdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmRhdGEsIGtleSwge1xuXHRcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxuXHRcdFx0XHRcdHZhbHVlOiB0aGlzLm9yaWdGdW5jcy5rZXlcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlYWN0aXZlRGF0YS5wcm90b3R5cGUud2F0Y2hSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gZGF0YSkge1xuXHRcdFx0dGhpcy53YXRjaEtleShyb3csIGRhdGEsIGtleSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ibG9ja2VkID0gZmFsc2U7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS53YXRjaEtleSA9IGZ1bmN0aW9uIChyb3csIGRhdGEsIGtleSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgcHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRhdGEsIGtleSksXG5cdFx0ICAgIHZhbHVlID0gZGF0YVtrZXldLFxuXHRcdCAgICB2ZXJzaW9uID0gdGhpcy5jdXJyZW50VmVyc2lvbjtcblxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkYXRhLCBrZXksIHtcblx0XHRcdHNldDogZnVuY3Rpb24gc2V0KG5ld1ZhbHVlKSB7XG5cdFx0XHRcdHZhbHVlID0gbmV3VmFsdWU7XG5cdFx0XHRcdGlmICghc2VsZi5ibG9ja2VkICYmIHZlcnNpb24gPT09IHNlbGYuY3VycmVudFZlcnNpb24pIHtcblx0XHRcdFx0XHR2YXIgdXBkYXRlID0ge307XG5cdFx0XHRcdFx0dXBkYXRlW2tleV0gPSBuZXdWYWx1ZTtcblx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YSh1cGRhdGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHByb3BzLnNldCkge1xuXHRcdFx0XHRcdHByb3BzLnNldChuZXdWYWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblxuXHRcdFx0XHRpZiAocHJvcHMuZ2V0KSB7XG5cdFx0XHRcdFx0cHJvcHMuZ2V0KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bndhdGNoUm93ID0gZnVuY3Rpb24gKHJvdykge1xuXHRcdHZhciBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZGF0YSwga2V5LCB7XG5cdFx0XHRcdHZhbHVlOiBkYXRhW2tleV1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRSZWFjdGl2ZURhdGEucHJvdG90eXBlLmJsb2NrID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7XG5cdH07XG5cblx0UmVhY3RpdmVEYXRhLnByb3RvdHlwZS51bmJsb2NrID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZWFjdGl2ZURhdGFcIiwgUmVhY3RpdmVEYXRhKTtcblxuXHR2YXIgUmVzaXplQ29sdW1ucyA9IGZ1bmN0aW9uIFJlc2l6ZUNvbHVtbnModGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5zdGFydENvbHVtbiA9IGZhbHNlO1xuXHRcdHRoaXMuc3RhcnRYID0gZmFsc2U7XG5cdFx0dGhpcy5zdGFydFdpZHRoID0gZmFsc2U7XG5cdFx0dGhpcy5oYW5kbGUgPSBudWxsO1xuXHRcdHRoaXMucHJldkhhbmRsZSA9IG51bGw7XG5cdH07XG5cblx0UmVzaXplQ29sdW1ucy5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uICh0eXBlLCBjb2x1bW4sIGVsZW1lbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHZhcmlhYmxlSGVpZ2h0ID0gZmFsc2UsXG5cdFx0ICAgIG1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1ucztcblxuXHRcdC8vc2V0IGNvbHVtbiByZXNpemUgbW9kZVxuXHRcdGlmICh0eXBlID09PSBcImhlYWRlclwiKSB7XG5cdFx0XHR2YXJpYWJsZUhlaWdodCA9IGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInRleHRhcmVhXCIgfHwgY29sdW1uLmRlZmluaXRpb24udmFyaWFibGVIZWlnaHQ7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5yZXNpemUgPSB7IHZhcmlhYmxlSGVpZ2h0OiB2YXJpYWJsZUhlaWdodCB9O1xuXHRcdH1cblxuXHRcdGlmIChtb2RlID09PSB0cnVlIHx8IG1vZGUgPT0gdHlwZSkge1xuXG5cdFx0XHR2YXIgaGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0XHRoYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGVcIjtcblxuXHRcdFx0dmFyIHByZXZIYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdHByZXZIYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3ItY29sLXJlc2l6ZS1oYW5kbGUgcHJldlwiO1xuXG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIGhhbmRsZURvd24gPSBmdW5jdGlvbiBoYW5kbGVEb3duKGUpIHtcblx0XHRcdFx0dmFyIG5lYXJlc3RDb2x1bW4gPSBjb2x1bW4uZ2V0TGFzdENvbHVtbigpO1xuXG5cdFx0XHRcdGlmIChuZWFyZXN0Q29sdW1uICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KG5lYXJlc3RDb2x1bW4pKSB7XG5cdFx0XHRcdFx0c2VsZi5zdGFydENvbHVtbiA9IGNvbHVtbjtcblx0XHRcdFx0XHRzZWxmLl9tb3VzZURvd24oZSwgbmVhcmVzdENvbHVtbiwgaGFuZGxlKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgaGFuZGxlRG93bik7XG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgaGFuZGxlRG93biwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0XHQvL3Jlc3ppZSBjb2x1bW4gb24gIGRvdWJsZSBjbGlja1xuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgY29sID0gY29sdW1uLmdldExhc3RDb2x1bW4oKTtcblxuXHRcdFx0XHRpZiAoY29sICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KGNvbCkpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGNvbC5yZWluaXRpYWxpemVXaWR0aCh0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIHByZXZIYW5kbGVEb3duID0gZnVuY3Rpb24gcHJldkhhbmRsZURvd24oZSkge1xuXHRcdFx0XHR2YXIgbmVhcmVzdENvbHVtbiwgY29sSW5kZXgsIHByZXZDb2x1bW47XG5cblx0XHRcdFx0bmVhcmVzdENvbHVtbiA9IGNvbHVtbi5nZXRGaXJzdENvbHVtbigpO1xuXG5cdFx0XHRcdGlmIChuZWFyZXN0Q29sdW1uKSB7XG5cdFx0XHRcdFx0Y29sSW5kZXggPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbkluZGV4KG5lYXJlc3RDb2x1bW4pO1xuXHRcdFx0XHRcdHByZXZDb2x1bW4gPSBjb2xJbmRleCA+IDAgPyBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1uQnlJbmRleChjb2xJbmRleCAtIDEpIDogZmFsc2U7XG5cblx0XHRcdFx0XHRpZiAocHJldkNvbHVtbiAmJiBzZWxmLl9jaGVja1Jlc2l6YWJpbGl0eShwcmV2Q29sdW1uKSkge1xuXHRcdFx0XHRcdFx0c2VsZi5zdGFydENvbHVtbiA9IGNvbHVtbjtcblx0XHRcdFx0XHRcdHNlbGYuX21vdXNlRG93bihlLCBwcmV2Q29sdW1uLCBwcmV2SGFuZGxlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBwcmV2SGFuZGxlRG93bik7XG5cdFx0XHRwcmV2SGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHByZXZIYW5kbGVEb3duLCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0XHRcdC8vcmVzaXplIGNvbHVtbiBvbiBkb3VibGUgY2xpY2tcblx0XHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBuZWFyZXN0Q29sdW1uLCBjb2xJbmRleCwgcHJldkNvbHVtbjtcblxuXHRcdFx0XHRuZWFyZXN0Q29sdW1uID0gY29sdW1uLmdldEZpcnN0Q29sdW1uKCk7XG5cblx0XHRcdFx0aWYgKG5lYXJlc3RDb2x1bW4pIHtcblx0XHRcdFx0XHRjb2xJbmRleCA9IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uSW5kZXgobmVhcmVzdENvbHVtbik7XG5cdFx0XHRcdFx0cHJldkNvbHVtbiA9IGNvbEluZGV4ID4gMCA/IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUluZGV4KGNvbEluZGV4IC0gMSkgOiBmYWxzZTtcblxuXHRcdFx0XHRcdGlmIChwcmV2Q29sdW1uICYmIHNlbGYuX2NoZWNrUmVzaXphYmlsaXR5KHByZXZDb2x1bW4pKSB7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0cHJldkNvbHVtbi5yZWluaXRpYWxpemVXaWR0aCh0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGhhbmRsZSk7XG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHByZXZIYW5kbGUpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNpemVDb2x1bW5zLnByb3RvdHlwZS5fY2hlY2tSZXNpemFiaWxpdHkgPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0cmV0dXJuIHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5yZXNpemFibGUgIT0gXCJ1bmRlZmluZWRcIiA/IGNvbHVtbi5kZWZpbml0aW9uLnJlc2l6YWJsZSA6IHRoaXMudGFibGUub3B0aW9ucy5yZXNpemFibGVDb2x1bW5zO1xuXHR9O1xuXG5cdFJlc2l6ZUNvbHVtbnMucHJvdG90eXBlLl9tb3VzZURvd24gPSBmdW5jdGlvbiAoZSwgY29sdW1uLCBoYW5kbGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRmdW5jdGlvbiBtb3VzZU1vdmUoZSkge1xuXHRcdFx0Ly8gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnRlbXBTY3JvbGxCbG9jaygpO1xuXG5cdFx0XHRjb2x1bW4uc2V0V2lkdGgoc2VsZi5zdGFydFdpZHRoICsgKCh0eXBlb2YgZS5zY3JlZW5YID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblggOiBlLnNjcmVlblgpIC0gc2VsZi5zdGFydFgpKTtcblxuXHRcdFx0aWYgKCFzZWxmLnRhYmxlLmJyb3dzZXJTbG93ICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZSAmJiBjb2x1bW4ubW9kdWxlcy5yZXNpemUudmFyaWFibGVIZWlnaHQpIHtcblx0XHRcdFx0Y29sdW1uLmNoZWNrQ2VsbEhlaWdodHMoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3VzZVVwKGUpIHtcblxuXHRcdFx0Ly9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdFx0aWYgKHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0KSB7XG5cdFx0XHRcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYudGFibGUuYnJvd3NlclNsb3cgJiYgY29sdW1uLm1vZHVsZXMucmVzaXplICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZS52YXJpYWJsZUhlaWdodCkge1xuXHRcdFx0XHRjb2x1bW4uY2hlY2tDZWxsSGVpZ2h0cygpO1xuXHRcdFx0fVxuXG5cdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXApO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG1vdXNlTW92ZSk7XG5cblx0XHRcdGhhbmRsZS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSk7XG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgJiYgc2VsZi50YWJsZS5tb2RFeGlzdHMoXCJwZXJzaXN0ZW5jZVwiLCB0cnVlKSAmJiBzZWxmLnRhYmxlLm1vZHVsZXMucGVyc2lzdGVuY2UuY29uZmlnLmNvbHVtbnMpIHtcblx0XHRcdFx0c2VsZi50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJjb2x1bW5zXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuY29sdW1uUmVzaXplZC5jYWxsKHNlbGYudGFibGUsIGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTsgLy9wcmV2ZW50IHJlc2l6ZSBmcm9tIGludGVyZmVyZWluZyB3aXRoIG1vdmFibGUgY29sdW1uc1xuXG5cdFx0Ly9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdGlmIChzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdCkge1xuXHRcdFx0c2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0c2VsZi5zdGFydFggPSB0eXBlb2YgZS5zY3JlZW5YID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblggOiBlLnNjcmVlblg7XG5cdFx0c2VsZi5zdGFydFdpZHRoID0gY29sdW1uLmdldFdpZHRoKCk7XG5cblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlKTtcblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXApO1xuXHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgbW91c2VVcCk7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInJlc2l6ZUNvbHVtbnNcIiwgUmVzaXplQ29sdW1ucyk7XG5cdHZhciBSZXNpemVSb3dzID0gZnVuY3Rpb24gUmVzaXplUm93cyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLnN0YXJ0Q29sdW1uID0gZmFsc2U7XG5cdFx0dGhpcy5zdGFydFkgPSBmYWxzZTtcblx0XHR0aGlzLnN0YXJ0SGVpZ2h0ID0gZmFsc2U7XG5cdFx0dGhpcy5oYW5kbGUgPSBudWxsO1xuXHRcdHRoaXMucHJldkhhbmRsZSA9IG51bGw7XG5cdH07XG5cblx0UmVzaXplUm93cy5wcm90b3R5cGUuaW5pdGlhbGl6ZVJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHZhciBoYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRoYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3Itcm93LXJlc2l6ZS1oYW5kbGVcIjtcblxuXHRcdHZhciBwcmV2SGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cHJldkhhbmRsZS5jbGFzc05hbWUgPSBcInRhYnVsYXRvci1yb3ctcmVzaXplLWhhbmRsZSBwcmV2XCI7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdH0pO1xuXG5cdFx0dmFyIGhhbmRsZURvd24gPSBmdW5jdGlvbiBoYW5kbGVEb3duKGUpIHtcblx0XHRcdHNlbGYuc3RhcnRSb3cgPSByb3c7XG5cdFx0XHRzZWxmLl9tb3VzZURvd24oZSwgcm93LCBoYW5kbGUpO1xuXHRcdH07XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVEb3duKTtcblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgaGFuZGxlRG93biwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG5cdFx0cHJldkhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fSk7XG5cblx0XHR2YXIgcHJldkhhbmRsZURvd24gPSBmdW5jdGlvbiBwcmV2SGFuZGxlRG93bihlKSB7XG5cdFx0XHR2YXIgcHJldlJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhyb3cpO1xuXG5cdFx0XHRpZiAocHJldlJvdykge1xuXHRcdFx0XHRzZWxmLnN0YXJ0Um93ID0gcHJldlJvdztcblx0XHRcdFx0c2VsZi5fbW91c2VEb3duKGUsIHByZXZSb3csIHByZXZIYW5kbGUpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRwcmV2SGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgcHJldkhhbmRsZURvd24pO1xuXHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgcHJldkhhbmRsZURvd24sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuXHRcdHJvd0VsLmFwcGVuZENoaWxkKGhhbmRsZSk7XG5cdFx0cm93RWwuYXBwZW5kQ2hpbGQocHJldkhhbmRsZSk7XG5cdH07XG5cblx0UmVzaXplUm93cy5wcm90b3R5cGUuX21vdXNlRG93biA9IGZ1bmN0aW9uIChlLCByb3csIGhhbmRsZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYudGFibGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblxuXHRcdGZ1bmN0aW9uIG1vdXNlTW92ZShlKSB7XG5cdFx0XHRyb3cuc2V0SGVpZ2h0KHNlbGYuc3RhcnRIZWlnaHQgKyAoKHR5cGVvZiBlLnNjcmVlblkgPT09IFwidW5kZWZpbmVkXCIgPyBlLnRvdWNoZXNbMF0uc2NyZWVuWSA6IGUuc2NyZWVuWSkgLSBzZWxmLnN0YXJ0WSkpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1vdXNlVXAoZSkge1xuXG5cdFx0XHQvLyAvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0XHQvLyBpZihzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdCl7XG5cdFx0XHQvLyBcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdC8vIH1cblxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBtb3VzZU1vdmUpO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG1vdXNlTW92ZSk7XG5cblx0XHRcdGhhbmRsZS5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSk7XG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXG5cdFx0XHRzZWxmLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ibG9jay1zZWxlY3RcIik7XG5cblx0XHRcdHNlbGYudGFibGUub3B0aW9ucy5yb3dSZXNpemVkLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKTtcblx0XHR9XG5cblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpOyAvL3ByZXZlbnQgcmVzaXplIGZyb20gaW50ZXJmZXJlaW5nIHdpdGggbW92YWJsZSBjb2x1bW5zXG5cblx0XHQvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0Ly8gaWYoc2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQpe1xuXHRcdC8vIFx0c2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCA9IHRydWU7XG5cdFx0Ly8gfVxuXG5cdFx0c2VsZi5zdGFydFkgPSB0eXBlb2YgZS5zY3JlZW5ZID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblkgOiBlLnNjcmVlblk7XG5cdFx0c2VsZi5zdGFydEhlaWdodCA9IHJvdy5nZXRIZWlnaHQoKTtcblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgbW91c2VVcCk7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBtb3VzZU1vdmUsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZXNpemVSb3dzXCIsIFJlc2l6ZVJvd3MpO1xuXHR2YXIgUmVzaXplVGFibGUgPSBmdW5jdGlvbiBSZXNpemVUYWJsZSh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmJpbmRpbmcgPSBmYWxzZTtcblx0XHR0aGlzLm9ic2VydmVyID0gZmFsc2U7XG5cdFx0dGhpcy5jb250YWluZXJPYnNlcnZlciA9IGZhbHNlO1xuXG5cdFx0dGhpcy50YWJsZUhlaWdodCA9IDA7XG5cdFx0dGhpcy50YWJsZVdpZHRoID0gMDtcblx0XHR0aGlzLmNvbnRhaW5lckhlaWdodCA9IDA7XG5cdFx0dGhpcy5jb250YWluZXJXaWR0aCA9IDA7XG5cblx0XHR0aGlzLmF1dG9SZXNpemUgPSBmYWxzZTtcblx0fTtcblxuXHRSZXNpemVUYWJsZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgX3RoaXM2OSA9IHRoaXM7XG5cblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlLFxuXHRcdCAgICB0YWJsZVN0eWxlO1xuXG5cdFx0dGhpcy50YWJsZUhlaWdodCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdHRoaXMudGFibGVXaWR0aCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRpZiAodGFibGUuZWxlbWVudC5wYXJlbnROb2RlKSB7XG5cdFx0XHR0aGlzLmNvbnRhaW5lckhlaWdodCA9IHRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQ7XG5cdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgUmVzaXplT2JzZXJ2ZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgdGFibGUucm93TWFuYWdlci5nZXRSZW5kZXJNb2RlKCkgPT09IFwidmlydHVhbFwiKSB7XG5cblx0XHRcdHRoaXMuYXV0b1Jlc2l6ZSA9IHRydWU7XG5cblx0XHRcdHRoaXMub2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoZnVuY3Rpb24gKGVudHJ5KSB7XG5cdFx0XHRcdGlmICghdGFibGUuYnJvd3Nlck1vYmlsZSB8fCB0YWJsZS5icm93c2VyTW9iaWxlICYmICF0YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblxuXHRcdFx0XHRcdHZhciBub2RlSGVpZ2h0ID0gTWF0aC5mbG9vcihlbnRyeVswXS5jb250ZW50UmVjdC5oZWlnaHQpO1xuXHRcdFx0XHRcdHZhciBub2RlV2lkdGggPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LndpZHRoKTtcblxuXHRcdFx0XHRcdGlmIChfdGhpczY5LnRhYmxlSGVpZ2h0ICE9IG5vZGVIZWlnaHQgfHwgX3RoaXM2OS50YWJsZVdpZHRoICE9IG5vZGVXaWR0aCkge1xuXHRcdFx0XHRcdFx0X3RoaXM2OS50YWJsZUhlaWdodCA9IG5vZGVIZWlnaHQ7XG5cdFx0XHRcdFx0XHRfdGhpczY5LnRhYmxlV2lkdGggPSBub2RlV2lkdGg7XG5cblx0XHRcdFx0XHRcdGlmICh0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXM2OS5jb250YWluZXJIZWlnaHQgPSB0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHRfdGhpczY5LmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0YWJsZS5yZWRyYXcoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm9ic2VydmVyLm9ic2VydmUodGFibGUuZWxlbWVudCk7XG5cblx0XHRcdHRhYmxlU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YWJsZS5lbGVtZW50KTtcblxuXHRcdFx0aWYgKHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlICYmICF0aGlzLnRhYmxlLnJvd01hbmFnZXIuZml4ZWRIZWlnaHQgJiYgKHRhYmxlU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcIm1heC1oZWlnaHRcIikgfHwgdGFibGVTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwibWluLWhlaWdodFwiKSkpIHtcblxuXHRcdFx0XHR0aGlzLmNvbnRhaW5lck9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKGZ1bmN0aW9uIChlbnRyeSkge1xuXHRcdFx0XHRcdGlmICghdGFibGUuYnJvd3Nlck1vYmlsZSB8fCB0YWJsZS5icm93c2VyTW9iaWxlICYmICF0YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblxuXHRcdFx0XHRcdFx0dmFyIG5vZGVIZWlnaHQgPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LmhlaWdodCk7XG5cdFx0XHRcdFx0XHR2YXIgbm9kZVdpZHRoID0gTWF0aC5mbG9vcihlbnRyeVswXS5jb250ZW50UmVjdC53aWR0aCk7XG5cblx0XHRcdFx0XHRcdGlmIChfdGhpczY5LmNvbnRhaW5lckhlaWdodCAhPSBub2RlSGVpZ2h0IHx8IF90aGlzNjkuY29udGFpbmVyV2lkdGggIT0gbm9kZVdpZHRoKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzNjkuY29udGFpbmVySGVpZ2h0ID0gbm9kZUhlaWdodDtcblx0XHRcdFx0XHRcdFx0X3RoaXM2OS5jb250YWluZXJXaWR0aCA9IG5vZGVXaWR0aDtcblx0XHRcdFx0XHRcdFx0X3RoaXM2OS50YWJsZUhlaWdodCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHRfdGhpczY5LnRhYmxlV2lkdGggPSB0YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXG5cdFx0XHRcdFx0XHRcdHRhYmxlLnJlZHJhdygpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0YWJsZS5yZWRyYXcoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuY29udGFpbmVyT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuYmluZGluZyA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aWYgKCF0YWJsZS5icm93c2VyTW9iaWxlIHx8IHRhYmxlLmJyb3dzZXJNb2JpbGUgJiYgIXRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkge1xuXHRcdFx0XHRcdHRhYmxlLnJlZHJhdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLmJpbmRpbmcpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNpemVUYWJsZS5wcm90b3R5cGUuY2xlYXJCaW5kaW5ncyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRpZiAodGhpcy5iaW5kaW5nKSB7XG5cdFx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLmJpbmRpbmcpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLm9ic2VydmVyKSB7XG5cdFx0XHR0aGlzLm9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNvbnRhaW5lck9ic2VydmVyKSB7XG5cdFx0XHR0aGlzLmNvbnRhaW5lck9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJyZXNpemVUYWJsZVwiLCBSZXNpemVUYWJsZSk7XG5cdHZhciBSZXNwb25zaXZlTGF5b3V0ID0gZnVuY3Rpb24gUmVzcG9uc2l2ZUxheW91dCh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcblx0XHR0aGlzLmhpZGRlbkNvbHVtbnMgPSBbXTtcblx0XHR0aGlzLm1vZGUgPSBcIlwiO1xuXHRcdHRoaXMuaW5kZXggPSAwO1xuXHRcdHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIgPSBbXTtcblx0XHR0aGlzLmNvbGxhcHNlU3RhcnRPcGVuID0gdHJ1ZTtcblx0XHR0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uID0gZmFsc2U7XG5cdH07XG5cblx0Ly9nZW5lcmF0ZSByZXNwb3NpdmUgY29sdW1ucyBsaXN0XG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb2x1bW5zID0gW107XG5cblx0XHR0aGlzLm1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dDtcblx0XHR0aGlzLmNvbGxhcHNlRm9ybWF0dGVyID0gdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZUZvcm1hdHRlciB8fCB0aGlzLmZvcm1hdENvbGxhcHNlZERhdGE7XG5cdFx0dGhpcy5jb2xsYXBzZVN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VTdGFydE9wZW47XG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zID0gW107XG5cblx0XHQvL2RldGVtaW5lIGxldmVsIG9mIHJlc3BvbnNpdml0eSBmb3IgZWFjaCBjb2x1bW5cblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCBpKSB7XG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZSkge1xuXHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS5vcmRlciAmJiBjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLnZpc2libGUpIHtcblx0XHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLmluZGV4ID0gaTtcblx0XHRcdFx0XHRjb2x1bW5zLnB1c2goY29sdW1uKTtcblxuXHRcdFx0XHRcdGlmICghY29sdW1uLnZpc2libGUgJiYgc2VsZi5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdFx0XHRcdHNlbGYuaGlkZGVuQ29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvL3NvcnQgbGlzdCBieSByZXNwb25zaXZpdHlcblx0XHRjb2x1bW5zID0gY29sdW1ucy5yZXZlcnNlKCk7XG5cdFx0Y29sdW1ucyA9IGNvbHVtbnMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuXHRcdFx0dmFyIGRpZmYgPSBiLm1vZHVsZXMucmVzcG9uc2l2ZS5vcmRlciAtIGEubW9kdWxlcy5yZXNwb25zaXZlLm9yZGVyO1xuXHRcdFx0cmV0dXJuIGRpZmYgfHwgYi5tb2R1bGVzLnJlc3BvbnNpdmUuaW5kZXggLSBhLm1vZHVsZXMucmVzcG9uc2l2ZS5pbmRleDtcblx0XHR9KTtcblxuXHRcdHRoaXMuY29sdW1ucyA9IGNvbHVtbnM7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRDb250ZW50KCk7XG5cdFx0fVxuXG5cdFx0Ly9hc3NpZ24gY29sbGFwc2UgY29sdW1uXG5cdFx0Zm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LCBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yKSwgX2kgPSAwLCBfaXRlcmF0b3IgPSBfaXNBcnJheSA/IF9pdGVyYXRvciA6IF9pdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdKCk7Oykge1xuXHRcdFx0dmFyIF9yZWY7XG5cblx0XHRcdGlmIChfaXNBcnJheSkge1xuXHRcdFx0XHRpZiAoX2kgPj0gX2l0ZXJhdG9yLmxlbmd0aCkgYnJlYWs7XG5cdFx0XHRcdF9yZWYgPSBfaXRlcmF0b3JbX2krK107XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfaSA9IF9pdGVyYXRvci5uZXh0KCk7XG5cdFx0XHRcdGlmIChfaS5kb25lKSBicmVhaztcblx0XHRcdFx0X3JlZiA9IF9pLnZhbHVlO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgY29sID0gX3JlZjtcblxuXHRcdFx0aWYgKGNvbC5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInJlc3BvbnNpdmVDb2xsYXBzZVwiKSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4gPSBjb2w7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uKSB7XG5cdFx0XHRpZiAodGhpcy5oaWRkZW5Db2x1bW5zLmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uLnNob3coKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL2RlZmluZSBsYXlvdXQgaW5mb3JtYXRpb25cblx0UmVzcG9uc2l2ZUxheW91dC5wcm90b3R5cGUuaW5pdGlhbGl6ZUNvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgZGVmID0gY29sdW1uLmdldERlZmluaXRpb24oKTtcblxuXHRcdGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUgPSB7IG9yZGVyOiB0eXBlb2YgZGVmLnJlc3BvbnNpdmUgPT09IFwidW5kZWZpbmVkXCIgPyAxIDogZGVmLnJlc3BvbnNpdmUsIHZpc2libGU6IGRlZi52aXNpYmxlID09PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZSB9O1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIGVsO1xuXG5cdFx0aWYgKHJvdy50eXBlICE9PSBcImNhbGNcIikge1xuXHRcdFx0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlXCIpO1xuXG5cdFx0XHRyb3cubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0ID0ge1xuXHRcdFx0XHRlbGVtZW50OiBlbCxcblx0XHRcdFx0b3BlbjogdGhpcy5jb2xsYXBzZVN0YXJ0T3BlblxuXHRcdFx0fTtcblxuXHRcdFx0aWYgKCF0aGlzLmNvbGxhcHNlU3RhcnRPcGVuKSB7XG5cdFx0XHRcdGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmxheW91dFJvdyA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0aWYgKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpIHtcblx0XHRcdHJvd0VsLmFwcGVuZENoaWxkKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQuZWxlbWVudCk7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudChyb3cpO1xuXHRcdH1cblx0fTtcblxuXHQvL3VwZGF0ZSBjb2x1bW4gdmlzaWJpbGl0eVxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS51cGRhdGVDb2x1bW5WaXNpYmlsaXR5ID0gZnVuY3Rpb24gKGNvbHVtbiwgdmlzaWJsZSkge1xuXHRcdHZhciBpbmRleDtcblx0XHRpZiAoY29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZSkge1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS52aXNpYmxlID0gdmlzaWJsZTtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblx0fTtcblxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS5oaWRlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdHZhciBjb2xDb3VudCA9IHRoaXMuaGlkZGVuQ29sdW1ucy5sZW5ndGg7XG5cblx0XHRjb2x1bW4uaGlkZShmYWxzZSwgdHJ1ZSk7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdHRoaXMuaGlkZGVuQ29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCgpO1xuXG5cdFx0XHRpZiAodGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbiAmJiAhY29sQ291bnQpIHtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbi5zaG93KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLnNob3dDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIGluZGV4O1xuXG5cdFx0Y29sdW1uLnNob3coZmFsc2UsIHRydWUpO1xuXHRcdC8vc2V0IGNvbHVtbiB3aWR0aCB0byBwcmV2ZW50IGNhbGN1bGF0aW9uIGxvb3BzIG9uIHVuaW5pdGlhbGl6ZWQgY29sdW1uc1xuXHRcdGNvbHVtbi5zZXRXaWR0aChjb2x1bW4uZ2V0V2lkdGgoKSk7XG5cblx0XHRpZiAodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpIHtcblx0XHRcdGluZGV4ID0gdGhpcy5oaWRkZW5Db2x1bW5zLmluZGV4T2YoY29sdW1uKTtcblxuXHRcdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHRcdFx0dGhpcy5oaWRkZW5Db2x1bW5zLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRDb250ZW50KCk7XG5cblx0XHRcdGlmICh0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uICYmICF0aGlzLmhpZGRlbkNvbHVtbnMubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHQvL3JlZHJhdyBjb2x1bW5zIHRvIGZpdCBzcGFjZVxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICB3b3JraW5nID0gdHJ1ZTtcblxuXHRcdHdoaWxlICh3b3JraW5nKSB7XG5cblx0XHRcdHZhciB3aWR0aCA9IHNlbGYudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpID09IFwiZml0Q29sdW1uc1wiID8gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEZsZXhCYXNlV2lkdGgoKSA6IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpO1xuXG5cdFx0XHR2YXIgZGlmZiA9IChzZWxmLnRhYmxlLm9wdGlvbnMuaGVhZGVyVmlzaWJsZSA/IHNlbGYudGFibGUuY29sdW1uTWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoIDogc2VsZi50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoKSAtIHdpZHRoO1xuXG5cdFx0XHRpZiAoZGlmZiA8IDApIHtcblx0XHRcdFx0Ly90YWJsZSBpcyB0b28gd2lkZVxuXHRcdFx0XHR2YXIgY29sdW1uID0gc2VsZi5jb2x1bW5zW3NlbGYuaW5kZXhdO1xuXG5cdFx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0XHRzZWxmLmhpZGVDb2x1bW4oY29sdW1uKTtcblx0XHRcdFx0XHRzZWxmLmluZGV4Kys7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vdGFibGUgaGFzIHNwYXJlIHNwYWNlXG5cdFx0XHRcdHZhciBfY29sdW1uID0gc2VsZi5jb2x1bW5zW3NlbGYuaW5kZXggLSAxXTtcblxuXHRcdFx0XHRpZiAoX2NvbHVtbikge1xuXHRcdFx0XHRcdGlmIChkaWZmID4gMCkge1xuXHRcdFx0XHRcdFx0aWYgKGRpZmYgPj0gX2NvbHVtbi5nZXRXaWR0aCgpKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuc2hvd0NvbHVtbihfY29sdW1uKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5pbmRleC0tO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzQ291bnQpIHtcblx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRzZWxmLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudChyb3cpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHR2YXIgZWwsIGNvbnRlbnRzO1xuXG5cdFx0aWYgKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpIHtcblx0XHRcdGVsID0gcm93Lm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5lbGVtZW50O1xuXG5cdFx0XHR3aGlsZSAoZWwuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTtcblx0XHRcdH1jb250ZW50cyA9IHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIodGhpcy5nZW5lcmF0ZUNvbGxhcHNlZFJvd0RhdGEocm93KSk7XG5cdFx0XHRpZiAoY29udGVudHMpIHtcblx0XHRcdFx0ZWwuYXBwZW5kQ2hpbGQoY29udGVudHMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRSZXNwb25zaXZlTGF5b3V0LnByb3RvdHlwZS5nZW5lcmF0ZUNvbGxhcHNlZFJvd0RhdGEgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBkYXRhID0gcm93LmdldERhdGEoKSxcblx0XHQgICAgb3V0cHV0ID0gW10sXG5cdFx0ICAgIG1vY2tDZWxsQ29tcG9uZW50O1xuXG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuXHRcdFx0dmFyIHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdGlmIChjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSAmJiBjb2x1bW4uZmllbGQpIHtcblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLmZvcm1hdCAmJiBzZWxmLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dENvbGxhcHNlVXNlRm9ybWF0dGVycykge1xuXG5cdFx0XHRcdFx0bW9ja0NlbGxDb21wb25lbnQgPSB7XG5cdFx0XHRcdFx0XHR2YWx1ZTogZmFsc2UsXG5cdFx0XHRcdFx0XHRkYXRhOiB7fSxcblx0XHRcdFx0XHRcdGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldERhdGE6IGZ1bmN0aW9uIGdldERhdGEoKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBkYXRhO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldEVsZW1lbnQ6IGZ1bmN0aW9uIGdldEVsZW1lbnQoKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldFJvdzogZnVuY3Rpb24gZ2V0Um93KCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldENvbHVtbjogZnVuY3Rpb24gZ2V0Q29sdW1uKCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRvdXRwdXQucHVzaCh7XG5cdFx0XHRcdFx0XHR0aXRsZTogY29sdW1uLmRlZmluaXRpb24udGl0bGUsXG5cdFx0XHRcdFx0XHR2YWx1ZTogY29sdW1uLm1vZHVsZXMuZm9ybWF0LmZvcm1hdHRlci5jYWxsKHNlbGYudGFibGUubW9kdWxlcy5mb3JtYXQsIG1vY2tDZWxsQ29tcG9uZW50LCBjb2x1bW4ubW9kdWxlcy5mb3JtYXQucGFyYW1zKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHtcblx0XHRcdFx0XHRcdHRpdGxlOiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSxcblx0XHRcdFx0XHRcdHZhbHVlOiB2YWx1ZVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9O1xuXG5cdFJlc3BvbnNpdmVMYXlvdXQucHJvdG90eXBlLmZvcm1hdENvbGxhcHNlZERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpLFxuXHRcdCAgICBsaXN0Q29udGVudHMgPSBcIlwiO1xuXG5cdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHR2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdFx0aWYgKGl0ZW0udmFsdWUgaW5zdGFuY2VvZiBOb2RlKSB7XG5cdFx0XHRcdGRpdi5hcHBlbmRDaGlsZChpdGVtLnZhbHVlKTtcblx0XHRcdFx0aXRlbS52YWx1ZSA9IGRpdi5pbm5lckhUTUw7XG5cdFx0XHR9XG5cblx0XHRcdGxpc3RDb250ZW50cyArPSBcIjx0cj48dGQ+PHN0cm9uZz5cIiArIGl0ZW0udGl0bGUgKyBcIjwvc3Ryb25nPjwvdGQ+PHRkPlwiICsgaXRlbS52YWx1ZSArIFwiPC90ZD48L3RyPlwiO1xuXHRcdH0pO1xuXG5cdFx0bGlzdC5pbm5lckhUTUwgPSBsaXN0Q29udGVudHM7XG5cblx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoID8gbGlzdCA6IFwiXCI7XG5cdH07XG5cblx0VGFidWxhdG9yLnByb3RvdHlwZS5yZWdpc3Rlck1vZHVsZShcInJlc3BvbnNpdmVMYXlvdXRcIiwgUmVzcG9uc2l2ZUxheW91dCk7XG5cblx0dmFyIFNlbGVjdFJvdyA9IGZ1bmN0aW9uIFNlbGVjdFJvdyh0YWJsZSkge1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTsgLy9ob2xkIFRhYnVsYXRvciBvYmplY3Rcblx0XHR0aGlzLnNlbGVjdGluZyA9IGZhbHNlOyAvL2ZsYWcgc2VsZWN0aW5nIGluIHByb2dyZXNzXG5cdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IGZhbHNlOyAvL2xhc3QgY2xpY2tlZCByb3dcblx0XHR0aGlzLnNlbGVjdFByZXYgPSBbXTsgLy9ob2xkIHByZXZpb3VzbHkgc2VsZWN0ZWQgZWxlbWVudCBmb3IgZHJhZyBkcm9wIHNlbGVjdGlvblxuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzID0gW107IC8vaG9sZCBzZWxlY3RlZCByb3dzXG5cdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQgPSBudWxsOyAvLyBob2xkIGhlYWRlciBzZWxlY3QgZWxlbWVudFxuXHR9O1xuXG5cdFNlbGVjdFJvdy5wcm90b3R5cGUuY2xlYXJTZWxlY3Rpb25EYXRhID0gZnVuY3Rpb24gKHNpbGVudCkge1xuXHRcdHRoaXMuc2VsZWN0aW5nID0gZmFsc2U7XG5cdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IGZhbHNlO1xuXHRcdHRoaXMuc2VsZWN0UHJldiA9IFtdO1xuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzID0gW107XG5cblx0XHRpZiAoIXNpbGVudCkge1xuXHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmluaXRpYWxpemVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdC8vIHRyaWdnZXIgZW5kIG9mIHJvdyBzZWxlY3Rpb25cblx0XHR2YXIgZW5kU2VsZWN0ID0gZnVuY3Rpb24gZW5kU2VsZWN0KCkge1xuXG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi5zZWxlY3RpbmcgPSBmYWxzZTtcblx0XHRcdH0sIDUwKTtcblxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBlbmRTZWxlY3QpO1xuXHRcdH07XG5cblx0XHRyb3cubW9kdWxlcy5zZWxlY3QgPSB7IHNlbGVjdGVkOiBmYWxzZSB9O1xuXG5cdFx0Ly9zZXQgcm93IHNlbGVjdGlvbiBjbGFzc1xuXHRcdGlmIChzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZUNoZWNrLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKSkge1xuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNlbGVjdGFibGVcIik7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItdW5zZWxlY3RhYmxlXCIpO1xuXG5cdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgJiYgc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgIT0gXCJoaWdobGlnaHRcIikge1xuXHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSYW5nZU1vZGUgPT09IFwiY2xpY2tcIikge1xuXHRcdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS5zaGlmdEtleSkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLmxhc3RDbGlja2VkUm93ID0gc2VsZi5sYXN0Q2xpY2tlZFJvdyB8fCByb3c7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGxhc3RDbGlja2VkUm93SWR4ID0gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dJbmRleChzZWxmLmxhc3RDbGlja2VkUm93KTtcblx0XHRcdFx0XHRcdFx0dmFyIHJvd0lkeCA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93SW5kZXgocm93KTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgZnJvbVJvd0lkeCA9IGxhc3RDbGlja2VkUm93SWR4IDw9IHJvd0lkeCA/IGxhc3RDbGlja2VkUm93SWR4IDogcm93SWR4O1xuXHRcdFx0XHRcdFx0XHR2YXIgdG9Sb3dJZHggPSBsYXN0Q2xpY2tlZFJvd0lkeCA+PSByb3dJZHggPyBsYXN0Q2xpY2tlZFJvd0lkeCA6IHJvd0lkeDtcblxuXHRcdFx0XHRcdFx0XHR2YXIgcm93cyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLnNsaWNlKDApO1xuXHRcdFx0XHRcdFx0XHR2YXIgdG9nZ2xlZFJvd3MgPSByb3dzLnNwbGljZShmcm9tUm93SWR4LCB0b1Jvd0lkeCAtIGZyb21Sb3dJZHggKyAxKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkge1xuXHRcdFx0XHRcdFx0XHRcdHRvZ2dsZWRSb3dzLmZvckVhY2goZnVuY3Rpb24gKHRvZ2dsZWRSb3cpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0b2dnbGVkUm93ICE9PSBzZWxmLmxhc3RDbGlja2VkUm93KSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICE9PSB0cnVlICYmICFzZWxmLmlzUm93U2VsZWN0ZWQocm93KSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzZWxmLnNlbGVjdGVkUm93cy5sZW5ndGggPCBzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3codG9nZ2xlZFJvdyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHRvZ2dsZWRSb3cpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5sYXN0Q2xpY2tlZFJvdyA9IHJvdztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlICE9PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodG9nZ2xlZFJvd3MubGVuZ3RoID4gc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dG9nZ2xlZFJvd3MgPSB0b2dnbGVkUm93cy5zbGljZSgwLCBzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RSb3dzKHRvZ2dsZWRSb3dzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHJvdyk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubGFzdENsaWNrZWRSb3cgPSByb3c7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdFJvd3Mocm93KTtcblx0XHRcdFx0XHRcdFx0c2VsZi5sYXN0Q2xpY2tlZFJvdyA9IHJvdztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0aWYgKCFzZWxmLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikgfHwgIXNlbGYudGFibGUubW9kdWxlcy5lZGl0LmdldEN1cnJlbnRDZWxsKCkpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCFzZWxmLnNlbGVjdGluZykge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRvZ2dsZVJvdyhyb3cpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS5zaGlmdEtleSkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXG5cdFx0XHRcdFx0XHRcdHNlbGYuc2VsZWN0aW5nID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdFByZXYgPSBbXTtcblxuXHRcdFx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGVuZFNlbGVjdCk7XG5cdFx0XHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGVuZFNlbGVjdCk7XG5cblx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3cocm93KTtcblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RpbmcpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3cocm93KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RQcmV2WzFdID09IHJvdykge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHNlbGYuc2VsZWN0UHJldlswXSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRpZiAoc2VsZi5zZWxlY3RpbmcpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RQcmV2LnVuc2hpZnQocm93KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdW5zZWxlY3RhYmxlXCIpO1xuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXNlbGVjdGFibGVcIik7XG5cdFx0fVxuXHR9O1xuXG5cdC8vdG9nZ2xlIHJvdyBzZWxlY3Rpb25cblx0U2VsZWN0Um93LnByb3RvdHlwZS50b2dnbGVSb3cgPSBmdW5jdGlvbiAocm93KSB7XG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlQ2hlY2suY2FsbCh0aGlzLnRhYmxlLCByb3cuZ2V0Q29tcG9uZW50KCkpKSB7XG5cdFx0XHRpZiAocm93Lm1vZHVsZXMuc2VsZWN0ICYmIHJvdy5tb2R1bGVzLnNlbGVjdC5zZWxlY3RlZCkge1xuXHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyhyb3cpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8vc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0U2VsZWN0Um93LnByb3RvdHlwZS5zZWxlY3RSb3dzID0gZnVuY3Rpb24gKHJvd3MpIHtcblx0XHR2YXIgX3RoaXM3MCA9IHRoaXM7XG5cblx0XHR2YXIgcm93TWF0Y2g7XG5cblx0XHRzd2l0Y2ggKHR5cGVvZiByb3dzID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihyb3dzKSkge1xuXHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRfdGhpczcwLl9zZWxlY3RSb3cocm93LCB0cnVlLCB0cnVlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXG5cdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmZpbmRSb3cocm93cyk7XG5cblx0XHRcdFx0aWYgKHJvd01hdGNoKSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvd01hdGNoLCB0cnVlLCB0cnVlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cyhyb3dzKS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdFx0XHRcdF90aGlzNzAuX3NlbGVjdFJvdyhyb3csIHRydWUsIHRydWUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZCgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocm93cykpIHtcblx0XHRcdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHRcdFx0X3RoaXM3MC5fc2VsZWN0Um93KHJvdywgdHJ1ZSwgdHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHR0aGlzLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fc2VsZWN0Um93KHJvd3MsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH07XG5cblx0Ly9zZWxlY3QgYW4gaW5kaXZpZHVhbCByb3dcblx0U2VsZWN0Um93LnByb3RvdHlwZS5fc2VsZWN0Um93ID0gZnVuY3Rpb24gKHJvd0luZm8sIHNpbGVudCwgZm9yY2UpIHtcblx0XHR2YXIgaW5kZXg7XG5cblx0XHQvL2hhbmRsZSBtYXggcm93IGNvdW50XG5cdFx0aWYgKCFpc05hTih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZSkgJiYgdGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGUgIT09IHRydWUgJiYgIWZvcmNlKSB7XG5cdFx0XHRpZiAodGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoID49IHRoaXMudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlKSB7XG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvbGxpbmdTZWxlY3Rpb24pIHtcblx0XHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyh0aGlzLnNlbGVjdGVkUm93c1swXSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dmFyIHJvdyA9IHRoaXMudGFibGUucm93TWFuYWdlci5maW5kUm93KHJvd0luZm8pO1xuXG5cdFx0aWYgKHJvdykge1xuXHRcdFx0aWYgKHRoaXMuc2VsZWN0ZWRSb3dzLmluZGV4T2Yocm93KSA9PSAtMSkge1xuXHRcdFx0XHRpZiAoIXJvdy5tb2R1bGVzLnNlbGVjdCkge1xuXHRcdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdCA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LnNlbGVjdGVkID0gdHJ1ZTtcblx0XHRcdFx0aWYgKHJvdy5tb2R1bGVzLnNlbGVjdC5jaGVja2JveEVsKSB7XG5cdFx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwuY2hlY2tlZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNlbGVjdGVkXCIpO1xuXG5cdFx0XHRcdHRoaXMuc2VsZWN0ZWRSb3dzLnB1c2gocm93KTtcblxuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlU2VsZWN0UHJvcGFnYXRlKSB7XG5cdFx0XHRcdFx0dGhpcy5jaGlsZFJvd1NlbGVjdGlvbihyb3csIHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFzaWxlbnQpIHtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93U2VsZWN0ZWQuY2FsbCh0aGlzLnRhYmxlLCByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZChzaWxlbnQpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoIXNpbGVudCkge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTZWxlY3Rpb24gRXJyb3IgLSBObyBzdWNoIHJvdyBmb3VuZCwgaWdub3Jpbmcgc2VsZWN0aW9uOlwiICsgcm93SW5mbyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFNlbGVjdFJvdy5wcm90b3R5cGUuaXNSb3dTZWxlY3RlZCA9IGZ1bmN0aW9uIChyb3cpIHtcblx0XHRyZXR1cm4gdGhpcy5zZWxlY3RlZFJvd3MuaW5kZXhPZihyb3cpICE9PSAtMTtcblx0fTtcblxuXHQvL2Rlc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0U2VsZWN0Um93LnByb3RvdHlwZS5kZXNlbGVjdFJvd3MgPSBmdW5jdGlvbiAocm93cywgc2lsZW50KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICByb3dDb3VudDtcblxuXHRcdGlmICh0eXBlb2Ygcm93cyA9PSBcInVuZGVmaW5lZFwiKSB7XG5cblx0XHRcdHJvd0NvdW50ID0gc2VsZi5zZWxlY3RlZFJvd3MubGVuZ3RoO1xuXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJvd0NvdW50OyBpKyspIHtcblx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3coc2VsZi5zZWxlY3RlZFJvd3NbMF0sIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKHNpbGVudCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJvd3MpKSB7XG5cdFx0XHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3cocm93LCB0cnVlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5fcm93U2VsZWN0aW9uQ2hhbmdlZChzaWxlbnQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2VsZi5fZGVzZWxlY3RSb3cocm93cywgc2lsZW50KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0Ly9kZXNlbGVjdCBhbiBpbmRpdmlkdWFsIHJvd1xuXHRTZWxlY3RSb3cucHJvdG90eXBlLl9kZXNlbGVjdFJvdyA9IGZ1bmN0aW9uIChyb3dJbmZvLCBzaWxlbnQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5maW5kUm93KHJvd0luZm8pLFxuXHRcdCAgICBpbmRleDtcblxuXHRcdGlmIChyb3cpIHtcblx0XHRcdGluZGV4ID0gc2VsZi5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGZ1bmN0aW9uIChzZWxlY3RlZFJvdykge1xuXHRcdFx0XHRyZXR1cm4gc2VsZWN0ZWRSb3cgPT0gcm93O1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChpbmRleCA+IC0xKSB7XG5cblx0XHRcdFx0aWYgKCFyb3cubW9kdWxlcy5zZWxlY3QpIHtcblx0XHRcdFx0XHRyb3cubW9kdWxlcy5zZWxlY3QgPSB7fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdC5zZWxlY3RlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZiAocm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwpIHtcblx0XHRcdFx0XHRyb3cubW9kdWxlcy5zZWxlY3QuY2hlY2tib3hFbC5jaGVja2VkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdFx0cm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXNlbGVjdGVkXCIpO1xuXHRcdFx0XHRzZWxmLnNlbGVjdGVkUm93cy5zcGxpY2UoaW5kZXgsIDEpO1xuXG5cdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVTZWxlY3RQcm9wYWdhdGUpIHtcblx0XHRcdFx0XHR0aGlzLmNoaWxkUm93U2VsZWN0aW9uKHJvdywgZmFsc2UpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFzaWxlbnQpIHtcblx0XHRcdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMucm93RGVzZWxlY3RlZC5jYWxsKHRoaXMudGFibGUsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKHNpbGVudCk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICghc2lsZW50KSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRlc2VsZWN0aW9uIEVycm9yIC0gTm8gc3VjaCByb3cgZm91bmQsIGlnbm9yaW5nIHNlbGVjdGlvbjpcIiArIHJvd0luZm8pO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmdldFNlbGVjdGVkRGF0YSA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZGF0YSA9IFtdO1xuXG5cdFx0dGhpcy5zZWxlY3RlZFJvd3MuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmdldFNlbGVjdGVkUm93cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHZhciByb3dzID0gW107XG5cblx0XHR0aGlzLnNlbGVjdGVkUm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcblx0XHRcdHJvd3MucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJvd3M7XG5cdH07XG5cblx0U2VsZWN0Um93LnByb3RvdHlwZS5fcm93U2VsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uIChzaWxlbnQpIHtcblx0XHRpZiAodGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQpIHtcblx0XHRcdGlmICh0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50LmNoZWNrZWQgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5pbmRldGVybWluYXRlID0gdHJ1ZTtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghc2lsZW50KSB7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucm93U2VsZWN0aW9uQ2hhbmdlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0U2VsZWN0ZWREYXRhKCksIHRoaXMuZ2V0U2VsZWN0ZWRSb3dzKCkpO1xuXHRcdH1cblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLnJlZ2lzdGVyUm93U2VsZWN0Q2hlY2tib3ggPSBmdW5jdGlvbiAocm93LCBlbGVtZW50KSB7XG5cdFx0aWYgKCFyb3cuX3Jvdy5tb2R1bGVzLnNlbGVjdCkge1xuXHRcdFx0cm93Ll9yb3cubW9kdWxlcy5zZWxlY3QgPSB7fTtcblx0XHR9XG5cblx0XHRyb3cuX3Jvdy5tb2R1bGVzLnNlbGVjdC5jaGVja2JveEVsID0gZWxlbWVudDtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLnJlZ2lzdGVySGVhZGVyU2VsZWN0Q2hlY2tib3ggPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuXHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50ID0gZWxlbWVudDtcblx0fTtcblxuXHRTZWxlY3RSb3cucHJvdG90eXBlLmNoaWxkUm93U2VsZWN0aW9uID0gZnVuY3Rpb24gKHJvdywgc2VsZWN0KSB7XG5cdFx0dmFyIGNoaWxkcmVuID0gdGhpcy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldENoaWxkcmVuKHJvdyk7XG5cblx0XHRpZiAoc2VsZWN0KSB7XG5cdFx0XHRmb3IgKHZhciBfaXRlcmF0b3IyID0gY2hpbGRyZW4sIF9pc0FycmF5MiA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yMiksIF9pMiA9IDAsIF9pdGVyYXRvcjIgPSBfaXNBcnJheTIgPyBfaXRlcmF0b3IyIDogX2l0ZXJhdG9yMltTeW1ib2wuaXRlcmF0b3JdKCk7Oykge1xuXHRcdFx0XHR2YXIgX3JlZjI7XG5cblx0XHRcdFx0aWYgKF9pc0FycmF5Mikge1xuXHRcdFx0XHRcdGlmIChfaTIgPj0gX2l0ZXJhdG9yMi5sZW5ndGgpIGJyZWFrO1xuXHRcdFx0XHRcdF9yZWYyID0gX2l0ZXJhdG9yMltfaTIrK107XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0X2kyID0gX2l0ZXJhdG9yMi5uZXh0KCk7XG5cdFx0XHRcdFx0aWYgKF9pMi5kb25lKSBicmVhaztcblx0XHRcdFx0XHRfcmVmMiA9IF9pMi52YWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBjaGlsZCA9IF9yZWYyO1xuXG5cdFx0XHRcdHRoaXMuX3NlbGVjdFJvdyhjaGlsZCwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAodmFyIF9pdGVyYXRvcjMgPSBjaGlsZHJlbiwgX2lzQXJyYXkzID0gQXJyYXkuaXNBcnJheShfaXRlcmF0b3IzKSwgX2kzID0gMCwgX2l0ZXJhdG9yMyA9IF9pc0FycmF5MyA/IF9pdGVyYXRvcjMgOiBfaXRlcmF0b3IzW1N5bWJvbC5pdGVyYXRvcl0oKTs7KSB7XG5cdFx0XHRcdHZhciBfcmVmMztcblxuXHRcdFx0XHRpZiAoX2lzQXJyYXkzKSB7XG5cdFx0XHRcdFx0aWYgKF9pMyA+PSBfaXRlcmF0b3IzLmxlbmd0aCkgYnJlYWs7XG5cdFx0XHRcdFx0X3JlZjMgPSBfaXRlcmF0b3IzW19pMysrXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRfaTMgPSBfaXRlcmF0b3IzLm5leHQoKTtcblx0XHRcdFx0XHRpZiAoX2kzLmRvbmUpIGJyZWFrO1xuXHRcdFx0XHRcdF9yZWYzID0gX2kzLnZhbHVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIF9jaGlsZCA9IF9yZWYzO1xuXG5cdFx0XHRcdHRoaXMuX2Rlc2VsZWN0Um93KF9jaGlsZCwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJzZWxlY3RSb3dcIiwgU2VsZWN0Um93KTtcblxuXHR2YXIgU29ydCA9IGZ1bmN0aW9uIFNvcnQodGFibGUpIHtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7IC8vaG9sZCBUYWJ1bGF0b3Igb2JqZWN0XG5cdFx0dGhpcy5zb3J0TGlzdCA9IFtdOyAvL2hvbGRlciBjdXJyZW50IHNvcnRcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTsgLy9oYXMgdGhlIHNvcnQgY2hhbmdlZCBzaW5jZSBsYXN0IHJlbmRlclxuXHR9O1xuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gaGVhZGVyIGZvciBzb3J0aW5nXG5cdFNvcnQucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uLCBjb250ZW50KSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBzb3J0ZXIgPSBmYWxzZSxcblx0XHQgICAgY29sRWwsXG5cdFx0ICAgIGFycm93RWw7XG5cblx0XHRzd2l0Y2ggKF90eXBlb2YoY29sdW1uLmRlZmluaXRpb24uc29ydGVyKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZiAoc2VsZi5zb3J0ZXJzW2NvbHVtbi5kZWZpbml0aW9uLnNvcnRlcl0pIHtcblx0XHRcdFx0XHRzb3J0ZXIgPSBzZWxmLnNvcnRlcnNbY29sdW1uLmRlZmluaXRpb24uc29ydGVyXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJTb3J0IEVycm9yIC0gTm8gc3VjaCBzb3J0ZXIgZm91bmQ6IFwiLCBjb2x1bW4uZGVmaW5pdGlvbi5zb3J0ZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0c29ydGVyID0gY29sdW1uLmRlZmluaXRpb24uc29ydGVyO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5zb3J0ID0ge1xuXHRcdFx0c29ydGVyOiBzb3J0ZXIsIGRpcjogXCJub25lXCIsXG5cdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uLnNvcnRlclBhcmFtcyB8fCB7fSxcblx0XHRcdHN0YXJ0aW5nRGlyOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJTb3J0U3RhcnRpbmdEaXIgfHwgXCJhc2NcIixcblx0XHRcdHRyaXN0YXRlOiB0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyU29ydFRyaXN0YXRlICE9PSBcInVuZGVmaW5lZFwiID8gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyU29ydFRyaXN0YXRlIDogdGhpcy50YWJsZS5vcHRpb25zLmhlYWRlclNvcnRUcmlzdGF0ZVxuXHRcdH07XG5cblx0XHRpZiAodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnQgPT09IFwidW5kZWZpbmVkXCIgPyB0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyU29ydCAhPT0gZmFsc2UgOiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJTb3J0ICE9PSBmYWxzZSkge1xuXG5cdFx0XHRjb2xFbCA9IGNvbHVtbi5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGNvbEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itc29ydGFibGVcIik7XG5cblx0XHRcdGFycm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0YXJyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWFycm93XCIpO1xuXHRcdFx0Ly9jcmVhdGUgc29ydGVyIGFycm93XG5cdFx0XHRjb250ZW50LmFwcGVuZENoaWxkKGFycm93RWwpO1xuXG5cdFx0XHQvL3NvcnQgb24gY2xpY2tcblx0XHRcdGNvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgZGlyID0gXCJcIixcblx0XHRcdFx0ICAgIHNvcnRlcnMgPSBbXSxcblx0XHRcdFx0ICAgIG1hdGNoID0gZmFsc2U7XG5cblx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLnNvcnQpIHtcblx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuc29ydC50cmlzdGF0ZSkge1xuXHRcdFx0XHRcdFx0aWYgKGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID09IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0XHRcdGRpciA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuc3RhcnRpbmdEaXI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuc29ydC5kaXIgPT0gY29sdW1uLm1vZHVsZXMuc29ydC5zdGFydGluZ0Rpcikge1xuXHRcdFx0XHRcdFx0XHRcdGRpciA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID09IFwiYXNjXCIgPyBcImRlc2NcIiA6IFwiYXNjXCI7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJub25lXCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c3dpdGNoIChjb2x1bW4ubW9kdWxlcy5zb3J0LmRpcikge1xuXHRcdFx0XHRcdFx0XHRjYXNlIFwiYXNjXCI6XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJkZXNjXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSBcImRlc2NcIjpcblx0XHRcdFx0XHRcdFx0XHRkaXIgPSBcImFzY1wiO1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gY29sdW1uLm1vZHVsZXMuc29ydC5zdGFydGluZ0Rpcjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50YWJsZS5vcHRpb25zLmNvbHVtbkhlYWRlclNvcnRNdWx0aSAmJiAoZS5zaGlmdEtleSB8fCBlLmN0cmxLZXkpKSB7XG5cdFx0XHRcdFx0XHRzb3J0ZXJzID0gc2VsZi5nZXRTb3J0KCk7XG5cblx0XHRcdFx0XHRcdG1hdGNoID0gc29ydGVycy5maW5kSW5kZXgoZnVuY3Rpb24gKHNvcnRlcikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gc29ydGVyLmZpZWxkID09PSBjb2x1bW4uZ2V0RmllbGQoKTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAobWF0Y2ggPiAtMSkge1xuXHRcdFx0XHRcdFx0XHRzb3J0ZXJzW21hdGNoXS5kaXIgPSBkaXI7XG5cblx0XHRcdFx0XHRcdFx0aWYgKG1hdGNoICE9IHNvcnRlcnMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdG1hdGNoID0gc29ydGVycy5zcGxpY2UobWF0Y2gsIDEpWzBdO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChkaXIgIT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNvcnRlcnMucHVzaChtYXRjaCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAoZGlyICE9IFwibm9uZVwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVycy5wdXNoKHsgY29sdW1uOiBjb2x1bW4sIGRpcjogZGlyIH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vYWRkIHRvIGV4aXN0aW5nIHNvcnRcblx0XHRcdFx0XHRcdHNlbGYuc2V0U29ydChzb3J0ZXJzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKGRpciA9PSBcIm5vbmVcIikge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmNsZWFyKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvL3NvcnQgYnkgY29sdW1uIG9ubHlcblx0XHRcdFx0XHRcdFx0c2VsZi5zZXRTb3J0KGNvbHVtbiwgZGlyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuc29ydGVyUmVmcmVzaCghc2VsZi5zb3J0TGlzdC5sZW5ndGgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0Ly9jaGVjayBpZiB0aGUgc29ydGVycyBoYXZlIGNoYW5nZWQgc2luY2UgbGFzdCB1c2Vcblx0U29ydC5wcm90b3R5cGUuaGFzQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuY2hhbmdlZDtcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTtcblx0XHRyZXR1cm4gY2hhbmdlZDtcblx0fTtcblxuXHQvL3JldHVybiBjdXJyZW50IHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuZ2V0U29ydCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ICAgIHNvcnRlcnMgPSBbXTtcblxuXHRcdHNlbGYuc29ydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0aWYgKGl0ZW0uY29sdW1uKSB7XG5cdFx0XHRcdHNvcnRlcnMucHVzaCh7IGNvbHVtbjogaXRlbS5jb2x1bW4uZ2V0Q29tcG9uZW50KCksIGZpZWxkOiBpdGVtLmNvbHVtbi5nZXRGaWVsZCgpLCBkaXI6IGl0ZW0uZGlyIH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHNvcnRlcnM7XG5cdH07XG5cblx0Ly9jaGFuZ2Ugc29ydCBsaXN0IGFuZCB0cmlnZ2VyIHNvcnRcblx0U29ydC5wcm90b3R5cGUuc2V0U29ydCA9IGZ1bmN0aW9uIChzb3J0TGlzdCwgZGlyKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBuZXdTb3J0TGlzdCA9IFtdO1xuXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KHNvcnRMaXN0KSkge1xuXHRcdFx0c29ydExpc3QgPSBbeyBjb2x1bW46IHNvcnRMaXN0LCBkaXI6IGRpciB9XTtcblx0XHR9XG5cblx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHR2YXIgY29sdW1uO1xuXG5cdFx0XHRjb2x1bW4gPSBzZWxmLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihpdGVtLmNvbHVtbik7XG5cblx0XHRcdGlmIChjb2x1bW4pIHtcblx0XHRcdFx0aXRlbS5jb2x1bW4gPSBjb2x1bW47XG5cdFx0XHRcdG5ld1NvcnRMaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdHNlbGYuY2hhbmdlZCA9IHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTb3J0IFdhcm5pbmcgLSBTb3J0IGZpZWxkIGRvZXMgbm90IGV4aXN0IGFuZCBpcyBiZWluZyBpZ25vcmVkOiBcIiwgaXRlbS5jb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0c2VsZi5zb3J0TGlzdCA9IG5ld1NvcnRMaXN0O1xuXG5cdFx0aWYgKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInBlcnNpc3RlbmNlXCIsIHRydWUpICYmIHRoaXMudGFibGUubW9kdWxlcy5wZXJzaXN0ZW5jZS5jb25maWcuc29ydCkge1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnBlcnNpc3RlbmNlLnNhdmUoXCJzb3J0XCIpO1xuXHRcdH1cblx0fTtcblxuXHQvL2NsZWFyIHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5zZXRTb3J0KFtdKTtcblx0fTtcblxuXHQvL2ZpbmQgYXBwcm9wcmlhdGUgc29ydGVyIGZvciBjb2x1bW5cblx0U29ydC5wcm90b3R5cGUuZmluZFNvcnRlciA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3NbMF0sXG5cdFx0ICAgIHNvcnRlciA9IFwic3RyaW5nXCIsXG5cdFx0ICAgIGZpZWxkLFxuXHRcdCAgICB2YWx1ZTtcblxuXHRcdGlmIChyb3cpIHtcblx0XHRcdHJvdyA9IHJvdy5nZXREYXRhKCk7XG5cdFx0XHRmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRpZiAoZmllbGQpIHtcblxuXHRcdFx0XHR2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKHJvdyk7XG5cblx0XHRcdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdFx0XHRzb3J0ZXIgPSBcImJvb2xlYW5cIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGlmICghaXNOYU4odmFsdWUpICYmIHZhbHVlICE9PSBcIlwiKSB7XG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwibnVtYmVyXCI7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAodmFsdWUubWF0Y2goLygoXlswLTldK1thLXpdKyl8KF5bYS16XStbMC05XSspKSskL2kpKSB7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVyID0gXCJhbHBoYW51bVwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnNvcnRlcnNbc29ydGVyXTtcblx0fTtcblxuXHQvL3dvcmsgdGhyb3VnaCBzb3J0IGxpc3Qgc29ydGluZyBkYXRhXG5cdFNvcnQucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHQgICAgbGFzdFNvcnQsXG5cdFx0ICAgIHNvcnRMaXN0O1xuXG5cdFx0c29ydExpc3QgPSB0aGlzLnRhYmxlLm9wdGlvbnMuc29ydE9yZGVyUmV2ZXJzZSA/IHNlbGYuc29ydExpc3Quc2xpY2UoKS5yZXZlcnNlKCkgOiBzZWxmLnNvcnRMaXN0O1xuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5kYXRhU29ydGluZykge1xuXHRcdFx0c2VsZi50YWJsZS5vcHRpb25zLmRhdGFTb3J0aW5nLmNhbGwoc2VsZi50YWJsZSwgc2VsZi5nZXRTb3J0KCkpO1xuXHRcdH1cblxuXHRcdHNlbGYuY2xlYXJDb2x1bW5IZWFkZXJzKCk7XG5cblx0XHRpZiAoIXNlbGYudGFibGUub3B0aW9ucy5hamF4U29ydGluZykge1xuXG5cdFx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG5cblx0XHRcdFx0aWYgKGl0ZW0uY29sdW1uICYmIGl0ZW0uY29sdW1uLm1vZHVsZXMuc29ydCkge1xuXG5cdFx0XHRcdFx0Ly9pZiBubyBzb3J0ZXIgaGFzIGJlZW4gZGVmaW5lZCwgdGFrZSBhIGd1ZXNzXG5cdFx0XHRcdFx0aWYgKCFpdGVtLmNvbHVtbi5tb2R1bGVzLnNvcnQuc29ydGVyKSB7XG5cdFx0XHRcdFx0XHRpdGVtLmNvbHVtbi5tb2R1bGVzLnNvcnQuc29ydGVyID0gc2VsZi5maW5kU29ydGVyKGl0ZW0uY29sdW1uKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLl9zb3J0SXRlbShkYXRhLCBpdGVtLmNvbHVtbiwgaXRlbS5kaXIsIHNvcnRMaXN0LCBpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuc2V0Q29sdW1uSGVhZGVyKGl0ZW0uY29sdW1uLCBpdGVtLmRpcik7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c29ydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkge1xuXHRcdFx0XHRzZWxmLnNldENvbHVtbkhlYWRlcihpdGVtLmNvbHVtbiwgaXRlbS5kaXIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudGFibGUub3B0aW9ucy5kYXRhU29ydGVkKSB7XG5cdFx0XHRzZWxmLnRhYmxlLm9wdGlvbnMuZGF0YVNvcnRlZC5jYWxsKHNlbGYudGFibGUsIHNlbGYuZ2V0U29ydCgpLCBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Q29tcG9uZW50cyhcImFjdGl2ZVwiKSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vY2xlYXIgc29ydCBhcnJvd3Mgb24gY29sdW1uc1xuXHRTb3J0LnByb3RvdHlwZS5jbGVhckNvbHVtbkhlYWRlcnMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFJlYWxDb2x1bW5zKCkuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0XHRpZiAoY29sdW1uLm1vZHVsZXMuc29ydCkge1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5zb3J0LmRpciA9IFwibm9uZVwiO1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBcIm5vbmVcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0Ly9zZXQgdGhlIGNvbHVtbiBoZWFkZXIgc29ydCBkaXJlY3Rpb25cblx0U29ydC5wcm90b3R5cGUuc2V0Q29sdW1uSGVhZGVyID0gZnVuY3Rpb24gKGNvbHVtbiwgZGlyKSB7XG5cdFx0Y29sdW1uLm1vZHVsZXMuc29ydC5kaXIgPSBkaXI7XG5cdFx0Y29sdW1uLmdldEVsZW1lbnQoKS5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgZGlyKTtcblx0fTtcblxuXHQvL3NvcnQgZWFjaCBpdGVtIGluIHNvcnQgbGlzdFxuXHRTb3J0LnByb3RvdHlwZS5fc29ydEl0ZW0gPSBmdW5jdGlvbiAoZGF0YSwgY29sdW1uLCBkaXIsIHNvcnRMaXN0LCBpKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0dmFyIHBhcmFtcyA9IHR5cGVvZiBjb2x1bW4ubW9kdWxlcy5zb3J0LnBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gY29sdW1uLm1vZHVsZXMuc29ydC5wYXJhbXMoY29sdW1uLmdldENvbXBvbmVudCgpLCBkaXIpIDogY29sdW1uLm1vZHVsZXMuc29ydC5wYXJhbXM7XG5cblx0XHRkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcblxuXHRcdFx0dmFyIHJlc3VsdCA9IHNlbGYuX3NvcnRSb3coYSwgYiwgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG5cblx0XHRcdC8vaWYgcmVzdWx0cyBtYXRjaCByZWN1cnNlIHRocm91Z2ggcHJldmlvdXMgc2VhcmNocyB0byBiZSBzdXJlXG5cdFx0XHRpZiAocmVzdWx0ID09PSAwICYmIGkpIHtcblx0XHRcdFx0Zm9yICh2YXIgaiA9IGkgLSAxOyBqID49IDA7IGotLSkge1xuXHRcdFx0XHRcdHJlc3VsdCA9IHNlbGYuX3NvcnRSb3coYSwgYiwgc29ydExpc3Rbal0uY29sdW1uLCBzb3J0TGlzdFtqXS5kaXIsIHBhcmFtcyk7XG5cblx0XHRcdFx0XHRpZiAocmVzdWx0ICE9PSAwKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9KTtcblx0fTtcblxuXHQvL3Byb2Nlc3MgaW5kaXZpZHVhbCByb3dzIGZvciBhIHNvcnQgZnVuY3Rpb24gb24gYWN0aXZlIGRhdGFcblx0U29ydC5wcm90b3R5cGUuX3NvcnRSb3cgPSBmdW5jdGlvbiAoYSwgYiwgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdHZhciBlbDFDb21wLCBlbDJDb21wLCBjb2xDb21wO1xuXG5cdFx0Ly9zd2l0Y2ggZWxlbWVudHMgZGVwZW5kaW5nIG9uIHNlYXJjaCBkaXJlY3Rpb25cblx0XHR2YXIgZWwxID0gZGlyID09IFwiYXNjXCIgPyBhIDogYjtcblx0XHR2YXIgZWwyID0gZGlyID09IFwiYXNjXCIgPyBiIDogYTtcblxuXHRcdGEgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShlbDEuZ2V0RGF0YSgpKTtcblx0XHRiID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZWwyLmdldERhdGEoKSk7XG5cblx0XHRhID0gdHlwZW9mIGEgIT09IFwidW5kZWZpbmVkXCIgPyBhIDogXCJcIjtcblx0XHRiID0gdHlwZW9mIGIgIT09IFwidW5kZWZpbmVkXCIgPyBiIDogXCJcIjtcblxuXHRcdGVsMUNvbXAgPSBlbDEuZ2V0Q29tcG9uZW50KCk7XG5cdFx0ZWwyQ29tcCA9IGVsMi5nZXRDb21wb25lbnQoKTtcblxuXHRcdHJldHVybiBjb2x1bW4ubW9kdWxlcy5zb3J0LnNvcnRlci5jYWxsKHRoaXMsIGEsIGIsIGVsMUNvbXAsIGVsMkNvbXAsIGNvbHVtbi5nZXRDb21wb25lbnQoKSwgZGlyLCBwYXJhbXMpO1xuXHR9O1xuXG5cdC8vZGVmYXVsdCBkYXRhIHNvcnRlcnNcblx0U29ydC5wcm90b3R5cGUuc29ydGVycyA9IHtcblxuXHRcdC8vc29ydCBudW1iZXJzXG5cdFx0bnVtYmVyOiBmdW5jdGlvbiBudW1iZXIoYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcztcblx0XHRcdHZhciBkZWNpbWFsID0gcGFyYW1zLmRlY2ltYWxTZXBhcmF0b3IgfHwgXCIuXCI7XG5cdFx0XHR2YXIgdGhvdXNhbmQgPSBwYXJhbXMudGhvdXNhbmRTZXBhcmF0b3IgfHwgXCIsXCI7XG5cdFx0XHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGEgPSBwYXJzZUZsb2F0KFN0cmluZyhhKS5zcGxpdCh0aG91c2FuZCkuam9pbihcIlwiKS5zcGxpdChkZWNpbWFsKS5qb2luKFwiLlwiKSk7XG5cdFx0XHRiID0gcGFyc2VGbG9hdChTdHJpbmcoYikuc3BsaXQodGhvdXNhbmQpLmpvaW4oXCJcIikuc3BsaXQoZGVjaW1hbCkuam9pbihcIi5cIikpO1xuXG5cdFx0XHQvL2hhbmRsZSBub24gbnVtZXJpYyB2YWx1ZXNcblx0XHRcdGlmIChpc05hTihhKSkge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gaXNOYU4oYikgPyAwIDogLTE7XG5cdFx0XHR9IGVsc2UgaWYgKGlzTmFOKGIpKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gPSAxO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly9jb21wYXJlIHZhbGlkIHZhbHVlc1xuXHRcdFx0XHRyZXR1cm4gYSAtIGI7XG5cdFx0XHR9XG5cblx0XHRcdC8vZml4IGVtcHR5IHZhbHVlcyBpbiBwb3NpdGlvblxuXHRcdFx0aWYgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIiB8fCBhbGlnbkVtcHR5VmFsdWVzID09PSBcImJvdHRvbVwiICYmIGRpciA9PT0gXCJhc2NcIikge1xuXHRcdFx0XHRlbXB0eUFsaWduICo9IC0xO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZW1wdHlBbGlnbjtcblx0XHR9LFxuXG5cdFx0Ly9zb3J0IHN0cmluZ3Ncblx0XHRzdHJpbmc6IGZ1bmN0aW9uIHN0cmluZyhhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHR2YXIgYWxpZ25FbXB0eVZhbHVlcyA9IHBhcmFtcy5hbGlnbkVtcHR5VmFsdWVzO1xuXHRcdFx0dmFyIGVtcHR5QWxpZ24gPSAwO1xuXHRcdFx0dmFyIGxvY2FsZTtcblxuXHRcdFx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdFx0XHRpZiAoIWEpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiA9ICFiID8gMCA6IC0xO1xuXHRcdFx0fSBlbHNlIGlmICghYikge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gMTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vY29tcGFyZSB2YWxpZCB2YWx1ZXNcblx0XHRcdFx0c3dpdGNoIChfdHlwZW9mKHBhcmFtcy5sb2NhbGUpKSB7XG5cdFx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRcdGlmIChwYXJhbXMubG9jYWxlKSB7XG5cdFx0XHRcdFx0XHRcdGxvY2FsZSA9IHRoaXMudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5nZXRMb2NhbGUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdGxvY2FsZSA9IHBhcmFtcy5sb2NhbGU7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBTdHJpbmcoYSkudG9Mb3dlckNhc2UoKS5sb2NhbGVDb21wYXJlKFN0cmluZyhiKS50b0xvd2VyQ2FzZSgpLCBsb2NhbGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0XHRcdGlmIChhbGlnbkVtcHR5VmFsdWVzID09PSBcInRvcFwiICYmIGRpciA9PT0gXCJkZXNjXCIgfHwgYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJib3R0b21cIiAmJiBkaXIgPT09IFwiYXNjXCIpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVtcHR5QWxpZ247XG5cdFx0fSxcblxuXHRcdC8vc29ydCBkYXRlXG5cdFx0ZGF0ZTogZnVuY3Rpb24gZGF0ZShhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHRpZiAoIXBhcmFtcy5mb3JtYXQpIHtcblx0XHRcdFx0cGFyYW1zLmZvcm1hdCA9IFwiREQvTU0vWVlZWVwiO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3J0ZXJzLmRhdGV0aW1lLmNhbGwodGhpcywgYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG5cdFx0fSxcblxuXHRcdC8vc29ydCBoaDptbSBmb3JtYXR0ZWQgdGltZXNcblx0XHR0aW1lOiBmdW5jdGlvbiB0aW1lKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdGlmICghcGFyYW1zLmZvcm1hdCkge1xuXHRcdFx0XHRwYXJhbXMuZm9ybWF0ID0gXCJoaDptbVwiO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3J0ZXJzLmRhdGV0aW1lLmNhbGwodGhpcywgYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG5cdFx0fSxcblxuXHRcdC8vc29ydCBkYXRldGltZVxuXHRcdGRhdGV0aW1lOiBmdW5jdGlvbiBkYXRldGltZShhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKSB7XG5cdFx0XHR2YXIgZm9ybWF0ID0gcGFyYW1zLmZvcm1hdCB8fCBcIkREL01NL1lZWVkgaGg6bW06c3NcIixcblx0XHRcdCAgICBhbGlnbkVtcHR5VmFsdWVzID0gcGFyYW1zLmFsaWduRW1wdHlWYWx1ZXMsXG5cdFx0XHQgICAgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGlmICh0eXBlb2YgbW9tZW50ICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0YSA9IG1vbWVudChhLCBmb3JtYXQpO1xuXHRcdFx0XHRiID0gbW9tZW50KGIsIGZvcm1hdCk7XG5cblx0XHRcdFx0aWYgKCFhLmlzVmFsaWQoKSkge1xuXHRcdFx0XHRcdGVtcHR5QWxpZ24gPSAhYi5pc1ZhbGlkKCkgPyAwIDogLTE7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIWIuaXNWYWxpZCgpKSB7XG5cdFx0XHRcdFx0ZW1wdHlBbGlnbiA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly9jb21wYXJlIHZhbGlkIHZhbHVlc1xuXHRcdFx0XHRcdHJldHVybiBhIC0gYjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vZml4IGVtcHR5IHZhbHVlcyBpbiBwb3NpdGlvblxuXHRcdFx0XHRpZiAoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJ0b3BcIiAmJiBkaXIgPT09IFwiZGVzY1wiIHx8IGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSB7XG5cdFx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBlbXB0eUFsaWduO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlNvcnQgRXJyb3IgLSAnZGF0ZXRpbWUnIHNvcnRlciBpcyBkZXBlbmRhbnQgb24gbW9tZW50LmpzXCIpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvL3NvcnQgYm9vbGVhbnNcblx0XHRib29sZWFuOiBmdW5jdGlvbiBib29sZWFuKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdHZhciBlbDEgPSBhID09PSB0cnVlIHx8IGEgPT09IFwidHJ1ZVwiIHx8IGEgPT09IFwiVHJ1ZVwiIHx8IGEgPT09IDEgPyAxIDogMDtcblx0XHRcdHZhciBlbDIgPSBiID09PSB0cnVlIHx8IGIgPT09IFwidHJ1ZVwiIHx8IGIgPT09IFwiVHJ1ZVwiIHx8IGIgPT09IDEgPyAxIDogMDtcblxuXHRcdFx0cmV0dXJuIGVsMSAtIGVsMjtcblx0XHR9LFxuXG5cdFx0Ly9zb3J0IGlmIGVsZW1lbnQgY29udGFpbnMgYW55IGRhdGFcblx0XHRhcnJheTogZnVuY3Rpb24gYXJyYXkoYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGVsMSA9IDA7XG5cdFx0XHR2YXIgZWwyID0gMDtcblx0XHRcdHZhciB0eXBlID0gcGFyYW1zLnR5cGUgfHwgXCJsZW5ndGhcIjtcblx0XHRcdHZhciBhbGlnbkVtcHR5VmFsdWVzID0gcGFyYW1zLmFsaWduRW1wdHlWYWx1ZXM7XG5cdFx0XHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cblx0XHRcdGZ1bmN0aW9uIGNhbGModmFsdWUpIHtcblxuXHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRjYXNlIFwibGVuZ3RoXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwic3VtXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUucmVkdWNlKGZ1bmN0aW9uIChjLCBkKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBjICsgZDtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwibWF4XCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwibWluXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gTWF0aC5taW4uYXBwbHkobnVsbCwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiYXZnXCI6XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWUucmVkdWNlKGZ1bmN0aW9uIChjLCBkKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBjICsgZDtcblx0XHRcdFx0XHRcdH0pIC8gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly9oYW5kbGUgbm9uIGFycmF5IHZhbHVlc1xuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGEpKSB7XG5cdFx0XHRcdGFsaWduRW1wdHlWYWx1ZXMgPSAhQXJyYXkuaXNBcnJheShiKSA/IDAgOiAtMTtcblx0XHRcdH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoYikpIHtcblx0XHRcdFx0YWxpZ25FbXB0eVZhbHVlcyA9IDE7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vY29tcGFyZSB2YWxpZCB2YWx1ZXNcblx0XHRcdFx0ZWwxID0gYSA/IGNhbGMoYSkgOiAwO1xuXHRcdFx0XHRlbDIgPSBiID8gY2FsYyhiKSA6IDA7XG5cblx0XHRcdFx0cmV0dXJuIGVsMSAtIGVsMjtcblx0XHRcdH1cblxuXHRcdFx0Ly9maXggZW1wdHkgdmFsdWVzIGluIHBvc2l0aW9uXG5cdFx0XHRpZiAoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJ0b3BcIiAmJiBkaXIgPT09IFwiZGVzY1wiIHx8IGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gKj0gLTE7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbXB0eUFsaWduO1xuXHRcdH0sXG5cblx0XHQvL3NvcnQgaWYgZWxlbWVudCBjb250YWlucyBhbnkgZGF0YVxuXHRcdGV4aXN0czogZnVuY3Rpb24gZXhpc3RzKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpIHtcblx0XHRcdHZhciBlbDEgPSB0eXBlb2YgYSA9PSBcInVuZGVmaW5lZFwiID8gMCA6IDE7XG5cdFx0XHR2YXIgZWwyID0gdHlwZW9mIGIgPT0gXCJ1bmRlZmluZWRcIiA/IDAgOiAxO1xuXG5cdFx0XHRyZXR1cm4gZWwxIC0gZWwyO1xuXHRcdH0sXG5cblx0XHQvL3NvcnQgYWxwaGEgbnVtZXJpYyBzdHJpbmdzXG5cdFx0YWxwaGFudW06IGZ1bmN0aW9uIGFscGhhbnVtKGFzLCBicywgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcykge1xuXHRcdFx0dmFyIGEsXG5cdFx0XHQgICAgYixcblx0XHRcdCAgICBhMSxcblx0XHRcdCAgICBiMSxcblx0XHRcdCAgICBpID0gMCxcblx0XHRcdCAgICBMLFxuXHRcdFx0ICAgIHJ4ID0gLyhcXGQrKXwoXFxEKykvZyxcblx0XHRcdCAgICByZCA9IC9cXGQvO1xuXHRcdFx0dmFyIGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcztcblx0XHRcdHZhciBlbXB0eUFsaWduID0gMDtcblxuXHRcdFx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdFx0XHRpZiAoIWFzICYmIGFzICE9PSAwKSB7XG5cdFx0XHRcdGVtcHR5QWxpZ24gPSAhYnMgJiYgYnMgIT09IDAgPyAwIDogLTE7XG5cdFx0XHR9IGVsc2UgaWYgKCFicyAmJiBicyAhPT0gMCkge1xuXHRcdFx0XHRlbXB0eUFsaWduID0gMTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0aWYgKGlzRmluaXRlKGFzKSAmJiBpc0Zpbml0ZShicykpIHJldHVybiBhcyAtIGJzO1xuXHRcdFx0XHRhID0gU3RyaW5nKGFzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRiID0gU3RyaW5nKGJzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRpZiAoYSA9PT0gYikgcmV0dXJuIDA7XG5cdFx0XHRcdGlmICghKHJkLnRlc3QoYSkgJiYgcmQudGVzdChiKSkpIHJldHVybiBhID4gYiA/IDEgOiAtMTtcblx0XHRcdFx0YSA9IGEubWF0Y2gocngpO1xuXHRcdFx0XHRiID0gYi5tYXRjaChyeCk7XG5cdFx0XHRcdEwgPSBhLmxlbmd0aCA+IGIubGVuZ3RoID8gYi5sZW5ndGggOiBhLmxlbmd0aDtcblx0XHRcdFx0d2hpbGUgKGkgPCBMKSB7XG5cdFx0XHRcdFx0YTEgPSBhW2ldO1xuXHRcdFx0XHRcdGIxID0gYltpKytdO1xuXHRcdFx0XHRcdGlmIChhMSAhPT0gYjEpIHtcblx0XHRcdFx0XHRcdGlmIChpc0Zpbml0ZShhMSkgJiYgaXNGaW5pdGUoYjEpKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChhMS5jaGFyQXQoMCkgPT09IFwiMFwiKSBhMSA9IFwiLlwiICsgYTE7XG5cdFx0XHRcdFx0XHRcdGlmIChiMS5jaGFyQXQoMCkgPT09IFwiMFwiKSBiMSA9IFwiLlwiICsgYjE7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBhMSAtIGIxO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHJldHVybiBhMSA+IGIxID8gMSA6IC0xO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBhLmxlbmd0aCA+IGIubGVuZ3RoO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0XHRcdGlmIChhbGlnbkVtcHR5VmFsdWVzID09PSBcInRvcFwiICYmIGRpciA9PT0gXCJkZXNjXCIgfHwgYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJib3R0b21cIiAmJiBkaXIgPT09IFwiYXNjXCIpIHtcblx0XHRcdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVtcHR5QWxpZ247XG5cdFx0fVxuXHR9O1xuXG5cdFRhYnVsYXRvci5wcm90b3R5cGUucmVnaXN0ZXJNb2R1bGUoXCJzb3J0XCIsIFNvcnQpO1xuXG5cdHZhciBWYWxpZGF0ZSA9IGZ1bmN0aW9uIFZhbGlkYXRlKHRhYmxlKSB7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXHR9O1xuXG5cdC8vdmFsaWRhdGVcblx0VmFsaWRhdGUucHJvdG90eXBlLmluaXRpYWxpemVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICBjb25maWcgPSBbXSxcblx0XHQgICAgdmFsaWRhdG9yO1xuXG5cdFx0aWYgKGNvbHVtbi5kZWZpbml0aW9uLnZhbGlkYXRvcikge1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShjb2x1bW4uZGVmaW5pdGlvbi52YWxpZGF0b3IpKSB7XG5cdFx0XHRcdGNvbHVtbi5kZWZpbml0aW9uLnZhbGlkYXRvci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0dmFsaWRhdG9yID0gc2VsZi5fZXh0cmFjdFZhbGlkYXRvcihpdGVtKTtcblxuXHRcdFx0XHRcdGlmICh2YWxpZGF0b3IpIHtcblx0XHRcdFx0XHRcdGNvbmZpZy5wdXNoKHZhbGlkYXRvcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhbGlkYXRvciA9IHRoaXMuX2V4dHJhY3RWYWxpZGF0b3IoY29sdW1uLmRlZmluaXRpb24udmFsaWRhdG9yKTtcblxuXHRcdFx0XHRpZiAodmFsaWRhdG9yKSB7XG5cdFx0XHRcdFx0Y29uZmlnLnB1c2godmFsaWRhdG9yKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjb2x1bW4ubW9kdWxlcy52YWxpZGF0ZSA9IGNvbmZpZy5sZW5ndGggPyBjb25maWcgOiBmYWxzZTtcblx0XHR9XG5cdH07XG5cblx0VmFsaWRhdGUucHJvdG90eXBlLl9leHRyYWN0VmFsaWRhdG9yID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0dmFyIHR5cGUsIHBhcmFtcywgcG9zO1xuXG5cdFx0c3dpdGNoICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkge1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRwb3MgPSB2YWx1ZS5pbmRleE9mKCc6Jyk7XG5cblx0XHRcdFx0aWYgKHBvcyA+IC0xKSB7XG5cdFx0XHRcdFx0dHlwZSA9IHZhbHVlLnN1YnN0cmluZygwLCBwb3MpO1xuXHRcdFx0XHRcdHBhcmFtcyA9IHZhbHVlLnN1YnN0cmluZyhwb3MgKyAxKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0eXBlID0gdmFsdWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fYnVpbGRWYWxpZGF0b3IodHlwZSwgcGFyYW1zKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fYnVpbGRWYWxpZGF0b3IodmFsdWUpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcIm9iamVjdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fYnVpbGRWYWxpZGF0b3IodmFsdWUudHlwZSwgdmFsdWUucGFyYW1ldGVycyk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fTtcblxuXHRWYWxpZGF0ZS5wcm90b3R5cGUuX2J1aWxkVmFsaWRhdG9yID0gZnVuY3Rpb24gKHR5cGUsIHBhcmFtcykge1xuXG5cdFx0dmFyIGZ1bmMgPSB0eXBlb2YgdHlwZSA9PSBcImZ1bmN0aW9uXCIgPyB0eXBlIDogdGhpcy52YWxpZGF0b3JzW3R5cGVdO1xuXG5cdFx0aWYgKCFmdW5jKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJWYWxpZGF0b3IgU2V0dXAgRXJyb3IgLSBObyBtYXRjaGluZyB2YWxpZGF0b3IgZm91bmQ6XCIsIHR5cGUpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR0eXBlOiB0eXBlb2YgdHlwZSA9PSBcImZ1bmN0aW9uXCIgPyBcImZ1bmN0aW9uXCIgOiB0eXBlLFxuXHRcdFx0XHRmdW5jOiBmdW5jLFxuXHRcdFx0XHRwYXJhbXM6IHBhcmFtc1xuXHRcdFx0fTtcblx0XHR9XG5cdH07XG5cblx0VmFsaWRhdGUucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKHZhbGlkYXRvcnMsIGNlbGwsIHZhbHVlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdCAgICB2YWxpZCA9IFtdO1xuXG5cdFx0aWYgKHZhbGlkYXRvcnMpIHtcblx0XHRcdHZhbGlkYXRvcnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRpZiAoIWl0ZW0uZnVuYy5jYWxsKHNlbGYsIGNlbGwsIHZhbHVlLCBpdGVtLnBhcmFtcykpIHtcblx0XHRcdFx0XHR2YWxpZC5wdXNoKHtcblx0XHRcdFx0XHRcdHR5cGU6IGl0ZW0udHlwZSxcblx0XHRcdFx0XHRcdHBhcmFtZXRlcnM6IGl0ZW0ucGFyYW1zXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiB2YWxpZC5sZW5ndGggPyB2YWxpZCA6IHRydWU7XG5cdH07XG5cblx0VmFsaWRhdGUucHJvdG90eXBlLnZhbGlkYXRvcnMgPSB7XG5cblx0XHQvL2lzIGludGVnZXJcblx0XHRpbnRlZ2VyOiBmdW5jdGlvbiBpbnRlZ2VyKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHRcdFx0cmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUodmFsdWUpICYmIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZTtcblx0XHR9LFxuXG5cdFx0Ly9pcyBmbG9hdFxuXHRcdGZsb2F0OiBmdW5jdGlvbiBmbG9hdChjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblx0XHRcdHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIGlzRmluaXRlKHZhbHVlKSAmJiB2YWx1ZSAlIDEgIT09IDA7XG5cdFx0fSxcblxuXHRcdC8vbXVzdCBiZSBhIG51bWJlclxuXHRcdG51bWVyaWM6IGZ1bmN0aW9uIG51bWVyaWMoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gIWlzTmFOKHZhbHVlKTtcblx0XHR9LFxuXG5cdFx0Ly9tdXN0IGJlIGEgc3RyaW5nXG5cdFx0c3RyaW5nOiBmdW5jdGlvbiBzdHJpbmcoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gaXNOYU4odmFsdWUpO1xuXHRcdH0sXG5cblx0XHQvL21heGltdW0gdmFsdWVcblx0XHRtYXg6IGZ1bmN0aW9uIG1heChjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA8PSBwYXJhbWV0ZXJzO1xuXHRcdH0sXG5cblx0XHQvL21pbmltdW0gdmFsdWVcblx0XHRtaW46IGZ1bmN0aW9uIG1pbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA+PSBwYXJhbWV0ZXJzO1xuXHRcdH0sXG5cblx0XHQvL21pbmltdW0gc3RyaW5nIGxlbmd0aFxuXHRcdG1pbkxlbmd0aDogZnVuY3Rpb24gbWluTGVuZ3RoKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkubGVuZ3RoID49IHBhcmFtZXRlcnM7XG5cdFx0fSxcblxuXHRcdC8vbWF4aW11bSBzdHJpbmcgbGVuZ3RoXG5cdFx0bWF4TGVuZ3RoOiBmdW5jdGlvbiBtYXhMZW5ndGgoY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gU3RyaW5nKHZhbHVlKS5sZW5ndGggPD0gcGFyYW1ldGVycztcblx0XHR9LFxuXG5cdFx0Ly9pbiBwcm92aWRlZCB2YWx1ZSBsaXN0XG5cdFx0aW46IGZ1bmN0aW9uIF9pbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdGlmICh0eXBlb2YgcGFyYW1ldGVycyA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzLnNwbGl0KFwifFwiKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHZhbHVlID09PSBcIlwiIHx8IHBhcmFtZXRlcnMuaW5kZXhPZih2YWx1ZSkgPiAtMTtcblx0XHR9LFxuXG5cdFx0Ly9tdXN0IG1hdGNoIHByb3ZpZGVkIHJlZ2V4XG5cdFx0cmVnZXg6IGZ1bmN0aW9uIHJlZ2V4KGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHJlZyA9IG5ldyBSZWdFeHAocGFyYW1ldGVycyk7XG5cblx0XHRcdHJldHVybiByZWcudGVzdCh2YWx1ZSk7XG5cdFx0fSxcblxuXHRcdC8vdmFsdWUgbXVzdCBiZSB1bmlxdWUgaW4gdGhpcyBjb2x1bW5cblx0XHR1bmlxdWU6IGZ1bmN0aW9uIHVuaXF1ZShjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycykge1xuXHRcdFx0aWYgKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHZhciB1bmlxdWUgPSB0cnVlO1xuXG5cdFx0XHR2YXIgY2VsbERhdGEgPSBjZWxsLmdldERhdGEoKTtcblx0XHRcdHZhciBjb2x1bW4gPSBjZWxsLmdldENvbHVtbigpLl9nZXRTZWxmKCk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuXHRcdFx0XHR2YXIgZGF0YSA9IHJvdy5nZXREYXRhKCk7XG5cblx0XHRcdFx0aWYgKGRhdGEgIT09IGNlbGxEYXRhKSB7XG5cdFx0XHRcdFx0aWYgKHZhbHVlID09IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpKSB7XG5cdFx0XHRcdFx0XHR1bmlxdWUgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdW5pcXVlO1xuXHRcdH0sXG5cblx0XHQvL211c3QgaGF2ZSBhIHZhbHVlXG5cdFx0cmVxdWlyZWQ6IGZ1bmN0aW9uIHJlcXVpcmVkKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gdmFsdWUgIT09IFwiXCIgJiYgdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiO1xuXHRcdH1cblx0fTtcblxuXHRUYWJ1bGF0b3IucHJvdG90eXBlLnJlZ2lzdGVyTW9kdWxlKFwidmFsaWRhdGVcIiwgVmFsaWRhdGUpO1xuXG5cdHJldHVybiBUYWJ1bGF0b3I7XG59KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vdGFidWxhdG9yLXRhYmxlcy9kaXN0L2pzL3RhYnVsYXRvci5qc1xuLy8gbW9kdWxlIGlkID0gMjhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaW1wb3J0IHsgUXVlc3Rpb24gfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcbmltcG9ydCB7IFZpc3VhbGl6ZXJCYXNlIH0gZnJvbSBcIi4vdmlzdWFsaXplckJhc2VcIjtcbmltcG9ydCB7IGxvY2FsaXphdGlvbiB9IGZyb20gXCIuL2xvY2FsaXphdGlvbk1hbmFnZXJcIjtcbmltcG9ydCB7IFRvb2xiYXJIZWxwZXIgfSBmcm9tIFwiLi91dGlscy9pbmRleFwiO1xuXG5leHBvcnQgY2xhc3MgQWx0ZXJuYXRpdmVWaXN1YWxpemVyc1dyYXBwZXIgZXh0ZW5kcyBWaXN1YWxpemVyQmFzZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdmlzdWFsaXplcnM6IEFycmF5PFZpc3VhbGl6ZXJCYXNlPixcbiAgICB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgICBxdWVzdGlvbjogUXVlc3Rpb24sXG4gICAgZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PixcbiAgICBvcHRpb25zPzogT2JqZWN0XG4gICkge1xuICAgIHN1cGVyKHRhcmdldEVsZW1lbnQsIHF1ZXN0aW9uLCBkYXRhLCBvcHRpb25zKTtcbiAgICBpZighdmlzdWFsaXplcnMgfHwgdmlzdWFsaXplcnMubGVuZ3RoIDwgMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmlzdWFsaXplckFycmF5V3JhcHBlciB3b3JrcyB3aXRoIHZpc3VhbGl6ZXJzIGNvbGxlY3Rpb24gb25seS5cIik7XG4gICAgfVxuICAgIHRoaXMudmlzdWFsaXplciA9IHZpc3VhbGl6ZXJzWzBdO1xuICB9XG5cbiAgcHJvdGVjdGVkIHZpc3VhbGl6ZXJDb250YWluZXI6IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgdmlzdWFsaXplcjogVmlzdWFsaXplckJhc2U7XG5cbiAgcHJpdmF0ZSBzZXRWaXN1YWxpemVyKG5hbWU6IHN0cmluZykge1xuICAgIGlmKCEhdGhpcy52aXN1YWxpemVyKSB7XG4gICAgICB0aGlzLnZpc3VhbGl6ZXIuZGVzdHJveSgpO1xuICAgIH1cbiAgICB0aGlzLnZpc3VhbGl6ZXIgPSB0aGlzLnZpc3VhbGl6ZXJzLmZpbHRlcih2ID0+IHYubmFtZSA9PT0gbmFtZSlbMF07XG4gICAgdGhpcy52aXN1YWxpemVyLnJlbmRlcih0aGlzLnZpc3VhbGl6ZXJDb250YWluZXIpO1xuICAgIHRoaXMuaW52b2tlT25VcGRhdGUoKTtcbiAgfVxuXG4gIHVwZGF0ZShkYXRhOiBBcnJheTx7IFtpbmRleDogc3RyaW5nXTogYW55IH0+KSB7XG4gICAgdGhpcy52aXN1YWxpemVyLnVwZGF0ZShkYXRhKTtcbiAgfVxuXG4gIG9uVXBkYXRlOiAoKSA9PiB2b2lkO1xuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy52aXN1YWxpemVyLmRlc3Ryb3koKTtcbiAgICBzdXBlci5kZXN0cm95KCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVuZGVyQ29udGVudChjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XG4gICAgdGhpcy52aXN1YWxpemVyQ29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIHRoaXMudmlzdWFsaXplci5yZW5kZXIodGhpcy52aXN1YWxpemVyQ29udGFpbmVyKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVUb29sYmFySXRlbXModG9vbGJhcjogSFRNTERpdkVsZW1lbnQpIHtcbiAgICBjb25zdCBzZWxlY3RXcmFwcGVyID0gVG9vbGJhckhlbHBlci5jcmVhdGVTZWxlY3Rvcih0b29sYmFyLFxuICAgICAgdGhpcy52aXN1YWxpemVycy5tYXAodmlzdWFsaXplciA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IHZpc3VhbGl6ZXIubmFtZSxcbiAgICAgICAgICB0ZXh0OiBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwidmlzdWFsaXplcl9cIiArIHZpc3VhbGl6ZXIubmFtZSlcbiAgICAgICAgfTtcbiAgICAgIH0pLFxuICAgICAgKG9wdGlvbjogYW55KSA9PiB0aGlzLnZpc3VhbGl6ZXIubmFtZSA9PT0gb3B0aW9uLnZhbHVlLFxuICAgICAgKGU6IGFueSkgPT4gdGhpcy5zZXRWaXN1YWxpemVyKGUudGFyZ2V0LnZhbHVlKVxuICAgICk7XG4gICAgdG9vbGJhci5hcHBlbmRDaGlsZChzZWxlY3RXcmFwcGVyKTtcbiAgICBzdXBlci5jcmVhdGVUb29sYmFySXRlbXModG9vbGJhcik7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9hbHRlcm5hdGl2ZVZpenVhbGl6ZXJzV3JhcHBlci50cyIsImV4cG9ydCBlbnVtIEVsZW1lbnRWaXNpYmlsaXR5IHtcclxuICBWaXNpYmxlLFxyXG4gIEludmlzaWJsZSxcclxuICBQdWJsaWNJbnZpc2libGUsXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVZpc3VhbGl6ZXJQYW5lbEVsZW1lbnQge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBkaXNwbGF5TmFtZTogc3RyaW5nO1xyXG4gIHZpc2liaWxpdHk6IEVsZW1lbnRWaXNpYmlsaXR5O1xyXG4gIHR5cGU/OiBzdHJpbmc7XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2NvbmZpZy50cyIsIi8vVW5jb21tZW50IHRoaXMgbGluZSBvbiBjcmVhdGluZyBhIHRyYW5zbGF0aW9uIGZpbGVcbi8vaW1wb3J0IHsgbG9jYWxpemF0aW9uIH0gZnJvbSBcIi4uL2xvY2FsaXphdGlvbk1hbmFnZXJcIjtcblxuZXhwb3J0IHZhciBlbmdsaXNoU3RyaW5ncyA9IHtcbiAgZ3JvdXBCdXR0b246IFwiR3JvdXAgQnkgTWVcIixcbiAgdW5ncm91cEJ1dHRvbjogXCJVbmdyb3VwIEJ5IE1lXCIsXG4gIHNlbGVjdEJ1dHRvbjogXCJTZWxlY3QgTWVcIixcbiAgaGlkZUNvbHVtbjogXCJIaWRlIGNvbHVtblwiLFxuICBzaG93Q29sdW1uOiBcIlNob3cgY29sdW1uXCIsXG4gIG1ha2VQcml2YXRlQ29sdW1uOiBcIk1ha2UgY29sdW1uIHByaXZhdGVcIixcbiAgbWFrZVB1YmxpY0NvbHVtbjogXCJNYWtlIGNvbHVtbiBwdWJsaWNcIixcbiAgbW92ZVRvRGV0YWlsOiBcIk1vdmUgdG8gRGV0YWlsXCIsXG4gIHNob3dBc0NvbHVtbjogXCJTaG93IGFzIENvbHVtblwiLFxuICB2aXN1YWxpemVyX3RleHQ6IFwiVGV4dHMgaW4gdGFibGVcIixcbiAgdmlzdWFsaXplcl93b3JkY2xvdWQ6IFwiV29yZGNsb3VkXCIsXG4gIGNoYXJ0VHlwZV9iYXI6IFwiQmFyXCIsXG4gIGNoYXJ0VHlwZV9zdGFja2VkYmFyOiBcIlN0YWNrZWQgQmFyXCIsXG4gIGNoYXJ0VHlwZV9kb3VnaG51dDogXCJEb3VnaG51dFwiLFxuICBjaGFydFR5cGVfcGllOiBcIlBpZVwiLFxuICBjaGFydFR5cGVfc2NhdHRlcjogXCJTY2F0dGVyXCIsXG4gIGNoYXJ0VHlwZV9nYXVnZTogXCJHYXVnZVwiLFxuICBjaGFydFR5cGVfYnVsbGV0OiBcIkJ1bGxldFwiLFxuICBoaWRlQnV0dG9uOiBcIkhpZGVcIixcbiAgcmVzZXRGaWx0ZXI6IFwiUmVzZXQgRmlsdGVyXCIsXG4gIGNsZWFyQnV0dG9uOiBcIkNsZWFyXCIsXG4gIGFkZEVsZW1lbnQ6IFwiQ2hvb3NlIHF1ZXN0aW9uIHRvIHNob3cuLi5cIixcbiAgZGVmYXVsdE9yZGVyOiBcIkRlZmF1bHRcIiwgXG4gIGFzY09yZGVyOiBcIkFzY2VuZGluZ1wiLFxuICBkZXNjT3JkZXI6IFwiRGVzY2VuZGluZ1wiLFxuICBzaG93TWlub3JDb2x1bW5zOiBcIlNob3cgbWlub3IgY29sdW1uc1wiXG59O1xuXG4vL1VuY29tbWVudCB0aGVzZSB0d28gbGluZXMgb24gY3JlYXRpbmcgYSB0cmFuc2xhdGlvbiBmaWxlLiBZb3Ugc2hvdWxkIHJlcGxhY2UgXCJlblwiIGFuZCBlblN0cmluZ3Mgd2l0aCB5b3VyIGxvY2FsZSAoXCJmclwiLCBcImRlXCIgYW5kIHNvIG9uKSBhbmQgeW91ciB2YXJpYWJsZS5cbi8vbG9jYWxpemF0aW9uLmxvY2FsZXNbXCJlblwiXSA9IGVuZ2xpc2hTdHJpbmdzO1xuLy9sb2NhbGl6YXRpb24ubG9jYWxlTmFtZXNbXCJlblwiXSA9IFwiRW5nbGlzaFwiO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2xvY2FsaXphdGlvbi9lbmdsaXNoLnRzIiwiaW1wb3J0IHsgUXVlc3Rpb24sIFF1ZXN0aW9uQm9vbGVhbk1vZGVsIH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5pbXBvcnQgeyBJdGVtVmFsdWUgfSBmcm9tIFwic3VydmV5LWNvcmVcIjtcbmltcG9ydCB7IFZpc3VhbGl6YXRpb25NYW5hZ2VyIH0gZnJvbSBcIi4uL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XG5pbXBvcnQgeyBTZWxlY3RCYXNlUGxvdGx5IH0gZnJvbSBcIi4vc2VsZWN0QmFzZVwiO1xuXG5leHBvcnQgY2xhc3MgQm9vbGVhblBsb3RseSBleHRlbmRzIFNlbGVjdEJhc2VQbG90bHkge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgcXVlc3Rpb246IFF1ZXN0aW9uLFxuICAgIGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4sXG4gICAgb3B0aW9ucz86IE9iamVjdFxuICApIHtcbiAgICBzdXBlcih0YXJnZXRFbGVtZW50LCBxdWVzdGlvbiwgZGF0YSwgb3B0aW9ucyk7XG4gICAgdGhpcy5jaGFydFR5cGVzID0gQm9vbGVhblBsb3RseS50eXBlcztcbiAgICB0aGlzLmNoYXJ0VHlwZSA9IHRoaXMuY2hhcnRUeXBlc1swXTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYm9vbGVhblF1ZXN0aW9uKCkge1xuICAgIHJldHVybiA8UXVlc3Rpb25Cb29sZWFuTW9kZWw+dGhpcy5xdWVzdGlvbjtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgdHJ1ZUNvbG9yID0gXCJcIjtcbiAgcHVibGljIHN0YXRpYyBmYWxzZUNvbG9yID0gXCJcIjtcblxuICBwcm90ZWN0ZWQgcGF0Y2hDb25maWdQYXJhbWV0ZXJzKFxuICAgIGNoYXJ0Tm9kZTogb2JqZWN0LFxuICAgIHRyYWNlczogQXJyYXk8b2JqZWN0PixcbiAgICBsYXlvdXQ6IG9iamVjdCxcbiAgICBjb25maWc6IG9iamVjdFxuICApIHtcbiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdldENvbG9ycygpO1xuICAgIGNvbnN0IGJvb2xDb2xvcnMgPSBbXG4gICAgICBCb29sZWFuUGxvdGx5LnRydWVDb2xvciB8fCBjb2xvcnNbMF0sXG4gICAgICBCb29sZWFuUGxvdGx5LmZhbHNlQ29sb3IgfHwgY29sb3JzWzFdXG4gICAgXTtcblxuICAgIGlmICh0aGlzLmNoYXJ0VHlwZSA9PT0gXCJwaWVcIiB8fCB0aGlzLmNoYXJ0VHlwZSA9PT0gXCJkb3VnaG51dFwiKSB7XG4gICAgICB0cmFjZXMuZm9yRWFjaCgodHJhY2U6IGFueSkgPT4ge1xuICAgICAgICB0cmFjZS5tYXJrZXIuY29sb3JzID0gYm9vbENvbG9ycztcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jaGFydFR5cGUgPT09IFwiYmFyXCIpIHtcbiAgICAgIHRyYWNlcy5mb3JFYWNoKCh0cmFjZTogYW55KSA9PiB7XG4gICAgICAgIHRyYWNlLm1hcmtlci5jb2xvciA9IGJvb2xDb2xvcnM7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHR5cGVzID0gW1wicGllXCIsIFwiYmFyXCIsIFwiZG91Z2hudXRcIl07XG5cbiAgcHJvdGVjdGVkIGdldFNlbGVjdGVkSXRlbUJ5VGV4dChpdGVtVGV4dDogc3RyaW5nKSB7XG4gICAgY29uc3QgbGFiZWxzID0gdGhpcy5nZXRMYWJlbHMoKTtcbiAgICBjb25zdCB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygpO1xuICAgIHJldHVybiBuZXcgSXRlbVZhbHVlKHZhbHVlc1tsYWJlbHMuaW5kZXhPZihpdGVtVGV4dCldLCBpdGVtVGV4dCk7XG4gIH1cblxuICBnZXRWYWx1ZXMoKTogQXJyYXk8YW55PiB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHRoaXMuYm9vbGVhblF1ZXN0aW9uLnZhbHVlVHJ1ZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gdGhpcy5ib29sZWFuUXVlc3Rpb24udmFsdWVUcnVlXG4gICAgICAgIDogdHJ1ZSxcbiAgICAgIHRoaXMuYm9vbGVhblF1ZXN0aW9uLnZhbHVlRmFsc2UgIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHRoaXMuYm9vbGVhblF1ZXN0aW9uLnZhbHVlRmFsc2VcbiAgICAgICAgOiBmYWxzZVxuICAgIF07XG4gIH1cblxuICBnZXRMYWJlbHMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgdmFyIGxhYmVscyA9IHRoaXMuZ2V0VmFsdWVzKCk7XG4gICAgaWYgKHRoaXMuYm9vbGVhblF1ZXN0aW9uLmxhYmVsVHJ1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsYWJlbHNbMF0gPSB0aGlzLmJvb2xlYW5RdWVzdGlvbi5sb2NMYWJlbFRydWUudGV4dE9ySHRtbDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYm9vbGVhblF1ZXN0aW9uLmxhYmVsRmFsc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbGFiZWxzWzFdID0gdGhpcy5ib29sZWFuUXVlc3Rpb24ubG9jTGFiZWxGYWxzZS50ZXh0T3JIdG1sO1xuICAgIH1cbiAgICByZXR1cm4gbGFiZWxzO1xuICB9XG5cbiAgZ2V0RGF0YSgpOiBhbnlbXSB7XG4gICAgY29uc3QgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoKTtcbiAgICB2YXIgdHJ1ZUNvdW50ID0gMDtcbiAgICB2YXIgZmFsc2VDb3VudCA9IDA7XG4gICAgdGhpcy5kYXRhLmZvckVhY2gocm93ID0+IHtcbiAgICAgIGNvbnN0IHJvd1ZhbHVlOiBhbnkgPSByb3dbdGhpcy5xdWVzdGlvbi5uYW1lXTtcbiAgICAgIGlmIChyb3dWYWx1ZSA9PT0gdmFsdWVzWzBdKSB7XG4gICAgICAgIHRydWVDb3VudCsrO1xuICAgICAgfVxuICAgICAgaWYgKHJvd1ZhbHVlID09PSB2YWx1ZXNbMV0pIHtcbiAgICAgICAgZmFsc2VDb3VudCsrO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBbW3RydWVDb3VudCwgZmFsc2VDb3VudF1dO1xuICB9XG59XG5cblZpc3VhbGl6YXRpb25NYW5hZ2VyLnJlZ2lzdGVyVmlzdWFsaXplcihcImJvb2xlYW5cIiwgQm9vbGVhblBsb3RseSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvcGxvdGx5L2Jvb2xlYW4udHMiLCJpbXBvcnQgeyBJdGVtVmFsdWUsIFF1ZXN0aW9uTWF0cml4TW9kZWwsIFF1ZXN0aW9uIH0gZnJvbSBcInN1cnZleS1jb3JlXCI7XG5pbXBvcnQgeyBWaXN1YWxpemF0aW9uTWFuYWdlciB9IGZyb20gXCIuLi92aXN1YWxpemF0aW9uTWFuYWdlclwiO1xuaW1wb3J0IHsgU2VsZWN0QmFzZVBsb3RseSB9IGZyb20gXCIuL3NlbGVjdEJhc2VcIjtcblxuZXhwb3J0IGNsYXNzIE1hdHJpeFBsb3RseSBleHRlbmRzIFNlbGVjdEJhc2VQbG90bHkge1xuICBjb25zdHJ1Y3RvcihcbiAgICB0YXJnZXROb2RlOiBIVE1MRWxlbWVudCxcbiAgICBxdWVzdGlvbjogUXVlc3Rpb24sXG4gICAgZGF0YTogQXJyYXk8eyBbaW5kZXg6IHN0cmluZ106IGFueSB9PixcbiAgICBvcHRpb25zPzogT2JqZWN0XG4gICkge1xuICAgIHN1cGVyKHRhcmdldE5vZGUsIHF1ZXN0aW9uLCBkYXRhLCBvcHRpb25zKTtcbiAgICB0aGlzLmNoYXJ0VHlwZXMgPSBNYXRyaXhQbG90bHkudHlwZXM7XG4gICAgdGhpcy5jaGFydFR5cGUgPSB0aGlzLmNoYXJ0VHlwZXNbMF07XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHR5cGVzID0gW1wiYmFyXCIsIFwic3RhY2tlZGJhclwiLCBcInBpZVwiLCBcImRvdWdobnV0XCJdO1xuXG4gIHByb3RlY3RlZCBwYXRjaENvbmZpZ1BhcmFtZXRlcnMoXG4gICAgY2hhcnROb2RlOiBIVE1MRGl2RWxlbWVudCxcbiAgICB0cmFjZXM6IEFycmF5PGFueT4sXG4gICAgbGF5b3V0OiBhbnksXG4gICAgY29uZmlnOiBhbnlcbiAgKSB7XG4gICAgY29uc3QgcXVlc3Rpb246IFF1ZXN0aW9uTWF0cml4TW9kZWwgPSA8YW55PnRoaXMucXVlc3Rpb247XG4gICAgLy92YXIgdmFsdWVUaXRsZXMgPSBxdWVzdGlvbi5jb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLnRleHQpO1xuICAgIGxheW91dC5zaG93bGVnZW5kID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5jaGFydFR5cGUgPT09IFwicGllXCIgfHwgdGhpcy5jaGFydFR5cGUgPT09IFwiZG91Z2hudXRcIikge1xuICAgICAgbGF5b3V0LmdyaWQgPSB7IHJvd3M6IDEsIGNvbHVtbnM6IHRyYWNlcy5sZW5ndGggfTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY2hhcnRUeXBlID09PSBcInN0YWNrZWRiYXJcIikge1xuICAgICAgbGF5b3V0LmhlaWdodCA9IHVuZGVmaW5lZDtcbiAgICAgIGxheW91dC5iYXJtb2RlID0gXCJzdGFja1wiO1xuICAgIH0gZWxzZSB7XG4gICAgICBsYXlvdXQuaGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBxdWVzdGlvbi5jb2x1bW5zLmZvckVhY2goKGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0aGlzLmNoYXJ0VHlwZSA9PT0gXCJwaWVcIiB8fCB0aGlzLmNoYXJ0VHlwZSA9PT0gXCJkb3VnaG51dFwiKSB7XG4gICAgICAgIHRyYWNlc1tpbmRleF0uZG9tYWluID0geyBjb2x1bW46IGluZGV4IH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmFjZXNbaW5kZXhdLmhvdmVyaW5mbyA9IFwieCtuYW1lXCI7XG4gICAgICAgIHRyYWNlc1tpbmRleF0ubWFya2VyLmNvbG9yID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5jaGFydFR5cGUgPT09IFwic3RhY2tlZGJhclwiKSB7XG4gICAgICAgICAgdHJhY2VzW2luZGV4XS50eXBlID0gXCJiYXJcIjtcbiAgICAgICAgICB0cmFjZXNbaW5kZXhdLm5hbWUgPSBjb2x1bW4udGV4dDtcbiAgICAgICAgICB0cmFjZXNbaW5kZXhdLndpZHRoID0gMC41IC8gdHJhY2VzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0cmFjZXNbaW5kZXhdLm5hbWUgPSBjb2x1bW4udGV4dDtcbiAgICAgICAgICB0cmFjZXNbaW5kZXhdLndpZHRoID0gMC41IC8gdHJhY2VzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdmFsdWVzU291cmNlKCk6IGFueVtdIHtcbiAgICBjb25zdCBxdWVzdGlvbjogUXVlc3Rpb25NYXRyaXhNb2RlbCA9IDxhbnk+dGhpcy5xdWVzdGlvbjtcbiAgICByZXR1cm4gcXVlc3Rpb24uY29sdW1ucztcbiAgfVxuXG4gIGdldExhYmVscygpOiBhbnlbXSB7XG4gICAgY29uc3QgcXVlc3Rpb246IFF1ZXN0aW9uTWF0cml4TW9kZWwgPSA8YW55PnRoaXMucXVlc3Rpb247XG4gICAgcmV0dXJuIHF1ZXN0aW9uLnJvd3MubWFwKChyb3c6IGFueSkgPT5cbiAgICAgIEl0ZW1WYWx1ZS5nZXRUZXh0T3JIdG1sQnlWYWx1ZShxdWVzdGlvbi5yb3dzLCByb3cudmFsdWUpXG4gICAgKTtcbiAgfVxuXG4gIGdldERhdGEoKTogYW55W10ge1xuICAgIGNvbnN0IHF1ZXN0aW9uOiBRdWVzdGlvbk1hdHJpeE1vZGVsID0gPGFueT50aGlzLnF1ZXN0aW9uO1xuICAgIGNvbnN0IGRhdGFzZXRzOiBBcnJheTxhbnk+ID0gdGhpcy52YWx1ZXNTb3VyY2UoKS5tYXAoY2hvaWNlID0+IHtcbiAgICAgIHJldHVybiBxdWVzdGlvbi5yb3dzLm1hcCgodjogYW55KSA9PiAwKTtcbiAgICB9KTtcblxuICAgIHRoaXMuZGF0YS5mb3JFYWNoKHJvd0RhdGEgPT4ge1xuICAgICAgY29uc3QgcXVlc3Rpb25WYWx1ZTogYW55ID0gcm93RGF0YVt0aGlzLnF1ZXN0aW9uLm5hbWVdO1xuICAgICAgaWYgKCEhcXVlc3Rpb25WYWx1ZSkge1xuICAgICAgICBxdWVzdGlvbi5yb3dzLmZvckVhY2goKHJvdzogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgdGhpcy5nZXRWYWx1ZXMoKS5mb3JFYWNoKCh2YWw6IGFueSwgZHNJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBpZiAocXVlc3Rpb25WYWx1ZVtyb3cudmFsdWVdID09IHZhbCkge1xuICAgICAgICAgICAgICBkYXRhc2V0c1tkc0luZGV4XVtpbmRleF0rKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGFzZXRzO1xuICB9XG59XG5cblZpc3VhbGl6YXRpb25NYW5hZ2VyLnJlZ2lzdGVyVmlzdWFsaXplcihcIm1hdHJpeFwiLCBNYXRyaXhQbG90bHkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3Bsb3RseS9tYXRyaXgudHMiLCJpbXBvcnQgeyBRdWVzdGlvbiB9IGZyb20gXCJzdXJ2ZXktY29yZVwiO1xudmFyIFBsb3RseSA9IDxhbnk+cmVxdWlyZShcInBsb3RseS5qcy1kaXN0XCIpO1xuaW1wb3J0IHsgVmlzdWFsaXplckJhc2UgfSBmcm9tIFwiLi4vdmlzdWFsaXplckJhc2VcIjtcbmltcG9ydCB7IFZpc3VhbGl6YXRpb25NYW5hZ2VyIH0gZnJvbSBcIi4uL3Zpc3VhbGl6YXRpb25NYW5hZ2VyXCI7XG5pbXBvcnQgeyBsb2NhbGl6YXRpb24gfSBmcm9tIFwiLi4vbG9jYWxpemF0aW9uTWFuYWdlclwiO1xuaW1wb3J0IHsgVG9vbGJhckhlbHBlciB9IGZyb20gXCIuLi91dGlscy9pbmRleFwiO1xuXG5leHBvcnQgY2xhc3MgR2F1Z2VQbG90bHkgZXh0ZW5kcyBWaXN1YWxpemVyQmFzZSB7XG4gIHByaXZhdGUgX3Jlc3VsdDogYW55O1xuICBwcml2YXRlIGNoYXJ0OiBQcm9taXNlPFBsb3RseS5QbG90bHlIVE1MRWxlbWVudD47XG5cbiAgcHVibGljIHN0YXRpYyBzdGVwc0NvdW50ID0gNTtcbiAgcHVibGljIHN0YXRpYyBnZW5lcmF0ZVRleHRzQ2FsbGJhY2s6IChcbiAgICBxdWVzdGlvbjogUXVlc3Rpb24sXG4gICAgbWF4VmFsdWU6IG51bWJlcixcbiAgICBtaW5WYWx1ZTogbnVtYmVyLFxuICAgIHN0ZXBzQ291bnQ6IG51bWJlcixcbiAgICB0ZXh0czogc3RyaW5nW11cbiAgKSA9PiBzdHJpbmdbXTtcblxuICBwdWJsaWMgc3RhdGljIHR5cGVzID0gW1wiZ2F1Z2VcIiwgXCJidWxsZXRcIl07XG4gIHByb3RlY3RlZCBjaGFydFR5cGVzOiBBcnJheTxzdHJpbmc+O1xuICBjaGFydFR5cGU6IFN0cmluZztcbiAgY2hhcnROb2RlID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgcHVibGljIHN0YXRpYyBzaG93QXNQZXJjZW50YWdlID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuICAgIHF1ZXN0aW9uOiBRdWVzdGlvbixcbiAgICBkYXRhOiBBcnJheTx7IFtpbmRleDogc3RyaW5nXTogYW55IH0+LFxuICAgIG9wdGlvbnM/OiBPYmplY3RcbiAgKSB7XG4gICAgc3VwZXIodGFyZ2V0RWxlbWVudCwgcXVlc3Rpb24sIGRhdGEsIG9wdGlvbnMpO1xuICAgIHRoaXMuY2hhcnRUeXBlcyA9IEdhdWdlUGxvdGx5LnR5cGVzO1xuICAgIHRoaXMuY2hhcnRUeXBlID0gdGhpcy5jaGFydFR5cGVzWzBdO1xuICB9XG5cbiAgdXBkYXRlKGRhdGE6IEFycmF5PHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfT4pIHtcbiAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9yZXN1bHQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHN1cGVyLnVwZGF0ZShkYXRhKTtcbiAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB0aGlzLmNyZWF0ZUNoYXJ0KCk7XG4gICAgdGhpcy5pbnZva2VPblVwZGF0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSB0b29sYmFyQ2hhbmdlSGFuZGxlciA9IChlOiBhbnkpID0+IHtcbiAgICBpZiAodGhpcy5jaGFydFR5cGUgIT09IGUudGFyZ2V0LnZhbHVlKSB7XG4gICAgICB0aGlzLmNoYXJ0VHlwZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgdGhpcy51cGRhdGUodGhpcy5kYXRhKTtcbiAgICB9XG4gIH07XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sYmFyOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIGlmICh0aGlzLmNoYXJ0VHlwZXMubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3Qgc2VsZWN0V3JhcHBlciA9IFRvb2xiYXJIZWxwZXIuY3JlYXRlU2VsZWN0b3IoXG4gICAgICAgIHRvb2xiYXIsXG4gICAgICAgIHRoaXMuY2hhcnRUeXBlcy5tYXAoY2hhcnRUeXBlID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IGNoYXJ0VHlwZSxcbiAgICAgICAgICAgIHRleHQ6IGxvY2FsaXphdGlvbi5nZXRTdHJpbmcoXCJjaGFydFR5cGVfXCIgKyBjaGFydFR5cGUpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgICAgIChvcHRpb246IGFueSkgPT4gdGhpcy5jaGFydFR5cGUgPT09IG9wdGlvbi52YWx1ZSxcbiAgICAgICAgdGhpcy50b29sYmFyQ2hhbmdlSGFuZGxlclxuICAgICAgKTtcbiAgICAgIHRvb2xiYXIuYXBwZW5kQ2hpbGQoc2VsZWN0V3JhcHBlcik7XG4gICAgfVxuICAgIHN1cGVyLmNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sYmFyKTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgUGxvdGx5LnB1cmdlKHRoaXMuY2hhcnROb2RlKTtcbiAgICB0aGlzLl9yZXN1bHQgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBnZW5lcmF0ZVRleHQobWF4VmFsdWU6IG51bWJlciwgbWluVmFsdWU6IG51bWJlciwgc3RlcHNDb3VudDogbnVtYmVyKSB7XG4gICAgbGV0IHRleHRzOiBhbnkgPSBbXTtcblxuICAgIGlmIChzdGVwc0NvdW50ID09PSA1KSB7XG4gICAgICB0ZXh0cyA9IFtcbiAgICAgICAgXCJ2ZXJ5IGhpZ2ggKFwiICsgbWF4VmFsdWUgKyBcIilcIixcbiAgICAgICAgXCJoaWdoXCIsXG4gICAgICAgIFwibWVkaXVtXCIsXG4gICAgICAgIFwibG93XCIsXG4gICAgICAgIFwidmVyeSBsb3cgKFwiICsgbWluVmFsdWUgKyBcIilcIlxuICAgICAgXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGV4dHMucHVzaChtYXhWYWx1ZSk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ZXBzQ291bnQgLSAyOyBpKyspIHtcbiAgICAgICAgdGV4dHMucHVzaChcIlwiKTtcbiAgICAgIH1cbiAgICAgIHRleHRzLnB1c2gobWluVmFsdWUpO1xuICAgIH1cblxuICAgIGlmICghIUdhdWdlUGxvdGx5LmdlbmVyYXRlVGV4dHNDYWxsYmFjaykge1xuICAgICAgcmV0dXJuIEdhdWdlUGxvdGx5LmdlbmVyYXRlVGV4dHNDYWxsYmFjayhcbiAgICAgICAgdGhpcy5xdWVzdGlvbixcbiAgICAgICAgbWF4VmFsdWUsXG4gICAgICAgIG1pblZhbHVlLFxuICAgICAgICBzdGVwc0NvdW50LFxuICAgICAgICB0ZXh0c1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGV4dHM7XG4gIH1cblxuICBnZW5lcmF0ZVZhbHVlcyhtYXhWYWx1ZTogbnVtYmVyLCBzdGVwc0NvdW50OiBudW1iZXIpIHtcbiAgICBjb25zdCB2YWx1ZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RlcHNDb3VudDsgaSsrKSB7XG4gICAgICB2YWx1ZXMucHVzaChtYXhWYWx1ZSAvIHN0ZXBzQ291bnQpO1xuICAgIH1cblxuICAgIHZhbHVlcy5wdXNoKG1heFZhbHVlKTtcblxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICBnZW5lcmF0ZUNvbG9ycyhtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZTogbnVtYmVyLCBzdGVwc0NvdW50OiBudW1iZXIpIHtcbiAgICBjb25zdCBwYWxldHRlID0gdGhpcy5nZXRDb2xvcnMoKTtcbiAgICBjb25zdCBjb2xvcnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RlcHNDb3VudDsgaSsrKSB7XG4gICAgICBjb2xvcnMucHVzaChwYWxldHRlW2ldKTtcbiAgICB9XG5cbiAgICBjb2xvcnMucHVzaChcInJnYmEoMjU1LCAyNTUsIDI1NSwgMClcIik7XG5cbiAgICByZXR1cm4gY29sb3JzO1xuICB9XG5cbiAgcHJpdmF0ZSB0b1BlcmNlbnRhZ2UodmFsdWU6IG51bWJlciwgbWF4VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiAodmFsdWUgLyBtYXhWYWx1ZSkgKiAxMDA7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNoYXJ0KCkge1xuICAgIGNvbnN0IHF1ZXN0aW9uID0gdGhpcy5xdWVzdGlvbjtcblxuICAgIGNvbnN0IHJhdGVWYWx1ZXMgPSBxdWVzdGlvbi52aXNpYmxlUmF0ZVZhbHVlcztcbiAgICBsZXQgbWF4VmFsdWUgPSByYXRlVmFsdWVzW3JhdGVWYWx1ZXMubGVuZ3RoIC0gMV0udmFsdWU7XG4gICAgbGV0IG1pblZhbHVlID0gcmF0ZVZhbHVlc1swXS52YWx1ZTtcblxuICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2VuZXJhdGVDb2xvcnMoXG4gICAgICBtYXhWYWx1ZSxcbiAgICAgIG1pblZhbHVlLFxuICAgICAgR2F1Z2VQbG90bHkuc3RlcHNDb3VudFxuICAgICk7XG5cbiAgICB2YXIgbGV2ZWwgPSB0aGlzLnJlc3VsdDtcblxuICAgIGlmIChHYXVnZVBsb3RseS5zaG93QXNQZXJjZW50YWdlKSB7XG4gICAgICBsZXZlbCA9IHRoaXMudG9QZXJjZW50YWdlKGxldmVsLCBtYXhWYWx1ZSk7XG4gICAgICBtaW5WYWx1ZSA9IHRoaXMudG9QZXJjZW50YWdlKG1pblZhbHVlLCBtYXhWYWx1ZSk7XG4gICAgICBtYXhWYWx1ZSA9IHRoaXMudG9QZXJjZW50YWdlKG1heFZhbHVlLCBtYXhWYWx1ZSk7XG4gICAgfVxuXG4gICAgdmFyIGRhdGE6IGFueSA9IFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogXCJpbmRpY2F0b3JcIixcbiAgICAgICAgbW9kZTogXCJnYXVnZStudW1iZXJcIixcbiAgICAgICAgZ2F1Z2U6IHtcbiAgICAgICAgICBheGlzOiB7IHJhbmdlOiBbbWluVmFsdWUsIG1heFZhbHVlXSB9LFxuICAgICAgICAgIHNoYXBlOiB0aGlzLmNoYXJ0VHlwZSxcbiAgICAgICAgICBiZ2NvbG9yOiBcIndoaXRlXCIsXG4gICAgICAgICAgYmFyOiB7IGNvbG9yOiBjb2xvcnNbMF0gfVxuICAgICAgICB9LFxuICAgICAgICB2YWx1ZTogbGV2ZWwsXG4gICAgICAgIHRleHQ6IHF1ZXN0aW9uLm5hbWUsXG4gICAgICAgIGRvbWFpbjogeyB4OiBbMCwgMV0sIHk6IFswLCAxXSB9XG4gICAgICB9XG4gICAgXTtcblxuICAgIHZhciBoZWlnaHQgPSA0MDA7XG5cbiAgICBpZiAodGhpcy5jaGFydFR5cGUgPT09IFwiYnVsbGV0XCIpIHtcbiAgICAgIGhlaWdodCA9IDI1MDtcbiAgICB9XG5cbiAgICB2YXIgbGF5b3V0ID0ge1xuICAgICAgd2lkdGg6IDYwMCxcbiAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgcGxvdF9iZ2NvbG9yOiB0aGlzLmJhY2tncm91bmRDb2xvcixcbiAgICAgIHBhcGVyX2JnY29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yXG4gICAgfTtcblxuICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgIGRpc3BsYXlNb2RlQmFyOiBmYWxzZSxcbiAgICAgIHN0YXRpY1Bsb3Q6IHRydWVcbiAgICB9O1xuXG4gICAgdGhpcy5jaGFydCA9IFBsb3RseS5uZXdQbG90KHRoaXMuY2hhcnROb2RlLCBkYXRhLCBsYXlvdXQsIGNvbmZpZyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVuZGVyQ29udGVudChjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XG4gICAgdGhpcy5jcmVhdGVDaGFydCgpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNoYXJ0Tm9kZSk7XG4gIH1cblxuICBnZXQgcmVzdWx0KCkge1xuICAgIGlmICh0aGlzLl9yZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc3QgcXVlc3Rpb25WYWx1ZXM6IEFycmF5PGFueT4gPSBbXTtcblxuICAgICAgdGhpcy5kYXRhLmZvckVhY2gocm93RGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXN0aW9uVmFsdWU6IGFueSA9ICtyb3dEYXRhW3RoaXMucXVlc3Rpb24ubmFtZV07XG4gICAgICAgIGlmICghIXF1ZXN0aW9uVmFsdWUpIHtcbiAgICAgICAgICBxdWVzdGlvblZhbHVlcy5wdXNoKHF1ZXN0aW9uVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5fcmVzdWx0ID1cbiAgICAgICAgKHF1ZXN0aW9uVmFsdWVzICYmXG4gICAgICAgICAgcXVlc3Rpb25WYWx1ZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBxdWVzdGlvblZhbHVlcy5sZW5ndGgpIHx8XG4gICAgICAgIDA7XG4gICAgICB0aGlzLl9yZXN1bHQgPSBNYXRoLmNlaWwodGhpcy5fcmVzdWx0ICogMTAwKSAvIDEwMDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3Jlc3VsdDtcbiAgfVxufVxuXG5WaXN1YWxpemF0aW9uTWFuYWdlci5yZWdpc3RlclZpc3VhbGl6ZXIoXCJyYXRpbmdcIiwgR2F1Z2VQbG90bHkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3Bsb3RseS9yYXRpbmcudHMiLCJpbXBvcnQgeyBTZWxlY3RCYXNlUGxvdGx5IH0gZnJvbSBcIi4vc2VsZWN0QmFzZVwiO1xuaW1wb3J0IHsgVG9vbGJhckhlbHBlciB9IGZyb20gXCIuLi91dGlsc1wiO1xuaW1wb3J0IHsgbG9jYWxpemF0aW9uLCBWaXN1YWxpemF0aW9uTWFuYWdlciB9IGZyb20gXCIuLlwiO1xuZXhwb3J0IGNsYXNzIFNlbGVjdEJhc2VTb3J0YWJsZVBsb3RseSBleHRlbmRzIFNlbGVjdEJhc2VQbG90bHkge1xuICBwcm90ZWN0ZWQgb25DaGFydFR5cGVDaGFuZ2VkKCkge1xuICAgIHRoaXMuc2V0TGFiZWxzT3JkZXIoXCJkZWZhdWx0XCIpO1xuICAgIHRoaXMudXBkYXRlT3JkZXJTZWxlY3RvcigpO1xuICB9XG4gIHByaXZhdGUgY2hvaWNlc09yZGVyOiBIVE1MRGl2RWxlbWVudDtcbiAgcHJpdmF0ZSB1cGRhdGVPcmRlclNlbGVjdG9yKCkge1xuICAgIGlmICh0aGlzLmNoYXJ0VHlwZSA9PSBcImJhclwiKSB7XG4gICAgICB0aGlzLmNob2ljZXNPcmRlci5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaG9pY2VzT3JkZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgdGhpcy5jaG9pY2VzT3JkZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzZWxlY3RcIilbMF0udmFsdWUgPSBcImRlZmF1bHRcIjtcbiAgICB9XG4gIH1cbiAgcHJvdGVjdGVkIGNyZWF0ZVRvb2xiYXJJdGVtcyh0b29sYmFyOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIGlmICh0aGlzLmNoYXJ0VHlwZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5jaG9pY2VzT3JkZXIgPSBUb29sYmFySGVscGVyLmNyZWF0ZVNlbGVjdG9yKFxuICAgICAgICA8SFRNTERpdkVsZW1lbnQ+dG9vbGJhcixcbiAgICAgICAgW1xuICAgICAgICAgIHsgdGV4dDogbG9jYWxpemF0aW9uLmdldFN0cmluZyhcImRlZmF1bHRPcmRlclwiKSwgdmFsdWU6IFwiZGVmYXVsdFwiIH0sXG4gICAgICAgICAgeyB0ZXh0OiBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiYXNjT3JkZXJcIiksIHZhbHVlOiBcImFzY1wiIH0sXG4gICAgICAgICAgeyB0ZXh0OiBsb2NhbGl6YXRpb24uZ2V0U3RyaW5nKFwiZGVzY09yZGVyXCIpLCB2YWx1ZTogXCJkZXNjXCIgfVxuICAgICAgICBdLFxuICAgICAgICBvcHRpb24gPT4gZmFsc2UsXG4gICAgICAgIGUgPT4ge1xuICAgICAgICAgIHRoaXMuc2V0TGFiZWxzT3JkZXIoZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMuZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBzdXBlci5jcmVhdGVUb29sYmFySXRlbXModG9vbGJhcik7XG4gICAgICB0b29sYmFyLmFwcGVuZENoaWxkKHRoaXMuY2hvaWNlc09yZGVyKTtcbiAgICB9XG4gIH1cbn1cblZpc3VhbGl6YXRpb25NYW5hZ2VyLnJlZ2lzdGVyVmlzdWFsaXplcihcImNoZWNrYm94XCIsIFNlbGVjdEJhc2VTb3J0YWJsZVBsb3RseSk7XG5WaXN1YWxpemF0aW9uTWFuYWdlci5yZWdpc3RlclZpc3VhbGl6ZXIoXCJyYWRpb2dyb3VwXCIsIFNlbGVjdEJhc2VTb3J0YWJsZVBsb3RseSk7XG5WaXN1YWxpemF0aW9uTWFuYWdlci5yZWdpc3RlclZpc3VhbGl6ZXIoXCJkcm9wZG93blwiLCBTZWxlY3RCYXNlU29ydGFibGVQbG90bHkpO1xuVmlzdWFsaXphdGlvbk1hbmFnZXIucmVnaXN0ZXJWaXN1YWxpemVyKFwiaW1hZ2VwaWNrZXJcIiwgU2VsZWN0QmFzZVNvcnRhYmxlUGxvdGx5KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9wbG90bHkvc2VsZWN0QmFzZVNvcnRhYmxlLnRzIiwiZXhwb3J0IHZhciBzdG9wV29yZHMgPSBuZXcgQXJyYXkoXG4gIFwiYVwiLFxuICBcImFib3V0XCIsXG4gIFwiYWJvdmVcIixcbiAgXCJhY3Jvc3NcIixcbiAgXCJhZnRlclwiLFxuICBcImFnYWluXCIsXG4gIFwiYWdhaW5zdFwiLFxuICBcImFsbFwiLFxuICBcImFsbW9zdFwiLFxuICBcImFsb25lXCIsXG4gIFwiYWxvbmdcIixcbiAgXCJhbHJlYWR5XCIsXG4gIFwiYWxzb1wiLFxuICBcImFsdGhvdWdoXCIsXG4gIFwiYWx3YXlzXCIsXG4gIFwiYW1vbmdcIixcbiAgXCJhblwiLFxuICBcImFuZFwiLFxuICBcImFub3RoZXJcIixcbiAgXCJhbnlcIixcbiAgXCJhbnlib2R5XCIsXG4gIFwiYW55b25lXCIsXG4gIFwiYW55dGhpbmdcIixcbiAgXCJhbnl3aGVyZVwiLFxuICBcImFyZVwiLFxuICBcImFyZWFcIixcbiAgXCJhcmVhc1wiLFxuICBcImFyb3VuZFwiLFxuICBcImFzXCIsXG4gIFwiYXNrXCIsXG4gIFwiYXNrZWRcIixcbiAgXCJhc2tpbmdcIixcbiAgXCJhc2tzXCIsXG4gIFwiYXRcIixcbiAgXCJhd2F5XCIsXG4gIFwiYlwiLFxuICBcImJhY2tcIixcbiAgXCJiYWNrZWRcIixcbiAgXCJiYWNraW5nXCIsXG4gIFwiYmFja3NcIixcbiAgXCJiZVwiLFxuICBcImJlY2FtZVwiLFxuICBcImJlY2F1c2VcIixcbiAgXCJiZWNvbWVcIixcbiAgXCJiZWNvbWVzXCIsXG4gIFwiYmVlblwiLFxuICBcImJlZm9yZVwiLFxuICBcImJlZ2FuXCIsXG4gIFwiYmVoaW5kXCIsXG4gIFwiYmVpbmdcIixcbiAgXCJiZWluZ3NcIixcbiAgXCJiZXN0XCIsXG4gIFwiYmV0dGVyXCIsXG4gIFwiYmV0d2VlblwiLFxuICBcImJpZ1wiLFxuICBcImJvdGhcIixcbiAgXCJidXRcIixcbiAgXCJieVwiLFxuICBcImNcIixcbiAgXCJjYW1lXCIsXG4gIFwiY2FuXCIsXG4gIFwiY2Fubm90XCIsXG4gIFwiY2FzZVwiLFxuICBcImNhc2VzXCIsXG4gIFwiY2VydGFpblwiLFxuICBcImNlcnRhaW5seVwiLFxuICBcImNsZWFyXCIsXG4gIFwiY2xlYXJseVwiLFxuICBcImNvbWVcIixcbiAgXCJjb3VsZFwiLFxuICBcImRcIixcbiAgXCJkaWRcIixcbiAgXCJkaWZmZXJcIixcbiAgXCJkaWZmZXJlbnRcIixcbiAgXCJkaWZmZXJlbnRseVwiLFxuICBcImRvXCIsXG4gIFwiZG9lc1wiLFxuICBcImRvbmVcIixcbiAgXCJkb3duXCIsXG4gIFwiZG93blwiLFxuICBcImRvd25lZFwiLFxuICBcImRvd25pbmdcIixcbiAgXCJkb3duc1wiLFxuICBcImR1cmluZ1wiLFxuICBcImVcIixcbiAgXCJlYWNoXCIsXG4gIFwiZWFybHlcIixcbiAgXCJlaXRoZXJcIixcbiAgXCJlbmRcIixcbiAgXCJlbmRlZFwiLFxuICBcImVuZGluZ1wiLFxuICBcImVuZHNcIixcbiAgXCJlbm91Z2hcIixcbiAgXCJldmVuXCIsXG4gIFwiZXZlbmx5XCIsXG4gIFwiZXZlclwiLFxuICBcImV2ZXJ5XCIsXG4gIFwiZXZlcnlib2R5XCIsXG4gIFwiZXZlcnlvbmVcIixcbiAgXCJldmVyeXRoaW5nXCIsXG4gIFwiZXZlcnl3aGVyZVwiLFxuICBcImZcIixcbiAgXCJmYWNlXCIsXG4gIFwiZmFjZXNcIixcbiAgXCJmYWN0XCIsXG4gIFwiZmFjdHNcIixcbiAgXCJmYXJcIixcbiAgXCJmZWx0XCIsXG4gIFwiZmV3XCIsXG4gIFwiZmluZFwiLFxuICBcImZpbmRzXCIsXG4gIFwiZmlyc3RcIixcbiAgXCJmb3JcIixcbiAgXCJmb3VyXCIsXG4gIFwiZnJvbVwiLFxuICBcImZ1bGxcIixcbiAgXCJmdWxseVwiLFxuICBcImZ1cnRoZXJcIixcbiAgXCJmdXJ0aGVyZWRcIixcbiAgXCJmdXJ0aGVyaW5nXCIsXG4gIFwiZnVydGhlcnNcIixcbiAgXCJnXCIsXG4gIFwiZ2F2ZVwiLFxuICBcImdlbmVyYWxcIixcbiAgXCJnZW5lcmFsbHlcIixcbiAgXCJnZXRcIixcbiAgXCJnZXRzXCIsXG4gIFwiZ2l2ZVwiLFxuICBcImdpdmVuXCIsXG4gIFwiZ2l2ZXNcIixcbiAgXCJnb1wiLFxuICBcImdvaW5nXCIsXG4gIFwiZ29vZFwiLFxuICBcImdvb2RzXCIsXG4gIFwiZ290XCIsXG4gIFwiZ3JlYXRcIixcbiAgXCJncmVhdGVyXCIsXG4gIFwiZ3JlYXRlc3RcIixcbiAgXCJncm91cFwiLFxuICBcImdyb3VwZWRcIixcbiAgXCJncm91cGluZ1wiLFxuICBcImdyb3Vwc1wiLFxuICBcImhcIixcbiAgXCJoYWRcIixcbiAgXCJoYXNcIixcbiAgXCJoYXZlXCIsXG4gIFwiaGF2aW5nXCIsXG4gIFwiaGVcIixcbiAgXCJoZXJcIixcbiAgXCJoZXJlXCIsXG4gIFwiaGVyc2VsZlwiLFxuICBcImhpZ2hcIixcbiAgXCJoaWdoXCIsXG4gIFwiaGlnaFwiLFxuICBcImhpZ2hlclwiLFxuICBcImhpZ2hlc3RcIixcbiAgXCJoaW1cIixcbiAgXCJoaW1zZWxmXCIsXG4gIFwiaGlzXCIsXG4gIFwiaG93XCIsXG4gIFwiaG93ZXZlclwiLFxuICBcImlcIixcbiAgXCJpZlwiLFxuICBcImltcG9ydGFudFwiLFxuICBcImluXCIsXG4gIFwiaW50ZXJlc3RcIixcbiAgXCJpbnRlcmVzdGVkXCIsXG4gIFwiaW50ZXJlc3RpbmdcIixcbiAgXCJpbnRlcmVzdHNcIixcbiAgXCJpbnRvXCIsXG4gIFwiaXNcIixcbiAgXCJpdFwiLFxuICBcIml0c1wiLFxuICBcIml0c2VsZlwiLFxuICBcImpcIixcbiAgXCJqdXN0XCIsXG4gIFwia1wiLFxuICBcImtlZXBcIixcbiAgXCJrZWVwc1wiLFxuICBcImtpbmRcIixcbiAgXCJrbmV3XCIsXG4gIFwia25vd1wiLFxuICBcImtub3duXCIsXG4gIFwia25vd3NcIixcbiAgXCJsXCIsXG4gIFwibGFyZ2VcIixcbiAgXCJsYXJnZWx5XCIsXG4gIFwibGFzdFwiLFxuICBcImxhdGVyXCIsXG4gIFwibGF0ZXN0XCIsXG4gIFwibGVhc3RcIixcbiAgXCJsZXNzXCIsXG4gIFwibGV0XCIsXG4gIFwibGV0c1wiLFxuICBcImxpa2VcIixcbiAgXCJsaWtlbHlcIixcbiAgXCJsb25nXCIsXG4gIFwibG9uZ2VyXCIsXG4gIFwibG9uZ2VzdFwiLFxuICBcIm1cIixcbiAgXCJtYWRlXCIsXG4gIFwibWFrZVwiLFxuICBcIm1ha2luZ1wiLFxuICBcIm1hblwiLFxuICBcIm1hbnlcIixcbiAgXCJtYXlcIixcbiAgXCJtZVwiLFxuICBcIm1lbWJlclwiLFxuICBcIm1lbWJlcnNcIixcbiAgXCJtZW5cIixcbiAgXCJtaWdodFwiLFxuICBcIm1vcmVcIixcbiAgXCJtb3N0XCIsXG4gIFwibW9zdGx5XCIsXG4gIFwibXJcIixcbiAgXCJtcnNcIixcbiAgXCJtdWNoXCIsXG4gIFwibXVzdFwiLFxuICBcIm15XCIsXG4gIFwibXlzZWxmXCIsXG4gIFwiblwiLFxuICBcIm5lY2Vzc2FyeVwiLFxuICBcIm5lZWRcIixcbiAgXCJuZWVkZWRcIixcbiAgXCJuZWVkaW5nXCIsXG4gIFwibmVlZHNcIixcbiAgXCJuZXZlclwiLFxuICBcIm5ld1wiLFxuICBcIm5ld1wiLFxuICBcIm5ld2VyXCIsXG4gIFwibmV3ZXN0XCIsXG4gIFwibmV4dFwiLFxuICBcIm5vXCIsXG4gIFwibm9ib2R5XCIsXG4gIFwibm9uXCIsXG4gIFwibm9vbmVcIixcbiAgXCJub3RcIixcbiAgXCJub3RoaW5nXCIsXG4gIFwibm93XCIsXG4gIFwibm93aGVyZVwiLFxuICBcIm51bWJlclwiLFxuICBcIm51bWJlcnNcIixcbiAgXCJvXCIsXG4gIFwib2ZcIixcbiAgXCJvZmZcIixcbiAgXCJvZnRlblwiLFxuICBcIm9sZFwiLFxuICBcIm9sZGVyXCIsXG4gIFwib2xkZXN0XCIsXG4gIFwib25cIixcbiAgXCJvbmNlXCIsXG4gIFwib25lXCIsXG4gIFwib25seVwiLFxuICBcIm9wZW5cIixcbiAgXCJvcGVuZWRcIixcbiAgXCJvcGVuaW5nXCIsXG4gIFwib3BlbnNcIixcbiAgXCJvclwiLFxuICBcIm9yZGVyXCIsXG4gIFwib3JkZXJlZFwiLFxuICBcIm9yZGVyaW5nXCIsXG4gIFwib3JkZXJzXCIsXG4gIFwib3RoZXJcIixcbiAgXCJvdGhlcnNcIixcbiAgXCJvdXJcIixcbiAgXCJvdXRcIixcbiAgXCJvdmVyXCIsXG4gIFwicFwiLFxuICBcInBhcnRcIixcbiAgXCJwYXJ0ZWRcIixcbiAgXCJwYXJ0aW5nXCIsXG4gIFwicGFydHNcIixcbiAgXCJwZXJcIixcbiAgXCJwZXJoYXBzXCIsXG4gIFwicGxhY2VcIixcbiAgXCJwbGFjZXNcIixcbiAgXCJwb2ludFwiLFxuICBcInBvaW50ZWRcIixcbiAgXCJwb2ludGluZ1wiLFxuICBcInBvaW50c1wiLFxuICBcInBvc3NpYmxlXCIsXG4gIFwicHJlc2VudFwiLFxuICBcInByZXNlbnRlZFwiLFxuICBcInByZXNlbnRpbmdcIixcbiAgXCJwcmVzZW50c1wiLFxuICBcInByb2JsZW1cIixcbiAgXCJwcm9ibGVtc1wiLFxuICBcInB1dFwiLFxuICBcInB1dHNcIixcbiAgXCJxXCIsXG4gIFwicXVpdGVcIixcbiAgXCJyXCIsXG4gIFwicmF0aGVyXCIsXG4gIFwicmVhbGx5XCIsXG4gIFwicmlnaHRcIixcbiAgXCJyaWdodFwiLFxuICBcInJvb21cIixcbiAgXCJyb29tc1wiLFxuICBcInNcIixcbiAgXCJzYWlkXCIsXG4gIFwic2FtZVwiLFxuICBcInNhd1wiLFxuICBcInNheVwiLFxuICBcInNheXNcIixcbiAgXCJzZWNvbmRcIixcbiAgXCJzZWNvbmRzXCIsXG4gIFwic2VlXCIsXG4gIFwic2VlbVwiLFxuICBcInNlZW1lZFwiLFxuICBcInNlZW1pbmdcIixcbiAgXCJzZWVtc1wiLFxuICBcInNlZXNcIixcbiAgXCJzZXZlcmFsXCIsXG4gIFwic2hhbGxcIixcbiAgXCJzaGVcIixcbiAgXCJzaG91bGRcIixcbiAgXCJzaG93XCIsXG4gIFwic2hvd2VkXCIsXG4gIFwic2hvd2luZ1wiLFxuICBcInNob3dzXCIsXG4gIFwic2lkZVwiLFxuICBcInNpZGVzXCIsXG4gIFwic2luY2VcIixcbiAgXCJzbWFsbFwiLFxuICBcInNtYWxsZXJcIixcbiAgXCJzbWFsbGVzdFwiLFxuICBcInNvXCIsXG4gIFwic29tZVwiLFxuICBcInNvbWVib2R5XCIsXG4gIFwic29tZW9uZVwiLFxuICBcInNvbWV0aGluZ1wiLFxuICBcInNvbWV3aGVyZVwiLFxuICBcInN0YXRlXCIsXG4gIFwic3RhdGVzXCIsXG4gIFwic3RpbGxcIixcbiAgXCJzdGlsbFwiLFxuICBcInN1Y2hcIixcbiAgXCJzdXJlXCIsXG4gIFwidFwiLFxuICBcInRha2VcIixcbiAgXCJ0YWtlblwiLFxuICBcInRoYW5cIixcbiAgXCJ0aGF0XCIsXG4gIFwidGhlXCIsXG4gIFwidGhlaXJcIixcbiAgXCJ0aGVtXCIsXG4gIFwidGhlblwiLFxuICBcInRoZXJlXCIsXG4gIFwidGhlcmVmb3JlXCIsXG4gIFwidGhlc2VcIixcbiAgXCJ0aGV5XCIsXG4gIFwidGhpbmdcIixcbiAgXCJ0aGluZ3NcIixcbiAgXCJ0aGlua1wiLFxuICBcInRoaW5rc1wiLFxuICBcInRoaXNcIixcbiAgXCJ0aG9zZVwiLFxuICBcInRob3VnaFwiLFxuICBcInRob3VnaHRcIixcbiAgXCJ0aG91Z2h0c1wiLFxuICBcInRocmVlXCIsXG4gIFwidGhyb3VnaFwiLFxuICBcInRodXNcIixcbiAgXCJ0b1wiLFxuICBcInRvZGF5XCIsXG4gIFwidG9nZXRoZXJcIixcbiAgXCJ0b29cIixcbiAgXCJ0b29rXCIsXG4gIFwidG93YXJkXCIsXG4gIFwidHVyblwiLFxuICBcInR1cm5lZFwiLFxuICBcInR1cm5pbmdcIixcbiAgXCJ0dXJuc1wiLFxuICBcInR3b1wiLFxuICBcInVcIixcbiAgXCJ1bmRlclwiLFxuICBcInVudGlsXCIsXG4gIFwidXBcIixcbiAgXCJ1cG9uXCIsXG4gIFwidXNcIixcbiAgXCJ1c2VcIixcbiAgXCJ1c2VkXCIsXG4gIFwidXNlc1wiLFxuICBcInZcIixcbiAgXCJ2ZXJ5XCIsXG4gIFwid1wiLFxuICBcIndhbnRcIixcbiAgXCJ3YW50ZWRcIixcbiAgXCJ3YW50aW5nXCIsXG4gIFwid2FudHNcIixcbiAgXCJ3YXNcIixcbiAgXCJ3YXlcIixcbiAgXCJ3YXlzXCIsXG4gIFwid2VcIixcbiAgXCJ3ZWxsXCIsXG4gIFwid2VsbHNcIixcbiAgXCJ3ZW50XCIsXG4gIFwid2VyZVwiLFxuICBcIndoYXRcIixcbiAgXCJ3aGVuXCIsXG4gIFwid2hlcmVcIixcbiAgXCJ3aGV0aGVyXCIsXG4gIFwid2hpY2hcIixcbiAgXCJ3aGlsZVwiLFxuICBcIndob1wiLFxuICBcIndob2xlXCIsXG4gIFwid2hvc2VcIixcbiAgXCJ3aHlcIixcbiAgXCJ3aWxsXCIsXG4gIFwid2l0aFwiLFxuICBcIndpdGhpblwiLFxuICBcIndpdGhvdXRcIixcbiAgXCJ3b3JrXCIsXG4gIFwid29ya2VkXCIsXG4gIFwid29ya2luZ1wiLFxuICBcIndvcmtzXCIsXG4gIFwid291bGRcIixcbiAgXCJ4XCIsXG4gIFwieVwiLFxuICBcInllYXJcIixcbiAgXCJ5ZWFyc1wiLFxuICBcInlldFwiLFxuICBcInlvdVwiLFxuICBcInlvdW5nXCIsXG4gIFwieW91bmdlclwiLFxuICBcInlvdW5nZXN0XCIsXG4gIFwieW91clwiLFxuICBcInlvdXJzXCIsXG4gIFwielwiXG4pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3dvcmRjbG91ZC9zdG9wd29yZHMvZW5nbGlzaC50cyIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8zN19fO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIHtcInJvb3RcIjpcIldvcmRDbG91ZFwiLFwiY29tbW9uanMyXCI6XCJ3b3JkY2xvdWRcIixcImNvbW1vbmpzXCI6XCJ3b3JkY2xvdWRcIixcImFtZFwiOlwid29yZGNsb3VkXCJ9XG4vLyBtb2R1bGUgaWQgPSAzN1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfMzhfXztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCB7XCJyb290XCI6XCJqUXVlcnlcIixcImNvbW1vbmpzMlwiOlwianF1ZXJ5XCIsXCJjb21tb25qc1wiOlwianF1ZXJ5XCIsXCJhbWRcIjpcImpxdWVyeVwifVxuLy8gbW9kdWxlIGlkID0gMzhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==